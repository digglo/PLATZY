(function(){function d(b,e){(toa.browser.isIpad||toa.browser.isIE9||toa.dom.isTouch)&&document.elementFromPoint&&(b.target=document.elementFromPoint(b.originalEvent.clientX,b.originalEvent.clientY),b.originalEvent.target=b.target);var c=$(b.target),d=c.parents(":data(ui-droppable)");c.data("ui-droppable")&&d.add(c);d.each(function(c,d){var g=$(d).data("ui-droppable");g&&g.accept(e.helper)&&g._trigger("dragmove",b,e)})}$.ui.plugin.add("draggable","dragmove",{drag:d});var c=$.ui.sortable.prototype._mouseDrag;
$.ui.sortable.prototype._mouseDrag=function(b){var e=this._uiHash();e.position={left:b.pageX,top:b.pageY};d.call(this,b,e);return c.apply(this,arguments)}})();
$.ui.plugin.add("draggable","dropIntoUpper",{start:function(d,c){var b=$(this).data("uiDraggable").options;b&&b.scope&&$.ui.ddmanager&&$.ui.ddmanager.droppables&&$.ui.ddmanager.droppables[b.scope]&&$.ui.ddmanager.droppables[b.scope].sort(function(b,c){var d=parseInt(b.element.css("zIndex"),10)||0,l=parseInt(c.element.css("zIndex"),10)||0;if(d>=l)return-1;if(d<l)return 1})}});$.ui.draggable.prototype.options.safariSelectFix=!0;
$.ui.plugin.add("draggable","safariSelectFix",{start:function(d,c){$("html").css("-webkit-user-select","none")},stop:function(d,c){$("html").css("-webkit-user-select","auto")}});toa.Class=function(d,c,b){var e=function(){var b=arguments.callee;if(b.__preparing__)delete b.__preparing__;else{for(;b.__class;){if(b.__adds)for(var c in b.__adds)"undefined"==typeof this[c]&&(this[c]=toa.clone(b.__adds[c]));b=b.prototype.constructor}this.constructor=e;this._create&&this._create.apply(this,arguments)}};$.isFunction(d)?(d.__preparing__=!0,e.prototype=new d,d.__preparing__=null,e.prototype.constructor=d):(e.prototype={callParent:function(){return this.callParent.caller.parent.apply(this,
arguments)},getClassStatic:function(){return this.getStatic.caller.definedInClass},handledBy:function(b,e){var c=this;toa.isString(b)&&(b=c[b]);if(!$.isFunction(b))throw"Handler not a function or method"+b;var d=function(){arguments.callee.__context=this;b.apply(c,arguments)};d.__data=e;return d},getHandlerData:function(){return this.getHandlerData.caller.__data},getHandlerContext:function(){return this.getHandlerContext.caller.__context}},b=c||null,c=d||{});e.__class=!0;if("object"!=typeof c)throw"Argument is not Object (hash): "+
c+" Has type:"+typeof c;for(var g in c)c.hasOwnProperty(g)&&(d=e.prototype[g],e.prototype[g]=c[g],$.isFunction(c[g])&&(e.prototype[g].parent=$.isFunction(d)?d:function(){},e.prototype[g].methodName=g,e.prototype[g].definedInClass=e),d=null);b&&(e.__adds=b);c.hasOwnProperty("toString")&&(e.prototype.toString=c.toString);c=b=null;return e};$.Class=toa.Class;(function(d){d.ns("toa.controllers",{});d.Application=d.define(null,function(){this._propagationStopped=!1;this._subscribers={};this._controllers={};this._suspendedControllers={};this._create.apply(this,arguments)},{toString:function(){return"TOA management application"},_create:function(){this.createConsole();this.bind("app.controller.register",this.registerByEvent,this);this.bind("app.controller.suspend",this.suspendByEvent,this);this.bind("app.controller.resume",this.resumeByEvent,this);$app.addListener("user.options.submitted.languageChanged",
this.reloadGlossaryData.bind(this))},reloadGlossaryData:function(){app.getXhrClient().send($app.model().urlService().generateUrl("manage/getGlossary"),null,{type:"GET"}).then(function(c){window._DATA.glossary=c.getRaw()}).catch(function(){throw Error("Cannot load glossary from manage/getGlossary");})},public_methods:"unbind log error get set model registerModel stopPropagation".split(" "),createConsole:function(){window.console||(window.console={log:function(){},error:function(){},warn:function(){},
dir:function(){},trace:function(){}});d.log||(d.log=window.console.log)},trigger:function(c,b,e,g){c=this._formatEvent(c,g&&g.options&&g.options.eventPrefix?g.options.eventPrefix:"");var k=this._subscribers[c];if(k){this.debug&&console.log("App trigger: "+c,b,g);var l=null;this._propagationStopped=!1;for(var n=0;n<k.length;n++){var p=k[n];if(!p.name||p.name==g.name){var s=this.getInstance(p.owner);if(!e||!s||(s.name||s.sandbox&&s.sandbox.name||"")==e){p.from=g;p.owner=s;d.isString(p.handler)&&(p.handler=
s[p.handler]);try{if(this.debug&&console.log("handled: "+p.owner.toString(),b),l=p.handler.apply(s,[c,b||null,p]),this._propagationStopped)break}catch(t){s="no data";try{s=b&&d.toJson(b)}catch(u){s="recursion in data"}t.message=(t.message||t.description)+"\nEvent: "+c+"\nEventData: "+s;this.error(t,p.handler,p.owner)}}}}return l}},stopPropagation:function(){this._propagationStopped=!0},set:function(c,b){switch(c){case "pid":_DATA.resourceTreeSelection.selectedPid=b;case "is_favorite_pid":_DATA.is_favorite_pid=
b;case "is_group":_DATA.is_group=b}},get:function(c){switch(c){case "resource_folder":return _DATA&&_DATA.resource_folder;case "resourceTreeSelection":return _DATA&&_DATA.resourceTreeSelection;case "pid":return _DATA&&_DATA.resourceTreeSelection.selectedPid;case "is_favorite_pid":return _DATA&&_DATA.is_favorite_pid||0;case "is_group":return _DATA&&_DATA.is_group||0;case "today":var b=d.app.model("companySettings").getUser().tz_diff,b=d.datetime.currentDate(b);return d.date.formatDate("Y-m-d",b);case "date":return _DATA&&
_DATA.date?($.isArray(_DATA.date),_DATA.date):this.get("today");case "dates":return _DATA&&_DATA.dates?_DATA.dates:[this.get("today")];case "session_id":return GetSessId();case "login":return _DATA&&_DATA.login;case "company_identifier":return _DATA&&_DATA.company_identifier;case "userMaxDate":c=!1;try{c=d.app.model("companySettings").getUser();if("undefined"!=typeof c.future_days_limit)var e=parseInt(c.future_days_limit,10);if(isNaN(e))return!1;b=new Date;return new Date(b.getTime()+6E4*(c.tz_diff+
b.getTimezoneOffset())+e*d.date.DAY)}catch(g){return!1}case "copyright":return this.model("companySettings").settings.copyright;case "page_label":return _DATA.page_label;case "name":return this.model("companySettings").settings.user.uname;default:return null}},getInstance:function(c){if("string"!==typeof c)return c;var b=this._controllers[c];return b&&b.instance?this._controllers[c].instance:!1},on:function(c){for(var b=c.event.split(" "),e=c.eventPrefix||c.sandbox&&c.sandbox.options&&c.sandbox.options.eventPrefix?
c.sandbox.options.eventPrefix:"",d=0;d<b.length;d++){var k=this._formatEvent(b[d],e);this._subscribers[k]||(this._subscribers[k]=[]);var l={owner:c.owner,sandbox:c.sandbox,handler:c.handler,name:c.name||"",data:c.data};this.debug&&console.log("On: "+k,l);"first"==c.order?this._subscribers[k].unshift(l):this._subscribers[k].push(l)}return c.sandbox},bind:function(c,b,e,d){this.on({event:c,owner:e,handler:b,name:"",data:d,order:"last"})},unbind:function(c,b,e){if(!e)return this.error(Error("owner is not passed to unbind method")),
!1;var d,k,l;if(c){if(l=this._subscribers[c])for(d=0;d<l.length;d++)this.getInstance(l[d].owner)===this.getInstance(e)&&(b?l[d].handler===b&&l.splice(d,1):l.splice(d,1));l&&!l.length&&delete this._subscribers[c]}else for(d in this._subscribers)for(k in l=this._subscribers[d],l)this.getInstance(l[k].owner)===this.getInstance(e)&&(l.splice(k,1),l.length||delete this._subscribers[d]);return!0},_formatEvent:function(c,b){return 0===c.indexOf(".")?b+c:c},suspendByEvent:function(c,b){if(b&&b.instance){var e=
this.getInstance(b.instance);if(e&&$.isFunction(e.suspend)){e.suspend.apply(e,[b.params]);var d,k;for(k in this._subscribers){d=this._subscribers[k];for(var l in d)if(this.getInstance(d[l].owner)==e){this._suspendedControllers[b.instance]||(this._suspendedControllers[b.instance]=[]);var n=d[l];n.event=k;this._suspendedControllers[b.instance].push(n);this.unbind(k,d[l].handler,d[l].owner)}}}}},resumeByEvent:function(c,b){if(b&&b.instance){var e=this.getInstance(b.instance);if(e&&$.isFunction(e.resume)){e.resume.apply(e,
[b.params]);var e=this._suspendedControllers[b.instance],d;for(d in e)this.on(e[d]);delete this._suspendedControllers[b.instance]}}},registerByEvent:function(c,b){b&&b.instance&&b.controller&&(this.register(b.instance,b.controller,b.params||null),this.start(b.instance))},register:function(c,b,e){c&&b?this._controllers[c]?this.error(Error('Controller "'+c+'" has been already registered')):(d.isString(b)&&(b=d.classBuilder.getController(b)),this._controllers[c]={controller:b,instance:null,options:e}):
this.error(Error("Controller name or handler is empty"))},isStarted:function(c){return this._controllers[c]&&this._controllers[c].instance?!0:!1},start:function(c){if(this.isStarted(c))return this.getInstance(c);var b=new d.Sandbox(this,this._controllers[c].options);b.options.name=b.name=c;this._controllers[c].instance=new this._controllers[c].controller(b);return b.controller=this.getInstance(c)},stop:function(c){this._controllers[c].instance.destroy&&this._controllers[c].instance.destroy();this.unbind(null,
null,this.getInstance(c));this._controllers[c].instance=null;this._suspendedControllers[c]&&delete this._suspendedControllers[c]},registerModel:function(c,b,e){c&&b?this._controllers["model."+c]?this.error(Error('Model with name "'+c+'" is already registered')):b&&$.isFunction(b)?this._controllers["model."+c]={controller:b,instance:null,options:e}:this.error(Error("model_class should be a function")):this.error(Error("Model name or handler is empty"),arguments,this)},model:function(c){var b="model."+
c;return this._controllers[b]?this.start(b):(this.error(Error('Model "'+c+'" is not registered')),!1)},error:function(c,b,e){var g="",k="";d.isString(c)&&(c=Error(c));if(c){var l=(new Date).getTime(),g=g+("\nMessage: "+(c.message||c.description)+(c.lineNumber?"\nLine: "+c.lineNumber:"")+(c.fileName?"\nFile: "+c.fileName:"")),n=b?$.isFunction(b)?b:b.callee||!1:!1;if(e){if(g+="\nInstance: "+e,n)for(var p in e)if(e[p]==n){g+="\nFunction: "+p;break}}else n&&(g+="\nFunction: "+n.toString());if(c.stack)var s,
k=((s=(-1<c.stack.search(d.escapeRegExp(c.message))?RegExp("^(?:[^\n]+\n){"+c.message.split("\n").length+"}((?:[^\n]+\n){4}).*$","m"):/^((?:[^\n]+\n){20}).*$/m).exec(c.stack))&&s.pop&&s.pop().replace(/(^\s+|\n\s+)/mg,"\n")||c.stack.substring(0,1E3))+" ...";else for(n=arguments.callee.caller,p=0;n&&20>p;){s=n.methodName;t="";if(s)try{var t=n.definedInClass.prototype.toString()}catch(u){}else if(n.__class)s="new toa.Class";else if(-1<n.toString().indexOf("return fn.apply( context, args.concat( slice.call( arguments ) ) );"))s=
"Proxy",t="jQuery";else try{for(var v in jQuery.fn)if(jQuery.fn[v]===n){s=v;t="jQuery";break}}catch(w){}var x=n.toString();s=s||x;s=t+":"+s+x.substring(8,x.indexOf("\n"));k+=s+"\n";n=n.caller;p++}_DATA._debug&&(_DATA._debug.prepend('<pre class="debug-error" style="color:red">'+g+"</pre>").parent().css("display","block"),console.error(g));hide_disabling_cover();this.logErrorToServer({js_error:g,agent:navigator.userAgent,page_label:_DATA.page_label,timestamp:l,stack:k})}},logErrorToServer:function(c){var b=
$.extend({SID:GetSessId().replace(/^.*=/,"").replace(/^.*%3D/,"")},c);urlValue=_DATA.is_mobility_app?"../?output=ajax":"?output=ajax";$.ajax({type:"POST",url:urlValue,data:b,dataType:"json",success:function(){console.warn("Success sending JS error: ",b.js_error,b.stack)},error:function(){console.warn("Error sending JS error: ",b.js_error,b.stack,arguments)}})},log:function(c){console.log(c)}})})(toa);toa.classBuilder={_controllerClassesNamespace:null,_init:function(){toa.controllers||(toa.controllers={});this._controllerClassesNamespace=toa.controllers},createController:function(d,c,b,e){if(!d)throw Error("Cant create controller without name");if(!c)throw Error("Cant create controller without prototype");var g=this._controllerClassesNamespace,k=d.substr(0,d.indexOf("."));k&&toa.isString(k)&&(g[k]||(g[k]={}),g=g[k],d=d.substr(d.indexOf(".")+1,d.length));return g[d]=toa.Class(e&&this.getController(e)||
toa.Controller,c,b||{})},getController:function(d){if(!toa.isString(d))return this.error(Error("getController wrong parameter (expecting string)")),null;if(toa[d])return toa[d];if(this._controllerClassesNamespace[d])return this._controllerClassesNamespace[d];var c=d.substr(0,d.indexOf("."));return c&&(d=d.substr(d.indexOf(".")+1,d.length))&&this._controllerClassesNamespace[c]&&this._controllerClassesNamespace[c][d]?this._controllerClassesNamespace[c][d]:null}};toa.classBuilder._init();(function(d){d.Sandbox=d.define(null,function(){this._create.apply(this,arguments)},{toString:function(){return'Sandbox: "'+this.name+'"'},_create:function(c,b){this._app=c;for(var e in c.public_methods)this[c.public_methods[e]]=c[c.public_methods[e]].bind(c);this.options=b||{}},bind:function(c,b,e,d){e=e||this.controller||this.name||this;if($.isPlainObject(c))this._multiBind(c,e,d);else this.on({event:c,owner:e,sandbox:this,handler:b,data:d})},_multiBind:function(c,b){for(var e in c)this.bind(e,
c[e],b)},on:function(c){c.sandbox=this;c.owner=c.owner||this.controller||this.name||this;this._app.on.apply(this._app,[c])},off:function(c,b,e){this._app.unbind.apply(this._app,[c,b,e])},trigger:function(c,b,e){this._app.trigger.apply(this._app,[c,b||null,e||!1,this])},get:function(c){this.trigger("request",c)}})})(toa);(function(d){d.Collection=d.define(null,function(){this._count=0;this._index=this._comparator=this._items=!1;this.lastTempId=0;this.options=!1;this._create.apply(this,arguments)},{toString:function(){return"Collection, "+this._count+" items"},_create:function(c){this.options=$.extend({},this.options,c);this._items=[];this.onAdd="function"===typeof this.options.add?this.options.add:!1;this.onRemove="function"===typeof this.options.remove?this.options.remove:!1},add:function(c,b){if(!c)return!1;if(!b||
this._items[b])b=this.getFreeId();this._items[b]=c;"function"==typeof c.setCollection&&this._items[b].setCollection(this);this._count++;this._index=!1;this.onAdd&&this.onAdd.apply(this,[{id:b,item:this._items[b]}]);return b},remove:function(c){return this._items[c]?(delete this._items[c],this._count--,this._index=!1,this.onRemove&&this.onRemove.apply(this,[{id:c}]),!0):!1},move:function(c,b){if("undefined"!=typeof this._items[c]){if(this._items[b]){var e=this._items[c];this._items[c]=this._items[b];
this._items[b]=e}else this._items[b]=this._items[c],delete this._items[c];this._index=!1;return!0}return!1},each:function(c,b){b||(b=this);if(this._comparator){!1===this._index&&this.sort();for(var e=0;e<this._count;e+=1)if(this._items.hasOwnProperty(this._index[e])&&!1===c.apply(b,[this.get(this._index[e])]))return!1;return!0}for(e in this._items)if(this._items.hasOwnProperty(e)&&!1===c.apply(b,[this._items[e]]))return!1;return!0},get:function(c,b){return"undefined"!=typeof this._items[c]?this._items[c]:
!1},find:function(c,b){var e=[],d=!0;b=b||this;for(var k in this._items)this._items.hasOwnProperty(k)&&!0===c.apply(b,[this._items[k],k])&&(e[k]=this._items[k],d=!1);return d?!1:e},findFirst:function(c,b){for(var e in this._items)if(this._items.hasOwnProperty(e)&&!0===c.apply(this,[this._items[e],e]))return this._items[e];return!1},getFreeId:function(){if(this._count==this._items.length)return 0>this._count&&(this._count=0),this._count+1;if(this._count<this._items.length){for(var c=1;c<this._items.length&&
null!=this._items[c];c++);return c}return!1},getCount:function(){return this._count},clear:function(){for(var c in this._items)this._items.hasOwnProperty(c)&&"undefined"!=typeof this._items[c]&&("function"==typeof this._items[c].clear&&this._items[c].clear(),delete this._items[c],this._count--,this.onRemove&&this.onRemove.apply(this,[{id:c}]))},sort:function(){var c=this;if("function"==typeof this._comparator){this._index=[];for(var b in c._items)c._index.push(b);c._index.sort(function(b,d){return c._comparator(c.get(b),
c.get(d))})}},sortReverse:function(){var c=this;if("function"==typeof this._comparator){this._index=[];for(var b in c._items)c._index.push(b);c._index.sort(function(b,d){return-c._comparator(c.get(b),c.get(d))})}},setComparator:function(c){"function"==typeof c?(this._comparator=c,this._index=!1):!1===c&&(this._comparator=!1)},getComparator:function(){return this._comparator},generateTempId:function(){return--this.lastTempId}})})(toa);toa.Fliper=function(d){this.options=$.extend({},this.options,d);d.anchor&&(this.anchor=$(d.anchor));"function"==typeof d.getRectAnchor&&(this._getRectAnchor=d.getRectAnchor);d.element&&(this.element=$(d.element));"function"==typeof d.getRectElement&&(this._getRectElement=d.getRectElement);this.container=$(d.container||"body");"function"==typeof d.getRectContainer&&(this._getRectContainer=d.getRectContainer)};
toa.Fliper.prototype={mapPosition:[["bottom","left"],["bottom","right"],["bottom","center"],["bottom","auto"],["top","left"],["top","right"],["top","center"],["top","auto"],["left","top"],["left","bottom"],["left","center"],["left","auto"],["right","top"],["right","bottom"],["right","center"],["right","auto"]],mapOverlayPosition:[["left","top"],["left","bottom"],["left","center"],["left","auto"],["right","top"],["right","bottom"],["right","center"],["right","auto"],["top","left"],["top","right"],
["top","center"],["top","auto"],["bottom","left"],["bottom","right"],["bottom","center"],["bottom","auto"],["center","center"]],toString:function(){return"Fliper object"},getOptimalPosition:function(d){var c;c={};return(c=this.findOptimalOnMapPosition())?c={point:this.getPoint(c.appear,c.align),position:c}:!0===d&&(c=this.findOptimalOnMapOverlayPosition())?c={point:this.getPointOverlay(c.appear,c.align),position:c}:c={point:{top:this.containerInfo.top,left:this.containerInfo.left},position:!1}},findOptimalOnMapPosition:function(){var d,
c={},b,e,g;c.top=this.checkAbilityPosition("top");c.bottom=this.checkAbilityPosition("bottom");c.left=this.checkAbilityPosition("left");c.right=this.checkAbilityPosition("right");b=this.options.mapPosition||this.mapPosition;for(d=0;d<b.length;d++)if(e=b[d][0],g=b[d][1],!0==c[e][g])return{appear:e,align:g};return null},findOptimalOnMapOverlayPosition:function(){var d,c,b={},e,g;b.top=this.checkAbilityPositionOverlay("top");b.bottom=this.checkAbilityPositionOverlay("bottom");b.left=this.checkAbilityPositionOverlay("left");
b.right=this.checkAbilityPositionOverlay("right");b.center=this.checkAbilityPositionOverlay("center");c=this.options.mapOverlayPosition||this.mapOverlayPosition;for(d=0;d<c.length;d++)if(e=c[d][0],g=c[d][1],!0==b[e][g])return{appear:e,align:g};return null},getPoint:function(d,c){var b;switch(d){case "top":b={left:this._calcHorizontalAlign(c),top:this.anchorInfo.top-this.elementInfo.height};break;case "bottom":b={left:this._calcHorizontalAlign(c),top:this.anchorInfo.top+this.anchorInfo.height};break;
case "left":b={left:this.anchorInfo.left-this.elementInfo.width,top:this._calcVerticalAlign(c)};break;case "right":b={left:this.anchorInfo.left+this.anchorInfo.width,top:this._calcVerticalAlign(c)}}return b},getPointOverlay:function(d,c){var b;switch(d){case "top":b={left:this._calcHorizontalAlign(c),top:this.anchorInfo.top};break;case "bottom":b={left:this._calcHorizontalAlign(c),top:this.anchorInfo.top-this.elementInfo.height+this.anchorInfo.height};break;case "left":b={left:this.anchorInfo.left,
top:this._calcVerticalAlign(c)};break;case "right":b={left:this.anchorInfo.left-this.elementInfo.width+this.anchorInfo.width,top:this._calcVerticalAlign(c)}}if("center"==d){if("left"==c||"right"==c)this._calcHorizontalAlign(c),this._calcVerticalAlign("center");if("top"==c||"bottom"==c)this._calcHorizontalAlign("center"),this._calcVerticalAlign(c);b={left:this._calcHorizontalAlign(c),top:this._calcVerticalAlign(c)}}return b},checkAbilityPosition:function(d){var c,b={};this._updateRect();b.top=!1;b.center=
!1;b.bottom=!1;b.left=!1;b.right=!1;c=this.getPoint(d,d);switch(d){case "top":c.top>=this.containerInfo.top&&(b=this.checkAbilityPositionForHorizontal());break;case "bottom":c.top+this.elementInfo.height<=this.containerInfo.height+this.containerInfo.top&&(b=this.checkAbilityPositionForHorizontal());break;case "left":c.left>=this.containerInfo.left&&(b=this.checkAbilityPositionForVertical());break;case "right":c.left+this.elementInfo.width<=this.containerInfo.width+this.containerInfo.left&&(b=this.checkAbilityPositionForVertical())}return b},
checkAbilityPositionForHorizontal:function(){var d={},c;this._updateRect();c=this._calcHorizontalAlign("left");d.left=!1;d.center=!1;d.right=!1;d.auto=!1;c>=this.containerInfo.left&&c+this.elementInfo.width<=this.containerInfo.left+this.containerInfo.width&&(d.left=!0);c=this._calcHorizontalAlign("center");c>=this.containerInfo.left&&c+this.elementInfo.width<=this.containerInfo.left+this.containerInfo.width&&(d.center=!0);c=this._calcHorizontalAlign("right");c>=this.containerInfo.left&&c+this.elementInfo.width<=
this.containerInfo.left+this.containerInfo.width&&(d.right=!0);this.containerInfo.width>this.elementInfo.width&&(d.auto=!0);return d},checkAbilityPositionForVertical:function(){var d={},c;this._updateRect();c=this._calcVerticalAlign("top");d.top=!1;d.center=!1;d.bottom=!1;c>=this.containerInfo.top&&c+this.elementInfo.height<=this.containerInfo.top+this.containerInfo.height&&(d.top=!0);c=this._calcVerticalAlign("center");c>=this.containerInfo.top&&c+this.elementInfo.height<=this.containerInfo.top+
this.containerInfo.height&&(d.center=!0);c=this._calcVerticalAlign("bottom");c>=this.containerInfo.top&&c+this.elementInfo.height<=this.containerInfo.top+this.containerInfo.height&&(d.bottom=!0);this.containerInfo.height>this.elementInfo.height&&(d.auto=!0);return d},checkAbilityPositionOverlay:function(d){var c,b={};this._updateRect();b.left=!1;b.center=!1;b.right=!1;b.auto=!1;c=this.getPointOverlay(d,d);switch(d){case "top":c.top+this.elementInfo.height<=this.containerInfo.top+this.containerInfo.height&&
(b=this.checkAbilityPositionForHorizontal());break;case "bottom":c.top>=this.containerInfo.top&&(b=this.checkAbilityPositionForHorizontal());break;case "left":c.left+this.elementInfo.width<=this.containerInfo.left+this.containerInfo.width&&(b=this.checkAbilityPositionForVertical());break;case "right":c.left>=this.containerInfo.left&&(b=this.checkAbilityPositionForVertical())}"center"==d&&(c=this.getPointOverlay(d,"top"),c.top+this.elementInfo.height<=this.containerInfo.top+this.containerInfo.height&&
(b.top=!0),c=this.getPointOverlay(d,"bottom"),c.top>=this.containerInfo.top&&(b.bottom=!0),c=this.getPointOverlay(d,"left"),c.left>=this.containerInfo.left+this.containerInfo.width&&(b.left=!0),c=this.getPointOverlay(d,"right"),c.left+this.elementInfo.width>=this.containerInfo.left+this.containerInfo.width&&(b.right=!0),c=this.getPointOverlay(d,"center"),c.left>this.containerInfo.left&&c.left+this.elementInfo.width<=this.containerInfo.left+this.containerInfo.width&&c.top>=this.containerInfo.top&&
c.top+this.elementInfo.height<=this.containerInfo.top+this.containerInfo.height&&(b.center=!0));return b},_calcHorizontalAlign:function(d){var c;switch(d){case "bottom":case "left":c=this.anchorInfo.left;break;case "center":c=this.anchorInfo.left-(this.elementInfo.width-this.anchorInfo.width)/2;break;case "top":case "right":c=this.anchorInfo.left-this.elementInfo.width+this.anchorInfo.width;break;case "auto":c=this.containerInfo.left>this.anchorInfo.left?c=this.containerInfo.left:this.containerInfo.left+
this.containerInfo.width-this.elementInfo.width}return c},_calcVerticalAlign:function(d){var c;switch(d){case "left":case "top":c=this.anchorInfo.top;break;case "center":c=this.anchorInfo.top-(this.elementInfo.height-this.anchorInfo.height)/2;break;case "right":case "bottom":c=this.anchorInfo.top-this.elementInfo.height+this.anchorInfo.height;break;case "auto":c=this.containerInfo.top>this.anchorInfo.top?c=this.containerInfo.top:this.containerInfo.top+this.containerInfo.height-this.elementInfo.height}return c},
_getRectAnchor:function(){return{width:this.anchor.outerWidth(),height:this.anchor.outerHeight(),top:this.anchor.offset().top,left:this.anchor.offset().left}},_getRectElement:function(){return{width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.offset().top,left:this.element.offset().left}},_getRectContainer:function(){return{width:this.container.outerWidth(),height:this.container.outerHeight(),top:this.container.offset().top,left:this.container.offset().left}},_updateRect:function(){this.anchorInfo=
this._getRectAnchor();this.elementInfo=this._getRectElement();this.containerInfo=this._getRectContainer()},destroy:function(){this.containerInfo=this.elementInfo=this.anchorInfo=null}};toa.Controller={toString:function(){return"Controller"},_create:function(d){this.sandbox=d},suspend:function(d){this.isSuspended=1},resume:function(d){this.isSuspended=0},destroy:function(){},showPopup:function(d,c,b){d=d||"";c=c||"";var e=$.Deferred();b&&$.isArray(b)&&b.length?$.each(b,function(b,c){if("function"===typeof c.click){var d=c.click;c.click=function(){var b=Array.prototype.slice.call(arguments);b.unshift(e);d.apply(this,b)}}}.bind(this)):b=[{text:h(445),position:"right",tpl:'<button class="popup-button toa-button"></button>',
click:function(){e.reject()}}];e.always(function(){g.destroy()});var g=new toa.ui.Popup({title:d,autoOpen:!0,html:c.replace(/\n/g,"<br />"),modal:!0,onClose:function(){g.destroy();e.reject()},buttons:b});g._dom.base.id="toa-usertypes-popup";return e}};toa.Controller=toa.define(null,function(){this._create.apply(this,arguments)},toa.Controller);(function(d){var c=d.Controller;d.ModelRecord=d.define(c,function(){this._create.apply(this,arguments)},{toString:function(){return"Model"},_create:function(){this.entity={};this.changed=!1;c.prototype._create.apply(this,arguments)},ENTITY_NONE:0,getCollection:function(){return this.collection},get:function(b,e){var c=this.entity[b];return d.isDefined(c)?c:e},has:function(b){return d.isDefined(this.entity[b])},set:function(b,e){this.entity[b]&&this.entity[b]===e||(this.changed=!0);this.entity[b]=
e;return this},isChanged:function(){return this.changed},setChanged:function(){this.changed=!0},clearChanged:function(){this.changed=!1},unset:function(b){"undefined"!=typeof this.entity[b]&&(delete this.entity[b],this.setChanged())},getEntity:function(){return this.entity},update:function(b){if("object"==typeof b)for(var e in b)this.set(e,b[e])}})})(toa);(function(d){var c=d.ModelRecord;d.ModelEntity=d.define(c,function(){this._create.apply(this,arguments)},{entityDefault:{},fieldName:{},idField:"ID",_create:function(b,e){c.prototype._create.apply(this,arguments);this.settings=e||d.app.model("companySettings");this.update(this.entityDefault);b&&this.update(b);this.clearChanged()},getId:function(b){return this.get(this.idField,b)},setId:function(b){return this.set(this.idField,b)},set:function(b,e){return d.ModelRecord.prototype.set.apply(this,[this.nameToKey(b),
e])},setDefault:function(b){return this.set(b,this.entityDefault[this.keyToName(b)])},has:function(b){return c.prototype.has.call(this,this.nameToKey(b))},unset:function(b){return c.prototype.unset.call(this,this.nameToKey(b))},get:function(b,e){return d.ModelRecord.prototype.get.call(this,this.nameToKey(b),e)},nameToKey:function(b){return this.fieldName[(b||"").toUpperCase()]||b},keyToName:function(b){this.fieldKey.empty&&this._calculateKeyIndex();return this.fieldKey[b]||b},_calculateKeyIndex:function(){for(var b in this.fieldName)this.fieldKey[this.fieldName[b]]=
b;delete this.fieldKey.empty}})})(toa);toa.ns("toa.events.Event",function(d){this._immediatePropagationStopped=this._propagationStopped=this._defaultPrevented=!1;this.name=d});$.extend(toa.events.Event.prototype,{preventDefault:function(){this._defaultPrevented=!0},isDefaultPrevented:function(){return!!this._defaultPrevented},stopPropagation:function(){this._propagationStopped=!0},isPropagationStopped:function(){return!!this._propagationStopped},stopImmediatePropagation:function(){this._immediatePropagationStopped=!0},isImmediatePropagationStopped:function(){return!!this._immediatePropagationStopped}});toa.touch=toa.touch||{};toa.touch._touchHandler=function(d){var c=d.originalEvent.changedTouches[0],c=new MouseEvent({touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"}[d.type],{view:window,bubbles:!0,cancelable:!0,screenX:c.screenX,screenY:c.screenY,clientX:c.clientX,clientY:c.clientY,pageX:c.pageX,pageY:c.pageY});c._originalTarget=d.target;this.dispatchEvent(c)};
toa.touch.setTouchDraggable=function(d){toa.touch.unsetTouchDraggable(d);if("string"==typeof d)$(document).on("touchstart.draggable touchmove.draggable touchend.draggable touchcancel.draggable",d,this._touchHandler);else $(d).on("touchstart.draggable touchmove.draggable touchend.draggable touchcancel.draggable",this._touchHandler)};
toa.touch.unsetTouchDraggable=function(d){"string"==typeof d?$(document).off("touchstart.draggable touchmove.draggable touchend.draggable touchcancel.draggable",d,this._touchHandler):$(d).length&&$(d).off("touchstart.draggable touchmove.draggable touchend.draggable touchcancel.draggable",this._touchHandler)};(function(d){var c=d.define(null,function(){this._cache={};this._create.apply(this,arguments)},{_create:function(){},toString:function(){return"TemplateCache"},create:function(b,e,c){if(!arguments.length)throw Error(this.toString()+".create: empty parameters");c=c||!1;if(!this.isCached(b)||c)this._cache[b]={instance:(new d.Template(e)).compile(),usageCount:0,rebuildCount:1};this._cache[b].usageCount++;return this._cache[b].instance},isCached:function(b){return"undefined"!==typeof this._cache[b]},
getCache:function(){return this._cache},listCached:function(b){if(b&&"alert"===b){b=[];for(var e in this._cache)b.push(e+" => used: "+this._cache[e].usageCount+", rebuilt: "+this._cache[e].rebuildCount);d.ui.Alert({text:hs(b.join("<br>"))})}else for(e in this._cache)console.log(e+" => used: "+this._cache[e].usageCount+", rebuilt: "+this._cache[e].rebuildCount,this._cache[e].instance)}});d.TemplateCache=new c})(toa);var jetPages={forecasting:"Forecasting",routing_plan:"RoutingPlan",activity_link:"ActivityLinks",routing_run_list:"RoutingExecutionSummary",routing_report:"RoutingReport"},isTouch="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,_isDispatchInitCalled=!1,READ_ONLY=1,READ_WRITE=2,MOBILITY_TYPE_VALUE="itype=manage",MOBILITY_URL_SUFFIX="&m=command&a=index&"+MOBILITY_TYPE_VALUE,isMSIE11=/trident\/7\.0/.test(navigator.userAgent.toLowerCase()),isDOM=document.getElementById,
isOpera=isOpera5=window.opera&&isDOM,isOpera6=isOpera&&window.print,isOpera7=isOpera&&document.readyState,isMSIE5=isDOM&&document.all&&document.all.item&&!isOpera,isMSIE11=/trident\/7\.0/.test(navigator.userAgent.toLowerCase()),isEdge=/edge/.test(navigator.userAgent.toLowerCase()),INTERFACE={MANAGE:1,MOBILITY:3},RESPONSIVE_WIDTH={MAX:1499,DESKTOP:1024,TAB:768,PHONE:480,MIN:375},SCREEN_MAPPINGS={activity_top:"topActivitiesPanel",activity_bottom:"bottomActivitiesPanel",dashboard:"dashboard",quota:"quota",
booking:"quota",routing:"routing",forecasting:"forecasting"},NO_REMOVAL={MAX:[],DESKTOP:[],TAB:[],PHONE:[],MIN:[]},CONFIGURATION_REMOVAL={MAX:[],DESKTOP:[],TAB:[12],PHONE:[7,12],MIN:[7,12]},ORDER_OF_REMOVAL={company_settings_about_company:NO_REMOVAL,company_settings_business_rules:NO_REMOVAL,company_settings_work_schedules:CONFIGURATION_REMOVAL,company_settings_work_zone_dictionary:CONFIGURATION_REMOVAL,company_settings_link_templates:CONFIGURATION_REMOVAL,company_settings_work_skills_list:$.extend({},
CONFIGURATION_REMOVAL,{DESKTOP:[12]}),company_settings_properties_list:CONFIGURATION_REMOVAL,company_settings_work_skill_capacity_categories:NO_REMOVAL,company_settings_time_slots_list:$.extend({},CONFIGURATION_REMOVAL,{TAB:[]}),company_settings_resource_types_list:$.extend({},CONFIGURATION_REMOVAL,{TAB:[]}),company_settings_activity_types_list:CONFIGURATION_REMOVAL,company_settings_inventory_types_list:NO_REMOVAL,company_settings_glossary_list:CONFIGURATION_REMOVAL,company_settings_display:NO_REMOVAL,
company_settings_themes:$.extend({},NO_REMOVAL,{PHONE:[12],MIN:[12]}),company_settings_filters_list:$.extend({},CONFIGURATION_REMOVAL,{TAB:[]}),company_settings_forms_and_plugins:$.extend({},CONFIGURATION_REMOVAL,{DESKTOP:[12]}),company_settings_support_of_organizations:NO_REMOVAL,company_settings_login_policies_list:$.extend({},CONFIGURATION_REMOVAL,{TAB:[]}),company_settings_user_types:$.extend({},NO_REMOVAL,{PHONE:[12],MIN:[12]}),company_settings_applications:NO_REMOVAL,company_settings_OKCS_integration:NO_REMOVAL,
company_settings_statistics:NO_REMOVAL,company_settings_outbound_channels:$.extend({},NO_REMOVAL,{PHONE:[12],MIN:[12]}),company_settings_triggers:NO_REMOVAL,company_settings_collaboration:NO_REMOVAL,company_settings_holidays:$.extend({},CONFIGURATION_REMOVAL,{TAB:[]}),company_settings_surveys:$.extend({},CONFIGURATION_REMOVAL,{TAB:[]}),company_settings_surveys_list:$.extend({},CONFIGURATION_REMOVAL,{TAB:[]}),company_settings_dwh:$.extend({},NO_REMOVAL,{PHONE:[12],MIN:[12]}),company_settings_shifts:CONFIGURATION_REMOVAL},
TOP_PANEL_MAIN_TREE="main",BOTTOM_PANEL_MAIN_TREE="activities bottom";
function dispatcher_app_init(){if(!0!==_isDispatchInitCalled){_DATA.resource_folder=window.baseResourcesPath;toa.currentInterface=3;window.toa.reloader={timeout:30,timer:null,set:function(b){b="undefined"!==typeof b?b:refresh;null!==this.timer&&this.clear();this.timer=setTimeout(b,1E3*this.timeout)},clear:function(){clearTimeout(this.timer);this.timer=null}};_DATA.indicator=new toa.ui.AjaxLoadingIndicator;_DATA.indicator.initGlobal();_DATA.content=$("#content-manage-container #manage-content")[0]||
$("<div>")[0];toa.app=new toa.Application(toa);toa.app.registerModel("pageLabels",toa.models.PageLabels,{mainMenu:menuConfig||{}});toa.app.registerModel("companySettings",toa.models.CompanySettings);toa.app.registerModel("featureList",toa.models.FeatureList);toa.app.registerModel("User",toa.models.User);toa.app.registerModel("loginPolicy",toa.models.LoginPolicy);toa.app.registerModel("bucketTree",toa.models.BucketTree);toa.app.registerModel("activitiesListColumns",toa.models.ActivitiesListColumns);
toa.app.registerModel("routeService",toa.models.RouteService);toa.isFrameworkPageLabel=function(b){return"undefined"!=typeof c[b]};_DATA.tabs=new SideBar({1:{independent:!0},2:{independent:!0},4:{independent:!0},8:{independent:!0},16:{independent:!0},32:{independent:!0}});toa.permissions=permissions;toa.app.reflowManager=toa.createReflowManager();toa.app.reflowManager.addListener("resize",function(){_DATA.screen_size={width:d.width(),height:d.height()}});$app.addListener("user.options.submitted.languageChanged",
reloadGlossaryData);toa.view.Header.init(toa.app);var d=$(window);_DATA.screen_size={width:d.width(),height:d.height()};companySettings&&(toa.app.model("companySettings").load(companySettings),initDate({UtcTimestamp:companySettings.utc_timestamp,formats:companySettings.user.dateFormats,timeWhileYesterdayRw:companySettings.working_time_since_midnight}));delete companySettings;toa.app.registerModel("featureToggler",toa.models.featureToggle.FeatureToggler,{togglableFeatures:togglableFeatures});delete togglableFeatures;
toa.app.registerModel("resourceTreeManager",toa.models.ResourceTreeManager);var c={"default":{controller:""}};(function(){window.initialTreeData={treeDate:_DATA.tree_date,structure:_DATA.p_tree,treeUpdatesFor:_DATA.tree_updates_for,version:_DATA.tree_version,structChangeTime:_DATA.struct_change_time,treeRoots:_DATA.tree_roots,treeMode:_DATA.tree_mode};toa.ResourcesTree=new toa.models.ResourceTree(TOP_PANEL_MAIN_TREE,initialTreeData);var b={groupId:0,rootPid:0,selectedPid:0};_DATA.resourceTreeSelection&&
(b=_DATA.resourceTreeSelection);toa.ResourcesTree.setResourceGroups(_DATA.resource_groups,b);toa.ResourcesTree.enableAutoUpdate();toa.app.register("resourceTree",toa.controllers.ResourceTree,{treeState:toa.ResourcesTree,container:$("#tab2")});toa.app.start("resourceTree")})();toa.app.register("dispatchView","DispatchView",{controllers:c,companySettings:toa.app.model("companySettings"),target:$("#content-manage-container #manage-content"),company:_DATA.company_identifier});toa.app.start("dispatchView");
toa.app.register("ajaxModel",toa.Ajax);toa.app.start("ajaxModel");setupAppBinds();setupCallbacks();setupDrag();toa.app.register("assignHint","AssignHint");toa.app.start("assignHint");toa.app.register("RoutingPlan","RoutingPlan");toa.app.start("RoutingPlan");toa.app.register("searchActivity","SearchActivity");toa.app.start("searchActivity");toa.app.register("logViewer","LogViewer");toa.app.start("logViewer");_isDispatchInitCalled=!0}}
function reloadGlossaryData(){app.getXhrClient().send($app.model().urlService().generateUrl("manage/getGlossary"),null,{type:"GET"}).then(function(d){window._DATA.glossary=d.getRaw()}).catch(function(){throw Error("Cannot load glossary from manage/getGlossary");})}function isError(d){return d.operation_is_not_permited||d.feature_is_unavailable||d.kernel_error||!0===d.incompleteCaches}
function initDate(d){var c,b,e,g=toa.app.model("companySettings");toa.datetime.init();d&&d.formats&&$.extend(toa.datetime.format,d.formats);d&&d.UtcTimestamp&&toa.datetime.setUtcTime(d.UtcTimestamp);d&&d.timeWhileYesterdayRw&&toa.datetime.setTimeWhileYesterdayRw(d.timeWhileYesterdayRw);"undefined"!=typeof toa.app.model("User").getWeekStartDay()&&(toa.datetime.firstDay=toa.app.model("User").getWeekStartDay());d=g.getUser().calendar_start;c=g.getUser().calendar_end;b=toa.datetime.parseDate("iso",toa.app.get("today"));
b.setDate(b.getDate()-g.getCutLimit());b=toa.datetime.formatDate("iso",b);e=toa.datetime.parseDate("iso",toa.app.get("today"));e.setDate(e.getDate()+g.getFutureDaysLimit());e=toa.datetime.formatDate("iso",e);toa.view.calendar.CalendarSimple.prototype._global_options={minDate:b>d?b:d,maxDate:e<c?e:c}}function h(d,c){return hs(r(d,c))}
function r(d,c){if("undefined"==typeof _DATA&&"undefined"!==typeof _IS_MAIN_WINDOW&&"undefined"!=typeof window.parent._DATA)_DATA=window.parent._DATA;else if("undefined"==typeof _DATA)return"undefined["+d+"]";if("undefined"==typeof _DATA.glossary||"undefined"==typeof _DATA.glossary[d])return"undefined"!==typeof toa&&"undefined"!==typeof toa.app&&"undefined"!==typeof toa.app.error&&toa.app.error("JavaScript placeholder "+d+" is missed"),"undefined["+d+"]";if(c){var b=[],e=[],g;for(g in c)b.push(g),
e.push(c[g]);g=_DATA.glossary[d];for(var k=g.length,l=b.length,n="",p=!1,s=0;s<k;s+=1){for(var p=!1,t=0;t<l;t+=1)if(g.substr(s,b[t].length)==b[t]){p=!0;s=s+b[t].length-1;break}n+=!1===p?g.charAt(s):e[t]}return n}return _DATA.glossary[d]}function hs(d){var c;(c=setElement("span")).appendChild(document.createTextNode(d));return c.innerHTML}
function generate_id(d){if("string"==typeof d)return d;try{if(d&&d.id)return d.id}catch(c){}_DATA.ElementIdGenerator||(_DATA.ElementIdGenerator=0);var b;do b="elId"+ ++_DATA.ElementIdGenerator;while(get_element(b));if(d)try{d.setAttribute("id",b)}catch(e){}return b}function ElementsNum(d){var c=0,b;for(b in d)c+=1;return c}function anticache(){return(new Date).getTime()}function get_element(d){return document.getElementById(d)}function GetSessId(){return""}
function setElement(d,c,b,e){var g,k,l="string"==typeof d?document.createElement(d):d;for(g in b)if("style"==g)for(k in b[g])if("expression"==k){if(l.style.setExpression&&("6.0"==toa.browser.version||"7.0"==toa.browser.version))for(var n in b[g][k])l.style.setExpression(n,b[g][k][n],"javascript")}else if("removeExpression"==k){if(l.style.removeExpression&&("6.0"==toa.browser.version||"7.0"==toa.browser.version))for(n in b[g][k])l.style.removeExpression(b[g][k][n])}else $(l).css(k,b[g][k]);else if("attribute"==
g)for(k in b[g])d=b[g][k],d!=parseInt(d,10)&&(d=d.substr(1,d.length-2)),$(l).attr(k,d);else d=b[g],d!=parseInt(d,10)&&(d=d.substr(1,d.length-2)),$(l).attr(g,d);if(e)for(g in e)addEvent(g,l,e[g]);"undefined"!=typeof c&&null!==c&&c.appendChild(l);return l}
function setElementBG(d,c,b,e){toa.browser.msie&&7>=parseInt(toa.browser.version)?(d=setElement(d,c,b,e),c=d.id,c||(d.id=c="m"+anticache()),d.style.zIndex||(d.style.zIndex=5),c+="_dummyIFrame",_DATA.backgroundIFrame4IE||(_DATA.backgroundIFrame4IE={}),_DATA.backgroundIFrame4IE[c]?(b={left:d.style.left,top:d.style.top,zIndex:d.style.zIndex-1,display:d.style.display||"block",visibility:d.style.visibility||"inherit",expression:{}},d.offsetWidth?b.width=d.offsetWidth:d.style.getExpression&&d.style.getExpression("width")&&
(b.expression.width=d.style.getExpression("width")),d.offsetHeight?b.height=d.offsetHeight:d.style.getExpression&&d.style.getExpression("height")&&(b.expression.height=d.style.getExpression("height")),setElement(_DATA.backgroundIFrame4IE[c],null,{style:b})):(b={position:"absolute",filter:"Alpha(opacity=0)",left:d.style.left,top:d.style.top,zIndex:d.style.zIndex-1,display:d.style.display,visibility:d.style.visibility||"inherit",expression:{}},d.offsetWidth?b.width=d.offsetWidth:d.style.getExpression&&
d.style.getExpression("width")&&(b.expression.width=d.style.getExpression("width")),d.offsetHeight?b.height=d.offsetHeight:d.style.getExpression&&d.style.getExpression("height")&&(b.expression.height=d.style.getExpression("height")),_DATA.backgroundIFrame4IE[c]=setElement("iframe",d.parentElement,{style:b,attribute:{src:'"javascript:false;"',scroll:'"no"',frameborder:0}}),_DATA.backgroundIFrame4IE[c].id=c)):d=setElement(d,c,b,e);return d}function a(d){return toa.permissions[d]||!1}
function hide_disabling_cover(d){("undefined"===typeof d||_DATA.disabling_cover&&_DATA.disabling_cover.className==d)&&_DATA.disabling_cover&&setElement(_DATA.disabling_cover,null,{style:{display:"none"}})}function toaGetTargetFromEvent(d){return"object"!==typeof d?null:d.target||null}
function openExternalPlugin(d){request({url:d.url,responseHandler:function(c){var b="plugin_window"+(new Date).getTime(),e=/^https?:/.test(c.path)?c.path:window.location.protocol+"//"+c.path,d=[];c.width&&100<c.width&&d.push("width="+c.width);c.height&&100<c.height&&d.push("height="+c.height);(c=c.post_data?c.post_data:!1)?(0<d.length?(d=d.join(","),window.open("",b,d)):window.open("",b),post(c,e,b)):0<d.length?(d=d.join(","),window.open(e,b,d)):window.open(e,b)}})}
function setupAppBinds(){toa.app.bind("global.date.set",function(d,c){"undefined"==typeof c.dates&&"string"==typeof c.date&&(c.dates=[c.date]);1===c.dates.length&&(_DATA.dates=c.dates);if((_DATA.date!=c.date||c.force)&&toa.date.DAY_WITHOUT_DATE!=c.date){var b=_DATA.date;_DATA.date=c.dates[0];_DATA.dates=c.dates;toa.app.trigger("global.date.changed",{date:_DATA.dates[0],dates:_DATA.dates,fromDate:b});c.doRequest&&toa.app.trigger("global.data.get",{url:c.doRequest.url})}},toa.app);toa.app.bind("interface.actions.click",
function(d,c){if(c.action){var b=toa.app.model("companySettings").getActionsDesc(c.action),e;if(!(c.download_file||c.tab||c.options&1||b)){var g=trimLongHash(c);e=g.cut;c.targ_el&&(e.targ_el=c.targ_el);c=g.src}c=$.extend({pid:toa.app.get("pid"),date:toa.app.get("date"),page:_DATA.page_label},c);c.entity_action=c.action;delete c.action;c.url=c.url?"?"+c.url:"?"+$.param(c);c.action=c.entity_action;delete c.entity_action;c=$.extend(b,c);c.trigger?toa.app.trigger(c.trigger,c):c.download_file?c.controller&&
c.method?(b=toa.Ajax.prototype.route(c.controller,c.method)+"&"+$.param({providerId:c.pid,date:c.date,panel:c.panel,view:c.view}),download_file(b)):download_file(c.url):!b||!b.type||"external"!==b.type||b.options&1?b?toa.app.trigger("interface.popupWin.open",c):c.action.includes("create_resource")&&isMobilityApp()?displayChildResourceForm(c.pid):toa.app.trigger("global.data.get",{url:c.url,params:e}):openExternalPlugin(b)}hide_hint()},toa.app);toa.app.bind("interface.popupWin.open",function(d,c){-1===
c.url.indexOf(MOBILITY_URL_SUFFIX)&&(c.url+=MOBILITY_URL_SUFFIX);wopen(c.url||"",c.height||0,c.width||0,c.options&2?"yes":"no",c.options&2?"yes":"no",c.html||"",!1,c.name||"")},toa.app);toa.app.bind("interface.contentGenerator.close",function(d,c){cgClose(c)},toa.app);toa.app.bind("global.provider.changed",function(d,c){if(toa.isFrameworkPageLabel(_DATA.page_label))return!1;toa.app.trigger("global.data.get",{url:"?sel_pid="+c.pid+MOBILITY_URL_SUFFIX,keep_in_history:!0})},toa.app);toa.app.bind("global.filter.changed",
function(d,c){_DATA.shouldSetFocus=!0;toa.app.trigger("global.data.get",{form:c.form})},toa.app);toa.app.bind("global.config.changed",function(d,c){toa.app.model("companySettings").reload(c)},toa.app);toa.app.bind("model.companySettings.reload",function(d,c){initDate({UtcTimestamp:c.settings.utc_timestamp,formats:c.settings.user.dateFormats,timeWhileYesterdayRw:c.settings.working_time_since_midnight})},toa.app);toa.app.bind("global.interface.reload",function(d,c){post({reload_main_frame:"yes"})},
toa.app)}
function setupCallbacks(){$(document).keyup(function(d){_DATA.pressed_key=0});$(document).keydown(function(d){global_onkeydown(d)});$(document).mousemove(function(d,c){global_onmousemove(d,c||{})});$(document).mouseup(function(d,c){global_onmouseup(d,c||{})});$(_DATA.dispatcher_container).click(function(d){"object"===typeof jbfApp&&"function"===typeof jbfApp.hamburgerMenuIsOpen&&!0===jbfApp.hamburgerMenuIsOpen()&&(jbfApp.hamburgerMenuIsOpen(!1),d.stopPropagation())});$(".header-wrapper").click(function(){$(_DATA.dispatcher_container).mousedown().mouseup()});$(_DATA.popup_container).on("click",
".hint-back-btn",function(){$(_DATA.popup_container).mousedown().mouseup()});$(_DATA.dispatcher_container).on("click",".dashboardBackButton",function(){$app.navigation().goBack()})}
function global_onkeydown(d){d||(d=window.event);if(_DATA._debug)if(d.ctrlKey&&(192==d.keyCode||96==d.keyCode))_DATA._debug_container.css("display","block"==_DATA._debug_container.css("display")?"none":"block");else if(d.ctrlKey&&(49==d.keyCode||220==d.keyCode)){var c=$(".sn_log");c.is(":visible")?c.hide():c.show()}_DATA.pressed_key=d.keyCode;if(27==d.keyCode)return $.ui.ddmanager.current&&$("body").trigger("mouseup"),_DATA.win&&"-100000px"!=_DATA.win.win.style.left||"undfined"!=typeof _DATA.block_esc&&
!0===_DATA.block_esc||cgClose(),!1}function global_onmousemove(d,c){_DATA.event=d}function global_onmousedown(){global_onmousemove(event,ui)}function global_onmouseup(d,c){global_onmousemove(d,c)}
function request(d){if(d&&"object"==typeof d&&(d=$.extend({url:"",form:"",keep_in_history:!1,indicator:!0,data:{},send_tree_info:!1,show_indicator_immediately:!1,responseHandler:!1,suppressErrors:/ /,completeHandler:void 0},d),d.url||d.form)){var c=toaGetTargetFromEvent(_DATA.event);if(d.data.targ_el||c!=document)d.data.targ_el=generate_id(d.data.targ_el||c);var b="",c="",e,g,k=d.form;if(d.url)e=!1,/[\\?&]cmd=([^&#]*)/.test(d.url)||/[\\?&]entity_action=([^&#]*)/.test(d.url)||"?doRefresh"===d.url?
c=d.url+MOBILITY_URL_SUFFIX:/[\\?&]controller=([^&#]*)/.test(d.url)?(b=parseUrlParams(d.url),c=b.controller&&b.method?d.url.split("?")[0]+toa.Ajax.prototype.route(b.controller,b.method,b):d.url):c=d.url,b="POST",d.keep_in_history&&(_DATA.content_url=c);else{e=!0;c=k.action.replace(/^https?:\/\/[^\/]*/,"");if(/[\\?&]cmd=([^&#]*)/.test(c)||/[\\?&]entity_action=([^&#]*)/.test(c))c+=MOBILITY_URL_SUFFIX;else if(/[\\?&]controller=([^&#]*)/.test(c)){var b=parseUrlParams(c),l=b.controller,n=b.method;l&&n&&
(c=c.split("?")[0]+toa.Ajax.prototype.route(l,n,b))}b=k.method?k.method.toUpperCase():"POST";k.data&&$.extend(d.data,k.data)}d.indicator&&set_indicator(2,d.show_indicator_immediately);d.data.screen=toa.app.getInstance("dispatchView").currentScreen||_DATA.page_label;void 0===d.data.screen&&(d.data.screen=_DATA.page_label);"setting_users_list"!==d.data.screen||-1===d.url.indexOf("&action=add_user")&&-1===d.url.indexOf("&action=edit_user")||(l={trees:toa.app.trigger("interface.userDetails.getTreeRequestParameters")},
$.extend(d.data,l));"Settingsdisplay"!==d.controller&&toa.app.trigger("global.data.beforeRequest",d.data);if("view_activities"===d.data.screen)switch("undefined"==typeof d.controller&&d.form&&d.form.action&&(l=toa.utils.string.parseQueryString(d.form.action),l.controller&&(d.controller=l.controller)),d.controller){case "Time":d.data.screen+="_time";break;case "Grid":d.data.screen+="_list";break;case "MultidayTime":d.data.screen+="_multidaytime";break;case "Map":d.data.screen+="_map";break;case void 0:break;
default:l=null,(n=toa.app.getInstance("view_activities"))&&n.layout&&!1===n.layout.isSecondPanelVisible?l=toa.app.getInstance("view_activities").panels.top.viewManager:(n=$("#"+d.data.targ_el.replace(/(\|)/g,"\\$1")),n.length&&(g=n.closest(".toa-layout-fit > .toa-twopanel")),g&&1===g.length&&(l=g.hasClass("toa-twopanel-first-panel")?toa.app.getInstance("view_activities").panels.top.viewManager:toa.app.getInstance("view_activities").panels.bottom.viewManager)),l&&("time"===l.currentViewName&&"Provider"!==
d.controller?l.currentViewController.isMultiDayMode()?d.data.screen+="_multidaytime":d.data.screen+="_time":d.data.screen+="_"+l.currentViewName)}if(-1==c.indexOf(p)){var p=GetSessId();d.data[p.substr(0,p.indexOf("="))]=p.substr(p.indexOf("=")+1,p.length-p.indexOf("="))}var s,t=!1;if(e){$("input:file",k).each(function(){if($(this).val())return t=!0,!1});$('[name="p[collab_assigned_user_group]"],[name="p[collab_operator_helpdesk]"]',k).length&&(d.data.ugroups=toa.app.trigger("interface.userDetails.getPreparedUserGroups"));
for(g=0;g<k.elements.length;g++)p=k.elements[g],"file"!=p.type&&""!=p.value&&("radio"!=p.type&&"checkbox"!=p.type||p.checked)&&("date"===p.name&&(p.name="Date"),d.data[p.name]=p.value);d.data=packDataToJSON(d.data);if(t){s=new FormData;$("input:file",k).each(function(){if($(this).val()&&this.files)for(var b=0;b<this.files.length;b++)s.append(this.name,this.files[b])});var u=function(b,e){e=e||[];$.each(b,function(b,c){""!=c&&("object"==typeof c?u(c,e.concat(b)):(b=e.concat(b).map(function(b,e){return e?
"["+b+"]":b}).join(""),s.append(b,c)))})};u(d.data);set_indicator(2)}}else d.data=packDataToJSON(d.data,"packVars");k={type:b,url:c+"&output=ajax",cache:!1,data:s||d.data,dataType:"json",processData:!t,contentType:t?!1:"application/x-www-form-urlencoded",suppressErrors:d.suppressErrors,success:function(b){b&&(isError(b)?processError(d,b):(toa.reloader.clear(),!1!==show_content.apply(window,[b])&&d.responseHandler&&d.responseHandler(b)))},error:d.errorHandler||function(){},complete:d.completeHandler};
null!=d.timeout&&(k.timeout=d.timeout);k=$.ajax(k);d.requestHandler&&d.requestHandler(k,d,c);return k}}function packDataToJSON(d,c){if(!d||void 0!==c&&!d[c]||window._DATA&&window._DATA._debug)return d;var b={},e=function(b,c,d){var n=/^(\-?\w+)\[(\-?\w+)\](.*)$/.exec(b);null!==n?("object"!=typeof c[n[1]]&&(c[n[1]]={}),e(n[2]+n[3],c[n[1]],d)):c[b]=d};$.each(d,function(d,k){d!==c&&e(d,b,k)});return{_ajax_json_packed_data:JSON.stringify(b)}}
function set_indicator(d,c){if("undefined"!=typeof d)switch(d){case 0:_DATA.indicator.hide();break;case 1:_DATA.indicator.error();break;case 4:_DATA.indicator.error(h(18901));break;case 2:_DATA.indicator.loading(c?!1:!0)}}
function show_content(d,c){c&&c.frameElement&&(c.frameElement.requestCompleteSuccess=!0);if(d.logout)return"undefined"!==typeof _IS_MAIN_WINDOW&&window.parent&&parent.window.logout?parent.window.logout():window.logout&&logout(),!1;if(d.reload)return post({reload_main_frame:"yes"}),!1;var b;d.close_win&&close_win();d.mob_entity_action&&(isMobilityAction(d.mob_entity_action.action,d.mob_entity_action)?(d.page_label&&(d.mob_entity_action.page_label=d.page_label),invokeMobilityScreen(d.mob_entity_action)):
toa.app.trigger("interface.actions.click",d.mob_entity_action));if(d.type&&"external"!=d.type&&(d.pid&&d.pid!=toa.app.get("pid")||d.date&&d.date!=toa.app.get("date")||d.page_label&&_DATA.page_label&&d.page_label!=_DATA.page_label&&0!=d.page_label.indexOf("reports_custom_report_")&&0!=_DATA.page_label.indexOf("reports_custom_report_"))&&toa.app.model("pageLabels").findItem(d.page_label))return set_indicator(0),!1;d.remain_hint||d.p||d.hint_actions||hide_hint();d.trees&&toa.app.trigger("global.provider.update",
d);!d.sel_pid||d.page_label&&d.page_label.match(/reports_/g)||toa.app.trigger("global.provider.select",{pid:d.sel_pid});d.content&&$(_DATA.content).html(d.content);d.existingHolidays&&(window.existingHolidays=d.existingHolidays);(d.caption||d.caption_info||d.tabs)&&toa.app.trigger("layout.caption.set",{caption_info:d.caption_info,caption:d.caption,tabs:d.tabs,show:d.tabs_show,filter_content:d.filter_content,filter_params:d.filter_params,filter_js_post_check:d.filter_js_post_check,actions:d.actions,
actionsmd:d.actionsmd,screenName:d.screenName});d.cgClose&&cgClose(d);if(d.tpls){_DATA.tpl_cache||(_DATA.tpl_cache={});_DATA.response=d;for(b in d.tpls)_DATA.response[b]=TrimPath.parseTemplate(_DATA.response.tpls[b].t),d.tpls[b].c&&d.url&&(_DATA.tpl_cache[d.url]||(_DATA.tpl_cache[d.url]={}),_DATA.tpl_cache[d.url][b]=_DATA.response[b]);delete d.tpls;d.url&&delete d.url}var e=d.dont_touch_indicator?!1:!0;if(d.process_by){_DATA.response=d;var g=null;if(d.targ_el)if("object"==typeof d.targ_el)for(b in d.targ_el)g[b]=
get_element(d.targ_el[b]);else g=get_element(d.targ_el);_DATA.targ_el=g;if("object"==typeof d.process_by){for(b=0;b<d.process_by.length;b++)process_by(d.process_by[b]);app.focusToTheLastSelectedElement&&app.focusToTheLastSelectedElement()}else process_by(d.process_by);_DATA.shouldSetFocus&&app.focusToTheLastSelectedElement&&app.focusToTheLastSelectedElement()}runServerSideTriggers(d);contentScrollIE7Fix();if(d.include_js){if("object"==typeof d.include_js)for(b=0;b<d.include_js.length;b+=1)include_js_once(_DATA.resource_folder+
"/module/"+d.include_js[b]+".js");else include_js_once(_DATA.resource_folder+"/module/"+d.include_js+".js");e=!1}d.post_process&&("function"==typeof window[d.post_process]?window[d.post_process].apply(window,[d]):"string"==typeof d.post_process_file&&(include_js_once(d.post_process_file),e=!0));"undefined"!=typeof d.pending_surveys&&"undefined"!=typeof d.surveys&&0!=d.surveys.length&&(_DATA.surveys=d.surveys,_DATA.menu.addSurveyTab());e&&set_indicator(0);_DATA.page_label&&_DATA.page_label.startsWith("company_settings")&&
(b=$("#inner_content"),app.ui.collaborationScreenResizeHelper.makeContentResponsive(b));return!0}function runServerSideTriggers(d,c){if(c||d.trigger){c=c||d.trigger;if($.isArray(c))for(var b=0;d.trigger[b];b++)runServerSideTriggers(d,c[b]);if(toa.isString(c))toa.app.trigger(c,{response:d});else for(b in c){var e=$.extend(c[b]||{},{response:d});toa.app.trigger(b,e)}}}
function contentScrollIE7Fix(){var d=$("#content_content");if(-1!==navigator.appVersion.indexOf("MSIE 7."))if($("#inner_content").attr("innerHTML")){var c=$("#content_table").height(),b=d.height();c>b&&d.css({"overflow-y":"scroll","overflow-x":"hidden"});var e=$("#content_table").width(),g=d.width();e>g&&(d.css("overflow-x","scroll"),c<=b&&d.css("overflow-y","hidden"))}else d.css({"overflow-x":"auto","overflow-y":"auto"})}
function switch_recurrence(d){var c=$(".CGcontent #recurrence").val();cgErrorLayer(d.form).html("&nbsp;");"weekly"==c?($(".CGcontent #period_span").css("display",""),$(".CGcontent #weeks_check").css("display",""),$(".CGcontent #yearly_from").css("display","none"),$(".CGcontent #yearly_to").css("display","none"),$(".CGcontent #period_span").html(h(19201)+'<input size=5 class="pwi5" aria-labelledby="recurrence_lbl recurrence_required" id="recur_every" value="'+$(".CGcontent #recur_every").val()+'" name="p[recur_every]"/> '),
""===$(".CGcontent #recur_every").val()&&$(".CGcontent #recur_every").val("1")):"yearly"==c?($(".CGcontent #period_span").css("display","none"),$(".CGcontent #weeks_check").css("display","none"),$(".CGcontent #yearly_from").css("display",""),$(".CGcontent #yearly_to").css("display",""),"yearly_from"==$(".CGcontent #from_day").parent().parent().attr("id")&&(d=new toa.view.calendar.Datepicker,d.setToday(toa.app.get("today")),d.renderTo(".CGcontent #from_day"),d.addListener("changeDate",function(b,e){$("#from_day_parsed").val(e)})),
"yearly_to"==$(".CGcontent #to_day").parent().parent().attr("id")&&(d=new toa.view.calendar.Datepicker,d.setToday(toa.app.get("today")),d.renderTo(".CGcontent #to_day"),d.addListener("changeDate",function(b,e){$("#to_day_parsed").val(e)}))):"daily"==c?($(".CGcontent #period_span").css("display",""),""===$(".CGcontent #recur_every").val()&&$(".CGcontent #recur_every").val("1"),$(".CGcontent #weeks_check").css("display","none"),$(".CGcontent #yearly_from").css("display","none"),$(".CGcontent #yearly_to").css("display",
"none"),$(".CGcontent #period_span").html(h(18E3)+'<input size=5 class="pwi5" aria-labelledby="recurrence_lbl recurrence_required" id="recur_every" value="'+$(".CGcontent #recur_every").val()+'" name="p[recur_every]"/> ')):($(".CGcontent #period_span").css("display","none"),$(".CGcontent #weeks_check").css("display","none"),$(".CGcontent #yearly_from").css("display","none"),$(".CGcontent #yearly_to").css("display","none"))}
function process_by(d){if($.isFunction(window[d]))window[d].apply(window,[_DATA.response,_DATA.targ_el]);else{_DATA.process_by=d;var c=d.lastIndexOf("_");include_js_once(_DATA.resource_folder+"/module/"+(-1==c?d:d.substr(0,c))+".js")}}
function include_js_once(d,c){if(get_element(d))set_indicator(0);else{"undefined"!=typeof c&&!1===c||show_disabling_cover();var b=document.createElement("script");b.src=d;b.id=d;b.type="text/javascript";document.getElementsByTagName("body")[0].appendChild(b);return b}}
function show_disabling_cover(d,c){_DATA.disabling_cover||(_DATA.disabling_cover=setElement("div",document.querySelector(_DATA.popup_container),{style:{zIndex:c||1E3,display:"none"}}));"undefined"!==typeof _DATA.disabling_cover.style&&"block"==_DATA.disabling_cover.style.display||setElement(_DATA.disabling_cover,null,{style:{display:"block"},class:d?"'nontransparent_disabling_cover'":"'transparent_disabling_cover'"})}
function include_post_processing(){set_indicator(0);_DATA.disabling_cover_timerID&&(clearTimeout(_DATA.disabling_cover_timerID),delete _DATA.disabling_cover_timerID);hide_disabling_cover("transparent_disabling_cover");_DATA.response&&_DATA.process_by&&(process_by(_DATA.process_by),delete _DATA.process_by)}TypeValidator=function(){};TypeValidator.isIntUnsigned=function(d){return/^[0-9]+$/.test(d)&&d==parseInt(d).toString()};TypeValidator.isIntSigned=function(d){return/^-?[0-9]+$/.test(d)&&d==parseInt(d).toString()};
TypeValidator.isIntRange=function(d,c){return!TypeValidator.isIntUnsigned(d)||null!==c.min&&parseInt(d)<parseInt(c.min)||null!==c.max&&parseInt(d)>parseInt(c.max)?!1:!0};TypeValidator.isFloatUnsigned=function(d){return/^(?:[0-9]*\.)?[0-9]+$/.test(d)};TypeValidator.isFloatSigned=function(d){return/^-?(?:[0-9]*\.)?[0-9]+$/.test(d)};TypeValidator.isStringEmpty=function(d){return!/\S+/.test(d)};TypeValidator.isStringEmail=function(d){return toa.app.model("companySettings").validateEmail(d)};
TypeValidator.isStringPhoneNumber=function(d){return toa.app.model("companySettings").validatePhone(d)};TypeValidator.isPointsValid=function(d){return/(^\d{0,4}$)|(^6553[0-5]$)|(^655[0-2][0-9]$)|(^65[0-4]\d{2}$)|(^6[0-4]\d{3}$)|(^[0-5]\d{4}$)/.test(d)};TypeValidator.isDate=function(d){var c=toa.app.model("companySettings").getUser().dateFormats.date;toa&&toa.date&&toa.date.format&&(c=toa.date.format.date);try{var b=toa.date.parseDate(c,d)}catch(e){return!1}return toa.date.formatDate(c,b)!=d?!1:!0};
TypeValidator.isRegexp=function(d,c){if(!c||!c.regexp)return!1;var b=c.regexp,e=b.substr(0,1);return RegExp(b.substr(1,b.lastIndexOf(e)-1),b.substr(b.lastIndexOf(e)+1)).test(d)};
TypeValidator.isUrlWithParams=function(d){d=RegExp("^(?:(?:http|https)\\:\\/\\/)+(?:(?:[A-Za-z0-9]+(?:[A-Za-z0-9-]+[A-Za-z0-9])?\\.)*[A-Za-z]+(?:[A-Za-z0-9-]+[A-Za-z0-9])?|(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3}))(?:\\:(\\d{1,5}))?(?:\\/(?:(?:[A-Za-z0-9$_.+\\-!*'(),;:@&=]|%[0-9A-Fa-f]{2})+(?:\\/(?:[A-Za-z0-9$_.+\\-!*'(),;:@&=]|%[0-9A-Fa-f]{2})+)*\\/?)?(?:\\?(?:[A-Za-z0-9$_.+\\-!*'(),;:@&=]|%[0-9A-Fa-f]{2}|{.+})+)?(?:#(?:[A-Za-z0-9$_.+\\-!*'(),;:@&=]|%[0-9A-Fa-f]{2}|{.+})+)?)?$").exec(d);return!d||
1 in d&&2 in d&&3 in d&&4 in d&&(0>d[1]||255<d[1]||0>d[2]||255<d[2]||0>d[3]||255<d[3]||0>d[4]||255<d[4])?!1:5 in d&&(0>d[5]||65535<d[5])?!1:!0};TypeValidator.isLatitude=function(d){if(!/^-?[0-9]{1,2}(?:\.[0-9]{1,6})?$/.test(d))return!1;d=parseFloat(d);return!isNaN(d)&&90>=Math.ceil(d)&&-90<=Math.floor(d)?!0:!1};TypeValidator.isLongitude=function(d){if(!/^-?[0-9]{1,3}(?:\.[0-9]{1,6})?$/.test(d))return!1;d=parseFloat(d);return!isNaN(d)&&180>=Math.ceil(d)&&-180<=Math.floor(d)?!0:!1};
function isEmpty(d){return/^\s*$/.test(d)}function isSpecial(d){d=d.toString().charCodeAt(0);return 33<=d&&47>=d||58<=d&&64>=d||91<=d&&96>=d||123<=d&&126>=d?!0:!1}function isPositiveInteger(d){d=new String(d);for(var c=0;c<d.length;c+=1)if(!isNumber(d.charAt(c)))return!1;return!0}function isNumber(d){d=d.toString().charAt(0);return"0">d||"9"<d?!1:!0}function isInt(d,c){return"undefined"!=typeof c&&d.length>c||!/^\d+$/.test(d)?!1:!0}
function isFloat(d,c){return"undefined"!=typeof c&&d.length>c||!/^-?((\d+\.\d+)|([0-9]+))$/.test(d)?!1:!0}function isDate(d){var c=d.split("-");if(3==c.length&&isPositiveInteger(c[0])&&isPositiveInteger(c[1])&&isPositiveInteger(c[2])){d=c[0];var b=c[1],c=c[2],e=new Date(d,b-1,c);if(e&&2==b.length&&2==c.length&&4==d.length&&(e.getMonth(),e.getDate(),e.getYear(),c<=days_in_month(b-1,d)))return!0}return!1}
function move_div(d,c,b,e,g,k){d||(d=window.event);_DATA.move_div||(_DATA.move_div={});global_onmousemove(d);k=k||toaGetTargetFromEvent(d);var l=getMouseOffset(k,d),n=element_position(k.offsetParent||k.parentNode),p=k.style.zIndex,s=k.style.backgroundColor,t=k.style.top,u=k.style.left,v=_DATA.disabling_cover&&"block"==_DATA.disabling_cover.style.display;setElementBG(k,null,{style:{zIndex:(parseInt(p)||0)+30,backgroundColor:c?"gray":s}});v||show_disabling_cover(!1,(parseInt(p)||0)+29);document.body.style.cursor=
k.style.cursor;var w=function(c){_DATA.move_div.original_mousemove&&global_onmousemove(c);c={};if("vertically"==b||"both"==b){var d=getEventYInBrowserArea(_DATA.event)-n.y-l.y;c.top=(e?Math.min(Math.max(d,e.miny),e.maxy):d)+"px"}if("horizontally"==b||"both"==b)d=getEventXInBrowserArea(_DATA.event)-n.x-l.x,c.left=(e?Math.min(Math.max(d,e.minx),e.maxx):d)+"px";setElementBG(k,null,{style:c});return!1};$(document).mousemove(w);$(document).one("mouseup",function(b){global_onmouseup(b);v||hide_disabling_cover();
setElementBG(k,null,{style:{zIndex:p,backgroundColor:s}});g&&g(parseInt(k.style.left)-parseInt(u),parseInt(k.style.top)-parseInt(t));document.body.style.cursor="default";$(document).unbind("mousemove",w);return!1});return!1}function getMouseOffset(d,c){d||(global_onmousemove(c),d=toaGetTargetFromEvent(c));var b=element_position(d);return{x:getEventXInBrowserArea(_DATA.event)-b.x,y:getEventYInBrowserArea(_DATA.event)-b.y}}
function element_position(d,c){for(var b=0,e=0,g=!1;(d.offsetParent||d.parentNode)&&(!c||c&&c!=d.id&&c!=d);)b+=d.offsetLeft,e+=d.offsetTop,d=d.offsetParent||d.parentNode,g=!0;!g&&d.offsetLeft&&d.offsetTop&&(b+=d.offsetLeft,e+=d.offsetTop);return{x:b,y:e}}function getEventXInBrowserArea(d){return Math.min(_DATA.screen_size.width,Math.max(0,d.pageX))}function getEventYInBrowserArea(d){return Math.min(_DATA.screen_size.height,Math.max(0,d.pageY))}
function config_show_group_operations(d,c){var b=$("input[name^='l_']:checked").get().length,e;for(e in c)$("#"+e+"_selected").off("click").off("keydown");b?("undefined"!=typeof c["delete"]&&$("#delete_selected").html(r(1201)).on("keydown",function(e){if(13===e.keyCode||32==e.keyCode)e.stopPropagation(),config_show_group_operations_handler("delete",d,c,b),e.preventDefault()}).click(function(e){config_show_group_operations_handler("delete",d,c,b)}),"undefined"!=typeof c.activate&&$("#activate_selected").html(r(10513)).on("keydown",
function(e){if(13===e.keyCode||32==e.keyCode)e.stopPropagation(),config_show_group_operations_handler("activate",d,c,b),e.preventDefault()}).click(function(e){config_show_group_operations_handler("activate",d,c,b)}),"undefined"!=typeof c.dismiss&&$("#dismiss_selected").html(r(8623)).on("keydown",function(e){if(13===e.keyCode||32==e.keyCode)e.stopPropagation(),config_show_group_operations_handler("dismiss",d,c,b),e.preventDefault()}).click(function(e){config_show_group_operations_handler("dismiss",
d,c,b)}),"undefined"!=typeof c.reopen&&$("#reopen_selected").html(r(8624)).on("keydown",function(e){if(13===e.keyCode||32==e.keyCode)e.stopPropagation(),config_show_group_operations_handler("reopen",d,c,b),e.preventDefault()}).click(function(e){config_show_group_operations_handler("reopen",d,c,b)}),"undefined"!=typeof c.deactivate&&$("#deactivate_selected").html(r(10514)).on("keydown",function(e){if(13===e.keyCode||32==e.keyCode)e.stopPropagation(),config_show_group_operations_handler("deactivate",
d,c,b),e.preventDefault()}).click(function(e){config_show_group_operations_handler("deactivate",d,c,b)}),$("#with_selected").html(" "+r(8548,{"{SELECTED_COUNT}":b})),$("#table_selected").show(),$("#from_to_of").hide()):($("#table_selected").hide(),$("#from_to_of").show())}
function config_show_group_operations_handler(d,c,b,e){if("deactivate"==d||"reopen"==d||"dismiss"==d||"activate"==d){var g=b[d][1];b=b[d][0];null==g&&null==b&&(c.elements.with_sel.value=d,request({form:c}));toa.ui.Confirm({text:r(1<e?b:g,{"{COUNT}":e}),acceptButtonHandler:function(){c.elements.with_sel.value=d;request({form:c})}})}else"delete"==d&&(g=b[d][1],b=b[d][0],null==g&&null==b&&(c.elements["delete"]?c.elements["delete"].value=d:c.elements.with_sel.value=d,request({form:c})),toa.ui.Confirm({text:r(1<
e?b:g,{"{COUNT}":e}),acceptButtonHandler:function(){c.elements["delete"]?c.elements["delete"].value=d:c.elements.with_sel.value=d;request({form:c})}}))}function invert_check_box_selection(d,c){for(var b=0;b<d.form.elements.length;b+=1){var e=d.form.elements[b];-1==e.name.indexOf(c)||e.disabled||(e.checked=d.checked)}}function logout(d){"company_login"==_DATA.page_label&&SetCookie("last_menu_label","");post({cmd:"logout"})}
function days_in_month(d,c){return 1==d?0==c%4&&0!=c%100||0==c%400?29:28:1==d%2&&6<d||0==d%2&&7>d?31:30}
function activityCheck(d,c,b,e){if(e=get_element("a_teamid")){if(!e.value||"0"==e.value)return highlight_field(e,!0),{focus_on:e,errors:[r(8066)]};highlight_field(e,!1)}var g=!0;e=d.elements.srepeating;var k=d.elements.smass,l=d.elements["p[recurrence]"],n=d.elements["p[recur_every]"],p=d.elements["p[sun]"],s=d.elements["p[mon]"],t=d.elements["p[tue]"],u=d.elements["p[wed]"],v=d.elements["p[thu]"],w=d.elements["p[fri]"],x=d.elements["p[sat]"],y=d.elements["p[startdate]"],z=d.elements["p[enddate]"],
A=$(d).find("[id^=displaystartdate]"),B=$(d).find("[id^=displayenddate]"),D=toa.app.model("companySettings").getUser().dateFormats.date;if(e&&e.checked){if("undefined"!=typeof c.startdate){var C=!1,F=!1;try{C=toa.date.parseDate(D,A.val()),F=toa.date.formatDate("iso",C)}catch(J){}if(!C||""===A.val()||F<c.startdate.min||F>c.startdate.max)"object"!=typeof g&&(g={errors:[],focus_on:!1}),g.errors.push(r(8038,{"{FIELD}":c.startdate.title})+"\n"),highlight_field(y,!0)}if("undefined"!=typeof c.startdate){var H=
C=!1;try{C=toa.date.parseDate(D,B.val()),H=toa.date.formatDate("iso",C)}catch(K){}if(""===B.val())z.value="";else if(!C||H<c.enddate.min||H>c.enddate.max)"object"!=typeof g&&(g={errors:[],focus_on:!1}),g.errors.push(r(8038,{"{FIELD}":c.enddate.title})+"\n"),highlight_field(z,!0)}y&&(""!==B.val()&&F>H?("object"!=typeof g&&(g={errors:[],focus_on:!1}),g.errors.push(r(8018,{"{FROM}":c.startdate.title,"{TO}":c.enddate.title})+"\n"),highlight_field(y,!0)):(y.value=F,z.value=""===B.val()?"":H,highlight_field(y,
!1)));"weekly"!=l.value||p.checked||s.checked||t.checked||u.checked||v.checked||w.checked||x.checked?highlight_field(l,!1):("object"!=typeof g&&(g={errors:[],focus_on:!1}),g.errors.push(r(8027)+"\n"),highlight_field(l,!0))}p&&e&&!e.onchange&&(e.onchange=e.onclick=function(b,e,c){return function(){get_element("screpeating").style.display=b.checked?"":"none";ActivityRepeatingOrMass(b);cgCheck(e,c,"activityCheck")}}(e,d,c),l.onchange=l.onclick=function(b,e,c){return function(){activityRepeatabilityChange(b);
cgCheck(e,c,"activityCheck")}}(l,d,c),B.bind("blur click change",cgCheck.bind(void 0,d,c,"activityCheck")),A.length&&A.bind("blur click change",cgCheck.bind(void 0,d,c,"activityCheck")));k&&k.checked&&!ElementsNum(_DATA.mass_activity_providers)&&("object"!=typeof g&&(g={errors:[],focus_on:!1}),g.errors.push(r(8017)+"\n"),k.onchange||(k.onchange=k.onclick=function(b,e,c){return function(){get_element("scmass").style.display=b.checked?"":"none";ActivityRepeatingOrMass(b);cgCheck(e,c,"activityCheck")}}(k,
d,c)));if(!0!==g||!d||!b)return g;c=!1;d.elements.templateChangeType&&""!=d.elements.templateChangeType.value||(d.elements.templateChangeType||$('<input type="hidden" name="templateChangeType">').appendTo(d),c=!0,d.elements.templateChangeType.value="allStartingFromToday");if(!_DATA.a_templateid||!(d.elements.smass&&d.elements.smass.checked||d.elements.srepeating&&d.elements.srepeating.checked)||e&&!e.checked)return!0;b=y&&y.defaultValue!=y.value||z&&z.defaultValue!=z.value||l&&defaultValutOfSelect(l)!=
l.value||l&&"daily"==defaultValutOfSelect(l)&&n&&n.defaultValue!=n.value||l&&"weekly"==defaultValutOfSelect(l)&&(n.defaultValue!=n.value||p.defaultChecked!=p.checked||s.defaultChecked!=s.checked||t.defaultChecked!=t.checked||u.defaultChecked!=u.checked||v.defaultChecked!=v.checked||w.defaultChecked!=w.checked||x.defaultChecked!=x.checked);if(!b&&d.data&&d.data.mass_activity_providers){var F={},G;for(G in _DATA.mass_activity_providers_original)F[G]=_DATA.mass_activity_providers_original[G];for(H=0;H<
d.data.mass_activity_providers.length;H+=1)if(G=d.data.mass_activity_providers[H],F[G])delete F[G];else{b=!0;break}!b&&ElementsNum(F)&&(b=!0)}if(b)return!0;if(c)if(_DATA.confirmation)_DATA.templateChangeTypeWin=open_win({win_title:h(8009),html:_DATA.confirmation});else return f.elements.templateChangeType.value="allStartingFromToday",!0;(G=get_element("opallStartingFromToday"))&&!G.onclick&&(G.onclick=function(b){b.elements.templateChangeType.value="allStartingFromToday"}.bind(void 0,d));(G=get_element("opallStartingFromCurrent"))&&
!G.onclick&&(G.onclick=function(b){b.elements.templateChangeType.value="allStartingFromCurrent"}.bind(void 0,d));(G=get_element("oponlyForCurrent"))&&!G.onclick&&(G.onclick=function(b){b.elements.templateChangeType.value="onlyForCurrent"}.bind(void 0,d));b=_DATA.templateChangeTypeWin.getElementsByTagName("form")[0];(G=b.elements.close)&&!G.onmousedown&&(G.onmousedown=function(b){b.elements.templateChangeType.value="";$(b).find("input[class*='ightButton']").removeAttr("disabled");close_win()}.bind(void 0,
d));(G=b.elements.submit)&&!G.onmousedown&&(G.onmousedown=function(b){b.elements.templateChangeType.value=$("input[name='TCT']:checked").val();b.onsubmit();close_win();return!1}.bind(void 0,d));return c?!1:!0}function ActivityRepeatingOrMass(d){d=d.form.elements;var c=d.srepeating&&d.srepeating.checked||d.smass&&d.smass.checked;d["p[position_in_route]"]&&(d["p[position_in_route]"].disabled=c)}
function activityRepeatabilityChange(d){var c=d.form.elements;$(c["p[recur_every]"]).parents("td:eq(0)").prev().html(h("daily"==d.value?18E3:19201));$(c["p[recur_every]"]).parents("td:eq(0)").html('<input type="text" class="pwi5" value="'+c["p[recur_every]"].value+'" name="p[recur_every]"/> ');d="daily"==d.value?"none":"";$(c["p[sun]"]).parents("tr:eq(0)").css("display",d);$(c["p[mon]"]).parents("tr:eq(0)").css("display",d);$(c["p[tue]"]).parents("tr:eq(0)").css("display",d);$(c["p[wed]"]).parents("tr:eq(0)").css("display",
d);$(c["p[thu]"]).parents("tr:eq(0)").css("display",d);$(c["p[fri]"]).parents("tr:eq(0)").css("display",d);$(c["p[sat]"]).parents("tr:eq(0)").css("display",d)}function defaultValutOfSelect(d){for(var c=0;c<d.options.length;c+=1)if(d.options[c].defaultSelected)return d.options[c].value;return!1}
function recurrenceCheck(d,c,b){d={errors:[],focus_on:!1};c=$("input[name='p[start_date]']").val();var e=$("input[name='p[end_date]']").val(),g=$("input[name='p[from_day_parsed]']").val(),k=$("input[name='p[to_day_parsed]']").val(),l=$("input[name='p[recur_every]']").val(),n=$("select[name='p[recurrence]']").val(),p=$("input[name='p[points]']").val();if("undefined"!=typeof p&&""!=p&&!TypeValidator.isPointsValid(p))return{errors:[h(17940)],focus_on:!1};if(null!=c&&null!=e&&""!=e&&c>e)return{errors:[r(11200)],
focus_on:!1};if(null!=n&&"yearly"==n&&(""==g||""==k))return{errors:[r(11202,{"{START_DAY}":r(11189),"{END_DAY}":r(11190)})],focus_on:!1};if("yearly"==n&&g>k)return{errors:[r(8018,{"{FROM}":r(11189),"{TO}":r(11190)})],focus_on:!1};if(null!=n&&"weekly"==n&&""==l)return{errors:[r(11203)],focus_on:!1};if(null!=n&&"daily"==n&&""==l)return{errors:[r(19207)],focus_on:!1};if(("daily"==n||"weekly"==n)&&""!=l&&"0"===l)return{errors:[r(8038,{"{FIELD}":r(11141)})],focus_on:!1};if("undefined"!=typeof l&&""!=l&&
!TypeValidator.isIntUnsigned(l))return{errors:[r(808,{"{FIELD}":r(11141)})],focus_on:!1};if(null!=n&&"weekly"==n){c=[$("input[name='p[sun]']").prop("checked"),$("input[name='p[mon]']").prop("checked"),$("input[name='p[tue]']").prop("checked"),$("input[name='p[wed]']").prop("checked"),$("input[name='p[thu]']").prop("checked"),$("input[name='p[fri]']").prop("checked"),$("input[name='p[sat]']").prop("checked")];e=!1;for(g=0;g<c.length;g++)if(!1!=c[g]){e=!0;break}if(!e)return{errors:[r(8027)],focus_on:!1}}return 100==
$("select[name='p[non_working_reason_id]']").val()&&""==$("input[name='p[comments]']").val()?{errors:[r(11206)],focus_on:!1}:b?!0:d}function shifts_shift_type_change(d){d=$("select[name='p[shift_type]']").val();null!=d&&"on-call"==d?$("input[name='p[points]']").attr("readonly",!0):$("input[name='p[points]']").attr("readonly",!1)}
function setting_calendars_reason_change(){var d=$("select[name='p[non_working_reason_id]']").val();null!=d&&100==d?$("input[name='p[comments]']").parent().parent().children().first().html("*"):$("input[name='p[comments]']").parent().parent().children().first().html("")}function parseUrlParams(d){var c={};d.replace(/([^?=&]+)(=([^&]*))?/g,function(b,e,d,k){c[e]=k});return c}
function refresh(d){toa&&(toa.isFrameworkPageLabel(_DATA.page_label)||"doRefresh"==_DATA.content_url||"undefined"==typeof _DATA.content_url)?toa.app.trigger("global.interface.refresh",{manual:!0}):(d=_DATA.content_url+("reports_dashboard"==_DATA.page_label?"&refresh=1":"")+(d?"&popup_message="+escape(d):""),window.setTimeout(request.bind(window,{url:d}),1))}function search_redirect(d,c,b){toa.app.trigger("search.provider.load",{pid:d,date:c,aid:b})}
function exportRequest(d,c,b){c=c||"";if("string"==typeof d)url=d+"&"+anticache();else if("controller"in d&&"method"in d&&d.controller&&d.method){if(url="m="+d.controller+"&a="+d.method+"&"+MOBILITY_TYPE_VALUE,"getCsvResources"==d.method||"getCsvActivities"==d.method)c=decodeURIComponent($.param({params:c}))}else"cmd"in d&&"sub"in d&&d.cmd&&d.sub&&(url="cmd="+d.cmd+"&sub="+d.sub+MOBILITY_URL_SUFFIX),"wz_action"in d&&d.wz_action&&(url=url+"&wz_action="+d.wz_action),"do"in d&&d["do"]&&(url=url+"&do="+
d["do"]);download_file("?"+url+"&"+c)}function checkUrlParams(d){return d="?"===d.substring(0,1)?d:"?"+d}
function post(d,c,b,e){var g=setElement("form",document.body,{style:{display:"none"}});g.method="POST";g.action=c||window.location.protocol+"//"+window.location.host+window.location.pathname;g.action="controller"in d&&"method"in d&&d.controller&&d.method?g.action+"?m="+d.controller+"&a="+d.method+"&"+MOBILITY_TYPE_VALUE:g.action+MOBILITY_URL_SUFFIX.replace(/^&/,"?");b&&(g.target=b);var k;e||$('<input type="hidden" name="'+_DATA.sessid.substr(0,_DATA.sessid.indexOf("="))+'" value="'+_DATA.sessid.substr(_DATA.sessid.indexOf("=")+
1,_DATA.sessid.length-_DATA.sessid.indexOf("="))+'">').appendTo(g);for(k in d)"object"==typeof d[k]?$.each(d[k],function(){$('<input type="hidden" name="'+k+'[]" value="'+this+'">').appendTo(g)}):$('<input type="hidden" name="'+k+'" value="'+d[k]+'">').appendTo(g);g.submit();g.parentNode.removeChild(g)}function exportError(){toa.ui.Alert({text:h(22943,{"{EXPORT_LIMIT}":"25,000"})})}
function close_win(){is_win_opened()&&(_DATA.win.need_relogin_form_appeared&&(_DATA.win.need_relogin_form_appeared=null),setElementBG(_DATA.win.win,null,{style:{left:"-100000px"}}),_DATA.win.disabling_cover&&setElement(_DATA.win.disabling_cover,null,{style:{display:"none"}}),_DATA.win.opened=!1,toa.view.Header.setEnable())}function is_win_opened(){return _DATA.win&&_DATA.win.opened}function nopen(d,c,b,e,g){d+=MOBILITY_URL_SUFFIX;return wopen(d,c,b,"yes","yes",e,g)}
function mopen(d,c,b,e,g){/[\\?&]cmd=([^&#]*)/.test(d)&&(d+=MOBILITY_URL_SUFFIX);_DATA.openRequests||(_DATA.openRequests=[]);if(-1==_DATA.openRequests.indexOf(d))return _DATA.openRequests.push(d),setTimeout(function(){var b=_DATA.openRequests.indexOf(d);-1!=b&&_DATA.openRequests.splice(b,1)},1E4),wopen(d,c,b,"no","no",e,g)}
function mopenInDiv(d,c,b,e){var g="undefined"===typeof _IS_MAIN_WINDOW&&"undefined"!=typeof window.parent.toa?window.parent:window,k=g.toa.app;/[\\?&]cmd=([^&#]*)/.test(d)&&(d+=MOBILITY_URL_SUFFIX);_DATA.openRequests||(_DATA.openRequests=[]);-1==_DATA.openRequests.indexOf(d)&&(_DATA.openRequests.push(d),setTimeout(function(){var b=_DATA.openRequests.indexOf(d);-1!=b&&_DATA.openRequests.splice(b,1)},2E3),$.ajax({url:d,cache:!1,success:function(d,n){var p={xtype:"dialog",title:d.title||"Title",layout:"none",
name:"form",width:b,height:c,topWindow:g,bottomPanel:{items:[{},{value:e?e:r(22)},{value:d.actionButton||"Add",addClass:e?"toa-hidden":""}]},listeners:{ok:function(){var b=$(".opened-tmp-dialog form");b.trigger("submit");setTimeout(function(){1<=$(".configuration_form_error_alert").length||mopenSendForm(b,_DATA.openedForm)},200)},dialogclose:function(){_DATA.openedForm.close();_DATA.openedForm.destroy()},keydown:function(b){13==b.keyCode&&"TEXTAREA"!==b.target.tagName&&(_DATA.openedForm.input.trigger("ok",
self,b),b.preventDefault())}},attr:{class:"jet-css-only opened-configuration-dialog "+(d.class?d.class:"")}};_DATA.openedForm=toa.formBuilder(p);k.on({event:"interface.popup.close",handler:function(b,e,c){_DATA.openedForm.close();c.owner.stopPropagation()},owner:k,order:"first"});k.on({event:"interface.popup.contentResize",handler:_DATA.openedForm.contentResizeCallback,owner:_DATA.openedForm});_DATA.openedForm.renderTo("body");$(".opened-configuration-dialog").append(d.content);_DATA.openedForm.open()},
error:function(b){toa.ui.Alert({text:"Error<br><br>"+b.message,popup_extra_css_class:"configuration_form_error_alert"})}}))}
function mopenSendForm(d,c){var b=d.attr("action");d.serialize();$.ajax({type:"POST",url:b,data:new FormData(d[0]),cache:!1,processData:!1,contentType:!1,success:function(b,d){if(b.error){var k=b["error-msg"]||b.error,l=$(".opened-configuration-dialog").parent().find(".ui-dialog-buttonpane span[name=errors]");k.match(/^\<li\>/)?l.html("<ul>"+k+"</ul>"):l.text(k)}else if(b.close_win&&(c.close(),$(".filter_form > button").trigger("click"),c.destroy(),"undefined"!==typeof popupTemporaryData)){for(k in popupTemporaryData)k.match(/^interval_/g)&&
clearInterval(popupTemporaryData[k]),popupTemporaryData[k]=null,delete popupTemporaryData[k];popupTemporaryData=void 0}},error:function(b){toa.ui.Alert({text:r(232)+"<br><br>"+b.message,popup_extra_css_class:"configuration_form_error_alert"})}})}
function move_value(d,c,b,e){c=d.elements[c];d=d.elements[b];if(-1!=c.selectedIndex&&!c.options[c.selectedIndex].disabled){b=0;for(var g=document.createDocumentFragment();c.options[b];)c.options[b].selected?(c.options[b].selected=!1,g.appendChild(c.options[b])):b++;d.appendChild(g);if(d.form&&e&&d.form[e])for($("input[name^="+e+"]",d.form).remove(),d.form.data||(d.form.data={}),d.form.data[e]={},c=d.form[e],b=0;b<c.length;b++)d.form.data[e][c.options[b].value]=c.options[b].value}}
function wopen(d,c,b,e,g,k,l,n){var p="undefined"===typeof _IS_MAIN_WINDOW&&"undefined"!=typeof window.parent.toa?window.parent:window,s=p.toa.app;e=p.document.querySelector(_DATA.dispatcher_container);var t=null,u=p.toa.formBuilder({xtype:"windowIframe",title:n||"",layout:"none",width:b,height:c,openerWindow:window,topWindow:p,url:d,sid:p._DATA.sessid,listeners:{dialogclose:function(b){b.stopPropagation();u.destroy();s.unbind("interface.popup.close",v,s);s.unbind("interface.popup.contentResize",
u.contentResizeCallback,u);$(p).unbind("resize",w);toa.view.Header.setEnable()},dialogdragstart:function(){var b=u.getElement();t=$("<div>").css({position:"absolute",top:0,bottom:0,left:0,right:0}).prependTo(b)},dialogdragstop:function(){t&&(t.remove(),t=null)},handleEventEnter:function(b,e){s.trigger("system.glossaryEdit.handleEventEnter",e)},checkEditState:function(b,e){s.trigger("system.glossaryEdit.checkEditState",e)}}}),v=function(b,e,c){u.close();c.owner.stopPropagation()},w=u.windowResizeCallback.bind(u);
s.on({event:"interface.popup.close",handler:v,owner:s,order:"first"});s.on({event:"interface.popup.contentResize",handler:u.contentResizeCallback,owner:u});$(p).on("resize",w);u.renderTo(e);return u}function addEvent(d,c,b,e){c.attachEvent?c.attachEvent("on"+d,b):c.addEventListener?c.addEventListener(d,b,e):c["on"+d]=b}
function toggleManageContent(d){$(_DATA.dispatcher_container).mousedown();var c=JSON.parse($app.model().accessScreen()._accessScreenSource._currentScreen);d?($("#content-manage-container").show(),$("#jbf-container-body").hide(),!$("body #__oj_zorder_container").length&&$("body").append('<div id="__oj_zorder_container" role="presentation"></div>')):(-1===_DATA.dispatcher_screens.indexOf(c.module)&&($("#content-manage-container").hide(),$("#jbf-container-body").show()),$("body #__oj_zorder_container").remove())}
function processError(d,c){var b=!0;"function"==typeof d.errorHandler&&(b=d.errorHandler(c));!1!==b?defaultErrorHandler(c):set_indicator(0)}
function defaultErrorHandler(d){if(d.operation_is_not_permited)set_indicator(0),toa.ui.Alert({text:h(5516)});else if(d.feature_is_unavailable)set_indicator(0),toa.ui.Alert({text:h(22402)});else if(d.kernel_error)if("undefined"!==typeof d.put_cover_to){var c=$(d.put_cover_to);closeAllPopups();c.ScreenCover();c.ScreenCover("show",d.kernel_error);set_indicator(0);toa.reloader.set();toa.app.trigger("layout.tabs.set",{tabs:0,show:0})}else toa.ui.Alert({text:d.kernel_error}),set_indicator(0);else!0===d.incompleteCaches&&
set_indicator(4)}
function setupDrag(){function d(b,e){(toa.browser.isIpad||toa.browser.isIE9||toa.dom.isTouch)&&document.elementFromPoint&&(b.target=document.elementFromPoint(b.originalEvent.clientX,b.originalEvent.clientY),b.originalEvent.target=b.target);var c=$(b.target),d=c.parents(":data(ui-droppable)");c.data("ui-droppable")&&d.add(c);d.each(function(c,d){var g=$(d).data("ui-droppable");g&&g.accept(e.helper)&&g._trigger("dragmove",b,e)})}$.ui.plugin.add("draggable","dragmove",{drag:d});var c=$.ui.sortable.prototype._mouseDrag;
$.ui.sortable.prototype._mouseDrag=function(b){var e=this._uiHash();e.position={left:b.pageX,top:b.pageY};d.call(this,b,e);return c.apply(this,arguments)};$.ui.plugin.add("draggable","dropIntoUpper",{start:function(b,e){var c=$(this).data("uiDraggable").options;c&&c.scope&&$.ui.ddmanager&&$.ui.ddmanager.droppables&&$.ui.ddmanager.droppables[c.scope]&&$.ui.ddmanager.droppables[c.scope].sort(function(b,e){var c=parseInt(b.element.css("zIndex"),10)||0,d=parseInt(e.element.css("zIndex"),10)||0;if(c>=
d)return-1;if(c<d)return 1})}});$.ui.draggable.prototype.options.safariSelectFix=!0;$.ui.plugin.add("draggable","safariSelectFix",{start:function(b,e){$("html").css("-webkit-user-select","none")},stop:function(b,e){$("html").css("-webkit-user-select","auto")}})}
function closeAllPopups(){hide_hint();toa.app.trigger("global.hint.hide");close_win();toa.app.trigger("interface.popup.close");toa.app.trigger("interface.contentGenerator.close");$(".ui-dialog").not(".sn_chat").find(".ui-dialog-content").dialog("close")}
function ajaxForm(d,c){if(!d)return!1;c=$.extend({},{url:null,data:{},indicator:!0,show_indicator_immediately:!0,responseHandler:!1,errorHandler:!1,requestHandler:!1},c);var b=toaGetTargetFromEvent(_DATA.event);if(c.data.targ_el||b!=document)c.data.targ_el=generate_id(c.data.targ_el||b);var b=d.method?d.method.toUpperCase():"POST",e=d.action?d.action:"",e=c.url?c.url:e;if(/[\\?&]cmd=([^&#]*)/.test(e))e+=MOBILITY_URL_SUFFIX;else if(/[\\?&]controller=([^&#]*)/.test(e)){var g=parseUrlParams(e),k=g.controller,
l=g.method;k&&l&&(e=e.split("?")[0]+toa.Ajax.prototype.route(k,l,g))}var n=new FormData(d);n.append("screen",toa.app.getInstance("dispatchView").currentScreen);g=GetSessId();n.append(g.substr(0,g.indexOf("=")),g.substr(g.indexOf("=")+1,g.length-g.indexOf("=")));$.each(c.data,function(b,e){n.append(b,e)});c.indicator&&_DATA.indicator.loading(!c.show_indicator_immediately);toa.app.trigger("global.data.beforeRequest",c.data);b=$.ajax({type:b,url:e+"&output=ajax",data:n,cache:!1,dataType:"json",contentType:!1,
processData:!1,success:function(b,e){isError(b)?processError(c,b):(toa.reloader.clear(),!1!==show_content.apply(window,[b])&&c.responseHandler&&c.responseHandler(b,e))},error:c.errorHandler||function(){}});c.requestHandler&&c.requestHandler(b,c,e);return b}function ignoreSpaces(d){var c="";d=(""+d).split(" ");for(var b=0;b<d.length;b+=1)c+=d[b];return c}function isMobilityApp(){try{return _DATA&&_DATA.is_mobility_app}catch(d){}return!1}
function isMobilityAction(d,c){try{c=c||{};var b=c.actionOptions||{};d=b.baseLabel||d||"";if(isMobilityApp()&&"object"===typeof _DATA.activity_actions&&Boolean(_DATA.activity_actions[d])||"form_link"===b.type)return!0}catch(e){console&&console.error(e)}return!1}
function invokeMobilityScreen(d,c){app.DebugLogger.isDebugEnabled("performance")&&$app.model().performanceService().createMark("invoke_mobility");_DATA.isDispatcherNavigation=!c;var b=createActionUrl(d)+(d.page_label?"/label="+d.page_label:"")+(d.date?"/__date="+d.date:"")+(d.dates?"/__dates="+d.dates:"")+(d.pid?"/__pid="+d.pid:"")+(d.panel?"/__panel="+d.panel:"")+(d.currentView?"/__view="+d.currentView:"");$app.navigation().redirect(b)}
function displayChildResourceForm(d){ApiLayer=require("jbf/core/api-layer");var c=ApiLayer.requireSync("api-app",1);d="#resourceUser/add?org_unit="+d+"&redirectToBaseScreen=true";try{c.getMobilityAppInstance().controller().redirect(d,!0)}catch(b){c.getMobilityAppInstance().errorHandler().handleErrorEvent(b)}}
function createActionUrl(d){var c=d.actionOptions||{},b=c.baseLabel||d.action,e=_DATA.activity_actions[b],g="",g="number"===typeof d.aid&&0!==d.aid?String(d.aid):d.aid?d.aid.split("|")[0]:"";c.parameters=c.parameters||[];d.date===app.context.DAY_WITHOUT_DATE&&Array.prototype.push.apply(c.parameters,[{field:"target_date",value:d.date},{field:"dispatch_non_scheduled",value:1}]);d=(c.parameters||[]).length&&"/predefineProperties="+encodePredefinedProperties(c.parameters)||"";return"form_link"===c.type?
"#m=form/a=form/label="+b+d+(g&&"/aid="+g||""):e+g+d}function encodePredefinedProperties(d){return encodeURIComponent(JSON.stringify(d.reduce(function(c,b){c[b.field]=b.value;return c},{})))}function mailto(d){if(""===d)toa.ui.Alert({text:h(8044)});else{hide_hint();try{document.location="mailto:"+encodeURIComponent(d)}catch(c){}}}
function trimLongHash(d,c){var b={},e=0;c=c||2E3;if(toa.isObject(d)&&$.param(d).length>c){for(var g in d)e++;c=Math.round(c/e);for(g in d)toa.isObject(d[g])&&$.param(d[g]).length>c&&(b[g]=d[g],delete d[g])}return{src:d,cut:b}}function callto(d){if(""===d)toa.ui.Alert({text:h(8043)});else{hide_hint();try{document.location="callto:"+encodeURIComponent(d)}catch(c){}}}
(function(d){if("undefined"!==typeof d){for(var c=(new Date).getTime(),b="mousemove keydown wheel mousedown touchstart touchmove".split(" "),e=function(b){d.addEventListener(b,function(){c=(new Date).getTime()})},g=0;g<b.length;g++)e(b[g]);var k=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.send=function(){5E3<(new Date).getTime()-c&&this.setRequestHeader("X-OFSC-BACKGROUND-PROCESS","1");k.apply(this,arguments)}}})(window);
function sendFromSendToCheck(d,c,b){if(d.elements["p[mqsendfrom_minutes]"])return b?!0:!1;c=parseInt(d.elements["p[mqsendfrom_minutes]"].value,10);var e=d.elements["p[mqsendfrom]"].value+" "+d.elements["p[mqsendfrom_hours]"].value+":"+(10>c?"0"+c:c)+":00";c=parseInt(d.elements["p[mqsendto_minutes]"].value,10);if(d.elements["p[mqsendto]"].value+" "+d.elements["p[mqsendto_hours]"].value+":"+(10>c?"0"+c:c)+":00">=e)return b?!0:!1;highlight_field(d.elements["p[mqsendfrom_dumb]"],!0);return{errors:[r(8018,
{"{FROM}":r(7328),"{TO}":r(7329)})],focus_on:!1}}
function open_win(d){if(!_DATA.win){var c=1010;d.need_relogin&&(c+=9E3);_DATA.win={disabling_cover:setElement("div",document.querySelector(_DATA.popup_container),{class:"'transparent_disabling_cover'",style:{zIndex:c-1,display:"none"}}),win:setElementBG("div",document.querySelector(_DATA.popup_container),{class:"'CG'",style:{left:"-100000px",zIndex:c}})};_DATA.win.win.innerHTML='<div class="CGbevel"></div>';_DATA.win.title=setElement("h1",_DATA.win.win,{class:"'CGtitle'"},{mousedown:function(b){move_div(b,
!1,"both",!1,!1,_DATA.win.win)}});_DATA.win.form=setElement("form",_DATA.win.win,{class:"'CGform'",id:"'"+generate_id()+"'"});setElement("div",_DATA.win.win,{class:"'CGbevel'"})}_DATA.win.form.action=d.action?d.action:"?";_DATA.win.form.method="post"==d.method?"post":"get";_DATA.win.form.onsubmit=request.bind(void 0,{form:_DATA.win.form});"-100000px"==_DATA.win.win.style.left&&(_DATA.win.win.style.width=_DATA.win.win.style.height="");_DATA.win.disabling_cover.style.display="block";_DATA.win.title.innerHTML=
d.win_title||"&nbsp;";_DATA.win.form.innerHTML=d.html;var c=_DATA.screen_size,b=d.width||_DATA.win.win.offsetWidth,e=d.height||_DATA.win.win.offsetHeight;("-100000px"==_DATA.win.win.style.left||d.PutOnCenter)&&setElementBG(_DATA.win.win,null,{style:{left:parseInt(""+(c.width-b)/2)+"px",top:parseInt(""+(c.height-e)/2)+"px",height:e+"px",width:b+"px"}});for(c=0;c<_DATA.win.form.elements.length;c+=1)if(("text"==_DATA.win.form.elements[c].type||"password"==_DATA.win.form.elements[c].type)&&""===_DATA.win.form.elements[c].value){_DATA.win.form.elements[c].focus();
break}_DATA.win.opened=!0;d.need_relogin?(_DATA.win.need_relogin_form_appeared||toa.view.Header.setDisable(),_DATA.win.need_relogin_form_appeared=d.need_relogin):(_DATA.win.need_relogin_form_appeared=null,toa.view.Header.setDisable());return _DATA.win.win}function format_hint(d,c){show_hint({event:d,html:'<div class="normal_">'+c+"</div>",delay:1E3})}
function touchTrigger(d,c){var b=document.createEvent("MouseEvent");b.initMouseEvent(d,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,c.target||null);c.target.dispatchEvent(b)}
function loadTabToMobility(d){if(d){var c=$("#content").empty(),b=new toa.Template('<div id="legacy-manage-container"><div id="legacy-content-manage-container"><div class="card"><div class="card-content" id="<%=page_label%>"><% if ( tab_title_addition ) {%><div class="tab_title"><%=tab_title_addition%></div><%}%><% if ( tab_content ) {%><div class="tab_content toa-grid"><%=tab_content%></div><%}%></div></div></div></div>');c.append(b.apply({tab_title_addition:d.tab_title_addition?d.tab_title_addition:
"",tab_content:d.tab_content?d.tab_content:"",page_label:d.page_label?d.page_label:""}));c.find('input[type="button"]').addClass("button inline");c.find('select, input[type="text"]').addClass("form-item");c.find("#legacy-content-manage-container").show();$("#content").off().on("mousedown",".span_details_link",function(b){b=$(b.target);b={aid:b.attr("data-aid"),pid:b.attr("data-pid"),date:b.attr("data-date"),action:"change_activity"};invokeMobilityScreen(b,!0)})}}
function getActivityTabSettings(d,c,b){var e=$app.model().provider().get("pid"),g=b.getParameter("aid"),k=$app.model().queue().get("date"),l="?cmd="+c+"&date="+k+"&pid="+e+"&aid="+g+"&context=web_set_activity&m=command&a=index&itype=manage&output=ajax",n=$app.model().accessScreen()._accessScreenSource._currentScreen;return{data:{screen:"change_activity"},success:function(b,e,c){if(b.include_js||n===$app.model().accessScreen()._accessScreenSource._currentScreen)if(processByMobility(b,b.include_js?
_DATA.resource_folder+"/module/"+b.include_js+".js":""),"activity_links"===b.page_label){var d={name:"ActivityLinks",label:"activity_link",title:"ActivityLinks",selector:"#legacy-content-manage-container .card-content"};$("#back-button").on("click",function(b){b.preventDefault();b.stopPropagation();require(["loader","SignalEmitter"],function(b,e){b.detachModule()})});require(["loader","SignalEmitter"],function(e,c){e.run(d);console.debug("ActivityLinks: loader run");b.url=l;c.dispatch("setActivityLinksData",
b,!0);console.debug("ActivityLinks: Dispatch signal - setActivityLinksData")})}},error:function(e){d.setVars({text:b.getParameter("text")})},url:l,async:!1}}
function getMobilePrintQueueSettings(d,c,b){c=$app.model().provider().get("pid");var e=$app.model().queue().get("date"),g=b.getParameter("__dates"),k=b.getParameter("__panel"),l=b.getParameter("__view");c="?pid="+c+"&date="+e+"&page=view_activities&dates%5B%5D="+g+"&panel="+k+"&view="+l+"&entity_action=print_queue&m=command&a=index&itype=manage";var n=$app.model().accessScreen()._accessScreenSource._currentScreen;return{data:{screen:"view_activities"},success:function(b,e,c){(b.include_js||n===$app.model().accessScreen()._accessScreenSource._currentScreen)&&
processByMobility(b,b.include_js?_DATA.resource_folder+"/module/"+b.include_js+".js":"")},error:function(e){d.setVars({text:b.getParameter("text")})},url:c,async:!1}}
function processByMobility(d,c){"function"===typeof window.loadTabToMobility&&loadTabToMobility(d);if("string"===typeof c)if(get_element(c))"string"===typeof d.process_by&&"function"===typeof window[d.process_by]&&window[d.process_by].apply(window,[d]);else{var b=document.createElement("script");b.src=c;b.id=c;b.type="text/javascript";document.getElementsByTagName("body")[0].appendChild(b);"string"===typeof d.process_by&&(b.onload=function(){"function"===typeof window[d.process_by]&&window[d.process_by].apply(window,
[d])})}}function getScreenName(){var d={view_activities:19924,routing_run_list:23201,forecasting:6338}[_DATA.page_label],c="",d=d?$app.model().i18n().__(d)+" | ":"";return c=window.isReportsScreen?'<button class="dashboardBackButton" title="'+$app.model().i18n().__(16257)+'">'+$app.model().i18n().__(20812)+" | </button>":'<span class="screenHeading">'+d+"</span>"}
function getMobilityDateFormat(d,c,b){var e=toa.app.model("companySettings").settings.user.dateFormats.date_long;switch(e){case "Y/m/d l":e="Y/m/d";break;case "l, F jS, Y":e=c?"M jS, Y":b?"M jS":"jS";break;case "l d F Y":e=c?"d M Y":b?"d M":"d"}return toa.date.formatDate(e,d)}
$.fn.changeDateFormat=function(){var d=!1,c=toa.app.model("companySettings").settings.user.tz_diff,b=toa.datetime.create(toa.datetime.currentDate(c).getTimestamp()).getFullYear(),c=$(".toa-twopanel-horizontal").width();if(window.innerWidth<RESPONSIVE_WIDTH.TAB||c<RESPONSIVE_WIDTH.TAB)d=!0;return this.each(function(){var e=$(this).attr("data-calendar-min-date"),c=$(this).attr("data-calendar-max-date"),k=$(this).attr("data-calendar-mode"),l;if(e===toa.date.DAY_WITHOUT_DATE)$(this).text(h(8203));else if("day"!==
k&&c&&e!==c){e=toa.date.parseDate("iso",e);c=toa.date.parseDate("iso",c);l=e.getFullYear();var n=c.getFullYear();l=!d&&(l!==b||n!==b);n=e.getMonth()!==c.getMonth();e=getMobilityDateFormat(e,l,!0);c=getMobilityDateFormat(c,l,n);"custom"===k?$(this).text(e+" ... "+c):$(this).text(e+" - "+c)}else e=toa.date.parseDate("iso",e),l=e.getFullYear(),l=l!==b,e=d?getMobilityDateFormat(e,l,!0):toa.date.formatDate("date_long",e),$(this).text(e)})};(function(d){d.widget("ui.edSortable",d.ui.mouse,{widgetEventPrefix:"sort",options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1E3,smoothList:!1,smoothClass:!1,staticItems:!1,listOuterContainer:!1},_isOverAxis:function(c,b,e){return c>=
b&&c<b+e},_create:function(){var c=this.options;this.containerCache={};this.element.addClass("ui-sortable");this.smoothList=c.smoothList;this.smoothClass=c.smoothClass;this.staticItemsSelector="undefined"!=typeof c.staticItems.outerContainer?c.staticItems.outerContainer:c.staticItems;this.staticItems=d(this.staticItemsSelector);this.staticItemsInnerSelector="undefined"!=typeof c.staticItems.innerContainer?c.staticItems.innerContainer:!1;this.listOuterContainer=c.listOuterContainerSelector?d(c.listOuterContainerSelector):
d(this.element).parent();this.levelCheck=c.levelCheck?!0:!1;this.levelCheckWrongClass=c.levelCheckWrongClass?c.levelCheckWrongClass:!1;this.refresh();this.floating=this.items.length?/left|right/.test(this.items[0].item.css("float")):!1;this.offset=this.element.offset();this._mouseInit()},destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").removeData("edSortable").unbind(".edSortable");this._mouseDestroy();for(var c=this.items.length-1;0<=c;c--)this.items[c].item.removeData("sortable-item");
return this},_setOption:function(c,b){"disabled"===c?(this.options[c]=b,this.widget()[b?"addClass":"removeClass"]("ui-sortable-disabled")):d.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(c,b){if(this.reverting||this.options.disabled||"static"==this.options.type)return!1;this._refreshItems(c);var e=null,g=this;d(c.target).parents().each(function(){if(d.data(this,"sortable-item")==g)return e=d(this),!1});d.data(c.target,"sortable-item")==g&&(e=d(c.target));if(!e)return!1;
if(this.options.handle&&!b){var k=!1;d(this.options.handle,e).find("*").addBack().each(function(){this==c.target&&(k=!0)});if(!k)return!1}this.currentItem=e;this._removeCurrentsFromItems();return!0},_mouseStart:function(c,b,e){b=this.options;this.currentContainer=this;this.refreshPositions();this.helper=this._createHelper(c);this._cacheHelperProportions();this._cacheMargins();this.scrollParent=this.helper.scrollParent();this.offset=this.currentItem.offset();this.offset={top:this.offset.top-this.margins.top,
left:this.offset.left-this.margins.left};this.helper.css("position","absolute");this.cssPosition=this.helper.css("position");d.extend(this.offset,{click:{left:c.pageX-this.offset.left,top:c.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this._generatePosition(c);this.originalPageX=c.pageX;this.originalPageY=c.pageY;b.cursorAt&&this._adjustOffsetFromHelper(b.cursorAt);this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]};
this.helper[0]!=this.currentItem[0]&&this.currentItem.hide();this._createPlaceholder();b.containment&&this._setContainment();b.cursor&&(d("body").css("cursor")&&(this._storedCursor=d("body").css("cursor")),d("body").css("cursor",b.cursor));b.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",b.opacity));b.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",b.zIndex));this.scrollParent[0]!=
document&&"HTML"!=this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset());this._trigger("start",c,this._uiHash());this._preserveHelperProportions||this._cacheHelperProportions();if(!e)for(e=this.containers.length-1;0<=e;e--)this.containers[e]._trigger("activate",c,this._uiHash(this));d.ui.ddmanager&&(d.ui.ddmanager.current=this);d.ui.ddmanager&&!b.dropBehaviour&&d.ui.ddmanager.prepareOffsets(this,c);this.dragging=!0;this.helper.addClass("ui-sortable-helper");this._mouseDrag(c);
this.refreshPositions();return!0},isOverItem:function(c){return("x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,c.top,c.height))&&("y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,c.left,c.width))},isOverCurrentStatic:function(c){var b=this.listOuterContainer[0],e=this.currentItem[0],g=!1;if(c==e)return!0;d(c).parents(this.staticItemsSelector).each(function(){if(this==b[0])return!1;if(this==e)return g=!0,!1});return g},_mouseDrag:function(c){this.position=
this._generatePosition(c);this.positionAbs=this._convertPositionTo("absolute");this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs);if(this.options.scroll){var b=this.options,e=!1;this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-c.pageY<b.scrollSensitivity?this.scrollParent[0].scrollTop=e=this.scrollParent[0].scrollTop+b.scrollSpeed:c.pageY-this.overflowOffset.top<b.scrollSensitivity&&(this.scrollParent[0].scrollTop=
e=this.scrollParent[0].scrollTop-b.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-c.pageX<b.scrollSensitivity?this.scrollParent[0].scrollLeft=e=this.scrollParent[0].scrollLeft+b.scrollSpeed:c.pageX-this.overflowOffset.left<b.scrollSensitivity&&(this.scrollParent[0].scrollLeft=e=this.scrollParent[0].scrollLeft-b.scrollSpeed)):(c.pageY-d(document).scrollTop()<b.scrollSensitivity?e=d(document).scrollTop(d(document).scrollTop()-b.scrollSpeed):d(window).height()-(c.pageY-d(document).scrollTop())<
b.scrollSensitivity&&(e=d(document).scrollTop(d(document).scrollTop()+b.scrollSpeed)),c.pageX-d(document).scrollLeft()<b.scrollSensitivity?e=d(document).scrollLeft(d(document).scrollLeft()-b.scrollSpeed):d(window).width()-(c.pageX-d(document).scrollLeft())<b.scrollSensitivity&&(e=d(document).scrollLeft(d(document).scrollLeft()+b.scrollSpeed)));!1!==e&&d.ui.ddmanager&&!b.dropBehaviour&&d.ui.ddmanager.prepareOffsets(this,c)}this.positionAbs=this._convertPositionTo("absolute");for(g in this.containers)this.isOverItem(this.containers[g].containerCache)&&
(this.lastList=this.containers[g].element);this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px");this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px");for(var g=this.items.length-1;0<=g;g--){var b=this.items[g],e=b.item[0],k=this._intersectsWithPointer(b);this.placeholder[1==k?"next":"prev"]();if(k&&this.placeholder[1==k?"next":"prev"]()[0]!=e&&e!=this.currentItem[0]){this.isItemMarginal=!1;this.smoothList&&(verticalDirection=
this._getDragVerticalDirection(),"up"==verticalDirection?(next_item=b.item.next(),next_item[0]==this.placeholder[0]||next_item.hasClass(this.smoothClass)&&next_item[0]!=this.currentItem[0]||(this.isItemMarginal=!0)):(prev_item=b.item.prev(),prev_item[0]==this.placeholder[0]||prev_item.hasClass(this.smoothClass)&&prev_item[0]!=this.currentItem[0]||(this.isItemMarginal=!0)));this.direction=1==k?"down":"up";if(this.isItemMarginal||"pointer"==this.options.tolerance||this._intersectsWithSides(b))this._rearrange(c,
b,0,0,this.isItemMarginal);else break;this._trigger("change",c,this._uiHash());break}}if(0<this.staticItems.length){for(var b=this.positionAbs.top+this.offset.click.top,l=this.currentItem[0],e=[],g=this.staticItems.length-1;0<=g;--g)(intersect=this.isOverItem(this.staticItems[g]))&&this.staticItems[g].staticItem[0]!=this.currentItem[0]&&(e[g]=[],e[g].intersect=intersect,e[g].item=this.staticItems[g]);e.length?g=e[e.length-1]:(g=[],g.item=[],g.item.staticItem=this.listOuterContainer);if(g.item.staticItem&&
!(this.lastStaticItemOver&&g.item.staticItem==this.lastStaticItemOver||this.isOverCurrentStatic(g.item.staticItem[0]))){innerMostSI=this.staticItemsInnerSelector?g.item.staticItem==this.listOuterContainer?d(this.lastList):g.item.staticItem.children(this.staticItemsInnerSelector).first():g.item.staticItem;innerMostSIStaticChildren=this._getChildren(innerMostSI,this.staticItemsSelector);innerMostSINotStaticChildren=this._getChildren(innerMostSI,this.options.items);var n=[],p=[],s=this.options.toleranceElement;
innerMostSIStaticChildren.each(function(){var b=s?d(s,d(this)):d(this);n.push({item:d(this),top:b.offset().top})});innerMostSINotStaticChildren.each(function(){var b=s?d(s,d(this)):d(this);b[0]!=l&&p.push({top:b.offset().top,id:b.attr("id")})});if(innerMostSIStaticChildren.length)if(isFirstStaticLower=n[0].top>b,StaticLast=n.length-1,notStaticLength=p.length,isBetweenStatic=!0,isFirstStaticLower)(!notStaticLength||n[0].top<p[0].top)&&this._rearrange(c,innerMostSIStaticChildren.first(),0,0,!1,!0,"before");
else if(isLastStaticHigher=n[StaticLast].top<b)(!notStaticLength||n[StaticLast].top>p[notStaticLength-1].top)&&this._rearrange(c,innerMostSIStaticChildren.last(),0,0,!1,!0,"after");else{staticDiffIndex=0;for(si in n)if(n[si].top>=b){staticDiffIndex=si;break}if(notStaticLength&&n[staticDiffIndex-1]&&!(p[0].top>n[staticDiffIndex].top||p[notStaticLength-1].top<n[staticDiffIndex-1].top))for(nsi in p)if(p[nsi].top<n[staticDiffIndex].top&&p[nsi].top>n[staticDiffIndex-1].top){isBetweenStatic=!1;break}isBetweenStatic&&
this._rearrange(c,n[staticDiffIndex].item,0,0,!1,!0,"before")}else this._getChildren(innerMostSI,!1).length||this._rearrange(c,innerMostSI,0,0,!1,!0,"into");this._trigger("change",c,this._uiHash())}this.lastStaticItemOver=g.item.staticItem}this._contactContainers(c);d.ui.ddmanager&&d.ui.ddmanager.drag(this,c);this._trigger("sort",c,this._uiHash());this.lastPositionAbs=this.positionAbs;return!1},_mouseStop:function(c,b){if(c){d.ui.ddmanager&&!this.options.dropBehaviour&&d.ui.ddmanager.drop(this,c);
if(this.options.revert){var e=this,g=e.placeholder.offset();e.reverting=!0;d(this.helper).animate({left:g.left-this.offset.parent.left-e.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:g.top-this.offset.parent.top-e.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){e._clear(c)})}else this._clear(c,b);return!1}},cancel:function(){if(this.dragging){this._mouseUp();"original"==
this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var c=this.containers.length-1;0<=c;c--)this.containers[c]._trigger("deactivate",null,this._uiHash(this)),this.containers[c].containerCache.over&&(this.containers[c]._trigger("out",null,this._uiHash(this)),this.containers[c].containerCache.over=0)}this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]);"original"!=this.options.helper&&this.helper&&
this.helper[0].parentNode&&this.helper.remove();d.extend(this,{helper:this.levelCheck?this.helper:null,dragging:!1,reverting:!1,_noFinalSort:null});this.domPosition.prev?d(this.domPosition.prev).after(this.currentItem):d(this.domPosition.parent).prepend(this.currentItem);return this},serialize:function(c){var b=this._getItemsAsjQuery(c&&c.connected),e=[];c=c||{};d(b).each(function(){var b=(d(c.item||this).attr(c.attribute||"id")||"").match(c.expression||/(.+)[-=_](.+)/);b&&e.push((c.key||b[1]+"[]")+
"="+(c.key&&c.expression?b[1]:b[2]))});return e.join("&")},toArray:function(c){var b=this._getItemsAsjQuery(c&&c.connected),e=[];c=c||{};b.each(function(){e.push(d(c.item||this).attr(c.attribute||"id")||"")});return e},_intersectsWith:function(c){var b=this.positionAbs.left,e=b+this.helperProportions.width,d=this.positionAbs.top,k=d+this.helperProportions.height,l=c.left,n=l+c.width,p=c.top,s=p+c.height,t=this.offset.click.top,u=this.offset.click.left;return"pointer"==this.options.tolerance||this.options.forcePointerForContainers||
"pointer"!=this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>c[this.floating?"width":"height"]?d+t>p&&d+t<s&&b+u>l&&b+u<n:l<b+this.helperProportions.width/2&&e-this.helperProportions.width/2<n&&p<d+this.helperProportions.height/2&&k-this.helperProportions.height/2<s},_intersectsWithPointer:function(c){if(!this.isOverItem(c))return!1;c=this._getDragVerticalDirection();var b=this._getDragHorizontalDirection();return this.floating?b&&"right"==b||"down"==c?2:1:c&&("down"==
c?2:1)},_intersectsWithSides:function(c){var b=this._isOverAxis(this.positionAbs.top+this.offset.click.top,c.top+c.height/2,c.height);c=this._isOverAxis(this.positionAbs.left+this.offset.click.left,c.left+c.width/2,c.width);var e=this._getDragVerticalDirection(),d=this._getDragHorizontalDirection();return this.floating&&d?"right"==d&&c||"left"==d&&!c:e&&("down"==e&&b||"up"==e&&!b)},_getDragVerticalDirection:function(){var c=this.positionAbs.top-this.lastPositionAbs.top;return 0!=c&&(0<c?"down":"up")},
_getDragHorizontalDirection:function(){var c=this.positionAbs.left-this.lastPositionAbs.left;return 0!=c&&(0<c?"right":"left")},refresh:function(c){this._refreshItems(c);this.refreshPositions();return this},_connectWith:function(){var c=this.options;return c.connectWith.constructor==String?[c.connectWith]:c.connectWith},_getItemsAsjQuery:function(c){var b=[],e=[],g=this._connectWith();if(g&&c)for(c=g.length-1;0<=c;c--)for(var k=d(g[c]),l=k.length-1;0<=l;l--){var n=d.data(k[l],"edSortable");n&&n!=
this&&!n.options.disabled&&e.push([d.isFunction(n.options.items)?n.options.items.call(n.element):d(n.options.items,n.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),n])}e.push([d.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):d(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(c=e.length-1;0<=c;c--)e[c][0].each(function(){b.push(this)});return d(b)},_removeCurrentsFromItems:function(){for(var c=
this.currentItem.find(":data(sortable-item)"),b=0;b<this.items.length;b++)for(var e=0;e<c.length;e++)c[e]==this.items[b].item[0]&&this.items.splice(b,1)},_refreshItems:function(c){this.items=[];this.containers=[this];var b=this.items,e=this.staticItems=[],g=[[d.isFunction(this.options.items)?this.options.items.call(this.element[0],c,{item:this.currentItem}):d(this.options.items,this.element),this]],k="undefined"!=typeof this.options.staticItems.outerContainer?this.options.staticItems.outerContainer:
this.options.staticItems;staticQueries=[[d.isFunction(k)?k.call(this.element[0],c,{staticItem:this.currentItem}):d(k,this.element),this]];var l=this._connectWith();if(l)for(k=l.length-1;0<=k;k--)for(var n=d(l[k]),p=n.length-1;0<=p;p--){var s=d.data(n[p],"edSortable");s&&s!=this&&!s.options.disabled&&(g.push([d.isFunction(s.options.items)?s.options.items.call(s.element[0],c,{item:this.currentItem}):d(s.options.items,s.element),s]),instSItems="undefined"!=typeof s.options.staticItems.outerContainer?
s.options.staticItems.outerContainer:s.options.staticItems,staticQueries.push([d.isFunction(instSItems)?instSItems.call(s.element[0],c,{item:this.currentItem}):d(instSItems,s.element),s]),this.containers.push(s))}for(k=g.length-1;0<=k;k--)for(c=g[k][1],l=g[k][0],p=0,n=l.length;p<n;p++)s=d(l[p]),s.data("sortable-item",c),b.push({item:s,instance:c,width:0,height:0,left:0,top:0});if(this.options.staticItems)for(k=staticQueries.length-1;0<=k;k--)for(c=staticQueries[k][1],l=staticQueries[k][0],p=0,n=l.length;p<
n;p++)b=d(l[p]),b.data("sortable-item",c),e.push({staticItem:b,instance:c,width:0,height:0,left:0,top:0})},refreshPositions:function(c){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var b=this.items.length-1;0<=b;b--){var e=this.items[b],g=this.options.toleranceElement?d(this.options.toleranceElement,e.item):e.item;c||(e.width=g.outerWidth(),e.height=g.outerHeight());g=g.offset();e.left=g.left;e.top=g.top}if(this.options.staticItems&&this.staticItems.length)for(b=
this.staticItems.length-1;0<=b;b--)c=this.staticItems[b],g=this.options.toleranceElement?d(this.options.toleranceElement,c.staticItem):c.staticItem,c.width=g.outerWidth(),c.height=g.outerHeight(),g=g.offset(),c.left=g.left,c.top=g.top;if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(b=this.containers.length-1;0<=b;b--)g=this.containers[b].element.offset(),this.containers[b].containerCache.left=g.left,this.containers[b].containerCache.top=
g.top,this.containers[b].containerCache.width=this.containers[b].element.outerWidth(),this.containers[b].containerCache.height=this.containers[b].element.outerHeight();return this},_createPlaceholder:function(c){var b=c||this,e=b.options;if(!e.placeholder||e.placeholder.constructor==String){var g=e.placeholder;b.placeholderClassName=g||"ui-sortable-placeholder";e.placeholder={element:function(){var e=d(document.createElement(b.currentItem[0].nodeName)).addClass(g||b.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];
g||(e.style.visibility="hidden");return e},update:function(c,d){if(!g||e.forcePlaceholderSize)d.height()||d.height(b.currentItem.innerHeight()-parseInt(b.currentItem.css("paddingTop")||0,10)-parseInt(b.currentItem.css("paddingBottom")||0,10)),d.width()||d.width(b.currentItem.innerWidth()-parseInt(b.currentItem.css("paddingLeft")||0,10)-parseInt(b.currentItem.css("paddingRight")||0,10))}}}b.placeholder=d(e.placeholder.element.call(b.element,b.currentItem));b.currentItem.after(b.placeholder);e.placeholder.update(b,
b.placeholder)},_contactContainers:function(c){for(var b=null,e=null,g=this.containers.length-1;0<=g;g--)d.contains(this.currentItem[0],this.containers[g].element[0])||(this._intersectsWithPointer(this.containers[g].containerCache)?b&&d.contains(this.containers[g].element[0],b.element[0])||(b=this.containers[g],e=g):this.containers[g].containerCache.over&&(this.containers[g]._trigger("out",c,this._uiHash(this)),this.containers[g].containerCache.over=0));if(b)if(1===this.containers.length)this.containers[e]._trigger("over",
c,this._uiHash(this)),this.containers[e].containerCache.over=1;else if(this.currentContainer!=this.containers[e]){for(var b=this.positionAbs[this.containers[e].floating?"left":"top"],k=g=null,l=this.items.length-1;0<=l;--l)if(d.contains(this.containers[e].element[0],this.items[l].item[0])){var n=this.items[l][this.containers[e].floating?"left":"top"],p=n+this.items[l][this.containers[e].floating?"width":"height"],n=Math.abs(n-b),p=Math.abs(p-b),s=Math.min(n,p);if(s<=g||null==g)var g=s,t=n<p?"before":
"after",k=this.items[l].item[0]}for(l=this.staticItems.length-1;0<=l;--l)d.contains(this.containers[e].element[0],this.staticItems[l].staticItem[0])&&(n=this.staticItems[l][this.containers[e].floating?"left":"top"],p=n+this.staticItems[l][this.containers[e].floating?"width":"height"],n=Math.abs(n-b),p=Math.abs(p-b),s=Math.min(n,p),s<=g||null==g)&&(g=s,t=n<p?"before":"after",k=this.staticItems[l].staticItem[0]);if(k||this.options.dropOnEmpty)this.currentContainer=this.containers[e],k?this._rearrange(c,
k,0,0,!1,!0,t):this._rearrange(c,null,this.containers[e].element,!0),this._trigger("change",c,this._uiHash()),this.containers[e]._trigger("change",c,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[e]._trigger("over",c,this._uiHash(this)),this.containers[e].containerCache.over=1}},_getChildren:function(c,b){if(c[0]==this.helperParent){children=b?c.children(b):c.children();for(ch=0;ch<children.length;++ch)if(children[ch]==this.currentItem[0]){children.splice(ch,
1);break}return children}return b?c.children(b):c.children()},_createHelper:function(c){var b=this.options;c=d.isFunction(b.helper)?d(b.helper.apply(this.element[0],[c,this.currentItem])):"clone"==b.helper?this.currentItem.clone():this.currentItem;this.helperParent=!1;if(staticParent=this.currentItem.parents(this.staticItemsSelector).first())this.staticItemsInnerSelector?this.currentItem.parent()[0]==staticParent.children(this.staticItemsInnerSelector).first()[0]&&(this.helperParent=this.currentItem.parent()[0]):
this.helperParent=staticParent[0];c.parents("body").length||d("parent"!=b.appendTo?b.appendTo:this.currentItem[0].parentNode)[0].appendChild(c[0]);c[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")});(""==c[0].style.width||b.forceHelperSize)&&c.width(this.currentItem.width());(""==c[0].style.height||b.forceHelperSize)&&
c.height(this.currentItem.height());return c},_adjustOffsetFromHelper:function(c){"string"==typeof c&&(c=c.split(" "));d.isArray(c)&&(c={left:+c[0],top:+c[1]||0});"left"in c&&(this.offset.click.left=c.left+this.margins.left);"right"in c&&(this.offset.click.left=this.helperProportions.width-c.right+this.margins.left);"top"in c&&(this.offset.click.top=c.top+this.margins.top);"bottom"in c&&(this.offset.click.top=this.helperProportions.height-c.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=
this.helper.offsetParent();var c=this.offsetParent.offset();"absolute"==this.cssPosition&&this.scrollParent[0]!=document&&d.contains(this.scrollParent[0],this.offsetParent[0])&&(c.left+=this.scrollParent.scrollLeft(),c.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&toa.browser.msie)c={top:0,left:0};return{top:c.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:c.left+(parseInt(this.offsetParent.css("borderLeftWidth"),
10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var c=this.currentItem.position();return{top:c.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:c.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions=
{width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var c=this.options;"parent"==c.containment&&(c.containment=this.helper[0].parentNode);if("document"==c.containment||"window"==c.containment)this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,d("document"==c.containment?document:window).width()-this.helperProportions.width-this.margins.left,(d("document"==c.containment?document:window).height()||
document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(c.containment)){var b=d(c.containment)[0],c=d(c.containment).offset(),e="hidden"!=d(b).css("overflow");this.containment=[c.left+(parseInt(d(b).css("borderLeftWidth"),10)||0)+(parseInt(d(b).css("paddingLeft"),10)||0)-this.margins.left,c.top+(parseInt(d(b).css("borderTopWidth"),10)||0)+(parseInt(d(b).css("paddingTop"),10)||0)-this.margins.top,c.left+(e?Math.max(b.scrollWidth,
b.offsetWidth):b.offsetWidth)-(parseInt(d(b).css("borderLeftWidth"),10)||0)-(parseInt(d(b).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,c.top+(e?Math.max(b.scrollHeight,b.offsetHeight):b.offsetHeight)-(parseInt(d(b).css("borderTopWidth"),10)||0)-(parseInt(d(b).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(c,b){b||(b=this.position);var e="absolute"==c?1:-1,g="absolute"!=this.cssPosition||this.scrollParent[0]!=
document&&d.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,k=/(html|body)/i.test(g[0].tagName);return{top:b.top+this.offset.relative.top*e+this.offset.parent.top*e-(toa.browser.safari&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollTop():k?0:g.scrollTop())*e),left:b.left+this.offset.relative.left*e+this.offset.parent.left*e-(toa.browser.safari&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():
k?0:g.scrollLeft())*e)}},_generatePosition:function(c){var b=this.options,e="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&d.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,g=/(html|body)/i.test(e[0].tagName);"relative"!=this.cssPosition||this.scrollParent[0]!=document&&this.scrollParent[0]!=this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset());var k=c.pageX,l=c.pageY;this.originalPosition&&(this.containment&&(c.pageX-this.offset.click.left<
this.containment[0]&&(k=this.containment[0]+this.offset.click.left),c.pageY-this.offset.click.top<this.containment[1]&&(l=this.containment[1]+this.offset.click.top),c.pageX-this.offset.click.left>this.containment[2]&&(k=this.containment[2]+this.offset.click.left),c.pageY-this.offset.click.top>this.containment[3]&&(l=this.containment[3]+this.offset.click.top)),b.grid&&(l=this.originalPageY+Math.round((l-this.originalPageY)/b.grid[1])*b.grid[1],l=this.containment?l-this.offset.click.top<this.containment[1]||
l-this.offset.click.top>this.containment[3]?l-this.offset.click.top<this.containment[1]?l+b.grid[1]:l-b.grid[1]:l:l,k=this.originalPageX+Math.round((k-this.originalPageX)/b.grid[0])*b.grid[0],k=this.containment?k-this.offset.click.left<this.containment[0]||k-this.offset.click.left>this.containment[2]?k-this.offset.click.left<this.containment[0]?k+b.grid[0]:k-b.grid[0]:k:k));return{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(toa.browser.safari&&"fixed"==this.cssPosition?
0:"fixed"==this.cssPosition?-this.scrollParent.scrollTop():g?0:e.scrollTop()),left:k-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(toa.browser.safari&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollLeft():g?0:e.scrollLeft())}},_rearrange:function(c,b,e,g,k,l,n){l?"after"==n?d(this.placeholder[0]).insertAfter(b):"before"==n?d(this.placeholder[0]).insertBefore(b):"into"==n&&d(this.placeholder[0]).prependTo(b):e?e[0].appendChild(this.placeholder[0]):
(c=void 0!=b.staticItem?b.staticItem[0]:b.item[0],c.parentNode.insertBefore(this.placeholder[0],"down"==this.direction?k?c.nextSibling:c:k?c:c.nextSibling));this.counter=this.counter?++this.counter:1;var p=this,s=this.counter;window.setTimeout(function(){s==p.counter&&p.refreshPositions(!g)},0)},_clear:function(c,b){this.reverting=!1;var e=[];!this._noFinalSort&&this.currentItem[0].parentNode&&this.placeholder.before(this.currentItem);this._noFinalSort=null;if(this.helper[0]==this.currentItem[0]){for(var g in this._storedCSS)if("auto"==
this._storedCSS[g]||"static"==this._storedCSS[g])this._storedCSS[g]="";this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!b&&e.push(function(b){this._trigger("receive",b,this._uiHash(this.fromOutside))});!this.fromOutside&&this.domPosition.prev==this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent==this.currentItem.parent()[0]||b||e.push(function(b){this._trigger("update",b,this._uiHash())});if(!d.contains(this.element[0],
this.currentItem[0]))for(b||e.push(function(b){this._trigger("remove",b,this._uiHash())}),g=this.containers.length-1;0<=g;g--)d.contains(this.containers[g].element[0],this.currentItem[0])&&!b&&e.push(function(b){return function(e){b._trigger("receive",e,this._uiHash(this))}}.call(this,this.containers[g]));for(g=this.containers.length-1;0<=g;g--)b||e.push(function(b){return function(e){b._trigger("deactivate",e,this._uiHash(this))}}.call(this,this.containers[g])),this.containers[g].containerCache.over&&
(e.push(function(b){return function(e){b._trigger("out",e,this._uiHash(this))}}.call(this,this.containers[g])),this.containers[g].containerCache.over=0);this._storedCursor&&d("body").css("cursor",this._storedCursor);this._storedOpacity&&this.helper.css("opacity",this._storedOpacity);this._storedZIndex&&this.helper.css("zIndex","auto"==this._storedZIndex?"":this._storedZIndex);this.dragging=!1;if(this.cancelHelperRemoval){if(!b){this._trigger("beforeStop",c,this._uiHash());for(g=0;g<e.length;g++)e[g].call(this,
c);this._trigger("stop",c,this._uiHash())}return!1}b||this._trigger("beforeStop",c,this._uiHash());this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]);this.helper[0]!=this.currentItem[0]&&this.helper.remove();this.helper=null;if(!b){for(g=0;g<e.length;g++)e[g].call(this,c);this._trigger("stop",c,this._uiHash())}this.fromOutside=!1;return!0},_trigger:function(){!1===d.Widget.prototype._trigger.apply(this,arguments)&&this.cancel()},_uiHash:function(c){var b=
c||this;return{helper:b.helper,placeholder:b.placeholder||d([]),position:b.position,originalPosition:b.originalPosition,offset:b.positionAbs,item:b.currentItem,sender:c?c.element:null}}});d.extend(d.ui.edSortable,{version:"1.0.0"})})(jQuery);toa.ns("toa.view.displayLayoutVisibility",function(){var d="",c="",b="";return toa.define(null,function(b,c,d){this.propertiesList=c;this.visibilityLookup=d;this.visibility=b.visibility;this.visibilityId=b.visibilityId;this.cmdAction=b.cmdAction;this.subAction=b.subAction;this.contextLayoutItemId=b.contextLayoutItemId;this.newConditionCounter=1;this.conditionTranslations={"in":toa.glossary({id:11456}),not_in:toa.glossary({id:11457}),contains:toa.glossary({id:11458}),dcontain:toa.glossary({id:11459}),
is_null:toa.glossary({id:11460}),is_not_null:toa.glossary({id:11461})};this.propertiesListLabel=toa.glossary({id:21069});this.conditionTranslationsListLabel=toa.glossary({id:3299});this.createPropertiesListSelect.bind(this)();this.createConditionsListSelect.bind(this)();this.createDialogTemplate();this.conditions={};this.conditionsCounter=0;this.isEditModeOn=!1;if(b.conditions&&"web_change_activity_group"!==b.contextLabel&&"web_cancel_activity_group"!==b.contextLabel){this.conditions=b.conditions;
for(var l in this.conditions)this.conditionsCounter++}this.showWindow.bind(this)(b)},{showWindow:function(e){var c=[],d=!this.conditionsCounter,l;for(l in this.visibilityLookup)c.push({value:l,name:this.visibilityLookup[l][1],checked:l==this.visibility?" checked ":""});1==c.length&&(c[0].checked=" checked ");if("web_change_activity_group"===e.contextLabel||"web_cancel_activity_group"===e.contextLabel)this.propertiesList={},d=!1;c=$(b.apply({visibilitiesToDisplay:c,isDisplayConditions:!!this.conditionsCounter,
displayNoConditionMessage:d,conditions:this.conditions,conditionsTranslations:this.conditionTranslations,areConditionsAllowed:!$.isEmptyObject(this.propertiesList)}));e=e.contextLayoutItemName?toa.glossary({id:19543}).replace("{OBJECT}",e.contextLayoutItemName):"";this.dialogPopup=new toa.ui.Popup({title:e,autoOpen:!1,modal:!0,onClose:this.dialogDestroy.bind(this),buttons:[{text:toa.glossary({id:290}),click:this.dialogDestroy.bind(this)},{id:"save_visibility_button",type:"submit",text:toa.glossary({id:12}),
click:this.saveVisibility.bind(this)}]});this.dialogPopup.setContent(c);this.dialogPopup.show();$("#display-layout-add-new-condition").on("click",this.addNewCondition.bind(this));$(".display-layout-visibility-condition-edit-button").on("click",this.onEditOneCondition.bind(this))},createDialogTemplate:function(){b=new toa.Template(['<div class="display-layout-visibility-edit-dialog">',"<div>",'<div class="display-layout-visibility-edit-row"><b>'+toa.glossary({id:11452})+"</b>","<% for(var visId=0; visId<visibilitiesToDisplay.length; visId++) { var vis=visibilitiesToDisplay[visId]; %>",
'<label><input <% if(vis.value == "ReadOnly" && visibilitiesToDisplay.length == 1) {  %>class="toa-hidden"<% } %> type="radio" name="visibility" value="<%=vis.value%>" <%=vis.checked%> ><%=vis.name%></label> ',"<% } %>","</div>",'<div class="display-layout-visibility-edit-row">','<b id="display-layout-visibilily-following-conditions" <% if (!isDisplayConditions) print("style=\'display: none\'") %> >'+toa.glossary({id:17560})+"</b>","</div>",'<div class="display-layout-visibilily-conditions" >',"<% for(var conId in conditions) { var condition=conditions[conId]; %>",
'<div class="display-layout-visibility-condition" id="condition-<%=conId%>" data-id="<%=conId%>" >','<div class="condition-wrapper">','<span class="condition-field"><%=condition.fieldName%></span>','<span class="condition-item"><%=conditionsTranslations[condition.condition]%></span>','<span class="condition-value"></span>',"</div>",'<div class="condition-value-list-wrapper">','<span class="condition-value-list"><%= hs(condition.valueName) %></span>',"</div>",'<div class="display-layout-visibility-condition-edit-buttons">',
'<button class="toa-button display-layout-visibility-condition-edit-button" data-condition-id="<%=conId%>" aria-label="'+toa.glossary({id:462})+'"><div></div></button>',"</div>","</div>","<% } %>","</div>",'<div class="display-layout-visibility-edit-row" id="display-layout-visibilily-no-conditions" <% if (!displayNoConditionMessage) print("style=\'display: none\'") %> >',toa.glossary({id:11454}),"</div>",'<div class="display-layout-visibility-edit-row" <% if (!areConditionsAllowed)print("style=\'display: none\'") %> >',
'<span class="turning" id="display-layout-add-new-condition" tabindex="0">'+toa.glossary({id:11455})+"</span>",'<div id="display-layout-visibilily-error"></div>',"</div>","</div>","</div>"])},createPropertiesListSelect:function(){d&&d.remove();var b=[],c;for(c in this.propertiesList)b.push({propertyId:c,propertyText:hs(this.propertiesList[c].pntext)});b.sort(function(b,e){return b.propertyText.localeCompare(e.propertyText)});c=new toa.Template(['<select id="display-layout-properties-list" aria-label="<%=propertiesListLabel%>">',
"<% for(var id = 0; id < propertiesList.length; id++) { var property=propertiesList[id]; %>",'<option value="<%=property.propertyId%>"><%=property.propertyText%> [<%=property.propertyId%>]</option>',"<% } %>","</select>"]);d=$(c.apply({propertiesList:b,propertiesListLabel:this.propertiesListLabel}));d.change(function(){this.conditions[this.currentConditionId].value="";this.conditions[this.currentConditionId].valueName="";this.refreshOptionsList();this.showValueInput()}.bind(this))},createConditionsListSelect:function(){c&&
c.remove();c=$(['<select id="display-layout-conditions-list" aria-label="'+this.conditionTranslationsListLabel+'">','<option value="in">'+this.conditionTranslations["in"]+"</option>",'<option value="not_in">'+this.conditionTranslations.not_in+"</option>",'<option value="contains">'+this.conditionTranslations.contains+"</option>",'<option value="dcontain">'+this.conditionTranslations.dcontain+"</option>",'<option value="is_null">'+this.conditionTranslations.is_null+"</option>",'<option value="is_not_null">'+
this.conditionTranslations.is_not_null+"</option>","</select>"].join(""))},dialogDestroy:function(){this.optionList&&this.optionList.Tip&&(this.optionList.Tip("destroy"),this.optionList.remove());this.dialogPopup.destroy()},saveVisibility:function(){this.isEditModeOn&&this.applyConditionChanges();var b=$(".display-layout-visibility-edit-row").find("input:radio[name=visibility]:checked").val();b?(this.dialogPopup.disableButton("save_visibility_button"),request({url:"?cmd="+this.cmdAction+"&sub="+this.subAction+
"&action=layout_structure&id="+_DATA.company_settings_display_layout_structure.id+"&do=set_visibility&base_id="+this.contextLayoutItemId+"&vis_id="+(this.visibilityId?this.visibilityId:0),data:{saveVisibility:!0,visibility:b,conditions:this.conditions},responseHandler:function(b){this.dialogPopup.enableButton("save_visibility_button");b.saveResult?(this.dialogDestroy.bind(this)(),request({url:"?cmd="+this.cmdAction+"&sub="+this.subAction+"&action=layout_structure&id="+_DATA.company_settings_display_layout_structure.id+
"&do=visibility_list&base_id="+this.contextLayoutItemId+"&output=ajax"})):b&&b.error_message&&""!=b.error_message?this.showError(b.error_message):this.showError("Save failed")}.bind(this)})):this.showError(h(17083))},showError:function(b){$("#display-layout-visibilily-error").html(b)},hideError:function(){$("#display-layout-visibilily-error").html("")},addNewCondition:function(){if(!this.isEditModeOn){this.currentConditionId="new-"+this.newConditionCounter;this.newConditionCounter++;var b=new toa.Template(['<div class="display-layout-visibility-condition" id="condition-<%=conditionId%>" data-id="<%=conditionId%>" >',
'<div class="condition-wrapper">','<span class="condition-field"></span>','<span class="condition-item"></span>','<span class="condition-value"></span>',"</div>",'<div class="condition-value-list-wrapper">','<span class="condition-value-list"></span>',"</div>",'<div class="display-layout-visibility-condition-edit-buttons">','<button class="toa-button display-layout-visibility-condition-edit-button" data-condition-id="<%=conditionId%>" aria-label="'+toa.glossary({id:462})+'"><div></div></button>',
"</div>","</div>"]),b=$(b.apply({conditionId:this.currentConditionId}));b.find(".display-layout-visibility-condition-edit-button").on("click",this.onEditOneCondition.bind(this));$(".display-layout-visibilily-conditions").append(b);this.conditions[this.currentConditionId]={field:"",fieldName:"",condition:"",value:"",valueName:""};this.conditionsCounter++;this.refreshNoConditionBlock();this.editOneCondition()}},onEditOneCondition:function(b){this.currentConditionId=$(b.target).data("condition-id");
this.currentConditionId||(this.currentConditionId=$(b.target).parent().data("condition-id"));this.editOneCondition()},editOneCondition:function(){this.isEditModeOn=!0;var b=$("#condition-"+this.currentConditionId),g=this.conditions[this.currentConditionId];g||(g={field:"",condition:""});$(".display-layout-visibility-condition-edit-button").attr("disabled","disabled");b.addClass("display-layout-visibility-condition-wide");b.find(".display-layout-visibility-condition-edit-button").hide();var k=$(['<button class="toa-button display-layout-visibility-condition-apply-changes" id="display-layout-apply-changes" aria-label="'+
toa.glossary({id:99})+'"><div></div></button>','<button class="toa-button" id="display-layout-delete-condition">'+toa.glossary({id:11462})+"</button>"].join(""));d.detach();c.detach();g.field&&d.val(g.field);g.condition&&c.val(g.condition);b.find(".condition-field").empty().append(d);b.find(".condition-item").empty().append(c);this.showValueInput.bind(this)();b.find(".display-layout-visibility-condition-edit-buttons").append(k);$("#display-layout-apply-changes").on("click",this.applyConditionChanges.bind(this));
$("#display-layout-delete-condition").on("click",this.deleteCondition.bind(this));this.refreshOptionsList()},showValueInput:function(){var b="",c=$("#condition-"+this.currentConditionId),b=d.val();if(this.isPropertyEnum(this.propertiesList[b])){$("#display-layout-add-enum").remove();$("#display-layout-add-enum-result").remove();var b=$('<button class="toa-button display-layout-visibility-condition-add-button" id="display-layout-add-enum" aria-label="'+toa.glossary({id:222})+'"><div></div></button>'),
k=$('<input type="hidden" id="display-layout-condition-text-value"> '),l=$('<span id="display-layout-add-enum-result">'+(this.currentConditionId&&this.conditions[this.currentConditionId]?this.conditions[this.currentConditionId].valueName:"")+"</span>");b.on("click",this.showEnumConditionValues.bind(this));c.find(".condition-value").empty().append(b).append(k);c.find(".condition-value-list").empty().append(l)}else $("#display-layout-condition-text-value").remove(),b=$('<input type="text" id="display-layout-condition-text-value" style="width: 120px;" aria-label="'+
toa.glossary({id:19525})+'">'),b.val(this.conditions[this.currentConditionId].value),c.find(".condition-value").empty().append(b),c.find(".condition-value-list").empty()},applyConditionChanges:function(){var b=d.val(),c="",k="";this.isPropertyEnum(this.propertiesList[b])?(c=$("#display-layout-condition-text-value").val(),k=$("#display-layout-add-enum-result").html()):(c=$("#display-layout-condition-text-value").val(),k=hs(c));var l=this.correctConditions($("#display-layout-conditions-list").val(),
c);if("is_null"==l||"is_not_null"==l)k=c="";this.conditions[this.currentConditionId]={field:b,fieldName:this.propertiesList[b].pntext,condition:l,value:c,valueName:k};this.hideEditConditionControls();this.showAppliedConditionValues.bind(this)();this.isEditModeOn=this.currentConditionId=!1},correctConditions:function(b,c){var d=b;""==c&&"in"==b?d="is_null":""==c&&"not_in"==b&&(d="is_not_null");return d},deleteCondition:function(){this.hideEditConditionControls();delete this.conditions[this.currentConditionId];
this.conditionsCounter--;this.refreshNoConditionBlock();$("#condition-"+this.currentConditionId).remove();this.isEditModeOn=!1},refreshNoConditionBlock:function(){this.conditionsCounter?($("#display-layout-visibilily-no-conditions").hide(),$("#display-layout-visibilily-following-conditions").show()):($("#display-layout-visibilily-no-conditions").show(),$("#display-layout-visibilily-following-conditions").hide())},hideEditConditionControls:function(){d.detach();$("#display-layout-conditions-list").detach();
$("#display-layout-apply-changes").remove();$("#display-layout-delete-condition").remove();$("#display-layout-add-enum").remove();$("#display-layout-condition-text-value").remove();$(".display-layout-visibility-condition-edit-button").removeAttr("disabled");var b=$("#condition-"+this.currentConditionId);b.removeClass("display-layout-visibility-condition-wide");b.find(".display-layout-visibility-condition-edit-button").show()},showAppliedConditionValues:function(){if(this.currentConditionId){var b=
$("#condition-"+this.currentConditionId),c=this.conditions[this.currentConditionId];b.find(".condition-field").empty().html(c.fieldName);b.find(".condition-item").empty().html(this.conditionTranslations[c.condition]);b.find(".condition-value-list").empty().html(c.valueName)}},showEnumConditionValues:function(b){this.optionList||this.refreshOptionsList();this.optionList.Tip("showAtWithIndex",b.target,"bottom",3020)},refreshOptionsList:function(){var b=d.val();if(b&&this.propertiesList[b].pnindex&&
this.currentConditionId){var c=this.conditions[this.currentConditionId].value,k=new toa.Template(['<div id="display-layout-enum-options-list">',"<% for(var index in options) { %>","<% if($.inArray(index, active) >= 0) { %>","<label>",'<input type="checkbox" value="<%-index%>" data-shown-value="<%=options[index]%>" <% if ($.inArray(index, currentValues) >= 0) print("checked"); %> > <%-options[index]%>',"</label><br>","<% } %>","<% } %>","</div>"]);this.optionList&&this.optionList.Tip&&(this.optionList.Tip("destroy"),
this.optionList.remove());this.optionList=$(k.apply({options:this.propertiesList[b].pnindex,currentValues:c?hs(c).split(","):"",active:hs(this.propertiesList[b].pnactive.join(",")).split(",")}));$("#display-layout-condition-text-value").val(c);this.optionList.delegate("input","click",function(b){var e=[],c=[];this.optionList.find("input:checked").each(function(){e.push($(this).val());c.push($(this).data("shown-value"))});$("#display-layout-condition-text-value").val(hs(e.join(",")));$("#display-layout-add-enum-result").html(hs(c.join(", ")))}.bind(this));
this.optionList.Tip({minWidth:200,minHeight:50,zIndex:3020})}},isPropertyEnum:function(b){return b&&"undefined"!==typeof b.pnindex&&!!b.pnindex}})}());toa.ns("toa.view.displayLayoutParameter",function(){var d="",c="",b="",e="",g="";return toa.define(null,function(b){this.contextLayoutItemId=b.contextLayoutItemId;this.cmdAction=b.cmdAction||"";this.subAction=b.subAction||"";this.parameter=b.parameter;this.parameterId=b.parameterId;this.entitiesLookup=b.entites||[];this.fieldCollection=b.fieldCollection||[];this.propertiesList=b.parameters||[];this.valueLengthLimit="form"===b.contextLayoutItemType?4E3:255;this.selectedEntity=this.extractParameterEntity();
this.selectedProperty=this.parameter&&this.parameter.field?this.parameter.field:"";this.selectedValue=this.parameter&&""!=this.parameter.value?this.parameter.value:"";this.paramsByEntity={};b=0;for(var e=this.propertiesList.length;b<e;b++){var c=this.propertiesList[b];this.paramsByEntity.hasOwnProperty(c.entity)||(this.paramsByEntity[c.entity]=[]);this.paramsByEntity[c.entity].push(c)}this.showWindow()},{submitBtn:"save_parameter_button",popup:null,popupContent:null,entitySelect:null,propertySelect:null,
valueSelect:null,valueInput:null,selectedEntity:null,selectedProperty:null,selectedValue:null,initPopupTemplate:function(){d=new toa.Template(['<div class="display-layout-visibility-edit-dialog">',"</div>"])},initEntitySelectTemplate:function(){c=new toa.Template(['<div class="display-layout-visibility-edit-row">',"<b>"+toa.glossary({id:18161})+"</b>","<label>",'<select name="entity-select" class="wysiwyg-properties-list entites" <%=checkDisabled%>>',"<%  for(var i = 0; i < entites.length; i++) { %>",
"<option  <%=entites[i].selected%> ",'value="<%=entites[i].id%>">',"<%=entites[i].name%>","</option>","<% } %>","</select>","</label>","</div>"])},initPropertySelectTemplate:function(){b=new toa.Template(['<div class="display-layout-visibility-edit-row">',"<b>"+toa.glossary({id:18162})+"</b>","<label>",'<select name="property-select" class="wysiwyg-properties-list parameter" <%=checkDisabled%>>',"<%  for(var i = 0; i < propertiesList.length; i++) { %>","<option  <%=propertiesList[i].selected%> ",
"<%-propertiesList[i].disabled%> ",'value="<%=propertiesList[i].label%>">',"<%=propertiesList[i].text%>&nbsp;[<%- propertiesList[i].label %>]","</option>","<% } %>","</select>","</label>","</div>"])},initValueSelectTemplate:function(){e=new toa.Template(['<div class="display-layout-visibility-edit-row">',"<b>"+toa.glossary({id:18163})+"</b>","<label>",'<select name="parameter-value" class="wysiwyg-properties-list parameter-value">',"<%  for(var i = 0; i < valueList.length; i++) { %>","<option  <%=valueList[i].selected%> ",
"<%-valueList[i].disabled%> ",'value="<%=valueList[i].id%>">',"<%=valueList[i].text%>","</option>","<% } %>","</select>","</label>","</div>"])},initValueInputTemplate:function(){g=new toa.Template(['<div class="display-layout-visibility-edit-row">',"<b>"+toa.glossary({id:18163})+"</b>","<label>",'<input type="text"','name="parameter-value"','class="wysiwyg-properties-list parameter-value"','value="<%=value%>" />',"</label>","</div>",'<div class="clear"></div>'])},showWindow:function(){this.initPopupTemplate();
this.initEntitySelectTemplate();this.initPropertySelectTemplate();this.initValueSelectTemplate();this.initValueInputTemplate();var b=this.parameterId?h(23675):h(18146);this.popup=new toa.ui.Popup({title:b,autoOpen:!1,modal:!0,onClose:this.dialogDestroy.bind(this),buttons:[{text:toa.glossary({id:290}),click:this.dialogDestroy.bind(this)},{id:this.submitBtn,type:"submit",text:toa.glossary({id:12}),click:this.saveParameter.bind(this)}]});this.popupContent=$(d.apply());this.popup.setContent(this.popupContent);
this.popup.show();this.showEntity()},toggleSubmitButton:function(){this.selectedValue?this.popup.enableButton(this.submitBtn):this.popup.disableButton(this.submitBtn)},dialogDestroy:function(){this.popup.destroy()},extractParameterEntity:function(){if("undefined"===typeof this.parameter)return null;for(var b=0,e=this.propertiesList.length;b<e;b++)if(this.parameter.field==this.propertiesList[b].label)return this.propertiesList[b].entity;return null},availableEntities:function(){var b=[],e="";if(0<
this.entitiesLookup.length)for(var c=0,d=this.entitiesLookup.length;c<d;c++){var g=this.entitiesLookup[c];if(this.selectedEntity||this.paramsByEntity.hasOwnProperty(g.id))g.id==this.selectedEntity&&(g.selected="selected",e="disabled"),b.push(g)}return{list:b,checkDisabled:e}},showEntity:function(){this.hideError();this.entitySelect&&this.entitySelect.detach();this.propertySelect&&this.propertySelect.detach();this.valueSelect&&this.valueSelect.detach();this.valueInput&&this.valueInput.detach();var b=
this.availableEntities();this.entitySelect=$(c.apply({entites:b.list||[],checkDisabled:b.checkDisabled||""}));this.entitySelect.appendTo(this.popupContent);this.selectedEntity||(this.selectedEntity=$(this.entitySelect).find("select :selected").val());$(this.entitySelect).find('[name="entity-select"]').on("change",function(b){this.selectedEntity=$(b.target).val();this.selectedValue=this.selectedProperty=null;this.showProperty()}.bind(this));this.showProperty()},availableProperties:function(){for(var b=
"",e=[],c=this.paramsByEntity[this.selectedEntity]||[],d=0,g=c.length;d<g;d++)c[d].hasOwnProperty("disabled")&&(b="disabled"),"undefined"!==typeof this.parameter&&this.parameter.field==c[d].label&&(this.selectedProperty=c[d].property_id,c[d].selected="selected"),e.push(c[d]);"undefined"===typeof this.parameterId&&(b="");return{list:e,checkDisabled:b}},showProperty:function(){this.hideError();this.propertySelect&&this.propertySelect.detach();this.valueSelect&&this.valueSelect.detach();this.valueInput&&
this.valueInput.detach();var e=this.availableProperties();this.propertySelect=$(b.apply({propertiesList:e.list||[],checkDisabled:e.checkDisabled||""}));this.propertySelect.appendTo(this.popupContent);this.selectedProperty||(this.selectedProperty=$(this.propertySelect).find("select :selected").val());$(this.propertySelect).find('[name="property-select"]').on("change",function(b){this.selectedProperty=$(b.target).val();this.selectedValue=null;this.showPropertyValue()}.bind(this));this.showPropertyValue()},
showPropertyValue:function(){this.toggleSubmitButton();this.valueSelect&&this.valueSelect.detach();this.valueInput&&this.valueInput.detach();for(var b=null,e=0,c=this.fieldCollection.length;e<c;e++)if(this.fieldCollection[e].label==this.selectedProperty){b=this.fieldCollection[e];break}null!=b&&"undefined"!==typeof b.lookups?this.showEnumerationValue(b):this.showInputValue();this.toggleSubmitButton()},showEnumerationValue:function(b){b=b.lookups||[];var c=[],d;for(d in b)b[d].id==this.selectedValue&&
(this.selectedValue=b[d],b[d].selected="selected"),c.push(b[d]);this.valueSelect=$(e.apply({valueList:c}));this.valueSelect.appendTo(this.popupContent);this.selectedValue||(this.selectedValue=$(this.valueSelect).find("select :selected").val());$(this.valueSelect).find('[name="parameter-value"]').on("change",function(b){this.selectedValue=$(b.target).val();this.toggleSubmitButton()}.bind(this))},showInputValue:function(){this.valueInput=$(g.apply({value:this.selectedValue}));this.valueInput.appendTo(this.popupContent);
$(this.valueInput).find('[name="parameter-value"]').on("keyup",function(b){this.selectedValue=$(b.target).val();this.toggleSubmitButton()}.bind(this))},saveParameter:function(){var b=this.selectedEntity,e=this.selectedProperty,c=this.selectedValue;c&&e&&b?c.length>this.valueLengthLimit?this.showError(h(16917,{"{FIELD}":toa.glossary({id:18163}),"{LENGTH}":this.valueLengthLimit})):(this.popup.disableButton(this.submitBtn),request({url:"?cmd="+this.cmdAction+"&sub="+this.subAction+"&action=layout_structure&id="+
_DATA.company_settings_display_layout_structure.id+"&do=set_parameter&base_id="+this.contextLayoutItemId+"&par_id="+(this.parameterId?this.parameterId:0),data:{saveParameter:!0,param:{field:e,value:c,entity:b}},responseHandler:function(b){this.popup.enableButton(this.submitBtn);b.saveResult?(this.dialogDestroy.bind(this)(),request({url:"?cmd="+this.cmdAction+"&sub="+this.subAction+"&action=layout_structure&id="+_DATA.company_settings_display_layout_structure.id+"&do=visibility_list&base_id="+this.contextLayoutItemId+
"&output=ajax"})):b&&b.error_message&&""!=b.error_message?this.showError(b.error_message):this.showError(h(21368))}.bind(this)})):this.showError(h(18160))},showError:function(b){this.popup.setErrors([{id:18160,message:b}])},hideError:function(){this.popup.setErrors([])}})}());toa.ns("toa.view.displayPluginLayoutParameter",function(){return toa.define(null,function(d){this._cmdAction=d.cmdAction;this._subAction=d.subAction;this._name=d.hasOwnProperty("parameter")?d.parameter.field:"";this._value=d.hasOwnProperty("parameter")?d.parameter.value:"";this._disabled=d.hasOwnProperty("parameter")?"disabled":"";this._parameterId=d.hasOwnProperty("parameterId")?d.parameterId:0;this._contextLayoutItemId=d.contextLayoutItemId;this._showWindow()},{_showWindow:function(){this._element=
$(this._template.apply({name:this._name,value:this._value,disabled:this._disabled}));var d=this._disabled?h(23675):h(18146);this._popup=new toa.ui.Popup({title:d,autoOpen:!1,modal:!0,onClose:this.destroy.bind(this),buttons:[{text:toa.glossary({id:290}),click:this.destroy.bind(this)},{id:"save_parameter_button",type:"submit",text:toa.glossary({id:12}),click:this._saveParameter.bind(this)}]});this._popup.setContent(this._element);this._popup.show()},_template:new toa.Template('<div class="display-layout-visibility-edit-dialog">,<div class="display-layout-visibility-edit-row">,<label>,<b> <%- toa.glossary({id : 19974})/* Name */ %></b>,<input type="text" name="name" class="parameter-value <%-disabled%>" <%-disabled%> value="<%-name%>" />,</label>,</div>,<div class="display-layout-visibility-edit-row">,<label>,<b> <%- toa.glossary({id : 19975})/* Value */ %></b>,<textarea name="value" class="parameter-value" rows="3" ><%-value%></textarea>,</label>,</div>,<div class="error" style="display: none;"></div>,</div>'.split(",")),
destroy:function(){this._popup.destroy()},_saveParameter:function(){var d=this._element.find("[name=name]").val().trim(),c=this._element.find("[name=value]").val().trim();c&&d?(this._popup.disableButton("save_parameter_button"),request({url:"?cmd="+this._cmdAction+"&sub="+this._subAction+"&action=layout_structure&id="+_DATA.company_settings_display_layout_structure.id+"&do=set_parameter&base_id="+this._contextLayoutItemId+"&par_id="+this._parameterId,data:{saveParameter:!0,param:{field:d,value:c,
is_plugin:!0}},responseHandler:function(b){this._popup.enableButton("save_parameter_button");b&&b.error_message&&""!=b.error_message?this._showError(b.error_message):b.saveResult?(this.destroy(),request({url:"?cmd="+this._cmdAction+"&sub="+this._subAction+"&action=layout_structure&id="+_DATA.company_settings_display_layout_structure.id+"&do=visibility_list&base_id="+this._contextLayoutItemId+"&output=ajax"})):this._showError("Save failed")}.bind(this)})):this._showError(r(18160))},_showError:function(d){this._element.find(".error").text(d).show()},
_hideError:function(){this._element.find(".error").hide()}})}());toa.ns("toa.view.displayLayoutValue",function(){var d="",c="",b="";return toa.define(null,function(b,c){this.propertiesList=c;this.value=b.value;this.identifier=b.contextLayoutItemField;this.valueTranslation=b.valueTranslation;this.cmdAction=b.cmdAction;this.subAction=b.subAction;this.contextLayoutItemId=b.contextLayoutItemId;this.valueId=b.valueId;this.newConditionCounter=1;this.valuesList=null;this.conditionTranslations={"in":toa.glossary({id:11456}),not_in:toa.glossary({id:11457}),contains:toa.glossary({id:11458}),
dcontain:toa.glossary({id:11459}),is_null:toa.glossary({id:11460}),is_not_null:toa.glossary({id:11461})};this.propertiesListLabel=toa.glossary({id:21069});this.conditionTranslationsListLabel=toa.glossary({id:3299});this.createPropertiesListSelect.bind(this)();this.createConditionsListSelect.bind(this)();this.createValuesListSelect.bind(this)();this.createDialogTemplate();this.conditions={};this.conditionsCounter=0;this.isEditModeOn=!1;if(b.conditions&&"web_change_activity_group"!==b.contextLabel&&
"web_cancel_activity_group"!==b.contextLabel){this.conditions=b.conditions;for(var d in this.conditions)this.conditionsCounter++}this.showWindow.bind(this)(b)},m={showWindow:function(e){var c=!this.conditionsCounter;if("web_change_activity_group"===e.contextLabel||"web_cancel_activity_group"===e.contextLabel)this.propertiesList={},c=!1;c=$(b.apply({isDisplayConditions:!!this.conditionsCounter,displayNoConditionMessage:c,conditions:this.conditions,conditionsTranslations:this.conditionTranslations,
areConditionsAllowed:!$.isEmptyObject(this.propertiesList),values:this.value?this.value:0,valueTranslation:hs(this.valueTranslation)}));e=e.contextLayoutItemName?toa.glossary({id:19544}).replace("{OBJECT}",e.contextLayoutItemName):"";this.dialogPopup=new toa.ui.Popup({title:e,autoOpen:!1,modal:!0,onClose:this.dialogDestroy.bind(this),buttons:[{text:toa.glossary({id:290}),click:this.dialogDestroy.bind(this)},{id:"save_value_button",type:"submit",text:toa.glossary({id:12}),click:this.saveValue.bind(this)}]});
this.dialogPopup.setContent(c);this.dialogPopup.show();$("#display-layout-add-value").on("click",this.addValue.bind(this));$("#display-layout-add-new-condition").on("click",this.addNewCondition.bind(this));$(".display-layout-visibility-condition-edit-button").on("click",this.onEditOneCondition.bind(this))},createDialogTemplate:function(){b=new toa.Template(['<div class="display-layout-visibility-edit-dialog">',"<div>",'<div class="display-layout-visibility-edit-row">',"<b>"+toa.glossary({id:11463})+
"</b>","</div>",'<div class="display-layout-visibility-edit-row">','<button id="display-layout-add-value" class="toa-button display-layout-visibility-condition-add-button display-layout-visibility-condition-add-value" aria-label="'+toa.glossary({id:222})+'"><div></div></button>','<input type="hidden" id="display-layout-values" value="<%=values%>" >','<div id="display-layout-visibilily-options-list" <% if (values == 0) print("style=\'display: none\'") %> ><%=valueTranslation%></div>','<div id="display-layout-visibilily-no-options" <% if (values != 0) print("style=\'display: none\'") %> >',
toa.glossary({id:11464}),"</div>","</div>",'<div class="display-layout-visibility-edit-row">','<b id="display-layout-visibilily-following-conditions" <% if (!isDisplayConditions) print("style=\'display: none\'") %> >'+toa.glossary({id:17084})+"</b>","</div>",'<div class="display-layout-visibilily-conditions" >',"<% for(var conId in conditions) { var condition=conditions[conId]; %>",'<div class="display-layout-visibility-condition" id="condition-<%=conId%>" data-id="<%=conId%>" >','<div class="condition-wrapper">',
'<span class="condition-field"><%=condition.fieldName%></span>','<span class="condition-item"><%=conditionsTranslations[condition.condition]%></span>','<span class="condition-value"></span>',"</div>",'<div class="condition-value-list-wrapper">','<span class="condition-value-list"><%= hs(condition.valueName) %></span>',"</div>",'<div class="display-layout-visibility-condition-edit-buttons">','<button class="toa-button display-layout-visibility-condition-edit-button" data-condition-id="<%=conId%>" aria-label="'+
toa.glossary({id:462})+'"><div></div></button>',"</div>","</div>","<% } %>","</div>",'<div class="display-layout-visibility-edit-row" id="display-layout-visibilily-no-conditions" <% if (!displayNoConditionMessage) print("style=\'display: none\'") %> >',toa.glossary({id:11454}),"</div>",'<div class="display-layout-visibility-edit-row" <% if (!areConditionsAllowed)print("style=\'display: none\'") %> >','<span role="link" class="turning" id="display-layout-add-new-condition" tabindex="0">'+toa.glossary({id:11455})+
"</span>",'<div id="display-layout-visibilily-error"></div>',"</div>","</div>","</div>"])},createPropertiesListSelect:function(){d&&d.remove();var b=[],c;for(c in this.propertiesList)b.push({propertyId:c,propertyText:this.propertiesList[c].pntext});b.sort(function(b,e){return b.propertyText.localeCompare(e.propertyText)});c=new toa.Template(['<select id="display-layout-properties-list" aria-label="<%=propertiesListLabel%>">',"<% for(var id = 0; id < propertiesList.length; id++) { var property=propertiesList[id]; %>",
'<option value="<%=property.propertyId%>"><%=property.propertyText%> [<%=property.propertyId%>]</option>',"<% } %>","</select>"]);d=$(c.apply({propertiesList:b,propertiesListLabel:this.propertiesListLabel}));d.on("change",function(){this.conditions[this.currentConditionId].value="";this.conditions[this.currentConditionId].valueName="";this.refreshOptionsList();this.showValueInput()}.bind(this))},createConditionsListSelect:function(){c&&c.remove();c=$(['<select id="display-layout-conditions-list">',
'<option value="in">'+this.conditionTranslations["in"]+"</option>",'<option value="not_in">'+this.conditionTranslations.not_in+"</option>",'<option value="contains">'+this.conditionTranslations.contains+"</option>",'<option value="dcontain">'+this.conditionTranslations.dcontain+"</option>",'<option value="is_null">'+this.conditionTranslations.is_null+"</option>",'<option value="is_not_null">'+this.conditionTranslations.is_not_null+"</option>","</select>"].join(""))},createValuesListSelect:function(){var b=
[],c=this.propertiesList[this.identifier].pnindex,d;for(d in c)b.push({optionId:d,optionText:hs(c[d])});b.sort(function(b,e){return b.optionText.localeCompare(e.optionText)});c=new toa.Template('<div id="display-layout-values-options-list">,<% for(var index in options) { var option = options[index] %>,<label>,<input type="checkbox" value="<%-option.optionId%>" data-shown-value="<%-option.optionText%>" <% if (option.optionId == currentValue) print("checked"); %> > <%-option.optionText%>,</label><br>,<% } %>,</div>'.split(","));
this.valuesList=$(c.apply({options:b,currentValue:this.value}));this.valuesList.delegate("input","click",function(b){var e=[],c=[];this.valuesList.find("input:checked").each(function(){e.push($(this).val());c.push($(this).data("shown-value"))});$("#display-layout-values").val(hs(e.join(",")));$("#display-layout-visibilily-options-list").html(hs(c.join(", ")));this.refreshNoValuesBlock(!e.length)}.bind(this));this.valuesList.Tip({minWidth:200,minHeight:50,zIndex:3020})},refreshNoValuesBlock:function(b){b?
($("#display-layout-visibilily-no-options").show(),$("#display-layout-visibilily-options-list").hide()):($("#display-layout-visibilily-no-options").hide(),$("#display-layout-visibilily-options-list").show())},dialogDestroy:function(){this.optionList&&this.optionList.Tip&&(this.optionList.Tip("destroy"),this.optionList.remove());this.valuesList&&this.valuesList.Tip&&(this.valuesList.Tip("destroy"),this.valuesList.remove());this.dialogPopup.destroy()},saveValue:function(){this.isEditModeOn&&this.applyConditionChanges();
var b=$("#display-layout-values").val();b||(b=0);this.dialogPopup.disableButton("save_value_button");request({url:"?cmd="+this.cmdAction+"&sub="+this.subAction+"&action=layout_structure&id="+_DATA.company_settings_display_layout_structure.id+"&do=set_value_visibility&base_id="+this.contextLayoutItemId,data:{saveValue:!0,values:b,valueId:this.valueId?this.valueId:0,conditions:this.conditions},responseHandler:function(b){this.dialogPopup.enableButton("save_value_button");b.saveResult?(this.dialogDestroy.bind(this)(),
request({url:"?cmd="+this.cmdAction+"&sub="+this.subAction+"&action=layout_structure&id="+_DATA.company_settings_display_layout_structure.id+"&do=visibility_list&base_id="+this.contextLayoutItemId+"&output=ajax"})):this.showError("Save failed")}.bind(this)})},showError:function(b){$("#display-layout-visibilily-error").html(b)},hideError:function(){$("#display-layout-visibilily-error").html("")},addNewCondition:function(){if(!this.isEditModeOn){this.currentConditionId="new-"+this.newConditionCounter;
this.newConditionCounter++;var b=new toa.Template(['<div class="display-layout-visibility-condition" id="condition-<%=conditionId%>" data-id="<%=conditionId%>" >','<div class="condition-wrapper">','<span class="condition-field"></span>','<span class="condition-item"></span>','<span class="condition-value"></span>',"</div>",'<div class="condition-value-list-wrapper">','<span class="condition-value-list"></span>',"</div>",'<div class="display-layout-visibility-condition-edit-buttons">','<button class="toa-button display-layout-visibility-condition-edit-button" data-condition-id="<%=conditionId%>" aria-label="'+
toa.glossary({id:462})+'"><div></div></button>',"</div>","</div>"]),b=$(b.apply({conditionId:this.currentConditionId}));b.find(".display-layout-visibility-condition-edit-button").on("click",this.onEditOneCondition.bind(this));$(".display-layout-visibilily-conditions").append(b);this.conditions[this.currentConditionId]={field:"",fieldName:"",condition:"",value:"",valueName:""};this.conditionsCounter++;this.refreshNoConditionBlock();this.editOneCondition()}},addValue:function(b){this.isEditModeOn||
(this.valuesList.Tip("showAt",b.target,"bottom"),b=parseInt($("#display-layout-values-options-list").parent().css("left"))+25,$("#display-layout-values-options-list").parent().css({left:b+"px"}),b=parseInt($("#display-layout-values-options-list").parent().css("height"))-20,700<b&&(b=700),$("#display-layout-values-options-list").parent().css({height:b+"px"}),$("#display-layout-values-options-list").css({"max-height":b+"px"}))},onEditOneCondition:function(b){this.currentConditionId=$(b.target).data("condition-id");
this.currentConditionId||(this.currentConditionId=$(b.target).parent().data("condition-id"));this.editOneCondition()},editOneCondition:function(){this.isEditModeOn=!0;var b=$("#condition-"+this.currentConditionId),g=this.conditions[this.currentConditionId];g||(g={field:"",condition:""});$(".display-layout-visibility-condition-edit-button").attr("disabled","disabled");$("#display-layout-add-value").attr("disabled","disabled");b.addClass("display-layout-visibility-condition-wide");b.find(".display-layout-visibility-condition-edit-button").hide();
var k=$(['<button class="toa-button display-layout-visibility-condition-apply-changes" id="display-layout-apply-changes" aria-label="'+toa.glossary({id:99})+'"><div></div></button>','<button class="toa-button" id="display-layout-delete-condition">'+toa.glossary({id:11462})+"</button>"].join(""));d.detach();c.detach();b.find(".condition-field").empty().append(d);b.find(".condition-item").empty().append(c);g.field&&d.val(g.field);g.condition&&c.val(g.condition);this.showValueInput.bind(this)();b.find(".display-layout-visibility-condition-edit-buttons").append(k);
$("#display-layout-apply-changes").on("click",this.applyConditionChanges.bind(this));$("#display-layout-delete-condition").on("click",this.deleteCondition.bind(this));this.refreshOptionsList()},showValueInput:function(){var b="",c=$("#condition-"+this.currentConditionId),b=d.val();if(this.isPropertyEnum(this.propertiesList[b])){$("#display-layout-add-enum").remove();$("#display-layout-add-enum-result").remove();var b=$('<button class="toa-button display-layout-visibility-condition-add-button" id="display-layout-add-enum" aria-label="'+
toa.glossary({id:222})+'"><div></div></button>'),k=$('<input type="hidden" id="display-layout-condition-text-value"> '),l=$('<span id="display-layout-add-enum-result">'+(this.currentConditionId&&this.conditions[this.currentConditionId]?this.conditions[this.currentConditionId].valueName:"")+"</span>");b.on("click",this.showEnumConditionValues.bind(this));c.find(".condition-value").empty().append(b).append(k);c.find(".condition-value-list").empty().append(l)}else $("#display-layout-condition-text-value").remove(),
b=$('<input type="text" id="display-layout-condition-text-value" style="width: 120px;" aria-label="'+toa.glossary({id:19525})+'">'),b.val(this.conditions[this.currentConditionId].value),c.find(".condition-value").empty().append(b),c.find(".condition-value-list").empty()},applyConditionChanges:function(){var b=d.val(),c="",k="";this.isPropertyEnum(this.propertiesList[b])?(c=$("#display-layout-condition-text-value").val(),k=$("#display-layout-add-enum-result").html()):(c=$("#display-layout-condition-text-value").val(),
k=hs(c));var l=this.correctConditions($("#display-layout-conditions-list").val(),c);if("is_null"==l||"is_not_null"==l)k=c="";this.conditions[this.currentConditionId]={field:b,fieldName:this.propertiesList[b].pntext,condition:l,value:c,valueName:k};this.hideEditConditionControls();this.showAppliedConditionValues.bind(this)();this.isEditModeOn=this.currentConditionId=!1},correctConditions:function(b,c){var d=b;""==c&&"in"==b?d="is_null":""==c&&"not_in"==b&&(d="is_not_null");return d},deleteCondition:function(){this.hideEditConditionControls();
delete this.conditions[this.currentConditionId];this.conditionsCounter--;this.refreshNoConditionBlock();$("#condition-"+this.currentConditionId).remove();this.isEditModeOn=!1},refreshNoConditionBlock:function(){this.conditionsCounter?($("#display-layout-visibilily-no-conditions").hide(),$("#display-layout-visibilily-following-conditions").show()):($("#display-layout-visibilily-no-conditions").show(),$("#display-layout-visibilily-following-conditions").hide())},hideEditConditionControls:function(){d.detach();
$("#display-layout-conditions-list").detach();$("#display-layout-apply-changes").remove();$("#display-layout-delete-condition").remove();$("#display-layout-add-enum").remove();$("#display-layout-condition-text-value").remove();$(".display-layout-visibility-condition-edit-button").removeAttr("disabled");$("#display-layout-add-value").removeAttr("disabled");var b=$("#condition-"+this.currentConditionId);b.removeClass("display-layout-visibility-condition-wide");b.find(".display-layout-visibility-condition-edit-button").show()},
showAppliedConditionValues:function(){if(this.currentConditionId){var b=$("#condition-"+this.currentConditionId),c=this.conditions[this.currentConditionId];b.find(".condition-field").empty().html(c.fieldName);b.find(".condition-item").empty().html(this.conditionTranslations[c.condition]);b.find(".condition-value-list").empty().html(c.valueName)}},showEnumConditionValues:function(b){this.optionList||this.refreshOptionsList();this.optionList.Tip("showAtWithIndex",b.target,"bottom",3020)},refreshOptionsList:function(){var b=
d.val();if(b&&this.propertiesList[b].pnindex&&this.currentConditionId){var c=this.conditions[this.currentConditionId].value,k=new toa.Template(['<div id="display-layout-enum-options-list">',"<% for(var index in options) { %>","<% if($.inArray(index, active) >= 0) { %>","<label>",'<input type="checkbox" value="<%-index%>" data-shown-value="<%=options[index]%>" <% if ($.inArray(index, currentValues) >= 0) print("checked"); %> > <%-options[index]%>',"</label><br>","<% } %>","<% } %>","</div>"]);this.optionList&&
this.optionList.Tip&&(this.optionList.Tip("destroy"),this.optionList.remove());this.optionList=$(k.apply({options:this.propertiesList[b].pnindex,currentValues:c?hs(c).split(","):"",active:hs(this.propertiesList[b].pnactive.join(",")).split(",")}));$("#display-layout-condition-text-value").val(c);this.optionList.delegate("input","click",function(b){var e=[],c=[];this.optionList.find("input:checked").each(function(){e.push($(this).val());c.push($(this).data("shown-value"))});$("#display-layout-condition-text-value").val(hs(e.join(",")));
$("#display-layout-add-enum-result").html(hs(c.join(", ")))}.bind(this));this.optionList.Tip({minWidth:200,minHeight:50})}},isPropertyEnum:function(b){return b&&"undefined"!==typeof b.pnindex&&!!b.pnindex}})}());(function(d){d.ns("toa.views.BaseView",d.define(null,function(c){this._childViews=null===this._childViews?[]:this._childViews;this.template=null===this.template?"":this.template;this.regions=null===this.regions?{}:this.regions;this.events=null===this.events?{}:this.events;this.tag=null===this.tag?"":this.tag;this.options=c||{};this.model=this.options.model;this.collectionModel=this.options.collectionModel;this._tpl=new d.Template(this.template);this.readOnlyMode=this.options.readOnlyMode||!1},$.extend({},
d.mixins.EventEmitter,{_childViews:null,template:null,regions:null,events:null,tag:null,setReadOnlyMode:function(c){this.readOnlyMode=c},render:function(c,b){b||c.empty();var e=$(this.getHtml());this._container=c;this._$el=0<e.length?e:c;c.append(e);this.initEvents();return this},getElement:function(){return this._$el},getContainer:function(){return this._container},getData:function(){var c=this.model&&this.model.toJSON?this.model.toJSON():{};c.readOnlyMode=this.readOnlyMode;return c},getHtml:function(){var c;
try{return c=this.getData(),this._tpl.apply(this.getData())}catch(b){throw console.error(b),console.error("Unable to render template",this._tpl,c),b;}},initEvents:function(){$.each(this.events,function(c,b){var e=this._$el,d=c.split(" ");if(1!==d.length&&2!==d.length||!d[0].length)throw Error("Incorrect description of event selector ("+c+")");var k=b;"string"===typeof b&&(k=this[b]);if(!k||"function"!==typeof k)throw Error('Incorrect event handler for selector "'+c+'"');2===d.length&&(e=d[1],e=this._$el.find(e).addBack().filter(e));
e.on(d[0],k.bind(this))}.bind(this))},showRegion:function(c,b){var e=this.regions[c],d=this._container.find(e).first();d.length||console.error("Couldn't find \""+c+'" region ("'+e+'")');b.render(d)},hide:function(){this._$el&&this._$el.hide()},show:function(){this._$el&&this._$el.show()},_notifyOnChild:function(c,b){var e=Array.prototype.slice.call(arguments);e[0]=b;e[1]=c;this.notify.apply(this,e)},_subscribeChildView:function(c){c.addListener("all",$.proxy(this._notifyOnChild,this,c))},clear:function(){this.getContainer()&&
this.getContainer().empty()},destroy:function(){$.isEmptyObject(this._childViews)||($.each(this._childViews,function(b,e){e.destroy.apply(e)}.bind(this)),this._childViews=[]);for(var c in this._events_uids)this.removeListener(parseInt(c));this._$el&&(this._$el.remove(),this._$el=null);this._container&&(this._container.remove(),this._container=null);this.notify("destroy",this)}})))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.views.BaseCollectionView",d.define(c,function(b){c.apply(this,arguments);this.collection=this.options.collection;this.model=this.options.model},{template:"",childRegion:"",childView:{},childSeparator:"",noItemsView:{},render:function(b,e){e||b.empty();this._childViews=[];this._noItemsView=null;c.prototype.render.apply(this,arguments);var d=this.getRegionContainer();this._renderCollection(d);this._container=b;return this},getRegionContainer:function(){var b=
this.childRegion;return b?this._container.find(b).first():this._container},_renderCollection:function(b){var e=this.collection.getCount();if(0==e&&this.noItemsView instanceof Function){var c=new this.noItemsView;c.setReadOnlyMode(this.readOnlyMode);c.render(b,!0);this._noItemsView=c}this.collection.each(function(c,d){var g=new this.childView({model:c,collection:this.collection});g.setReadOnlyMode(this.readOnlyMode);this._subscribeChildView(g);this._childViews.push(g);g.render(b,!0);this.childSeparator&&
d!==e-1&&b.append(this.childSeparator)},this)}}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.views.BaseForm",d.define(c,function(b){c.apply(this,arguments)},{validate:function(){this.hideErrors();var b=!1;$.each(this.validators,function(e,c){var d=this._container.find(c.selector);$.each(d,function(e,d){var k=this.validateField(d,c.rules);k&&k.length&&(this.showError(d,k),b=!0)}.bind(this))}.bind(this));return!b},validateField:function(b,e){var c="";$.each(e,function(e,d){var n=this[d+"FieldValidate"];if(n)return c=n.apply(this,[b])}.bind(this));
return c},mandatoryFieldValidate:function(b){b=$(b).val();var e="";""===$.trim(b)&&(e=h(15905));return e},showError:function(b,e){var c=$("<div>").addClass("infoError").text(e);$(b).after(c);$(b).parent().parent().addClass("invalid")},hideErrors:function(){this._container.find(".infoError").remove();this._container.find(".invalid").removeClass("invalid")},hideError:function(b){b=b.target;$(b).nextAll(".infoError").remove();$(b).parent().parent().removeClass("invalid")}}))})(toa);void 0===toa.date&&(toa.date=toa.datetime={firstDay:0,DAY_WITHOUT_DATE:"3000-01-01",DAY:864E5,MINUTES_IN_DAY:1440,clientServerDifference:0,timeWhileYesterdayRw:0,format:{iso:"Y-m-d",iso_long:"Y-m-d H:i:s",date:"m/d/y",date_short:"m/d",date_long:"l, F jS, Y",date_small:"M j",time:"h:i A",time_short:"h A",date_time:"d/m/y h:i A"},shortWeekdays:"Sun Mon Tue Wed Thu Fri Sat".split(" "),weekdays:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),months:"January February March April May June July August September October November December".split(" "),
create:function(d,c){if("number"!==typeof d)throw Error("toa.datetime.create: parameter isn't set or incorrect");"number"!==typeof c&&(c=0);var b=6E4*(c+(new Date(d)).getTimezoneOffset()),e=new Date(d+b);e.getTimestamp=function(){return this.getTime()-b+6E4*c};return e},init:function(){var d=this;d.weekdays=[h(331),h(332),h(333),h(334),h(335),h(336),h(337),h(331)];d.shortWeekdays=[h(1675),h(1669),h(1670),h(1671),h(1672),h(1673),h(1674)];d.ordin={};for(var c=300;330>=c;c++)d.ordin[c-299]=h(c);d.months=
[h(338),h(339),h(340),h(341),h(342),h(343),h(344),h(345),h(346),h(347),h(348),h(349)];for(var b in this.methods)c=this.methods[b],d[c]||(d[c]=function(){return d.date[arguments.callee.name].apply(d.date,[arguments])},d[c].name=c)},currentDate:function(d){var c=new Date;"number"!==typeof d&&(d=0);d=new Date(c.getTime()+6E4*d-this.clientServerDifference);d.getTimestamp=function(){return this.getTime()-6E4*this.getTimezoneOffset()};return d},yesterdayDate:function(d){var c=new Date;"number"!==typeof d&&
(d=0);return new Date(c.getTime()+6E4*d-this.clientServerDifference-this.DAY)},setUtcTime:function(d){if("number"!==typeof d)throw Error("toa.datetime.setUTCServerTime: parameter isn't set");this.clientServerDifference=(new Date).getTime()-1E3*(d+60*(new Date(1E3*d)).getTimezoneOffset())},methods:"parse toLocaleString getDate getDay getFullYear getMilliseconds getMinutes getSeconds getTimezoneOffset getUTCDate getUTCDay getUTCHours getHours getUTCMilliseconds getUTCMinutes getUTCSeconds setSeconds setFullYear setMilliseconds setTime setYear setDate setUTCDate setUTCHours setHours setUTCMilliseconds setUTCMinutes setMinutes setMonth setUTCSeconds setUTCFullYear setUTCMonth toGMTString toLocaleFormat toLocaleTimeString toLocaleDateString toString toTimeString toDateString toUTCString valueOf getUTCFullYear getYear getMonth UTC getUTCMonth getTime".split(" "),
_php2jq:{Y:"yy",m:"mm",d:"dd"},convertPhpFormatTojQuery:function(d){if(!toa.isString(d))return!1;for(var c="",b=d.length,e=0;e<b;++e)c=this._php2jq[d[e]]?c+this._php2jq[d[e]]:c+d.substring(e,e+1);return c},toValue:function(){return this.date.toValue()},toString:function(){return this.formatDate(this.format.date_time)},toDateString:function(){return this.formatDate(this.format.date)},toDateShortString:function(){return this.formatDate(this.format.date_short)},toDateLongString:function(){return this.formatDate(this.format.date_long)},
toTimeString:function(){return this.formatDate(this.format.time)},toTimeShortString:function(){return this.formatDate(this.format.time_short)},toDateTimeString:function(){return this.formatDate(this.format.date_time)},toDateSystemString:function(){return this.formatDate("Y-m-d")},toTimeSystemString:function(){return this.formatDate("h:i:s")},formatMeridian:function(d,c){d=this.format[d];var b=c.split(/\W+/),e=d.match(/[djmyYFhHDlPaAis]/g),g;for(g=0;g<b.length;++g)if(b[g])switch(e[g]){case "a":case "A":if(/pm/i.test(b[g])||
/am/i.test(b[g]))return b[g]}return""},parseDate:function(d,c){var b=this.currentDate();if(!c)return b;"undefined"!=typeof this.format[d]&&(d=this.format[d]);var e=Number.NaN,g=Number.NaN,k=Number.NaN,l=c.split(/\W+/),n=d.match(/[djmyYFhHDlPaAis]/g),p,s,t=Number.NaN,u=Number.NaN,v=Number.NaN;for(p=0;p<l.length;++p)if(l[p])switch(n[p]){case "d":case "j":k=parseInt(l[p],10);break;case "m":g=parseInt(l[p],10);if(1>g||12<g)throw"Month range";break;case "Y":case "y":e=parseInt(l[p],10);100>e&&(e+=29<e?
1900:2E3);break;case "F":for(s=0;12>s;++s)if(this.months[s].substr(0,l[p].length).toLowerCase()==l[p].toLowerCase()){g=s+1;break}if(isNaN(g))throw"Month name doesnt match "+l[p];break;case "h":case "H":t=parseInt(l[p],10);if(0>t||23<t)throw"Hours range";break;case "a":case "A":/pm/i.test(l[p])&&12>t?t+=12:/am/i.test(l[p])&&12<=t&&(t-=12);if(0>t||23<t)throw"Hours range";break;case "i":u=parseInt(l[p],10);if(0>u||59<u)throw"Minutes range";break;case "s":if(v=parseInt(l[p],10),0>v||59<v)throw"Seconds range";
}if((isNaN(e)||isNaN(g)||isNaN(k))&&(isNaN(t)||isNaN(u)))throw"Mising main part of date or time";isNaN(e)&&(e=b.getFullYear());isNaN(g)&&(g=b.getMonth()+1);isNaN(k)?(isNaN(t)&&(t=b.getHours()),isNaN(u)&&(u=b.getMinutes()),isNaN(v)&&(v=0),k=b.getDate()):(isNaN(t)&&(t=0),isNaN(u)&&(u=0),isNaN(v)&&(v=0));if(0!=e&&0!=g&&0!=k)return b=new Date(e,g-1,k,t,u,v),0===t&&(b=this.daylightSavingAdjust(b)),b;e=0;g=-1;for(p=k=0;p<l.length;++p)if(-1!=l[p].search(/[a-zA-Z]+/)){for(s=n=0;12>s;++s)if(this.months[s].substr(0,
l[p].length).toLowerCase()==l[p].toLowerCase()){n=s+1;break}0!=n&&(0!=g&&(k=g),g=n)}else 12>=parseInt(l[p],10)&&0==g?g=l[p]:31<parseInt(l[p],10)&&0==e?(e=parseInt(l[p],10),100>e&&(e+=29<e?1900:2E3)):0==k&&(k=l[p]);0==e&&(e=b.getFullYear());return 0!=g&&0!=k?new Date(e,g-1,k,t,u,v):b},formatDate:function(d,c){var b=this,e=c||b.date||b.currentDate();d=b.format[d]||d;var g=function(b,e){return(b+="").length<e?Array(++e-b.length).join("0")+b:b};d=d.replace("jS","S");var k={d:function(){return g(k.j(),
2)},D:function(){return k.l().substr(0,3)},j:function(){return e.getDate()},l:function(){return b.weekdays[k.w()]},N:function(){return k.w()+1},S:function(){return b.ordin[k.j()]?b.ordin[k.j()]:"th"},w:function(){return e.getDay()},z:function(){return(e-new Date(e.getFullYear()+"/1/1"))/864E5>>0},W:function(){var b=k.z(),d=364+k.L()-b,g=((new Date(e.getFullYear()+"/1/1")).getDay()||7)-1;return 2>=d&&(e.getDay()||7)-1<=2-d?1:2>=b&&4<=g&&b>=6-g?(b=new Date(e.getFullYear()-1+"/12/31"),c("W",Math.round(b.getTime()/
1E3))):1+(3>=g?(b+g)/7:(b-(7-g))/7)>>0},F:function(){return b.months[k.n()-1]},m:function(){return g(k.n(),2)},M:function(){return k.F().substr(0,3)},n:function(){return e.getMonth()+1},t:function(){var b;return 2==(b=e.getMonth()+1)?28+k.L():b&1&&8>b||!(b&1)&&7<b?31:30},L:function(){var b=k.Y();return b&3||!(b%100)&&b%400?0:1},Y:function(){return e.getFullYear()},y:function(){return(e.getFullYear()+"").slice(2)},a:function(){return 11<e.getHours()?"pm":"am"},A:function(){return k.a().toUpperCase()},
B:function(){var b=60*(e.getTimezoneOffset()+60),b=3600*e.getHours()+60*e.getMinutes()+e.getSeconds()+b,b=Math.floor(b/86.4);1E3<b&&(b-=1E3);0>b&&(b+=1E3);1==String(b).length&&(b="00"+b);2==String(b).length&&(b="0"+b);return b},g:function(){return e.getHours()%12||12},G:function(){return e.getHours()},h:function(){return g(k.g(),2)},H:function(){return g(e.getHours(),2)},i:function(){return g(e.getMinutes(),2)},s:function(){return g(e.getSeconds(),2)},O:function(){var b=g(Math.abs(e.getTimezoneOffset()/
60*100),4);return b=0<e.getTimezoneOffset()?"-"+b:"+"+b},P:function(){var b=k.O();return b.substr(0,3)+":"+b.substr(3,2)},c:function(){return k.Y()+"-"+k.m()+"-"+k.d()+"T"+k.h()+":"+k.i()+":"+k.s()+k.P()},U:function(){return Math.round(e.getTime()/1E3)}};return d.replace(/[\\]?([a-zA-Z])/g,function(b,e){return b!=e?e:k[e]?k[e]():e})},daylightSavingAdjust:function(d){if(!d)return null;d.setHours(12<d.getHours()?d.getHours()+2:0);return d},getArrayMonth:function(d,c){var b=(new Date(d,c+1,0)).getDate(),
e=[],g=null,k;for(k=1;k<=b;k++)g=new Date(d,c,k),g=this.daylightSavingAdjust(g),e.push(g);return e},isHoliday:function(d){d=(new Date(d)).getDay();return 0==d||6==d?!0:!1},getCountDayYear:function(d){return 0===d%4&&0!==d%100||0===d%400||0===d?366:365},getNumDayYear:function(d){var c,b=0;for(c=0;c<d.getMonth();c++)b+=(new Date(d.getFullYear(),c,0)).getDate();return b+=d.getDate()},getMonthTable:function(d,c,b){var e=this.getArrayMonth(d,c),g=[],k=[];if(b)var l=this.getArrayMonth(d,c-1),n=this.getArrayMonth(d,
c+1);for(c=this.firstDay;e.length&&"undefined"!=typeof this.firstDay;)d=e[0],c==d.getDay()?(k.push(d),e.shift()):k.push(null),c++,7==c&&(c=0),c==this.firstDay&&(g.push(k),k=[]);if(b)for(e=6;0<=e;e--)null==g[0][e]&&(g[0][e]=l.pop());for(e=k.length;7>e;e++)b?k.push(n.shift()):k.push(null);g.push(k);for(e=g.length;6>e;e++)if(b){k=[];for(l=0;7>l;l++)k.push(n.shift());g.push(k)}else g.push([null,null,null,null,null,null,null]);return g},getListDay:function(){var d=[],c,b;b=this.firstDay;for(c=0;6>=c;c++)6<
b&&(b=0),d.push(b),b++;return d},countWeekYear:function(d){var c=this.getCountDayYear(d)/7;d=new Date(d,11,31);c=Math.floor(c);d.getDay()<this.firstDay()&&c++;return c},countWeekMonth:function(d,c){var b;b=this.calculateNumWeek(d,c,1);return this.calculateNumWeek(d,c+1,0)-b},calculateNumWeek:function(d){return Math.ceil(this.getNumDayYear(d)/7)},calculateNumWeekFromTheBegining:function(d){d=parseInt((d-this.parseDate("iso","1970-01-01"))/this.DAY,10);return parseInt((4+d)/7,10)},convertTimeTo24:function(d){var c=
[],b=[],e;e="";if(-1!=d.indexOf(":"))e=":";else if(-1!=d.indexOf(" "))e=" ";else if(!isNaN(parseInt(d,10))&&24>parseInt(d,10))b[0]=parseInt(d,10);else return d;e.length&&(b=d.split(e,3));for(var g in b)e=parseInt(b[g],10),c[g]=!isNaN(e)&&60>e&&0<=e?e:"00";-1!=d.toLowerCase().indexOf("am")&&12==c[0]&&(c[0]="00");-1!=d.toLowerCase().indexOf("pm")&&12>c[0]&&(c[0]+=12);if(3>=c.length&&24>c[0]){for(var k in c)10>c[k]&&"00"!==c[k]&&(c[k]="0"+c[k]);1==c.length&&c.push("00");return c.join(":")}return d},
setTimeWhileYesterdayRw:function(d){this.timeWhileYesterdayRw=1E3*d},isDateNotArchived:function(d,c){if("undefined"===typeof c||null===c)return!1;var b=this.parseDate("iso",d),e=this.currentDate(c),g=this.currentDate(c);g.setHours(0,0,0,0);var k=this.create(g.getTimestamp()+this.timeWhileYesterdayRw),l=this.create(g.getTimestamp()-this.DAY);return b<=g&&b>=l&&k>=e||b>=g},formatAdaptive:function(d,c){if(!d)return"";var b="",e;"string"===typeof d&&(d=this.parseDate("iso_long",d));c!==this.formatDate("iso",
d)&&(b=this.formatDate("date_small",d)+", ");e=this.formatDate("time",d);if(-1!==e.indexOf("AM")||-1!==e.indexOf("PM"))e=e.replace(":00","");return b+e},getDatesOffset:function(d,c){var b=this.parseDate("iso",d),b=(this.parseDate("iso",c)-b)/this.DAY;return 0.95<b%1&&1>b%1?Math.round(b):Math.floor(b)},getDateFromDateTime:function(d){return d?d.substr(0,10):""}});toa.ns("toa.helper.resourceTree.Droppable",toa.define(null,function(d,c){this.panel=c;this.container=this.panel.container;this.sandbox=d;this.makeDroppable()},{makeDroppable:function(d){var c=this;this.container.droppable({accept:function(b){return b.attr("[data-pid]")||b.attr("[data-label-pid]")||b.attr("[aid]")||"false"!=b.attr.movable?!0:!1},tolerance:"pointer",dragmove:function(b,e){var d=e.helper.attr("aid"),k=e.helper.attr("data-label-pid"),l=e.helper.data("selfController"),n;if(k||d){n=$(b.originalEvent.target||
b.target);var p=n.closest("[data-label-pid]","[data-id]");if(p.length){n=p.attr("data-label-pid");if(d){var s=toa.helper.activity.getActivityFromElement(e.helper),k=c.getResourceFromTreeState(n),s=s.checkMove(e.helper,k,c.panel.state.getDate()),d="undefined"!=typeof l&&1!=l.currentItem&&1<l.selectedCount&&null==l.currentItem||-1!==d.search(",");if(!s)return!1;if(d){d=!1;if("undefined"!=typeof l&&"undefined"!=typeof l.selected)for(var t in l.selected)if(l.selected[t]._v&&"multiday_activity_segment"==
l.selected[t]._v.T){d=!0;break}s=d||e.helper[0].hasAttribute("has-multiday-activity")?{result:!1,message:h(15083)}:s.groupResult?{result:!0,message:h(5579)}:{result:!1,message:s.message}}e.helper.data("hint").setAccept(s.result,s.message,p);return!1}k&&(s=c.checkMoveProvider(n,k));l=5579==s||8068==s||8069==s;e.helper&&e.helper.data("hint")&&e.helper.data("hint").setAccept(l,h(s),p)}else e.helper&&e.helper.data("hint")&&e.helper.data("hint").setDefault(),n.is(".edt-open.icr.ptplus")&&n.trigger("click")}},
out:function(b,e){e.helper&&e.helper.data("hint")&&e.helper.data("hint")&&e.helper.data("hint").setDefault()},drop:function(b,e){var d=e.helper.attr("aid"),k=e.helper.attr("data-label-pid"),l="undefined"!=typeof e.helper&&"undefined"!=typeof e.helper.data("selfController")?e.helper.data("selfController"):{currentItem:1};if(k||d){var n=$(b.originalEvent.target||b.target).closest("[data-label-pid]","li");if(n.length){var p=n.attr("data-label-pid"),n=c.panel.state.getDate();if(d){var k=toa.helper.activity.getActivityFromElement(e.helper),
s=c.getResourceFromTreeState(p);1!==parseInt(e.helper.attr("multiday"),10)&&n||(n=k.get("date"));var t=k.checkMove(e.helper,s,n),d="undefined"!=typeof l&&1!=l.currentItem&&1<l.selectedCount&&null==l.currentItem||-1!==d.search(",");if(!t)return!1;if(d&&!t.groupResult||!t.result&&!d)return toa.app.trigger("global.hint.hide"),toa.ui.Alert({text:hs(t.message)}),!1;if(d&&"undefined"!=typeof l&&"undefined"!=typeof l.selected)for(var u in l.selected)if(l.selected[u]._v&&"multiday_activity_segment"==l.selected[u]._v.T)return!1;
if(d&&e.helper[0].hasAttribute("has-multiday-activity"))return!1;var v=toa.helper.activity.prepareAidsToMove(k.get("aid"),k.get("pid"),k.get("date"),e.helper),l=toa.app.model("companySettings").getActionsDesc("move_activity_group")||{},w=["controller="+(l.controller||"ActivitiesGroup"),"method="+(l.method||"move"),"target_pid="+p,"target_date="+n];1==parseInt(e.helper.attr("multiday"),10)||!!s.get("FLAGS")&toa.Resource.prototype.ON_CALL_PROVIDER&&!s.isFlagSet(s.get("FLAGS"),toa.Resource.prototype.REGULAR_PROVIDER)||
w.push("move_immediately=true");v.targetDate=k.get("date");this.moveMultidayActivity=new toa.ActivitiesScreen.views.MoveMultidayActivity;var x=toa.app.model("routeService");x.moveActivity(w,v).then(function(b){b.hasOwnProperty("multidayActivity")&&(v=$.extend(!0,v,b),this.moveMultidayActivity.render(v))}.bind(this),function(b){console.log("error promise (check for move activity)",arguments)}.bind(this));this.moveMultidayActivity.addListener("move.multiday.activity",function(b,e){v=$.extend(!0,v,e);
x.moveActivity(w,v).then(function(b){b.multidayActivity.hasOwnProperty("moveResult")&&!0!==b.multidayActivity.moveResult?toa.ui.Alert({text:toa.glossary({id:15343})}):c.sandbox.trigger("global.interface.refresh")}.bind(this),function(b){console.log("error promise (move activity)",arguments)}.bind(this))}.bind(this));e.helper&&e.helper.data("hint")&&e.helper.data("hint")&&e.helper.data("hint").setDefault();return!1}if(k){l=c.checkMoveProvider(p,k);if(8068==l){var y={change_pid:k,new_parent:p};if(c.panel&&
c.panel.state&&c.panel.state.identifier){y.trees={};if(c.sandbox.controller&&"function"==typeof c.sandbox.controller.isTwoPanelsVisible&&c.sandbox.controller.isTwoPanelsVisible())for(s in c.sandbox.controller.panels)c.sandbox.controller.panels[s]&&c.sandbox.controller.panels[s].treeState&&"string"==typeof c.sandbox.controller.panels[s].treeState.identifier&&(y.trees[c.sandbox.controller.panels[s].treeState.identifier]={});else y.trees[c.panel.state.identifier]={};try{toa.app.model("resourceTreeManager").updateRequest(y)}catch(z){toa.app.error(Error("ResourceTreeUtils: can't get resourceTreeManager"))}}toa.ui.Confirm({text:h(5658),
acceptButtonHandler:function(){c.sandbox.trigger("global.data.get",{controller:"Provider",method:"reassign",params:y,responseHandler:function(){this.panel.scrollToShow(p)}.bind(c)})}.bind(this)})}else 8069==l?(l={action:"create_teamwork",pid:k,actionOptions:{},date:n},isMobilityAction(l.action,l)?(l.actionOptions.parameters=[{field:"1.a_teamid",value:p},{field:"1.aworktype_filter",value:app.activity.ActivityEntity.prototype.ACTIVITY_FEATURE_TEAMWORK}],invokeMobilityScreen(l)):c.sandbox.trigger("global.data.get",
{url:"?entity_action=create_teamwork&pid="+k+"&a_teamid_pid="+p+"&date="+n+"&is_teamwork=true"})):(toa.app.trigger("global.hint.hide"),toa.ui.Alert({text:h(l)}));e.helper&&e.helper.data("hint")&&e.helper.data("hint")&&e.helper.data("hint").setDefault();return!1}}else e.helper&&e.helper.data("hint")&&e.helper.data("hint").setDefault()}}})},checkMoveProvider:function(d,c){if(!d||!c)return 8211;if(d==c)return 226409;var b=this.panel.state.get(d),e=this.panel.state.get(c);e||(e="top"===this.panel.options.position?
this.sandbox.controller.panels.bottom.tree.state.get(c):this.sandbox.controller.panels.top.tree.state.get(c));b&&e||!toa.app.model("resourceTreeManager")._treeStates||$.each(toa.app.model("resourceTreeManager")._treeStates,function(g,k){b||(b=k.get(d));e||(e=k.get(c));if(b&&e)return!1});if(!e)return 8211;var g,k=e.get("FLAGS")&e.ACTIVE_PROVIDER;g=b.get("FLAGS")&b.ACTIVE_PROVIDER;if(_DATA.teamwork_support&&b.hasOption(b.PROVIDER_FEATURE_ALLOW_TO_BE_A_TEAMHOLDER)&&e.hasOption(b.PROVIDER_FEATURE_ALLOW_TO_ASSIST_TO)&&
k&&g)return 8069;if(0!=d){g=d;do g=this.getResourceFromTreeState(g),g=g.getParent();while(0!=g&&g!=c);if(g==c)return 12201}return a("provider_parent")&&b.isAllowChild()&&e.getParent()!=d?8068:_DATA.teamwork_support&&e.hasOption(e.PROVIDER_FEATURE_ALLOW_TO_ASSIST_TO)&&k?8211:8212},getResourceFromTreeState:function(d){var c=this.panel.state.get(d);!c&&toa.app.model("resourceTreeManager")._treeStates&&$.each(toa.app.model("resourceTreeManager")._treeStates,function(b,e){c||(c=e.get(d));if(c)return!1});
return c}}));toa.clone=function(d,c){if(!d||"object"!==typeof d)return d;"object"!==typeof c&&(c="function"===typeof d.pop?[]:{});var b,e;for(b in d)d.hasOwnProperty(b)&&(e=d[b],c[b]=e&&"object"===typeof e?toa.clone(e,c[b]):e);return c};toa.safeExtend=function(d){for(var c=1;c<arguments.length;c++)toa.clone(arguments[c],d);return d};toa.flipHash=function(d){var c={};if($.isArray(d))for(var b=0;b<d.length;b++)c[d[b]]=b;else for(b in d)c[d[b]]=b;return c};toa.trim=function(d){return d.replace(/^\s\s*/,"").replace(/\s\s*$/,"")};toa.removeTags=toa.stripHtml=function(d){return $("<span/>").text(d).text()};toa.ltrim=function(d,c){c=c?c.replace(/([\[\]\(\)\.\?\/\*\{\}\+\$\^\:])/g,"$1"):" s\u00a0";return d.replace(RegExp("^["+c+"]+","g"),"")};toa.toHtmlSafe=function(d){var c=document.createElement("span");c.appendChild(document.createTextNode(d));return c.innerHTML};
toa.toHtml=function(){var d={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;","/":"&#x2f;"},c=/[&><"'\/]/g;return function(b,e){if(!b)return b;if(void 0!=e){var g={};for(i=0;i<e.length;i++)g[e[i]]=toa.toHtml(e[i]);b=b.replace(c,function(b){return d[b]});for(j in g)b=b.replace(RegExp(g[j],"gi"),j);return b}return b.toString().replace(c,function(b){return d[b]})}}();
toa.htmlWrap=function(d,c,b){for(var e="",g="";-1!==(g=d.toLocaleLowerCase().indexOf(c.toLocaleLowerCase()));)e+=toa.toHtml(d.substr(0,g)),e+=b.replace(/%s/,toa.toHtml(d.substr(g,c.length))),d=d.substr(g+c.length);return e+toa.toHtml(d)};
toa.strtr=function(d,c,b){var e=[],g=[],k;for(k in c)e.push(k),g.push(c[k]);c=d.length;k=e.length;for(var l="",n=!1,p="",s=0;s<c;s+=1){for(var n=!1,t=0;t<k;t+=1)if(d.substr(s,e[t].length)==e[t]){n=!0;s=s+e[t].length-1;break}!1===n?p+=d.charAt(s):(l+=(b&&b(p)||p)+g[t],p="")}p&&(l+=b&&b(p)||p);return l};
toa.glossary=function(d){var c;c=toa&&toa.app&&toa.app.error?toa.app.error.bind(toa.app):function(){};if(!d.id&&!d.page)return!1;if("undefined"==typeof _DATA&&"undefined"!=typeof window.parent._DATA)_DATA=window.parent._DATA;else if("undefined"==typeof _DATA)return"undefined["+(d.id||d.page)+"]";if(d.page&&"undefined"==typeof _DATA.glossary[d.page])return c("JavaScript translation page "+d.page+" is missed"),"undefined page["+d.page+"]";if(d.id&&"undefined"==typeof(d.page?_DATA.glossary[d.page]:_DATA.glossary)[d.id]){var b=
d.page?' for page "'+d.page+'"':"";c("JavaScript placeholder "+d.id+" is missed"+b);return"undefined["+d.id+b+"]"}c=d.page?d.id?_DATA.glossary[d.page][d.id]:_DATA.glossary[d.page]:_DATA.glossary[d.id];"object"==typeof c&&(c=jQuery.extend({},c));if(d.type&&"htmlexceptplaceholder"==d.type.toLowerCase()&&d.translations)if("string"==typeof c)c=toa.strtr(c,d.translations,function(b){return toa.toHtml(b)});else{if("object"==typeof c)for(b in c)c[b]=toa.strtr(c[b],d.translations,function(b){return toa.toHtml(b)})}else{if(d.translations)if("string"==
typeof c)c=toa.strtr(c,d.translations);else if("object"==typeof c)for(b in c)c[b]=toa.strtr(c[b],d.translations);if(!d.type||"html"==d.type.toLowerCase()||"raw"!==d.type.toLowerCase())if("string"==typeof c)c=toa.toHtml(c);else if("object"==typeof c)for(b in c)c[b]=toa.toHtml(c[b])}return c};toa.capitaliseFirstLetter=function(d){return toa.isString(d)&&d.charAt(0).toUpperCase()+d.slice(1)};toa.escapeRegExp=function(d){return d.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")};
toa.multilineEllipsis=function(d,c){var b;b=d.split(/\r?\n/);return b.length>c?b.slice(0,c).join("\n")+"\n...":d};window.toa||(window.toa={});toa.isDefined=function(d){return"undefined"!=typeof d};toa.isUndefined=function(d){return"undefined"==typeof d};toa.isString=function(d){return"string"==typeof d};toa.isFunction=function(d){return"function"==typeof d};toa.isArray=function(d){return"[object Array]"=={}.toString.call(d)};toa.isBoolean=function(d){try{return"[object Boolean]"=={}.toString.call(d)}catch(c){return"boolean"==typeof d}};toa.isObject=function(d){return"object"==typeof d};
toa.isInteger=function(d){return d===+d&&d===(d|0)};
toa.isDeepEquals=function(d,c,b){b=b||[];if(d===c)return 0!==d||1/d==1/c;if(null==d||null==c)return d===c;d.isEqual&&$.isFunction(d.isEqual)&&d.isEqual(c);c.isEqual&&$.isFunction(c.isEqual)&&c.isEqual(d);var e=Object.prototype.toString,g=e.call(d);if(g!=e.call(c))return!1;switch(g){case "[object String]":return d==String(c);case "[object Number]":return d!=+d?c!=+c:0==d?1/d==1/c:d==+c;case "[object Date]":case "[object Boolean]":return+d==+c;case "[object RegExp]":return d.source==c.source&&d.global==
c.global&&d.multiline==c.multiline&&d.ignoreCase==c.ignoreCase}if("object"!=typeof d||"object"!=typeof c)return!1;for(e=b.length;e--;)if(b[e]==d)return!0;b.push(d);var e=0,k=!0;if("[object Array]"==g){if(e=d.length,k=e==c.length)for(;e--&&(k=e in d==e in c&&toa.isDeepEquals(d[e],c[e],b)););}else{if("constructor"in d!="constructor"in c||d.constructor!=c.constructor)return!1;for(var l in d)if(d.hasOwnProperty(l)&&(e++,!(k=c.hasOwnProperty(l)&&toa.isDeepEquals(d[l],c[l],b))))break;if(k){for(l in c)if(c.hasOwnProperty(l)&&
!e--)break;k=!e}}b.pop();return k};toa.ns("toa.helper.activity",{createActivityBar:function(d,c,b,e,g){var k,l,n,p=d.duration(),s=d.travelTime();k=d.travelTime();l=d.fullDuration();n=d.color();g&&240<l&&(k<=p?(s=Math.min(120,k),p=240-s):(p=Math.min(120,p),s=240-p));g=toa.utils.color.darken(toa.utils.color.hexToRgb(n),0.2,"grey");var t=Math.round(b*s);b=Math.max(Math.round(b*(p+s)),3)-2;return toa.TemplateCache.create("views/activity/createActivityBar",'<div role="button" aria-dropeffect="move" data-id="a_<%= aid %>" ,   class="toaGantt-tb <%- longWidth %>" ,   aid="<%= aid %>" ,   tabindex="0" ,   par_pid="<%= a.get("pid") %>" ,   par_date="<%= a.get("DATE") %>" ,   ordered="<%= a.get("ordered") %>" ,   start="<%= a.getTravelStart() %>" ,   dur="<%= allDuration %>" ,   movable="<%= movable %>" ,   multiday="<%= multiday %>" ,   data-activity-eta="<%= a.get("ETA") %>" ,   data-activity-status="<%= a.get("status") %>" ,   data-activity-type="<%= a.get("type") %>" ,   data-activity-worktype="<%= a.get("worktype") %>" ,   data-master-id="<%= a.get("master_id") %>" ,   data-activity-duration="<%= a.get("duration") %>" ,   aria-label="<%= a.get("status") %> <%= a.get("type") %> <%- a.get("label") || "" %> activity",   style="left: <%= left %>px;,       width: <%= activityWidth %>px;,       background-color: <%= activityColor %>;,       border-color: <%= borderColor %>;,       z-index: <%= (travelWidth) ? zIndex : zIndex + 1000 %>,   ",   >,   <div class="toaGantt-tb-travel",       dur="<%= travelTime %>",       style=",           width: <%= travelWidth %>px;,           background-color: <%= travelColor %>;,       ",   ></div>,   <%- a.get("label") %>,</div>'.split(",")).apply({a:d,
aid:d.getId(),allDuration:l,travelTime:k,movable:d.isMovable()||d.isAllowReschedule()||d.isNotScheduledSupport()?"1":"0",left:c||0,activityColor:n,multiday:e?1:0,borderColor:g,activityWidth:b,travelWidth:t,travelColor:"#"+d.settings.getTravelTimeColor(),longWidth:240<l?"toaGantt-tb-long":"",zIndex:2E3})},createParallelTravel:function(d,c,b,e){var g=0,k=g=0,l=0,n=[],p;for(p in d)n.push(d[p]);n=n.reverse();for(p in n)if(g=parseInt(p),n.hasOwnProperty(g)){d=n[g];var l=b.data.activities[d],k=l.get("ETA"),
s=l.get("travel");0!==s&&(this.parallelTravelStart=k-s,this._callParallelTravel(n,g,b.data.activities),this.parallelTravelStart&&(void 0===e?g=b._timeToView(this.parallelTravelStart,!0)+b.getElementOffset():(g=b.data.days[e].min_time-b.timeBorder,g=b._timeToView(this.parallelTravelStart-g,!0)),k=b._timeToView(k-this.parallelTravelStart),l=b._timeToView(l.getEnd()-this.parallelTravelStart),d=c.find('div[aid="'+d+'"]'),d.css("z-index",1999),d.css("left",g+"px"),d.css("width",l+"px"),d.find(".toaGantt-tb-travel").css("width",
k+"px")),delete this.parallelTravelStart)}},_callParallelTravel:function(d,c,b){c+=1;if(d.hasOwnProperty(c))for(var e=b[d[c]];e.get("ETA")===e.getTravelStart();)if(this.parallelTravelStart<=e.getEnd())if(this.parallelTravelStart-=e.get("duration"),c++,d.hasOwnProperty(c))e=b[d[c]];else break;else break},getActivityFromElement:function(d){if(d.data("activity"))return d.data("activity");var c=d.attr("aid")||0,c=new toa.Activity({aid:c});c.set("date",d.attr("par_date")||d.attr("data-activity-date")||
d.attr("data-date")).set("pid",parseInt(d.attr("par_pid")||d.attr("data-activity-pid"),10)||0).set("type",d.attr("data-activity-type")||"regular").set("worktype",parseInt(d.attr("data-activity-worktype"),10)||0).set("eta",parseInt(d.attr("data-activity-eta"),10)||0).set("ordered",!0===d.attr("ordered")||"true"===d.attr("ordered")||1===d.attr("ordered")||"1"===d.attr("ordered")||!1).set("status",d.attr("data-activity-status")||"pending");d.data("activity",c);return c},prepareAidsToMove:function(d,
c,b,e){var g={},k={};if(e&&e.attr("data-date")){var g=d.split(","),l={},n;for(n in g)l[g[n]]={aid:g[n],pid:c,date:b};k={content_url:_DATA.content_url,aid:l,date:b,pid:c}}else if("undefined"==typeof e||null==e||"undefined"==typeof e.data("selfController"))k={content_url:_DATA.content_url,aid:{}},k.aid[d]={date:b,pid:c};else{b=e.data("selfController");c=b.getSelectedRows();b=b.getOption("groupActions");for(l in c.aid)n=c.aid[l],g[n._v.z]={date:n._v.D,pid:n._v.p,mask:n._g};k=!c.exclude_aid||c.singleItem?
{content_url:_DATA.content_url,aid:g,groupActions:b}:{content_url:_DATA.content_url,aid:g,date:c.date,pid:c.pid,filters:c.filters,action_type:"exclude",selectedCount:c.selectedCount}}k.moveFromAid=d;return k},makeDraggable:function(d,c){var b=$(d.target).closest(".toaGantt-tb,.toa-make-draggable,.monthGantt-tb"),e=b.attr("aid");if(!toa.dom.isTouch&&1!=d.which)return!1;if(!e||b.data("draggable"))return!0;var e=b.clone(!0),g=e.find(".toaGantt-tb-travel"),k=parseInt(b.data("activity-duration")),l=parseInt(g.attr("dur"))||
0;e.width(k+l);g.width(l);var n=b.parents(":eq(6)").data("selfController");$("#dnd-draggable-save-container").empty().append(e);e.draggable({helper:function(b,e){var c=(new toa.DnDHint($(this),$(this),h(5579))).getHint();c.data("selfController",n||$(b.target).data("selfController"));return c},revert:!1,appendTo:_DATA.dispatcher_container,dragmove:!0,dropIntoUpper:!0,connectToSortable:'[name="activity-drop-target"]',cursorAt:{cursor:"hand",top:-5,left:-5},start:function(e,c){_DATA.ipadDrag=!0;if("undefined"!=
typeof c.helper&&"undefined"!=typeof c.helper.data("selfController"))c.helper.data("selfController").onDraggStart(b,c);if(b.attr("movable"))b.addClass("toaGantt-tb-moved");else{var d=b.css("background-color");d&&"transparent"!==d&&b.animate({"background-color":"#FF0000"},100).animate({"background-color":d},400).addClass("toaGantt-tb-moved")}},stop:function(e,c){_DATA.ipadDrag=!1;if("undefined"!=typeof c.helper&&"undefined"!=typeof c.helper.data("selfController"))c.helper.data("selfController").onDraggEnd(b);
b.removeClass("toaGantt-tb-moved")}});toa.dom.isTouch&&(toa.touch.setTouchDraggable(e),toa.touch.setTouchDraggable($(".toaGantt")),toa.touch.setTouchDraggable($("div.toa-layout-fullfit.toa-view-control-grid-grid")));"repeated"!=c&&$(e).trigger(d)}});(function(d){d.LoadScript=d.define(null,function(){this.url=!1;this.options={dontRun:!1,timeout:5E3,reloadTimeout:!1};this._loading=this._ready=this._isAborted=!1;this._create.apply(this,arguments)},{_create:function(c){c&&this.setOptions(c);this.options.dontRun||this.load()},setOptions:function(c){this.options=$.extend({},this.options,c);c.url&&(this.url=c.url)},toString:function(){return"LoadScript: "+this.url},load:function(c){var b=this;if(b.isLoading())c&&b.setOptions(c);else if(c&&b.setOptions(c),
b.url){var e=b.options;clearTimeout(b.timer);b.timer=setTimeout(function(){b.abort.call(b);b.callErrorHandler()},e.timeout||5E3);b._loading=!0;jQuery.ajax({url:b.url,dataType:"script",timeout:e.timeout||5E3,success:function(){b._loading=!1;b._isAborted||(b._ready=!0,clearTimeout(b.timer),e.success&&$.isFunction(e.success)&&e.success.apply(b,arguments))},error:function(){b.callErrorHandler(arguments)},complete:function(){b._loading=!1;b._isAborted||(clearTimeout(b.timer),e.complete&&$.isFunction(e.complete)&&
e.complete.apply(b,arguments))}})}else b._error()},isReady:function(){return this._ready},setReady:function(c){this._ready=!!c},isLoading:function(){return this._loading},abort:function(){clearTimeout(this.timer);this._isAborted=!0;this._loading=!1;jQuery('script[src*="'+this.url+'"]',"head").each(function(){this.onload&&(this.onload(),this.onload=null);jQuery(this).remove()});this.options.complete&&$.isFunction(this.options.complete)&&this.options.complete.call(this)},callErrorHandler:function(){this._error.apply(this,
arguments)},_error:function(){this._loading=!1;clearTimeout(this.timer);this.options.error&&$.isFunction(this.options.error)&&this.options.error.apply(this,arguments)}})})(toa);function loadGoogleJsapi(d){d=d?d:{};var c=$.Deferred(),b=function(){c.resolve();d.callback&&$.isFunction(d.callback)&&d.callback.call()};toa.loader||(toa.loader=new toa.LoadScript({timeout:5E3,dontRun:!0}),toa.loader.callbackQueue=[],window._toa_loader_process_queue=function(){for(;toa.loader.callbackQueue.length;)toa.loader.callbackQueue.shift()()});if(toa.loader.isReady())return b(),c;toa.loader.callbackQueue.push(b);if(toa.loader.loading)return c;b=document.location.protocol+"//www.google.com/jsapi?indexing=false&callback=_toa_loader_process_queue";
toa.loader.loading=!0;toa.loader.load({url:toa.loader.isLoading()?!1:b,timeout:7E3,complete:function(){var b=this;toa.loader.loading=!1;setTimeout(function(){window.google||toa.googleJsapi||(b.setReady(!1),b.callErrorHandler())},500);$.isFunction(d.complete)&&d.complete.call(this,arguments)},error:function(){c.reject();d.error&&$.isFunction(d.error)&&d.error.call()}});return c};toa.ns("toa.mixins.observable",{addListener:function(d,c){if("string"!==typeof d)throw Error(this.toString()+": cant addListener, event name not string, "+d);if("function"!==typeof c)throw Error(this.toString()+": cant add non function listener, "+d);this.eventHandlers||(this.eventHandlers={});!1===this.eventHandlers.hasOwnProperty(d)&&(this.eventHandlers[d]=[]);this.eventHandlers[d].push(c)},addListeners:function(d){for(var c in d)this.addListener(c,d[c])},notify:function(d,c){var b;if("string"!==
typeof d)if(d instanceof toa.events.Event)b=d;else throw Error(this.toString()+": illegal event type "+d);else b=new toa.events.Event(d);var e=this.eventHandlers&&this.eventHandlers[b.name]||!1;if(!1===e)return null;for(var g=0;g<e.length;g++){var k=e[g].apply(this,[b,c]);if(b.isImmediatePropagationStopped())break}return k},removeListener:function(d,c){if(this.eventHandlers)if(0===arguments.length)this.eventHandlers={};else{if("string"!==typeof d)throw Error(this.toString()+": cant remove event name not string, "+
d);if(this.eventHandlers[d])if(1===arguments.length)delete this.eventHandlers[d];else{if("function"!==typeof c)throw Error(this.toString()+": cant remove non function listener, "+d);for(var b=this.eventHandlers[d],e=0;e<b.length;e++)b[e]===c&&this.eventHandlers[d].splice(e,1)}}},clearListeners:function(){this.eventHandlers={}}});toa.ns("toa.mixins.options",{OPTIONS_GETTER_PREFIX:"getOption",OPTIONS_SETTER_PREFIX:"setOption",OPTIONS_BEFORE_CHANGE_PREFIX:"beforeChangeOption",OPTIONS_AFTER_CHANGE_PREFIX:"afterChangeOption",OPTIONS_HASER_PREFIX:"hasOption",clearOptions:function(){this.options={};return this},setOptions:function(d){this.options=d;return this},getOptions:function(){this._checkOptions();return this.options},setOption:function(d,c,b){var e=toa.capitaliseFirstLetter(d),g=this.OPTIONS_SETTER_PREFIX+e,k,l,n;this._checkOptions();
n=this.getOption(d);k=this._notifyOption(this.OPTIONS_BEFORE_CHANGE_PREFIX,d,l,n,b);if(k.isDefaultPrevented())return k.lastResult;l=this._notifyOption(this.OPTIONS_BEFORE_CHANGE_PREFIX+e,d,c,n,b);if(l.isDefaultPrevented())return l.lastResult;if(g=toa.isFunction(this[g])?this[g]:!1){if(l=g.call(this,c,b),l===toa.error.NOT_VALID)return k.lastResult}else l=c;if(l===n)return k.lastResult;this.options[d]=l;this._notifyOption(this.OPTIONS_AFTER_CHANGE_PREFIX+e,d,l,n,b);d=this._notifyOption(this.OPTIONS_AFTER_CHANGE_PREFIX,
d,l,n,b);return void 0!==d.lastResult?d.lastResult:k.lastResult},_notifyOption:function(d,c,b,e,g){var k=toa.isFunction(this[d])?this[d]:!1,l;d=new toa.events.Event(d);c={source:this,key:c,value:b,oldValue:e};d.options=g;k&&(l=k.call(this,d,c));if(d.isImmediatePropagationStopped())return d.lastResult=l,d;g=this.notify&&this.notify(d,c);void 0!==g&&(l=g);d.lastResult=l;return d},getOption:function(d,c){var b;this._checkOptions();b=(b=this._getOptionHandler(this.OPTIONS_GETTER_PREFIX,d))?b.apply(this):
this.options[d];toa.isUndefined(b)&&(b=c);return b},hasOption:function(d){this._checkOptions();var c=this._getOptionHandler(this.OPTIONS_HASER_PREFIX,d);return c?c.apply(this):toa.isDefined(this.options[d])},_getOptionHandler:function(d,c){var b=toa.capitaliseFirstLetter(c);if(!b)return!1;b=this[d+b];return toa.isFunction(b)&&b},_checkOptions:function(){this.options||this.clearOptions()}});toa.ns("toa.error.NOT_VALID",{});toa.ns("toa.mixins.treeItem",{initChildItems:function(){this.children=[];this.childrenNameIndex={};this.childrenVersion=0;this.parent=null},appendChild:function(d){this.notify&&this.notify("beforeAppendChild",{child:d});this.children.push(d);(this.childrenNameIndex[d.getName&&d.getName()]=d)&&d.setParent(this);this.childrenVersion++;this.notify&&this.notify("afterAppendChild",{child:d})},insertChild:function(d,c){if(0>c||c>this.children.length)return!1;this.notify&&this.notify("beforeInsertChild",
{child:d});this.children.splice(c,0,d);(this.childrenNameIndex[d.getName&&d.getName()]=d)&&d.setParent(this);this.childrenVersion++;this.notify&&this.notify("afterInsertChild",{child:d});return d},getChild:function(d){if(toa.isObject(d))return d;if(toa.isString(d))return this.childrenNameIndex[d];if(toa.isInteger(d))return this.children[d]},getChildIndex:function(d){d=this.getChild(d);d=$.inArray(d,this.children);return-1===d?!1:d},detachChild:function(d){this.notify&&this.notify("beforeDetachChild",
{child:d});d=this.getChild(d);if(!d)return!1;var c=this.getChildIndex(d);if(!1===c)return!1;d.setParent&&d.setParent(null);delete this.childrenNameIndex[d.getName&&d.getName()];this.children.splice(c,1);this.childrenVersion++;this.notify&&this.notify("afterDetachChild",{child:d});return d},removeChild:function(d){this.notify&&this.notify("beforeRemoveChild",{child:d});d=this.getChild(d);this.detachChild(d);d.destroy&&d.destroy();this.notify&&this.notify("afterRemoveChild",{child:d})},clearChildren:function(){this.notify&&
this.notify("beforeClearChildren");for(var d=this.getChildrenCount(),c=0;c<d;c++)this.removeChild(0);this.children=[];this.childrenNameIndex={};this.childrenVersion++;this.notify&&this.notify("afterClearChildren")},getChildrenCount:function(){return this.children.length},getChildrenVersion:function(){return this.children.length},getParent:function(){return this.parent},setParent:function(d){this.notify&&this.notify("beforeSetParent",{parent:d});this.parent=d;this.notify&&this.notify("afterSetParent",
{parent:d})},getClosestParent:function(d){var c=this.getParent();return c?c.getName&&c.getName()==d?c:this.getClosestParent(d):!1},eachChild:function(d,c){for(var b=0;b<this.children.length;b++){var e=this.children[b];if(!1===d.apply(e,[e,b])||c&&e.eachChild&&!1===e.eachChild(d,c))return!1}return!0},findChild:function(d){var c=this.childrenNameIndex[d]||!1;if(c)return c;this.eachChild(function(){return this.getName&&this.getName()==d?(c=this,!1):!0},!0);return c},mapChildren:function(d,c,b){var e=
{};c=c||{};var g=toa.isFunction(d);this.eachChild(function(b,l){var n=b.getName&&b.getName();if(g||toa.isFunction(b[d])){var p=c[n]||c["default"]||[],p=g?d.apply(b,p):b[d].apply(b,p);"undefined"!==typeof p&&n&&(e[n]=p)}},b);return e}});(function(d){var c=d.models.ObservableModel;d.ns("toa.models.BaseModel",d.define(c,function(b){c.apply(this,arguments)},{subscribeOnChild:function(b){b.addListener("all",function(){this.notify.apply(this,arguments)},this)},toJSON:function(){var b=c.prototype.toJSON.apply(this,arguments);this.idField in this.attributes||delete b[this.idField];return b}}))})(toa);(function(d){var c=d.models.ObservableCollection;d.ns("toa.models.BaseCollection",d.define(c,function(){c.apply(this,arguments)},{modelConstructor:d.models.BaseModel,where:function(b,e){var c=[];this.each(function(d,l){d.get(b)===e&&c.push(d)},this);return c},filter:function(b){var e=[];this.each(function(c){(c=b(c))&&e.push(c)},this);return e},first:function(){return this.models[0]||null},find:function(b,e,c){return this.findBy(function(c){return c.get(b)==e},null,c)},findBy:function(b,e,c){b=this.findIndexBy(b,
e,c);return-1<b?this.models[b]:null},findIndexBy:function(b,e,c){var d=this.models;c=c||0;for(var l=d.length;c<l;c++)if(b.call(e||this,d[c]))return c;return-1},compact:function(){for(var b=this.compactData.apply(this,arguments),e=new this.constructor,c=0,d=b.length;c<d;c++)e.add(b[c],{silent:!0});return e},compactData:function(){var b=[],e=Array.prototype.slice.call(arguments,0);this.each(function(c){c=c.pick(e);b.push(c)});return b}}))})(toa);(function(d,c){d.ns("toa.classes.ServerConnector",d.define(null,function(b,e){this._triggerFunction=b;this._controller=e},{_triggerFunction:function(){},_controller:"",_accessModeField:"allow_modify",defer:null,request:function(b,e){this.defer=c.Deferred();this._triggerFunction("global.data.get",{controller:this._controller,method:b,params:e||{},responseHandler:this._responseHandler.bind(this)});return this.defer.promise()},_responseHandler:function(b,e){e.status&&"OK"===e.status?(this.checkAccessMode(e),
this.defer.resolve(e)):this.defer.reject(e.error_code||0)},checkAccessMode:function(b){if(!b||"undefined"===typeof b[this._accessModeField])return!1;this._triggerFunction(this._controller+".accessMode",b[this._accessModeField])}}))})(toa,$);(function(d,c){d.ns("toa.classes.DataMapper",d.define(null,function(b){this._serverConnector=b},{_modelConstructor:function(){},_serverGetMethod:"",_serverSaveMethod:"",_serverRemoveMethod:"",_serverGetField:"",_serverIdField:"",load:function(b,e){e=e||{};this._serverIdField&&(e[this._serverIdField]=b.id);var d=c.Deferred(),k=this._serverConnector.request(this._serverGetMethod,e);k.done(function(e){e&&e[this._serverGetField]||d.reject('Field "'+this._serverGetField+'" is not available');try{this._fillModel(b,
e[this._serverGetField]),d.resolve(b)}catch(c){d.reject("Unable to fill model with given data ("+c.message+")")}}.bind(this));k.fail(function(b){d.reject(b,"Server error ("+b+") has occurred")});return d.promise()},create:function(b){var e=new this._modelConstructor;this._fillModel(e,b||{});return e},save:function(b){return this._serverConnector.request(this._serverSaveMethod,this.serialize(b))},remove:function(b){var e={};this._serverIdField&&(e[this._serverIdField]=b.id);return this._serverConnector.request(this._serverRemoveMethod,
e)},_fillModel:function(b,e){b.reset({},{silent:!0});b.set(e,{silent:!0})},_getModelJson:function(b){return b.toJSON()},serialize:function(b){return this._getModelJson(b)}}))})(toa,$);(function(d){var c=d.classes.DataMapper;d.ns("toa.classes.BaseDataMapper",d.define(c,function(b){c.apply(this,arguments)},{_modelConstructor:d.models.BaseModel}))})(toa);(function(d,c){var b=d.classes.DataMapper;d.ns("toa.classes.ComplexDataMapper",d.define(b,function(e,c){b.apply(this,arguments);this._fieldMappers=c},{_fillModel:function(b,d){b.reset({},{silent:!0});c.each(d,function(c,d){var g={};if(this._fieldMappers&&c in this._fieldMappers){var p=this._fieldMappers[c].create(d);null!==p&&(g[c]=p,b.subscribeOnChild(p))}else g[c]=d;b.set(g,{silent:!0})}.bind(this))},serialize:function(b){var d=this._getModelJson(b);c.each(d,function(c,l){if(this._fieldMappers&&
c in this._fieldMappers){var n=this._fieldMappers[c].serialize(b.get(c));null!==n?d[c]=n:delete d[c]}}.bind(this));return d}}))})(toa,$);(function(d,c){var b=d.classes.DataMapper;d.ns("toa.classes.CollectionDataMapper",d.define(b,function(e,c){b.apply(this,arguments);this._itemMapper=c},{_modelConstructor:d.models.BaseCollection,create:function(b){var c=new this._modelConstructor;this._comparator&&"function"===typeof this._comparator&&(c.comparator=this._comparator);this._fillModel(c,b||{});return c},_fillModel:function(b,d){b.clear({silent:!0});c.each(d,function(c,d){var g=this._itemMapper.create(d);b.add(g,{silent:!0})}.bind(this))},
serialize:function(b){var c=[];b.each(function(b){c.push(this._itemMapper.serialize(b))},this);return c}}))})(toa,$);(function(d){var c={container:{width:0,height:0},offset:{top:0,left:0},callout:{top:0,left:0},anchor:{width:0,shiftWidth:0,height:0},window:{width:0,height:0}},b={align:null,value:null,top:null,left:null};d.widget("toaUi.Tip",{options:{resizable:!1,height:"auto",width:"auto",minHeight:30,minWidth:50,maxHeight:null,maxWidth:null,windowMarginHorizontal:0,windowMarginVertical:0,animation:!1,zIndex:3005,className:"",onHide:function(){},onShow:function(){},onResizeWindow:function(){},calculateViewSpecificAnchorOptions:null,
contents:"&nbsp;",closeOnOutsideClick:!0,notOutsideElements:!1,closable:!1,heightFollowContent:!1,container:"object"===typeof _DATA&&"string"===typeof _DATA.popup_container?_DATA.popup_container:"body",position:{top:0,left:0},callout:{side:"top",position:"center"},size:function(){var b=d('<div style="position: absolute; top:0; display: none; margin: 0;" class="'+this._container.attr("class")+'">'+this._content.html()+"</div>").appendTo(this.options.container),c=_DATA.is_mobility_app?10:0;null!==this.options.maxWidth&&
b.width()>this.options.maxWidth&&b.width(this.options.maxWidth+"px");c={width:b.outerWidth(),height:Math.round(b.outerHeight())+c};b.remove();return c}},_isVisible:!1,_container:null,_content:null,_height:!1,_width:!1,_position:{top:0,left:0},_originalSize:{width:0,height:0},_lastAnchor:null,_lastAppear:null,_lastAlign:null,_filterUid:null,_create:function(){var b=this.options;this._calloutWidth=13;this._calloutHeight=8;this._calloutPadding=4;this._container=d("<div/>",{"class":"ui-tip ui-widget ui-corner-all ui-widget-content "+
b.className}).hide();this._callout=d('<div class="ui-tip-callout"></div>');b.closable&&(b.closable=!1,this.setClosable());if(b.resizable){var c=null;d.isPlainObject(b.resizable)&&(c=b.resizable);this._container.resizable(c)}b.zIndex&&this._container.css("zIndex",b.zIndex);this.element.is(this.options.container)?(this._content=this._container.append('<div class="ui-tip-content"></div>'),this._content.html(b.contents)):(this._content=d(this.element).addClass("ui-tip-content"),this._container.append(this._content));
b.position&&"undefined"!==typeof b.position.top&&"undefined"!==typeof b.position.left&&(this._position=b.position);window._DATA&&_DATA.is_mobility_app&&this.options.className&&"toa-search-activity"===this.options.className&&"#content"!==this.options.container?this._container.appendTo("#manage-container"):this._container.appendTo(this.options.container);this._containerVerticalPadding=this._container.outerHeight()-this._container.height();b.height&&"auto"!==b.height?(b.height<b.minHeight&&(b.height=
b.minHeight),this.options.heightFollowContent||this._container.height(b.height),this.tipHeight=b.height):this.tipHeight=this._container.height();b.width&&"auto"!==b.width?(b.width<b.minWidth&&(b.width=b.minWidth),this._container.width(b.width),this.tipWidth=b.width):this.tipWidth=this._container.width();(c=b.maxWidth?parseInt(b.maxWidth,10):0)&&c>b.minWidth&&this._container.css({"max-width":c+"px"});this._callout.insertAfter(this._content);this._calculateCalloutSize();this._setClosableByOutsideClick();
this._setClosableByEscPress();this._setOnResize()},destroy:function(){this.hide();d(window).off("resize.tip."+this.resizeHandlerUID);d("body").off("mousedown.tip."+this.mousedownHandlerUID);d.Widget.prototype.destroy.call(this);this._container.remove();try{this._filterUid&&toa.mixins.EventEmitter.removeListener.call(_DATA.filtersEventStorage,this._filterUid)}catch(b){}},widget:function(){return this._container},content:function(){return this._content},show:function(b,c,k,l){var n=this,p="undefined"===
typeof l?!1:l;n.lastAnchor=b;n.lastAppear=c;n.lastAlign=k;n.lastConstraitPosition=l;n.options.onShow();"undefined"===typeof k&&(k="bottom");n._position=n._calculateTipPositionWithoutCallout(b,c,k,p);this._heightCorrectionWithoutCallout(n._position,b);l&&(p=n._calculateFitSize(),n._width=p.width,n._height=p.height);n._isVisible=!0;this.options.animation&&"fadeIn"===this.options.animation.show?n._container.fadeIn(250):n._container.show();n.redraw();_DATA.filtersEventStorage="undefined"!==typeof _DATA.filtersEventStorage?
_DATA.filtersEventStorage:{};this._filterUid=toa.mixins.EventEmitter.addListener.call(_DATA.filtersEventStorage,"content_changed",function(){1<=n.element.closest(".headerResponsivePopup").length||!d(n.element).hasClass("toa-panel-filter-popup")||(n.hide(),n.show(b,c,k,l))}.bind(n),n);app.focusTrap&&app.focusTrap(this.getContainer()[0])},_calculateFitSize:function(b){var c={height:"auto",width:"auto"};b=b||this._position;var k=this.options,l=this._container,k=d(window).height()-k.windowMarginVertical,
l=l.outerHeight();b=k-b.top;b<l&&(c.height=b);return c},_calculateTipPositionWithoutCallout:function(b,c,k,l){var n=d(b).offset(),p={left:0,top:0},s=d(b).outerWidth(),t=d(b).outerHeight(),u=this._container.outerWidth(),v=this._container.outerHeight();switch(c){case "top":case "bottom":p.top="top"===c?n.top-v:n.top+t;p.left=n.left;switch(k){case "center":p.left=n.left+s/2-u/2;break;case "right":p.left=n.left+s-u}break;case "left":case "right":switch(p.left="left"===c?n.left-u:n.left+s,p.top=n.top,
k){case "center":p.top=n.top+t/2-v/2;break;case "bottom":p.top=n.top+t-v}}if(!l){l=d(window).height()-this.options.windowMarginVertical;var n=d(window).width()-this.options.windowMarginHorizontal,s=k,w=c;switch(c){case "top":case "bottom":("left"===k||"center"===k)&&p.left+u>n&&(s="right");("right"===k||"center"===k)&&0>p.left&&(s="left");"bottom"===c&&2*p.top-t>l&&(w="top");"top"===c&&0>p.top&&(w="bottom");break;case "right":case "left":("top"===k||"center"===k)&&p.top+v>l&&(s="bottom"),("bottom"===
k||"center"===k)&&0>p.top&&(s="top"),"left"===c&&0>p.left&&(w="right"),"right"===c&&p.left+u>n&&(w="left")}if(s!==k||w!==c)return this._calculateTipPositionWithoutCallout(b,w,s,!0)}return p},_heightCorrectionWithoutCallout:function(b,c){var k,l=this.options,n=this._container,p=this._content,s=d(window).height()-this.options.windowMarginVertical;c=d(c);c.offset().top>b.top||0>b.top?(l=n.height(),k=c.offset().top<k?k:c.offset().top,n.css("max-height",k),p.css("max-height",k),p=l-k,0<p&&(b.top-=p),b.top+
n.height()>c.offset().top&&(b.top=c.offset().top-n.height()),0>b.top&&(b.top=0)):(k=parseInt(n.css("padding-top").replace(/px/,""))+parseInt(n.css("border-width").replace(/px/,"")),k=s-b.top-k,n.css("max-height",Math.max(l.minHeight,k)),p.css("max-height",Math.max(l.minHeight,k)))},_calculateCalloutSize:function(){this._container.offset({top:0,left:-1E3}).show();this._drawCallout();this._calloutWidth=this._callout.width();this._calloutHeight=this._callout.height();this._container.hide()},showAtWithIndex:function(b,
c,d){this.lastAnchor=b;this.lastAppear=null;this.lastAlign=c;this._container.css("zIndex",d);"undefined"===typeof c&&(c="bottom");d=this.correctSize();this._width="auto"===this.options.width?d.width:this.options.width;this._height="auto"===this.options.height?d.height:this.options.height;this._position=this._calculateTipPosition(b,c);this._isVisible=!0;this.options.animation&&"fadeIn"===this.options.animation.show?this._container.fadeIn(250):this._container.show();this.redraw()},showAt:function(b,
c){this.lastAnchor=b;this.lastAppear=null;this.lastAlign=c;var d=this.correctSize();this._width="auto"===this.options.width?d.width:this.options.width;this._height="auto"===this.options.height?d.height:this.options.height;this._position=this._calculateTipPosition(b,c);this._isVisible=!0;this.options.animation&&"fadeIn"===this.options.animation.show?this._container.fadeIn(250):(this._container.show(),app.focusTrap&&app.focusTrap(this.getContainer()[0]));this.redraw()},_calculateTipPosition:function(e,
g){var k=!1;"undefined"===typeof g&&(k=!0,g="bottom");this._originalSize={width:this._width,height:this._height};"absolute"===this._container.css("position")?this._container.css({"min-width":this._width}):this._container.width(this._width);this._container.height(this._height);e=d(e);var l={left:0,top:0,align:null},n=null;if(this.options.calculateViewSpecificAnchorOptions&&"function"===typeof this.options.calculateViewSpecificAnchorOptions)n=d.extend({},c,this.options.calculateViewSpecificAnchorOptions(this._container,
this._originalSize,e,g));else{var p=e.offset(),n=d.extend({},c);n.offset.top=p.top;n.offset.left=p.left;n.anchor.width=e.outerWidth();n.anchor.shiftWidth=e.outerWidth();n.anchor.height=e.outerHeight();n.container.width=this._container&&this._container.outerWidth&&this._container.outerWidth()>this._width?this._container.outerWidth():this._width;n.container.height=this._container&&this._container.outerHeight&&this._container.outerHeight()>this._height?this._container.outerHeight():this._height;this._container.height(n.container.height)}n.callout.top=
this._getCalloutOffsetTop()||0;n.callout.left=this._getCalloutOffsetLeft()||0;n.window.width=d(window).width()-this.options.windowMarginHorizontal;n.window.height=d(window).height()-this.options.windowMarginVertical;l=d.extend({},l,this._getOffsetTipPosition(n,g));switch(g){case "top":case "bottom":this._setMaxFit(n,l);l=d.extend({},l,this._getOffsetTipPosition(n,"top"===g?"bottom":"top"));this._setMaxFit(n,l);if(!k)break;g="right";case "right":case "left":this.options.calculateViewSpecificAnchorOptions&&
"function"===typeof this.options.calculateViewSpecificAnchorOptions&&(n=d.extend({},c,this.options.calculateViewSpecificAnchorOptions(this._container,this._originalSize,e,g))),l=d.extend({},l,this._getOffsetTipPosition(n,g)),this._setMaxFit(n,l),g="left"===g?"right":"left",l=d.extend({},l,this._getOffsetTipPosition(n,g)),this._setMaxFit(n,l)}l=d.extend({},b);g=l.align;this._clearMaxFit();this._setCallOutSide(g);k=0;switch(g){case "top":case "bottom":l.left+n.container.width+n.anchor.shiftWidth>n.window.width&&
(k=n.window.width-(l.left+n.container.width));if(0>l.left||0>l.left+k)k=-l.left;k&&(l.left+=k,this.options.callout.position=n.callout.left-k);break;case "right":case "left":l.top+n.container.height+n.anchor.height>n.window.height&&(k=n.window.height-(l.top+n.container.height));if(0>l.top||0>l.top+k)k=-l.top;k&&(l.top+=k,n.callout.top&&(this.options.callout.position=n.callout.top-k))}l.left+n.container.width>n.window.width&&("absolute"===this._container.css("position")?this._container.css({"min-width":n.window.width-
l.left}):this._container.width(n.window.width-l.left),this._width=n.window.width-l.left);0>l.left&&(this._container.width(n.container.width+l.left),this._width=n.container.width+l.left,l.left=0);0>l.top&&(l.top=0);if(l.top+n.container.height+n.anchor.height>n.window.height||!l.left||!l.top)this.options.heightFollowContent=!1;l.top+n.container.height>=n.window.height&&(this.options.heightFollowContent||(l.top?this._container.height(n.window.height-l.top-this._calloutHeight):"left"===g||"right"===g?
this._container.height(n.container.height>=n.window.height?n.window.height:"auto"):this._container.height(n.offset.top-this._calloutHeight)),this._height=this._container.height()-(parseInt(this._container.css("padding-top"))+parseInt(this._container.css("padding-bottom"))));l.left||this.options.heightFollowContent||("absolute"===this._container.css("position")?this._container.css({"min-width":this._width}):this._container.width(this._width));return l},hide:function(b){this._isVisible&&app.focusToTheLastSelectedElement&&
!b&&app.focusToTheLastSelectedElement();this._isVisible=!1;this._trigger("close",null);this.options.onHide();this._container.height("auto");this.options.animation&&"fadeOut"===this.options.animation.hide?this._container.fadeOut(250):this._container.hide();try{this._filterUid&&toa.mixins.EventEmitter.removeListener.call(_DATA.filtersEventStorage,this._filterUid),this.lastAnchor&&this.lastAnchor.data&&"quota"!==this.lastAnchor.data("label")&&!b&&this.lastAnchor.focus()}catch(c){console.error(c)}},_setClosableByEscPress:function(){var b=
this;b.bodyEscHandler=function(c){b._isVisible&&"Escape"===c.key&&(b._changeTabindexAttribute(),b.hide())}.bind(b);d("body").on("keyup",b.bodyEscHandler)},_setClosableByOutsideClick:function(){var b=this,c=b.options;b.bodyMousedownHandler=function(k){if(b._isVisible&&("mousedown"===k.type||"Escape"===k.key)&&b.options.closeOnOutsideClick&&!d(k.target).closest(".ui-tip").length){if(c.notOutsideElements&&c.notOutsideElements.length)for(var l=0;l<c.notOutsideElements.length;l++)if(d(k.target).closest(c.notOutsideElements[l]).length)return;
b._changeTabindexAttribute();b.hide()}}.bind(b);this.mousedownHandlerUID=Math.floor(1E5*Math.random());d("body").on("mousedown.tip."+this.mousedownHandlerUID,b.bodyMousedownHandler)},_setOnResize:function(){var b=this;b.resizeHandler=function(){b.isOpen()&&(null!==b.lastAnchor&&null!==b.lastAlign&&(null!==b.lastAppear?b.show(b.lastAnchor,b.lastAppear,b.lastAlign,b.lastConstraitPosition):b.showAt(b.lastAnchor,b.lastAlign,void 0)),b.options.onResizeWindow())}.bind(b);this.resizeHandlerUID=Math.floor(1E5*
Math.random());d(window).on("resize.tip."+this.resizeHandlerUID,b.resizeHandler)},_drawCallout:function(){if(this.options.callout){var b="ui-tip-callout-",c={},d=this.options.callout.position,c=this.options.callout.side;if("center"===d)switch(c){case "top":case "bottom":d=this._container.width();d=parseInt((d-this._calloutWidth)/2,10);break;case "left":case "right":d=this._container.height(),d=parseInt((d-this._calloutWidth)/2,10)}else d=parseInt(d,10);switch(c){case "top":case "bottom":b+=c;d+this._calloutWidth>
this._container.width()-this._calloutPadding?d=this._container.width()-this._calloutWidth-this._calloutPadding:d<this._calloutPadding&&(d=this._calloutPadding);c={left:d};break;case "left":case "right":b+=c;d+this._calloutWidth>this._container.height()-this._calloutPadding?d=this._container.height()-this._calloutWidth-this._calloutPadding:d<this._calloutPadding&&(d=this._calloutPadding);c={top:d};break;default:return}this._callout.attr({style:"","class":b}).css(c)}else this._callout.hide()},correctSize:function(b){var c=
d(window).height()-this.options.windowMarginVertical,k=0;try{if(d.isFunction(this.options.size)){if(b=this.options.size.apply(this,[{options:this.options,currentSize:{height:this._container.height(),width:this._container.width()}}]),!b||!b.height||!b.width)throw"size handler error";}else throw"no size handler";}catch(l){b||(b={height:0,width:0}),b.height="auto"===this.options.height?this._content.outerHeight():this.tipHeight,b.width="auto"===this.options.width?this._content.outerWidth():this.tipWidth,
!this.options.callout||"top"!==this.options.callout.side&&"bottom"!==this.options.callout.side||(k=this._calloutHeight),b.height<this.options.minHeight&&(b.height=this.options.minHeight),b.width<this.options.minWidth&&(b.width=this.options.minWidth),b.height-k>c&&(b.height=c-k)}b.height=Math.max(b.height,this.options.minHeight);b.width=Math.max(b.width,this.options.minWidth);return b},redraw:function(){this.options.heightFollowContent||this._container.height(this._height);this._container.offset(this._position);
this._drawCallout()},isClosable:function(){return!!this.options.closable},setClosable:function(){if(!this.options.closable){var b=this;b.options.closable=!0;b._closeIcon=d('<div class="ui-tip-close" aria-label="'+h(12251)+'" role="button" tabindex="0"></div>').prependTo(b._container);b._closeIcon.click(function(){b._changeTabindexAttribute();b.hide()}).keypress(function(c){"Enter"===c.key&&(b._changeTabindexAttribute(),b.hide())}).hover(function(){d(this).addClass("ui-state-hover")},function(){d(this).removeClass("ui-state-hover")})}},
removeClosable:function(){this.options.closable&&(this.options.closable=!1,this._closeIcon.remove())},position:function(b){if(b)this._position=b,this.isOpen()&&this.redraw();else return this._position},isOpen:function(){return this._isVisible},getContainer:function(){return this._container},originalSize:function(){return this._originalSize},_setOption:function(b,c){switch(b){case "contents":c&&(this._content.html(c),this._trigger("contentsChange",null,{html:c,container:this._content}));break;case "callout":c&&
(this.options.callout=c);break;case "className":if(c)this._container.attr("class","ui-tip ui-widget ui-corner-all ui-widget-content "+c);else return this.options.className;break;case "closable":c?this.setClosable():this.removeClosable();break;case "zIndex":if(c)this.options.zIndex=c,this._container.css("zIndex",c);else return this.options.zIndex}d.Widget.prototype._setOption.apply(this,arguments)},_getCalloutOffsetTop:function(){return"center"===this.options.callout.position?Math.round((this._height-
this._calloutWidth)/2+this._calloutPadding):this.options.callout.position},_getCalloutOffsetLeft:function(){return"center"===this.options.callout.position?Math.round((this._width-this._calloutWidth)/2+this._calloutPadding):this.options.callout.position},_changeTabindexAttribute:function(){if(toa.app){var b=toa.app.getInstance("view_activities");if(b=b&&b.options&&b.options.content||!1)b.find('input[type="checkbox"]').removeAttr("tabindex"),b.find('[tabindex="-1"]').attr("tabindex","0")}},_setCallOutSide:function(b){if(this.options&&
this.options.callout)switch(b){case "left":this.options.callout.side="right";break;case "right":this.options.callout.side="left";break;case "top":this.options.callout.side="bottom";break;case "bottom":this.options.callout.side="top";break;default:this.options.callout.side="top"}},_getOffsetTipPosition:function(b,g){var k={left:0,top:0,align:g},l=d.extend({},c,b);switch(g){case "top":k.left=l.offset.left+l.anchor.width/2-l.callout.left-(this._callout.width()||this._calloutWidth)/2;k.top=l.offset.top-
l.container.height-(this._callout.height()||this._calloutHeight);break;case "right":k.left=l.offset.left+l.anchor.width+(this._callout.width()||this._calloutWidth);k.top=l.offset.top+l.anchor.height/2-l.callout.top-(this._callout.height()||this._calloutHeight)/2;break;case "left":k.left=l.offset.left-l.container.width-(this._callout.width()||this._calloutWidth);k.top=l.offset.top+l.anchor.height/2-l.callout.top-(this._callout.height()||this._calloutHeight)/2;break;default:k.left=l.offset.left+l.anchor.width/
2-l.callout.left-(this._callout.width()||this._calloutWidth)/2,k.top=l.offset.top+l.anchor.height+(this._callout.height()||this._calloutHeight),k.align="bottom"}return k},_setMaxFit:function(e,g){var k=d.extend({},{left:0,top:0,align:"bottom"},g),l=d.extend({},c,e),n=1E-5;this.options=this.options||{};switch(k.align){case "left":case "right":if(k.left+l.container.width+l.anchor.shiftWidth>l.window.width||0>k.left)n=0<k.left?Math.abs(k.left+l.container.width+l.anchor.shiftWidth-l.window.width)/l.container.width:
l.container.width+k.left<l.container.width/3?1E3:Math.abs(l.container.width+l.anchor.shiftWidth-l.window.width)/l.container.width;break;case "top":n=Math.abs(l.offset.top-l.container.height)/l.container.height;break;case "bottom":case "default":if(this.options.heightFollowContent=!0,k.top+l.container.height+l.anchor.height>l.window.height||0>k.top)n=Math.abs(l.window.height-k.top-l.container.height)/l.container.height}if(!b.value||b.value>n)b=d.extend(b,k),b.value=n},_clearMaxFit:function(){b.left=
null;b.top=null;b.value=null;b.align=null}})})(jQuery);(function(d){d.DnDHint=d.define(null,function(){this.cloneFrom=this.clone=this.draggable=null;this.text="";this.lastHovered=this.label=this.hint=null;this._create.apply(this,arguments)},{toString:function(){return"DnDHint view class"},_create:function(c,b,e){if(d.currentInterface!==INTERFACE.MOBILITY||"boolean"!==typeof window.isReportsScreen||!window.isReportsScreen){var g=this;g.draggable=$(c);g.cloneFrom=$(b);g.stopFunc=function(b,e){g.destroy()};g.draggable.is(":data(ui-draggable)")&&g.draggable.bind("dragstop",
g.stopFunc);g.clon=$(b).clone().css({position:"relative",left:0});g.text=e||"";c=g.draggable.get(0).attributes;g.hint=$('<div class="DnDHint">\x3c!-- --\x3e</div>').data("hint",g);for(b=0;b<c.length;b++)e=c[b],2==e.nodeType&&"id"!=e.nodeName&&"class"!=e.nodeName&&"implementation"!=e.nodeName&&"nofocusrect"!=e.nodeName&&"style"!=e.nodeName&&g.hint.attr(e.nodeName,e.nodeValue);g.hint.data("hint",g);g.label=$('<span class="DnDHint-label">\x3c!-- --\x3e</span>');g.hint.append(g.label).append(g.clon);
g.setText();c=Math.min(500,$(window).width(),parseInt(g.hint.css("maxWidth")));b=g.hint.css({position:"absolute",whiteSpace:"nowrap",visibility:"hidden"}).outerWidth();g.hint.css({width:b>c?c:b,whiteSpace:"normal",visibility:"visible"});c=g.clon.find(".toaGantt-tb-travel").attr("dur");b=g.clon.attr("dur");var k;k=b-c;e=c;240<b&&(c<=k?(e=Math.min(120,c),k=240-e):(k=Math.min(120,k),e=240-k),g.clon.width(Math.max(Math.round(k+e,3)-2)),g.clon.find(".toaGantt-tb-travel").width(e),g.clon.addClass("toaGantt-tb-long"))}},
getHint:function(){return this.hint},setText:function(c){"string"!==typeof c&&(c=this.text);this.label.html(c);return this},setAccept:function(c,b,e){this.lastHovered&&e!==this.lastHovered&&this.lastHovered.removeClass("DnDHint-target-hover-yes DnDHint-target-hover-no");e&&(e=$(e),c?e.removeClass("DnDHint-target-hover-no").addClass("DnDHint-target-hover-yes"):e.removeClass("DnDHint-target-hover-yes").addClass("DnDHint-target-hover-no"),this.lastHovered=e);c?this.hint.removeClass("DnDHint-hover-no").addClass("DnDHint-hover-yes"):
this.hint.removeClass("DnDHint-hover-yes").addClass("DnDHint-hover-no");"string"==typeof b&&(this.hasOwnProperty("durationText")?this.setText(b+this.durationText):this.setText(b));return this},setDefault:function(){this.hint.removeClass("DnDHint-hover-yes DnDHint-hover-no");this.setText();this.lastHovered&&this.lastHovered.removeClass("DnDHint-target-hover-yes DnDHint-target-hover-no")},destroy:function(){this.draggable.unbind("dragstop",this.stopFunc);this.setDefault()}})})(toa);(function(){var d='<div class="routing-visualisation">;    <div class="routing-vsl-panel"></div>;    <div class="tabs-container">;        <div class="routing-tabs-wrapper"></div>;    </div>;   <div class="routing-vsl-info-area"></div>;</div>'.split(";");"object"===typeof _DATA&&_DATA.is_mobility_app&&(d='<div class="routing-visualisation">;    <div class="tabs-container">;        <div class="routing-tabs-wrapper"></div>;    </div>;   <div class="routing-vsl-info-area"></div>;</div>'.split(";"));var c=
(new toa.Template(d)).compile();toa.ns("toa.views.routingRuns.Layout",toa.define(null,function(b){this._sandbox=b;this._isKernelError=this._operationIsNotPermited=!1;this._access=[]},{render:function(b){b.append(c.apply());this._container=b;this._wrap=$(".routing-visualisation",b);this._panelTitleContainer=$(".routing-vsl-panel",b);this._widgetsContainer=$(".routing-tabs-wrapper",b);this._infoAreaContainer=$(".routing-vsl-info-area",b);return this},attach:function(){this._wrap.appendTo(this._container)},
detach:function(){this._wrap.detach()},getPanelTitleContainer:function(){return this._panelTitleContainer},getWidgetsContainer:function(){return this._widgetsContainer},getInfoAreaContainer:function(){return this._infoAreaContainer},setAccess:function(b){this._access=b;b=function(b){switch(this.getAccess(b)){default:case 0:return"denied";case 1:return"read.only";case 2:return"read.write"}}.bind(this);this._sandbox.trigger("routing.runs.set.server.in.read."+b("routing_run_list")+".mode");this._sandbox.trigger("routing.runs.set.routing.plans.widget.in."+
b("routing_plans_widget")+".mode");this._sandbox.trigger("routing.runs.set.plans.execution.summary.widget.in."+b("routing_execution_summary_widget")+".mode");this._sandbox.trigger("routing.runs.set.autorouting.widget.in."+b("routing_autorouting_widget")+".mode");this._sandbox.trigger("routing.runs.set.routing.utilization.widget.in."+b("routing_resource_utilization_widget")+".mode");this._sandbox.trigger("routing.runs.set.savings.widget.in."+b("routing_savings_widget")+".mode");this._sandbox.trigger("routing.runs.set.priority.time.widget.in."+
b("routing_priority_time_widget")+".mode");this._sandbox.trigger("routing.runs.set.baseline.settings.widget.in."+b("routing_baseline_settings")+".mode")},getAccess:function(b){if(this._access.hasOwnProperty(b))return this._access[b]},showAlert:function(b){set_indicator(0);if(b.responseText){var e=JSON.parse(b.responseText);this.setAccess(e.access);e.smart_routing_exception&&toa.ui.Alert({titleText:b.titleText||void 0,popup_extra_css_class:b.popup_extra_css_class||"",text:toa.toHtml(e.smart_routing_exception.message),
acceptButtonText:b.acceptButtonText||void 0})}b.operation_is_not_permited&&!this._operationIsNotPermited&&(toa.ui.Alert({text:toa.glossary({id:5516}),clickButtonHandler:function(){this._operationIsNotPermited=!1}.bind(this),onCloseHandler:function(){this._operationIsNotPermited=!1}.bind(this)}),toa.app._controllers.routing_run_list&&toa.app._controllers.routing_run_list.instance.suspend({}),this._operationIsNotPermited=!0);b.kernel_error&&!this._isKernelError&&(toa.ui.Alert({text:b.kernel_error,clickButtonHandler:function(){this._isKernelError=
!1}.bind(this),onCloseHandler:function(){this._isKernelError=!1}.bind(this)}),toa.app._controllers.routing_run_list&&toa.app._controllers.routing_run_list.instance.suspend({}),this._isKernelError=!0)}}))})();toa.ns("toa.view.control",function(d,c){return{aliases:{},repository:{},repositoryLastUid:0,define:function(b){for(var e=d.view.control,c="toa.view.control."+b.className,k=b.methods||{},l=b.properties||{},n=b.statics||{},p=b.aliases||[],s=0;s<p.length;s++)e.aliases[p[s]]=c;p=b.mixins||[];for(s=0;s<p.length;s++)$.extend(k,p[s]);if("toa.view.control.Control"==c)b=$.Class(k,l);else{var t=b.extend||d.view.Control;d.isString(t)&&(t=e.getClass(t));b=$.Class(t,k,l)}$.extend(b,n);b._controlClassName=c;b._controlBaseClass=
t;d.ns(b._controlClassName,b);return b},create:function(b,e){b=b||{};var c=d.view.control.getClass(b.xtype||"Control"),k=d.view.control.repositoryLastUid++;b.uid=k;b.xtype=c._controlClassName;c=new c(b,e);return d.view.control.repository[k]=c},remove:function(b){d.view.control.repository[b]&&delete d.view.control.repository[b]},getClass:function(b){var e=d.view.control;b=e.aliases[b]||b;e=e.getNs(b)||e.getNs("toa.view.control."+b);if(!e)throw Error("toa.view.control constructor for xtype "+b+"not found");
return e},getControlByUid:function(b){return d.view.control.repository[b]},getNs:function(b){var e=c;b=b.split(".");for(var d=0,k=b.length,l;d<k;d++)if(l=b[d],e[l])e=e[l];else return!1;return e}}}(toa,window));toa.ns("toa.view.control.domNode",function(d){function c(b){if(!d.isString(b))throw Error("DomNode: xtype is not a string");return b.toLowerCase().replace(/\./g,"-")}var b={name:1,"class":1,id:1,value:1},e={width:1,height:1};return function(g){for(var k in g)b[k]&&("undefined"==typeof g.attr&&(g.attr={}),g.attr[k]=g[k]),e[k]&&("undefined"==typeof g.css&&(g.css={}),g.css[k]=g[k]);if(g.tpl&&g.tpl.apply)var l=g.tpl.apply(g);k=g.tag||"div";l=l?$(l):$(document.createElement(k));g.attr&&l.attr(g.attr||
{});d.browser.msie?l[0].className=(g.attr["class"]||"")+" "+c(g.xtype||"")+" "+(g.addClass||""):l[0].setAttribute("class",(g.attr["class"]||"")+" "+c(g.xtype||"")+" "+(g.addClass||""));g.css&&l.css(g.css||{});void 0!==g.html&&""!==g.html&&(l[0].innerHTML=g.html);"undefined"!=typeof g.text&&l.text(g.text);return l}}(toa));(function(d){d.view.control.define({className:"Control",properties:{options:{},element:null,container:null,target:null,parent:null,isRenderedFlag:!1,isDestroyedFlag:!1,layout:null},mixins:[d.mixins.options,d.mixins.observable,d.mixins.treeItem,{UID_ATTR:"data-ctrl-id",_create:function(c){this.handlerBindHandlersProcessor=function(b,e){$(b.target).closest("["+this.UID_ATTR+"]").attr(this.UID_ATTR)==this.getUid()&&this.notify(b.type,{event:b,ui:e,source:this})}.bind(this);this.initChildItems();this.init(c);
this.addSelfListeners();this.addListeners(this.getOption("listeners",{}))},toString:function(){return"Control: "+this.getOption("xtype")},getDefaults:function(){return{layout:"Base",tag:"div"}},getNativeToSynteticEvents:function(){return[]},initOptions:function(c){var b={};$.extend(b,this.getDefaults(),c);this.setOptions(b);c=this.getUid();b=this.getOption("attr",{});b[this.UID_ATTR]=c;this.setOption("attr",b)},init:function(c){this.initOptions(c);this.initSelf();this.initLayout();this.addChildren(this.getOption("items"))},
initSelf:function(){},addChildren:function(c){var b;if(!d.isArray(c))return!1;for(b=0;b<c.length;b++)this.addChild(c[b]);this.notify("childrenAdded");return!0},addChild:function(c){c=$.extend({},this.getOption("defaultChild",{}),c);c=d.view.control.create(c);this.appendChild(c);return c},replaceChild:function(c,b){var e=null,g=null,k,l,n=this.findChild(c);if(!(n&&n.getParent&&n.getParent()))return!1;l=n.getParent();g=n.getTarget();e=l.getChildIndex(n);k=d.view.control.create(b);k.setParent(l);this.removeChild(n);
this.insertChild(k,e);n.destroy();k.render(g);k.target=g;return k},render:function(c){if(c){c=$(c);var b=document.createElement("div");this.renderTo([b]);c.append(b.children[0]);this.renderRedwoodStripe(c)}},renderRedwoodStripe:function(c){var b=this.getOptions();b.xtype&&("toa.view.control.PanelTitle"==b.xtype||"toa.view.control.PanelTitleAlta"==b.xtype)&&$("body").hasClass("themeredwood")&&(c.find(".header-stripe.panel-title-stripe").remove(),c.append('<div class="header-stripe panel-title-stripe"></div>'))},
renderTo:function(c){this.isDestroyed()||(this.target=c,this.erase(),this.renderSelf(c),this.renderChildren(),this.bindHandlers(),this.isRenderedFlag=!0,this.applyOptions(),this.notify("rendered"))},applyOptions:function(){if(this.isRendered()&&!this.isDestroyed()){var c=this.getOptions(),b;for(b in c)this.tryApplyOptions(b,c[b],{})}},tryApplyOptions:function(c,b){var e=this["applyOption"+d.capitaliseFirstLetter(c)];d.isFunction(e)&&e.call(this,c,b)},afterChangeOption:function(c,b){this.isRendered()&&
!this.isDestroyed()&&b.source===this&&this.tryApplyOptions(b.key,b.value,c.options)},erase:function(){this.element&&(this.layout.erase(),this.getOption("softClear",!1)?this.element.detach():this.element.remove(),this.element=null,this.isRenderedFlag=!1)},rerender:function(){var c=this.getTarget();c&&this.renderTo(c)},isRendered:function(){return this.isRenderedFlag},isDestroyed:function(){return this.isDestroyedFlag},renderSelf:function(c){this.element=d.view.control.domNode(this.getOptions());c[0].appendChild(this.element[0]);
return this.element},renderChildren:function(){var c=this;this.eachChild(function(b,e){c.renderChild(b,e)})},renderChild:function(c,b){c.renderTo(this.getChildContaner(c,b));this.layout.postRender(c,b)},notify:function(c,b){b=b||{};b.source||(b.source=this);d.isString(c)&&(c=new d.events.Event(c));var e=d.mixins.observable.notify.apply(this,[c,b]);this.getParent&&this.getParent()&&!c.isPropagationStopped()&&(e=this.getParent().notify(c,b));return e},bindHandlers:function(){var c=this.getNativeToSynteticEvents();
if(c.length)for(var b=this.getElement(),e=0;e<c.length;e++)b.on(c[e],this.handlerBindHandlersProcessor)},addSelfListeners:function(){},getElement:function(){return this.element},getContainer:function(){return this.container||this.element},getChildContaner:function(c,b){return this.layout.getContainer(c,b)},getTarget:function(){return this.target},getName:function(){return this.getOption("name","")},getUid:function(){return this.getOption("uid")},initLayout:function(){this.setLayout(this.getOption("layout"))},
setLayout:function(c){if(d.isString(c)){var b=d.view.control.getNs("toa.view.control.layout."+c);if(!b)throw Error('Control: layout "'+c+'" not found');c=new b(this)}if(!(c instanceof d.view.control.layout.Base))throw Error('Control: this is not a layout "'+c);this.layout&&this.layout.destroy();this.layout=c},afterChangeOptionLayout:function(c,b){this.setLayout(b.value)},setOptionCss:function(c){return $.extend({},this.getDefaults().css,c)},setOptionAttr:function(c){return $.extend({},this.getDefaults().attr,
c)},applyOptionHidden:function(c,b){this.toggleClass(b,"toa-hidden")},applyOptionDisabled:function(c,b){this.toggleClass(b,"toa-disabled")},addClass:function(c){var b=this.getElement();if(!b)return this;b.addClass(c);return this},removeClass:function(c){var b=this.getElement();if(!b)return this;b.removeClass(c);return this},toggleClass:function(c,b){c?this.addClass(b):this.removeClass(b)},width:function(c){var b=this.getElement();return b?b.width(c):0},height:function(c){var b=this.getElement();return b?
b.height(c):0},on:function(c){var b=this,e=new d.events.filters.FilterBuilder;e.afterBuilt(function(e){b.addListener(c,e)});return e},destroy:function(c){this.calendar&&(this.calendar.destroy(),this.calendar=null);this.isDestroyedFlag=!0;this.clearChildren();this.parent&&c&&this.parent.detachChild(this);this.erase();d.view.control.remove(this.getUid());this.clearListeners()}}]})})(toa);(function(d){d.widget("toaUi.ScreenCover",{_classContentWrapper:"toa-screen-cover-wrapper",_classMessageWrapper:"toa-screen-cover-message-wrapper",widgetEventPrefix:"screencover_",options:{messageClassName:"error"},_create:function(){this._content=d('<div class="'+this._classContentWrapper+'"><div class="'+this._classMessageWrapper+" "+this.option("messageClassName")+'"></div></div>');this._message=this._content.children().eq(0)},destroy:function(){this._content.remove();this._content=this._message=
null;d.Widget.prototype.destroy.call(this)},isVisible:function(){return!!this._content&&this._content.is(":visible")},show:function(c){if("string"!=typeof c)throw Error("ScreenCover#show: Invalid argument. Must be a string.");this.isVisible()&&this._messageTextShown===c||(this._message.html(c),this._messageTextShown=c,this.element.prepend(this._content),this._trigger("show",null,{message:c}))},hide:function(){!1!==this.isVisible()&&(this._content.detach(),this._trigger("hide"))},_setOption:function(c,
b){if("messageClassName"===c&&"string"!=typeof b)throw Error("ScreenCover#setOption: invalid options type. messageClassName option must be a string");d.Widget.prototype._setOption.apply(this,arguments)}})})(jQuery);toa.ns("toa.view.TwoPanelView",toa.define(null,function(d,c){this.container=d;this.options=$.extend({splitterPosition:null,secondPanelVisible:!0,titlePanelVisible:!0,minFirstPanelSize:null,maxFirstPanelSize:null},c);this.container.empty().addClass("toa-twopanel toa-twopanel-horizontal");this.titlePanel={content:$("<div/>").addClass("toa-twopanel-title-panel").appendTo(this.container)};this.firstPanel={content:$("<div/>").addClass("toa-twopanel-first-panel").appendTo(this.container)};this.secondPanel=
{content:$("<div/>").addClass("toa-twopanel-second-panel").appendTo(this.container)};this.splitter=this.createSplitter();null!==this.options.minFirstPanelSize&&(this.minFirstPanelSize=this.options.minFirstPanelSize);null!==this.options.maxFirstPanelSize&&(this.maxFirstPanelSize=this.options.maxFirstPanelSize);null!==this.options.splitterPosition?this.setSplitterPosition(this.options.splitterPosition):this.resetSplitterPosition();this.options.secondPanelVisible?this.showSecondPanel():this.hideSecondPanel();
this.options.titlePanelVisible?this.showTitlePanel():this.hideTitlePanel()},{isFirstPanelVisible:!0,isSecondPanelVisible:null,isTitlePanelVisible:!0,splitterPosition:0,splitterPercentage:0,minFirstPanelSize:110,maxFirstPanelSize:null,keepProportionsOnResize:!1,resetPanels:function(){this.setSplitterPosition(this.splitterPosition);return this},resetSplitterPosition:function(){this.setSplitterPosition(this._getInnerSize(this.container)/2);return this},resetSplitterPercentage:function(){var d=this._getInnerSize(this.container);
this.splitterPercentage=d?this.splitterPosition/d:0.5;return this},createSplitter:function(){var d=$("<div/>").addClass("toa-sidebar-resizer").addClass("toa-sidebar-resizer-horizontal").appendTo(this.container);d.draggable({axis:"y",addClasses:!1,cursor:"row-resize",zIndex:2001,scope:"resize",distance:5,snap:this.container,snapMode:"inner",snapTolerance:20,containment:"parent",helper:function(){return this.splitter.clone().appendTo(this.container).css({position:"absolute",width:this.splitter.width()})}.bind(this),
drag:function(c,b){b.position.top<this.minFirstPanelSize&&(b.position.top=this.minFirstPanelSize);null!==this.maxFirstPanelSize&&b.position.top>this.maxFirstPanelSize&&(b.position.top=this.maxFirstPanelSize)}.bind(this),stop:function(c,b){this.setSplitterPosition(b.position.top)}.bind(this)});d.css({position:"relative"});return d},setSplitterPosition:function(d,c){this.splitterPosition=d;this.resetSplitterPercentage();if(null!==this.isSecondPanelVisible&&!this.isSecondPanelVisible)return this;toa.currentInterface===
INTERFACE.MOBILITY&&(d-=$(".toa-twopanel-title-panel").height());this.splitter.css({top:this.splitterPosition});this.firstPanel.content.css("height",d);this.secondPanel.content.css({top:d+this._getOuterSize(this.splitter),height:this._getInnerSize(this.container)-d-this._getOuterSize(this.splitter)});this.notify("resize",this,c);return this},hideFirstPanel:function(){if(null!==this.isFirstPanelVisible&&!this.isFirstPanelVisible)return this;this.splitter.hide();this.isFirstPanelVisible=!1;this.firstPanel.content.hide();
this._maximizeSecondPanel();this.notify("resize",this,!1);return this},hideSecondPanel:function(){if(null!==this.isSecondPanelVisible&&!this.isSecondPanelVisible)return this;this.splitter.hide();this.isSecondPanelVisible=!1;this.secondPanel.content.hide();this._maximizeFirstPanel();this.notify("resize",this,!1);return this},showTitlePanel:function(){if(null!==this.isTitlePanelVisible&&this.isTitlePanelVisible)return this;this.isTitlePanelVisible=!0;this.titlePanel.content.show();return this},hideTitlePanel:function(){if(null!==
this.isTitlePanelVisible&&!this.isTitlePanelVisible)return this;this.isTitlePanelVisible=!1;this.titlePanel.content.hide();return this},_maximizeFirstPanel:function(){this.firstPanel.content.css({height:this._getInnerSize(this.container)});return this},_maximizeSecondPanel:function(){this.secondPanel.content.css({top:"",width:"",height:this._getInnerSize(this.container)});return this},showFirstPanel:function(){if(null!==this.isFirstPanelVisible&&this.isFirstPanelVisible)return this;this.isFirstPanelVisible=
!0;this.firstPanel.content.show();this.splitter.show();this.setSplitterPosition(this.splitterPosition);return this},showSecondPanel:function(){if(null!==this.isSecondPanelVisible&&this.isSecondPanelVisible)return this;this.isSecondPanelVisible=!0;this.secondPanel.content.show();this.splitter.show();this.setSplitterPosition(this.splitterPosition);if(toa.currentInterface===INTERFACE.MOBILITY&&this.isFirstPanelVisible){var d=toa.widgets.HangTree.getHangTree(),c=d.getTreeState(SCREEN_MAPPINGS.activity_top);
d.setTreeState(SCREEN_MAPPINGS.activity_bottom,c)}return this},resize:function(d){if(this.isFirstPanelVisible&&this.isSecondPanelVisible)if(this.keepProportionsOnResize){var c=this._getInnerSize(this.container)*this.splitterPercentage;c<this.minFirstPanelSize&&(c=this.minFirstPanelSize);null!==this.maxFirstPanelSize&&c>this.maxFirstPanelSize&&(c=this.maxFirstPanelSize);this.setSplitterPosition(c,d)}else this.setSplitterPosition(this.splitterPosition,d);else this.isSecondPanelVisible?this._maximizeSecondPanel():
this._maximizeFirstPanel(),this.notify("resize",this,d);return this},_getInnerSize:function(d){return d.innerHeight()},_getOuterSize:function(d){return d.outerHeight()}}));toa.mixin(toa.view.TwoPanelView.prototype,toa.mixins.EventEmitter);(function(){var d=toa.view.TwoPanelView;toa.ns("toa.view.VerticalTwoPanelView",toa.define(d,function(){d.apply(this,arguments);this.container.removeClass("toa-twopanel-horizontal");this.container.addClass("toa-twopanel-vertical");toa.touch.setTouchDraggable(".toa-sidebar-resizer")},{minFirstPanelSize:230,maxFirstPanelSize:517,resetSplitterPosition:function(){this.setSplitterPosition(230);return this},createSplitter:function(){var c=$("<div/>").addClass("toa-sidebar-resizer").addClass("toa-sidebar-resizer-vertical").appendTo(this.container);
c.draggable({axis:"x",addClasses:!1,cursor:"col-resize",zIndex:2001,scope:"resize",distance:5,snap:this.container,snapMode:"inner",snapTolerance:20,containment:"parent",helper:function(){return this.splitter.clone().appendTo(this.container).css({position:"absolute",top:0,height:this.splitter.height()})}.bind(this),drag:function(b,e){e.position.left<this.minFirstPanelSize&&(e.position.left=this.minFirstPanelSize);null!==this.maxFirstPanelSize&&e.position.left>this.maxFirstPanelSize&&(e.position.left=
this.maxFirstPanelSize)}.bind(this),stop:function(b,e){this.setSplitterPosition(e.position.left)}.bind(this)});c.css({position:"absolute",top:0});return c},setSplitterPosition:function(c,b){this.splitterPosition=c;this.resetSplitterPercentage();if(null!==this.isSecondPanelVisible&&!this.isSecondPanelVisible)return this;this.splitter.css({left:c});this.firstPanel.content.css("width",c);this.secondPanel.content.css({left:c+this._getOuterSize(this.splitter),width:this._getInnerSize(this.container)-c-
this._getOuterSize(this.splitter)});this.notify("resize",this,b);return this},_getInnerSize:function(c){return c.innerWidth()},_getOuterSize:function(c){return c.outerWidth()},_maximizeFirstPanel:function(){this.firstPanel.content.css({width:this._getInnerSize(this.container)});return this},_maximizeSecondPanel:function(){this.secondPanel.content.css({left:"",height:"",width:this._getInnerSize(this.container)});return this}}))})();(function(){var d=toa.view.TwoPanelView;toa.ns("toa.view.HorizontalTwoPanelView",toa.define(d,function(c,b){d.apply(this,arguments)},{keepProportionsOnResize:!0}))})();function Tabset(d,c){var b=!1,e=function(b,c){var d=null;request({url:b,data:c,errorHandler:function(b,c,g){if(g.operation_is_not_permited)toa.ui.Alert({text:toa.glossary({id:5516})});else{var k=$(b.targ_el);k.ScreenCover();k.ScreenCover("show",g.kernel_error);set_indicator(0);toa.reloader.set(function(){e(c,b)});d=b}return!1}.bind(this,$.extend({},c),b)});return d},g=function(b,e){if("object"==typeof b)for(var c in b)e.setAttribute(c,b[c])},k=function(k,l){var n;k=k&&-1!=k?k:0;var p=!1;$.each(d,
function(b,e){b==k?(n=!0,p="selected"==e.tab_title_ref.className,e.tab_title_ref.className="selected",e.tab_title_ref.style.zIndex=x+30):(e.tab_title_ref.className="",n=!1,e.tab_title_ref.style.zIndex=e.zIndex,e.tab_title_addition_ref.style.display=e.tab_content_ref.style.display="none",g({"aria-hidden":!0},e.tab_content_ref));g({"aria-selected":n},e.tab_title_ref)});0!=d[k].tab_title_addition_ref.childNodes.length&&(d[k].tab_title_addition_ref.style.display="block");g({"aria-hidden":!1,style:"display: block"},
d[k].tab_content_ref);if(c){var s=!1;$.each(c.elements,function(b,e){"active_tabs[]"===e.name&&$.each(d,function(b,c){if(c.label==e.value||""===e.value)e.value=d[k].label?d[k].label:"",s=!0})});!s&&d[k].label&&$('<input type="hidden" name="active_tabs[]">').attr("value",d[k].label).appendTo(c)}"ActivityLinks"!==d[k].label&&require(["knockout"],function(e){document.querySelector("#activity-link-content")&&b&&(b=!1,e.cleanNode(document.querySelector("#activity-link-content")),console.debug("#activity-link-content: Detach view"))});
if(d[k].click_func&&$.isFunction(d[k].click_func))d[k].click_func.apply(d[k],[d[k].label||"",d[k].tab_content_ref]);else if(d[k].url&&((p||!d[k].tab_content_ref.loaded&&"ActivityLinks"!==d[k].label)&&e(d[k].url,{targ_el:d[k].tab_content_ref}),"ActivityLinks"===d[k].label&&!p)){$(d[k].tab_content_ref).attr("id","activity-link-content");e(d[k].url,{targ_el:d[k].tab_content_ref});var t={name:"ActivityLinks",label:"activity_link",title:d[k].label,selector:"#activity-link-content"};require(["loader","SignalEmitter"],
function(e,c){b=!0;e.run(t);console.debug("ActivityLinks: loader run");c.dispatch("getActivityLinks",d[k].url,!0);console.debug("ActivityLinks: Dispatch signal - getActivityLinks")})}!Tabset.selectedTabTitle&&l?(Tabset.selectedTabId=k,Tabset.selectedTabTitle=d[k].title):l||(Tabset.selectedTabId=k,Tabset.selectedTabTitle=d[k].title)},l=function(){$.each(d,function(b,e){"selected"!=e.tab_title_ref.className&&(e.tab_title_ref.className="")})},n=function(b,e){"undefined"!=typeof e.title_icon&&(d[b].caption.innerHTML=
p(d[b].title,e.title_icon));d[b].tab_title_addition_ref.innerHTML=e.tab_title_addition||"&nbsp;";d[b].tab_content_ref.innerHTML=e.tab_content||"&nbsp;";e.tab_title_addition&&(d[b].tab_title_addition_ref.style.display="block");d[b].tab_content_ref.loaded=!0;return d[b].tab_content_ref},p=function(b,e){return e?'<table cellspacing="0" cellpadding="0"><tr><td>'+e+"<td>"+b+"</td></tr></table>":b},s=setElement("div",null,{class:"'tabset'"}),t=setElement("div",s,{class:"'tabscontainer'"}),u=setElement("div",
t,{class:"'tabsarea'",role:"'tablist'"}),t=setElement("table",u,{border:"'0'",cellPadding:"'0'",cellSpacing:"'0'",style:{position:"absolute",left:0,top:0}}),v=setElement("tr",setElement("tbody",t),{style:{verticalAlign:"top"}}),w=ElementsNum(d),x=w,y=function(){var b=Tabset.selectedTabs||[],e;for(e in b)if(b.hasOwnProperty(e))for(var c=b[e],g=0,k=d.length;g<k;++g)if(d.hasOwnProperty(g)&&c.selectedTabTitle===$("<div>"+(d[g].title||"")+"</div>").text()&&c.selectedTabId<k)return c.selectedTabId;return-1}();
!1!==Tabset.selectedTabId&&"undefined"!==typeof Tabset.selectedTabId&&d[Tabset.selectedTabId]&&d[Tabset.selectedTabId].title==Tabset.selectedTabTitle&&!1!=d[Tabset.selectedTabId].active&&(y=Tabset.selectedTabId<x?Tabset.selectedTabId:x-1);$.each(d,function(b,e){var c=(new Date).valueOf()+b;Tabset.selectedTabId||-1!=y&&!e.active||(y=b);e.zIndex=w--;e.tab_title_ref=setElement("div",setElement("td",v),{class:"'regular'",role:"'tab'",id:"'ofsc-tabs-"+c+"-"+b+"'","aria-selected":y==b?"'true'":"'false'",
style:{zIndex:e.zIndex}});var t={mouseover:function(b){return function(){"selected"!=b.className&&(b.className="hovered")}}(e.tab_title_ref),mouseout:l,mousedown:function(b){return function(){k(b,!1)}}(b)};g({role:"tabpanel","aria-labelledby":"ofsc-tabs-"+c+"-"+b,"aria-hidden":y==b?"false":"true"},e.content);e.caption=setElement("div",e.tab_title_ref,null,t);e.caption.innerHTML=p(e.title,e.title_icon||"");e.tab_title_addition_ref=setElement("div",s,{class:"'tab_title'",style:{display:"none"}});e.tab_title_addition_ref.innerHTML=
e.title_addition||"";e.tab_title_addition_ref.apply_to_tab=n;e.tab_content_ref=s.appendChild(e.content);e.tab_content_ref.mc=function(b){return function(){k(b)}}(b);e.tab_content_ref.tab_id=e.tab_title_addition_ref.tab_id=b;e.tab_content_ref.apply_to_tab=n;e.content&&delete d[b].content;(e.title_addition||""===e.title_addition)&&delete d[b].title_addition;e.field&&delete d[b].field});c&&$.each(c.elements,function(b,e){"active_tabs[]"===e.name&&$.each(d,function(b,c){c.label&&c.label==e.value&&(e.value=
"")})});k(y,!0);var z=0,A,B,D=$(t);$(window).bind("resize",function(b){$(u).width()<parseInt(D.css("width"))?(z=$(u).width()-$(D).width()-20,B.show()):B.hide()});A=$("<div/>").addClass("ig toa-tabset-leftScroll").bind("mousedown touchstart",function(b){var e=parseInt(D.css("left")),c=setInterval(function(){e+=5;D.css("left",e);e>z&&B.show();0<=e+5&&(D.css("left",0),$(this).trigger("mouseup"),$(this).trigger("touchend"))},30);$(this).one("mouseout mouseup touchend touchcancel",function(b){clearInterval(c);
0<=parseInt(D.css("left"),10)&&A.hide();return!1})});B=$("<div/>").addClass("ig toa-tabset-rightScroll").bind("mousedown touchstart",function(b){var e=parseInt(D.css("left")),c=setInterval(function(){e-=5;0>e&&A.show();D.css("left",e);e<z&&(D.css("left",z),$(this).trigger("mouseup"),$(this).trigger("touchend"))},30);$(this).one("mouseout mouseup touchend touchcancel",function(b){clearInterval(c);e<z&&B.hide();return!1})});$(u).append(A);$(u).append(B);return s}
Tabset.__proto__.AddSelectedTabs=function(){var d=document.querySelectorAll("[aria-selected=true]"),c=[],b;for(b in d)if(d.hasOwnProperty(b)){var e=d[b],g=$(e).attr("id"),k=g.lastIndexOf("-")+1,g=g.length&&k?g.substr(k,g.length-1):-1;c.push({selectedTabTitle:$(e).text(),selectedTabId:g})}delete Tabset.selectedTabs;Tabset.selectedTabs=c};function SideBar(d){this.upper_left=0;this.upper_top=47;this.width=230;this.min_width=200;this.max_width=500;this.margin=0;this.title_height=35;this.tabs=d;this.icon_height=83;this.bgc="#ACACAE";this.horizontal_resizer=null;this.titles={1:5611,2:5612,4:5613,8:5614,16:8194};this.tabs_show={};for(var c in this.tabs)(this.tabs[c].tab=get_element("tab"+c))?(this.tabs[c].opened=!0,this.tabs[c].tab_content=get_element("tab"+c+"_content"),this.horizontal_resizer||(this.horizontal_resizer=setElement("div",
$(_DATA.dispatcher_container)[0],{class:".toa-sidebar-resizer toa-sidebar-resizer-vertical ",style:{position:"absolute",top:this.upper_top+this.margin-1+"px",left:this.width+this.margin+"px",bottom:this.margin+"px",zIndex:70,expression:{height:"(document.body.offsetHeight - "+(this.upper_top+2*this.margin)+") + 'px'"}}}),$(this.horizontal_resizer).draggable({axis:"x",cursor:"col-resize",helper:function(b){show_disabling_cover();return $(this).clone()},containment:[this.min_width+17,0,this.max_width+
17,5E3],stop:function(b,e){var c=e.position.left-e.originalPosition.left,d=e.position.left+$("#content-manage-container").position().left;$(this).offset({left:d,top:e.originalPosition.top});hide_disabling_cover();_DATA.tabs.set_tabs(null,null,_DATA.tabs.width+c);toa.app.trigger("layout.panels.resized");if(window.onresize)window.onresize()}})),setElement(this.tabs[c].tab,null,{style:{left:this.margin+"px"},class:"'toa-panel'"})):delete this.tabs[c];setElement(_DATA.content,null,{style:{bottom:this.margin+
"px",right:this.margin+"px",zIndex:25,expression:{height:"(document.body.offsetHeight - "+(this.upper_top+2*this.margin+2)+") + 'px'"}}});this.set_tabs(null,null,null,!0)}
SideBar.prototype={TAB_ACTIONS:1,TAB_PROVIDERS_TREE:2,TAB_BUCKET_TREE:4,TAB_PERMISSIONS_TREE:8,TAB_CONTACT_LIST:16,set_tabs:function(d,c,b,e){e=e||!1;var g,k;if("undefined"!==typeof d&&null!=d)for(k in this.tabs)g=k&d?!0:!1,this.tabs[k].visible!=g&&(this.tabs[k].visible=g,e=!0);if("undefined"!==typeof c&&null!=c&&_DATA.page_label&&!this.tabs_show[_DATA.page_label]){d&&(c&=d);for(k in this.tabs)this.tabs[k].visible&&(g=k&c?!0:!1,this.tabs[k].opened!=g&&(this.tabs[k].opened=g,e=!0));this.tabs_show[_DATA.page_label]=
!0}"undefined"!==typeof b&&null!=b&&this.width!=b&&(this.width=b,e=!0);if(e){b=c="";e=this.upper_top+this.margin;d=0;for(k in this.tabs)this.tabs[k].visible&&(c=k,this.tabs[k].opened&&(d=1,b=k)),this.tabs[k].visible&&this.tabs[k].opened?(setElementBG(this.tabs[k].tab,null,{style:{width:this.width+"px",display:"block"}}),this.tabs[k].vertical_resizer&&setElementBG(this.tabs[k].vertical_resizer,null,{style:{top:e+this.tabs[k].height+"px",width:this.width+2+"px",visibility:"inherit"}}),this.tabs[k].tab_content.style.overflow=
"auto"):(setElementBG(this.tabs[k].tab,null,{style:{display:"none"}}),this.tabs[k].vertical_resizer&&setElementBG(this.tabs[k].vertical_resizer,null,{style:{visibility:"hidden"}}),this.tabs[k].tab_content.style.overflow="hidden");c&&this.tabs[c].vertical_resizer&&setElementBG(this.tabs[c].vertical_resizer,null,{style:{visibility:"hidden"}});b&&setElementBG(this.tabs[b].tab,null,{style:{height:"",bottom:this.margin+"px",removeExpression:{1:"height"},expression:{height:"(document.body.offsetHeight - "+
(e+this.margin+2)+") + 'px'"}}});k=d?this.width+this.margin+5:0;setElementBG(_DATA.content,null,{style:{left:k+this.margin+"px",expression:{width:"(document.body.offsetWidth - "+(k+2*this.margin+2)+") + 'px'"}}});!!d!=!!$(this.horizontal_resizer).is(":visible")&&(d?$(this.horizontal_resizer).show():$(this.horizontal_resizer).hide(),toa.app.trigger("layout.panels.resized"))}},isOpened:function(d){return this.tabs[d]&&this.tabs[d].opened},isVisible:function(d){return this.tabs[d]&&this.tabs[d].visible},
toggle:function(d,c){hide_hint();void 0==c&&(c=!this.tabs[d].opened);this.tabs[d].opened=c;this.set_tabs(null,null,null,!0)},show:function(d){this.toggle(d,!0)},hide:function(d){this.toggle(d,!1)}};toa.ns("toa.widgets.EdTree",{options:{state:null,searchKey:"",lockUpdate:!1},toString:function(){return"Widget edTree"},_create:function(){this.handlerOnPlusClick=this.onPlusClick.bind(this);this.handlerOnSelectClick=this.onSelectClick.bind(this);this.handlerClearNotify=this.clearNotify.bind(this);this.handlerHintElementSlideUp=function(){this.hintElement.slideUp("slow",this.handlerClearNotify)}.bind(this);this.element.addClass("edtree").delegate(".edt-open","click",this.handlerOnPlusClick).delegate(".edt-row",
"click",this.handlerOnSelectClick);this.favoritesResources=$('<div class="favorite-resources"/>').appendTo(this.element);this.favoritesWidget=null;this.resourceGroups=$('<div class="resource-groups"/>').appendTo(this.element);this.resourceGroupsWidget=null;this.container=this.root=$("<div/>").addClass("edt-root").attr({role:"tree","aria-label":h(22364)}).appendTo(this.element);this.hintElement=$('<div class="edt-hint"><span></span><div class="edt-cross"></div></div>').hide().on("click",".edt-cross",
this.clearNotify.bind(this));this.state=this.options.state},setFavorites:function(d){this.favoritesWidget=d;d.appendTo(this.favoritesResources)},setResourceGroups:function(d){this.resourceGroupsWidget=d;d.appendTo(this.resourceGroups)},_init:function(){this.clear();this.opened||(this.opened={});this.selected=null;this.state&&this.update()},clear:function(){isTouch&&this.root&&(this.scrollerTop=this.root.position().top,this.scrollerLeft=this.root.position().left);this.hintElement.detach();this.container.empty().append(this.hintElement);
this.elements={};this.clearNotify()},destroy:function(){this.clear();this.element.removeClass("edtree");$.Widget.prototype.destroy.apply(this,arguments)},_setOption:function(d,c){switch(d){case "state":$.Widget.prototype._setOption.apply(this,arguments);this.state=this.options.state;this._init();break;case "searchKey":$.Widget.prototype._setOption.apply(this,arguments);this.state&&this._init();break;default:$.Widget.prototype._setOption.apply(this,arguments)}},update:function(){this.options.lockUpdate||
(this.options.searchKey?(this.state.eachFound(this.updateItem,this),this.state.searchLimited&&this.showNotify(h(12413))):(this.state.each(this.updateItem,this),this.isHiddenChildren()))},updateItem:function(d){var c=d.getId();this.elements[c]?this.updateElement(d):d.entity.n?this.createElement(d):console.error("Can't find element "+c+"in resource tree")},createElement:function(d){var c=(new toa.Template('<div data-id="<%- itemId %>" class="edt-item" role="treeitem">,<div class="edt-row toa-layout-hbox">,<button class="edt-open icr ptplus" >&nbsp;</button>,<button class="edt-icon" role="button" aria-haspopup="true" aria-labelledby="<%- labelId %>" aria-describedby="<%- describeActionId %>">&nbsp;</button>,<button class="edt-label" role="link" id="<%- labelId %>"></button>,<span class="none-core" id="<%- describeActionId %>"><%- describeAction %></span>,</div>,<div class="edt-children" <% if (entityCount) { %> role="group" <% } %>></div>,</div>'.split(","))).compile(),
b={entityCount:d.hasChildren(),itemId:d.getId(),labelId:generate_id(),describeActionId:generate_id(),describeAction:h(8074)},c=$(c.apply(b));this.elements[b.itemId]=c;this.updateElement(d);b=null;try{b=this.getParentElement(d)}catch(e){return console.error("Can't find parrent element for element "+d.getId()+"in resource tree"),null}b.append(c);this._trigger("itemAdded",0,{element:c,item:d});return c},updateElement:function(d){var c=d.getId(),b=this.elements[c];this.isFiltered(d)?b.removeClass("toa-hidden"):
b.addClass("toa-hidden");d.get("CHILDREN")||this.options.searchKey?this.isOpened(c)?this.openFolder(c):this.closeFolder(c):this.getEl(b,".edt-open").attr("class","edt-open icr ptempty");this.options.searchKey&&this.getEl(b,".edt-open").attr("class","edt-open icr ptempty");this.getEl(b,".edt-icon").attr("class","edt-icon "+d.icon());var e=this.getEl(b,".edt-label").attr("unselectable","on");this.renderLabel(e,d);this.selected==c&&this.getEl(b,".edt-row").addClass("edt-selected");this.getEl(b,".edt-row").css("paddingLeft",
20*(d.get("LEVEL")-1));this.isOpened(c)?this.getEl(b,".edt-children").removeClass("toa-hidden"):this.getEl(b,".edt-children").addClass("toa-hidden");this.getEl(b,".edt-icon").attr("res-type",d.get("TYPE"));this._trigger("itemUpdated",0,{element:b,item:d});return b},isHiddenChildren:function(){var d=this;$.each(d.elements,function(c,b){if(!0==d.opened[c]){var e=b.find(".edt-item").length,g=e;b.find(".edt-children").find(".edt-item").each(function(b,e){$(this).hasClass("toa-hidden")&&g--});0==g&&0<
e&&b.find(".edt-open").eq(0).removeClass("ptminus ptplus").addClass("ptempty");0<g&&0<e&&b.find(".edt-open").eq(0).removeClass("ptempty").addClass(b.find(".edt-children").eq(0).hasClass("toa-hidden")?"ptplus":"ptminus")}})},getEl:function(d,c){var b;if("undefined"===typeof d||"undefined"===typeof d[0]||"undefined"===typeof d[0].childNodes[0]&&"undefined"===typeof d[0].childNodes[1])return b;switch(c){case ".edt-open":b=d[0].childNodes[0].childNodes[0];break;case ".edt-icon":b=d[0].childNodes[0].childNodes[1];
break;case ".edt-label":b=d[0].childNodes[0].childNodes[2];break;case ".edt-row":b=d[0].childNodes[0];break;case ".edt-children":b=d[0].childNodes[1]}return $(b)},deleteElement:function(d){return d&&d.getId?this.deleteElementById(d.getId()):!1},deleteElementById:function(d){var c=this.elements[d];if(!c)return!1;this.selected==d&&this.unselect();c.remove();delete this.elements[d];this.isOpened(d)&&(this.closeFolder(d),delete this.opened[d]);this._trigger("itemDeleted",0,d);return!0},get:function(d){return this.elements[d]},
getSelectedId:function(d){return this.selected},getSelectedElement:function(){return this.elements[this.selected]},renderLabel:function(d,c){!1!==this._trigger("renderLabel",0,{label:d,item:c})&&d.text(c.getName())},getParentElement:function(d){var c=d.getParent();if(!c)return this.container;var b=this.elements[c];if(b)return this.getEl(b,".edt-children");if(b=this.state.get(c))return this.getEl(this.createElement(b),".edt-children");throw Error("Error in EdTree.getParentElement, can't find parent object by id: "+
c+" from child: "+d.getId());},isFiltered:function(d){return!1===this._trigger("filter",0,d)?!1:!0},isOpened:function(d){return this.opened[d]||this.options.searchKey},unselect:function(){this.selected&&this.elements[this.selected]&&this.getEl(this.elements[this.selected],".edt-row").removeClass("edt-selected");this.selected=null},selectNode:function(d){if(!this.elements[d])return this;this.selected=d;this.getEl(this.elements[d],".edt-row").addClass("edt-selected");return this},select:function(d){this.favoritesWidget&&
this.state.getResourceFavorites()&&this.state.getResourceFavorites().getCurrent()?this.state.getResourceFavorites().isCurrent(d)&&(this.favoritesWidget.ResourceFavorite("select",d),this.unselect()):d&&this.elements[d]&&(this.unselect(),this.state.getResourceGroups&&this.state.getResourceGroups()&&this.state.getResourceGroups().selection&&this.state.getResourceGroups().selection.groupId||(this.selectNode(d),this.openParents(d),this.scrollToShow(d)))},scrollToShow:function(d){var c=0;if(d=this.elements[d]){d=
d.get(0);for(var b=this.element.get(0);d&&d!==b;)c+=d.offsetTop,d=d.offsetParent||d.parentNode;b.scrollTop>c?b.scrollTop=c:b.scrollTop+$(b).height()-30<c&&(b.scrollTop=c-$(b).height()+30)}},onSelectClick:function(d){var c=$(d.target);c.is(".edt-icon")||c.is(".edt-favorites-icon")||c.is(".edt-favorite-item")||c.parents(".edt-favorite-item").length||(c=this.getEventTargetId(d),!1!==this._trigger("select",d,c)&&this.select(c))},onPlusClick:function(d){var c=this.getEventTargetId(d);this.isOpened(c)?
this.closeFolder(c):this.openFolder(c);d.stopPropagation()},getEventTargetId:function(d){return $(d.target).closest(".edt-item").attr("data-id")||0},getEventTargetGroupId:function(d){return $(d.target).closest(".resource-groups-item.edt-item").attr("data-group-id")||0},getEventTargetRootId:function(d){return $(d.target).closest(".edt-root > .edt-item").attr("data-id")||0},openParents:function(d){d&&(d=this.state.get(d))&&(d=d.getParent())&&(this.openFolder(d),this.openParents(d))},openFolder:function(d){var c=
this.elements[d],b=this.getEl(c,".edt-open");if("undefined"!==typeof b&&b.hasClass("ptempty"))return!1;this.isOpened(d)||this._trigger("openFolder",null,d);this.options.searchKey||(this.opened[d]=!0);"undefined"!==typeof b&&(b.attr({"aria-label":h(22362)}),b.removeClass("ptplus").addClass("ptminus"));(d=this.getEl(c,".edt-children"))&&d.removeClass("toa-hidden")},closeFolder:function(d){var c=this.elements[d];if(!c)return!1;var b=this.getEl(c,".edt-open");if(b.hasClass("ptempty"))return!1;this.isOpened(d)&&
this._trigger("closeFolder",null,d);this.opened[d]=!1;b.attr({"aria-label":h(22361)+"_"+d});b.removeClass("ptminus").addClass("ptplus");this.getEl(c,".edt-children").addClass("toa-hidden");this.closeChildrensFolders(d);return!1},closeChildrensFolders:function(d){var c=this;c.getEl(c.elements[d],"edt-children").children("[data-id]").each(function(b,e){var d=$(e).attr("data-id");c.closeFolder(d)})},showNotify:function(d){this.hintElement.children("span").html(d);this.hintElement.css("top",this.element.scrollTop());
this.hintElement.slideDown("fast");this.hintTimeout&&clearTimeout(this.hintTimeout);this.hintTimeout=setTimeout(this.handlerHintElementSlideUp,5E3)},clearNotify:function(){this.hintElement.hide();this.hintTimeout&&clearTimeout(this.hintTimeout);this.hintTimeout=!1}});$.widget("toaUi.EdTree",toa.widgets.EdTree);(function(d,c){var b=c.toaUi.EdTree.prototype;c.widget("toaUi.ResourceTree",c.toaUi.EdTree,{update:function(){b.update.apply(this,arguments)},isOpened:function(e){return"function"===typeof this.state.isOpened?this.state.searchKey?!0:this.state.isOpened(e):b.isOpened.apply(this,arguments)},isGroupsOrFavorites:function(){return this.state.getResourceFavorites&&this.state.getResourceFavorites()&&this.state.getResourceFavorites().getCount()||this.state.getResourceGroups&&this.state.getResourceGroups()&&
this.state.getResourceGroups().getCount()},updateElement:function(e){var d=b.updateElement.apply(this,arguments);1==this.state.getRootsArray().length?e.getParent()||(this.openFolder(e.getId()),e.hasChildren()&&this.isGroupsOrFavorites()||this.getEl(d,".edt-open").hide()):this.getEl(d,".edt-row").css("paddingLeft",20*e.get("LEVEL"));this.state.getResourceFavorites&&this.state.getResourceFavorites()&&this.state.getResourceFavorites().getCount()&&this.getEl(d,".edt-row").css("paddingLeft",20*(e.get("LEVEL")||
0));var k=this.getEl(d,".edt-icon").removeData("hint assigned").attr("pid",e.getId()).attr("icon-type","pt"+e.settings.getResourceTypeIcon(e.get("TYPE"))).empty();this.state.getResourceFavorites&&this.state.getResourceFavorites()&&this.state.getResourceFavorites().isFavorite(e.getId())&&c("<div/>").addClass("edt-favorites-icon").appendTo(k);this.getEl(d,".edt-label").attr("data-label-pid",e.getId())},renderLabel:function(b,c){var k=['<span class="rtl-text rtl-prov-name">',d.toHtml(c.getName()),"</span>"];
this.options.searchKey&&k.push('<span class="rtl-external-id"> [',d.toHtml(c.get("EXTERNAL_ID")),"]</span>");c.get("TEAM")&&k.push(' <span class="ig larr">&nbsp;</span>',"<span>",d.toHtml(c.get("TEAM")),"</span>");c.get("ASSISTS_TO")&&k.push(' <span class="ig rarr">&nbsp;</span>',"<span>",d.toHtml(c.get("ASSISTS_TO")),"</span>");-1!=c.get("TOTAL")&&(c.isTechnician()?k.push('&nbsp;<span class="rtl-text">(',c.get("PENDING")||0,"/",c.get("TOTAL")||0,")</span> "):c.isBucket()&&(this.state.treeType&&"BucketTree"==
this.state.treeType?k.push('&nbsp;<span class="rtl-text"></span> '):k.push('&nbsp;<span class="rtl-text">(',c.get("TOTAL")||0,")</span> ")));b.html(k.join(""));0<c.get("TOTAL")?b.removeClass("edt-empty"):b.addClass("edt-empty")}})})(toa,$);(function(d,c){var b=c.toaUi.EdTree.prototype;c.widget("toaUi.GroupChildResourceTree",c.toaUi.EdTree,{select:function(b){b&&this.elements[b]&&(this.unselect(),this.selectNode(b),this.openParents(b),this.scrollToShow(b))},onSelectClick:function(b){if(!c(b.target).is(".edt-icon")){var d={groupId:this.getEventTargetGroupId(b),rootPid:this.getEventTargetRootId(b),selectedPid:this.getEventTargetId(b)};!1!==this._trigger("select",b,d)&&this.select(d.selectedPid)}},isOpened:function(e){return"function"===
typeof this.state.isOpened?this.state.searchKey?!0:this.state.isOpened(e):b.isOpened.apply(this,arguments)},createElement:function(e){try{this.getParentElement(e)}catch(c){return null}return b.createElement.apply(this,arguments)},getResourceLevel:function(b){b=b.get("LEVEL")+1;"undefined"!==typeof this.state.treeRootsLevel&&b>this.state.treeRootsLevel&&(b-=this.state.treeRootsLevel);return b},updateElement:function(e){var c=b.updateElement.apply(this,arguments);this.getEl(c,".edt-row").css("paddingLeft",
20*this.getResourceLevel(e));this.getEl(c,".edt-icon").removeData("hint assigned").attr("pid",e.getId()).attr("icon-type","pt"+e.settings.getResourceTypeIcon(e.get("TYPE"))).empty();this.getEl(c,".edt-label").attr("data-label-pid",e.getId())},renderLabel:function(b,c){var k=['<span class="rtl-text rtl-prov-name">',d.toHtml(c.getName()),"</span>"];this.options.searchKey&&k.push('<span class="rtl-external-id"> [',d.toHtml(c.get("EXTERNAL_ID")),"]</span>");c.get("TEAM")&&k.push(' <span class="ig larr">&nbsp;</span>',
"<span>",d.toHtml(c.get("TEAM")),"</span>");c.get("ASSISTS_TO")&&k.push(' <span class="ig rarr">&nbsp;</span>',"<span>",d.toHtml(c.get("ASSISTS_TO")),"</span>");-1!=c.get("TOTAL")&&(c.isTechnician()?k.push('&nbsp;<span class="rtl-text">(',c.get("PENDING")||0,"/",c.get("TOTAL")||0,")</span> "):c.isBucket()&&(this.state.treeType&&"BucketTree"==this.state.treeType?k.push('&nbsp;<span class="rtl-text"></span> '):k.push('&nbsp;<span class="rtl-text">(',c.get("TOTAL")||0,")</span> ")));b.html(k.join(""));
0<c.get("TOTAL")?b.removeClass("edt-empty"):b.addClass("edt-empty")}})})(toa,$);toa.ns("toa.widgets.ResourceFavorite",{options:{state:null},toString:function(){return"Widget resource favorite"},_create:function(){this.element.addClass("edt-favorites").delegate(".edt-favorites-header","click",this.onPlusClick.bind(this)).delegate(".edt-row","click",this.onSelectClick.bind(this));this.visibilitySwitch=$('<span class="edt-open icr ptplus" role="button">');this.header=$("<div/>").addClass("edt-favorites-header").appendTo(this.element);this.visibilitySwitch.appendTo(this.header);
$('<div class="edt-favorites-icon">').appendTo(this.header);$('<div class="edt-favorites-title">').html(h(21452)).appendTo(this.header);this.root=$("<div/>").addClass("edt-favorites-root").appendTo(this.element);this.state=this.options.state;this.opened=!0},_init:function(){this.clear();this.state&&this.update()},_setOption:function(d,c){switch(d){case "searchKey":$.Widget.prototype._setOption.apply(this,arguments);this.state&&this._init();break;default:$.Widget.prototype._setOption.apply(this,arguments)}},
clear:function(){this.selected=null;this.root.empty();this.elements={}},destroy:function(){this.clear();$.Widget.prototype.destroy.apply(this,arguments)},update:function(){this.state.getCount()&&(!this.options.searchKey||this.options.searchKey===this.state.getFoundSearchKey()&&this.state.getFoundCount())?(this.element.addClass("favorites-resources-visible").show(),this.showRoot(),this.state.getFoundSearchKey()?this.state.eachFound(this.updateItem.bind(this)):this.state.each(this.updateItem.bind(this)),
this.state.getCurrent()&&this.select(this.state.getCurrent().getId())):this.element.removeClass("favorites-resources-visible").hide()},showRoot:function(){this.opened?(this.root.show(),this.visibilitySwitch.removeClass("ptplus").addClass("ptminus")):(this.root.hide(),this.visibilitySwitch.addClass("ptplus").removeClass("ptminus"))},updateItem:function(d){var c=d.getId();this.elements[c]?this.updateElement(d):this.createElement(d)},createElement:function(d){var c=d.getId(),b=$('<div class="edt-favorite-item edt-item"/>').html('<div class="edt-row toa-layout-hbox"><button class="edt-icon" role="button" aria-haspopup="true">&nbsp;</button><button class="edt-label"></button></div>').attr("data-id",
c);this.elements[c]=b;this.updateElement(d);this.root.append(b);return b},updateElement:function(d){var c=d.getId(),b=this.elements[c];this.getEl(b,".edt-icon").attr("class","edt-icon "+d.icon());var e=this.getEl(b,".edt-label").attr("unselectable","on");this.renderLabel(e,d);this.selected==c&&this.getEl(b,".edt-row").addClass("edt-selected");this.getEl(b,".edt-row").css("paddingLeft",-20);this._trigger("itemUpdated",0,{element:b,item:d});this.getEl(b,".edt-icon").removeData("hint assigned").attr("pid",
d.getId()).attr("res-type",d.get("TYPE")).attr("icon-type","pt"+d.settings.getResourceTypeIcon(d.get("TYPE")));this.getEl(b,".edt-label").attr("data-label-pid",d.getId());return b},getEl:function(d,c){var b;switch(c){case ".edt-icon":b=d[0].childNodes[0].childNodes[0];break;case ".edt-label":b=d[0].childNodes[0].childNodes[1];break;case ".edt-row":b=d[0].childNodes[0]}return $(b)},deleteElement:function(d){return d&&d.getId?this.deleteElementById(d.getId()):!1},deleteElementById:function(d){var c=
this.elements[d];if(!c)return!1;this.selected==d&&this.unselect();c.remove();delete this.elements[d];this._trigger("itemDeleted",0,d);return!0},renderLabel:function(d,c){var b=['<span class="rtl-text rtl-prov-name">',toa.toHtml(c.getName()),"</span>"];c.get("TEAM")&&b.push(' <span class="ig larr">&nbsp;</span>',"<span>",toa.toHtml(c.get("TEAM")),"</span>");c.get("ASSISTS_TO")&&b.push(' <span class="ig rarr">&nbsp;</span>',"<span>",toa.toHtml(c.get("ASSISTS_TO")),"</span>");-1!==c.get("TOTAL")&&(c.isTechnician()?
b.push('&nbsp;<span class="rtl-text">(',c.get("PENDING")||0,"/",c.get("TOTAL")||0,")</span> "):c.isBucket()&&(this.state.treeType&&"BucketTree"===this.state.treeType?b.push('&nbsp;<span class="rtl-text"></span> '):b.push('&nbsp;<span class="rtl-text">(',c.get("TOTAL")||0,")</span> ")));d.html(b.join(""));0<c.get("TOTAL")?d.removeClass("edt-empty"):d.addClass("edt-empty")},unselect:function(){this.selected&&this.elements[this.selected]&&this.getEl(this.elements[this.selected],".edt-row").removeClass("edt-selected");
this.selected=null},selectNode:function(d){if(!this.elements[d])return this;this.selected=d;this.getEl(this.elements[d],".edt-row").addClass("edt-selected");return this},select:function(d){d&&this.elements[d]&&(this.unselect(),this.selectNode(d),this.scrollToShow(d))},scrollToShow:function(d){var c=this.elements[d];if(c&&this.element.height()&&this.element.width()){d=this.element.offsetParent().offsetParent();var b=d.get(0).clientHeight,e=d.scrollTop(),b=e+b,g=c.position().top+this.header.height(),
c=g+c.height();c>b&&g<b?d.scrollTop(e+(c-b)):(g>b||g<e)&&d.scrollTop(g)}},onSelectClick:function(d){if(!$(d.target).is(".edt-icon")){var c=$(d.target).closest(".edt-favorite-item").attr("data-id");!1!==this._trigger("favoriteSelect",d,c)&&this.select(c)}},onPlusClick:function(d){this.opened=!this.opened;this.showRoot();d.stopPropagation()}});$.widget("toaUi.ResourceFavorite",toa.widgets.ResourceFavorite);toa.ns("toa.widgets.ResourceGroups",{options:{screen:null,state:null,mainTreeState:null},toString:function(){return"Widget resource groups"},_create:function(){this.element.addClass("edt-favorites").delegate(".edt-group-open","click",this.onOpenGroupClick.bind(this)).delegate(".edt-group-row","click",this.onGroupSelectClick.bind(this));this.groupsList=$("<div />").addClass("edt-favorites-root").appendTo(this.element);this.state=this.options.state;this.mainTreeState=this.options.mainTreeState;this.openedGroups=
[];this.screen=this.options.screen;this.trees={};this.treesIds=[];this._bindGroupHints()},_bindGroupHints:function(){$.toaUi.ResourceGroups.dialogConfirmDeleteGroupExist||toa.app.bind("resourceGroup.delete",this.showConfirmationDeleteResourceGroup.bind(this));$.toaUi.ResourceGroups.dialogConfirmDeleteGroupExist=!0;$.toaUi.ResourceGroups.dialogPopupRenameGroupExist||toa.app.bind("resourceGroup.edit",this.navigateToGroupManagementScreen.bind(this));$.toaUi.ResourceGroups.dialogPopupRenameGroupExist=
!0},_init:function(){this.clear();this.state&&this.update()},showConfirmationDeleteResourceGroup:function(d,c){new toa.ui.Confirm({text:h(224709,{"{GROUP_NAME}":c.currentName}),acceptButtonHandler:function(){toa.app.trigger("global.data.get",{controller:"Resourcegroups",method:"deleteGroup",params:this._addTreeRequest(c),responseHandler:function(b,e){if(!e.error_code&&c.gid==this.state.selection.groupId){var d=this.state.getGroupIdAfterDelete();d?(this.selectGroup(d),this._trigger("groupSelect",null,
{groupId:d})):this.selectMainResourceTreeNode(this.mainTreeState.treeRoots)}}.bind(this)})}.bind(this)})},navigateToGroupManagementScreen:function(d,c){var b=c.gid;$app.navigation().redirect("group-management/"+b)},_addTreeRequest:function(d){d=d||{};d.trees={};d.trees[TOP_PANEL_MAIN_TREE]={};d.trees[BOTTOM_PANEL_MAIN_TREE]={};return d},_setOption:function(d,c){switch(d){case "searchKey":$.Widget.prototype._setOption.apply(this,arguments);this.state&&this._init();break;default:$.Widget.prototype._setOption.apply(this,
arguments)}},clear:function(){this.openedGroups=[];this.groupsList.empty();this.elements={};this.treesIds=[];this.trees={};this.selectedTree=null},destroy:function(){this.clear();$.Widget.prototype.destroy.apply(this,arguments)},update:function(){this.state.getCount()&&(!this.options.searchKey||this.options.searchKey===this.state.getFoundSearchKey()&&this.state.getFoundCount())?(this.element.addClass("favorites-resources-visible").show(),this.state.getFoundSearchKey()?this.state.eachFound(this.updateItem.bind(this)):
this.state.each(this.updateItem.bind(this)),this.state.isNewSearch()||this.handleGroupSelection()):this.element.removeClass("favorites-resources-visible").hide()},handleGroupSelection:function(){var d=this.state.getCurrentSelection(),c=d&&d.groupId?+d.groupId:0,b=d&&d.selectedPid?+d.selectedPid:0,e=!!c&&!!b;c&&!b?this.selectGroup(c):e&&this.selectGroupResource(d)},updateItem:function(d){var c=d.getId(),b=this.elements[c];d.isExpanded()&&this.openedGroups.push(c);b?this.updateElement(d):this.createElement(d)},
createElement:function(d){var c=+d.getId(),b=!0,b=this.state.getFoundSearchKey()?!1:-1!==$.inArray(c,this.openedGroups)?!1:!0,e=d.isEmptyGroup()?"ptempty":b?"ptplus":"ptminus",g=h(22361),k=h(21452),b=b?"toa-hidden":"",e=$('<div class="edt-favorite-item resource-groups-item edt-item"/>').html(['<div class="edt-row edt-group-row toa-layout-hbox"><button class="edt-group-open edt-open icr ',e,'" role="button" aria-label="',g,'"></button><button class="edt-icon edt-group-icon" role="button" aria-haspopup="true" aria-label="',
k,'">&nbsp;</button><button class="edt-label edt-group-name"></button></div><div class="edt-children resource-groups-item-content ',b,'" role="group"></div>'].join("")).attr("data-id",c).attr("data-group-id",c);this.trees[c]={};this.createGroupChildren(e,d);this.elements[c]=e;this.updateElement(d);this.groupsList.append(e);return e},createGroupChildren:function(d,c){var b=c.getId(),e=c.getVisibleStructureRootPids(),g=c.getRootPids(),k=d.find(".resource-groups-item-content").empty();$.each(g,function(d,
g){if(e.includes(g+"")){var p=c.getTreeModelByPid(g),s=p.identifier,t=new toa.view.GroupChildResourceTreePanel(k,{state:p,draggable:!0,withCloseButton:!1});this.treesIds.push(s);this.trees[b][g]=t;t.addListener("groups.selectTreeNode",function(b,e){this.unselectGroup();this.clearTreeSelection();this.selectTree(t);this._trigger("resourceSelect",null,e)}.bind(this))}}.bind(this))},changeFilter:function(d){Object.keys(this.trees).forEach(function(c,b){Object.keys(b).forEach(function(b,c){c.state.filter.toggleOption(d)})})},
selectTree:function(d){this.selectedTree=d},clearTreeSelection:function(){this.selectedTree&&(this.selectedTree.treeWidget.GroupChildResourceTree("unselect"),this.selectedTree=null);this.state.unselectGroupResource()},updateElement:function(d){var c=d.getId(),c=this.elements[c],b=this.getEl(c,".edt-label").attr("unselectable","on");this.renderLabel(b,d);this._trigger("itemUpdated",0,{element:c,item:d});this.getEl(c,".edt-icon").removeData("hint assigned").attr("resourcegroup",d.getId()).attr("pid",
d.getId());return c},getEl:function(d,c){var b;switch(c){case ".edt-group-open":b=d[0].childNodes[0].childNodes[0];break;case ".edt-icon":b=d[0].childNodes[0].childNodes[1];break;case ".edt-label":b=d[0].childNodes[0].childNodes[2];break;case ".edt-row":b=d[0].childNodes[0];break;case ".edt-children":b=d[0].childNodes[1]}return $(b)},renderLabel:function(d,c){var b=['<span class="rtl-text rtl-prov-name">',toa.toHtml(c.getName()),"</span>"];d.html(b.join(""));d.addClass("edt-empty")},unselectGroup:function(){$.each(this.elements,
function(d,c){this.getEl(this.elements[c.data("id")],".edt-row").removeClass("edt-selected")}.bind(this))},unselectGroupResource:function(){},selectNodeGroup:function(d){d&&$.each(this.elements,function(c,b){b.data("group-id")==d&&this.getEl(this.elements[b.data("id")],".edt-row").addClass("edt-selected")}.bind(this));return this},selectGroup:function(d){var c=!1;d&&$.each(this.elements,function(b,e){e.data("group-id")==d&&(c=!0)});c&&(this.unselectGroup(),this.selectNodeGroup(d),this.clearTreeSelection(),
this.state.selection&&(this.state.selection.groupId=d,this.state.selection.rootPid=0,this.state.selection.selectedPid=0))},selectGroupResource:function(d){if(d.groupId&&d.rootPid&&d.selectedPid){var c=this.findTree(d.groupId,d.rootPid);c&&c instanceof toa.view.GroupChildResourceTreePanel&&void 0!==c.treeWidget.GroupChildResourceTree("instance")&&(c.treeWidget.GroupChildResourceTree("select",d.selectedPid),this.unselectGroup(),this.clearTreeSelection(),this.selectTree(c),c.state.selectProvider(d))}},
selectMainResourceTreeNode:function(d){this.state.clearSelection();this.mainTreeState.currentlySelected=d;this.mainTreeState.currentlySelectedGroup=0;this.mainTreeState.notify("provider selected",d)},findTree:function(d,c){return d&&c&&this.trees&&this.trees[d]&&this.trees[d][c]?this.trees[d][c]:null},scrollToShow:function(d){},onGroupSelectClick:function(d){if(!$(d.target).is(".edt-icon")){var c=$(d.target).closest(".edt-favorite-item").attr("data-group-id")||!1;this._trigger("groupSelect",d,{groupId:c});
c&&(this.selectedTree=null,this.selectGroup(c))}},onOpenGroupClick:function(d){if(!$(d.target).hasClass("ptempty")){var c=+$(d.target).closest(".edt-favorite-item").attr("data-group-id")||0;$(d.target).closest(".edt-favorite-item").find(".resource-groups-item-content").toggleClass("toa-hidden");var b;$(d.target).hasClass("ptplus")?($(d.target).removeClass("ptplus").addClass("ptminus"),this.openedGroups.push(c),b=!0):($(d.target).removeClass("ptminus").addClass("ptplus"),this.openedGroups=this.openedGroups.filter(function(b){return b!==
c}),b=!1);this.state.getResourceGroup(c)&&this.state.getResourceGroup(c).setExpanded(b);d.stopPropagation()}}});$.widget("toaUi.ResourceGroups",toa.widgets.ResourceGroups);(function(d,c){var b=function(b,k){var l=this;if("mousedown"===b.type&&(1!=b.which||1<b.button))return!1;if(!l.lockDraggable){var n=c(b.target).closest("[data-label-pid]",this.treeWidget);if(n.length&&!n.data("draggable")){n=n.closest(".edt-row").clone(!0);c("#dnd-draggable-save-container").empty().append(n);var p={helper:e.bind(l),distance:15,delay:500,revert:!1,appendTo:_DATA.dispatcher_container,dragmove:!0,dropIntoUpper:!0,cursorAt:{cursor:"hand",top:-5,left:0}};"mousedown"!==b.type&&(p.start=
function(){l.treeWidget.css("overflow","hidden")},p.stop=function(){l.treeWidget.css("overflow","auto")},d.touch.setTouchDraggable(n),d.touch.setTouchDraggable(c(".toa-panel-content")));n.draggable(p);"repeated"!=k&&n.trigger(b)}}},e=function(b,e){if(this.lockDraggable)return!1;var l=(b.originalEvent._originalTarget?c(b.originalEvent._originalTarget):c(b.target)).closest(".edt-label","[data-id]"),n=l.closest(".edt-row","[data-id]"),l=(new d.DnDHint(l,n,this.defDragText||h(8211))).getHint();l.addClass("edtree").css({overflow:"hidden"}).find(".edt-row").css("paddingLeft",
0).removeClass("edt-selected").find(".edt-open").remove();return l};d.ns("toa.view.GroupChildResourceTreePanel",d.define(null,function(b,e){this.options=c.extend({state:null,identifier:"",draggable:!1},e);this.container=b;this.state=this.options.state;this.RESOURCE_TREE_MODE_WITHOUT_DATE="without_date";this.RESOURCE_TREE_MODE_WITHOUT_ROUTES="without_routes";this.RESOURCE_TREE_MODE_FULL="full";this.render()},{render:function(){this.content=c("<div>").addClass("toa-tree-panel").appendTo(this.container);
this.treeWidget=c("<div/>").appendTo(this.content).GroupChildResourceTree({state:this.state,searchKey:this.state.getSearchKey()||"",select:function(b,e){this.notify("provider.selected",e.selectedPid);this.notify("groups.selectTreeNode",e);this.state.selectProvider(e);return!1}.bind(this),filter:function(b,e){var c=e.get("FLAGS"),n=this.state.filter.getMask();if(!(c&e.ACTIVE_PROVIDER))return!!(e.ACTIVE_PROVIDER&n);for(var p=0;p<e.ALWAYS_SHOW.length;p++)if(d.Resource.prototype.isFlagSet(c,e.ALWAYS_SHOW[p]))return!0;
return this.state.getTreeMode()===this.RESOURCE_TREE_MODE_WITHOUT_DATE||!0===e.get("_C")?!0:c&e.NON_WORKING_DAY||c&this.ON_CALL_PROVIDER&&!(c&this.ACTIVE_QUEUE||this.isFlagSet(c,this.REGULAR_PROVIDER))?!!(e.NON_WORKING_DAY&n):this.state.getTreeMode()===this.RESOURCE_TREE_MODE_WITHOUT_ROUTES?!0:!!(c&n&~e.ACTIVE_PROVIDER)}.bind(this),openFolder:function(b,e){this.state.openFolder(e)}.bind(this),closeFolder:function(b,e){this.state.closeFolder(e)}.bind(this)});this.options.draggable&&this.treeWidget.delegate("[data-label-pid]",
"touchstart mousedown",b.bind(this));this.state.addListener("changed",this.rerender.bind(this));this.state.addListener("dynamicRemoved",function(b,e){this.treeWidget.GroupChildResourceTree("deleteElementById",e.resourceId)}.bind(this));this.state.addListener("provider selected",function(b,e){void 0!==this.treeWidget.GroupChildResourceTree("instance")&&this.treeWidget.GroupChildResourceTree("select",e)}.bind(this));this.state.addListener("provider opened",function(b,e){void 0!==this.treeWidget.GroupChildResourceTree("instance")&&
this.treeWidget.GroupChildResourceTree("openFolder",e)}.bind(this));this.state.addListener("provider closed",function(b,e){void 0!==this.treeWidget.GroupChildResourceTree("instance")&&this.treeWidget.GroupChildResourceTree("closeFolder",e)}.bind(this));this.state.addListener("scroll offset updated",function(b,e){this.setScrollOffset(this.state.getScrollOffset())}.bind(this));this.state.filter.addListener("option toggled",function(b,e){void 0!==this.treeWidget.GroupChildResourceTree("instance")&&this.treeWidget.GroupChildResourceTree("update")}.bind(this));
this.treeWidget.GroupChildResourceTree("update")},rerender:function(){if(void 0!==this.treeWidget.GroupChildResourceTree("instance")){var b=this.getScrollOffset();this.treeWidget.GroupChildResourceTree("clear");this.treeWidget.GroupChildResourceTree("update");this.setScrollOffset(b)}},getScrollOffset:function(){return{top:this.treeWidget.scrollTop(),left:this.treeWidget.scrollLeft()}},setScrollOffset:function(b){this.treeWidget.scrollTop(b.top);this.treeWidget.scrollLeft(b.left)},scrollToShow:function(b){this.treeWidget.GroupChildResourceTree("scrollToShow",
b)},getSearchKey:function(){return this.treeWidget.GroupChildResourceTree("option","searchKey")},getSelectedProviderId:function(){return this.state.currentlySelected},enableMultidayMode:function(){this.content.addClass("multiday_tree_view")},disableMultidayMode:function(){this.content.removeClass("multiday_tree_view")}}));d.mixin(d.view.GroupChildResourceTreePanel.prototype,d.mixins.EventEmitter)})(toa,$);(function(d,c){var b=function(b,k){var l=this;if("mousedown"===b.type&&(1!=b.which||1<b.button))return!1;if(!l.lockDraggable){var n=c(b.target).closest("[data-label-pid]",this.treeWidget);if(n.length&&!n.data("draggable")){n=n.closest(".edt-row").clone(!0);c("#dnd-draggable-save-container").empty().append(n);var p={helper:e.bind(l),cancel:!1,distance:15,delay:500,revert:!1,appendTo:_DATA.dispatcher_container,dragmove:!0,dropIntoUpper:!0,cursorAt:{cursor:"hand",top:-5,left:0}};"mousedown"!==b.type&&
(p.start=function(){l.treeWidget.css("overflow","hidden")},p.stop=function(){l.treeWidget.css("overflow","auto")},d.touch.setTouchDraggable(n),d.touch.setTouchDraggable(c(".toa-panel-content")));n.draggable(p);"repeated"!=k&&n.trigger(b)}}},e=function(b,e){if(this.lockDraggable)return!1;var l=(b.originalEvent._originalTarget?c(b.originalEvent._originalTarget):c(b.target)).closest(".edt-label","[data-id]"),n=l.closest(".edt-row","[data-id]"),l=(new d.DnDHint(l,n,this.defDragText||h(8211))).getHint();
l.addClass("edtree").css({overflow:"hidden"}).find(".edt-row").css("paddingLeft",0).removeClass("edt-selected").find(".edt-open").remove();return l};d.ns("toa.view.ResourceTreePanel",d.define(null,function(b,e){this.options=c.extend({state:null,identifier:"",draggable:!1,groups:!1},e);this.container=b;this.state=this.options.state;this.render()},{render:function(){this.container.empty();this.content=c("<div>").addClass("toa-tree-panel").appendTo(this.container);this.caption=d.view.control.create({xtype:"ResourceTreeCaption",
addClass:"toa-panel-title",withCloseButton:this.options.withCloseButton,screenName:this.options.screenName||"",widthFilter:!0,filter:this.state.filter,listeners:{search:function(b,e){var c=null,d=null;this.isGroupsWidgetAllowed()&&this.state.getResourceGroups&&this.state.getResourceGroups()&&(c=this.state.getResourceGroups());this.isFavoritesWidgetAllowed()&&this.state.getResourceFavorites&&this.state.getResourceFavorites()&&(d=this.state.getResourceFavorites());""===e.key?(this.state.clearSearch(),
d&&d.clearSearch(),c&&c.clearSearch()):(this.state.search(e.key),d&&d.search(e.key),c&&c.search(e.key))}.bind(this),filterChanged:function(b,e){this.state.filter.toggleOption(e.name);this.isGroupsWidgetAllowed()&&this.state.getResourceGroups&&this.state.getResourceGroups()&&this.resourceGroupsWidget&&this.resourceGroupsWidget.ResourceGroups("changeFilter",e.name)}.bind(this),close:function(){this.notify("panel.hide")}.bind(this)}});this.caption.render(this.content);this.treeWidget=c("<div/>").addClass("toa-panel-content").appendTo(this.content).ResourceTree({state:this.state,
select:function(b,e){this.notify("provider.selected",e);this.isFavoritesWidgetAllowed()&&this.state.getResourceFavorites()&&this.favoriteResourceWidget&&(this.state.getResourceFavorites().unselectProvider(),this.favoriteResourceWidget.ResourceFavorite("unselect"));this.isGroupsWidgetAllowed()&&this.state.getResourceGroups()&&this.resourceGroupsWidget&&(this.state.getResourceGroups().clearSelection(),this.resourceGroupsWidget.ResourceGroups("unselectGroup"),this.resourceGroupsWidget.ResourceGroups("clearTreeSelection"));
this.state.selectProvider(e);return!1}.bind(this),filter:function(b,e){var c=this.caption.getFilter(),n=e.get("FLAGS"),p=this.state.filter.getMask();if(!(n&e.ACTIVE_PROVIDER))return!!(e.ACTIVE_PROVIDER&p);for(var s=0;s<e.ALWAYS_SHOW.length;s++)if(d.Resource.prototype.isFlagSet(n,e.ALWAYS_SHOW[s]))return!0;return this.state.getTreeMode()===c.RESOURCE_TREE_MODE_WITHOUT_DATE||!0===e.get("_C")?!0:n&e.NON_WORKING_DAY||n&this.ON_CALL_PROVIDER&&!(n&this.ACTIVE_QUEUE||this.isFlagSet(n,this.REGULAR_PROVIDER))?
!!(e.NON_WORKING_DAY&p):this.state.getTreeMode()===c.RESOURCE_TREE_MODE_WITHOUT_ROUTES?!0:!!(n&p&~e.ACTIVE_PROVIDER)}.bind(this),openFolder:function(b,e){this.state.openFolder(e)}.bind(this),closeFolder:function(b,e){this.state.closeFolder(e)}.bind(this)});this.isFavoritesWidgetAllowed()&&this.state.getResourceFavorites()?this.initFavoritesWidget():this.isGroupsWidgetAllowed()&&this.state.getResourceGroups()&&this.initResourceGroupsWidget();this.options.draggable&&this.treeWidget.delegate("[data-label-pid]",
"touchstart mousedown",b.bind(this));this.state.addListener("changed",this.rerender.bind(this));this.state.addListener("dynamicRemoved",function(b,e){this.treeWidget.ResourceTree("deleteElementById",e.resourceId)}.bind(this));this.state.addListener("provider selected",function(b,e){void 0!==this.treeWidget.ResourceTree("instance")&&this.treeWidget.ResourceTree("select",e)}.bind(this));this.state.addListener("provider opened",function(b,e){void 0!==this.treeWidget.ResourceTree("instance")&&this.treeWidget.ResourceTree("openFolder",
e)}.bind(this));this.state.addListener("provider closed",function(b,e){void 0!==this.treeWidget.ResourceTree("instance")&&this.treeWidget.ResourceTree("closeFolder",e)}.bind(this));this.state.addListener("provider search",function(b,e){this.caption.setOption("searchText",e);void 0!==this.treeWidget.ResourceTree("instance")&&this.treeWidget.ResourceTree("option","searchKey",e)}.bind(this));this.state.addListener("scroll offset updated",function(b,e){this.setScrollOffset(this.state.getScrollOffset())}.bind(this));
this.state.filter.addListener("option toggled",function(b,e){var c=this.state.filter.getOption(e),d=this.caption.getFilter();c.active?d.checkOption(e):d.uncheckOption(e);void 0!==this.treeWidget.ResourceTree("instance")&&this.treeWidget.ResourceTree("update")}.bind(this));this.state.addListener("treeModeUpdated",function(b,e){this.caption.getFilter().setMode(e)}.bind(this));this.state.notify("treeModeUpdated",this.state.getTreeMode());this.treeWidget.ResourceTree("update")},initFavoritesWidget:function(){this.favoriteResourceWidget=
c("<div/>").addClass("toa-resource-favorites").ResourceFavorite({state:this.state.getResourceFavorites(),favoriteSelect:function(b,e){this.notify("provider.selected",e);this.state.getResourceFavorites().selectProvider(e);this.state.selectProvider(e);this.treeWidget.ResourceTree("unselect");return!1}.bind(this)});this.treeWidget.ResourceTree("setFavorites",this.favoriteResourceWidget);this.state.getResourceFavorites().addListener("favorite provider unselected",function(){this.favoriteResourceWidget.ResourceFavorite("instance")&&
this.favoriteResourceWidget.ResourceFavorite("unselect")}.bind(this));this.state.getResourceFavorites().addListener("favorite provider search",function(b,e){this.favoriteResourceWidget.ResourceFavorite("instance")&&this.favoriteResourceWidget.ResourceFavorite("option","searchKey",e)}.bind(this));this.state.getResourceFavorites().addListener("changed",this.rerender.bind(this))},initResourceGroupsWidget:function(){this.resourceGroupsWidget=c("<div/>").addClass("toa-resource-favorites").ResourceGroups({screen:this.options.screenName,
state:this.state.getResourceGroups(),mainTreeState:this.state,groupSelect:function(b,e){this.state.getResourceGroups().selectGroup(e.groupId);this.state.selectGroup(e.groupId);this.treeWidget.ResourceTree("unselect")}.bind(this),resourceSelect:function(b,e){this.notify("provider.selected",e.selectedPid);this.state.getResourceGroups().selectGroupResource(e);this.state.selectGroupResource(e);this.treeWidget.ResourceTree("unselect")}.bind(this)});this.treeWidget.ResourceTree("setResourceGroups",this.resourceGroupsWidget);
this.state.addListener("group selected",function(b,e){void 0!==this.resourceGroupsWidget.ResourceGroups("instance")&&this.resourceGroupsWidget.ResourceGroups("selectGroup",e)}.bind(this));this.state.addListener("resource selected",function(){void 0!==this.resourceGroupsWidget.ResourceGroups("instance")&&this.resourceGroupsWidget.ResourceGroups("selectGroupResource",arguments)}.bind(this));this.state.getResourceGroups().addListener("resource unselected",function(){this.resourceGroupsWidget.ResourceGroups("instance")&&
this.resourceGroupsWidget.ResourceGroups("unselectGroupResource")}.bind(this));this.state.getResourceGroups().addListener("group unselected",function(){this.resourceGroupsWidget.ResourceGroups("instance")&&this.resourceGroupsWidget.ResourceGroups("unselectGroup")}.bind(this));this.state.getResourceGroups().addListener("groups search",function(b,e){this.resourceGroupsWidget.ResourceGroups("instance")&&this.resourceGroupsWidget.ResourceGroups("option","searchKey",e)}.bind(this));this.state.getResourceGroups().addListener("changed",
this.rerenderGroupsWidget.bind(this))},rerenderGroupsWidget:function(){this.isGroupsWidgetAllowed()&&this.state.getResourceGroups()&&(this.resourceGroupsWidget?(this.resourceGroupsWidget.ResourceGroups("clear"),this.resourceGroupsWidget.ResourceGroups("update")):this.initResourceGroupsWidget())},rerender:function(){if(void 0!==this.treeWidget.ResourceTree("instance")){var b=this.getScrollOffset();this.treeWidget.ResourceTree("clear");this.treeWidget.ResourceTree("update");this.isFavoritesWidgetAllowed()?
this.state.getResourceFavorites()&&this.favoriteResourceWidget?(this.favoriteResourceWidget.ResourceFavorite("clear"),this.favoriteResourceWidget.ResourceFavorite("update")):this.state.getResourceFavorites()&&!this.favoriteResourceWidget&&this.initFavoritesWidget():this.isGroupsWidgetAllowed()&&this.state.getResourceGroups()&&!this.resourceGroupsWidget&&this.initResourceGroupsWidget();this.setScrollOffset(b)}},getScrollOffset:function(){return{top:this.treeWidget.scrollTop(),left:this.treeWidget.scrollLeft()}},
setScrollOffset:function(b){this.treeWidget.scrollTop(b.top);this.treeWidget.scrollLeft(b.left)},scrollToShow:function(b){this.treeWidget.ResourceTree("scrollToShow",b)},getSearchKey:function(){return this.treeWidget.ResourceTree("option","searchKey")},getSelectedProviderId:function(){return this.state.currentlySelected},enableMultidayMode:function(){this.content.addClass("multiday_tree_view")},disableMultidayMode:function(){this.content.removeClass("multiday_tree_view")},isFavoritesWidgetAllowed:function(){return d.currentInterface===
INTERFACE.MANAGE},isGroupsWidgetAllowed:function(){return this.options.groups&&d.currentInterface===INTERFACE.MOBILITY}}));d.mixin(d.view.ResourceTreePanel.prototype,d.mixins.EventEmitter)})(toa,$);(function(d,c){d.widget("toaUi.ResourceSelect",{options:{readOnly:!1,identifier:null,selected:null},_init:function(){this.itemTpl=c.TemplateCache.create("toaUi.ResourceSelect/content",['<span style="display:block" pid="<%= item.getId() %>">','<span style="float:left;display:inline-block" pid="<%= item.getId() %>" class="<%= item.icon() %>">&nbsp;</span>',"<%- item.getName() %></span>"]);this.emptyTpl=c.TemplateCache.create("toaUi.ResourceSelect/empty",['<span style="overflow: visible;" class="ui-button-icon-primary ui-icon ui-icon-modify">&nbsp;</span>']);
var b=c.TemplateCache.create("toaUi.ResourceSelect",'<button <% if(readOnly){ %> disabled="disabled" <% } %> ,<% if(ariaLabelledBy){ %> <%= ariaLabelledBy %> <% } %>,name="addResource" aria-haspopup="true" type="button" ,class="toa-button toa-resourceSelect-label ui-button<% if(readOnly){ %>" toa-button-disabled" <% } %>" ,style="width: 240px; border: 1px solid #EEEEEE; height: auto;">,</button>'.split(",")).apply({readOnly:this.options.readOnly,ariaLabelledBy:this.options.attrs&&this.options.attrs.aria_labelledby?
' aria-labelledby="'+this.options.attrs.aria_labelledby+'" ':!1});this.element.append(b);this.addButton=this.element.find("[name=addResource]");this.options.readOnly||this.element.bind("click",this.showTree.bind(this));this.label=this.element.find(".toa-resourceSelect-label");this.popup=d("<div/>").appendTo(_DATA.dispatcher_container).Tip({width:500,height:300,maxWidth:500,animation:{hide:"fadeOut",show:"fadeIn"},closable:!1,closeOnOutsideClick:!0,notOutsideElements:[this.addButton],callout:{side:"left",
position:"center"}});this.treeState=this.options.treeState;this.resourceTreePanel=new c.view.ResourceTreePanel(this.popup,{state:this.treeState,draggable:!1});this.resourceTreePanel.addListener("provider.selected",this.treeSelected.bind(this));this.options.selected?this.select(this.options.selected):this.clear()},addResource:function(b,e){b&&(this.label.html(this.itemTpl.apply({item:b})),this.options.selected=b,this._trigger("add",e,b))},showTree:function(){this.resourceTreePanel.getSearchKey();this.popup.Tip("showAt",
this.addButton,"right")},hidePopup:function(){this.popup.Tip("hide")},treeSelected:function(b,e){var c=this.treeState.get(e);if(!c||!1===this._trigger("accept",b,c))return!1;this.options.selected=c;this.addResource(c);this.hidePopup();return!0},openFolder:function(b){this.resourceTreePanel.treeWidget.ResourceTree("openParents",b)},select:function(b){b?this.treeState.getAsync([b],function(){this.treeState.selectProvider(b);this.treeSelected(null,b)}.bind(this)):this.clear()},clear:function(){this.label.html(this.emptyTpl.apply());
this.options.selected=null;this._trigger("clear")},showNotify:function(b){this.resourceTreePanel.treeWidget.ResourceTree("showNotify",b)},destroy:function(){this.popup.remove();d.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery,toa);(function(d,c){d.widget("toaUi.ResourceMultiSelect",{options:{items:[],readOnly:!1,identifier:null,selected:null,acceptCheck:!0},_init:function(){this.itemTpl=c.TemplateCache.create("toaUi.ResourceMultiSelect/Option",['<option <%if(!item.is_visible){ %> class="inact_val" <% } %>',' value="<%= item.pid %>"><%= item.pname %></option>']);this.translations={Add:h("18124"),Delete:h("18125")};var b=c.TemplateCache.create("toaUi.ResourceMultiSelect",'<table cellspacing="0" class="section"><tbody>,<tr valign="middle"><td></td><td>,<select name="resources" class="pwi8" size="8" <% if(readOnly){ %> disabled="disabled" <% } %> <% if(ariaLabelledBy){ %> <%= ariaLabelledBy %> <% } %> <% if(required){ %> <%= required %> <% } %> >,<% for(var i=0; i< items.length; i++){ %>,<%= itemTpl.apply({item:items[i]}) %>,<% } %>,</select>,</td><td>,<% if(!readOnly){ %>,<button aria-haspopup="true" class="toa-button" name="addResource" type="button"  style="min-width:100px" ,<% if(resource !== undefined && resource.hasOption(toa.Resource.prototype.PROVIDER_FEATURE_CONTINGENT_WORKERS)) {%> disabled="disabled" <%}%> >,<%- h["Add"] %>,</button><br/><br/>,<button class="toa-button" name="deleteSelected" type="button" , style="min-width:100px" disabled>,<%- h["Delete"] %>, </button><% } %>,</td></tr></tbody></table>'.split(",")).apply({itemTpl:this.itemTpl,
items:this.options.items,readOnly:this.options.readOnly,resource:this.options.resource,h:this.translations,ariaLabelledBy:this.options.attrs&&this.options.attrs.aria_labelledby?' aria-labelledby="'+this.options.attrs.aria_labelledby+'" ':!1,required:this.options.attrs&&this.options.attrs.required?" required ":""});this.element.append(b);this.selectElement=this.element.find("[name=resources]");this.addButton=this.element.find("[name=addResource]");this.delButton=this.element.find("[name=deleteSelected]");
this.options.readOnly||(this.selectElement.bind("change click",this.updateDeleteButton.bind(this)),this.addButton.bind("click",this.showTree.bind(this)),this.delButton.bind("click",this.deleteSelectedResource.bind(this)));this.popup=d("<div/>").appendTo(_DATA.dispatcher_container).Tip({width:500,height:300,animation:{hide:"fadeOut",show:"fadeIn"},closable:!1,closeOnOutsideClick:!0,notOutsideElements:[this.addButton],callout:{side:"left",position:"center"}});this.treeState=this.options.treeState;this.resourceTreePanel=
new c.view.ResourceTreePanel(this.popup,{state:this.treeState,draggable:!1});this.resourceTreePanel.addListener("provider.selected",this.treeSelected.bind(this))},getByPid:function(b){for(var e=0;e<this.options.items.length;e++)if(this.options.items[e].pid==b)return this.options.items[e];return!1},getItemsHash:function(){for(var b={},e=0;e<this.options.items.length;e++)b[this.options.items[e].pid]=this.options.items[e];return b},updateDeleteButton:function(){this.delButton.get(0).disabled=!this.canRemoveSelected();
return!1},canRemoveSelected:function(){var b=this.selectElement.get(0).selectedIndex;return-1!==b&&this.options.items[b].is_visible},deleteSelectedResource:function(){var b=this.selectElement.get(0).selectedIndex;if(!this.canRemoveSelected())return!1;this.deleteItem(b);return!0},deleteItem:function(b){this.selectElement.children("option").eq(b).remove();var e=this.options.items[b];this.options.items.splice(b,1);this.updateDeleteButton();this._trigger("remove",null,e)},addResource:function(b,e){e&&
(this.options.items.push(e),this.selectElement.append(this.itemTpl.apply({item:e})),this._trigger("add",b,e))},setResources:function(b){if(b){this.options.items=b;this.selectElement.empty();for(var e in b)this.selectElement.append(this.itemTpl.apply({item:b[e]}))}},resourceToItem:function(b){return{pid:b.getId(),pname:b.getName(),is_visible:!0}},showTree:function(){this.resourceTreePanel.getSearchKey();this.popup.Tip("showAt",this.addButton,"right")},hidePopup:function(){this.popup.Tip("hide")},treeSelected:function(b,
e){if(this.getByPid(e))return this.showNotify(r(5602)),!1;var c=this.treeState.get(e);if(!c||this.options.acceptCheck&&!1===this.acceptCheck(c)||!1===this._trigger("accept",b,c))return!1;this.options.selected=c;this.addResource(b,this.resourceToItem(c));b.ctrlKey||this.hidePopup();return!0},openFolder:function(b){this.resourceTreePanel.treeWidget.ResourceTree("openParents",b)},select:function(b){this.treeState.selectProvider(b)},showNotify:function(b){this.resourceTreePanel.treeWidget.ResourceTree("showNotify",
b)},acceptCheck:function(b){b=b.getId();var e=this.getItemsHash(),c=b;do if(c=this.treeState.get(c).getParent(),e[c])return this.showNotify(r(5600)+"("+hs(this.treeState.get(c).getName())+")"),!1;while(c);var c=[],d;for(d in e)e[d].is_visible&&this.treeState.isDistantParent(d,b)&&c.push(hs(this.treeState.get(d).getName()));return c.length?(this.showNotify(r(8197)+"<br/>"+c.join(", ")),!1):!0},destroy:function(){this.popup.remove();d.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery,toa);(function(d){var c=$.extend({},d.mixins.EventEmitter,{options:{showWeek:!1,defaultDate:null},_showMonth:null,_firstDay:null,_target:null,_today:null,_selectedDate:null,_cacheCell:{},_cacheMonth:{},_isSmallScreen:!1,_monthTpl:'<table aria-label="<%=monthYear%>">,<thead>,<tr class="row weekday">,<%if (showWeek){%>,<th>#</th>,<%}%>,<%for (var i = 0; i < listDay.length; i++){%>,<th aria-hidden="true" scope="col" class="col day <%if (i == 0 || i == 6){%>holiday<%}%>" title="<%=dayNames[listDay[i]]%>">,<%=shortWeekdays[listDay[i]]%>,</th>,<%}%>,</tr>,</thead>,<tbody>,<%for (var i = 0; i < days.length; i++){%>,<tr class="row" role="row">,<%if (showWeek){%>,<td class="week">,<%if(days[i][0] != "&nbsp;"){%>,<%=toa.date.calculateNumWeek(daysParam[i][0].date)%>,<%}else{%>,&nbsp;,<%}%>,</td>,<%}%>,<%for (var j = 0; j < days[i].length; j++){%>,<td data-value="<%=daysParam[i][j].dayISO%>" class="col <%=daysParam[i][j].extraClass%>" title="<%=daysParam[i][j].dayReadable%>" >,<a role="button" <%=daysParam[i][j].ariaCurrentDate%> ,<%if(days[i][j] != "&nbsp;"){%>, href="javascript:void(0);",<%}%>,>,<span aria-hidden="true" class="day-visible-text"><%=days[i][j]%></span>,<span class="visuallyhidden readable-day-text"><%=daysParam[i][j].dayReadable%></span>,</a>,</td>,<%}%>,</tr>,<%}%>,</tbody>,</table>'.split(","),
setToday:function(b){this._today=b},getToday:function(){if(!this._today)throw"You must set today";return this._today},setDate:function(b){this.updateDate(b);this._isSmallScreen||this.notify("changeDate",this.getDate())},getDate:function(){return this._selectedDate},updateDate:function(b){b&&(b=this._parseIsoDate(b),b=this._formatIsoDate(b));null!=this._selectedDate&&this._target&&this.updateCellSelectedStatus(this._getCell(this._selectedDate),!1);b?(this._showMonth=this._selectedDate=b,!this._isNonScheduled(b)&&
this._target&&this.updateCellSelectedStatus(this._getCell(this._selectedDate),!0)):this._selectedDate=null},updateCellSelectedStatus:function(b,e){var c=b.find(".readable-day-text"),k=c.text(),l=d.glossary({id:1437});e?b.addClass("selected"):b.removeClass("selected");-1==k.indexOf(l)||e?-1==k.indexOf(l)&&e&&(k+=" "+l):k=k.replace(l,"");c.text(k.trim().replace(/  +/g," "))},renderTo:function(b){this._target=$(b);this._target.append(this._render());this.options.defaultDate&&this.updateDate(this.options.defaultDate)},
setOptions:function(){return{dayNames:d.date.weekdays,monthNames:d.date.months,shortWeekdays:d.date.shortWeekdays}},_create:function(b,e){var c;this.options=$.extend({},this.options,this.setOptions(),e);this.compileMonth=(new d.Template(this._monthTpl)).compile();c=this._formatIsoDate(d.date.currentDate());d.app&&d.app.get("today")&&(c=d.app.get("today"));e&&e.today&&(c=e.today);this.setToday(c);this._showMonth||(this._showMonth=c);null!=b&&this.renderTo(b);this._firstDay=d.date.firstDay},_render:function(){var b,
e;b=this._parseIsoDate(this._getShowMonth());e=b.getFullYear();b=b.getMonth();return this._createCalendar(e,b)},_getShowMonth:function(){return this._showMonth},_clickDate:function(b){this.setDate(b)},_createCalendar:function(b,e){var c=this,k=c.options,l,n,p,s,t,u,v,w=[],x=[];t=new Date(b,e,1);u=c._formatIsoDate(t);if(c._cacheMonth[u])return c._cacheMonth[u];l=d.date.getMonthTable(b,e);for(p=0;p<l.length;p++)for(w[p]=[],x[p]=[],s=0;s<l[p].length;s++)x[p][s]={},x[p][s].extraClass="",null==l[p][s]?
(x[p][s].extraClass+=" empty-col",w[p][s]="&nbsp;"):(v=l[p][s],n=c._formatIsoDate(v),x[p][s].dayISO=n,x[p][s].dayReadable=d.date.formatDate("d F l",v),x[p][s].ariaCurrentDate=this.getToday()===n?' aria-current="date" ':"",x[p][s].date=v,x[p][s].extraClass=c._getExtraClass(n),w[p][s]=v.getDate());l=$(c.compileMonth.apply({monthYear:d.date.formatDate("F Y",new Date(b,e,1)),showWeek:k.showWeek,listDay:d.date.getListDay(),dayNames:k.dayNames,shortWeekdays:k.shortWeekdays,days:w,daysParam:x}));l.on("click",
"td",function(b){b.preventDefault();b.stopPropagation();c._clickDate(b.currentTarget.getAttribute("data-value"))});n=l.find(".col");v={};for(p=0;p<n.length;p++)s=$(n[p]),k=s.attr("data-value"),c._cacheCell[k]||(v[k]=s);c._cacheCell=$.extend({},c._cacheCell,v);l.attr("month",t.getMonth());l.attr("year",t.getFullYear());v[u]=l;c._cacheMonth=$.extend({},c._cacheMonth,v);return l},_getCell:function(b){var e;e=this._cacheCell[b];"undefined"==typeof e&&(e=this._parseIsoDate(b),this._createCalendar(e.getFullYear(),
e.getMonth()),e=this._cacheCell[b]);return e},_getExtraClass:function(b){var e="";this.getToday()===b&&(e+=" today");d.date.isHoliday(this._parseIsoDate(b))&&(e+=" holiday");return e},_isNonScheduled:function(b){return b===d.date.DAY_WITHOUT_DATE},_shiftDate:function(b,e,c){var d;b=this._parseIsoDate(b);d=b.getFullYear();c=b.getMonth()+(c||0);b=b.getDate()+(e||0);return this._formatIsoDate(new Date(d,c,b))},_parseIsoDate:function(b){return d.date.parseDate("iso",b)},_formatIsoDate:function(b){return d.date.formatDate("iso",
b)}});d.ns("toa.view.calendar.CalendarBase",d.define(null,function(){this._create.apply(this,arguments)},c))})(toa);(function(d){var c=d.view.calendar.CalendarBase,b={options:{minDate:null,maxDate:null,showYear:!1,showPrevMonth:!0,showNextMonth:!0,showFormatDate:"date"},_calendar:null,_isOpen:!1,_prevMonth:null,_currentMonth:null,_nextMonth:null,_calendarTpl:['<div class="toa-calendar">','<div class="top-panel calendar-top-panel"><button class="backButton" aria-label="Back" title="Back"></button><span class="title" aria-label="Date">Date</span></div>','<button type="button" data="prev" class="toa-button prevmonth movemonth" title="',
d.glossary({id:22102}),'" aria-label="',d.glossary({id:22102}),'"><div>&nbsp;</div></button>','<button type="button" data="next" class="toa-button nextmonth movemonth" title="',d.glossary({id:22101}),'" aria-label="',d.glossary({id:22101}),'"><div>&nbsp;</div></button>','<div class="month-left">','<div class="monthname">','<span class="name"></span><span class="year"></span>',"</div>",'<div class="month"></div>',"</div>",'<div class="month-center">','<div class="monthname"><span class="name"></span><span class="year"></span></div>',
'<div class="month"></div>',"</div>",'<div class="month-right">','<div class="monthname">','<span class="name"></span><span class="year"></span>',"</div>",'<div class="month"></div>',"</div>","</div>"],_create:function(){$.extend(this.options,this._global_options);this._bodyMousedownHandler=function(b){if(this._calendar&&!1!==this._isOpen){b=$(b.target);var c=this.options.notOutsideElements;if(!b.closest(this._calendar).length){if(c&&c.length)for(var d=0;d<c.length;d++)if(b.closest(c[d]).length)return;
this.close()}}}.bind(this);$(_DATA.popup_container).on("mousedown",this._bodyMousedownHandler);c.prototype._create.apply(this,arguments)},reset:function(){this._selectedDate=null;this.elmSelectedDate.removeClass("selected");this.elmSelectedDate=null},open:function(){var b;this._firstDay!=d.date.firstDay&&(this._cacheMonth=[],this._updateMonth());!1===this._isOpen&&(this._isOpen=!0,_DATA.is_mobility_app&&this._calendar.css({top:0,left:0}),this._calendar.show(),b=this.fliper.getOptimalPosition(),b.position&&
("bottom"==b.position.appear&&(b.point.top-=2),"top"==b.position.appear&&(b.point.top+=2)),this._calendar.css(b.point))},close:function(){!0===this._isOpen&&(this._isOpen=!1);this.getDate()!=d.date.DAY_WITHOUT_DATE&&(this._showMonth=this.getDate()||this.getToday(),this._updateMonth())},goToday:function(){this._showMonth=this.getToday();this.setDate(this.getToday());this.close()},updateDate:function(b){c.prototype.updateDate.apply(this,arguments);this._showMonth=this._isNonScheduled(b)?this.getToday():
b;this._calendar&&this._updateMonth()},setNonScheduled:function(){this.setDate(d.date.DAY_WITHOUT_DATE);this.options._showMonth=this.getToday()},renderTo:function(b){c.prototype.renderTo.apply(this,arguments);!0===this._isOpen?this.open():this.close();this._updateMonth()},formatDate:function(b){return this._isNonScheduled(b)?h(8203):d.date.formatDate(this.options.showFormatDate,this._parseIsoDate(b))},setMinDate:function(b){this.options.minDate=b},setMaxDate:function(b){this.options.maxDate=b},destroy:function(){$(_DATA.popup_container).off("mousedown",
this._bodyMousedownHandler);this._calendar&&this._calendar.remove()},_render:function(){d.currentInterface===INTERFACE.MOBILITY&&(this.options.showYear=!0);this.compileCalendar=new d.Template(this._calendarTpl);this._calendar=$(this.compileCalendar.apply(this._getTemplateParam()));this._calendar.on("click",".movemonth",this._clickMoveMonth.bind(this));this._calendar.on("click",".backButton",function(){this._calendar.hide()}.bind(this));this._calendar.hide();0<$(_DATA.popup_container).length?$(_DATA.popup_container).append(this._calendar):
$("body").append(this._calendar);this._year=this._calendar.find(".year");this._monthName1=this._calendar.find(".month-left .monthname .name");this._monthName2=this._calendar.find(".month-center .monthname .name");this._monthName3=this._calendar.find(".month-right .monthname .name");this._yearName1=this._calendar.find(".month-left .monthname .year");this._yearName2=this._calendar.find(".month-center .monthname .year");this._yearName3=this._calendar.find(".month-right .monthname .year");this._monthPrev=
this._calendar.find(".month-left .month");this._monthCur=this._calendar.find(".month-center .month");this._monthNext=this._calendar.find(".month-right .month");this._prevMonthButton=this._calendar.find("toa-calendar.prevmonth");this._nextMonthButton=this._calendar.find(".nextmonth");this.fliper=new d.Fliper({getRectAnchor:this._defineAnchorInfo.bind(this),element:this._calendar})},_clickMoveMonth:function(b){var c,d=this.options,l;c=this._getShowMonth();b=b.currentTarget.getAttribute("data");c=this._parseIsoDate(c);
c.setDate(1);c=this._formatIsoDate(c);if("prev"==b){l=this._shiftDate(c,0,-1);c=this._parseIsoDate(l);c=new Date(c.getFullYear(),c.getMonth()+1,0);d.prevMonth&&c.setMonth(c.getMonth()-1);if(this._formatIsoDate(c)<=d.minDate){this._prevMonthButton.addClass("toa-button-disable");return}this._nextMonthButton.removeClass("toa-button-disable")}else if("next"==b){l=this._shiftDate(c,0,1);c=this._parseIsoDate(l);c.setDate(1);d.nextMonth&&c.setMonth(c.getMonth()+1);if(this._formatIsoDate(c)>=d.maxDate){this._nextMonthButton.addClass("toa-button-disable");
return}this._prevMonthButton.removeClass("toa-button-disable")}this._showMonth=l;this._updateMonth()},_clickDate:function(b){var c=this.options;if(b<c.minDate||b>c.maxDate)return!1;this.setDate(b);return!0},_getTemplateParam:function(){return{}},_getMonth:function(b,c){return this._createCalendar(b,c)},_updateMonth:function(){var b,c;this._target&&(b=this._parseIsoDate(this._getShowMonth()),c=b.getFullYear(),this._prevMonth&&(this._prevMonth.detach(),this._currentMonth.detach(),this._nextMonth.detach()),
this._prevMonth=this._getMonth(c,b.getMonth()-1),this._currentMonth=this._getMonth(c,b.getMonth()),this._nextMonth=this._getMonth(c,b.getMonth()+1),this._monthPrev.append(this._prevMonth),this._monthCur.append(this._currentMonth),this._monthNext.append(this._nextMonth),this._monthName1.html(this.options.monthNames[this._prevMonth.attr("month")]),this._monthName2.html(this.options.monthNames[this._currentMonth.attr("month")]),this._monthName3.html(this.options.monthNames[this._nextMonth.attr("month")]),
this.options.showYear&&(d.currentInterface===INTERFACE.MOBILITY?(this._yearName1.html(this._prevMonth.attr("year")),this._yearName2.html(this._currentMonth.attr("year")),this._yearName3.html(this._nextMonth.attr("year"))):(this._yearName1.html(", "+this._prevMonth.attr("year")),this._yearName2.html(", "+this._currentMonth.attr("year")),this._yearName3.html(", "+this._nextMonth.attr("year")))),b=1,!0!==this.options.showPrevMonth?(this._monthPrev.hide(),this._monthName1.hide(),b++):(this._monthPrev.show(),
this._monthName1.show()),!0!==this.options.showNextMonth?(this._monthNext.hide(),this._monthName3.hide(),b++):(this._monthNext.show(),this._monthName3.show()),this._monthCur.attr("colspan",b))},_getExtraClass:function(b){var d=this.options,k=c.prototype._getExtraClass.apply(this,arguments);b<d.minDate&&(k+=" date-disable");b>d.maxDate&&(k+=" date-disable");return k},_initYearMenu:function(){for(var b=new d.view.DropdownMenu({anchor:this._yearName2,showContentOnClick:!0}),c=2013;2010<c;c--)b.addItem({value:c,
text:c});b.render(this._calendar)},_defineAnchorInfo:function(){return{width:0,height:0,top:0,left:0}}};d.ns("toa.view.calendar.CalendarSimple",d.define(c,function(){this._create.apply(this,arguments)},b))})(toa);(function(d){var c=d.view.calendar.CalendarSimple,b={_isDisabled:!1,_formTpl:['<span class="toa-calendar-form">','<span class="input"></span>','<span aria-haspopup="true" aria-label="',d.glossary({id:22352}),'" tabindex="0" role="button" class="icon"></span>',"</span>"],renderTo:function(b){var g=this,k,l;g.formCalendar=$((new d.Template(g._formTpl)).apply());l=g.formCalendar.find(".input");g.form=$(b);"INPUT"==g.form.get(0).tagName?(k=g.form.parent(),g.form.detach()):(k=$(b),g.form=$("<input/>"));
g.form.on("input",function(b){try{var e=$(b.currentTarget).val();if(e){var c=d.date.parseDate("date",e),e=g._formatIsoDate(c);if(e<g.options.minDate||e>g.options.maxDate)return!1}g.updateDate(e)}catch(k){}});g.form.on("change",function(b){try{var e=$(b.currentTarget).val();if(e){var c=d.date.parseDate("date",e),e=g._formatIsoDate(c);if(e<g.options.minDate||e>g.options.maxDate)return!1}g.setDate(e)}catch(k){}});l.append(g.form);k.append(g.formCalendar);g.formCalendar.on("click",".icon",g.open.bind(g));
g.formCalendar.on("keydown",".icon",function(b){13!==b.keyCode&&32!=b.keyCode||g.open()});g.options.notOutsideElements=[g.formCalendar.find(".icon")];g._selectedDate&&g.form.val(g.formatDate(g._selectedDate));c.prototype.renderTo.apply(g,arguments);this.fliper=new d.Fliper({anchor:this.formCalendar,element:this._calendar})},setDate:function(b){this.close();b?this.form.val(this.formatDate(b)):this.form.val("");c.prototype.setDate.apply(this,arguments)},open:function(){var b=this,d;b._isDisabled||(b.formCalendar.addClass("form-selected"),
this._calendar.show(),(d=this.fliper.getOptimalPosition())?this._calendar.css(d):this._calendar.css({left:0,top:0}),$(document).on("mouseup.click_outside touchstart.click_outside",function(c){var d=b._calendar;d.is(c.target)||0!==d.has(c.target).length||b.close()}),b.notify("openDatePicker"),c.prototype.open.apply(this,arguments))},getSelectedElement:function(){return this._getCell(this.getDate()||this.getToday())},close:function(){this.formCalendar.removeClass("form-selected");this._calendar.hide();
$(document).off("mouseup.click_outside touchstart.click_outside");this.notify("closeDatePicker");c.prototype.close.apply(this,arguments)},disable:function(){this.formCalendar&&(this.form.attr("disabled","disabled"),this.formCalendar.addClass("form-disabled"));this._isDisabled=!0},enable:function(){this.formCalendar&&(this.form.removeAttr("disabled"),this.formCalendar.removeClass("form-disabled"));this._isDisabled=!1},destroy:function(){c.prototype.destroy.apply(this,arguments);this.form.remove()},
_defineAnchorInfo:function(){return{width:this.formCalendar.outerWidth(),height:this.formCalendar.outerHeight(),top:this.formCalendar.offset().top,left:this.formCalendar.offset().left}}};d.ns("toa.view.calendar.Datepicker",d.define(c,function(){this._create.apply(this,arguments)},b))})(toa);(function(d,c){d.view.control.define({className:"grid.Grid",extend:"Control",properties:{storage:[],selected:{},selectedExclude:{},selectAllFlag:!1,selectedCount:0,testTarget:null,table:null,currentItem:null,counterActions:[],excludeLimit:100},mixins:[{getDefaults:function(){var b=this.callParent();c.extend(b,{tag:"div","class":"toa-layout-fullfit",multiSelect:!0,columns:!1,setupWidth:20,translation:{preferencesTitle:"Grid Preferences",preferencesHeader:"Table visibility rules",preferencesDescription:"Select and drag columns to place them in the table, use lock to set columns' permanent visibility:"},
items:[{tag:"div",name:"header","class":"toa-grid-header"},{tag:"div",name:"body","class":"toa-grid-body toa-layout-fullfit"},{tag:"div",name:"groupActions","class":"toa-grid-groupactions"}]});return b},init:function(b){this.tableHeaderTpl=d.TemplateCache.create("toa.view.control.grid.grid.tableHeader",['<table role="presentation" >',"<tbody>","<%= rows %>","</tbody>","</table>"]);this.tableTpl=d.TemplateCache.create("toa.view.control.grid.grid.table",'<table aria-label="<%= h(22717 /*List View*/) %>" >;<thead>;<%= cols %>;</thead>;<tbody>;<%= rows %>;</tbody>;</table>'.split(";"));
this.chbxAriaLabel=h(8074);this.toaGridSetupHeader=h(8145);this.chbxSelAllAriaLabel=h(12033);this.selectMode=!1;b=this.callParent(b);this.setOptionColumns(this.getOption("columns"));this.initSetupDialog();isMobilityApp()&&a("visual_assignment_assistant")&&(this.excludeLimit=50);return b},render:function(b){var e=this.callParent(b);this.makeDroppable();this.resize();b.data("selfController",this);return e},bindHandlers:function(){this.groupActionsPanel=this.getChild("groupActions");this.groupActionsPanel.getElement().detach();
this.callParent();this.getChild("header").getElement().on("click",'td[role="button"]',this.onTitleClick.bind(this)).on("click","input.toa-grid-selectall",this.onSelectAllClick.bind(this)).on("click","[data-action=setup]",this.onSetupClick.bind(this));this.getChild("body").getElement().on("scroll",this.onScroll.bind(this)).on("click","td",this.onCellClick.bind(this)).on("click",".toa-grid-checkbox",this.onMultiSelectClick.bind(this));this.groupActionsPanel.getElement().on("click",".action-link",this.onGroupActionClick.bind(this))},
setRows:function(b){this.storage=b;this.clearCounters();this.redrawGroupActions();this.resize();this.refresh()},setCurrentItem:function(b){this.currentItem="undefined"==typeof b?null:b},appendRows:function(b){var e=this.storage.length;this.storage=this.storage.concat(b);b=this.formatRowList(b,this.visibleCount,e);this.getChild("body").getElement().find("tbody").append(b)},clear:function(){this.storage=[]},refresh:function(){this.calculateWidth();this.counterActions=[];var b=this.formatCols(this.visibleCount),
e=this.formatHeader(this.visibleCount),e=this.tableHeaderTpl.apply({rows:e});this.getChild("header").getElement().empty().append(e);e=this.getChild("header").getElement().height();this.getChild("body").getElement().css("top",e);var e=this.formatRowList(this.storage,this.visibleCount),b=this.tableTpl.apply({cols:b,rows:e}),e=this.getChild("body").getElement().get(0),d=e.getElementsByClassName?e.getElementsByClassName("toaGantt-tb"):c("div.toaGantt-tb",e);try{c(d).draggable("destroy")}catch(k){}c(d).removeData();
e.innerHTML=b},getTestTarget:function(){return this.testTarget?this.testTarget.empty():this.testTarget=c("<div/>").addClass("toa-grid-body toa-grid-testtarget").appendTo(_DATA.dispatcher_container)},onDraggStart:function(b,e){var c="",d=b.parents(":eq(1)").find(".toa-grid-checkbox");"undefined"==typeof d||d.is(":checked")?this.currentItem=null:this.currentItem={aid:e.helper.attr("aid"),date:e.helper.attr("par_date"),pid:e.helper.attr("par_pid")};d.length&&(d.is(":checked")?d.attr("checked_before",
"true"):(b.parents(":eq(6)").find(".toa-grid-checkbox").prop("checked",!1),d.attr("checked_before","false"),d.prop("checked",!0)));null==this.currentItem&&1<this.selectedCount&&(c="\n("+this.getSelectedRows().selectedCount+")");""!=c?(e.helper.find(".toaGantt-tb").hide(),e.helper.append('<div class="toa-dndHint-selected-counter">'+r(13209,{"{SELECTED_COUNT}":this.selectedCount})+"</div>")):e.helper.find(".toaGantt-tb").show()},onDraggEnd:function(b){var e=b.parents(":eq(1)").find(".toa-grid-checkbox");
if(e.length)if("true"===e.attr("checked_before"))e.removeAttr("checked_before");else{b=b.parents(":eq(6)");if(b.find(".toa-grid-selectall").is(":checked")){b.find(".toa-grid-checkbox").prop("checked",!0);var c=this.selectedExclude,d;for(d in c)b.find('[data-row="'+d+'"] .toa-grid-checkbox').prop("checked",!1)}else for(d in b.find(".toa-grid-checkbox").prop("checked",!1),c=this.selected,c)b.find('[data-row="'+d+'"] .toa-grid-checkbox').prop("checked",!0);e.removeAttr("checked_before");e.prop("checked",
!1)}},getSelectedRows:function(){var b={exclude_aid:!1,aid:[],pid:-1,date:"",filters:[],singleItem:!1};b.exclude_aid=this.selectAllFlag;b.selectedCount=this.selectedCount;null!=this.currentItem?(b.aid={1:{_v:{z:this.currentItem.aid,D:this.currentItem.date,p:this.currentItem.pid}}},b.singleItem=!0):!this.selectAllFlag||this.selectedCount<=this.excludeLimit&&this.storage.length==this.options.total?(b.exclude_aid=!1,b.aid=this.selected):(b.aid=this.selectedExclude,b.exclude_aid=!0,b.pid=this.options.pid,
b.date=this.options.date,b.filters=this.options.filters,b.selectedCount=this.selectedCount);return b},calculateWidth:function(){var b=this.getOption("columns").getAll(),e=this.getChild("body").getElement().width(),d=this.storage.slice(0,20);d.length||d.push({});var k=c("<table/>").html(this.formatRowList(d)),l=this.getTestTarget();k.appendTo(l);l.width(e);if(k.width()>e){var n=!1;150<k.find("tr:first>td[data-col=0]").width()&&(k.find("tr>td[data-col=0]").html('<div style="width:150px">&nbsp;</div>'),
n=!0);this.visibleCount=this.calculateVisibleCols(k,e)||b.length||0;k.empty().append(this.formatRowList(d,this.visibleCount));n&&k.find("tr>td[data-col=0]").html('<div style="width:150px">&nbsp;</div>')}else this.visibleCount=b.length||0;k.find("tr:first>td").each(function(e){e=c(this);var d=e.attr("data-col");b[d]&&(b[d].curentWidth=e.width()+0)});this.scrollWidth=e-k.width();setTimeout(function(){l.empty()},1)},calculateVisibleCols:function(b,e){var d=0,k=150;b.addClass("toa-grid-minwidth");b.find("tr:first>td").each(function(){k+=
c(this).outerWidth();if(k>e)return!1;d++;return!0});b.removeClass("toa-grid-minwidth");return d},formatRowList:function(b,e,c){for(var d=[],l=this.isSelectAll(),n=c=c||0,p=0;n<b.length+c;n++,p++){var s=b[p];s.hasHeader=!1;d.push("<tr data-row=",n,">",this.formatRow(s,n,e,l),"</tr>")}return d.join("")},formatRow:function(b,e,g,k){var l=this,n=l.getOption("columns").getAll(),p=[],s=n.length,t=0,u=' aria-label="'+l.chbxAriaLabel+'" ';s>g&&(s=g);p.push('<th scope="row" class="screenreaderable-invisible-col">',
r(226659,{"{ROW_NUMBER}":e+2}),"</th>");l.getOption("multiSelect")&&p.push('<td class="toa-grid-multiselect">','<input type=checkbox class="toa-grid-checkbox"',k?' checked="checked" ':"","",u,">","</td>");c.each(n,function(c,g){if((!1===g.hidden||void 0===g.hidden)&&t<s){var k=l.notify("formatCell",{index:e,row:b,col:g}),k=d.isDefined(k)?k:b[g.name]||"";p.push("<td ",g.fixed?' style="width:'+g.width+"px;max-width:"+g.width+'px"  ':""," data-col=",c,g.nowrap?' class="toa-nowrap">':" >",k,"</td>");
t++}});return p.join("")},formatHeader:function(b){var e=this,d=e.getOption("columns").getAll(),k=e.getOption("setupWidth"),l=["<tr>"],n=d.length,p,s,t,u,v=0;e.getOption("multiSelect")&&l.push('<td class="toa-grid-multiselect td-in-grid-header td-in-grid-header_no-left-border">','<input type=checkbox aria-label="',e.chbxSelAllAriaLabel,'" class="toa-grid-selectall" />',"</td>");n>b&&(n=b);var w;c.each(d,function(b,c){if((!1===c.hidden||void 0===c.hidden)&&v<n){t=c.label||"";w=!1===c.sortable?"":' role="button"';
if(c.name==e.getOption("sortBy")){var d="+"==e.getOption("sortDir")?"toa-grid-icon-sort":"toa-grid-icon-sort-desc";t+='<span class="toa-grid-icon '+d+'"></span>'}u=c.addClass?[' class="',c.addClass,'" '].join(""):"";l.push(["<td data-col=",b,u,w,' style="width:',c.curentWidth||"auto",'px" title="',c.label,'">',t,"</td>"].join(""));s=b;p=c;v++}});p&&(l.pop(),l.push(["<td data-col=",s,u,w,">",t,"</td>"].join(" ")));b=e.setupDialog&&e.setupDialog.Tip("isOpen")?'class="toa-grid-setup-active"':"";l.push('<td class="td-in-grid-header td-in-grid-header_no-right-border" style="width:',
k,"px;max-width:",k,'px;" ',b,' data-action="setup"><div role="button" aria-haspopup="true" aria-label="',e.toaGridSetupHeader,'" class="toa-grid-icon toa-grid-icon-setup"></div></td>');l.push("</tr>");return l.join("")},formatCols:function(b){var e=this.getOption("columns").getAll(),g=['<tr class="screenreaderable-invisible-row">'],k=e.length,l,n,p,s=0;k>b&&(k=b);g.push('<th scope="col" class="screenreaderable-invisible-col">',h(226658),"</th>");this.getOption("multiSelect")&&g.push('<th scope="col" class="toa-grid-multiselect"',
' style="padding-top:0;padding-bottom:0;border-top:0;border-bottom:0">',this.chbxAriaLabel,"</th>");c.each(e,function(b,e){l=e;(!1===e.hidden||void 0===e.hidden)&&s<k&&(p=e.label||"",g.push(['<th scope="col" class="toa-grid-col" data-col=',b,' style="width:',e.curentWidth,'px">',p,"</th>"].join("")),s++,n=b)});l&&d.browser.webkit&&(g.pop(),g.push(['<th scope="col" class="toa-grid-col" data-col=',n," >",p,"</th>"].join("")));g.push("</tr>");return g.join("")},redrawHeader:function(){var b=this.isSelectAll(),
e=this.formatHeader(this.visibleCount);this.getChild("header").getElement().find("table").empty().append(e);if(e=this.getChild("header").getElement().find("input.toa-grid-selectall").get(0))e.checked=b},redrawGroupActions:function(){var b=-1;if(!this.selectedCount)return this.groupActionsPanel.getElement().hide(),this.selectMode&&(this.selectMode=!1),this.element.find(".toa-grid-selectall")[0].checked=!1,this.notify("selectMode",{mode:!1,element:this.groupActionsPanel.getElement()}),!0;var e=this.getOption("groupActions"),
b=[],c=[];this.getOption("isResourceQueueOwner")||a("allow_move_between_resources")||"undefined"==typeof this.options.filters.recursively||!this.options.filters.recursively||(c[c.length]="move_activity_group");a("allow_move_between_resources")||a("allow_reschedule_and_move_to_non_scheduled")||a("allow_move_from_non_scheduled_to_scheduled")||-1!=this.indexOfArray(c,"move_activity_group")||(c[c.length]="move_activity_group");for(var d=0;d<e.length;d++){var l=e[d];-1!=this.indexOfArray(c,l.label)&&(b[b.length]=
d)}var d=0,n;for(n in this.selected)d++;n='<a role="link" tabindex="0" class="dismiss-selection-button" title="'+r(20014)+'" aria-label="'+r(20014)+'"></a>';for(var c=[n,"<span>",r(13209,{"{SELECTED_COUNT}":this.selectedCount}),"</span>&nbsp;"],p=!0,d=0;d<e.length;d++)if(-1==this.indexOfArray(b,d)){var l=e[d],s="undefined"!=typeof this.counterActions[d]&&0<=this.counterActions[d]?this.counterActions[d]:-1;if(-1==s||0<s){p&&(p=!1,c=["<span>",r(8548,{"{SELECTED_COUNT}":this.selectedCount}),"</span>&nbsp;"],
c.push(n));var t=l.title;0<s&&(t+="&nbsp;("+s+")");c.splice(-1,0,'<span role="link" tabindex="0" class="action-link" data-action="',l.label,'" title="',l.title,'" aria-label="',l.title,'">',t,"&nbsp;","</span>&nbsp;")}}this.groupActionsPanel.getElement().html(c.join("")).show();this.groupActionsPanel.getElement().children(".dismiss-selection-button").on("click",function(){this.unselectAll()}.bind(this));this.selectMode||(this.selectMode=!0,this.notify("selectMode",{mode:!0,element:this.groupActionsPanel.getElement()}))},
setSort:function(b,e){this.setOption("sortBy",b);this.setOption("sortDir",e);this.isRendered()&&this.redrawHeader()},resize:function(){this.setupDialog&&this.setupDialog.Tip("hide");var b=this.counterActions;this.refresh();this.renewCheckboxes(b);this.notify("resize")},onScroll:function(){var b=this.getChild("body").getElement(),e=b.find("table").height(),c=b.height(),d=b.scrollTop();this.notify("scrollBottom",{top:d,bottom:e-c-b.scrollTop()})},onCellClick:function(b,e){var d=c(b.target),k=d.attr("data-col");
if(!k)return!0;k=this.getOption("columns").get(k);if(!k)return!0;d=d.parent();if(!d)return!0;d=d.attr("data-row");this.notify("cellClick",{col:k,row:this.storage[d]})},onGroupActionClick:function(b,e){var d=c(b.target).attr("data-action"),k=this.getGroupActionByLabel(d||"");if(!k)return!1;var l=[],n={date:this.options.date,pid:this.options.pid,filters:this.options.filters,selectedCount:this.selectedCount};if(this.selectAllFlag&&this.selectedCount>this.excludeLimit){for(var p in this.selectedExclude){var s=
this.selectedExclude[p];l.push(s)}this.notify("groupActionClick",{action:d,selected:l,external:n})}else{for(p in this.selected)s=this.selected[p],s._g&k.mask&&l.push(s);this.notify("groupActionClick",{action:d,selected:l})}},getGroupActionByLabel:function(b){var e=this.getOption("groupActions");if(!e)return!1;for(var c=0;c<e.length;c++){var d=e[c];if(d.label==b)return d}return!1},onTitleClick:function(b,e){var d=c(b.target).attr("data-col");if(!d)return!0;d=this.getOption("columns").get(d);if(!d||
!1===d.sortable)return!0;this.notify("titleClick",{col:d})},onMultiSelectClick:function(b,e){var g=c(b.target).closest("tr").attr("data-row"),k;k="undefined"!=typeof this.storage[g]&&"undefined"!=typeof this.storage[g]._g?this.storage[g]._g:0;var l=this.getOption("groupActions");if(b.target.checked){for(var n=0;n<l.length;n++)"undefined"==typeof this.counterActions[n]&&(this.counterActions[n]=0),k&this.options.groupActions[n].mask&&0<=this.counterActions[n]&&this.counterActions[n]++;delete this.selectedExclude[g];
this.selected[g]=this.storage[g];this.selectedCount++}else{for(n=0;n<l.length;n++)"undefined"==typeof this.counterActions[n]&&(this.counterActions[n]=0),k&this.options.groupActions[n].mask&&("undefined"!=typeof this.counterActions[n]&&0==this.counterActions[n]&&d.app.error("Wrong group action counter on activity list"),"undefined"!=typeof this.counterActions[n]&&0<this.counterActions[n]&&this.counterActions[n]--);this.selectedExclude[g]=this.storage[g];delete this.selected[g];this.selectedCount--}this.redrawGroupActions()},
onSelectAllClick:function(b,e){b.target.checked?this.selectAll():this.unselectAll()},onChangeRatio:function(b,e){var d=c(b.target).attr("data-ratio");d&&(this.notify("ratioClick",{action:d}),b.stopPropagation())},initSetupDialog:function(){var b=this;b.setupDialogTpl=d.TemplateCache.create("toa.view.control.grid.grid.setupDialog",['<div role="heading" class="toa-grid-setup-header">',"<%=translation.preferencesTitle %>","</div>",'<div class="toa-grid-setup-note">',"<h2>","<%=translation.preferencesHeader %>",
"</h2>","<%=translation.preferencesDescription %>","</div>",'<div class="toa-grid-setup-container">','<table width="100%"><caption style="display: none"></caption><tr>','<td class="toa-grid-setup-sortable">',"<% for (var i=1;i<rows.length;i++) { %>","<% var r=rows[i]; %>",'<div aria-dropeffect="move" class="toa-grid-setup-row" data-row="<%=i%>">','<div class="toa-grid-setup-row-order">',"<span><%=i%></span>","</div>",'<div  class="toa-grid-setup-row-data">','<label><input type="checkbox" <%=r.hidden?"":\'checked="checked"\'%> <%=r.name!=="pname"?"":\'disabled="disabled"\'%>/>',
"<span><%=r.label%></span></label>",'<div class="toa-grid-icon toa-grid-icon-nowrap<%=r.nowrap?" toa-grid-icon-nowrap-on":""%>"></div>','<div class="toa-grid-icon toa-grid-icon-sortable toa-grid-icon-sortable-columns" tabindex="0" role="button" aria-label="'+h(227264)+'" draggable="true"></div>',"</div>","</div>","<% } %>","</td>","</tr></table>","</div>"]);b.setupDialog=c("<div/>").Tip({className:"toa-grid-setup-tip",closable:!1,closeOnOutsideClick:!0,callout:{side:"right",position:12},close:function(){b.getChild("header").getElement().find(".toa-grid-setup-active").removeClass("toa-grid-setup-active")}}).on("change",
"input[type=checkbox]",function(){b.onSetupChange()}).on("click",".toa-grid-icon-nowrap-on",function(e){var d=c(this);d.removeClass("toa-grid-icon-nowrap-on");d=d.closest("[data-row]").attr("data-row");b.getOption("columns").get(d).nowrap=!1;e.stopImmediatePropagation();b.onSetupChange()}).on("click",".toa-grid-icon-nowrap",function(){var e=c(this);e.addClass("toa-grid-icon-nowrap-on");e=e.closest("[data-row]").attr("data-row");b.getOption("columns").get(e).nowrap=!0;b.onSetupChange()})},onSetupClick:function(b,
e){var g=this,k=c(b.currentTarget);if(g.setupDialog.Tip("isOpen"))return g.setupDialog.Tip("hide"),k.removeClass("toa-grid-setup-active"),!1;k.addClass("toa-grid-setup-active");var l=g.setupDialogTpl.apply({rows:g.getOption("columns").getAll(),translation:g.getOption("translation")});g.setupDialog.Tip("option","contents",l);g.setupDialog.find(".toa-grid-setup-sortable").sortable({axis:"y",containment:"parent",opacity:0.9,tolerance:"pointer",scroll:!1,placeholder:"toa-grid-setup-placeholder",helper:"clone",
hideOrigin:!1,start:function(b,e){e.item.show().addClass("toa-grid-setup-row-gost")},stop:function(b,e){e.item.removeClass("toa-grid-setup-row-gost");g.onSetupChange()},forceHelperSize:!0});d.touch.setTouchDraggable(".toa-grid-icon-sortable");g.setupDialog.find(".toa-grid-setup-container").css("overflow","auto");g.setupDialog.Tip("option","notOutsideElements",["[data-action=setup]"]);g.setupDialog.Tip("showAt",k,"left")},onSetupChange:function(b,e){var d=this.getOption("columns").getAll(),k=d.splice(0,
1);this.setupDialog.find(".toa-grid-setup-row").each(function(b){var e=c(this),p=e.attr("data-row"),p=d[p-1];e.attr("data-row",b+1);p.hidden=!e.find("input[type=checkbox]")[0].checked;e.find(".toa-grid-setup-row-order span").text(b+1);k.push(p)});this.getOption("columns").setAll(k)},renewCheckboxes:function(b){var e=this.element.find(".toa-grid-checkbox");this.selectAllFlag&&this.element.find(".toa-grid-selectall").attr("checked","checked");for(var d in this.selected)c(e[d]).attr("checked","checked");
this.counterActions=b},selectAll:function(){this.selectAllFlag=!0;this.selected={};for(var b=this.getOption("groupActions"),e=0;e<b.length;e++)this.counterActions[e]=this.options.groupActions[e].count;this.selectedExclude={};this.selectedCount=this.options.total;for(e=0;e<this.storage.length;e++)this.selected[e]=this.storage[e];b=this.getChild("body").getElement().find("input.toa-grid-checkbox[disabled!=disabled]");for(e=0;e<b.length;e++)b[e].checked=!0;this.redrawGroupActions()},clearCounters:function(){this.selectAllFlag=
!1;this.selectedExclude={};this.selected={};this.counterActions=[];this.selectedCount=0},unselectAll:function(){this.clearCounters();this.element.find(".toa-grid-selectall")[0].checked=!1;for(var b=this.getChild("body").getElement().find("input.toa-grid-checkbox"),e=0;e<b.length;e++)b[e].checked=!1;this.redrawGroupActions()},isSelected:function(b){return!!this.selected[b]},isSelectAll:function(){var b=this.getChild("header").getElement().find("input.toa-grid-selectall").get(0);return b?b.checked:
!1},makeDroppable:function(){var b=this;b.getChild("body").getElement().droppable({accept:"[aid]",tolerance:"pointer",drop:function(e,c){e.originalEvent&&e.originalEvent.isCommunityDrop||b.notify("dragDrop",c)},over:function(e,c){b.notify("dragOver",c)},out:function(b,c){c.helper&&c.helper.data("hint")&&c.helper.data("hint").setDefault()}})},setOptionColumns:function(b){var e=this;(this.options.columns=b)&&b.addListener&&b.addListener("changed",function(){e.isRendered()&&(e.refreshTimeout&&clearTimeout(e.refreshTimeout),
e.refreshTimeout=setTimeout(function(){var b=e.counterActions;e.refresh();e.refreshTimeout=null;e.renewCheckboxes(b)},100))})},indexOfArray:function(b,e){for(var c=0,d=b.length;c<d;c+=1)if(b.hasOwnProperty(c)&&b[c]===e)return c;return-1}}]})})(toa,jQuery);(function(d){var c=d.view.calendar.CalendarSimple,b={_mode:"day",_previousMode:"day",dateLine:null,lineTpl:['<table class="toa-calendar-line">','<tr><td class="line-call toa-button-panel">','<button type="button" data="prev" class="prev toa-button" aria-label="',d.glossary({id:22102}),'" title="',d.glossary({id:22102}),'">',"<div>&nbsp;</div>","</button>",'<button type="button" aria-haspopup="true" data="date" class="date toa-button" data-calendar-min-date="<%=minDate%>" data-calendar-max-date="" data-calendar-mode="<%=mode%>">',
"<div><%=date%></div>","</button>",'<button type="button" data="next" class="next toa-button" aria-label="',d.glossary({id:22101}),'" title="',d.glossary({id:22101}),'">',"<div>&nbsp;</div>","</button>","</td></tr>","</table>"],_calendarTpl:['<div class="toa-calendar" tabindex="-1">','<div class="top-panel calendar-top-panel">','<button class="backButton" aria-label="',d.glossary({id:16257}),'" title="',d.glossary({id:16257}),'"></button>','<span class="title" aria-label="',d.glossary({id:537}),'">',
d.glossary({id:537}),"</span>","</div>","<%if (buttonMode){%>",'<div class="mode-panel">','<div class="toa-button-panel">',"<% for (var i in buttonMode) {%>",'<button type="button" data="<%=i%>" class="toa-button">',"<%=buttonMode[i]%>","</button>","<% } %>","</div>",'<select class="mode-select">',"<% for (var i in buttonMode) {%>",'<option value="<%=i%>"><%=buttonMode[i]%></option>',"<% } %>","</select>","</div>","<%}%>",'<button type="button" aria-label="',d.glossary({id:22102}),'" data="prev" class="toa-button prevmonth movemonth" title="',
d.glossary({id:22102}),'"><div>&nbsp;</div></button>','<button type="button" aria-label="',d.glossary({id:22101}),'" data="next" class="toa-button nextmonth movemonth" title="',d.glossary({id:22101}),'"><div>&nbsp;</div></button>','<div class="month-left">','<div class="monthname">','<span class="name"></span><span class="year"></span>',"</div>",'<div class="month"></div>',"</div>",'<div class="month-center">','<div class="monthname"><span class="name"></span><span class="year"></span></div>','<div class="month"></div>',
"</div>",'<div class="month-right">','<div class="monthname">','<span class="name"></span><span class="year"></span>',"</div>",'<div class="month"></div>',"</div>",'<div class="bottompanel bottompanel-hide">','<button type="button" data="reset" class="toa-button">',d.glossary({id:21}),"</button>",'<button type="button" data="done" class="toa-button toa-button-done toa-button-active">',d.glossary({id:11806}),"</button>","</div>","</div>"],getMode:function(){return this._mode},setMode:function(b){$.inArray(b,
this.options.buttonMode)&&this._mode!=b&&(this._mode=b,this.notify("selectMode",b))},setDate:function(b){c.prototype.setDate.apply(this,arguments);this._isSmallScreen||this.close()},getDate:function(){return this._selectedDate||this.getToday()},updateDate:function(b){this._previousMode=this._mode;c.prototype.updateDate.apply(this,arguments);this._isNonScheduled(b)?this.setMode("nonscheduled"):this.setMode("day");this._previousMode=this._mode;this._updateStatusModeButton();this._updateButtonChangeMonth();
this.dateLine&&(this.dateLine.empty(),this.dateLine.append(this.formatDate(b)),this.dateLine.attr({"data-calendar-min-date":b,"data-calendar-max-date":"","data-calendar-mode":this.getMode()}),"function"===typeof this.dateLine.changeDateFormat&&this.dateLine.changeDateFormat())},open:function(){this._isSmallScreen=this.getScreenSize();this.dateLine&&this.dateLine.addClass("toa-button-opened");this._updateStatusModeButton();this._updateButtonChangeMonth();c.prototype.open.apply(this,arguments)},close:function(){this._calendar.hide();
this._revertMode();this.dateLine&&this.dateLine.removeClass("toa-button-opened");c.prototype.close.apply(this,arguments)},destroy:function(){c.prototype.destroy.apply(this,arguments);this.calendarLine&&this.calendarLine.remove()},_render:function(){var b=this,g=b.getDate(),k=null;c.prototype._render.apply(b,arguments);b.calendarLine=$((new d.Template(b.lineTpl)).apply({date:b.formatDate(g),minDate:g||b.getToday(),mode:b.getMode()}));g=b.calendarLine.find("button[data-calendar-min-date]");"function"===
typeof g.changeDateFormat&&g.changeDateFormat();b._calendar.on("click",".mode-panel .toa-button",b._clickButtonMode.bind(b));b._calendar.find(".mode-panel .mode-select").on("change input",function(c){c=$(this).val();b.setMode(c);"nonscheduled"==b._mode&&b.setDate(d.date.DAY_WITHOUT_DATE);b._updateStatusModeButton()});b.dateLine=b.calendarLine.find(".date");b.calendarLine.on("click",".toa-button-panel .toa-button",function(c){clearTimeout(k);k=setTimeout(function(){switch(c.currentTarget.getAttribute("data")){case "prev":b._prevDate();
break;case "date":b._clickDateLine();break;case "next":b._nextDate()}},300)});b._calendar.on("click",".bottompanel .toa-button",function(c){switch(c.currentTarget.getAttribute("data")){case "reset":b._clickReset();break;case "done":b._clickDone()}});b.options.notOutsideElements=[b.calendarLine];b.buttonPrevDate=b.calendarLine.find(".prev");b.buttonNextDate=b.calendarLine.find(".next");b.buttonPrevMonth=b._calendar.find(".prevmonth");b.buttonNextMonth=b._calendar.find(".nextmonth");b.bottomPanel=b._calendar.find(".bottompanel");
b.butonDone=b.bottomPanel.find(".toa-button-done");return b.calendarLine},renderTo:function(b){c.prototype.renderTo.apply(this,arguments);this._checkLimit()},_updateStatusModeButton:function(){var b;if(this._calendar){var c=this._calendar;b=c.find(".mode-panel .toa-button-selected");b.removeClass("toa-button-selected");b=c.find(".mode-panel button[data="+this._mode+"]");b.addClass("toa-button-selected");this._calendar.find(".mode-panel .mode-select").val(this._mode);this._calendar.removeClass("disabled");
"nonscheduled"==this._mode&&this._calendar.addClass("disabled")}},_updateButtonChangeMonth:function(){this.buttonPrevMonth.removeClass("toa-button-disable");this.buttonNextMonth.removeClass("toa-button-disable");this.buttonPrevDate.removeClass("button-disable");this.buttonNextDate.removeClass("button-disable");"nonscheduled"==this._mode&&(this.buttonPrevMonth.addClass("toa-button-disable"),this.buttonNextMonth.addClass("toa-button-disable"),this.buttonPrevDate.addClass("button-disable"),this.buttonNextDate.addClass("button-disable"))},
_getTemplateParam:function(){var b=this.options;return $.extend({},c.prototype._getTemplateParam.apply(this,arguments),{buttonMode:b.buttonMode||!1})},_revertMode:function(){"day"==this._mode&&this._mode!=this._previousMode&&this.setMode(this._previousMode);this._updateStatusModeButton();this._updateButtonChangeMonth()},_prevDate:function(){var b=this.options,c=this._parseIsoDate(this.getDate());this.close();c.setDate(c.getDate()-1);c=d.date.daylightSavingAdjust(c);b.minDate&&b.minDate>this._formatIsoDate(c)||
(this.setDate(this._formatIsoDate(c)),this._checkLimit())},_nextDate:function(){var b=this.options,c=this._parseIsoDate(this.getDate());this.close();c.setDate(c.getDate()+1);c=d.date.daylightSavingAdjust(c);b.maxDate&&b.maxDate<this._formatIsoDate(c)||(this.setDate(this._formatIsoDate(c)),this._checkLimit())},_clickDateLine:function(){this._isOpen?this.close():(this.open(),this._calendar.find("td:not(.empty-col):first a, td.today a, td.selected a").focus())},_clickDate:function(b){"nonscheduled"!=
this._mode&&c.prototype._clickDate.apply(this,arguments)},_clickButtonMode:function(b){b=b.currentTarget.getAttribute("data");this.setMode(b);"nonscheduled"==this._mode&&this.setDate(d.date.DAY_WITHOUT_DATE);this._updateStatusModeButton()},_checkLimit:function(){var b=this.options,c=this._parseIsoDate(this.getDate());this.buttonPrevDate.removeClass("toa-button-disable");this.buttonNextDate.removeClass("toa-button-disable");b.maxDate&&b.maxDate<=this._formatIsoDate(c)&&this.buttonNextDate.addClass("toa-button-disable");
b.minDate&&b.minDate>=this._formatIsoDate(c)&&this.buttonPrevDate.addClass("toa-button-disable")},_defineAnchorInfo:function(){return{width:this.calendarLine.outerWidth(),height:this.calendarLine.outerHeight(),top:this.calendarLine.offset().top,left:this.calendarLine.offset().left}},setOptions:function(){return $.extend({},c.prototype.setOptions.apply(this,arguments),{showFormatDate:"date_long"})},getScreenSize:function(){return 375>=$(window).width()&&"object"===typeof _DATA&&_DATA.is_mobility_app},
_clickDone:function(){this.close();this.updateDate(this.getDate());this.notify("changeDate",this.getDate())},_clickReset:function(){this._cacheCell[this._selectedDate].removeClass("selected");this._selectedDate=null}};d.ns("toa.view.calendar.Calendar",d.define(c,function(){this._create.apply(this,arguments)},b))})(toa);(function(d){var c=d.view.calendar.Calendar;d.ns("toa.view.calendar.CalendarExtended",d.define(c,function(){this._create.apply(this,arguments)},{_mode:"day",_previousMode:"day",selectedDates:[],buttonPanel:null,customButtons:{},buttonElm:[],getDate:function(){},setDate:function(){},updateDate:function(){},setMode:function(b){c.prototype.setMode.apply(this,arguments);this.getDates()&&this.getDates()[0]&&this._updateDateRange(this.getDates()[0]);this._updateButtonChangeMonth()},close:function(b){c.prototype.close.apply(this,
arguments);this._getMinDate()!=d.date.DAY_WITHOUT_DATE&&(this._showMonth=this._getMinDate()||this.getToday(),this._updateMonth());this.dateLine.focus()},setDates:function(b){this.updateDates(b);this._isSmallScreen||this.notify("changeDates",this.getDates(),this.getMode())},getDates:function(){return this.selectedDates},updateDates:function(b){var e=[];d.isString(b)?e[0]=b:e=b;this._clickReset();this._selectionDates(e);this._previousMode=this._mode;this._showMonth=this._getMinDate();this._updateMonth()},
setNonScheduled:function(){"nonscheduled"==this._mode&&(this._clickReset(),this.setDates([d.date.DAY_WITHOUT_DATE]),c.prototype.setNonScheduled.apply(this,arguments))},updateMode:function(b){switch(b.length){default:this.setMode("day");break;case 2:this.setMode("twoDays");break;case 3:this.setMode("threeDays");break;case 7:this.setMode("week");break;case 28:case 29:case 30:case 31:this.setMode("month")}},formatDate:function(){var b=d.app.model("companySettings").settings.user.dateFormats.date_long,
e=this.getMode(),g=this._parseIsoDate(this._getMinDate()),k=this._parseIsoDate(this._getMaxDate());return"custom"==e?this._formatIsoDate(g)!=this._formatIsoDate(k)?d.date.formatDate(b,g)+" ... "+d.date.formatDate(b,k):d.date.formatDate(b,g):"nonscheduled"==e?c.prototype.formatDate.call(this,d.date.DAY_WITHOUT_DATE):this._formatIsoDate(g)!=this._formatIsoDate(k)?d.date.formatDate(b,g)+" - "+d.date.formatDate(b,k):c.prototype.formatDate.call(this,this._formatIsoDate(g))},setOptions:function(){return $.extend({},
c.prototype.setOptions.apply(this,arguments),{buttonMode:{day:h(11801),twoDays:h(15326),threeDays:h(15327),week:h(11802),month:h(11804),nonscheduled:h(8203),custom:h(11805)}})},renderTo:function(){c.prototype.renderTo.apply(this,arguments);this._selectedDates&&this.updateDates(this._selectedDates)},_create:function(b,e){e.defaultDates&&(this._selectedDates=e.defaultDates);c.prototype._create.apply(this,arguments)},_render:function(){return c.prototype._render.apply(this,arguments)},_clickMoveMonth:function(b){this._calendar.hasClass("disabled")||
c.prototype._clickMoveMonth.apply(this,arguments)},_setRangeDate:function(b,e){var c=[];if(b==e)this.setDates([b]);else{for(;b<=e;)c.push(b),b=this._shiftDate(b,1);this.setDates(c)}},_unsetDate:function(b){var e=$.inArray(b,this.selectedDates);this._cacheCell[b]&&0<=e&&(this.selectedDates.splice(e,1),this.updateCellSelectedStatus(this._cacheCell[b],!1))},_clickDate:function(b){this._updateDateRange(b);"custom"===this._mode||this._isSmallScreen||this.close()},_updateDateRange:function(b){var e=this.options,
c;if(b<e.minDate||b>e.maxDate)return!1;switch(this._mode){case "day":this.setDates([b]);break;case "twoDays":c=this._shiftDate(b,1);c>=e.maxDate&&(c=e.maxDate);this._setRangeDate(b,c);break;case "threeDays":c=this._shiftDate(b,2);c>=e.maxDate&&(c=e.maxDate);this._setRangeDate(b,c);break;case "week":c=this._shiftDate(b,6);c>=e.maxDate&&(c=e.maxDate);this._setRangeDate(b,c);break;case "month":c=this._shiftDate(b,-1,1);c>=e.maxDate&&(c=e.maxDate);this._setRangeDate(b,c);break;case "custom":this._selectionDates([b]);
break;case "nonscheduled":break;default:this.options.customButtons&&this.options.customButtons[this._mode]&&this.options.customButtons[this._mode].apply(this,["selectDate",b])}},_prevDate:function(){var b=this.options,e,c;c=this._getMinDate();if(c<=b.minDate)return!1;switch(this._mode){case "day":c=this._shiftDate(c,-1);this.setDates([c]);this.close();return;case "twoDays":e=this._shiftDate(c,-2);c=this._shiftDate(c,-1);this.close();break;case "threeDays":e=this._shiftDate(c,-3);c=this._shiftDate(c,
-1);this.close();break;case "week":e=this._shiftDate(c,-7);c=this._shiftDate(c,-1);this.close();break;case "month":c=this._getMinDate();e=this._shiftDate(c,0,-1);c=this._shiftDate(c,-1);this.close();break;default:this.options.customButtons&&this.options.customButtons[this._mode]&&this.options.customButtons[this._mode].apply(this,["prevDate"]);this.close();return}e<=b.minDate&&(e=b.minDate);this._setRangeDate(e,c);this.close()},_nextDate:function(){var b=this.options,c,d;d=this._getMaxDate();if(d>=
b.maxDate)return!1;switch(this._mode){case "day":d=this._shiftDate(d,1);this.setDates([d]);this.close();return;case "twoDays":c=this._shiftDate(d,1);d=this._shiftDate(d,2);break;case "threeDays":c=this._shiftDate(d,1);d=this._shiftDate(d,3);break;case "week":c=this._shiftDate(d,1);d=this._shiftDate(d,7);break;case "month":d=this._getMinDate();c=this._shiftDate(d,0,1);d=this._shiftDate(c,-1,1);break;default:this.options.customButtons&&this.options.customButtons[this._mode]&&this.options.customButtons[this._mode].apply(this,
["nextDate"]);this.close();return}d>=b.maxDate&&(d=b.maxDate);this._setRangeDate(c,d);this.close()},_getMinDate:function(){var b=null,c,d;d=this.getDates();for(c in d)if(null===b||d[c]<b)b=d[c];b<this.options.minDate&&(b=this.options.minDate);null==b&&(b=this.getToday());return b},_getMaxDate:function(){var b=null,c,d;d=this.getDates();for(c in d)if(null===b||d[c]>b)b=d[c];null==b&&(b=this.getToday());return b},_selectionDates:function(b,c){var d,k;for(d in b)k=$.inArray(b[d],this.selectedDates),
this._getCell(b[d])&&(-1==k?(this.updateCellSelectedStatus(this._cacheCell[b[d]],!0),this.selectedDates.push(b[d])):c||this._unsetDate(b[d]));this.dateLine&&(this.dateLine.empty(),this.dateLine.append(this.formatDate()),this.dateLine.attr({"data-calendar-min-date":this._getMinDate(),"data-calendar-max-date":this._getMaxDate(),"data-calendar-mode":this.getMode()}),"function"===typeof this.dateLine.changeDateFormat&&this.dateLine.changeDateFormat());this._previousMode=this._mode;0==this.selectedDates.length?
this.disableDoneButton():this.enableDoneButton()},_updateButtonChangeMonth:function(){this._calendar&&(c.prototype._updateButtonChangeMonth.apply(this,arguments),"custom"==this._mode?(this.bottomPanel.removeClass("bottompanel-hide"),this.buttonPrevDate.addClass("button-disable"),this.buttonNextDate.addClass("button-disable")):this._isSmallScreen?this.bottomPanel.removeClass("bottompanel-hide"):this.bottomPanel.addClass("bottompanel-hide"))},_clickButtonMode:function(b){c.prototype._clickButtonMode.apply(this,
arguments);this._updateButtonChangeMonth()},_clickDone:function(){this.close();this.notify("changeDates",this.getDates(),this.getMode())},_clickReset:function(){for(var b in this.selectedDates)this.updateCellSelectedStatus(this._cacheCell[this.selectedDates[b]],!1);this._selectedDate=null;this.selectedDates=[];this.disableDoneButton()},_clickWeek:function(b){var c=[];b=b.data;var d,k,l;if("custom"==this.getMode()){d=(new Date(b[1],b[2]+1,0)).getDate();for(k=1;k<=d;k++)l=new Date(b[1],b[2],k),l.getDay()==
b[0]&&c.push(this._formatIsoDate(l));this._selectionDates(c,!0)}},disableDoneButton:function(){this.butonDone.removeClass("toa-button-active");this.butonDone.addClass("button-disable");this.butonDone.prop("disabled",!0)},enableDoneButton:function(){this.butonDone.addClass("toa-button-active");this.butonDone.removeClass("button-disable");this.butonDone.prop("disabled",!1)}}))})(toa);var initFilterRatioValue=1;
function initFilter(d,c,b){var e;if(!d)return!1;d&&d.apply&&(d.apply.disabled=!0);$(d).data("filter_params",c);$(d).data("filter_js_post_check",b);$(d).data("filter_values",{});$(d).data("filter_slave_selected_values",{});for(e in c){"undefined"!=typeof c[e].master_key&&onchange_slave(e,d);switch(c[e].gui){case "date":case "dateCompare":b=$('[id^="'+e+'_input_for_datepicker_"]');var g=$(d).find('[name="'+e+'_parsed"]'),k=new toa.view.calendar.Datepicker(b);try{var l=toa.date.parseDate("date",b.val());
k.setDate(toa.date.formatDate("iso",l));g.val(k.getDate())}catch(n){g.val(b.val())}(function(b,c,e){$(d).on("remove",function(){b.destroy()});c.on("change",function(){if(""===c.val())e.val("");else try{var d=toa.date.parseDate("date",c.val()),g=toa.date.formatDate("iso",d);b.setDate(g);e.val(g)}catch(k){e.val(c.val())}});b.addListener("changeDate",function(b,c){e.val(c)})})(k,b,g);break;case "slider":b=['<br/><span class="toa-panel-filter-zoom-fit-label"><%- label %></span>','<span role="link" class="toa-panel-filter-zoom-fit"><%- text %></span>',
"<div>",'<div class="toa-panel-filter-zoom-out" aria-label="',r(22663),'" role="button">-</div>','<div class="toa-panel-filter-zoom-slider"></div>','<div class="toa-panel-filter-zoom-in" aria-label="',r(22664),'" role="button">+</div>',"</div>"];this.zoomCompile=$((new toa.Template(b)).apply({text:toa.glossary({id:14602,type:"raw"}),label:toa.glossary({id:10167,type:"raw"})}));$(d).find(".toa-panel-filter-zoom").empty().append(this.zoomCompile);var p=new toa.view.Slider({min:2,max:60,step:1,defaultValue:10*
c[e].ratio||2,rangeType:"simple",countRange:5});p.render($(d).find(".toa-panel-filter-zoom-slider"));p.changeValue(10*initFilterRatioValue);$(".toa-panel-filter-zoom-out").on("click",function(){p.setValue(p.getValue()-1)});$(".toa-panel-filter-zoom-in").on("click",function(){p.setValue(p.getValue()+1)});$(".toa-panel-filter-zoom-fit").on("click",function(){toa.app.trigger("global.filter.zoomfit",{position:c.position});return!1}.bind(this));p.addListener("change",function(){toa.app.trigger("interface.durationRatio.set",
{ratio:p.getValue()/10,position:c.position})}.bind(this));toa.app.unbind("interface.durationRatio.changed",null,window);toa.app.bind("interface.durationRatio.changed",function(b,e){e.position===c.position&&(initFilterRatioValue=e.ratio,p.changeValue(10*e.ratio))},this)}if("include_non_working"===e){var s=$(d).find("[name=include_non_working]"),t=$(d).find("[name=include_on_call]");s.length&&t.length&&(s.on("change",function(){s.prop("checked")?(t.attr("disabled","disabled"),t.attr("checked","checked")):
(t.removeAttr("disabled"),t.removeAttr("checked"))}),s.prop("checked")&&(t.attr("disabled","disabled"),t.attr("checked","checked")))}}d&&d.apply&&(d.apply.disabled=!1)}
function onchange_master_key(d,c){var b,e,g,k,l,n=$(c),p,s=c.getAttribute("data-uniq-id"),s=s?"_"+s:"",t=$(c).data("filter_params"),u=$(c).data("filter_slave_selected_values");for(p in t)if("undefined"!=typeof t[p].master_key){b=!1;for(k=0;k<t[p].master_key.length;k+=1)t[p].master_key[k]==d&&(b=!0);if(b&&(b=n.find("#"+p+s).get(0))){g=t[p]["enum"];for(k=0;k<t[p].master_key.length;k+=1)e=n.find("#"+t[p].master_key[k]+s).get(0),e=e.value,g=g[e];if(0==g.length)b.disabled=!0;else{k=b.options.length=0;
b.disabled=!1;for(l in g)b.options.length=k+1,b.options[k].value=l,u&&u[p]==l&&(b.options[k].selected=!0),b.options[k++].text=g[l];onchange_slave(p,c)}}}}function onchange_slave(d,c){var b=$(c),e=c.getAttribute("data-uniq-id");(e=fromEl.find("#"+d+(e?"_"+e:"")).get(0))&&"undefined"!=typeof b.data("filter_params")[d].master_key&&($(c).data("filter_slave_selected_values")[d]=e.value,toa.mixins.EventEmitter.notify.call(_DATA.filtersEventStorage,"content_changed"))}
function onchange_dynamic(d,c){var b=$(c),e=b.data("filter_params"),g,k,l,n,p=b.find('[id^="'+d+'"]').not("label").get(0),s=c.getAttribute("data-uniq-id"),s=s?"_"+s:"";for(l in e)"undefined"!=typeof e[l].dynamic&&"undefined"!=typeof e[l].dynamic.element&&"undefined"!=typeof e[l].dynamic.value&&e[l].dynamic.element==d&&(g=b.find('[id^="'+l+'"]').not("label").get(0),k=b.find('label[id^="'+l+"_label"+s+'"]').get(0),n=b.find("#"+l+"_br").get(0),p.value==e[l].dynamic.value?(g.style.display="",k.style.display=
"",n&&(n.style.display="")):(g.style.display="none",k.style.display="none",n&&(n.style.display="none")));p.focus();toa.mixins.EventEmitter.notify.call(_DATA.filtersEventStorage,"content_changed");return!0}
function checkFilter(d){var c,b,e=$(d),g=e.data("filter_params"),k="",l=0,n,p=d.getAttribute("data-uniq-id"),p=p?"_"+p:"";try{for(c in g)if((n=e.find('[id^="'+c+'"]').not("label").get(0))&&"undefined"!=typeof n.value){b=n.value;if("undefined"!=typeof g[c].dynamic&&"undefined"!=typeof g[c].dynamic.element&&"undefined"!=typeof g[c].dynamic.value&&(n=e.find('[id^="'+g[c].dynamic.element+'"]').not("label").get(0),n.value!=g[c].dynamic.value))continue;TypeValidator.isStringEmpty(b)?(g[c]&&g[c].empty&&
(k+=" - "+g[c].empty+"<br />",l++),!g[c]||"date"!=g[c].gui&&"dateCompare"!=g[c].gui||(d[c+"_parsed"].value="")):g[c]&&g[c].validator&&"undefined"!=typeof TypeValidator[g[c].validator]&&!TypeValidator[g[c].validator](b,g[c])&&g[c].wrong&&(k+=" - "+g[c].wrong+"<br />",l++)}var s="",t="";Object.keys(g).forEach(function(b){switch(b){case "DateFrom":case "FromDate":case "start_date":s=d[b].value;break;case "DateTo":case "ToDate":case "end_date":t=d[b].value}});if(s&&t){var u=toa.date.format.date,v=toa.app.model("companySettings");
try{var w=toa.date.parseDate(u,s),x=toa.date.parseDate(u,t),y=new Date;y.setDate(y.getDate()-v.getCutLimit());y.setHours(0,0,0,0);w&&x&&w>x?k+=" - "+h(8643)+"</div>":w<y&&(k+=" - "+r(20170,{"{CUT_LIMIT}":v.getCutLimit()})+"</div>")}catch(z){k+=" - "+h(20843)+"</div>"}}if(k){var A=$('.toa-button-opened[name="filterButton"]');1===A.length&&($(".filter-container").hide(),A.removeClass("toa-button-opened"));toa.ui.Alert({text:(1==l?h(231):h(232))+"<br><br><div class='dashboards_alert' tabindex='0'>"+
k});$(".dashboards_alert").focus()}else{c=!0;var B=$(d).data("filter_js_post_check");B&&($.isFunction(B)?c=B.apply(this,[d]):$.isFunction(window[B])&&(c=window[B].apply(this,[d])),B=null);for(var D in d.elements)d.elements[D].id&&(d.elements[D].id=d.elements[D].id.replace(p,"")),d.elements[D].name&&(d.elements[D].name=d.elements[D].name.replace(p,""));c&&toa.app.trigger("global.filter.changed",{form:d,values:filterPanelFormToValues(d)})}}catch(C){window.onerror("error in func checkFilter:"+C.message,
C.fileName,C.lineNumber)}return!1}function filterPanelFormToValues(d){for(var c={},b=d.getAttribute("data-uniq-id"),b=b?"_"+b:"",e,g=0;g<d.elements.length;g++){var k=d.elements[g].type;e=d.elements[g].name&&d.elements[g].name.replace(b,"");if(k&&("radio"==k||"checkbox"==k)&&!d.elements[g].checked)c[e]=0;else if(""!==d.elements[g].value||""!==d.elements[g].getAttribute("value"))c[e]="slider"==d.elements[g].name?10*initFilterRatioValue:d.elements[g].value}return c};toa.view.Slider=function(d){this.options=d;this.options.stepWidth=2*(this.options.stepWidth||20);this.options.thumbWidth=19;this.options.step=this.options.step||1;this.options.countRange=this.options.countRange||Math.ceil((this.options.max-this.options.min)/this.options.step);"increasing"==this.options.rangeType&&(this.options.countRange=4,this.options.step=this.options.max/4);"divisible"==this.options.rangeType&&(this.options.every=2);this.isNativeSupport=this._isNativeSupport();this.slider=$((new toa.Template('<div class="toa-slider">,<ul class="toa-slider-range">,<%var j = 2;%>,<%for(var i = 0; i <= count; i++) {,var className="";,if (type == "increasing") { className += "increasing" },if (i == 0) { className += " first"; },if (i == count) { className += " last"; },if (type == "divisible" && (i % every == 0 )) { className += " long"; },%>,<li <% if (type == "increasing") { %>style="height: <%=j%>px" <% } %> class="<%=className%>"></li>,<%j = j + 4;%>,<%}%>,</ul>,<% if (nativeSupport) { %>,<input type="range" name="slider" value="<%=value%>" min="<%=min%>" max="<%=max%>" step="<%=step%>" />,<% } else {%>,<div class="thumb">&nbsp;</div>,<input type="hidden" name="slider" value="<%=value%>" />,<% } %>,</div>'.split(","))).apply({nativeSupport:this.isNativeSupport,
count:this.options.countRange,every:Math.ceil(this.options.every/this.options.step)||null,min:this.options.min,max:this.options.max,step:this.options.step,value:this.options.defaultValue,type:this.options.rangeType}));this.list=this.slider.find("li");if(this.isNativeSupport){this.thumb=this.slider.find("input");var c=this;this.thumb.on("change",function(){c.setValue(this.value)})}else this.thumb=this.slider.find(".thumb"),this.thumb.on("mousedown touchstart",this._onMouseDownThumb.bind(this)),this.thumb.on("mouseup touchend",
this._onMouseUpThumb.bind(this)),this.thumb.on("mouseout",this._onMouseOutThumb.bind(this)),$("body").on("mouseup touchend",this._onMouseUpThumb.bind(this))};
toa.view.Slider.prototype=$.extend({},toa.mixins.EventEmitter,{value:null,toString:function(){return"Slider object"},getValue:function(){return this.value},setValue:function(d){this.changeValue(d);this.notify("change",d);return!0},changeValue:function(d){var c;d=parseInt(d);if(!(d>=this.options.min&&d<=this.options.max))return!1;if(this.isNativeSupport)this.thumb.val(d);else{var b=this.slider.find("input");c=this.widthSlider/this.options.max*d;this.thumb.css("left",c-this.widthThumb/2);b.val(d)}this.value=
d;return!0},render:function(d){d=$(d);this.widthThumb=this.options.thumbWidth;this.widthSlider=this.options.countRange*this.options.stepWidth+this.options.countRange;d.append(this.slider);this.setValue(this.options.defaultValue)},destroy:function(){console.log(1)},_onMouseDownThumb:function(d){this.start=Math.round(this.thumb.offset().left+this.widthThumb/2);$("body").on("mousemove touchmove",this._onMousemove.bind(this))},_onMouseUpThumb:function(d){$("body").off("mousemove touchmove")},_onMouseOutThumb:function(d){setTimeout(function(){$("body").off("mousemove touchmove")}.bind(this),
100)},_onMousemove:function(d){var c=this.widthSlider/this.options.max;d=Math.round((d.clientX-this.slider.offset().left)/c);0==d%this.options.step&&this.setValue(d)},_isNativeSupport:function(){var d=document.createElement("input");try{if(d.type="range","range"==d.type)return!0}catch(c){}return!1}});(function(d,c){d.view.control.define({className:"Button",extend:"Control",mixins:[{getDefaults:function(){var b=this.callParent();c.extend(b,{tag:"button",attr:{type:"button"},"class":"toa-button",label:"",pressed:!1});return b},applyOptionDisabled:function(b,c){this.callParent(b,c);this.getElement()[0].disabled=c},applyOptionLabel:function(b,c){this.getElement().html(c)},applyOptionPressed:function(b,c){this.toggleClass(c,"toa-button-opened")},applyOptionIconText:function(b,c){this.getChild("icon").element.text(c)},
bindHandlers:function(){var b=this;b.callParent();b.getElement().on("click",function(c,d){b.notify("click",{name:c&&c.currentTarget&&"function"===typeof c.currentTarget.getAttribute&&c.currentTarget.getAttribute("name")||"",event:c,ui:d,targetItem:b.getOptions()||{}})})}}]})})(toa,jQuery);(function(d,c){d.view.control.define({className:"Input",extend:"Control",mixins:[{getDefaults:function(){var b=this.callParent();c.extend(b,{tag:"input",id:generate_id(),attr:{type:"text"},value:""});return b},bindHandlers:function(){this.callParent();var b=d.browser.msie?"txtinput":"input";this.getElement().on(b,this.onChange.bind(this))},applyOptionPlaceholder:function(b,c){this.getElement().attr("placeholder",c||"")},applyOptionValue:function(b,c){this.getElement().val(c)},applyOptionDisabled:function(b,
c){this.callParent(b,c);this.getElement()[0].disabled=c},getOptionValue:function(){return this.isRendered()?this.getElement().val():this.options.value},onChange:function(b){this.notify("input",{value:this.getOption("value")})}}]})})(toa,jQuery);(function(d,c){d.view.control.define({className:"Checkbox",extend:"Control",mixins:[{getDefaults:function(){var b=this.callParent();c.extend(b,{tag:"input",id:generate_id(),attr:{type:"checkbox"}});return b},bindHandlers:function(){this.callParent();this.getElement().on("change",this.onChange.bind(this))},applyOptionValue:function(b,c){var g=this.getElement()[0];g.checked=c;d.browser.msie&&(c?g.setAttribute("defaultChecked","defaultChecked"):g.removeAttribute("defaultChecked"))},applyOptionDisabled:function(b,
c){this.callParent(b,c);this.getElement()[0].disabled=c},getOptionValue:function(){this.isRendered()&&(this.options.value=this.getElement()[0].checked?1:0);return this.options.value},onChange:function(b){this.notify("change",{value:this.getOption("value")})}}]})})(toa,jQuery);(function(d,c){d.view.control.define({className:"Form",extend:"Control",mixins:[{getDefaults:function(){var b=this.callParent();c.extend(b,{tag:"form",layout:"Table",value:{},checkboxPosition:"right",maxCell:1});return b},renderChild:function(b,c){var g=this.getChildContaner(b,c),k=d.view.control.getNs("toa.view.control.Checkbox");k&&b instanceof k?"right"===(b.getOption("checkboxPosition")||this.getOption("checkboxPosition"))?(this.appendLabel(b,g),b.renderTo(g)):(b.renderTo(g),this.appendLabel(b,
g,"toa-form-label-checkbox")):(this.appendLabel(b,g),b.renderTo(g));this.layout.postRender(b,c)},appendLabel:function(b,c,g){var k=b.getOption("formLabel");k&&(b.fromLabel=d.view.control.domNode({tag:"label",text:k,addClass:"toa-form-label "+(g||""),attr:{"for":b.getOption("id")}}),c.append(b.fromLabel))},getValues:function(){for(var b={},c=0;c<this.children.length;c++){var d=this.children[c];b[d.getName()]=d.getOption("value")}return b},setValues:function(b){for(var c in b){var d=this.getChild(c);
d&&d.setOption("value",b[c])}},resetValues:function(){for(var b=0;b<this.children.length;b++){var c=this.children[b];c.setOption("value",c.getDefaults().value)}},validateValues:function(){for(var b={},c=!1,d=0;d<this.children.length;d++){var k=this.children[d],l=this.validateChild(k);l&&(c=!0,b[k.getName()]=l)}return c?b:null},validateChild:function(b){var e=b.getOption("validations",[]);c.isArray(e)||(e=[e]);for(var g=b.getOption("value"),k=[],l=0;l<e.length;l++){var n=e[l];c.isFunction(n)?k.push(n.apply(b,
[g,b])):d.isString(n)&&k.push(d.view.control.validators[n].apply(b,[g,b]))}return k.length?b.getOption("invalidMessage",k.join(", ")):!1},applyOptionValue:function(b,c){this.setValues(c)},getOptionValue:function(){return this.getValues()}}]})})(toa,jQuery);(function(d,c){d.view.control.define({className:"Select",extend:"Control",mixins:[{getDefaults:function(){var b=this.callParent();c.extend(b,{tag:"select",id:generate_id(),withEmpty:!1,optionItems:[]});return b},bindHandlers:function(){this.callParent();this.getElement().on("change",this.onChange.bind(this))},applyOptionValue:function(b,c){this.getElement().val(c)},getOptionValue:function(){return this.isRendered()?this.getElement().val():this.options.value},applyOptionOptionItems:function(b,e){c.isArray(e)&&
(this.getOption("withEmpty")&&e.splice(0,0,{selected:!0}),d.browser.msie?this.getElement().html(this.formatItems(e)):this.getElement()[0].innerHTML=this.formatItems(e),this.getElement().val(this.options.value))},applyOptionDisabled:function(b,c){this.callParent(b,c);this.getElement()[0].disabled=c},formatItems:function(b){for(var c=[],d=0;d<b.length;d++)c.push(this.formatItem(b[d]));return c.join("")},formatItem:function(b){if(!b)return"";b.items&&(t=this.formatItems(b.items));var c=b.items?"optgroup":
"option",g=b.addClass?' class="'+b.addClass+'"':"",k=b.selected?' selected="selected"':"",l=b.disabled?' disabled="disabled"':"",n=b.hidden?' hidden="true"':"",p=b.label?' label="'+b.label.replace(/"/g,"&quot;")+'"':"",s=d.isDefined(b.value)?' value="'+b.value+'"':"",t=t||b.label||"";return["<",c,g,l,n,k,s,p,">",t,"</",c,">"].join("")},onChange:function(b){this.notify("change",{value:this.getOption("value")})}}]})})(toa,jQuery);(function(d,c){d.view.control.define({className:"View",extend:"Control",mixins:[{getDefaults:function(){var b=this.callParent();c.extend(b,{tag:"div",layout:"Base",view:null});return b},initSelf:function(b){this.addListener("rendered",this.afterRender)},afterRender:function(b){b=this.options;var c=this.getElement();b.view&&"function"===typeof b.view.render&&b.view.render(c);b.label&&c.prepend('<label class="toa-form-label ">'+b.label+"</label>")}}]})})(toa,jQuery);(function(d,c){d.view.control.define({className:"Icon",extend:"Control",mixins:[{getDefaults:function(){var b=this.callParent();c.extend(b,{tag:"div",image:"toa-icon-default",html:"&nbsp;"});return b},applyOptionImage:function(b,c){this.currentImage&&this.removeClass(this.currentImage);this.currentImage=c;this.addClass(c)}}]})})(toa,jQuery);(function(d,c){d.view.control.define({className:"button.Icon",extend:"Button",mixins:[{getDefaults:function(){var b=this.callParent();delete b.label;c.extend(b,{icon:!1,items:[{xtype:"Icon",addClass:"toa-button-image",name:"icon"}]});return b},applyOptionIcon:function(b,c){this.getChild("icon").setOption("image",c)}}]})})(toa,jQuery);(function(d,c){d.view.control.define({className:"button.Extended",extend:"Button",mixins:[{getDefaults:function(){var b=this.callParent();c.extend(b,{icon:!1,label:"",popup:!1,items:[{tag:"span",name:"label"},{xtype:"Icon",name:"icon",addClass:"toa-button-image",hidden:!0},{xtype:"Icon",name:"popup",addClass:"toa-button-image",image:"icon-arrow-down",hidden:!0}]});return b},applyOptionIcon:function(b,c){var d=this.getChild("icon");d.setOption("hidden",!c);c&&d.setOption("image",c)},applyOptionPopup:function(b,
c){this.getChild("popup").setOption("hidden",!c)},applyOptionLabel:function(b,c){this.getChild("label").getElement().html(c)}}]})})(toa,jQuery);(function(d,c){d.view.control.define({className:"button.Popup",extend:"button.Extended",mixins:[{getDefaults:function(){var b=this.callParent();c.extend(b,{popup:!0,popupOptions:{appear:"bottom",align:"left",constraitPosition:!1},popupContent:{addClass:"toa-dropdown-content"},className:""});return b},initSelf:function(){this.callParent();this.getOption("popupContent");this.popupContent=d.view.control.create(this.getOption("popupContent"));this.containerClassName="toa-dropdown "+this.getOption("className")},
renderSelf:function(b){var c=this;b=c.callParent(b);c.popupContent.render(_DATA.dispatcher_container);c.popupContent.getElement().Tip({callout:!1,className:c.containerClassName,minHeight:null,minWidth:null,notOutsideElements:[c.getElement(),".toa-calendar"],onHide:function(){c._isOpen=!1;c.setOption("pressed",!1)},onShow:function(){c._isOpen=!0;c.setOption("pressed",!0)}});return b},addSelfListeners:function(){this.addListener("click",this.toggle.bind(this))},toggle:function(b,c){this.isOpen()?this.close():
this.open();b.stopPropagation()},open:function(){var b=this.options.popupOptions;this._isOpen||(this._isOpen=!0,this.setOption("pressed",!0),this.popupContent.getElement().Tip("show",this.getElement(),b.appear,b.align,b.constraitPosition),this.popupContent.getElement().focus())},close:function(){this._isOpen&&(this._isOpen=!1,this.setOption("pressed",!1),this.popupContent.getElement().Tip("hide"))},isOpen:function(){return this._isOpen},destroy:function(){this.popupContent.destroy();this.callParent()}}]})})(toa,
jQuery);(function(d,c){d.view.control.define({className:"button.Menu",extend:"button.Popup",mixins:[{getDefaults:function(){var b=this.callParent();c.extend(b,{menuItems:[],popupContent:{addClass:"toa-dropdown-content",attr:{tabindex:"-1"},defaultChild:{addClass:"toa-dropdown-item",attr:{role:"link"}}}});return b},applyOptionMenuItems:function(b,e){var d;this.popupContent&&("string"===typeof e[e.length-1]&&(d=e[e.length-1],c(this.popupContent.element).parent().addClass(d),e.pop()),this.popupContent.clearChildren(),
this.popupContent.addChildren(e),this.popupContent.getContainer().empty(),this.popupContent.renderChildren())},bindHandlers:function(){var b=this;b.callParent();b.popupContent.getElement().on("click",".toa-dropdown-item",b.onClickItem.bind(b));b.popupContent.getElement().on("keypress",".toa-dropdown-item",function(e){if(13===e.keyCode)b.onClickItem(e,c(this))})},onClickItem:function(b,c){this.close();var d=b.currentTarget.getAttribute("name");this.notify("menuItemClick",{name:d,event:b,ui:c,targetItem:(this.getOption("menuItems")||
[]).find(function(b){return b&&String(b.name)===String(d)})})}}]})})(toa,jQuery);(function(d,c){d.view.control.define({className:"button.ResourceStatusFilter",extend:"button.Menu",mixins:[{RESOURCE_TREE_MODE_WITHOUT_DATE:"without_date",RESOURCE_TREE_MODE_WITHOUT_ROUTES:"without_routes",RESOURCE_TREE_MODE_FULL:"full",getDefaults:function(){var b=this.callParent();c.extend(b,{closeTimeout:1E3,icon:"toa-icon-resource-tree-filter-half",popup:!1});return b},applyOptionFilter:function(b,c){var d=c.getOptions(),k=[],l;for(l in d)if(d.hasOwnProperty(l)){var n=d[l];k.push({name:l,"class":"toa-layout-hbox",
role:"listitem",active:n.active,items:[{xtype:"Icon",addClass:"toa-icon-resource-tree-filter",image:n.active?"toa-icon-resource-tree-filter-selected":"",attr:{role:"checkbox"}},{xtype:"Icon",addClass:"toa-icon-resource-tree-filter",image:"toa-icon-resource-tree-filter-"+l},{addClass:"text-resource-tree-filter",text:r(n.translation)}]})}this.setOption("menuItems",k)},render:function(b){this.callParent(b);this._updateIcon()},onClickItem:function(b,c){var d=b.currentTarget.getAttribute("name");this.notify("filterChanged",
{name:d,event:b,ui:c})},checkOption:function(b){b=this.popupContent.getChild(b);var e=b.getChild(0);e.setOption("image","toa-icon-resource-tree-filter-selected");c(e.element).attr("aria-checked","true");b.setOption("active",!0);this._updateIcon()},uncheckOption:function(b){b=this.popupContent.getChild(b);var e=b.getChild(0);e.setOption("image","");c(e.element).attr("aria-checked","false");b.setOption("active",!1);this._updateIcon()},_updateIcon:function(b){b=b||this.popupContent.getChildrenCount();
var c=0;this.popupContent.eachChild(function(b){b.getOption("active")&&c++});c?c===b?this.setOption("icon","toa-icon-resource-tree-filter-full"):this.setOption("icon","toa-icon-resource-tree-filter-half"):this.setOption("icon","toa-icon-resource-tree-filter-empty")},bindHandlers:function(){var b=this;b.callParent();b.popupContent.getElement().on("mouseout",function(e){b.timeout&&clearTimeout(b.timeout);c(e.relatedTarget).closest(b.popupContent.getElement()).length||(b.timeout=setTimeout(b.close.bind(b),
b.getOption("closeTimeout")))})},open:function(){this.timeout&&clearTimeout(this.timeout);this.callParent()},setMode:function(b){switch(b){case this.RESOURCE_TREE_MODE_WITHOUT_ROUTES:case this.RESOURCE_TREE_MODE_WITHOUT_DATE:this.hideOption("nonworking");this.hideOption("started");this.hideOption("stopped");this.hideOption("notstarted");break;case this.RESOURCE_TREE_MODE_FULL:this.showOption("nonworking"),this.showOption("started"),this.showOption("stopped"),this.showOption("notstarted")}},hideOption:function(b){this.popupContent.getElement().find("[name="+
b+"]").addClass("hidden")},showOption:function(b){this.popupContent.getElement().find("[name="+b+"]").removeClass("hidden")}}]})})(toa,jQuery);(function(d,c){d.view.control.define({className:"button.ResourceFilterPopup",extend:"button.ResourceStatusFilter",mixins:[{FILTER_APPLY_BUTTON:"filterApply",getDefaults:function(){var b=this.callParent();c.extend(b,{filterClassName:"resource-tree-filter-tip-container_"});return b},applyOptionFilter:function(b,c){this.callParent(b,c);var d=this.getOption("menuItems");this.setOption("menuItems",[]);var k={name:this.FILTER_APPLY_BUTTON,class:"toa-resource-filter-apply",items:[{xtype:"Button",Label:h(99),
addClass:"toa-submit",name:"applyButton"}]};d.push(k);this.setOption("menuItems",d)},renderSelf:function(b){this.getScreenName()&&"undefined"!=typeof this.getOption("filterClassName")&&(this.containerClassName+=this.getOption("filterClassName")+this.parent.options.screenName);this.callParent(b)},onClickItem:function(b,c){var d=b.currentTarget.getAttribute("name");this.applyButtonEnabled?d==this.FILTER_APPLY_BUTTON?(this.applyFilter(),this.hangTree&&this.hangTree.popUpClose()):(d=this.popupContent.getChild(d),
d.setOption("filterSelected",!0),this.toggleStatusIcon(d)):this.callParent(b,c)},_updateIcon:function(){var b=this,c=0;b.popupContent.eachChild(function(d){d.getOption("name")!=b.FILTER_APPLY_BUTTON&&c++});b.callParent(c)},toggleStatusIcon:function(b){b=b.getChild(0);""==b.getOption("image")?(c(b.element).attr("aria-checked","true"),b.setOption("image","toa-icon-resource-tree-filter-selected")):(c(b.element).attr("aria-checked","false"),b.setOption("image",""))},initFilterMenuItems:function(){var b=
this;b.popupContent.eachChild(function(e){if(e.getOption("name")!=b.FILTER_APPLY_BUTTON){var d=e.getChild(0);e.setOption("filterSelected",!1);e.getOption("active")?(c(d.element).attr("aria-checked","true"),d.setOption("image","toa-icon-resource-tree-filter-selected")):(c(d.element).attr("aria-checked","false"),d.setOption("image",""))}})},getScreenName:function(){var b="";null!=this.parent&&"undefined"!=this.parent.options&&"undefined"!=this.parent.options.screenName&&(b=this.parent.options.screenName);
return b},open:function(){var b,e=this.getScreenName(),g=c(".resource-tree-filter-tip-container_"+e),k=c(".toa-resource-filter-apply");this.initFilterMenuItems();_DATA.is_mobility_app&&(this.hangTree=d.widgets.HangTree.getHangTree(),b=this.hangTree.getTreeState(e));b&&"hang"===b?(this.containerClassName="",this.applyButtonEnabled=!0,k.show(),b=this.popupContent.getElement(),b.addClass("toa-resource-popUp"),d.app.trigger("hang.tree.resourcePopUp",{content:b,title:h(3412),container:g,screenName:e})):
(this.applyButtonEnabled=!1,k.hide(),this.callParent())},applyFilter:function(){var b=this;b.popupContent.eachChild(function(c){var d=c.getOption("name");!0==c.getOption("filterSelected")&&b.notify("filterChanged",{name:d})})}}]})})(toa,jQuery);(function(d,c){d.view.control.define({className:"button.Filter",extend:"button.Popup",mixins:[{getDefaults:function(){var b=this.callParent();b.popupOptions.constraitPosition=!1;c.extend(b,{icon:!1,popup:!0,label:"View",popupContent:{addClass:"jet-css-only toa-panel-filter-popup",attr:{tabindex:"-1"}}});return b},setState:function(b){switch(b){case "closed":this.setOption("pressed",!1);break;case "open":this.setOption("pressed",!0);break;case "filtered":this.setOption("icon","icon-filter-used");break;
case "filterEmpty":this.setOption("icon",!1)}},removeState:function(b){switch(b){case "filtered":this.setOption("icon",!1)}},open:function(){this.callParent();try{d.dom.isTouch||this.popupContent.getElement().find("input[type!=hidden],select").first().focus()}catch(b){}},applyOptionContent:function(b,c){this.popupContent.getElement().html(c)},getForm:function(){if(this.isRendered())return this.popupContent.getElement().find("form").get(0)},getPopup:function(){return this.popupContent},setPopupDesc:function(b){var c=
this,d=this.popupContent;b=[{xtype:"Form",name:"filterForm",addClass:"toa-filter-form",checkboxPosition:"left",items:b},{xtype:"Button",Label:h(99),addClass:"toa-submit",name:"applyButton",listeners:{click:function(){c.notify("filterApply",{values:c.popupContent.getChild("filterForm").getValues()})}}}];d.clearChildren();d.addChildren(b);d.renderChildren();d.element.on("keydown",function(b){switch(b.keyCode){case 13:c.notify("filterApply",{values:c.popupContent.getChild("filterForm").getValues()})}})}}]})})(toa,
jQuery);(function(d){var c=d.define(null,function(){this._create.apply(this,arguments)},{_create:function(b){this.parent=b},getContainer:function(b,c){if(!this.parent)throw Error("layout.Base: call to destroyed layout");return this.parent.getContainer()},postRender:function(){},erase:function(){},destroy:function(){this.erase();this.parent=null}});d.ns("toa.view.control.layout.Base",c)})(toa);(function(d){var c=d.view.control.layout.Base,b=d.define(c,function(){this._create.apply(this,arguments)},{toString:function(){return"toa.view.control.layout.Table"},getContainer:function(b,d){c.prototype.getContainer.call(this,b,d);this.getCell(b.getOptions());if(this.maxCell=this.parent.getOption("maxCell",0)){this.cellCount=this.cellCount||0;var k=Math.round(100/this.maxCell);this.cell.attr("width",k+"%");this.cellCount++;this.cellCount>=this.maxCell&&(this.cellCount=0,this.row=null)}return this.cell},
postRender:function(){},erase:function(){},destroy:function(){this.erase();this.parent=null},getTable:function(b){if(this.table)return this.table;b=$.extend(!0,{tag:"table","class":"toa-view-control-layout-table toa-layout-reset"},this.parent.getOption("table",0)||b.table);this.table=d.view.control.domNode(b);this.parent.getContainer().append(this.table);return this.table},getRow:function(b){this.table||this.getTable(b);b=$.extend(!0,{tag:"tr","class":"toa-view-control-layout-table-row toa-layout-reset"},
b.row);this.row=d.view.control.domNode(b);this.table.append(this.row);return this.row},getCell:function(b){this.row||this.getRow(b);b=$.extend(!0,{tag:"td",width:b.layoutCellWidth,"class":"toa-view-control-layout-table-cell toa-layout-reset"},b.cell);this.cell=d.view.control.domNode(b);this.row.append(this.cell);return this.cell}});d.ns("toa.view.control.layout.Table",b)})(toa);(function(d,c){d.view.control.define({className:"SearchBox",extend:"Control",mixins:[{getDefaults:function(){var b=this.callParent();c.extend(b,{tag:"div",disabled:!1,layout:"Table",timeout:500,minLength:1,items:[{xtype:"Icon",name:"searchIcon",image:"toa-icon-magnifier",attr:{"aria-label":h(269)},cell:{width:20}},{xtype:"Input",name:"searchInput",attr:{maxlength:40,"aria-label":h(269)+" "+h(22606)},cell:{css:{paddingLeft:5,paddingRight:5}},listeners:{input:this.onChange.bind(this)}},{xtype:"Icon",
name:"searchClear",image:"toa-icon-search-clear",hidden:!0,cell:{width:25,height:25},attr:{role:"button","aria-label":h(7717)}}]});return b},bindHandlers:function(){this.callParent();this.getElement().on("click",".toa-icon-search-clear",this.onClearClick.bind(this))},onChange:function(b){this.searchTimerId&&(clearTimeout(this.searchTimerId),this.searchTimerId=0);this.updateIcon();this.searchTimerId=setTimeout(this.onSearchLaunch.bind(this,b),this.getOption("timeout"))},onSearchLaunch:function(b){var c=
this.getOption("value");0<c.length&&c.length<this.getOption("minLength")||(0===c.length&&this.notify("searchCleared",{key:c,event:b}),this.notify("search",{key:c,event:b}))},getOptionValue:function(){return this.getChild("searchInput").getOption("value")},applyOptionValue:function(b,c){this.getChild("searchInput").setOption("value",c);this.updateIcon()},applyOptionPlaceholder:function(b,c){this.getChild("searchInput").setOption("placeholder",c||"")},applyOptionError:function(b,c){this.toggleClass(c,
"toa-view-control-searchbox-error")},updateIcon:function(){if(this.getChild("searchIcon")){var b=this.getOption("value");this.getChild("searchClear").setOption("hidden",!b)}},onClearClick:function(){this.setOption("value","");this.onSearchLaunch()}}]})})(toa,jQuery);(function(d,c){d.view.control.define({className:"calendar.Single",extend:"Control",mixins:[{initSelf:function(){this.callParent();this.calendar=new d.view.calendar.Calendar(null,{buttonMode:this.getOption("modes")})},setDate:function(b,c){d.isString(b)||(b=d.date.formatDate("iso",b));return c?this.calendar.updateDate(b):this.calendar.setDate(b)},applyOptionSelected:function(b,c){d.isArray(c)&&(c=c[0]);d.isString(c)||(c=d.date.formatDate("iso",c));this.calendar&&this.calendar.updateDate(c)},getOptionSelected:function(){return this.calendar?
this.calendar.getDate():this.options.selected},applyOptionToday:function(b,c){this.calendar&&this.calendar.setToday(c)},applyOptionMinDate:function(b,c){this.calendar&&this.calendar.setMinDate(c)},applyOptionMaxDate:function(b,c){this.calendar&&this.calendar.setMaxDate(c)},renderSelf:function(b){this.callParent(b);this.calendar.renderTo(this.getChildContaner())},destroy:function(){this.calendar&&this.calendar.destroy();this.callParent()},bindHandlers:function(){var b=this;b.callParent();b.calendar.addListener("changeDate",
function(c,d){b.notify(c,{date:d,event:this,ui:d,source:b})})}}]})})(toa,jQuery);(function(d,c){d.view.control.define({className:"calendar.Extended",extend:"Control",mixins:[{getDefaults:function(){var b=this.callParent();b.modes={};b.defaultMode="day";return b},initSelf:function(){this.callParent();this.calendar=new d.view.calendar.CalendarExtended(null,{buttonMode:this.getOption("modes"),customButtons:this.getOption("customButtons")})},getMode:function(){return this.calendar.getMode()},getLabel:function(){return this.calendar.formatDate(this.calendar.getDate())},setDate:function(b,
c){d.isString(b)||(b=d.date.formatDate("iso",b));return c?this.calendar.updateDate(b):this.calendar.setDate(b)},setMaxDate:function(b){this.calendar.updateDate(b)},applyOptionSelected:function(b,c){this.calendar.updateDates(c)},applyOptionToday:function(b,c){this.calendar.setToday(c)},applyOptionMinDate:function(b,c){this.calendar.setMinDate(c)},applyOptionMaxDate:function(b,c){this.calendar.setMaxDate(c)},applyOptionSetMode:function(b,c){this.calendar.setMode(c)},renderSelf:function(b){this.callParent(b);
this.calendar.renderTo(this.getChildContaner());this.calendar.setMode(this.getOption("defaultMode"))},bindHandlers:function(){var b=this;b.callParent();b.calendar.addListener("changeDates",function(c,d,k){d={date:d,mode:k,event:this,ui:d,source:b,label:b.getLabel()};b.notify(c,d)})}}]})})(toa,jQuery);(function(d,c){d.view.control.define({className:"calendar.Datepicker",extend:"calendar.Single",mixins:[{getDefaults:function(){var b=this.callParent();c.extend(b,{tag:"input","class":"toa-datepicker-input"});return b},initSelf:function(){},renderSelf:function(b){this.element=d.view.control.domNode(this.getOptions());this.element.appendTo(b);this.calendar=new d.view.calendar.Datepicker(this.element)},getOptionValue:function(){return this.getOption("selected")},setOptionValue:function(b){this.setOption("selected",
b)},applyOptionSelected:function(b,c){d.isString(c)||(c=d.date.formatDate("iso",c));var g=d.date.parseDate("iso",c),g=d.date.formatDate("date",g);this.element.val(g);this.calendar&&this.calendar.updateDate(c)},applyOptionHidden:function(b,c){var d=this.element.closest(".toa-calendar-form");c?d.addClass("toa-hidden"):d.removeClass("toa-hidden")},bindHandlers:function(){var b=this;b.callParent();b.calendar.addListener("change",function(c,g){var k=b.getElement().val();if(""!==k)try{var l=d.date.parseDate("date",
k),n=d.date.formatDate("iso",l);b.calendar.setDate(n)}catch(p){}})}}]})})(toa,jQuery);(function(d,c){var b=c.ui.sortable.prototype._intersectsWithPointer;c.ui.sortable.prototype._intersectsWithPointer=function(c){return this._intersectsWith(c.instance.containerCache)?b.call(this,c):!1};d.view.control.define({className:"SortableList",extend:"Control",mixins:[{getNativeToSynteticEvents:function(){var b=this.callParent();b.push("click","dblclick");return b},initSelf:function(){var b=this;b.selectedPosition=null;b.addListener("click",function(d,k){var l,n;l=c(k.event.target).closest("li.toa-sortablelist-item");
l.length&&(n=l.attr("data-toa-sortablelist-original-position"),void 0!==n&&(l=b.getOption("rows")[n])&&b.notify("rowClick",{row:l,position:n,originalEvent:k.event}))});b.addListener("dblclick",function(d,k){var l,n;l=c(k.event.target).closest("li.toa-sortablelist-item");l.length&&(n=l.attr("data-toa-sortablelist-original-position"),void 0!==n&&(l=b.getOption("rows")[n])&&b.notify("rowDoubleClick",{row:l,position:n,originalEvent:k.event}))});this.addListener("appendItem",function(b,e){var l=c(".toa-grid-icon-sortable",
e.item);l.length&&d.touch.setTouchDraggable(l)})},getDefaults:function(){var b=this.callParent();c.extend(b,{tag:"ul","class":"toa-sortablelist",disabled:!1,restrict:!1,connectWith:!1});return b},_reorderArray:function(b,c,d){d*=1;c*=1;if(c!==d){if(0>c||c>b.length-1)throw Error("invalid originalPosition");if(0>d||d>b.length-1)throw Error("invalid position");var l=c>d?c+1:c;d=c>d?d-1:d;b.splice(d+1,0,b[c]);c=[b[d],b[d+2]];b.splice(l,1);return c}},_getDefaultSortableOptions:function(){return{placeholder:"toa-sortablelist-placeholder",
appendTo:_DATA.dispatcher_container,scroll:!0,dragmove:!0,tolerance:"pointer",axis:!1}},_bindSortableEvents:function(){var b=this,g=c(this.getElement());g.on("sortout",function(b,e){var d=this.getElement();c(d.sortable("option","containment")).is(d)&&d.sortable("option","containment","parent")}.bind(this));g.on("sortbeforestop",function(b,c){d.view.control.SortableList.dndHelper=c.helper.clone();d.view.control.SortableList.dndHelperData=c.helper.data()});g.on("sortstart",this.onSortStart.bind(this));
g.on("sortchange",function(c,d){var g=d.placeholder,p=d.item,s=b._isOwn(p),t=g.prev(),u=g.next(),v=1*t.attr("data-toa-sortablelist-original-position"),w=1*u.attr("data-toa-sortablelist-original-position"),x=b.getOption("rows"),y=0<=v?x[v]:void 0,x=0<=w?x[w]:void 0,z=d.helper,g=g.parent(),A=""+g.data("ctrlId");""+b.getUid()!==A?g.data("sortable")&&g.trigger("sortchange",d):(t={item:p,row:!1,position:!1,helper:z,prevRow:y,prevPosition:isNaN(v)?!1:v,prevItem:t,nextRow:x,nextPosition:isNaN(w)?!1:w,nextItem:u,
ui:d},s&&(t.position=1*p.attr("data-toa-sortablelist-original-position"),t.row=b.getOption("rows")[t.position]),b.notify("drag",t))});g.on("sortstop",function(d,g){var n=c(this),p=c(b.getElement()),s=g.item,t=n.children().index(s),u=!1,v=b.getOption("rows"),w=!1,u=b._isOwn(s),w=b._isInside({left:d.originalEvent.pageX,top:d.originalEvent.pageY});p.children(".toa-sortablelist-drag-origin").removeClass("toa-sortablelist-drag-origin");g.helper&&g.helper.remove();s.parent().is(n)?!s.attr("data-toa-sortablelist-received")&&
u&&(w?!0===b.getOption("receiveDisabled")?(b.clearSelection(),b._renderRows()):(u=1*s.attr("data-toa-sortablelist-original-position"),u!==t&&(w=v[u],v=b.getOption("rows"),n=b._cloneArray(v),v=b._reorderArray(v,u,t),!1===b.notify("reorder",{row:w,item:s,position:t,prevRow:v[0],nextRow:v[1],originalPosition:u,ui:g})&&b.setOption("rows",n),b.clearSelection(),b._renderRows())):(b.clearSelection(),b._renderRows())):u&&(u=1*s.attr("data-toa-sortablelist-original-position"),w=v[u],b.notify("transmit",{row:w,
position:u,item:s,ui:g}),b.clearSelection(),b._renderRows())});g.on("sortreceive",function(g,l){var n=c(this),p=b._isInside({left:g.originalEvent.pageX,top:g.originalEvent.pageY}),s=n.children(),n=s.not('[data-toa-sortablelist-owner-uid="'+b.getUid()+'"]'),s=s.index(n),t=0<s?s-1:!1,u=b.getOption("rows"),v=s<u.length?s:!1;l.helper||(l.helper=d.view.control.SortableList.dndHelper?d.view.control.SortableList.dndHelper:c("<div>"),Object.keys(d.view.control.SortableList.dndHelperData||{}).forEach(function(b){l.helper.data(b,
d.view.control.SortableList.dndHelperData[b])}));p&&(b.notify("receive",{position:s,prevPosition:t,nextPosition:v,prevRow:!1!==t?u[t]:void 0,nextRow:!1!==v?u[v]:void 0,item:n,ui:l}),b.clearSelection());n.attr("data-toa-sortablelist-received","1");n.remove()})},onSortStart:function(b,c){this._isOwn(c.item)&&(c.item.addClass("toa-sortablelist-drag-origin"),c.item.show())},_isInside:function(b){var d=c(this.getElement());b=c(document.elementFromPoint(b.left,b.top));return b.length&&(b.is(d)||b.closest(d).length)?
!0:!1},_createSortable:function(){var b=this,g=this.getElement(),k,l,n,p;g.data("sortable")||(k=b.getOption("movingDisabled"),l=b.getOption("connectWith"),n=b.getOption("sortableOptions")||{},p=b._getDefaultSortableOptions(),n=c.extend({},p,n),n.containment="parent",b.getOption("restrict")&&(n.axis="y"),l&&(n.connectWith=l),n.disabled=k,c(g).sortable(n),b._bindSortableEvents(),c(g).sortable("option","helper",function(d,g){var k=g.attr("data-toa-sortablelist-original-position"),k=b.getOption("rows")[k],
k=(k=b.notify("formatHelper",{row:k,originalElement:g}))?c(k):g.clone();k.addClass("toa-sortablelist-helper");return k}),d.touch.setTouchDraggable(".toa-sortablelist-helper"))},_cloneArray:function(b){for(var c=b.length,d=[],l=0;l<c;l++)d.push(b[l]);return d},_renderRows:function(){var b=this.getOption("rows"),d=c(this.getElement()),k,l,n,p;d.empty();if(b)for(p=0;p<b.length;p++)k=b[p],(l=this.notify("formatRow",{row:k,index:p}))||(l=k.toString()),n=c('<li aria-dropeffect="move" role="link">').addClass("toa-sortablelist-item").attr("data-toa-sortablelist-owner-uid",
this.getUid()).attr("tabindex","0").attr("data-toa-sortablelist-original-position",p),n.html(l),this.notify("renderItem",{row:k,index:p,item:n}),n.appendTo(d),this.notify("appendItem",{row:k,index:p,item:n});d.data("sortable")&&setTimeout(function(){d.sortable("refreshPositions")},1)},_isOwn:function(b){return""+this.getUid()===""+b.attr("data-toa-sortablelist-owner-uid")?!0:!1},renderSelf:function(b){b=this.callParent(b);var d=this.getElement();this._createSortable(d);this._renderRows();!0===this.getOption("receiveDisabled")&&
d&&c(d).addClass("toa-sortablelist-receive-disabled");return b},select:function(b){var d=this.getOption("rows");b*=1;var d=d[b],k=c(this.getElement()),l;d&&(l=c(k.children("li.toa-sortablelist-item")[b]),l.length&&(l.addClass("toa-sortablelist-selected"),this.selectedPosition=b,this.notify("rowSelect",{row:d,position:b}),setTimeout(function(){k.children("li.toa-sortablelist-selected").not(l).removeClass("toa-sortablelist-selected")},1)))},clearSelection:function(){var b=c(this.getElement());this.selectedPosition=
null;setTimeout(function(){b.children("li.toa-sortablelist-selected").removeClass("toa-sortablelist-selected")},1)}}],statics:{dndHelper:null,dndHelperData:null}})})(toa,jQuery);(function(d,c){var b="toa-activities-split-icon",e=null;d.view.control.define({className:"ActivitiesSortableList",extend:"SortableList",mixins:[{initSelf:function(){this.callParent();this._createTemplates();this.addListener("formatRow",this.formatRow.bind(this));this.addListener("renderItem",function(b,c){var e=c.row,d=c.item;d.attr("par_date",e.date);d.attr("par_pid",e.pid);d.attr("aid",e.aid);d.attr("data-activity-status",e.astatus);d.attr("data-activity-worktype",e.aworktype);d.attr("movable",
"1");d.removeAttr("role")});this.addListener("formatHelper",this.onFormatHelper.bind(this));this.addListener("drag",this.onDrag.bind(this));!0!==this.getOption("receiveDisabled")&&(this.addListener("receive",this._activityReceiveReorder),this.addListener("reorder",this._activityReceiveReorder))},formatRow:function(b,c){var e=c.row;return this.templates.icon.apply(e,this)+this.templates.item.apply(e,this)},onFormatHelper:function(b,e){var l=c(this.templates.helper.apply(e.row,this)),n=e.originalElement,
p=c(n.children()[0]),s=c(n.children()[1]),n=n.width(),t=s.width(),s=s.outerWidth()-t,p=p.outerWidth(),t=d.view.control.ActivitiesSortableList.CLASS_CAPTION;l.find("."+t).width(n-p-s);l=(new d.DnDHint(l,l,h(5579))).getHint();l.find(".DnDHint-label").prependTo(l.find("."+t));l.css({overflow:"visible","box-shadow":"none"});l.find("span:last-child").css({"margin-left":p,display:"inline-block"});return l},onDrag:function(b,c){var e=c.prevRow,n=c.nextRow,p=c.row,s=c.helper,t=s.data("hint"),u=this.getOption("resource"),
e=e?this._rowToActivity(e):!1,n=n?this._rowToActivity(n):!1,p=p?this._rowToActivity(p):d.helper.activity.getActivityFromElement(s);this._activityMoveOver({prevAct:e,nextAct:n,movingAct:p,dndHint:t,resource:u,ui:c.ui})},_activityReceiveReorder:function(b,c){var l=this,n=c.prevRow,p=c.nextRow,s=c.item,t,u,v,w=this.getOption("resource");u=n?l._rowToActivity(n):!1;v=p?l._rowToActivity(p):!1;t=d.helper.activity.getActivityFromElement(s);e=c.ui.helper&&c.ui.helper.data&&c.ui.helper.data("selfController");
setTimeout(function(){l._activityMoveEnd({prevAct:u,nextAct:v,movingAct:t,resource:w,date:l.getOption("date"),ui:c.ui})},1);return!1},_activityMoveEnd:function(b){e&&!b.ui.helper.data("selfController")&&b.ui.helper.data("selfController",e);var c="undefined"!=typeof b.ui.helper&&null!=b.ui.helper&&"undefined"!=typeof b.ui.helper.data("selfController")?b.ui.helper.data("selfController"):{currentItem:1},l=b.movingAct.checkMove(b.ui.helper,b.resource,b.date,"ordered",b.nextAct);if(!l)return!1;var n="undefined"!=
typeof c&&1!=c.currentItem&&1<c.selectedCount&&null==c.currentItem;if(n&&!l.groupResult||!l.result&&!n)return d.app.trigger("global.hint.hide"),d.ui.Alert({text:hs(l.message)}),!1;if(n)for(var p in c.selected)if("multiday_activity_segment"==c.selected[p]._v.T)return!1;b.movingAct=d.helper.activity.prepareAidsToMove(b.movingAct.entity.z,b.movingAct.entity.p,b.movingAct.entity.D,b.ui.helper);this.notify("move",b)},_activityMoveOver:function(b){var c,e="undefined"!=typeof b.ui&&"undefined"!=typeof b.ui.helper&&
null!=b.ui.helper&&"undefined"!=typeof b.ui.helper.data("selfController")?b.ui.helper.data("selfController"):{currentItem:1},d="undefined"!=typeof e&&1!=e.currentItem&&1<e.selectedCount&&null==e.currentItem;if(b.nextAct||b.prevAct)if(c=b.movingAct.checkMove(b.ui.helper,b.resource,this.getOption("date"),"ordered",b.nextAct||b.prevAct)){if(d&&c.groupResult){c=!1;for(var p in e.selected)if("multiday_activity_segment"==e.selected[p]._v.T){c=!0;break}c=c?{result:!1,message:h(15083)}:{result:!0,message:h(5579)}}b.dndHint.setAccept(c.result,
c.message,this.getElement())}},_rowToActivity:function(b){var c=new d.Activity({aid:b.aid});c.set("date",b.date).set("pid",b.pid||0).set("worktype",b.aworktype||0).set("eta",b.ETA||0).set("status",b.astatus||"pending");return c},_getDefaultSortableOptions:function(){var b=this.callParent();b.handle=".toa-activities-sortablelist-handle";b.cursorAt={top:-15};return b},_createTemplates:function(){var c=d.view.control.ActivitiesSortableList.CLASS_CAPTION;this.templates={};this.templates.attrs=new d.Template('par_date="<%-obj.date%>" ;par_pid="<%-obj.pid%>" ;aid="<%-obj.aid%>" ;data-activity-status="<%-obj.astatus%>" ;data-activity-worktype="<%-obj.aworktype%>" ;movable="1" '.split(";"));
this.templates.helperContent=new d.Template(['<%-hints ? hints.ident : ""%>']);this.templates.helper=new d.Template(["<div <%=this.templates.attrs.apply(obj, this)%> >",'<div class="',c,'">',"<%=this.templates.helperContent.apply(obj, this)%>",'<div class="toa-grid-icon toa-grid-icon-sortable ',"toa-activities-sortablelist-handle",'">',"</div>","</div>","</div>"]);d.currentInterface===INTERFACE.MOBILITY&&(b="");this.templates.item=new d.Template(['<div class="',c," ",b,' <%if (typeof unresolved !== "undefined" && unresolved) { %>',
"toa-activities-not-resolved",'<% } %>">','<%-hints ? hints.ident : ""%>',"</div>",'<%if(1*obj.draggable && !this.getOption("movingDisabled")) { %>','<div class="toa-grid-icon toa-grid-icon-sortable ',"toa-activities-sortablelist-handle",'"></div>',"<% } %>"]);c=d.browser.msie&&8>=d.browser.version?'<img class="toa-activities-sortablelist-icon-margin" src="'+this.getOption("resourceFolder")+'/map/?bgcolor=<%-color%>&text=<%-label%>" />':'<%if(typeof shape !== "undefined" && grade !== "undefined") {%><i class="activity-shape activity-shape-margin activity-shape-<%-shape%>-<%-grade%>"></i><%} else {%><i <%=this.templates.attrs.apply(obj, this)%> class="toa-activities-sortablelist-icon toa-activities-sortablelist-icon-margin<%-resolve_status === 3 ? " toa-activities-sortablelist-icon-invalid" : ""%>" style="background-color:#<%-color%>"><span <%=this.templates.attrs.apply(obj, this)%> class="toa-activities-sortablelist-icon-text"><%-label%></span></i><%}%>';
this.templates.icon=new d.Template(["<%var isResolving=((1*resolve_status)===1 && false);%>",'<div <%=this.templates.attrs.apply(obj, this)%> class="',"toa-activities-sortablelist-icon-cell"," ",b,'">',"<%if(isResolving) {%>",'<i <%=this.templates.attrs.apply(obj, this)%> class="',"toa-activities-sortablelist-icon"," ","icon-wait",'">',"</i>","<%} else {%>",c,"<%}%>","</div>"])},setActivities:function(b){this.setOption("rows",b)}}],statics:{CLASS_CAPTION:"toa-activities-sortablelist-caption"}})})(toa,
jQuery);(function(d,c){d.view.control.define({className:"SelectActivitiesSortableList",extend:"ActivitiesSortableList",mixins:[{initSelf:function(){this.callParent();this.addListener("change",this.onChange.bind(this));this.addListener("appendItem",this.onAppendItem.bind(this))},onChange:function(b,e){var d=c(e.event.target).closest("li.toa-sortablelist-item");if(d.length){var k=this.getOption("rows");if(d=d.attr("data-toa-sortablelist-original-position"))if(d=k[d])d.selected=e.event.target.checked,k=c.map(k,
function(b){return!0===b.selected?b:null}),this.notify("select",{selected:k,originalEvent:e.event})}},onAppendItem:function(b,c){c&&c.item&&c.row&&(c.row.element=c.item)},onSortStart:function(b,e){d.app.trigger("global.hint.hide");if(this._isOwn(e.item)){var g=this.isItemChecked(e.item,!0),k=this.getSelectedRows();if(1>=k.length||!g)this.callParent(b,e);else for(e.item.show(),g=0;g<k.length;g++)k[g].element&&this.callParent(b,c.extend({},e,{item:k[g].element}))}},onFormatHelper:function(b,e){var g=
d.view.control.ActivitiesSortableList.CLASS_CAPTION,k=e.originalElement,l=c(k.children()[0]),n=c(k.children()[1]),p=c(n.children()[0]).outerWidth(!0),s=c(n.children()[2]).outerWidth(),l=l.outerWidth()+p+s,p=this.isItemChecked(k)?this.getSelectedRows():[],s=p.length,t=1<s?c.extend({selectedCount:r(13209,{"{SELECTED_COUNT}":s})},e.row):e.row,t=c(this.templates.helper.apply(t,this)),k=k.width()-l-(n.outerWidth()-n.width());t.find("."+g).width(k);k=(new d.DnDHint(t,t,h(5579))).getHint();k.find(".DnDHint-label").prependTo(k.find("."+
g));k.css({overflow:"visible","box-shadow":"none"});k.find("span:last-child").css({"margin-left":l,display:"inline-block"});1<s&&k.data("selfController",this.getMoveController(p));return k},onDrag:function(b,c){var d=c.helper&&c.helper.data("hint");d&&d.setDefault&&d.setDefault()},getMoveController:function(b){b=b||[];var e={};c.each(b,function(b,c){e[b]={aid:c.aid,_v:{z:c.aid,D:c.date||d.date.DAY_WITHOUT_DATE}}});return{currentItem:null,selected:e,selectedCount:b.length,onDraggStart:function(b,c){},
onDraggEnd:function(b){},getSelectedRows:function(){return{aid:e,exclude_aid:!1,pid:-1,date:"",filters:[],singleItem:!1,selectedCount:b.length}},getOption:function(){return{}}}},getNativeToSynteticEvents:function(){return this.callParent().concat("change")},_createTemplates:function(){this.callParent();this.templates.checkbox=new d.Template(['<div class="toa-map-checkbox-column">','<input type="checkbox" class="toa-grid-checkbox toa-assign-hint-ignore" aria-label="<%=h(8074)%>" <%-selected === true ? "checked" : ""%> />',
"</div>"]);this.templates.helperContent=new d.Template('<div class="toa-sortablelist-helper-marker">;<%if (typeof selectedCount !== "undefined") {%>;<div class="toa-sortablelist-helper-text"><%=selectedCount%></div>;<%} else if (typeof shape !== "undefined" && typeof grade !== "undefined") {%>;<i class="activity-shape activity-shape-margin activity-shape-<%-shape%>-<%-grade%>"></i>;<%}%>;</div>'.split(";"))},formatRow:function(b,c){var d=c.row,k=this.templates.checkbox.apply(d,this),l=this.templates.icon.apply(d,
this),d=this.templates.item.apply(d,this);return'<div class="checkbox-column">'+k+'</div><div class="info-column">'+l+d+"</div>"},setSelected:function(b){var e=this.getOption("rows");c.each(e,function(c,e){e.selected=b});c(".toa-grid-checkbox",this.getElement()).prop("checked",b);this.notify("select",{selected:b?e:[]})},getSelectedRows:function(){return c.map(this.getOption("rows"),function(b){return!0===b.selected?b:null})},isItemChecked:function(b,e){if(!b)return!1;var d=c("input[type=checkbox].toa-grid-checkbox",
b),k=d.prop("checked");e&&!k&&(c("input[type=checkbox].toa-grid-checkbox",b.parent()).prop("checked",!1),d.prop("checked",!0));return k}}]})})(toa,jQuery);(function(d,c){d.view.control.define({className:"ResourceTreeCaption",extend:"Control",mixins:[{getDefaults:function(){var b=this.callParent();c.extend(b,{layout:"Table",withCloseButton:!1,widthFilter:!0,placeholder:r(8046),"aria-label":r(8046),items:[{table:{width:"100%"},layoutCellWidth:1,xtype:"button.Icon",name:"close",icon:"toa-icon-resource-tree-close",addClass:"toa-layout-right-separator",attr:{"aria-label":h(22363)},css:{padding:4},listeners:{click:function(){this.notify("close")}}},{xtype:d.currentInterface===
INTERFACE.MOBILITY?"button.ResourceFilterPopup":"button.ResourceStatusFilter",name:"filterButton",layoutCellWidth:1,addClass:"toa-layout-right-separator",attr:{"aria-haspopup":"true","aria-label":h(22365),"aria-describedby":h(8074)}},{xtype:"SearchBox",name:"searchbox",listeners:{input:this.onChange.bind(this)}}]});d.currentInterface===INTERFACE.MOBILITY&&(b.items.shift(),b.items.push({layoutCellWidth:1,xtype:"button.Icon",name:"close",addClass:"toa-icon-resource-tree-hang toa-hang-tree-icon",attr:{"aria-label":h(22363)},
listeners:{click:function(b,c){d.app.trigger("hang.tree.pin",this.element)}}}));return b},applyOptionWithCloseButton:function(b,c){this.getChild("close").setOption("hidden",!c)},applyOptionScreenName:function(b,c){c&&this.getChild("close").getElement().attr("data-screen",c)},applyOptionFilter:function(b,c){this.getChild("filterButton").setOption("filter",c)},applyOptionWidthFilter:function(b,c){this.getChild("filterButton").setOption("hidden",!c)},applyOptionPlaceholder:function(b,c){this.getChild("searchbox").setOption("placeholder",
c)},applyOptionSearchText:function(b,c){this.getChild("searchbox").setOption("value",c)},onChange:function(b,c){this.options.searchText=c.value},getFilter:function(){return this.getChild("filterButton")}}]})})(toa,jQuery);(function(d,c){d.view.control.define({className:"CapacityAreaTreeCaption",extend:"ResourceTreeCaption",mixins:[{addAreaButtonName:"addCapacityArea",getDefaults:function(){var b=this.callParent();c.extend(b,{hiddenAddAreaButton:!1});b.items=this.insertAddAreaButton(b.items);return b},insertAddAreaButton:function(b){for(var c=b.length,d=0;d<b.length;d++){var k=b[d];k.name&&"searchbox"===k.name&&(c=d+1)}b.splice(c,0,this.getAddAreaButton());return b},getAddAreaButton:function(){return{xtype:"Button",
name:this.addAreaButtonName,attr:{"aria-label":h(23443)},addClass:"toa-button ui-button toa-view-control-button-icon toa-layout-left-separator add-area-button",listeners:{click:function(){this.notify("addArea")}.bind(this)}}},applyOptionHiddenAddAreaButton:function(b,c){this.getChild(this.addAreaButtonName).setOption("hidden",c)}}]})})(toa,jQuery);(function(d,c){d.view.control.define({className:"PanelTitle",extend:"Control",mixins:[{getDefaults:function(){var b=this.callParent();c.extend(b,{addClass:"toa-panel-title",layout:"Table",table:{width:"100%",height:"100%"},resourceTreeButton:!0,routingPlans:!1,routingPlansWidget:!1,calendar:!0,view:"time",viewSelector:!1,backButton:!0,backButtonIcon:"icon-plus",backButtonLabel:"",backButtonHint:h(22715),titleText:h(5514),filter:!0,filterDesc:!1,filterContent:!1,actions:[],items:[{xtype:"button.Icon",
name:"buttonTree",icon:"toa-icon-resource-tree-open",layoutCellWidth:1,attr:{"aria-label":h(5612)},css:{marginRight:10,padding:4},listeners:{click:this.onOpenTreeClick.bind(this)}},{tag:"h1",name:"titleCaption",addClass:"toa-panel-caption toa-panel-caption__title",layoutCellWidth:d.currentInterface===INTERFACE.MANAGE?1:"auto",listeners:{click:function(b){b.preventDefault();b.stopPropagation()}}},{xtype:"button.Icon",name:"routingPlans",icon:"toa-icon-routing-plans",iconText:h(15429),layoutCellWidth:1,
css:{marginLeft:10,marginRight:10,padding:4},listeners:{click:this.showRoutingWidget.bind(this)},attr:{"aria-label":h(15429),"aria-haspopup":"true"}},{xtype:"calendar.Single",name:"calendar",layoutCellWidth:1,addClass:"toa-layout-left-separator",cell:{addClass:"calendarContainer"}},{xtype:"button.Filter",name:"filterButton",label:h(8047),layoutCellWidth:1,addClass:"toa-layout-left-separator",attr:{"aria-haspopup":"true","aria-label":h(8047)}},{xtype:"panel.Toolbar",addClass:"toa-layout-left-separator",
name:"actionPanel",layoutCellWidth:d.currentInterface===INTERFACE.MANAGE?"auto":1,cell:{addClass:d.currentInterface===INTERFACE.MANAGE?"toa-layout-flex-cell":""},listeners:{menuItemClick:this.onActionClick.bind(this)}},{xtype:"panel.Toolbar",layoutCellWidth:1,name:"viewsPanel",addClass:"toa-layout-left-separator",items:[{xtype:"button.Icon",name:"time",icon:"icon-timeview",iconText:h(22716),attr:{title:h(8049),"aria-label":h(22716)}},{xtype:"button.Icon",name:"list",icon:"icon-listview",iconText:h(22717),
attr:{title:h(8048),"aria-label":h(22717)}},{xtype:"button.Icon",name:"map",icon:"icon-mapview",iconText:h(22718),attr:{title:h(8055),"aria-label":h(22718)}}],listeners:{menuItemClick:this.onViewChangeClick.bind(this)}},{xtype:"button.Extended",name:"clone",icon:"icon-plus",iconText:h(22715),cell:{addClass:"toa-button-plus"},layoutCellWidth:1,listeners:{click:this.onCloseClick.bind(this)}},{xtype:"button.Extended",name:"headerResponsiveMenu",icon:"icon-responsive-menu",cell:{addClass:"headerResponsiveMenu hideOptionsMenu headerResponsiveMenuOptions"},
attr:{title:h(22714),"aria-label":h(22714)},layoutCellWidth:1}]});d.currentInterface===INTERFACE.MOBILITY&&b.items.shift();return b},makeActionPanelResponsive:function(b,e,d,k,l){var n,p,s=k.find(".actionPanel button:visible"),t=l.find(".toa-dropdown-content");l=l.find(".ui-tip-content").last();for(var u=t.length-1,v=s.length-1;0<=v&&e>=d;v--)n=c(s[v]).attr("name"),p=c(s[v]).width(),c(s[v]).hide(),-1!==s[v].className.indexOf("toa-view-control-button-menu")?(n=c(t[--u]).clone(),l.find("div").length&&
n.insertBefore(l.find("div").first())||n.appendTo(l)):c(".toa-dropdown-item[name="+n+"]").show(),e-=p;p&&k.find(b).show()},resetActionPanel:function(b,c,d,k){b.find(".actionPanel button").show();c.find(".ui-tip-content .ui-tip-content").remove();!k&&c.find("button").hide()||c.find("button").show();b.find(d).hide()},manageActionPanel:function(b){var e=c('button[name="defaultMenu"]'),d=0.25*b,k=1024>=b,l=c(".toa-twopanel-first-panel.toa-twopanel.toa-twopanel-vertical"),n=c(".actionPanel_view_activitiestop");
b=c(".toa-twopanel-second-panel.toa-twopanel.toa-twopanel-vertical");var p=c(".actionPanel_view_activitiesbottom");this.resetActionPanel(l,n,e,k);this.resetActionPanel(b,p,e,k);k||(k=l.find(".actionPanel .toa-button-panel").width(),this.makeActionPanelResponsive(e,k,d,l,n),l=b.find(".actionPanel .toa-button-panel").width(),this.makeActionPanelResponsive(e,l,d,b,p))},applyOptionHeaderResponsive:function(b,e){if(e){var g=this.getChild("headerResponsiveMenu").getElement(),k=c('<table tabindex="0"><tbody><tr class="headerMenuContent"></tr></tbody></table>');
k.Tip({minWidth:250,minHeight:50,maxWidth:400,className:"headerResponsiveMenu",closeOnOutsideClick:!0,callout:!1,heightFollowContent:!0,notOutsideElements:g});g={hint:k,menuButton:g,headerPanel:this.element,className:e,popupIndex:{1:{popupClass:".routing-vsl-tip",backButtonText:h(15429)},2:{popupClass:".toa-calendar .calendar-top-panel",backButtonText:""}}};k=e+"-menu";g.hint.attr("data-menu-container",k);g.menuButton.addClass(k);"routing_run_list"===_DATA.page_label?g.orderOfRemoval={MAX:[],DESKTOP:[],
TAB:[],PHONE:[],MIN:[2,6]}:window.isReportsScreen&&(g.orderOfRemoval={MAX:[],DESKTOP:[],TAB:[4],PHONE:[4],MIN:[3,4]});new d.HeaderResponsive(g)}},applyOptionResourceTreeButton:function(b,c){d.currentInterface!==INTERFACE.MOBILITY&&this.getChild("buttonTree").setOption("hidden",!c)},applyOptionScreenName:function(b,c){if(d.currentInterface===INTERFACE.MOBILITY&&c){var g=d.widgets.HangTree.getHangTree(),k=this.getChild("titleCaption").getElement();k.attr("data-screen",c);g.registerPanel(c,k);"boolean"===
typeof window.isReportsScreen&&window.isReportsScreen&&_DATA.tabs.tabs[2].visible&&(k=g.getTreeState(SCREEN_MAPPINGS.dashboard),g.setTreeState(SCREEN_MAPPINGS.dashboard,k))}},applyOptionRoutingPlans:function(b,c){this.getChild("routingPlans").setOption("hidden",!c)},applyOptionRoutingPlansWidget:function(b,c){this.getChild("routingPlans").setOption("routingPlansWidget",c)},applyOptionViewSelector:function(b,c){this.getChild("viewsPanel").setOption("hidden",!c)},applyOptionCalendar:function(b,c){this.getChild("calendar").setOption("hidden",
!c)},applyOptionTodayDate:function(b,c){this.getChild("calendar").setOption("today",c)},applyOptionSelectedDate:function(b,c){this.getChild("calendar").setOption("selected",c)},applyOptionSetMode:function(b,c){this.getChild("calendar").setOption("setMode",c)},getOptionsSelectedDate:function(){return this.getChild("calendar").getOption("selected")},applyOptionSelectedDates:function(b,c){this.getChild("calendar").setOption("selected",c)},getOptionsSelectedDates:function(){return this.getChild("calendar").getOption("selected")},
applyOptionMaxDate:function(b,c){this.getChild("calendar").setOption("maxDate",c)},applyOptionView:function(b,c){this.getChild("viewsPanel").getChild(c).setOption("pressed",!0)},applyOptionBackButton:function(b,c){this.getChild("clone").setOption("hidden",!c)},applyOptionBackButtonIcon:function(b,c){this.getChild("clone").setOption("icon",c)},applyOptionBackButtonLabel:function(b,c){this.getChild("clone").setOption("label",c)},applyOptionBackButtonIconClass:function(b,c){this.getChild("clone").getElement().addClass(c)},
applyOptionBackButtonHint:function(b,c){this.getChild("clone").getElement().attr({title:c,"aria-label":c});this.getChild("clone").setOption("iconText",c)},applyOptionTitleText:function(b,c){var g=c,k=["reports_configuration_log","company_settings_schedule_report"];d.currentInterface===INTERFACE.MOBILITY&&(c?g=getScreenName()+c:-1!==k.indexOf(_DATA.page_label)&&(g='<button class="titleOnly dashboardBackButton" title="'+$app.model().i18n().__(16257)+'">'+$app.model().i18n().__(20812)+"</button>"));
this.getChild("titleCaption").getElement().html(g)},applyOptionActions:function(b,e){var g=this.getChild("actionPanel"),k=c(".toa-twopanel-horizontal").width();g.clearChildren();var l,n={attr:{"aria-haspopup":"true"},label:h(3514),menuItems:[],name:"defaultMenu",panel:"",xtype:"button.Menu"};d.currentInterface===INTERFACE.MOBILITY&&(l="actionPanel_"+_DATA.page_label,e&&0<e.length&&(l+=e[0].panel||"",e.forEach(function(b){"object"===typeof b&&"object"===typeof b.menuItems?(b.text=b.label?"":h(3514),
b.icon="",b.attr&&(b.attr["aria-label"]=h(8074)+(b.label?" "+b.label:"")),b.menuItems.push(l)):"object"===typeof b&&"object"===typeof b.actionOptions&&n.menuItems.push(b)}),n.menuItems.push(l),e.push(n)));g.addChildren(e);g.rerender();l&&g.getElement().attr("data-action-screen",l);(0<c(".action-menu-"+l).length||0<c(".actionsMenuContainer").children().length)&&d.HeaderResponsive.copyActionPanel(l);d.currentInterface===INTERFACE.MOBILITY&&this.manageActionPanel(k)},applyOptionFilter:function(b,c){this.getChild("filterButton").setOption("hidden",
!c);this.getChild("filterButton").getElement().attr("data-filter-screen","viewFilter_"+_DATA.page_label);this.getChild("filterButton").getPopup().getElement().parent().addClass("viewFilter_"+_DATA.page_label)},applyOptionFilterDesc:function(b,c){c&&this.getChild("filterButton").setPopupDesc(c)},applyOptionFilterContent:function(b,c){!1!==c&&this.getChild("filterButton").setOption("content",c)},getFilterPopup:function(){return this.getChild("filterButton").getPopup()},onOpenTreeClick:function(){this.notify("openTree");
this.setOption("resourceTreeButton",!1)},showRoutingWidget:function(b,c){this.notify("onShowRoutingWidget",{context:this,btn:c.event.currentTarget})},onViewChangeClick:function(b,c){this.notify("viewChange",c)},onCloseClick:function(b,c){this.notify("backButtonClick",{name:c.source.getName()})},onActionClick:function(b,c){this.notify("actionClick",c)},closeFilter:function(){var b=this.getChild("filterButton");b&&b.close()}}]})})(toa,jQuery);(function(d,c){d.view.control.define({className:"panel.Toolbar",extend:"Control",mixins:[{addSelfListeners:function(){var b=this;b.callParent();b.addListener("click",function(c,g){g.source instanceof d.view.control.button.Popup||g.source===b||b.notify("menuItemClick",{name:g.source.getName(),event:g.event,ui:g.ui,targetItem:g.targetItem||{}})})},getChildContaner:function(b,c){if(0==c||!this.currentGroup||b.getOption("startGroup")){var d=this.callParent(b,c);this.currentGroup=this.startGroup(d)}return this.currentGroup},
startGroup:function(b){return c("<span/>").addClass("toa-button-panel").appendTo(b)}}]})})(toa,jQuery);(function(d,c){d.view.control.define({className:"PanelTitleAlta",extend:"Control",mixins:[{getDefaults:function(){var b=this.callParent();c.extend(b,{addClass:"jet-css-only toa-panel-title jet-screen-title",layout:"Base",table:{width:"100%",height:"100%",class:"jet-screen-title"},resourceTreeButton:!0,routingPlans:!1,routingPlansWidget:!1,calendar:!0,view:"time",viewSelector:!1,backButton:!0,backButtonIcon:"icon-plus",backButtonLabel:"",backButtonHint:h(5387),titleText:h(5514),filter:!0,filterDesc:!1,
filterContent:!1,actions:[],items:[{xtype:"button.Icon",name:"buttonTree",icon:"toa-icon-resource-tree-open",layoutCellWidth:1,css:{marginRight:10,padding:4},attr:{"aria-label":h(5612)},listeners:{click:this.onOpenTreeClick.bind(this)}},{xtype:"button.Extended",name:"clone",icon:"icon-plus",addClass:"toa-panel-button-return",listeners:{click:this.onCloseClick.bind(this)}},{tag:"h1",name:"titleCaption",addClass:"toa-panel-caption",layoutCellWidth:1},{xtype:"button.Icon",name:"routingPlans",icon:"toa-icon-routing-plans",
layoutCellWidth:1,css:{marginLeft:10,marginRight:10,padding:4},listeners:{click:function(){var b=this.getOption("routingPlansWidget");b&&(b.requestData(),b=b.getTip())&&(b.getContent()?b.remove():(b.render(_DATA.dispatcher_container,this.element),b.getContent().addClass("on-activities-screen")))}}},{xtype:"calendar.Single",name:"calendar",layoutCellWidth:1,addClass:"toa-layout-left-separator",cell:{id:"calendarContainer"}},{tag:"div",addClass:"toa-panel-line-splitter"},{tag:"div",addClass:"toa-panel-right-padding"},
{xtype:"panel.Toolbar",name:"actionPanel",listeners:{menuItemClick:this.onActionClick.bind(this)}},{xtype:"button.Filter",name:"filterButton",label:h(8047),layoutCellWidth:1,attr:{"aria-haspopup":"true"}},{tag:"div",addClass:"oauth2-key toa-hidden",layoutCellWidth:1},{tag:"div",addClass:"work-zone-key toa-hidden",layoutCellWidth:1},{tag:"div",addClass:"search toa-hidden",layoutCellWidth:1},{xtype:"panel.Toolbar",layoutCellWidth:1,name:"viewsPanel",addClass:"toa-layout-left-separator",items:[{xtype:"button.Icon",
name:"time",icon:"icon-timeview",attr:{title:h(8049)}},{xtype:"button.Icon",name:"list",icon:"icon-listview",attr:{title:h(8048)}},{xtype:"button.Icon",name:"map",icon:"icon-mapview",attr:{title:h(8055)}}],listeners:{menuItemClick:this.onViewChangeClick.bind(this)}},{xtype:"button.Extended",name:"headerResponsiveMenu",icon:"icon-responsive-menu",addClass:"headerResponsiveMenu hideOptionsMenu",attr:{title:h(22714),"aria-label":h(22714)},layoutCellWidth:1}]});return b},applyOptionHeaderResponsive:function(b,
e){if("string"===typeof e&&d.currentInterface===INTERFACE.MOBILITY){this.getChild("headerResponsiveMenu").rerender();var g=this.getChild("headerResponsiveMenu").getElement(),k=c('<table tabindex="0"><tbody><tr class="headerMenuContent"></tr></tbody></table>');k.Tip({minWidth:250,minHeight:50,maxWidth:400,className:"headerResponsiveMenu",closeOnOutsideClick:!0,callout:!1,heightFollowContent:!0,notOutsideElements:g});g={hint:k,menuButton:g,headerPanel:this.element,className:e,popupIndex:{2:{popupClass:".toa-calendar .calendar-top-panel",
backButtonText:""}}};k=e+"-menu";g.hint.attr("data-menu-container",k);g.menuButton.addClass(k);g.orderOfRemoval=ORDER_OF_REMOVAL[e]||NO_REMOVAL;new d.HeaderResponsive(g)}},applyOptionResourceTreeButton:function(b,c){this.getChild("buttonTree").setOption("hidden",!c)},applyOptionRoutingPlans:function(b,c){this.getChild("routingPlans").setOption("hidden",!c)},applyOptionRoutingPlansWidget:function(b,c){this.getChild("routingPlans").setOption("routingPlansWidget",c)},applyOptionViewSelector:function(b,
c){this.getChild("viewsPanel").setOption("hidden",!c)},applyOptionCalendar:function(b,c){this.getChild("calendar").setOption("hidden",!c)},applyOptionTodayDate:function(b,c){this.getChild("calendar").setOption("today",c)},applyOptionSelectedDate:function(b,c){this.getChild("calendar").setOption("selected",c)},applyOptionSetMode:function(b,c){this.getChild("calendar").setOption("setMode",c)},getOptionsSelectedDate:function(){return this.getChild("calendar").getOption("selected")},applyOptionSelectedDates:function(b,
c){this.getChild("calendar").setOption("selected",c)},getOptionsSelectedDates:function(){return this.getChild("calendar").getOption("selected")},applyOptionMaxDate:function(b,c){this.getChild("calendar").setOption("maxDate",c)},applyOptionView:function(b,c){this.getChild("viewsPanel").getChild(c).setOption("pressed",!0)},applyOptionBackButton:function(b,c){this.getChild("clone").setOption("hidden",!c)},applyOptionBackButtonIcon:function(b,c){this.getChild("clone").setOption("icon",c)},applyOptionBackButtonLabel:function(b,
c){this.getChild("clone").getElement().text(c+" | ")},applyOptionBackButtonHint:function(b,c){this.getChild("clone").getElement().attr("title",c)},applyOptionTitleText:function(b,c){this.getChild("titleCaption").getElement().text(c)},applyOptionActions:function(b,c){var d=this.getChild("actionPanel");d.clearChildren();d.addChildren(c);d.rerender()},applyOptionFilter:function(b,c){this.getChild("filterButton").setOption("hidden",!c);this.getChild("filterButton").getElement().attr("data-filter-screen",
"viewFilter_configuration");this.getChild("filterButton").getPopup().getElement().parent().addClass("viewFilter_configuration")},applyOptionFilterDesc:function(b,c){c&&this.getChild("filterButton").setPopupDesc(c)},applyOptionFilterContent:function(b,c){!1!==c&&this.getChild("filterButton").setOption("content",c)},getFilterPopup:function(){return this.getChild("filterButton").getPopup()},onOpenTreeClick:function(){this.notify("openTree");this.setOption("resourceTreeButton",!1)},onViewChangeClick:function(b,
c){this.notify("viewChange",c)},onCloseClick:function(b,c){this.notify("backButtonClick",{name:c.source.getName()})},onActionClick:function(b,c){this.notify("actionClick",c)},closeFilter:function(){var b=this.getChild("filterButton");b&&b.close()},applyOptionMenuFilter:function(b,c){this.getChild("menu-filter").setOption("hidden",!c)}}]})})(toa,jQuery);function show_hint(d){if("undefined"!=typeof _DATA&&"undefined"!=typeof _DATA.event){var c,b="regular",e=null,g=null,k=null,l=null,n=0,p=10,s,t,u=toaGetTargetFromEvent(_DATA.event),v=!1;if(d&&"object"==typeof d){d.event&&(global_onmousemove(d.event),k=s=getEventXInBrowserArea(d.event),l=t=getEventYInBrowserArea(d.event),u=toaGetTargetFromEvent(d.event)||u);"undefined"!=typeof d.html&&(g=d.html);"undefined"!=typeof d.delay&&(e=d.delay);d.sticky&&(b="sticky");if(d.hide_on_dnd&&(2==_DATA.drag_state||
$&&$.ui&&$.ui.ddmanager.current&&$.ui.ddmanager.current.helper))return!1;d.dont_hide&&(v=!0);"undefined"!=typeof d.x&&(k=s=parseInt(d.x));"undefined"!=typeof d.y&&(l=t=parseInt(d.y));d["float"]&&(b="float");"undefined"!=typeof d.target&&(u=d.target)}switch(b){case "regular":c=_DATA.regular_hint=_DATA.regular_hint||setElementBG("div",document.querySelector(_DATA.dispatcher_container),{style:{zIndex:2E3,display:"none"},class:"'hint'"});if(!g||_DATA.sticky_hint&&"none"!=_DATA.sticky_hint.style.display&&
("block"!=_DATA.sticky_hint.style.display||u==_DATA.sticky_hint_target)||_DATA.regular_hint_target==u&&(_DATA.regular_hint_target!=u||"none"!=c.style.display||e&&(!e||_DATA.regular_hint_delay))){if(_DATA.regular_hint_target!=u)return _DATA.regular_hint_delay=0,!1;if(g)return!1;!v&&_DATA.regular_hint_target&&(_DATA.regular_hint_target.onmouseout=hide_hint);_DATA.sticky_hint&&"block"==_DATA.sticky_hint.style.display&&(tmp=_DATA.regular_hint,c=_DATA.regular_hint=_DATA.sticky_hint,_DATA.regular_hint.innerHTML=
tmp.innerHTML,_DATA.sticky_hint=tmp);hide_hint("regular");_DATA.regular_hint_delay=0}else{_DATA.regular_hint_target=u;c.innerHTML=g;_DATA.regular_hint_delay&&(clearTimeout(_DATA.regular_hint_delay),_DATA.regular_hint_delay=0);if(e){var w={};k&&l&&(w={x:k,y:l});_DATA.regular_hint_delay=setTimeout(function(){show_hint(w)},e)}_DATA.sticky_hint&&"block"==_DATA.sticky_hint.style.display&&(tmp=_DATA.regular_hint,c=_DATA.regular_hint=_DATA.sticky_hint,_DATA.regular_hint.innerHTML=tmp.innerHTML,_DATA.sticky_hint=
tmp);!v&&_DATA.regular_hint_target&&(_DATA.regular_hint_target.onmouseout=hide_hint);hide_hint("regular")}break;case "sticky":c=_DATA.sticky_hint=_DATA.sticky_hint||setElementBG("div",document.querySelector(_DATA.dispatcher_container),{style:{zIndex:2E3,display:"none"},class:"'hint'"});if(g&&(_DATA.sticky_hint_target!=u||_DATA.sticky_hint_target==u&&"none"==c.style.display&&(!e||e&&!_DATA.sticky_hint_delay))){_DATA.sticky_hint_target=u;c.innerHTML=g;_DATA.sticky_hint_delay&&(clearTimeout(_DATA.sticky_hint_delay),
_DATA.sticky_hint_delay=0);if(e){var x;x=k&&l?{x:k,y:l,sticky:!0}:{sticky:!0};_DATA.sticky_hint_delay=setTimeout(function(){show_hint(x)},e);return!1}_DATA.regular_hint&&"block"==_DATA.regular_hint.style.display&&(tmp=_DATA.sticky_hint,c=_DATA.sticky_hint=_DATA.regular_hint,_DATA.sticky_hint.innerHTML=tmp.innerHTML,_DATA.regular_hint=tmp);_DATA.sticky_hint_target.onmouseout=null;hide_hint("sticky")}else g||(_DATA.sticky_hint_target!=u&&(s=k,t=l),_DATA.sticky_hint_target.onmouseout=null,hide_hint("sticky"),
_DATA.sticky_hint_delay=0);break;case "float":c=_DATA.float_hint=_DATA.float_hint||setElementBG("div",document.querySelector(_DATA.dispatcher_container),{style:{zIndex:2E3,display:"none"},class:"'hint'"});if(!g||_DATA.sticky_hint&&"none"!=_DATA.sticky_hint.style.display&&("block"!=_DATA.sticky_hint.style.display||u==_DATA.sticky_hint_target)||_DATA.float_hint_target==u&&(_DATA.float_hint_target!=u||"none"!=c.style.display||e&&(!e||_DATA.float_hint_delay))){if(_DATA.float_hint_target!=u)return _DATA.float_hint_delay=
0,!1;if(g)return!1;_DATA.float_hint_target.onmouseout=null;hide_hint("float");_DATA.float_hint_delay=0}else{_DATA.float_hint_target=u;c.innerHTML=g;_DATA.float_hint_delay&&(clearTimeout(_DATA.float_hint_delay),_DATA.float_hint_delay=0);if(e)return w=k&&l?{x:k,y:l,"float":!0}:{"float":!0},_DATA.float_hint_delay=setTimeout(function(){show_hint(w)},e),!1;_DATA.float_hint_target.onmouseout=null;hide_hint("float")}position=element_position(_DATA.float_hint_target);s=position.x;t=position.y;var p=_DATA.float_hint_target.offsetHeight-
2,n=!0,y=function(b){var c=getEventXInBrowserArea(b),e=getEventYInBrowserArea(b),d=_DATA.float_hint.offsetHeight,g=_DATA.float_hint.offsetWidth,k=parseInt(_DATA.float_hint.style.top),l=parseInt(_DATA.float_hint.style.left);global_onmousemove(b);if(k-50>e||k+d+50<e||l-50>c||l+g+50<c)$(document).unbind("mousemove",y),hide_hint()};$(document).mousemove(y)}locate(c,s,t,10,p,!0,!0,0,0,!1,n,!1)}}
function hide_hint(d){if("undefined"!=typeof _DATA)return toa.app.trigger("global.hint.hide",{}),"regular"!=d&&(_DATA.regular_hint&&setElementBG(_DATA.regular_hint,null,{style:{display:"none"}}),_DATA.regular_hint_delay&&(clearTimeout(_DATA.regular_hint_delay),_DATA.regular_hint_delay=0)),"float"!=d&&(_DATA.original_doc_onmousemove&&(document.onmousemove=_DATA.original_doc_onmousemove,_DATA.original_doc_onmousemove=null),_DATA.float_hint&&setElementBG(_DATA.float_hint,null,{style:{display:"none"}}),
_DATA.float_hint_delay&&(clearTimeout(_DATA.float_hint_delay),_DATA.float_hint_delay=0)),"sticky"!=d&&(_DATA.sticky_hint&&setElementBG(_DATA.sticky_hint,null,{style:{display:"none"}}),_DATA.sticky_hint_delay&&(clearTimeout(_DATA.sticky_hint_delay),_DATA.sticky_hint_delay=0)),!1}
function locate(d,c,b,e,g,k,l,n,p,s,t,u){var v=e||0,w=g||0;e=g=0;u=u?{width:u.offsetWidth+u.scrollLeft-20,height:u.offsetHeight+u.scrollTop-20}:_DATA.screen_size;d.style.height&&d.style.width&&!s?(g=parseInt(d.style.width),e=parseInt(d.style.height)):(_DATA.hint_buffer=_DATA.hint_buffer||setElement("div",document.querySelector(_DATA.dispatcher_container),{style:{position:"absolute",top:u.height+2E3+"px",visibility:"hidden"}}),_DATA.hint_buffer.innerHTML==d.innerHTML&&d.calculated_width&&d.calculated_height?
(g=d.calculated_width,e=d.calculated_height):(_DATA.hint_buffer.className=d.className,_DATA.hint_buffer.innerHTML=d.innerHTML,g=_DATA.hint_buffer.offsetWidth,e=_DATA.hint_buffer.offsetHeight,p&&(g=Math.max(g,p)),d.calculated_width=g,d.calculated_height=e));c=c+v+(t?-g:0);c=0>c?0:c;b+=w;b=0>b?0:b;if("undefined"==typeof k||k)c=Math.min(c,0>u.width-g?0:u.width-g);if("undefined"==typeof l||l)b=Math.min(b,0>u.height-e?0:u.height-e);if(n)if(b+e>u.height){if(d.style.height=(n>u.height-b-10?n:u.height-b-
10)+"px",d.style.width=parseInt(d.style.width||d.offsetWidth)+15+"px","undefined"==typeof k||k)c=Math.min(c,0>u.width-(g+15)?0:u.width-(g+15))}else d.style.height="";p&&(d.style.width=g+"px");setElementBG(d,null,{style:{left:c+"px",top:b+"px",display:"block"}})};function apply_to_tab(d,c){if(c&&c.apply_to_tab)return c.apply_to_tab(c.tab_id,d);3===toa.currentInterface&&"function"===typeof window.loadTabToMobility&&loadTabToMobility(d)}function highlight_field(d,c){$(d).parent().prevAll("td").css("color",c?"#E60000":"").find("td,span").css("color",c?"#E60000":"")}
function mark_if_invalid(d,c,b){d=$(d)[0];c.gui||(c.gui="");if("radiogroup"==c.gui&&2==c.access){var e=!1;b=d.form.elements["p["+b+"]"];for(d=0;d<b.length;d+=1)if(b[d].checked){e=!0;break}if(e)return highlight_field($(b[0]).parents("table:eq(0)"),!1),!1;highlight_field($(b[0]).parents("table:eq(0)"),!0);return r(8206,{"{FIELD}":c.title})+"\n"}if("password"==c.gui){e=d.form.elements["p["+b+"_confirmation]"];if((""===e.value||""===d.value)&&2==c.access||""===e.value&&""!==d.value||""!==e.value&&""===
d.value)return highlight_field(e,!0),highlight_field(d,!0),r(8002,{"{PASSWORD_TITLE}":c.title,"{PASSWORD_CONFIRMATION}":c.confirmation_title})+"\n";if(e.value!==d.value)return highlight_field(e,!0),highlight_field(d,!0),r(8001,{"{PASSWORD_TITLE}":c.title,"{PASSWORD_CONFIRMATION}":c.confirmation_title})+"\n";"password"==c.gui&&(highlight_field(d,!1),highlight_field(d.form.elements["p["+b+"_confirmation]"],!1))}else{if(2==c.access){if(-1!=["","[]"].indexOf($.trim(d.value))){if("p[collab_assigned_user_group]"==
d.name||"p[collab_operator_helpdesk]"==d.name)if(b=toa.app.trigger("interface.userDetails.getPreparedUserGroups"),"p[collab_assigned_user_group]"==d.name){if(0!==b.usergroups.length)return!1}else if(0!==b.userhelpDesk.length)return!1;highlight_field(d,!0);return"non_working_reason_id"===$.trim(d.id)?r(18015)+"\n":r(806,{"{FIELD}":c.title})+"\n"}if(0==$.trim(d.value)&&"p[main_resource_id]"==d.name)return highlight_field(d,!0),r(806,{"{FIELD}":c.title})+"\n"}if(""!==d.value){if("int"==c.type){c.min=
-2147483648;c.max=2147483647;if(!TypeValidator.isIntSigned(d.value))return highlight_field(d,!0),r(808,{"{FIELD}":c.title})+"\n";if("undefined"!==typeof c.min&&d.value<c.min||"undefined"!==typeof c.max&&d.value>c.max)return highlight_field(d,!0),r(15461,{"{LABEL}":c.title})+"\n"}if(c.re&&!TypeValidator.isRegexp(d.value,{regexp:c.re}))return highlight_field(d,!0),c.re_error?c.re_error:r(15461,{"{LABEL}":c.title})+"\n";if("url"==c.gui&&!TypeValidator.isUrlWithParams(d.value))return highlight_field(d,
!0),r(15461,{"{LABEL}":c.title})+"\n"}if("time"==c.type&&(!/^[0-9]{1,2}$/.test(d.value)||60<=parseInt(d.value,10)))return highlight_field(d,!0),r(15461,{"{LABEL}":c.title})+"\n";if("datetime"==c.type){e=!0;if(c.empty_acceptable&&""==d.form.elements["p["+b+"_minutes]"].value&&""==d.form.elements["p["+b+"_hours]"].value&&""==d.form.elements["p["+b+"_dumb]"].value)e=!1;else{if(!/^[0-9]{1,2}$/.test(d.form.elements["p["+b+"_minutes]"].value))return highlight_field(d,!0),r(15461,{"{LABEL}":c.title})+"\n";
var g=d.form.elements["p["+b+"_hours]"].value+":"+d.form.elements["p["+b+"_minutes]"].value+":00",k=d.form.elements["p["+b+"]"].value;k&&isDate(k)&&k+" "+g>=c.min&&k+" "+g<=c.max&&(e=!1,d.form.elements["p["+b+"]"].value=k)}if(e)return highlight_field(d,!0),r(15461,{"{LABEL}":c.title})+"\n"}if("duration"==c.type&&"0"==d.form.elements["p["+b+"_hours]"].value&&"0"==d.form.elements["p["+b+"_minutes]"].value&&2==c.access)return highlight_field(d,!0),r(7353,{"{TITLE}":c.title})+"\n";if("duration"==c.type&&
999<d.form.elements["p["+b+"_hours]"].value&&2==c.access)return highlight_field(d,!0),r(15461,{"{LABEL}":c.title})+"\n";if(c.maxFileSize&&(b=0,e="",d.files&&d.files[0]?(b=d.files[0].size,e=d.files[0].name):"undefined"!==typeof ActiveXObject&&d.value&&(e=(new ActiveXObject("Scripting.FileSystemObject")).getFile(d.value),b=e.size,e=e.name),b>c.maxFileSize))return highlight_field(d,!0),r("11964",{"{LOGO_TYPE}":e,"{SIZE}":c.maxFileSize/1048576+h(16290)});highlight_field(d,!1);cgErrorLayer(d.form).html("&nbsp;");
return!1}}function focus_on(d){if(d){var c=d;do"tab_content"==c.className&&"none"==c.style.display&&c.mc&&c.mc();while(c=c.parentNode);try{d.focus&&d.focus()}catch(b){}}}
function download_file(d,c){c=c?c:"";var b=get_element("downloadIframe")||setElement("iframe",document.querySelector(_DATA.dispatcher_container),{style:{width:0,height:0,position:"absolute",left:"-1000px"},id:'"downloadIframe"',src:'"javascript:false"'});d=!0==_DATA.is_mobility_app?c+d+"&"+GetSessId()+"&"+anticache():c+"download/"+d+"&"+GetSessId()+"&"+anticache();b.document?b.document.location=d:b.src=d}function cgErrorLayer(d){return $(d).find("div[class*='rror']")}
function cgCheck(d,c,b,e,g,k){var l,n,p,s=0,t="",u;b||(b=null);if(c)for(l in c)if(n=c[l],(u=d.elements["p["+l+("datetime"==n.type||"time"==n.type||"duration"==n.type?"_minutes":"")+"]"])&&!u.disabled){if(n.in_closable_section&&((p=get_element("s"+n.in_closable_section))&&!p.ValidatorSetup&&(p.ValidatorSetup=!0,p.onclick=p.onchange=function(b,c,e,d){return function(){cgOpenSection(this,"sc"+b);cgCheck(c,e,d)}}(n.in_closable_section,d,c,b)),p&&!0!=p.checked))continue;if(p=mark_if_invalid(u,n,l))n.maxFileSize&&
(u.value=""),t?s+=1:(t=hs(p),e&&focus_on(u));if(!u.ValidatorSetup)if(u.ValidatorSetup=!0,p=function(b,c,e){cgCheck(b,c,e)}.bind(void 0,d,c,b),"radiogroup"==n.gui)for(n=0;n<u.length;n+=1)u[n].onblur=u[n].onclick=p;else u.onblur||u.onchange||(u.onblur=u.onchange=p,"duration"==n.type?(u=d.elements["p["+l+"_hours]"],u.onblur=u.onchange=p):"datetime"==n.type?(u=d.elements["p["+l+"_dumb]"],u.onblur=u.onchange=p):"password"==n.gui&&(u=d.elements["p["+l+"_confirmation]"],u.onblur=u.onchange=p))}try{if(b){var v=
window[b](d,c,t?!1:e);if(!0!==v){if(!1===v&&!t)return!1;v&&v.errors&&(t?s+=v.errors.length:(t=hs(v.errors[0]),focus_on(v.focus_on),s+=v.errors.length-1))}}}catch(w){console.log("cgCheck exception"),console.warn(w)}if(t)s&&(t+=". ("+r(7301,{"{MORE_ERRORS}":s})+")"),cgErrorLayer(d).text(t);else if(e){b=!1;for(l in c)c[l].confirm_if_exceeds_hour&&(e=d.elements["p["+l+"_hours]"],60<Math.abs(60*(e.options[e.selectedIndex].value-c[l].default_hours)+(d.elements["p["+l+"_minutes]"].value-c[l].default_mins))&&
(b=!0));if(b)return toa.ui.Confirm({text:h(1015),acceptButtonHandler:function(){$(d.elements.form_submit).attr("disabled","disabled");var b=!0;g&&(b="string"==typeof g?window[g](d):g.apply(this,[d]));!1!==b&&request({form:d,data:{condition_keys:k?k:{}}})}}),!1;$(d.elements.form_submit).attr("disabled","disabled");c=!0;g&&(c="string"==typeof g?window[g](d):g.apply(this,[d]));!1!==c&&request({form:d,data:{condition_keys:k?k:{}},errorHandler:function(b){b&&b.continue_work_with_form&&$(d.elements.form_submit).attr("disabled",
!1)}})}return!1}function cgOpenWin(d){if(""===d)toa.ui.Alert({text:h(7393)});else{/^\.\//.test(d)&&(d=d.replace(/^\.\//,this.location.host+this.location.pathname));try{window.open(/^https?:/.test(d)?d:this.location.protocol+"//"+d,"","width="+screen.width+", height="+screen.height+", top=0, left=0, fullscreen=yes, directories=yes, location=yes, resizable=yes, menubar=yes, toolbar=yes, scrollbars=yes, status=yes")}catch(c){toa.ui.Alert({text:h(7393)})}}}
function cgGenerate(d,c,b,e){var g=[],k;c=c||"";c=$(e||"<div/>").addClass(c);for(k in d)"tab"==d[k].field?(d[k].content=cgGenerate(d[k].content||[],"tab_content"),g.push(d[k])):(g.length&&(c.append(Tabset(g,b)),g=[]),"object"==typeof d[k].content&&(d[k].content=cgGenerate(d[k].content||[],"",b)),$("<div>").html(d[k].content).appendTo(c));g.length&&c.append(Tabset(g,b));return c.get(0)}var CRCODE=13;
toa.ns("toa.contentGenerator",{cgFormTemplate:(new toa.Template('<form novalidate id=<%=formId%> class="CGform">;<h1 class="CGtitle"></h1>;<div role="button" aria-label="<%=closeName%>" class="ig CGcloseIc" tabindex="0"></div>;<div class="CGcontent"></div>;<div class="CGerror"></div>;<div class="CGbuttons">;<input type="button" class="toa-button" tabindex="0" value=<%=closeName%>>;<input type="submit" name="form_submit" tabindex="0" class="CGrightButton toa-button">;</div>;</form>'.split(";"))).compile(),getTitelDescription:function(d){return{xtype:"panel",
layout:"none",addClass:"fb-expanded",name:"innerContent",items:[{xtype:"panelTitle",name:"title",id:"content_caption"},{xtype:"panel",name:"innerContent",layout:"none",addClass:"toa-panel-content",id:"content_content",items:[{xtype:"form",layout:"none",name:"cgForm",addClass:"CGform",attr:{novalidate:"novalidate"},id:d.formId,items:[{xtype:"hidden",name:"tabId",value:d.tabId},{xtype:"hidden",name:"content_url",value:d.contentUrl},{xtype:"hidden",name:"targ_el",value:d.formId},{xtype:"panel",name:"content"},
{xtype:"panel",addClass:"CGtabError",html:d.error},{xtype:"panel",name:"buttons",height:"30px",addClass:"CGtabButtons"}]}]}]}},renderDrivingDirections:function(d,c){var b=new toa.views.directions.DirectionsView(c.route,c.params),e=new toa.ui.Popup({title:h(5806),view:b,autoOpen:!0,width:700});e.setPositionCenter();b.renderAll(e)},onActionClick:function(d,c){var b=toa.app.model("companySettings").getActionsDesc(c.name);"start_chat_with_resource"==c.name?toa.community&&toa.community.transport&&toa.app.trigger("global.data.get",
{controller:"Chat",method:"startChat",params:{aid:this.aid},responseHandler:function(b,c){c&&c.contactData&&c.contactData.address&&toa.app.model("Contacts").requestContactWithAddress(c.contactData.address,{success:function(b){toa.app.trigger("sn.chat.create",b.result)}})}}):"view_directions"==c.name||b&&"view_directions"==b.base_label?toa.app.trigger("global.data.get",{controller:"Map",method:"drivingDirections",params:{action:c.name,aid:this.aid,pid:this.pid,date:this.date,context_layout:c.layout_id,
panel:"top"},responseHandler:this.renderDrivingDirections.bind(this)}):toa.app.trigger("interface.actions.click",{action:c.name,aid:this.aid,pid:this.pid,date:this.date,context_layout:c.layout_id||this.layout_id,panel:"top"})},createPanel:function(d){this.pid=d.pid;this.date=d.date;this.aid=d.aid;this.type=d.type;this.layout_id=d.layout_id;var c=this.getTitelDescription(d),b=d.caption_info;this.windowContent=toa.createWidget(c);d.submitLabel&&(c={xtype:"input",attr:{type:"submit"},name:"form_submit",
disabled:d.submitReadonly,addClass:"CGtabRightButton toa-button ",value:d.submitLabel},d.submitReadonly&&(c.disabled=!0,c.attr={disabled:"disabled",type:"submit"}),this.windowContent.find("buttons").add(c));d.closeLabel&&this.windowContent.find("buttons").add({xtype:"input",attr:{type:"button"},name:"cancel",addClass:"CGtabLeftButton toa-button",value:d.closeLabel,listeners:{click:function(b){cgClose({closeTab:d.tabId,cancel:!0});b.preventDefault()}}});d.target.empty();this.windowContent.renderTo(d.target);
c=[];if(d.actions)for(var e=0;e<d.actions.length;e++){var g=d.actions[e];-1!==g.name.indexOf("start_chat_with_resource")&&(g.name="start_chat_with_resource");c.push({label:g.label,js:"toa.contentGenerator.onActionClick('',{name:'"+toa.toHtml(g.name)+"', layout_id:"+d.layout_id+"});"})}b.back="tab"==d.type?{trigger:"interface.contentGenerator.close",closeTab:d.tabId,cancel:!0}:!1;toa.app.trigger("layout.caption.set",{caption:d.caption,caption_info:b,actions:c});b=this.windowContent.find("cgForm").getElement().get(0);
c=this.windowContent.find("content").getElement();cgGenerate(d.content,"CGtabContent",b,c);this.tryBrowserForNeedResizable(b.querySelectorAll("textarea"));return b},tryBrowserForNeedResizable:function(d){var c=navigator.userAgent.toLowerCase();if(-1<c.indexOf("trident")||-1<c.indexOf("msie"))for(var c=0,b=d.length;c<b;c++)0==d[c].clientWidth&&$(d[c]).css({width:"100px",height:"50px"}),$(d[c]).resizable({handles:"se"}),$(d[c]).parent().css({padding:0}),$(d[c]).css({overflow:"auto"})},isModalScreenOpened:function(){return this.windowContent&&
"tab"===this.type},createWindow:function(d,c){c.cg=setElementBG("div",document.querySelector(_DATA.popup_container),{"class":"'CG jet-css-only CG-popup'",style:{left:"-100000px",zIndex:1002}});c.cg.innerHTML='<div class="CGbevel"></div>'+toa.contentGenerator.cgFormTemplate.apply({formId:generate_id(d)+"frm",closeName:h(6413)})+'<div class="CGbevel"></div>';var b=$(c.cg);c.cgForm=b.find("form.CGform").get(0);c.cgTitle=b.find(".CGtitle").mousedown(function(b){move_div(b,!1,"both",!1,!1,c.cg)}).get(0);
c.cgCloseIcon=b.find(".CGcloseIc").mousedown(cgClose).keypress(function(b){b.keyCode==CRCODE&&cgClose()}).get(0);c.cgContent=b.find(".CGcontent").get(0);c.cgError=b.find(".CGerror").get(0);c.cgCloseButton=b.find(".CGbuttons>input[type=button]").mousedown(cgClose).keypress(function(b){b.keyCode==CRCODE&&cgClose()}).get(0);c.cgSubmit=b.find(".CGbuttons>input[type=submit]").get(0)}});
function cg(d,c,b){var e,g,k;if("win"==d.cgData.open_as){if(_DATA.cg&&($(_DATA.cg).remove(),toa.view.Header.setEnable()),toa.contentGenerator.createWindow(c,_DATA),d.cgData.modal&&(d.cgData.with_help=!1),_DATA.block_esc=d.cgData.modal?!0:!1,_DATA.cgCloseButton.style.visibility=_DATA.cgCloseIcon.style.visibility=d.cgData.modal?"hidden":"",_DATA.cgTitle.innerHTML=d.cgData.title,_DATA.cgError.innerHTML=d.cgData.error||"&nbsp;",_DATA.cgSubmit.style.display=d.cgData.readonly_access?"none":"",_DATA.cgSubmit.disabled=
d.cgData.submitReadonly?!0:!1,_DATA.cgSubmit.value=d.cgData.submit_label?d.cgData.submit_label:h(445),e=_DATA.cgForm,e.elements.ignore_warning&&(e.elements.ignore_warning.value=""),k="CGcontent","string"===typeof d.cgClassName&&d.cgClassName.trim()&&(k+=" "+d.cgClassName.trim()),k=cgGenerate(d.cgData.content,k,e),_DATA.cgContent.win_width&&(k.win_width=_DATA.cgContent.win_width,k.frame_width=_DATA.cgContent.frame_width,k.win_height=_DATA.cgContent.win_height,k.frame_height=_DATA.cgContent.frame_height,
_DATA.cgContent.max_win_width&&(k.max_win_width=_DATA.cgContent.max_win_width,k.max_win_height=_DATA.cgContent.max_win_height),k.style.width=_DATA.cgContent.style.width,k.style.height=_DATA.cgContent.style.height),e.replaceChild(k,_DATA.cgContent),_DATA.cgContent=k,c&&!c.parentNode&&(c=null),$('<input type="hidden" name="targ_el" value="'+generate_id(c||e)+'">').appendTo(_DATA.cgContent),d.cgData.no_need_content_url_in_form||e.elements.content_url&&e.elements.content_url.value||$('<input type="hidden" name="content_url" value="'+
_DATA.content_url+'"/>').appendTo(_DATA.cgContent),"win"==d.cgData.open_as&&!b){var l={};_DATA.cgContent.style.width="";d.cgData.min_width&&_DATA.cgContent.offsetWidth<d.cgData.min_width&&(_DATA.cgContent.style.width=d.cgData.min_width+"px");_DATA.cgContent.frame_width=_DATA.cg.offsetWidth-_DATA.cgContent.offsetWidth+20;_DATA.cgContent.win_width=_DATA.cg.offsetWidth+_DATA.cgContent.frame_width;_DATA.cgContent.win_height=_DATA.cg.offsetHeight;_DATA.cgContent.frame_height=_DATA.cg.offsetHeight-_DATA.cgContent.offsetHeight;
$.each(d.cgData.content,function(b,c){var e;"closable_section"==c.field&&(e=get_element("sc"+b))&&"none"==e.style.display&&(e.style.display="block",l[b]=e)});ElementsNum(l)&&(_DATA.cgContent.max_win_width=_DATA.cg.offsetWidth,_DATA.cgContent.max_win_height=_DATA.cg.offsetHeight,$.each(l,function(){this.style.display="none"}));cgShowWindow({width:_DATA.cgContent.win_width,frame_width:_DATA.cgContent.frame_width});app.focusTrap($(e)[0]);$(e).find(":input:enabled:visible:not([readonly]):first").focus()}}else{if("tab"==
d.cgData.open_as){cgClose({closeTab:!0,cancel:!0,isTabRefresh:!0});k=toa.app.trigger("layout.menu.addClosableTab",{label:d.tabId||d.page_label,name:d.cgData.title,url:d.cgData.form_action.slice(1)});toa.app.trigger("layout.page.beforeChange",{to:d.page_label,from:_DATA.page_label});var n=_DATA.page_label;_DATA.page_label=d.page_label;_DATA.content_url=d.cgData.form_action+"&tabId="+k}_DATA.tabs.set_tabs(d.tabs||0,null);c&&!c.parentNode&&(c=null);b=d.cgData.error||(d.cgData.data_saved?'<span class="info">'+
d.cgData.data_saved+"</span>":"&nbsp;");var p=d.cgData.readonly_access?"":toa.isUndefined(d.cgData.submit_label)?h(445):"",s=!!d.cgData.submitReadonly,t="tab"==d.cgData.open_as||d.cgData.readonly_access?r(6413):"";e=_DATA.cgForm=toa.contentGenerator.createPanel({target:$(_DATA.dispatcher_content),type:d.cgData.open_as||"page",caption:d.caption||d.cgData.title,caption_info:d.caption_info||{},content:d.cgData.content,actions:d.cgData.title_addition,formId:generate_id(c)+"frm",tabId:k||"",contentUrl:_DATA.content_url,
error:b,readOnly:d.cgData.readonly_access,submitLabel:p,submitReadonly:s,closeLabel:t,pid:d.pid||toa.app.get("pid"),date:d.date||toa.app.get("date"),aid:d.aid||0,layout_id:d.layout_id||""})}$(window).trigger("resize");$(e).find("[name*='p[service_window_check]']").filter('[type="checkbox"]').click(function(b){b=$(e).find("[name='p[service_window_start_h]'],[name='p[service_window_start_m]'],[name='p[service_window_end_h]'],[name='p[service_window_end_m]']");$(this).prop("checked")?b.removeAttr("disabled"):
b.attr("disabled","disabled")});c=cgBindConditionKeys(d);this.handlerDuration(e);this.handlerTimeToComplete(e,d.cgData.validator);this.handlerAccessSchedule(e);_DATA.cgConditionKeys=c;$('button[geolocation="mapposition"][geostatus="0"]',e).each(function(){$(this).one("click",function(){var b=$(this),c=b.attr("geolat"),e=b.attr("geolng");b.hide();var d=$('<div id="map"/>').css({width:320,height:240,padding:0,marginTop:10,marginBottom:10});b.after(d);b.after("<br/>");var g=new app.map.oracle.MapContainer({container:d,
minimalZoomControl:!0,modeSwitcher:!1,initOnDemand:!0}),k=g.createVectorLayer("singleMarker"),l=new app.map.oracle.Marker(e,c);k.addFeature(l);g.addLayer(k);g.setCenterAndZoom({lat:e,lng:c},15);g.initInstance();b.attr("geostatus",1);b.on("click",{hideButton:n,container:d},function(b){$(this).hide();n.show();d.show();return!1});var n=$("<button />").text(h(13410));n.on("click",{showButton:b,container:d},function(b){$(this).hide();b.data.showButton.show();b.data.container.hide();return!1});b.after(n);
return!1})});e.target="";e.enctype="application/x-www-form-urlencoded";e.method="POST";e.action=d.cgData.form_action;e.onsubmit=cgCheck.bind(void 0,e,d.cgData.validator,d.cgData.check_function,!0,d.submit_function,c?c:null);if(d.cgData.validator){var u;for(g in d.cgData.validator)if("date"==d.cgData.validator[g].type&&d.cgData.validator[g].access&&1<=d.cgData.validator[g].access||"datetime"==d.cgData.validator[g].type){b=(u=$(e).find("[id^=display"+g+"]")).length?u.attr("id"):e.elements["p["+g+"]"].id;
p=e.elements["p["+g+"]"].id;p=b===p?!1:"#"+p;k=c=null;if(d.cgData.validator[g].min)try{c=toa.date.parseDate("Y-m-d",d.cgData.validator[g].min)}catch(v){}if(d.cgData.validator[g].max)try{k=toa.date.parseDate("Y-m-d",d.cgData.validator[g].max)}catch(w){}b=$("#"+b);p=$(p);b.wrap("<div>");c=new toa.view.calendar.Datepicker(b,{minDate:toa.date.formatDate("iso",c),maxDate:toa.date.formatDate("iso",k)});try{if(""==b.val()&&d.cgData.validator[g].empty_acceptable)p.val(b.val());else{var x=b.val();x&&(x=toa.date.parseDate("date",
x),c.setDate(toa.date.formatDate("iso",x)),p.val(c.getDate()))}}catch(y){p.val(b.val())}(function(b,c,e){c.on("change",function(){if(""===c.val())e.val("");else try{var d=toa.date.parseDate("date",c.val()),g=toa.date.formatDate("iso",d);b.setDate(g);e.val(g)}catch(k){e.val(c.val())}});b.addListener("changeDate",function(b,c){e.val(c)});b.addListener("openDatePicker",function(){b.getSelectedElement().find("a").focus()});b.addListener("closeDatePicker",function(){b.form.closest(".toa-calendar-form").find(".icon").focus()})})(c,
b,p);cgRegisterCalendar(c)}}e.open_as=d.cgData.open_as;"undefined"==typeof d.dont_put_focus&&cgPutFocus();"win"!=d.cgData.open_as||"undefined"!=typeof d.cgData.show_modal&&!0!=d.cgData.show_modal||show_disabling_cover(!0);"tab"==d.cgData.open_as&&toa.app.trigger("layout.page.changed",{to:_DATA.page_label,from:n,newTab:!0});"tab"!=d.cgData.open_as&&"win"!=d.cgData.open_as||toa.view.Header.setDisable();return _DATA.cgContent}
function cgBindConditionKeys(d){if(d.cgData&&d.cgData.conditionKeys){var c=d.cgData.conditionKeys;d=toa.utils.func.debounce;for(var b in c)if("aworktype"!=b&&"invtype"!=b&&"srtype"!=b&&"ptype"!=b){var e=$("select[name='p["+b+"]']");if(e.length)e.on("change",function(b){cgConditionChange(b,c)});else if(e=$("input:checkbox[name='p["+b+"]']"),e.length)e.on("click",function(b){cgConditionChange(b,c,!0)});else if(e=$("input:radio[name='p["+b+"]']"),e.length)e.on("change",function(b){cgConditionChange(b,
c,!0)});else if(e=$("input[name='p["+b+"]']"),e.length)e.on("input",d(function(b){cgConditionChange(b,c,!0)},500));else if(e=$("textarea[name='p["+b+"]']"),e.length)e.on("input",d(function(b){cgConditionChange(b,c,!0)},500))}return c}}var lastFocusedName=null,ajaxRequest=null;
function cgConditionChange(d,c,b){null!==ajaxRequest&&(ajaxRequest.abort(),$("[x-clone]").each(function(){var b=$(this),c=b.attr("name"),c=$("form [name='"+c+"']");1===c.length&&(c[0].setSelectionRange(b[0].selectionStart,b[0].selectionEnd),c[0].scrollLeft=b[0].scrollLeft,c[0].scrollTop=b[0].scrollTop);b.is(":focus")&&c.focus();b.remove()}));Tabset.AddSelectedTabs();var e=$(":focus"),g,k;if(1===e.length&&e){lastFocusedName=e.attr("name");try{g=e[0].selectionStart,k=e[0].selectionEnd}catch(l){if(!1===
l instanceof DOMException)throw l;}var n=e[0].scrollLeft,p=e[0].scrollTop}var s=d.target.form;if(null!==s){var t=!1,u;b&&(t=$(d.target).attr("name"),u=$(d.target).val());$("button[class*='ightButton']").attr("disabled","disabled");s.action+="&form_action=entity_type_change";d={condition_keys:c};if(c=toa.app.trigger("interface.userDetails.prepareResources"))d.uproviders=c;c=$("[name='"+t+"']");if(c.is('input[type="text"], textarea')){var v=c.clone(!1);if(b=c.offset())v.css("left",b.left),v.css("top",
b.top);v.attr("x-clone","");v.css("position","absolute");v.css("z-index","10000");v.appendTo("body");v.val(c.val());v[0].setSelectionRange(c[0].selectionStart,c[0].selectionEnd);v[0].scrollLeft=c[0].scrollLeft;v[0].scrollTop=c[0].scrollTop;c.is(":focus")&&v.focus()}ajaxRequest=request({form:s,data:d,get_xhr:!0,responseHandler:function(){if(t){var b=$("form [name='"+t+"']");if(1<b.length&&"radio"==b.attr("type")&&u)for(var c=0;c<b.length;c++){if($(b[c]).val()==u){$(b[c]).attr("selected","selected").focus();
ajaxRequest=null;return}}else if(1<b.length){var d=0;$("[name='p[external_id]']").parents("form[id^=elId]").each(function(){var b=parseInt($(this).attr("id").substring(4));d=d<b?b:d});b=$("[name='"+t+"']",$("#elId"+d))}else v&&v.remove();if(b.is('input[type="text"], textarea')){var c=v[0].selectionStart,l=v[0].selectionEnd,s=v[0].scrollLeft,B=v[0].scrollTop;b.val(v.val());b[0].setSelectionRange(c,l);b[0].scrollLeft=s;b[0].scrollTop=B;null!==lastFocusedName&&lastFocusedName!==t?(e=$('form [name="'+
lastFocusedName+'"]')(void 0!==g||void 0!==k)&&e[0].setSelectionRange(g,k),e[0].scrollLeft=n,e[0].scrollTop=p,e.focus()):b.focus();v.remove();document.execCommand("undo")}lastFocusedName=null}ajaxRequest=null}});cgDestroyCalendars()}}
function cgPutFocus(){for(var d=!1,c=_DATA.cgForm,b=0;b<c.elements.length;b+=1)if("TEXT"==c.elements[b].type.toUpperCase()||"TEXTAREA"==c.elements[b].tagName.toUpperCase()||"SELECT"==c.elements[b].tagName.toUpperCase())try{d=!0;break}catch(e){}if(!d&&"win"==c.open_as&&"none"!==_DATA.cgSubmit.style.display&&!_DATA.cgSubmit.style.disabled)try{_DATA.cgSubmit.focus()}catch(g){}}
function cgShowWindow(d){d||(d={});var c=_DATA.screen_size,b,e=d.frame_width||_DATA.cg.offsetWidth-_DATA.cgContent.offsetWidth,g=d.frame_height||_DATA.cg.offsetHeight-_DATA.cgContent.offsetHeight;b=Math.max(Math.min(d.width?d.width:_DATA.cg.offsetWidth,c.width),150);setElementBG(_DATA.cgContent,null,{style:{"max-width":""+(b-e)+"px"}});d=d.height||_DATA.cg.offsetHeight;d>c.height?(d=Math.max(c.height,g+30),setElementBG(_DATA.cgContent,null,{style:{height:""+(d-g)+"px",maxHeight:"",expression:{}}})):
(g=d-g+(c.height-d)/2,setElementBG(_DATA.cgContent,null,{style:{height:"",maxHeight:""+g+"px",expression:{height:"this.offsetHeight > "+g+" ? '"+(g+1)+"px' : 'auto'"}}}));setElementBG(_DATA.cg,null,{style:{left:parseInt(""+(c.width-b)/2)+"px",top:parseInt(""+(c.height-d)/2)+"px"}})}
function handlerAccessSchedule(d){var c=$('<div class="access_hours"></div><div class="access_schedule"></div><div class="access_schedule_time_zone"></div><div class="access_exceptions"></div>');if(d=d.elements["p[access_schedule]"]){var b=function(b){var e=$(b).data("access-hours"),d=$(b).data("c-zid"),n=e.ah||[],e=JSON.parse($(b).val()||"{}");b=e.schedule||{};var e=e.exceptDates||{},p=toa.app.model("companySettings").getUser(),s=[],t=[],u=[],v=function(b,c,e){b=toa.date.parseDate(e?e:"iso_long",
b);return toa.date.formatDate(c,b)},w={Mon:r(1669),Tue:r(1670),Wed:r(1671),Thu:r(1672),Fri:r(1673),Sat:r(1674),Sun:r(1675)},x;for(x in n){var y,z;y=n[x][0].split(" ");y[1]=y[1]?y[1]:"00:00:00";z=n[x][1].split(" ");z[1]=z[1]?z[1]:"00:00:00";y=v(y[1],p.dateFormats.time,"time");z=v(z[1],p.dateFormats.time,"time");y===z?t.push(r(13872)):t.push([y+" - "+z])}for(var A in b){x=[];for(var B in b[A].daysOfWeek)x.push(w[b[A].daysOfWeek[B]]);var n=[],D;for(D in b[A].hours)y=b[A].hours[D][0]?b[A].hours[D][0]:
"00:00",z=b[A].hours[D][1]?b[A].hours[D][1]:"00:00",y=v(y+":00",p.dateFormats.time,"time"),z=v(z+":00",p.dateFormats.time,"time"),n.push([y+" - "+z]);s.push(x.join(", ")+": "+n.join(", "))}if(e)for(A in e)u.push(v(e[A],p.dateFormats.date));c[0].innerHTML=t.length?t.join(", "):"";c[1].innerHTML=s.length?s.join("<br />"):"";c[2].innerHTML=d?"("+d+")":"";c[3].innerHTML=u.length?r(15413)+": "+u.join(", "):"";$(".access-schedule-content").html(c)},e=new toa.widgets.accessHoursPopup({input:d,onSave:b.bind(this,
d)});b(d);$(".modify-access-hours").on("click",function(){e.openPopup()})}}
function handlerAccessHours(d){var c=$('<div class="access_hours"></div>');if(d=d.elements["p[access_hours]"]){d=$(d).data("access-hours").ah||[];var b=toa.app.model("companySettings").getUser(),e=[],g=function(b,c,e){b=toa.date.parseDate(e?e:"iso_long",b);return toa.date.formatDate(c,b)},k;for(k in d){var l=d[k][0].split(" ");l[1]=l[1]?l[1]:"00:00:00";var n=d[k][1].split(" ");n[1]=n[1]?n[1]:"00:00:00";d[k][0]=g(l[1],b.dateFormats.time,"time");d[k][1]=g(n[1],b.dateFormats.time,"time");d[k][0]===d[k][1]?
e.push(r(13872)):e.push(d[k].join(" - "))}c[0].innerHTML=e.length?e.join(", "):"";$(".access-hours-content").html(c)}}function handlerDuration(d){d=d.elements;d["p[length]"]&&$(d["p[length]"]).after($("<span>").text(" "+h(74)))}
function handlerTimeToComplete(d,c){var b=d.elements,e,g,k,l,n,p,s,t;if(b["p[time_to_complete]"]){t=c.time_to_complete.multiday_status;e=$(b["p[time_to_complete_hours]"]);g=$(b["p[time_to_complete_minutes]"]);k=$(b["p[isCompleteMultyDay]"]);s=$(".multiday_statuses");s.hide();c.time?c.end_at={default_hours:$(b["p[time_hours]"]).val(),default_mins:$(b["p[time_minutes]"]).val()}:c.suspend_time&&(c.end_at={default_hours:$(b["p[suspend_time_hours]"]).val(),default_mins:$(b["p[suspend_time_minutes]"]).val()});
l=t.start_time;p=t.length-t.finished_duration;c.end_at&&(n=60*parseInt(c.end_at.default_hours)+parseInt(c.end_at.default_mins),n>=l&&(p-=n-l));var u=function(){var c=$(b["p[multiday_activity_status]"]),e=$(b["p[delete_activity]"]);"deleted"==c.val()&&!0==k.prop("checked")?e.prop({checked:!0,disabled:!0}):e.prop("disabled")?e.prop({checked:!1,disabled:!1}):e.prop({disabled:!1})},v=function(){var c=isNaN(parseInt(e.val()))?0:parseInt(e.val()),d=60*c+parseInt(g.val());$(b["p[time_to_complete]"]).val(d);
e.val(c)};e.on("input",v);g.on("change",v);s.on("change",u);k.on("change",function(c){var e=$(d).find(".time_to_complete");$(c.target).prop("checked")?($(b["p[time_to_complete]"]).val(0),e.hide(),s.show()):(v(),e.show(),s.hide());u()});$(b["p[time_to_complete_minutes]"]).find("option:selected").removeAttr("selected");0>=p&&0==t.reopen_action&&t.is_scheduled?($(d).find(".time_to_complete").hide(),$(b["p[time_to_complete_hours]"]).val(0),$(b["p[time_to_complete]"]).val(0),$(b["p[time_to_complete_minutes]"]).find("option:first").prop("selected",
!0).attr("selected","selected"),k.prop("checked",!0),s.show()):(t=Math.floor(p/60),l=p-60*t,l=10>l?"0"+l:""+l,n=5*Math.floor(l/5),n=10>n?"0"+n:""+n,$(b["p[time_to_complete]"]).val(p),$(b["p[time_to_complete_hours]"]).val(t),p=$(b["p[time_to_complete_minutes]"]).find('option[value="'+l+'"]'),void 0===p.val()?$($("<option></option>").attr("value",l).text(l).prop("selected",!0).attr("selected","selected")).insertAfter($(b["p[time_to_complete_minutes]"]).find('option[value="'+n+'"]')):p.prop("selected",
!0).attr("selected","selected"))}}function cgIsShown(){return _DATA.cg&&"-100000px"!=_DATA.cg.style.left?!0:!1}
function cgOpenSection(d,c){d&&c&&(d.form.open_as&&"win"!=d.form.open_as?get_element(c).style.display=d.checked?"":"none":(get_element(c).style.display=d.checked?"":"none",cgShowWindow({width:d.checked?_DATA.cgContent.max_win_width:_DATA.cgContent.win_width,frame_width:_DATA.cgContent.frame_width,height:d.checked?_DATA.cgContent.max_win_height:_DATA.cgContent.win_height,frame_height:_DATA.cgContent.frame_height})))}
function cgDeleteSignature(d,c){$(d).parent().html('<span class="span_link" onclick="cgSign(\''+c+"')\">"+h(8019)+'</span> <input type="hidden" name="p['+c+'_delete]" value="yes" /><span onmousedown="cgUploadNewFile(this, \''+c+'\')" class="span_link">'+h(8021)+"</span>")}
function cgSign(d){var c=window.open("","","width="+screen.width+", height="+screen.height+",top=0,left=0,fullscreen=yes,resizable=no"),b=this.location;d=b.protocol+"//"+b.hostname+b.pathname.replace(/[^\/]*$/,"")+_DATA.resource_folder+"/sign_editor.html#"+d;c.document.open();c.document.write('<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="refresh" content="0;url='+d+"\"><style>html,body{padding:0;margin:0;border:0;width:100%;height:100%;}div{position:absolute;}.t{position:absolute;background-color:#000;opacity:0;filter:alpha(opacity=0);width:100%;height:100%;z-index:10;}</style><script type=\"text/javascript\">var R=30,dt=50,c='#999898',c1='#717171',c2='#717171',c3='#616060';function g(i){return document.getElementById(i)}function p(i){return i==1?12:i-1}function r(i){g('d'+i).style.color=c3;g('d'+p(i)).style.color=c2;g('d'+p(p(i))).style.color=c1;g('d'+p(p(p(i)))).style.color=c;oi=i;i=p(p(p(p(p(p(i))))));g('d'+i).style.color=c3;g('d'+p(i)).style.color=c2;g('d'+p(p(i))).style.color=c1;g('d'+p(p(p(i)))).style.color=c;setTimeout('r('+(oi==12?1:oi+1)+')',50);}window.onload=function(){g('o').style.marginLeft='-'+1.3*R+'px';g('o').style.marginTop='-'+2.4*R+'px';document.body.style.fontWeight='bold';document.body.style.fontSize=dt+'px';document.body.style.color=c;for (var i=1;i<=12;i+=1){g('d'+i).style.left=R+Math.cos(i*(2*Math.PI)/12)*R+'px';g('d'+i).style.top=R+Math.sin(i*(2*Math.PI)/12)*R+'px';}g('c').style.display='block';r(1);}\x3c/script></head><body><div id=\"c\" class=\"t\"></div><div id=\"o\" style=\"top:50%;left:50%;z-index:1;\"\"><div id=\"d1\">.</div><div id=\"d2\">.</div><div id=\"d3\">.</div><div id=\"d4\">.</div><div id=\"d5\">.</div><div id=\"d6\">.</div><div id=\"d7\">.</div><div id=\"d8\">.</div><div id=\"d9\">.</div><div id=\"d10\">.</div><div id=\"d11\">.</div><div id=\"d12\">.</div></div></body></html>");
c.document.close()}function cgUploadNewFile(d,c){d.parentNode.innerHTML='<input type="file" name="p['+c+']" /><input type="hidden" name="p['+c+'_delete]" value="yes" />'}function cgRegisterCalendar(d){var c=$(_DATA.cg).data("all_attached_calendars");c||(c=[]);c.push(d);$(_DATA.cg).data("all_attached_calendars",c)}function cgDestroyCalendars(){var d=$(_DATA.cg).data("all_attached_calendars");if(d){for(var c=0;c<d.length;c++)d[c].destroy();$(_DATA.cg).data("all_attached_calendars","")}}
function cgClose(d){if(d&&d.closeTab){closeAllPopups();if(!toa.contentGenerator.windowContent)return!1;toa.contentGenerator.windowContent.clear();toa.contentGenerator.windowContent.destroy();toa.contentGenerator.windowContent=null;d.isTabRefresh||toa.app.trigger("layout.menu.closeTab",{label:d.closeTab,cancel:d.cancel||!1})}else{if(!_DATA.cg)return;_DATA.cgContent.win_width&&(_DATA.cgContent.win_width=null,_DATA.cgContent.frame_width=null,_DATA.cgContent.win_height=null,_DATA.cgContent.frame_height=
null,_DATA.cgContent.max_win_width&&(_DATA.cgContent.max_win_width=null,_DATA.cgContent.max_win_height=null));cgDestroyCalendars();hide_hint();hide_disabling_cover();$(_DATA.cg).remove();_DATA.cg=null}toa.view.Header.setEnable();app.focusToTheLastSelectedElement&&app.focusToTheLastSelectedElement()}
function cgEntityChange(d){d.value!=defaultValutOfSelect(d)&&(d.form.action=d.form.action.replace(/&entity_type_id=[0-9]+/,"")+"&form_action=entity_type_change&entity_type_id="+d.value,$(d.form).find("button[class*='ightButton']").attr("disabled","disabled"),request({form:d.form,data:{condition_keys:_DATA.cgConditionKeys?_DATA.cgConditionKeys:{}}}),cgDestroyCalendars())}
function get_tab_id(d){do if("tab_content"==d.className||"tab_title"==d.className)return generate_id(d);while(d=d.parentNode);return!1};toa.ns("toa.views.routingRuns.utils",{getUserDateTimeFormat:function(){return toa.app.model("companySettings").getUser().dateFormats},determineTypeOfPlan:function(d){return"automatic"==d.type?"urgent"==d.immediate_algorithm||"scheduled"==d.immediate_algorithm?"immediately":0<d.predecessor_id?"sequentially":-1===d.predecessor_id?"manual":0<d.interval?"recurrent":"onceaday":0<d.predecessor_id?"sequentially":"manual"},fitTextSize:function(d,c,b){var e=$(c),g=e.width();d>g||(e=parseInt(e.css("font-size")),
d=Math.floor(d/g*e*0.95),d>b&&(d=b),$(c).css({"font-size":d,"line-height":d/1.2+"px"}))},secondsToString:function(d,c,b){var e;c||(c="HH h MM min");b||(b="0");var g="";if(!d)return b;0>d&&(g="-",d=Math.abs(d));d=parseInt(d,10);switch(c){case "s":e=d+" "+toa.glossary({id:13113,type:"raw"});break;case "HH:MM:SS":c=Math.floor(d/3600);e=Math.floor((d-3600*c)/60);d=d-3600*c-60*e;e=(10>c?"0"+c:c)+":"+(10>e?"0"+e:e)+":"+(10>d?"0"+d:d);break;case "HH h MM min":c=Math.floor(d/3600);e=Math.floor((d-3600*c)/
60);c=c?c+" "+toa.glossary({id:15456,type:"raw"})+" ":"";e=e?10>e?"0"+e:e:"00";e=e+" "+toa.glossary({id:15457,type:"raw"});e=c+e;break;case "MM min SS sec":e=Math.floor(d/60),d-=60*e,e=e?e+" "+toa.glossary({id:15457,type:"raw"})+" ":"",d=d?d+" "+toa.glossary({id:13113,type:"raw"}):"",e+=d}""===e&&(e=b);return g+e},moneyToString:function(d){var c="";if(null===d||void 0===d)return toa.glossary({id:13132,type:"raw",translations:{"{VALUE}":"--"}});0>d&&(d=Math.abs(d),c="-");d=d.toString().replace(/\B(?=(\d{3})+(?!\d))/g,
",");return c+toa.glossary({id:13132,type:"raw",translations:{"{VALUE}":d}})},percentFormat:function(d){d||(d=0);return parseInt(d,10)},getRandomInt:function(d,c){return Math.floor(Math.random()*(c-d+1))+d},getUniqId:function(d){this.getUniqId.ids=this.getUniqId.ids||{};if(this.getUniqId.ids[d])return this.getUniqId.ids[d];var c=(new Date).getTime()+parseInt(1E5*Math.random(),10);if(!d)return c;this.getUniqId.ids[d]=d+"_"+c;return this.getUniqId.ids[d]},format:function(d,c,b){if(void 0===d||null===
d)return b;if("function"===typeof c)return c.call(null,d);if("string"===typeof c&&c in this)return this.formaters[c].call(null,d);if(Array.isArray(c)&&c.length){var e=c.shift();return this.format(this.format(d,e,b),c,b)}return d},getTranslatedRoutingStatus:function(d){switch(d){case "rolledback":d=toa.glossary({id:13140});break;case "running":d=toa.glossary({id:13134});break;case "scheduled":d=toa.glossary({id:13133});break;case "failed":d=toa.glossary({id:13136});break;case "completed":d=toa.glossary({id:13135});
break;case "skipped":d=toa.glossary({id:19717});break;case "waiting":d=toa.glossary({id:15322});break}return d},getTravelTimeInfoText:function(d,c){return d&&c?"miles"===toa.app.model("companySettings").settings.distance_units?toa.glossary({id:21717,translations:{"{MINUTES}":d,"{DISTANCE}":c}}):toa.glossary({id:21718,translations:{"{MINUTES}":d,"{DISTANCE}":c}}):d?toa.glossary({id:6881,translations:{"[MINUTES]":d}}):c?"miles"===toa.app.model("companySettings").settings.distance_units?toa.glossary({id:21713,
translations:{"{DISTANCE}":c}}):toa.glossary({id:21714,translations:{"{DISTANCE}":c}}):""},convertKmToMiles:function(d){return Math.round(d/1.609344*100)/100},convertMilesToKm:function(d){return Math.round(160.9344*d)/100},_init:function(){this.formaters={secondsToString:this.secondsToString,moneyToString:this.moneyToString};return this}}._init());(function(){toa.ns("toa.views.routingRuns.DataViewBlock",toa.define(null,function(d,c){},{_mapping:{},_setters:{},_createMapping:function(){var d={};this.getContent().find("[data-marker]").each(function(c,b){var e=$(b);d[e.attr("data-marker")]=e});return d},render:function(){this._content=$("<div>").append(this.getWidgetTemplate());this._mapping=this._createMapping();for(var d in this._setters)this._setters.hasOwnProperty(d)&&this._setters[d].call(this,void 0,this._mapping[d]);return this},getContent:function(){return this._content},
update:function(d){for(var c in d)if(d.hasOwnProperty(c))if("function"===typeof this._setters[c])this._setters[c].call(this,d[c],this._mapping[c]);else if(this._mapping.hasOwnProperty(c)){var b=this._mapping[c];if(b.is("input[type=text], textarea")){var e=b.attr("data-initial-value");b.is("[data-initial-value]")&&e!==b.val()||b.val(d[c]);b.attr("data-initial-value",d[c])}else b.text(d[c])}}}))})();(function(){var d=toa.views.routingRuns.DataViewBlock,c=toa.Fliper;toa.ns("toa.views.routingRuns.WidgetTip",toa.define(d,function(b){d.apply(this,arguments);this._data={};b instanceof Array&&(this._position=b)},{_position:["bottom","center"],setData:function(b){this._data=b;this.getContent()&&this.update(b)},render:function(b,e){d.prototype.render.apply(this,arguments);this._widget=e;this.getContent().addClass("routing-vsl-tip").addClass(this.getWidgetClassName()).attr("tabindex","-1").appendTo(b);
this.update(this._data);var g;toa.currentInterface===INTERFACE.MOBILITY?g=this.getMobilityPosition(e):(g=new c({anchor:e,element:this.getContent(),mapPosition:[this._position]}),g=g.getOptimalPosition());this.getContent().css(g.point);this.enableAutoHide()},getMobilityPosition:function(b){var c={},d=b.offset(),k=$(".header-wrapper").height();c.top=parseInt(b.height()+d.top+10-k)+"px";c.left=parseInt(d.left-b.width()/2)+"px";return{point:c}},remove:function(){this.getContent()&&(this.getContent().remove(),
delete this._content);this.disableAutoHide()},disableAutoHide:function(){this._handler&&($(_DATA.dispatcher_container).off("mouseup",this._handler),delete this._handler)},enableAutoHide:function(){this._handler=function(b){b=$(b.target);b.closest(this.getContent()).length||b.closest(".popup").length||b.closest(".activities-error-message-wraper").length||this.remove()}.bind(this);$(_DATA.dispatcher_container).on("mouseup",this._handler)}}));toa.mixin(toa.views.routingRuns.WidgetTip.prototype,toa.mixins.EventEmitter)})();(function(){var d=toa.glossary;toa.ns("toa.views.routingRuns.InfoArea",toa.define(null,function(c,b){this._sandbox=c;this._layout=b;this._data={};this.setResourceId(this._sandbox.get("pid"));this.setDate(this._sandbox.get("date"))},{_setters:{},_isLoading:!1,_templateNoSavings:['<div class="no-runs">',d({id:19810}),"</div>"].join(""),_templateNoBucket:['<div class="no-runs">',d({id:3652}),"</div>"].join(""),render:function(){this.remove();this._content=$(this.getInfoAreaTemplate());this.getContent().addClass(this.getInfoAreaClassName()).appendTo(this.getLayout().getInfoAreaContainer());
this._preRender();this.setValues();return this},renderNoBucketTemplate:function(){this.remove();this._content=$(this._templateNoBucket);this.getContent().appendTo(this.getLayout().getInfoAreaContainer())},remove:function(){this.getLayout()._wrap.removeClass();this.getLayout()._wrap.addClass("routing-visualisation");if(this.getContent()){var c=this.getContent()[0];c&&!c.hasAttribute("data-bind")&&(this.getContent().remove(),delete this._content)}$("div.routing-vsl-info-area").children().each(function(){this.hasAttribute("data-bind")?
$(this).hide():$(this).remove()})},isLoading:function(){return this._isLoading},getContent:function(){return this._content},getLayout:function(){return this._layout},setResourceId:function(c){this._resourceId=parseInt(c,10)},setData:function(c){this._data=c},getResourceId:function(){return this._resourceId},setDate:function(c){this._date=c},getDate:function(){return this._date},setAccess:function(c){this.getLayout().setAccess(c)},getAccess:function(c){return this.getLayout().getAccess(c)},getInfoAreaClassName:function(){},
getInfoAreaTemplate:function(){},showAlert:function(c){this._isLoading=!1;this.getLayout().showAlert(c)},_preRender:function(){this._mapping=this._createMapping();for(var c in this._setters)this._setters.hasOwnProperty(c)&&this._mapping.hasOwnProperty(c)&&this._setters[c].call(this,void 0,this._mapping[c])},_createMapping:function(){var c={};this.getContent().find("[data-marker]").each(function(b,e){var d=$(e);c[d.attr("data-marker")]=d});return c},setValues:function(){for(var c in this._data)if(this._data.hasOwnProperty(c))if("function"===
typeof this._setters[c])this._setters[c].call(this,this._data[c],this._mapping[c]);else if(this._mapping.hasOwnProperty(c)){var b=this._mapping[c];if(b.is("input[type=text], textarea")){var e=b.attr("data-initial-value");b.is("[data-initial-value]")&&e!==b.val()||b.val(this._data[c]);b.attr("data-initial-value",this._data[c])}else b.text(this._data[c])}}}));toa.mixin(toa.views.routingRuns.InfoArea.prototype,toa.mixins.EventEmitter)})();(function(){var d=toa.views.routingRuns.DataViewBlock;toa.ns("toa.views.routingRuns.Widget",toa.define(d,function(c,b){d.apply(this,arguments);this._sandbox=c;this._layout=b;this._data={};this.setResourceId(this._sandbox.get("pid"));this.setDate(this._sandbox.get("date"))},{_updateIntervalTime:6E5,_isLoading:!1,_isCurrent:!1,updateState:function(c,b){this.setResourceId(c);this.setDate(b);this.requestData()},render:function(){d.prototype.render.apply(this,arguments);this.getContent().addClass("routing-tab-item-wrapper").addClass(this.getWidgetClassName()).appendTo(this._layout.getWidgetsContainer());
this.isCurrent()&&this.getContent().addClass("current-widget-corner");this.getInfoArea()&&(this.getContent().addClass("has-info-area"),this.getContent().on("click",function(c){$(c.currentTarget).hasClass("plans-execution-summary")?this._sandbox.trigger("routing.runs.update.all.widgets"):this._sandbox.trigger(this.toString()+"_request_data");this._sandbox.trigger("set.current.routing.widget",{widgetName:this.toString()})}.bind(this)));this.enableAutoUpdate();return this},enableAutoUpdate:function(){this._updateInterval||
(this._updateInterval=setInterval(this.requestData.bind(this),this._updateIntervalTime))},disableAutoUpdate:function(){this._updateInterval&&(clearInterval(this._updateInterval),delete this._updateInterval)},update:function(c){d.prototype.update.apply(this,arguments);for(var b in c)c.hasOwnProperty(b)&&(this._data[b]=c[b]);this.getInfoArea()&&this.getInfoArea().setData(this._data);this.getTip()&&this.getTip().setData(this._data);this.isCurrent()&&this._sandbox.trigger(this.toString()+"_request_data")},
handleReceivedData:function(c){d.prototype.update.apply(this,arguments);for(var b in c)c.hasOwnProperty(b)&&(this._data[b]=c[b]);this.getInfoArea()&&this.getInfoArea().setData(this._data);this.isCurrent()&&this.getInfoArea().render()},setCurrent:function(c){this._isCurrent=c},isCurrent:function(){return this._isCurrent},resetCurrent:function(){this._isCurrent=!1},isLoading:function(){return this._isLoading},setResourceId:function(c){this.getInfoArea()&&this.getInfoArea().setResourceId(c);this._resourceId=
c},getResourceId:function(){return this._resourceId},setDate:function(c){this.getInfoArea()&&this.getInfoArea().setDate(c);this._date=c},getDate:function(){return this._date},setTip:function(c){},getTip:function(){},setInfoArea:function(c){},getInfoArea:function(){},getWidgetClassName:function(){},getWidgetTemplate:function(){},requestData:function(){},showAlert:function(c){this._isLoading=!1;this._layout.showAlert(c)}}))})();(function(){var d=toa.views.routingRuns.utils,c=toa.glossary,b=(new toa.Template(['<div class="vsl-details-wrapper center">','   <div class="vsl-details-widget-left"><%=routing_run_details%></div>','   <div class="vsl-details-widget-right"><%=routing_run_details_general%></div>',"</div>"])).compile(),e=(new toa.Template('<div class="vsl-details-wrapper">;   <div class="vsl-details-widget-short">;       <div class="vsl-details-widget-short-wrapper">;           <%=immediate_routing_details%>;       </div>;   </div>;</div>'.split(";"))).compile(),
g=new toa.Template('<div class="vsl-title vsl-savings" title="<%=total_savings_label%>"><%=total_savings_label%></div>;<div class="vsl-total-savings"><%-total_savings_money%></div>;<%if(permission && visibility){%>;<div class="vsl-button <%=roll_back_button_class%> <%=visibility%>" id="vsl-roll-back-button">;   <span class="vsl-button-text"><%-roll_back_button_text%></span>;</div>;<%}%>'.split(";")),k=new toa.Template('<div class="vsl-title vsl-savings" title="<%=total_savings_label%>"><%=total_savings_label%></div>;<div id="vsl-rounded-progress"></div>;<%if(permission){%>;<div class="vsl-button" id="vsl-stop-button">;   <span class="vsl-button-text"><%=stop_button_text%></span>;</div>;<%}%>'.split(";")),
l=(new toa.Template(['<div class="vsl-details-widget-title"><%=title%></div>','<div class="vsl-details-widget-type"><%=routing_plan_name%></div>'])).compile(),n=new toa.Template('<div class="vsl-right-wrapper">;   <div class="vsl-row" data-item="routing-run-time">;       <div class="vsl-lcol-details">;           <div class="vsl-left-col overflow" title="<%=routing_run_time_label%>">;               <%=routing_run_time_label%>;           </div>;       </div>;       <div class="vsl-right-col" id="vsl-run-time" title="<%=routing_run_time%>"><%=routing_run_time%></div>;   </div>;   <div class="vsl-delimiter"></div>;<%if(size_of_multiday > 1) {%>;   <div class="vsl-row vsl-col-grey" data-item="size-of-multiday">;       <div class="vsl-left-col"><%=multiday_label%></div>;       <div class="vsl-right-col"><%=size_of_multiday%></div>;   </div>;<% } %>;   <div class="vsl-row vsl-col-grey" data-item="technitians">;       <div class="vsl-left-col"><%=technitians_label%></div>;       <div class="vsl-right-col"><%=technitians%></div>;   </div>;   <div class="vsl-row vsl-col-grey" data-item="activities">;       <div class="vsl-left-col"><%=activity_label%></div>;       <div class="vsl-right-col"><%=activities%></div>;   </div>;   <div class="vsl-delimiter"></div>;   <div class="vsl-title"><%=savings_label%></div>;   <div class="vsl-row" data-item="work-time-o10n-savings">;       <div class="vsl-left-col"><%=work_time_o10n_savings_label%></div>;       <div class="vsl-right-col"><%-work_time_o10n_savings%></div>;   </div>;   <div class="vsl-row" data-item="overtime-o10n-savings">;       <div class="vsl-left-col"><%=overtime_o10n_savings_label%></div>;       <div class="vsl-right-col"><%-overtime_o10n_savings%></div>;   </div>;   <div class="vsl-row" data-item="travel-time-o10n-savings">;       <div class="vsl-left-col"><%=travel_time_o10n_savings_label%></div>;       <div class="vsl-right-col"><%-travel_time_o10n_savings%></div>;   </div>;   <div class="vsl-delimiter"></div>;   <%=total_savings%>;</div>'.split(";")),
p=new toa.Template('<div class="vsl-row vsl-subrow" data-item="not-assigned-reasons-count">;   <div class="vsl-lcol-details">;       <div class="vsl-left-col"><%-label%></div>;   </div>;   <div class="vsl-right-col"><%=count%></div>;</div>'.split(";")),s=(new toa.Template('<div class="vsl-left-wrapper">;   <div class="vsl-row" data-item="technitians-used">;       <div class="vsl-lcol-details">;           <div class="vsl-left-col"><%=technitians_used_label%></div>;       </div>;       <div class="vsl-right-col"><%=technitians_used%></div>;   </div>;   <div class="vsl-row" data-item="routed-activities">;       <div class="vsl-lcol-details">;           <div class="vsl-left-col"><%=routed_activities_label%></div>;           <div class="vsl-left-col vsl-extra-details"><%=routed_activities_label_details%></div>;       </div>;       <div class="vsl-right-col"><%=routed_activities%></div>;   </div>;   <div class="vsl-row" data-item="non-routed-activities">;       <div class="vsl-lcol-details">;           <div class="vsl-left-col"><%=non_routed_activities_label%></div>;       </div>;       <div class="vsl-right-col"><%=non_routed_activities%></div>;   </div>;   <%=routing_failure_reasons%>;   <div class="vsl-delimiter"></div>;   <div class="vsl-row" data-item="avr-working-time">;       <div class="vsl-lcol-details">;           <div class="vsl-left-col"><%=avr_working_time_label%></div>;           <div class="vsl-left-col vsl-extra-details"><%=avr_working_time_details_label%></div>;       </div>;       <div class="vsl-right-col"><%=avr_working_time%></div>;   </div>;   <div class="vsl-row" data-item="avr-overtime">;       <div class="vsl-lcol-details">;           <div class="vsl-left-col"><%=avr_overtime_label%></div>;           <div class="vsl-left-col vsl-extra-details"><%=avr_overtime_details_label%></div>;       </div>;       <div class="vsl-right-col"><%=avr_overtime%></div>;   </div>;   <div class="vsl-row" data-item="avr-travel-time">;       <div class="vsl-lcol-details">;           <div class="vsl-left-col"><%=avr_travel_time_label%></div>;           <div class="vsl-left-col vsl-extra-details"><%=avr_travel_time_details_label%></div>;       </div>;       <div class="vsl-right-col"><%=avr_travel_time%></div>;   </div>;   <div class="vsl-row" data-item="avr-down-time">;       <div class="vsl-lcol-details">;           <div class="vsl-left-col"><%=avr_down_time_label%></div>;       </div>;       <div class="vsl-right-col"><%=avr_down_time%></div>;   </div>;   <div class="vsl-row" data-item="avr-mileage">;       <div class="vsl-lcol-details">;           <div class="vsl-left-col"><%=avr_mileage_label%></div>;       </div>;       <div class="vsl-right-col"><%=avr_mileage%></div>;   </div>;   <div class="vsl-row" data-item="resource-utilization">;       <div class="vsl-lcol-details">;           <div class="vsl-left-col"><%=resource_utilization_label%></div>;       </div>;       <div class="vsl-right-col"><%=resource_utilization%></div>;   </div>;</div>'.split(";"))).compile(),
t=(new toa.Template('<div class="vsl-row" data-item="time-of-run">;   <div class="vsl-lcol-details">;           <div class="vsl-left-col"><%=time_of_run_label%></div>;   </div>;   <div class="vsl-right-col"><%=time_of_run%></div>;</div>;<div class="vsl-delimiter"></div>;<div class="vsl-row" data-item="technitians-used">;   <div class="vsl-lcol-details">;       <div class="vsl-left-col"><%=technitians_used_label%></div>;   </div>;   <div class="vsl-right-col"><%=technitians_used%></div>;</div>;<div class="vsl-delimiter"></div>;<div class="vsl-row" data-item="assigned-activities">;   <div class="vsl-lcol-details">;       <div class="vsl-left-col"><%=assigned_activities_label%></div>;   </div>;   <div class="vsl-right-col"><%=assigned_activities%></div>;</div>;<div class="vsl-row" data-item="bundled-activities">;   <div class="vsl-lcol-details">;       <div class="vsl-left-col"><%=bundled_activities_label%></div>;   </div>;   <div class="vsl-right-col"><%=bundled_activities%></div>;</div>;<div class="vsl-row" data-item="non-routed-activities">;   <div class="vsl-lcol-details">;       <div class="vsl-left-col"><%=non_routed_activities_label%></div>;   </div>;   <div class="vsl-right-col"><%=non_routed_activities%></div>;</div>;<%if(permission && visibility && showButton){%>;<div class="vsl-button vsl-roll-back-button-large vsl-button-short-template <%=visibility%>" id="vsl-roll-back-button">;   <span class="vsl-button-text"><%-roll_back_button_text%></span>;</div>;<%}%>'.split(";"))).compile(),
u=(new toa.Template('<div class="vsl-row" data-item="time-of-run">;   <div class="vsl-lcol-details">;       <div class="vsl-left-col"><%=time_of_run_label%></div>;   </div>;   <div class="vsl-right-col"><%=time_of_run%></div>;</div>;<div class="vsl-delimiter"></div>;<div class="vsl-row" data-item="technitians-used">;   <div class="vsl-lcol-details">;       <div class="vsl-left-col"><%=technitians_used_label%></div>;   </div>;   <div class="vsl-right-col"><%=technitians_used%></div>;</div>;<div class="vsl-delimiter"></div>;<div class="vsl-row" data-item="assigned-activities">;   <div class="vsl-lcol-details">;       <div class="vsl-left-col"><%=assigned_activities_label%></div>;   </div>;   <div class="vsl-right-col"><%=assigned_activities%></div>;</div>;<div class="vsl-row" data-item="assigned-bundled-activities">;   <div class="vsl-lcol-details">;       <div class="vsl-left-col"><%=assigned_bundled_activities_label%></div>;   </div>;   <div class="vsl-right-col"><%=assigned_bundled_activities%></div>;</div>;<div class="vsl-row" data-item="bundled-activities">;   <div class="vsl-lcol-details">;       <div class="vsl-left-col"><%=bundled_activities_label%></div>;   </div>;   <div class="vsl-right-col"><%=bundled_activities%></div>;</div>;<div class="vsl-row" data-item="non-routed-activities">;   <div class="vsl-lcol-details">;       <div class="vsl-left-col"><%=non_routed_activities_label%></div>;   </div>;   <div class="vsl-right-col"><%=non_routed_activities%></div>;</div>;<%if(permission && visibility && showButton){%>;<div class="vsl-button vsl-roll-back-button-large vsl-button-short-template <%=visibility%>" id="vsl-roll-back-button">;   <span class="vsl-button-text"><%-roll_back_button_text%></span>;</div>;<%}%>'.split(";"))).compile(),
v=(new toa.Template('<div class="vsl-puzzles">;<div class="vsl-puzzles-line vsl-puzzles-line1">;<div class="vsl-puzzle vsl-puzzle1 vsl-hide vsl-hide-right">;<span class="vsl-top"></span>;<span class="vsl-right"></span>;<span class="vsl-bottom"></span>;<span class="vsl-left"></span>;<span class="vsl-text"></span>;<div class="vsl-img-div"></div>;</div><div class="vsl-puzzle vsl-puzzle2 vsl-hide vsl-hide-bottom">;<span class="vsl-top"></span>;<span class="vsl-right"></span>;<span class="vsl-bottom"></span>;<span class="vsl-left"></span>;<span class="vsl-text"></span>;<div class="vsl-img-div"></div>;</div><div class="vsl-puzzle vsl-puzzle3 vsl-hide-left vsl-hide-right vsl-hide">;<span class="vsl-top"></span>;<span class="vsl-right"></span>;<span class="vsl-bottom"></span>;<span class="vsl-left"></span>;<span class="vsl-text"></span>;<div class="vsl-img-div"></div>;</div><div class="vsl-puzzle vsl-puzzle4 vsl-hide">;<span class="vsl-top"></span>;<span class="vsl-right"></span>;<span class="vsl-bottom"></span>;<span class="vsl-left"></span>;<span class="vsl-text"></span>;<div class="vsl-img-div"></div>;</div>;</div><div class="vsl-puzzles-line vsl-puzzles-line2">; <div class="vsl-puzzle vsl-puzzle1 vsl-hide vsl-hide-top vsl-hide-bottom vsl-hide-right">;<span class="vsl-top"></span>;<span class="vsl-right"></span>;<span class="vsl-bottom"></span>;<span class="vsl-left"></span>;<span class="vsl-text"></span>;<div class="vsl-img-div"></div>;</div><div class="vsl-puzzle vsl-puzzle2 vsl-hide">;<span class="vsl-top"></span>;<span class="vsl-right"></span>;<span class="vsl-bottom"></span>;<span class="vsl-left"></span>;<span class="vsl-text"></span>;<div class="vsl-img-div"></div>;</div><div class="vsl-puzzle vsl-puzzle3 vsl-hide vsl-hide-bottom vsl-hide-top vsl-hide-right vsl-hide-left">; <span class="vsl-top"></span>;<span class="vsl-right"></span>;<span class="vsl-bottom"></span>;<span class="vsl-left"></span>;<span class="vsl-text"></span>;<div class="vsl-img-div"></div>; </div><div class="vsl-puzzle vsl-puzzle4 vsl-hide vsl-hide-top vsl-hide-bottom ">;<span class="vsl-top"></span>;<span class="vsl-right"></span>;<span class="vsl-bottom"></span>;<span class="vsl-left"></span>;<span class="vsl-text"></span>;<div class="vsl-img-div"></div>;</div>;</div><div class="vsl-puzzles-line vsl-puzzles-line3">; <div class="vsl-puzzle vsl-puzzle1 vsl-hide vsl-hide-right">;<span class="vsl-top"></span>;<span class="vsl-right"></span>;<span class="vsl-bottom"></span>;<span class="vsl-left"></span>;<span class="vsl-text"></span>;<div class="vsl-img-div"></div>;</div><div class="vsl-puzzle vsl-puzzle2 vsl-hide vsl-hide-top vsl-hide-bottom">; <span class="vsl-top"></span>;<span class="vsl-right"></span>;<span class="vsl-bottom"></span>;<span class="vsl-left"></span>;<span class="vsl-text"></span>;<div class="vsl-img-div"></div>;</div><div class="vsl-puzzle vsl-puzzle3 vsl-hide vsl-hide-bottom vsl-hide-left">; <span class="vsl-top"></span>;<span class="vsl-right"></span>;<span class="vsl-bottom"></span>;<span class="vsl-left"></span>;<span class="vsl-text"></span>;<div class="vsl-img-div"></div>;</div><div class="vsl-puzzle vsl-puzzle4 vsl-hide vsl-hide-left">;<span class="vsl-top"></span>;<span class="vsl-right"></span>;<span class="vsl-bottom"></span>;<span class="vsl-left"></span>;<span class="vsl-text"></span>;<div class="vsl-img-div"></div>;</div>;</div><div class="vsl-puzzles-line vsl-puzzles-line4">;<div class="vsl-puzzle vsl-puzzle1 vsl-hide vsl-hide-top">;<span class="vsl-top"></span>;<span class="vsl-right"></span>;<span class="vsl-bottom"></span>;<span class="vsl-left"></span>;<span class="vsl-text"></span>;<div class="vsl-img-div"></div>;</div><div class="vsl-puzzle vsl-puzzle2 vsl-hide vsl-hide-left vsl-hide-right">;<span class="vsl-top"></span>;<span class="vsl-right"></span>;<span class="vsl-bottom"></span>;<span class="vsl-left"></span>;<span class="vsl-text"></span>;<div class="vsl-img-div"></div>;</div><div class="vsl-puzzle vsl-puzzle3 vsl-hide vsl-hide-right">;<span class="vsl-top"></span>;<span class="vsl-right"></span>;<span class="vsl-bottom"></span>;<span class="vsl-left"></span>;<span class="vsl-text"></span>;<div class="vsl-img-div"></div>;</div><div class="vsl-puzzle vsl-puzzle4 vsl-hide vsl-hide-top">;<span class="vsl-top"></span>;<span class="vsl-right"></span>;<span class="vsl-bottom"></span>;<span class="vsl-left"></span>;<span class="vsl-text"></span>;<div class="vsl-img-div"></div>;</div>;</div>;</div>'.split(";"))).compile();
toa.ns("toa.views.routingRuns.runDetails.RunSummaryDetails",toa.define(null,function(b){this._sandbox=b;this.baseClass=null;this.runId=0;this.onGetRoutingReport=this.onGetRoutingReport.bind(this);this.addListener("switch-to-routing-tab-summary-details",function(b,c){c.getContentContainer().empty();c.getTabsContainer().find("li").removeClass("selected");c.getTabsContainer().find("li."+this.tabLabel).addClass("selected");this.render()}.bind(this));this._sandbox.bind("routing.run.popup.has.been.closed",
function(){this.destroy()}.bind(this))},{firstRun:!0,tabLabel:"summary-details",tabTemplate:'<li class="summary-details hidden">'+c({id:15444})+"</li>",renderTab:function(b){this.baseClass=b;this.runId=b.runId;return $(this.tabTemplate).off().click(function(){this.firstRun=!0;this.notify("switch-to-routing-tab-summary-details",this.baseClass)}.bind(this))},render:function(){var b=this.baseClass.data.routing_details||this.baseClass.data;if(this.popup=this.baseClass.getPopup()){this.routing_plan_name=
b.plan_name;this.routingPlanId=b.plan_id;this.routing_type=b.type;this.rollbackId=b.rollback_id||b.rollback_action_id;this.undoRollbackId=b.undorollback_id||b.undo_rollback_action_id;this.status=b.status;this.detailsRequest=b.detailsRequest||!1;this.extraData=b;this.routingNotAssignReasons=c({page:"appt_move_log_result_code",type:"raw"});b.isSequence&&(this.isSequenceCount=1);this.routing_type="automatic"===b.type?c({id:13076}):"manual"===b.type?c({id:13077}):"";if("scheduled"!=this.runId)this._getRoutingReport();
else return this.showShortRoutingRunInfo(b),this;"completed"!==this.status&&"running"!==this.status&&"waiting"!==this.status&&this.popup.setWidth(500);b=d.determineTypeOfPlan(this.extraData);"completed"===this.status&&"immediately"===b&&this.popup.setWidth(500);this.popup.setWidth(900);this.popup.setPositionCenter();this.popup.recalculateHeight();return this}},destroy:function(){this.popup.destroy();this.puzzlesAnimationIntervalId&&(clearInterval(this.puzzlesAnimationIntervalId),this.puzzlesAnimationIntervalId=
null);this.routingRunTimeoutId&&(clearTimeout(this.routingRunTimeoutId),this.routingRunTimeoutId=null);this.routingRunTimeIntervalId&&(clearInterval(this.routingRunTimeIntervalId),this.routingRunTimeIntervalId=null)},stopRoutingRun:function(){this._sandbox.trigger("global.data.get",{controller:"Routingvisualization",method:"stopRouting",params:{routingPlanId:this.routingPlanId,bucketId:this.bucketId},responseHandler:function(b,c){"routing_run_list"!==c.screen?this._sandbox.trigger("global.interface.refresh"):
this._sandbox.trigger("routing.runs.update.all.widgets")}.bind(this),errorHandler:function(b){this.baseClass.showAlert(b);return!1}.bind(this)});this.destroy()},rollBackRoutingRun:function(){toa.ui.Confirm({text:c({id:5319}),acceptButtonHandler:function(){var b=this.runId;0<parseInt(this.rollbackId)&&0==parseInt(this.undoRollbackId)&&(b=this.rollbackId);this._sandbox.trigger("global.data.get",{controller:"Routingvisualization",method:"rollbackRouting",params:{runId:b},responseHandler:function(b,c){"routing_run_list"!==
c.screen?this._sandbox.trigger("global.interface.refresh"):this._sandbox.trigger("routing.runs.update.all.widgets")}.bind(this),errorHandler:function(b){this.baseClass.showAlert(b);return!1}.bind(this)});this.destroy()}.bind(this)})},animatePuzzles:function(){for(var b=[],c=$(".vsl-puzzles-line").length||0,e=0;e<c;e++){b[e]=[];for(var d=$(".vsl-puzzles-line"+(e+1)+" .vsl-puzzle"),g=0;g<d.length;g++)b[e].push(new toa.views.routingRuns.widgets.puzzle(d[g],"vsl-"))}this.scenarios=new toa.views.routingRuns.widgets.scenarios({puzzles:b,
technitians:this.technitians,colors:"green yellow orange red magenta magenta2 blue skyblue".split(" "),images:"img-filter img-flag img-group img-links img-location img-money img-route img-settings img-time".split(" "),runDetailsObject:this});this.puzzlesAnimationIntervalId=this.scenarios.run()},showShortRoutingRunInfo:function(b){this.popup.setTitleHtml(l.apply({title:this.routing_type,routing_plan_name:c({id:15318,translations:{"{ROUTING_PLAN_NAME}":this.routing_plan_name,"{ROUTING_PLAN_ID}":"scheduled"===
this.runId?"":this.runId}})}));this.popup.setWidth(500);this.baseClass.getContainer().addClass("short");var e=toa.app.model("companySettings").getUser().tz_diff,g=d.getUserDateTimeFormat();if(b.status){var k=b.bucket_time_zone_diff||0,e=toa.date.parseDate("iso_long",b.end_time),n=e.getTime()+6E4*k,e=new Date(n),n=toa.date.parseDate("iso_long",b.start_time),n=n.getTime()+6E4*k,n=new Date(n);if(b.error_message){if(k='<div class="vsl-row" data-item="error-message"><div class="vsl-left-col" title="'+
c({id:15434})+'">'+c({id:15434})+':</div><div class="vsl-right-col">'+b.error_message+"</div></div>",b.left_in_bucket)for(var p in b.left_in_bucket)b.left_in_bucket.hasOwnProperty(p)&&this.routingNotAssignReasons[p]&&(k+='<div class="vsl-row" data-item="errors-'+p+'"><div class="vsl-left-col" title="'+this.routingNotAssignReasons[p]+'">'+this.routingNotAssignReasons[p]+':</div><div class="vsl-right-col">'+b.left_in_bucket[p]+"</div></div>")}else k="";this.baseClass.getContentContainer().empty().append('<div class="vsl-details-wrapper center">   <div class="short-details-wrapper">       <div class="vsl-row" data-item="bucket-name">           <div class="vsl-left-col" title="'+
c({id:13160})+'">'+c({id:13160})+'</div>           <div class="vsl-right-col">'+toa.toHtml(this.extraData.bucket_name)+'</div>       </div>       <div class="vsl-row" data-item="routing-run-status">           <div class="vsl-left-col" title="'+c({id:13161})+'">'+c({id:13161})+'</div>           <div class="vsl-right-col">'+d.getTranslatedRoutingStatus(b.status)+"</div>       </div>"+k+'       <div class="vsl-row" data-item="routing-run-start-time">           <div class="vsl-left-col" title="'+c({id:13162})+
'">'+c({id:13162})+'</div>           <div class="vsl-right-col">'+toa.date.formatDate(g.date_time,n)+'</div>       </div>       <div class="vsl-row" data-item="routing-run-end-time">           <div class="vsl-left-col" title="'+c({id:13163})+'">'+c({id:13163})+':</div>           <div class="vsl-right-col">'+toa.date.formatDate(g.date_time,e)+"</div>       </div>   </div></div>")}else"scheduled"===this.extraData.status&&(b=toa.date.parseDate("iso_long",this.extraData.timestamp),b=toa.date.create(b.getTime(),
e),this.baseClass.getContentContainer().empty().append('<div class="vsl-details-wrapper center">   <div class="short-details-wrapper">       <div class="vsl-row" data-item="scheduled-backet-name">           <div class="vsl-left-col" title="'+c({id:13160})+'">'+c({id:13160})+'</div>           <div class="vsl-right-col">'+this.extraData.bucket_name+'</div>       </div>       <div class="vsl-row" data-item="scheduled-routing-run-status">           <div class="vsl-left-col" title="'+c({id:13161})+'">'+
c({id:13161})+'</div>           <div class="vsl-right-col">'+d.getTranslatedRoutingStatus(this.extraData.status)+'</div>       </div>       <div class="vsl-row" data-item="scheduled-routing-run-scheduled-on">           <div class="vsl-left-col" title="'+c({id:13164})+'">'+c({id:13164})+'</div>           <div class="vsl-right-col">'+toa.date.formatDate(g.date_time,b)+"</div>       </div>   </div></div>"));this.baseClass.getTabsContainer().remove();this._showPopup("running")},onGetRoutingReport:function(w,
x,y){"undefined"!==typeof x.tabs_info&&this.baseClass.showTabs(x.tabs_info);w=x.routing_details;toa.app.model("companySettings").getUser();y=toa.date.isDateNotArchived(w.rpelassignment_to,toa.app.model("User").get("tz_diff"));var z,A;this.access=this.baseClass.getAccess("routing_execution_summary_widget");this.data=w;if(1!==this.isSequenceCount&&("running"==this.status||"waiting"==this.status)&&"completed"==w.status&&(this.status="completed",this.baseClass.notify("run has been completed",{screen:x.screen}),
"scenarios"in this)){this.scenarios.finishPuzzle=!0;this.scenarios.partitionScenariousStep(x);return}this.technitians=w.children;this.bucketId=w.bucket_id;if("failed"===w.status||"stopped"===w.status||"skipped"===w.status)this.showShortRoutingRunInfo(w),this.baseClass.notify("run has been completed",{screen:x.screen});else{if(1!==this.isSequenceCount&&("skipped"===w.status||"running"!==w.status&&"waiting"!==w.status&&0==w.used_activities||"scheduled"===w.status||"scheduled"===this.extraData.status||
w.error_message&&"undefined"!==typeof w.error_message&&""!==w.error_message||"completed"===w.status||"rolledback"===w.status)){A=0!=parseInt(this.rollbackId)&&0==parseInt(this.undoRollbackId)?c({id:15031,type:"raw"}):c({id:13078,type:"raw"});z=g.apply({roll_back_button_text:A,roll_back_button_class:"vsl-roll-back-button-large",permission:2===this.access,visibility:y,apply_button_text:c({id:13079}),total_savings_label:c({id:13080}),total_savings_money:d.format(w.savings_total,[Math.floor,"moneyToString"],
"")});A="";var B=0;if(w.left_in_bucket){for(var D in w.left_in_bucket)w.left_in_bucket.hasOwnProperty(D)&&this.routingNotAssignReasons[D]&&(A+=p.apply({label:this.routingNotAssignReasons[D],count:w.left_in_bucket[D]}),B+=parseInt(w.left_in_bucket[D]));"undefined"!==typeof w.dynamic_cut_count&&w.dynamic_cut_count&&(A+=p.apply({label:c({id:13225}),count:w.dynamic_cut_count}),B+=w.dynamic_cut_count)}D=parseInt(w.average_mileage,10);B=c({id:10858});"miles"===toa.app.model("companySettings").settings.distance_units&&
(B=c({id:10857}));A=s.apply({technitians_used:w.used_resources,technitians_used_label:c({id:13081}),routed_activities_label:c({id:13082}),routed_activities_label_details:h(13086,{"{USED_ACTIVITIES_PERCENT}":d.percentFormat(w.used_activities_percent),"{SLA_OVERDUE_PERCENT}":d.percentFormat(w.sla_overdue_percent)}),routed_activities:w.used_activities,non_routed_activities_label:c({id:13083}),non_routed_activities:w.rgt_unrouted,routing_failure_reasons:A,unacceptable_travel_time_label:c({id:13088}),
unacceptable_travel_time:w.raw_not_assigned_activities_unacceptable_travel_time||0,show_unacceptable_travel_time:0!=(w.raw_not_assigned_activities_unacceptable_travel_time||0),avr_working_time_label:c({id:13091}),avr_working_time_details_label:h(13092,{"{AVERAGE_WORK_TIME_PERCENT}":d.percentFormat(w.average_work_time_percent)}),avr_working_time:d.secondsToString(60*w.average_work_time),avr_overtime_label:c({id:13093}),avr_overtime_details_label:h(13094,{"{AVERAGE_OVERTIME_PERCENT}":d.percentFormat(w.average_overtime_percent)}),
avr_overtime:d.secondsToString(60*w.average_overtime),avr_travel_time_label:c({id:13095}),avr_travel_time_details_label:h(13096,{"{AVERAGE_TRAVEL_TIME_PERCENT}":d.percentFormat(w.average_travel_time_percent)}),avr_travel_time:d.secondsToString(60*w.average_travel_time),avr_down_time_label:c({id:13097}),avr_down_time:d.secondsToString(60*w.average_waiting_time),avr_mileage_label:c({id:15482}),avr_mileage:D+" "+B,resource_utilization_label:c({id:13098}),resource_utilization:c({id:15321,translations:{"{VALUE}":d.percentFormat(w.resource_utilization)}})});
this.puzzlesAnimationIntervalId&&(clearInterval(this.puzzlesAnimationIntervalId),this.puzzlesAnimationIntervalId=null);B=w.duration||0;B=d.secondsToString(B,"MM min SS sec",c({id:13099}));"completed"!==this.status&&this.baseClass.notify("run has been completed",{screen:x.screen})}else if(1===this.isSequenceCount||"running"===w.status||"waiting"===w.status)this.isSequenceCount++,this.routingRunTimeoutId=window.setTimeout(function(){this._sandbox.trigger("global.data.get",{controller:"Routingvisualization",
method:"getRoutingRunInfo",params:{runId:Number(this.runId)},responseHandler:this.onGetRoutingReport,errorHandler:function(b){this.baseClass.showAlert(b);return!1}.bind(this)})}.bind(this),1E3),z=k.apply({stop_button_text:c({id:13100}),total_savings_label:c({id:13101}),permission:2===this.access}),B="waiting"!==w.status?d.secondsToString(w.duration,"MM min SS sec"):c({id:15322});x=d.format(w.savings_working_time_optimization,[Math.floor,"moneyToString"],"");D=d.format(w.savings_overtime_optimization,
[Math.floor,"moneyToString"],"");var C=d.format(w.savings_travel_time_optimization,[Math.floor,"moneyToString"],"");z=n.apply({total_savings:z,technitians_label:c({id:13102}),technitians:w.resources,activities:w.activities,activity_label:c({id:13103}),savings_label:"completed"===w.status?c({id:13104}):c({id:13105}),work_time_o10n_savings_label:c({id:13106}),work_time_o10n_savings:x,overtime_o10n_savings_label:c({id:13107}),overtime_o10n_savings:D,travel_time_o10n_savings_label:c({id:13108}),travel_time_o10n_savings:C,
routing_run_time_label:c({id:13109}),routing_run_time:B,multiday_label:c({id:18826}),size_of_multiday:w.size_of_multiday});if("running"!==w.status&&"waiting"!==w.status)B=w.bucket_time_zone_diff||0,x=toa.app.model("companySettings").getUser().dateFormats.time,D=toa.date.parseDate("iso_long",w.end_time),C=D.getTime()+6E4*B,D=new Date(C),C=toa.date.parseDate("iso_long",w.start_time),C=C.getTime()+6E4*B,C=new Date(C),"immediately"===d.determineTypeOfPlan(w)?(A=w.sub_type&&"broadcast"===w.sub_type?!1:
!0,A={time_of_run:toa.date.formatDate(x,C)+" - "+toa.date.formatDate(x,D),time_of_run_label:c({id:15428}),technitians_used:c({id:12240,translations:{"{ITEM1}":w.used_resources,"{ITEM2}":w.resources}}),technitians_used_label:c({id:13081}),assigned_activities:w.rgt_assigned||0,assigned_activities_label:c({id:15425}),assigned_bundled_activities:w.rgt_bundled_with_assign||0,assigned_bundled_activities_label:c({id:15426}),bundled_activities:w.rgt_bundled||0,bundled_activities_label:c({id:15427}),non_routed_activities_label:c({id:13083}),
non_routed_activities:w.rgt_unrouted||0,roll_back_button_text:c({id:13078,type:"raw"}),permission:2===this.access,visibility:y,showButton:A},y="","scheduled"===w.immediate_algorithm&&(y=u.apply(A)),"urgent"===w.immediate_algorithm&&(y=t.apply(A)),this.baseClass.getContentContainer().append(e.apply({immediate_routing_details:y}))):this.baseClass.getContentContainer().empty().append(b.apply({routing_run_details:A,routing_run_details_general:z})),this.popup.setPositionCenter();else if("running"===w.status||
"waiting"===w.status)this.firstRun?(y=v.apply(),this.baseClass.getContentContainer().append(b.apply({routing_run_details:y,routing_run_details_general:z})),this.popup.setPositionCenter()):$(".vsl-details-widget-right").first().html(z);"running"===w.status||"waiting"===w.status?($("#vsl-roll-back-button").hide(),$("#vsl-stop-button").show().on("click",this.stopRoutingRun.bind(this)),this.firstRun&&this.animatePuzzles()):($("#vsl-stop-button").hide(),$("#vsl-roll-back-button").show().on("click",this.rollBackRoutingRun.bind(this)));
this.popup.isDestroyed||this.popup.setTitleHtml(l.apply({title:this.routing_type,routing_plan_name:c({id:15318,translations:{"{ROUTING_PLAN_NAME}":this.routing_plan_name,"{ROUTING_PLAN_ID}":"scheduled"===this.runId?"":this.runId}})}));this._showPopup(w.status);this.firstRun=!1}},_showPopup:function(b){this.popup.isDestroyed?(clearTimeout(this.routingRunTimeoutId),this.routingRunTimeoutId=null):(this.popup.recalculateHeight(),this.popup.isOpen()||this.popup.show(),"running"!==b&&"waiting"!==b||!this.firstRun||
(this.baseClass.getContainer().find(".vsl-details").height(this.popup.getHeight()-this.baseClass.getContainer().find(".vsl-tabs").height()),this.popup.setPositionCenter()),this.baseClass.onPopupResize())},_getRoutingReport:function(){this._sandbox.trigger("global.data.get",{controller:"Routingvisualization",method:"getRoutingRunInfo",params:{runId:Number(this.runId)},responseHandler:this.onGetRoutingReport,errorHandler:function(b){this.baseClass.showAlert(b);return!1}.bind(this)})}}));toa.mixin(toa.views.routingRuns.runDetails.RunSummaryDetails.prototype,
toa.mixins.EventEmitter)})();(function(){var d=toa.glossary;(new toa.Template(['<div class="vsl-details-wrapper">','   <div class="routing-report"><%=content%></div>',"</div>"])).compile();(new toa.Template('<%for(var row in actions) {%>;   <div class="routing-report-wrapper">;       <div class="routing-report-bar" data-run-id="<%-actions[row].id%>">;           <div class="report-<%if(row == (actions.length-1)) {%>expand<%} else {%>collapse<%}%>"></div>;           <div class="action-name"><%-actions[row].action%> - ID<%-actions[row].id%></div>;       </div>;       <div class="routing-report-data <%if(row == (actions.length-1)) {%>show<%}%>">;   <%if(row == (actions.length-1)) {%>;       <%=actionReportData%>;   <%}%>;       </div>;   </div>;<%}%>;<%if(actions.length == 0) {%>;   <%=actionReportData%>;<%}%>'.split(";"))).compile();
var c=(new toa.Template(["<%if (actionData.length > 0) {%>",'   <a class="toa-button download-report" download href="<%-downloadReportUrl%>"><%-downloadLabel%></a>',"<% } %>",'<table class="routing-report-table">',"   <tr>","       <th><%-resourceFromLabel%></th>","       <th><%-resourceToLabel%></th>","       <th><%-activityLabel%></th>","       <th><%-temLabel%></th>","       <th><%-errorLabel%></th>","   </tr>","<%for(var row in actionData) {%>","   <tr>",'       <td><span is-single-click="true" pid="<%-actionData[row].from_id%>"><%-actionData[row].from%></span></td>',
'       <td><span is-single-click="true" pid="<%-actionData[row].to_id%>"><%-actionData[row].to%></span></td>','       <td><span is-single-click="true" aid="<%-actionData[row].id%>"><%-actionData[row].appt%></span></td>',"       <td><%-actionData[row].tem%>","       <%if (actionData[row].twa) {%>",'           <div class="appt_links_alert">&nbsp;</div>',"       <% } %>","       </td>","       <td>","       <%if (actionData[row].newPid && actionData[row].newDate) {%>",'           <span class="moved" onmouseup="search_redirect(<%-actionData[row].newPid%>, \'<%-actionData[row].newDate%>\', <%-actionData[row].id%>, true);">',
"               <%-actionData[row].error%>","           </span>","       <% } else {%>","           <%-actionData[row].error%>","       <%}%>","       </td>","   </tr>","<%}%>","</table>"])).compile();toa.ns("toa.views.routingRuns.runDetails.RunReportDetails",toa.define(null,function(b){this._sandbox=b;this.baseClass=null;this.runId=0;this.onGetRoutingReport=this.onGetRoutingReport.bind(this);this.addListener("switch-to-routing-tab-report-details",function(b,c){c.getContentContainer().empty();c.getTabsContainer().find("li").removeClass("selected");
c.getTabsContainer().find("li."+this.tabLabel).addClass("selected");this.render()}.bind(this));this.addListener("show-report-detail",function(b,c){var d=$(c.elem.currentTarget).data("run-id");c.baseClass._contentContainer.find(".report-expand").removeClass("report-expand").addClass("report-collapse");c.baseClass._contentContainer.find('div.routing-report-bar[data-run-id="'+d+'"]').children(":first").removeClass("report-collapse report-expand").addClass("report-expand");c.baseClass._contentContainer.find(".routing-report-data").removeClass("show").empty();
this._getRoutingReport(d)}.bind(this))},{tabLabel:"report-details",tabTemplate:'<li class="report-details hidden">'+d({id:15445})+"</li>",renderTab:function(b){this.baseClass=b;this.runId=b.runId;return $(this.tabTemplate).off().click(function(){this.notify("switch-to-routing-tab-report-details",this.baseClass)}.bind(this))},render:function(){if(this.popup=this.baseClass.getPopup())return this._getRoutingReports(),this.popup.setWidth(900),this.popup.setPositionCenter(),this},onGetRoutingReport:function(b,
e){this.baseClass.showTabs(e.tabs_info);var g=e.routing_report||[],k=e.run_id,g=$(c.apply({resourceFromLabel:d({id:5329,type:"raw"}),resourceToLabel:d({id:5330,type:"raw"}),activityLabel:d({id:5331,type:"raw"}),errorLabel:d({id:5332,type:"raw"})+" / "+d({id:8618,type:"raw"}),actionData:g}));this.baseClass.getContentContainer().find('div.routing-report-bar[data-run-id="'+k+'"]').parent().find(".routing-report-data").empty().append(g);$(".routing-report-table span.moved").click(function(){this.baseClass.destroy()}.bind(this))},
_getRoutingReports:function(){var b=this;this.baseClass.getContentContainer().append('<div id="routing-report"></div>');require(["loader","SignalEmitter"],function(c,d){c.run({name:"RoutingReport",label:"routing_report",title:"routing_report",selector:"#routing-report"});console.debug("RoutingReport: loader run");d.dispatch("addRoutingReportData",{context:b},!0);console.debug("RoutingReport: Dispatch signal - addRoutingReportData")})},_getRoutingReport:function(b){this.baseClass.getContentContainer().find('div.routing-report-bar[data-run-id="'+
b+'"]').parent().find(".routing-report-data").addClass("show").append('<div class="routing-report-empty">'+d({id:13171})+"</div>");this._sandbox.trigger("global.data.get",{controller:"Routingvisualization",method:"getRoutingReport",params:{runId:b,parentRunId:this.runId},responseHandler:this.onGetRoutingReport,errorHandler:function(b){this.baseClass.showAlert(b);return!1}.bind(this)})},toString:function(){return"RunReportDetails"}}));toa.mixin(toa.views.routingRuns.runDetails.RunReportDetails.prototype,
toa.mixins.EventEmitter)})();(function(){var d=toa.views.routingRuns.utils,c=toa.glossary,b=(new toa.Template('<div class="vsl-details-wrapper">;   <div class="routing-comparison-report">;   <%=plans%>;   <%=content%>;   </div>;</div>'.split(";"))).compile(),e=(new toa.Template('<div class="select-comparison-plan">,   <label for="comparison-plan"><%=label%></label>,   <select id="comparison-plan">,       <option value="0">&nbsp;</option>,<%for(var key in runs) {%>,   <%if(runId != runs[key].run_id) { %>,       <option value="<%-runs[key].run_id%>" <%if(comparisonRunId == runs[key].run_id) {%>selected="selected"<%}%>><%=runs[key].start_time%>&nbsp;<%-runs[key].plan_name%></option>,   <%}%>,<%}%>,   </select>,</div>'.split(","))).compile(),
g=(new toa.Template('<table class="routing-comparison-report-table">;   <tr>;       <th><%-parametersLabel%></th>;       <th><%-planNameOne%></th>;       <th><%-planNameTwo%></th>;   </tr>;<%for(var row in data) {%>;   <tr>;       <td><%-row%></td>;       <td>;   <%if (data[row][0].class) {%><div class="<%-data[row][0].class%>"></div><% } %>;           <%=data[row][0].value%>;       </td>;       <td>;   <%if (data[row][1].class) {%><div class="<%-data[row][1].class%>"></div><% } %>;           <%=data[row][1].value%>;       </td>;   </tr>;<%}%>;</table>'.split(";"))).compile();
toa.ns("toa.views.routingRuns.runDetails.RunComparisonDetails",toa.define(null,function(b){this._sandbox=b;this.baseClass=null;this.runId=0;this.onGetRoutingReport=this.onGetRoutingReport.bind(this);this.dateTimeFormat=d.getUserDateTimeFormat();this.addListener("switch-to-routing-tab-comparison-details",function(b,c){c.getContentContainer().empty();c.getTabsContainer().find("li").removeClass("selected");c.getTabsContainer().find("li."+this.tabLabel).addClass("selected");this.render()}.bind(this))},
{tabLabel:"comparison-details",tabTemplate:'<li class="comparison-details hidden">'+c({id:15446})+"</li>",renderTab:function(b){this.baseClass=b;this.runId=b.runId;this.date=b.date;this.pid=b.pid;return $(this.tabTemplate).off().click(function(){this.notify("switch-to-routing-tab-comparison-details",b)}.bind(this))},render:function(){if(this.popup=this.baseClass.getPopup())return this._getRoutingReport(),this.popup.setWidth(900),this.popup.setPositionCenter(),this},onGetRoutingReport:function(d,l){this.baseClass.showTabs(l.tabs_info);
var n=l.routing_last_runs||[],p;for(p in n){var s=n[p],t=toa.date.parseDate("iso_long",s.start_time),s=s.bucket_time_zone_diff||0,t=t.getTime()+6E4*s,t=new Date(t);n[p].start_time=toa.date.formatDate(this.dateTimeFormat.time,t)}n=e.apply({label:c({id:15453,type:"raw"}),runs:n,comparisonRunId:this.comparisonRunId,runId:this.runId});if(l.routing_comparison_report){s=t="";for(p in l.routing_last_runs)if(l.routing_last_runs[p].run_id==this.runId){t=l.routing_last_runs[p].plan_name;break}for(p in l.routing_last_runs)if(l.routing_last_runs[p].run_id==
this.comparisonRunId){s=l.routing_last_runs[p].plan_name;break}p=g.apply({data:l.routing_comparison_report||[],parametersLabel:c({id:2417,type:"raw"}),planNameOne:t,planNameTwo:s})}else p="";this.baseClass.getContentContainer().empty();this.baseClass.getContentContainer().append(b.apply({plans:n,content:p}));$("#comparison-plan").change(function(b){if(b=b.target.value)this.comparisonRunId=parseInt(b,10),this._getRoutingReport()}.bind(this))},_getRoutingReport:function(){this._sandbox.trigger("global.data.get",
{controller:"Routingvisualization",method:"getRoutingComparisonReport",params:{pid:this.pid,date:this.date,runId:this.runId,comparisonRunId:this.comparisonRunId},responseHandler:this.onGetRoutingReport,errorHandler:function(b){this.baseClass.showAlert(b);return!1}.bind(this)})}}));toa.mixin(toa.views.routingRuns.runDetails.RunComparisonDetails.prototype,toa.mixins.EventEmitter)})();(function(){var d=toa.views.routingRuns.utils,c=toa.glossary,b=(new toa.Template(['<div class="vsl-details-wrapper">','   <div class="routing-history-report"><%=content%></div>',"</div>"])).compile(),e=(new toa.Template('<table class="routing-history-report-table">;   <tr>;       <th><%-timeLabel%></th>;       <th><%-actionLabel%></th>;       <th><%-userLabel%></th>;       <th><%-activitiesLabel%></th>;       <th><%-resourcesLabel%></th>;   </tr>;<%for(var row in report) {%>;   <tr>;       <td><%-report[row].start_time%> - <%-report[row].finish_time%></td>;       <td><%-report[row].action%></td>;       <td><%-report[row].initiated%></td>;       <td class="activity"><%=report[row].activity%></td>;       <td><%-report[row].resource%></td>;   </tr>;<%}%>;</table>'.split(";"))).compile();
toa.ns("toa.views.routingRuns.runDetails.RunHistoryDetails",toa.define(null,function(b){this._sandbox=b;this.baseClass=null;this.runId=0;this.onGetRoutingReport=this.onGetRoutingReport.bind(this);this.addListener("switch-to-routing-tab-history-details",function(b,c){c.getContentContainer().empty();c.getTabsContainer().find("li").removeClass("selected");c.getTabsContainer().find("li."+this.tabLabel).addClass("selected");this.render()}.bind(this))},{tabLabel:"history-details",tabTemplate:'<li class="history-details hidden">'+
c({id:15447})+"</li>",renderTab:function(b){this.baseClass=b;this.runId=b.runId;return $(this.tabTemplate).off().click(function(){this.notify("switch-to-routing-tab-history-details",this.baseClass)}.bind(this))},render:function(){if(this.popup=this.baseClass.getPopup())return this._getRoutingReport(),this.popup.setWidth(900),this.popup.setPositionCenter(),this},onGetRoutingReport:function(g,k){this.baseClass.showTabs(k.tabs_info);var l=k.routing_history_reports,n=d.getUserDateTimeFormat(),p;for(p in l){var s=
toa.date.parseDate("iso_long",l[p].start_time),t=toa.date.parseDate("iso_long",l[p].finish_time),u=toa.app.model("companySettings").getUser().tz_diff,v=toa.datetime.currentDate(u).toDateString(),w=n.date_time,x=n.time,s=toa.date.create(s.getTime(),u),t=toa.date.create(t.getTime(),u);v===s.toDateString()&&(w=n.time);l[p].start_time=toa.date.formatDate(w,s);l[p].finish_time=toa.date.formatDate(x,t)}l=e.apply({timeLabel:c({id:13165}),actionLabel:c({id:6909}),userLabel:c({id:15440}),activitiesLabel:c({id:15431}),
resourcesLabel:c({id:15432}),report:l});this.baseClass.getContentContainer().append(b.apply({content:l}))},_getRoutingReport:function(){this._sandbox.trigger("global.data.get",{controller:"Routingvisualization",method:"getRoutingHistoryReport",params:{runId:this.runId},responseHandler:this.onGetRoutingReport,errorHandler:function(b){this.baseClass.showAlert(b);return!1}.bind(this)})}}));toa.mixin(toa.views.routingRuns.runDetails.RunHistoryDetails.prototype,toa.mixins.EventEmitter)})();(function(){var d=(new toa.Template('<div class="vsl-wrapper">;   <div class="vsl-content-wrapper">;      <ul class="vsl-tabs"></ul>;      <div class="vsl-details"></div>;   </div>;</div>'.split(";"))).compile(),c=toa.ui.Popup,b=toa.views.routingRuns.runDetails.RunReportDetails,e=toa.views.routingRuns.runDetails.RunHistoryDetails,g=toa.views.routingRuns.runDetails.RunComparisonDetails,k=toa.views.routingRuns.runDetails.RunSummaryDetails;toa.ns("toa.views.routingRuns.RunDetailsBase",toa.define(null,
function(c,n){this._sandbox=c;this.onPopupResizeUid=null;this.runId=0;this._layout=n;this._container=$(d.apply());this._tabsContainer=$(".vsl-tabs",this._container);this._contentContainer=$(".vsl-details",this._container);this._tabs=[new k(c),new b(c),new g(c),new e(c)]},{render:function(){var b=this;this._popup=new c({popup_extra_css_class:"vsl full-screen-popup",onClose:function(){b.destroy()}});for(var e in this._tabs)if(this._tabs.hasOwnProperty(e)){var d=this._tabs[e].renderTab(this);this.getTabsContainer().append(d)}toa.app&&
toa.app.reflowManager&&(this.onPopupResizeUid=toa.app.reflowManager.addListener("resize",this.onPopupResize.bind(this)));this.getPopup().setContent(this.getContainer())},onPopupResize:function(b,c){var e=parseInt($(this._popup.getDomContent()).find(".vsl-left-wrapper").height()),d=parseInt($(this._popup.getDomContent()).find(".vsl-right-wrapper").height()),g=e>=d?e:d,e=parseInt($(this._popup.getDomContent()).css("max-height")),d=this.getContainer().find(".vsl-tabs").height(),g=g+d,g=e>=g?g-18:e-d-
18;this.getContainer().find(".vsl-details").height(g)},getTabsContainer:function(){return this._tabsContainer},getContentContainer:function(){return this._contentContainer},showTabs:function(b){$.each(b||[],function(b,c){this.getTabsContainer().find("."+b).removeClass("hidden hide show").addClass(c?"show":"hide")}.bind(this))},getContainer:function(b){return!0===b?this._container.html():this._container},getPopup:function(){return this._popup},show:function(b,c,e,d){this.pid=parseInt(e.pid,10);this.runId=
"scheduled"!=c?parseInt(c,10):"scheduled";this.date=d;this.data=e;for(var g in this._tabs)if(this._tabs.hasOwnProperty(g)&&b==this._tabs[g].tabLabel)return this.render(),this.getTabsContainer().find("li").removeClass("selected"),this.getTabsContainer().find("li."+this._tabs[g].tabLabel).addClass("selected"),this._tabs[g].render()},hide:function(){this.getPopup().hide()},destroy:function(){this._sandbox.trigger("routing.run.popup.has.been.closed");this._sandbox.unbind("routing.run.popup.has.been.closed",
"",this._sandbox.controller);this.getPopup()&&this.getPopup().destroy();this.onPopupResizeUid&&toa.app&&toa.app.reflowManager&&toa.app.reflowManager.removeListener(this.onPopupResizeUid);this._popup=null},getAccess:function(b){return this._layout.getAccess(b)},showAlert:function(b){this.hide();this.destroy();this._layout.showAlert(b)}}));toa.mixin(toa.views.routingRuns.RunDetailsBase.prototype,toa.mixins.EventEmitter)})();(function(){var d=toa.views.routingRuns.WidgetTip,c=toa.glossary,b=toa.views.routingRuns.utils;toa.ns("toa.views.routingRuns.widgets.tips.RoutingPlansWidgetTip",toa.define(d,function(){d.apply(this,arguments)},{_data:{},_setters:{routing_plans_widget:function(e,d){function k(b){if(27==b.keyCode||"Escape"===b.key)window.removeEventListener("keyup",k),l.hide()}d.find(".routing-plans-heading-row").nextAll().remove();var l=d.parent().parent();l.hide();$.isEmptyObject(e)&&d.append('<div class="routing-plans-empty">'+
c({id:15435})+"</div>");e&&e.kernel_error&&d.append('<div class="routing-plans-empty error">'+e.kernel_error+"</div>");e&&e.responseInProgress&&d.append('<div class="routing-plans-empty">'+c({id:13171})+"</div>");var n={sequentially:r(22655),immediately:r(22656),manual:r(22657),onceaday:r(22658),recurrent:r(22659)},p=[];if(e&&e.length)for(var s in e)if(e.hasOwnProperty(s)){var t=e[s];hs(t.routing_plan_name).replace(/"/g,"&quot;");var u=b.determineTypeOfPlan(t),v=n[u]||u;t.routing_plan_type=0!==t.successor_id?
"sequentially":"manual";this._data[t.routing_plan_id]=t;var w=!0,x="";"immediately"===u&&(w=!1);w&&(x='<button role="link" class="link" tabindex="0" data-plan-id="'+hs(t.routing_plan_id)+'">'+c({id:15433})+"</button>");p.push(['<div class="routing-plans-body-row" role="row" data-plan-id="'+t.routing_plan_id+'"><div class="routing-plans-col plan-name" role="rowheader"><span>'+hs(t.routing_plan_name)+'</span></div><div class="routing-plans-col plan-type type-'+u+'" role="cell"><div class="visually-hidden-text">'+
v+'</div></div><div class="routing-plans-col activities-count" role="cell"></div><div class="routing-plans-col resources-count" role="cell"></div><div class="routing-plans-col run-plan" title="'+c({id:15433})+'" role="cell">'+x+"</div></div>"])}p.length?jQuery.when(d.append(p.join(""))).done(function(){l.show();var b=jQuery(window).height(),c=l.offset().top,e=l.outerHeight(),k=d.parent();e+c>b&&(l.css({"margin-top":"-"+c+"px"}),b-=e,0>b&&k.height(k.height()+b));setTimeout(function(){var b=l.find(":focusable");
b.length&&jQuery(b[0]).focus()},0)}):l.show();window.removeEventListener("keyup",k);window.addEventListener("keyup",k,!1)}},render:function(){d.prototype.render.apply(this,arguments);this.getContent().on("click",".link[data-plan-id]",function(b){b=$(b.currentTarget);var c=parseInt(b.attr("data-plan-id")),c=this._data[c];b={planId:parseInt(b.attr("data-plan-id")),planName:c.routing_plan_name,planType:c.routing_plan_type,rpAssignmentTo:c.assignmentTo};this.notify("manual.routing.plan.start",b)}.bind(this))},
getWidgetClassName:function(){return"routing-plans"},getWidgetTemplate:function(){return['<div class="routing-plans-table-wrapper">','  <div class="routing-plans-table" role="table" aria-label="'+c({id:15429})+'" data-marker="routing_plans_widget">','    <div class="routing-plans-heading-row" role="row">','      <div class="routing-plans-col plan-name" role="columnheader"><span>'+c({id:15429})+"</span></div>",'      <div class="routing-plans-col plan-type" role="columnheader">'+c({id:15430})+"</div>",
'      <div class="routing-plans-col activities-count" role="columnheader">'+c({id:15431})+"</div>",'      <div class="routing-plans-col resources-count" role="columnheader">'+c({id:15432})+"</div>",'      <div class="routing-plans-col run-plan" role="columnheader">&nbsp;</div>    </div>  </div></div>'].join("")}}))})();(function(){var d=toa.views.routingRuns.Widget,c=toa.views.routingRuns.widgets.tips.RoutingPlansWidgetTip,b=toa.views.routingRuns.RunDetailsBase,e=toa.glossary;toa.ns("toa.views.routingRuns.widgets.RoutingPlansWidget",toa.define(d,function(b,k){d.apply(this,arguments);this.tip=null;this.setTip(new c(["bottom","left"]));b.bind("global.date.set",function(b,c){this.setDate(c.dates[0])}.bind(this));b.bind("routing.runs.set.server.in.read.only.mode",function(b,c){this.getTip().remove()}.bind(this));this.getTip().addListener("manual.routing.plan.start",
function(b,c){var d=c.popup_extra_css_class||"",g=c.popupTitle||"",k=c.actionButtonText||"",u=c.cancelButtonText||"",v=c.planId||0,w=c.planName||"",x=c.planType||"",y=c.currentPid||this.getResourceId(),z=[],A=this.getDate(),A=toa.date.parseDate("iso",A),B=1<c.rpAssignmentTo?new Date(A.getTime()+864E5*(c.rpAssignmentTo-1)):null,A=null===B?e({id:19632,translations:{"{ROUTING_PLAN}":"<strong>"+hs(w)+"</strong>","{DATE_START}":"<strong>"+toa.date.formatDate("date",A)+"</strong>"},type:"raw"}):e({id:19633,
translations:{"{ROUTING_PLAN}":"<strong>"+hs(w)+"</strong>","{DATE_START}":"<strong>"+toa.date.formatDate("date",A)+"</strong>","{DATE_END}":"<strong>"+toa.date.formatDate("date",B)+"</strong>"},type:"raw"});z.push("<p>"+A+"</p>");"sequentially"==x&&z.push('<label><input type="radio" name="routingrun" value="0" checked="checked" />'+h(15436)+"</label>",'<label><input type="radio" name="routingrun" value="1" />'+h(15437)+"</label>");var D=0,x=$(z.join("<br />"));x.find('input[name="routingrun"]').on("click",
function(){D=parseInt($(this).val())});this.getTip().remove();var C=new toa.ui.Popup({title:g||r(13294),html:x,popup_extra_css_class:d,autoOpen:!0,buttons:[{id:"discard_btn",text:u||r(13292),visible:!0,click:function(){C.destroy();C=null;this.getTip().enableAutoHide()}.bind(this)},{id:"ok_btn",text:k||r(12411),type:"submit",visible:!0,click:function(){C.destroy();C=null;this.startRouting(w,v,D,y)}.bind(this)}]})}.bind(this))},{_updateIntervalTime:6E5,startRouting:function(c,e,d,n){this._isLoading=
!0;this._sandbox.trigger("global.data.get",{controller:"Routingvisualization",method:"runRoutingManually",suppressErrors:/403|409/,params:{planId:e,pid:n,date:this.getDate(),isSequence:d},responseHandler:function(p,s){this.getTip().remove();this._layout.setAccess(s.access);if(!s.routing_run_id)return s&&s.errors&&toa.ui.Alert({text:s.errors.join("<br>")}),this.getTip().enableAutoHide(),!1;var t=new b(this._sandbox,this._layout);t.show("summary-details",s.routing_run_id,{type:"manual",bucket_name:s.provider.pname,
plan_name:c,plan_id:e,status:"running",isSequence:d,pid:n},s.date);t.addListener("run has been completed",function(b,c){"routing_run_list"!==c.screen?this._sandbox.trigger("global.interface.refresh"):this._sandbox.trigger("routing.runs.update.all.widgets");d&&0<s.routing_run_id&&setTimeout(function(){t.destroy();this.statusSequentialRouting(s.routing_run_id,e,n)}.bind(this),5E3)}.bind(this));this._isLoading=!1}.bind(this),errorHandler:function(b){this.getTip().remove();Object.assign(b,{popup_extra_css_class:"redwood-styles-popup"});
this.showAlert(b);return!1}.bind(this)})},statusSequentialRouting:function(c,e,d){this._isLoading=!0;this._sandbox.trigger("global.data.get",{controller:"Routingvisualization",method:"getRoutingRunNextSequence",params:{runId:c,planId:e,pid:d},responseHandler:function(e,k){if(0<k.run_id){var s=new b(this._sandbox,this._layout);s.show("summary-details",k.run_id,{type:"manual",bucket_name:k.provider.pname,plan_name:k.sequence.routingName,plan_id:k.sequence.planId,status:"running",isSequence:!0,timestamp:this.getDate(),
pid:d},k.date);s.addListener("run has been completed",function(b,e){"routing_run_list"!==e.screen?this._sandbox.trigger("global.interface.refresh"):this._sandbox.trigger("routing.runs.update.all.widgets");k&&k.sequence&&k.sequence.isIssetNextPlan&&setTimeout(function(){s.destroy();this.statusSequentialRouting(c,k.sequence.planId,d)}.bind(this),5E3)}.bind(this))}this._isLoading=!1}.bind(this),errorHandler:function(b){this._sandbox.trigger("routing.run.popup.has.been.closed");this.getTip().remove();
Object.assign(b,{popup_extra_css_class:"redwood-styles-popup"});this.showAlert(b);return!1}.bind(this)})},requestData:function(b){this._isLoading=!0;this.update({routing_plans_widget:{responseInProgress:!0}});this._sandbox.trigger("global.data.get",{controller:"Routingvisualization",method:"routingPlansWidget",params:{pid:this.getResourceId(),date:this.getDate()},responseHandler:function(b,c){this.update(c.widget||{});this._layout.setAccess(c.access);this._isLoading=!1;var e=[],d=c.widget.routing_plans_widget,
g;for(g in d)d.hasOwnProperty(g)&&e.push([this.getResourceId(),d[g].routing_plan_id]);e&&this._sandbox.trigger("global.data.get",{controller:"Routingvisualization",method:"loadRoutingRunActivities",params:{plans_info:e,date:this.getDate()},responseHandler:function(b,c){for(var e=0;e<c.routing_runs_activity_info.length;e++){var d=c.routing_runs_activity_info[e],g=$('div[data-plan-id="'+d.plan_id+'"]',this.getTip()._content);$("div.activities-count",g).text(d.activities);$("div.resources-count",g).text(d.resources)}}.bind(this),
errorHandler:function(b){Object.assign(b,{popup_extra_css_class:"redwood-styles-popup"});this.showAlert(b);return!1}.bind(this)})}.bind(this),errorHandler:function(b){this.getTip().remove();Object.assign(b,{popup_extra_css_class:"redwood-styles-popup"});this.showAlert(b);return!1}.bind(this)})},setTip:function(b){this.tip=b},getTip:function(){return this.tip},toString:function(){return"routing_plans_widget"}}))})();toa.widgets={layout:{},vtype:{}};toa.createWidget=toa.formBuilder=function(d,c){var b=toa.widgets[d.xtype];if(!b)throw"Wrong xtype: "+d.xtype;return new b(d,c)};toa.formBuilder.reg=function(d,c,b){var e=toa.widgets;if(!e[d])throw"No parent class found: "+d;if(!c.defaults||!c.defaults.xtype)throw"Wrong xtype: "+c.defaults.xtype;return e[c.defaults.xtype]=$.Class(e[d],c,b)};
toa.formBuilder.regLayout=function(d,c,b,e){var g=toa.widgets.layout;if(!g[d])throw"No parent class found: "+d;b.defaults=b.defaults||{};b.defaults.xtype=c;g[c]=$.Class(g[d],b,e);return g[c]};
toa.widgets.base=$.Class({attrOptions:{name:1,"class":1,id:1,value:1},cssOptions:{width:1,height:1},formatOptions:function(d){for(var c in d)this.attrOptions[c]&&("undefined"==typeof d.attr&&(d.attr={}),d.attr[c]=d[c]),this.cssOptions[c]&&("undefined"==typeof d.css&&(d.css={}),d.css[c]=d[c]);return d},mix:function(d,c){return $.extend(!0,{},d,c)},getOptions:function(d,c){return this.formatOptions($.extend(!0,{},d,c))},createElement:function(d,c){var b=$("<"+d+"/>");b.attr(c.attr||{});b.css(c.css||
{});b.bind(c.listeners||{});b.addClass("fb fb-"+(c.xtype||"widget")+" "+(c.addClass||""));"undefined"!=typeof c.html&&b.html(c.html);"undefined"!=typeof c.text&&b.text(c.text);b.data("fbwidget",this);return b}});
toa.formBuilder.reg("base",{defaults:{xtype:"widget",layout:"none"},toString:function(){return"Widget: "+this.options.xtype},_create:function(d,c){this.parent=c||null;this._initOptions(d);this._init();this.parent&&this.parent.items.push(this)},_initOptions:function(d){$.extend(!0,this.options,this.defaults,d)},renderTo:function(d){this.render(d)},_init:function(){this._initChilds()},_initChilds:function(){this.clear();this.options.items&&this.addItems(this.options.items)},addItems:function(d){for(var c in d)this.add(d[c])},
add:function(d){var c=toa.widgets[d.xtype];if(!c)throw"xtype: "+d.xtype+" not registred";return new c(d,this)},remove:function(d){d=this.child(d);if(!d)return!1;d.destroy(!0);return!0},find:function(d){var c=this.items,b;for(b in c){if(c[b].options.name==d)return c[b];var e=c[b].find(d);if(e)return e}return!1},replace:function(d,c){var b=null,e=null,g=this.find(d);if(!g.parent)return!1;b=toa.widgets[c.xtype];if(!b)throw"xtype: "+c.xtype+" not registred";var k=new b(c),l=g.parent;k.parent=l;b=$.inArray(g,
g.parent.items);e=g.input.parent();g.destroy();l.items[b]=k;k.render(e);return k},child:function(d){var c=this.items,b;for(b in c)if(c[b].options.name==d)return c[b];return!1},clear:function(){for(var d in this.items)this.items[d].destroy();this.items=[]},render:function(d){this.renderChildren(d)},beforeChild:function(d){},renderChildren:function(d){for(var c in this.items)this.beforeChild(c),this.renderChild(c,d),this.afterChild(c)},renderChild:function(d,c){this.items[d].render(c)},afterChild:function(d){},
setValue:function(d){},setValues:function(d){d&&this.forAll(function(){var c=d[this.options.name];"undefined"!==typeof c&&this.setValue(c)})},getValue:function(){},forAll:function(d,c,b){var e=this.items;b=b||{};var g=$.isFunction(d),k;for(k in e){var l=e[k];if(g||$.isFunction(l[d])){var n=c?c[l.options.name]||c["default"]||[]:[],n=g?d.apply(l,n):l[d].apply(l,n);"undefined"!==typeof n&&l.options.name&&(b[l.options.name]=n)}l.forAll(d,c,b)}return b},createElement:function(d,c){c||(c=this.formatOptions(this.options));
d||(d=c.tag||c.xtype);var b=arguments.callee.parent.apply(this,[d,c]);b.addClass("fb-"+c.xtype);return b},getElement:function(){return this.input},destroy:function(d){this.clear();this.input&&this.input.remove();this.label&&this.label.remove();this.mandatory&&this.mandatory.remove();this.parent&&d&&(d=$.inArray(this,this.parent.items),-1!=d&&delete this.parent.items[d])}},{options:{},items:[],input:null,label:null});toa.widgets.layout.none=$.Class(toa.widgets.base,{defaults:{xtype:"none"},_create:function(d){this._initOptions(d)},_initOptions:function(d){$.extend(!0,this.options,this.defaults,d)},getContainer:function(d,c){return d},clear:function(){}},{options:{}});toa.formBuilder.regLayout("none","div",{getContainer:function(d,c){return this.createElement("div",this.getOptions(this.option,c.cell)).appendTo(d)}});toa.formBuilder.regLayout("none","vbox",{defaults:{table:{attr:{width:"100%"}}},getContainer:function(d,c){this.element||(this.element=this.getTable(c),$(d).append(this.element));var b=this.getCell(c),e=this.getRow(c);this.element.append(e.append(b));return b},getTable:function(d){var c=this.mix({xtype:"vbox",addClass:"fb-layout-"+this.options.xtype+"-table",attr:{role:"presentation"}},this.options.table);return this.createElement("table",this.getOptions(c,d.table))},getRow:function(d){var c=this.mix({xtype:"tr",
addClass:"fb-layout-"+this.options.xtype+"-row"},this.options.row);return this.createElement("tr",this.getOptions(c,d.row))},getCell:function(d){var c=this.mix({xtype:"cell",addClass:"fb-layout-"+this.options.xtype+"-cell"},this.options.cell);return this.createElement("td",this.getOptions(c,d.cell))},clear:function(){$(this.element).empty()}});toa.formBuilder.regLayout("vbox","hbox",{getContainer:function(d,c){if(!this.element){this.element=this.getRow(c);var b=this.getTable(c);b.append(this.element);$(d).append(b)}b=this.getCell(c);this.element.append(b);return b}});toa.formBuilder.regLayout("vbox","htail",{defaults:{maxCell:3,table:{attr:{width:"100%"}}},getContainer:function(d,c){this.cellCount||(this.cellCount=0);this.element||(this.element=this.getTable(c),$(d).append(this.element));0==this.cellCount&&(this.tr=this.getRow(c),this.element.append(this.tr));var b=this.getCell(c),e=Math.round(100/this.options.maxCell);b.attr("width",e+"%");this.element.append(this.tr.append(b));this.cellCount++;this.cellCount>=this.options.maxCell&&(this.cellCount=0);return b}});toa.formBuilder.regLayout("vbox","fieldset",{defaults:{xtype:"fieldset"},getContainer:function(d,c){this.element||(this.element=this.getTable(c),$(d).append(this.element));var b=this.getCell(c).addClass("fb-"+this.options.xtype+"-mandatory"),e=this.getCell(c).addClass("fb-"+this.options.xtype+"-label"),g=this.getCell(c).addClass("fb-"+this.options.xtype+"-input"),k=this.getRow(c).addClass("fb-"+this.options.xtype+"-row");this.element.append(k.append(b).append(e).append(g));return{mandatory:b,label:e,
input:g}}});toa.formBuilder.regLayout("fieldset","fieldsetleft",{getContainer:function(){var d=arguments.callee.parent.apply(this,arguments);d.label.attr("width","1px");return{label:d.input,input:d.label}}});toa.formBuilder.reg("widget",{defaults:{xtype:"panel",tag:"div",layout:"none"},_init:function(){var d=toa.widgets.layout[this.options.layout];if(!d)throw"Wrong layout:"+this.options.layout;this.layout=new d(this.getOptions({},this.options.layoutDesc));arguments.callee.parent.apply(this,arguments)},render:function(d){d.input&&(d=d.input);this.input=this.createElement().appendTo(d);arguments.callee.parent.apply(this,[this.input])},renderChild:function(d,c){c=this.layout.getContainer(c,this.items[d].options);
arguments.callee.parent.apply(this,[d,c])},clear:function(){this.layout.clear();arguments.callee.parent.apply(this,arguments)}},{layout:null});toa.formBuilder.reg("panel",{defaults:{xtype:"form",name:"form",layout:"hbox",attr:{novalidate:""}},render:function(d){arguments.callee.parent.apply(this,[d]);this.renderButtons(this.input)},renderButtons:function(d){for(var c in this.options.buttons)this.buttons[c]=this.createElement("button",this.formatOptions(this.options.buttons[c])).appendTo(d)}});toa.formBuilder.reg("form",{defaults:{xtype:"multiselect",name:"multiselect",layout:"fieldsetleft",tag:"form",cell:{css:{maxHeight:"80%",display:"block",overflow:"auto"}}},getValue:function(){var d={},c=this.items,b;for(b in c)d[c[b].options.name]=c[b].getValue();return d}});toa.formBuilder.reg("panel",{defaults:{xtype:"window",name:"form",layout:"hbox",title:"Dialog",tag:"div",width:600,paddingTop:60,paddingLeft:50,css:{left:-1E4},jqdialog:{modal:!0,autoOpen:!1,appendTo:"object"===typeof _DATA&&_DATA.popup_container?_DATA.popup_container:"",buttons:{save:function(){}}}},_initOptions:function(d){arguments.callee.parent.apply(this,arguments);this.options.jqdialog.title=this.options.title;this.options.jqdialog.width=this.options.width},render:function(d){arguments.callee.parent.apply(this,
[d]);this.input.dialog(this.options.jqdialog);this.input.on("dialogclose",function(c,b){toa.view.Header.setEnable()});this.input.siblings(".ui-dialog-buttonpane").first().empty();this.recalculateMaxSize()},open:function(){this.input.is(":visible")||toa.view.Header.setDisable();this.input.dialog("open").dialog({position:"center"});app.focusTrap(this.input.closest(".ui-dialog")[0])},dragStart:function(){this.input.dialog("dragStart")},resizeStart:function(){this.input.dialog("resizeStart")},resizeStop:function(){this.input.dialog("resizeStop")},
resize:function(){this.input.dialog("resize")},close:function(){this.input.dialog("close")},disable:function(){var d=this.input.dialog("widget");this.zIndexEnabled=d.css("zIndex");d.css("zIndex",999)},enable:function(){this.input.dialog("widget").css("zIndex",this.zIndexEnabled)},setTitle:function(d){this.input.dialog("option","title",d);d=this.input.dialog().parent().find(".ui-dialog-title");d.attr("title",d.text())},recalculateMaxSize:function(){var d=$(window).height()-2*this.options.paddingTop,
c=$(window).width()-2*this.options.paddingLeft;500>$(window).width()&&(c=$(window).width());this.input.css({maxHeight:d,maxWidth:c});this.input.dialog("option","maxHeight",d).dialog("option","maxWidth",c)}});toa.formBuilder.reg("window",{defaults:{xtype:"dialog",layout:"div",tag:"div",title:"Dialog",minWidth:300,width:"auto",paddingTop:60,paddingLeft:50,jqdialog:{modal:!0,autoOpen:!1,appendTo:"object"===typeof _DATA&&_DATA.popup_container?_DATA.popup_container:"",buttons:{save:function(){}}},listeners:{},row:{id:"fb-dialog-content-row"},cell:{id:"fb-dialog-content",addClass:"fb-dialog-content"},bottomPanel:{xtype:"panel",addClass:"fb-dialog-button-panel",layout:"none",items:[{xtype:"span",name:"errors",
addClass:"fb-invalid"},{xtype:"button",value:toa.glossary({id:14625}),addClass:"fb-close toa-button"},{xtype:"button",name:"submit",value:toa.glossary({id:14626})}]}},_init:function(){var d=this;d.options.listeners=$.extend({ok:function(c){d.close()},close:function(c){},dialogclose:function(c){d.resizeCallbackId&&delete d.resizeCallbackId;$(this).trigger("close",c)},dialogopen:function(c,b,e){},keydown:function(c){13==c.keyCode&&(d.input.trigger("ok",d,c),c.preventDefault())}},d.options.listeners);
arguments.callee.parent.apply(d,arguments);d.options.bottomPanel.items[1].listeners={click:function(c){d.close()}};d.options.bottomPanel.items[2].listeners={click:function(c){d.input.trigger("ok",d,c)}};d.buttonPanel=new toa.formBuilder(d.options.bottomPanel)},render:function(d){arguments.callee.parent.apply(this,arguments);var c=this.input.siblings(".ui-dialog-buttonpane").first();this.buttonPanel.render(c)},destroy:function(){this.buttonPanel.destroy();arguments.callee.parent.apply(this,arguments)},
setErrors:function(d){var c=0,b="",e;for(e in d)b||(b=d[e]),c++;1<c&&(b+=" <b> and "+(c-1)+" more</b>");this.setError(b);return 0<c},setError:function(d){this.buttonPanel.find("errors").input.html(d);return!!d},reset:function(){this.setError("")}});toa.formBuilder.reg("window",{defaults:{xtype:"windowIframe",layout:"none",title:"Dialog",tag:"div",jqdialog:{modal:!0,autoOpen:!1,buttons:{},resizable:!1,appendTo:"object"===typeof _DATA&&_DATA.popup_container?_DATA.popup_container:""},url:"",sid:""},_init:function(){this.callParent()},render:function(d){var c=this;c.callParent(d);var b=c.getElement();b.css("padding",0);toa.mixins.SimpleDraggable.call(this,{draggableElement:$(b.parent()[0]),draggableBy:$(b.parent()[0]).find(".ui-dialog-titlebar")});
toa.dom.isTouch&&$(b.parent()[0]).find(".ui-dialog-titlebar-close").on("touchstart",function(b){c.close()});c.targetId="wopen_"+(new Date).getTime();d=c.options.sid.split("=",2);var e=$('<iframe id="'+c.targetId+'" name="'+c.targetId+'" style="display:block;border:0;"></iframe>').appendTo(b);0==c.options.width?e.css("width","auto"):e.css("width",c.options.width+"px");0==c.options.height?e.css("height","auto"):e.css("height",c.options.height+"px");e[0].dialogOpenerWindow=c.options.openerWindow;c.loaded=
!1;c.currentHeight=c.options.height;e.one("load",function(){c.open()});e.on("load",function(){try{if(_DATA.openRequests){var e=_DATA.openRequests.indexOf(c.options.url);-1!=e&&_DATA.openRequests.splice(e,1)}var d=c.options.topWindow.frames[c.targetId].document;d.title=d.title||c.options.title;this.setAttribute("title",d.title);$(d.body).css("overflow","auto");3===toa.currentInterface&&$(d.body).append('<div id="manage-container"></div>');c.setTitle(d.title);set_indicator(0);d.body.addEventListener&&
(d.body.addEventListener("mousedown",function(c){b.trigger("checkEditState",{event:c})},!0),d.body.addEventListener("dblclick",function(c){b.trigger("checkEditState",{event:c})},!0),d.body.addEventListener("mouseover",function(c){b.trigger("checkEditState",{event:c})},!0),d.body.addEventListener("click",function(c){b.trigger("handleEventEnter",{event:c})},!0));c.loaded=!0;c.windowResizeCallback();var l=$(d.body).find('input[type!="hidden"], select, textarea');l.length&&l[0].focus&&l[0].focus()}catch(n){}});
d=$('<form action="'+c.options.url+'" method="POST" target="'+c.targetId+'"><input type="hidden" name="'+d[0]+'" value="'+d[1]+'" /></form>').appendTo(b).hide();set_indicator(2);d.submit();d.remove()},contentResizeCallback:function(d){if((d=this.options.topWindow.document.getElementById(this.targetId))&&this.loaded){var c=$(d.contentWindow.document.body);c.css("height","auto");c.find(".forms").css("height","auto");if(c.outerHeight()){var b=isMSIE5?c[0].scrollHeight:c.outerHeight();$(d).css("height",
b+"px");this.getElement().dialog("option","position","center");this.currentHeight=b;c.css("height","100%");c.find(".forms").css("height","100%");this.windowResizeCallback()}}},windowResizeCallback:function(d){if((d=this.options.topWindow.document.getElementById(this.targetId))&&this.loaded){var c=$(this.options.topWindow).height(),b=this.getElement().dialog("widget");this.currentHeight>c?(b=b.outerHeight()-$(d).outerHeight(),$(d).css("height",c-b+"px")):0==this.currentHeight?$(d).css("height","auto"):
$(d).css("height",this.currentHeight+"px");this.getElement().dialog("option","position","center")}}});toa.formBuilder.reg("panel",{defaults:{xtype:"toolbar",tag:"div",layout:"div",items:[]},add:function(d){return"marker"==d.xtype?!1:this.callParent(d)},render:function(d){var c=this;d=this.callParent(d);c.setMenu(c.options.items);c.input.delegate("button","click",function(b,e){var d=$(this).data("fbwidget");c.input.trigger("menuItemClick",{name:d.options.name||"",widget:d||{}})});return d},startGroup:function(){return $("<span/>").addClass("toa-button-panel").css("margin-left","10px").appendTo(this.input)},
clear:function(){this.callParent();this.input&&this.input.empty()},setMenu:function(d){this.clear();for(var c=this.startGroup(),b=0;b<d.length;b++){var e=d[b];"marker"==e.xtype?c=this.startGroup():(d[b].items&&(e.xtype="menuButton",e.menuItems=d[b].items,e.addClass="toa-button"),e=this.add(e),this.input&&e.render(c))}}});toa.formBuilder.reg("widget",{defaults:{xtype:"field"},render:function(d){d.input||d.label?(d.mandatory&&this.renderMandatory(d.mandatory),d.label&&this.renderLabel(d.label),d.input&&this.renderInput(d.input)):(this.renderLabel($(d)),this.renderInput($(d)));arguments.callee.parent.apply(this,[this.input]);if(this.label){var c=this.input.attr("id");c||(c="_auto_fb_"+Math.floor(1E9*Math.random())+"_"+this.options.name,this.mandatory&&this.input.attr("aria-labelledby",this.mandatory.attr("id")+" "+c));
this.label.attr("id",c)}this.options.mandatory&&this.input.attr("required","")},renderMandatory:function(d){var c={xtype:"mandatory",attr:{id:generate_id(),class:"ofsc-abbr-mandatory",title:h(22351)},html:"*"};!1===this.options.allowBlank||this.options.mandatory||(this.options.mandatory=!0);this.mandatory=this.createElement("abbr",!1!==this.options.allowBlank?"&nbsp;":c).appendTo(d)},renderLabel:function(d){if("undefined"!=typeof this.options.fieldLabel){var c=this.getOptions({xtype:"label",html:this.options.fieldLabel,
tag:"label"},this.options.labelDesc);this.label=this.createElement(!1,c).appendTo(d)}},renderInput:function(d){this.input=this.createElement().appendTo(d)},enable:function(){this.input.removeAttr("disabled")},disable:function(){this.input.attr("disabled",!0)},setValue:function(d){this.input.val(d)},getValue:function(){return this.input.val()},reset:function(){this.setValue(this.options.value);this.label&&this.label.removeClass("fb-invalid")},validate:function(){var d=this.getValue();if(!this.options.allowBlank&&
"undefined"!==typeof this.options.allowBlank&&"object"!=typeof d&&isEmpty(d))var c=h(5406,{"%s":this.options.fieldLabel||"Field"});else $.isFunction(this.options.validator)?c=this.options.validator.apply(this,[d,this]):$.isFunction(toa.widgets.vtype[this.options.vtype])&&(c=toa.widgets.vtype[this.options.vtype].apply(this,[d,this]));if("string"===typeof c)return this.label&&this.label.addClass("fb-invalid"),c;this.label&&this.label.removeClass("fb-invalid")}});toa.formBuilder.reg("field",{defaults:{xtype:"span"},setValue:function(d){this.input.text(d)}});toa.formBuilder.reg("field",{defaults:{xtype:"input",tag:"input",attr:{type:"text"}}});toa.formBuilder.reg("input",{defaults:{xtype:"hidden",tag:"input",attr:{type:"hidden"}},renderMandatory:function(){},renderLabel:function(){}});toa.formBuilder.reg("input",{defaults:{xtype:"password",tag:"input",attr:{type:"password"}}});toa.formBuilder.reg("input",{defaults:{xtype:"checkbox",tag:"input",attr:{type:"checkbox"}},formatOptions:function(d){d.value&&(d.attr.checked=!0,d.attr.defaultChecked=!0);return arguments.callee.parent.apply(this,[d])},setValue:function(d){d?this.input.get(0).checked=!0:this.input.get(0).checked=!1},getValue:function(){return this.input.get(0).checked}});toa.formBuilder.reg("checkbox",{defaults:{xtype:"checkboxnamed",tag:"input",attr:{type:"checkbox"}},render:function(d){var c=$(d);c.css({whiteSpace:"nowrap"});d.input||d.label?d.input&&(this.renderInput(d.input),this.renderLabel(d.input)):(this.renderInput(c),this.renderLabel(c));this.label&&(d=this.input.attr("id"),d||(d="_auto_fb_"+this.options.name,this.input.attr("id",d)),this.label.attr("for",d))}});toa.formBuilder.reg("form",{defaults:{xtype:"checkboxlist",name:"checkboxlist",layout:"fieldsetleft",tag:"div",value:!1,itemsList:!1,cell:{css:{maxHeight:"100%",display:"block",overflow:"auto"}}},_initOptions:function(d){var c=d.itemsList;d.items=d.items||[];if(d.value)for(var b in c)c[b].value=!!d.value[c[b].id];for(b in c)d.items.push({xtype:"checkbox",name:c[b].id,fieldLabel:toa.toHtml(c[b].label),value:!!c[b].value});arguments.callee.parent.apply(this,arguments)},getLabelById:function(d){return(d=
this.find(d))?d.options.fieldLabel:!1},setValue:function(d){var c=!1,b;for(b in this.items)d&&d[this.items[b].options.name]?!0!==this.items[b].getValue()&&(this.items[b].setValue(!0),c=!0):!1!==this.items[b].getValue()&&(this.items[b].setValue(!1),c=!0);c&&$(this.input).trigger("change",this)},getValue:function(){var d={},c=this.items,b;for(b in c)d[c[b].options.name]=c[b].getValue();return d}});toa.formBuilder.reg("form",{defaults:{xtype:"checkboxtableBase",name:"checkboxtableBase",tag:"table",layout:"none",value:!1,itemsList:!1,valueFildName:"ratio",defaultValue:1,width:"100%",cell:{css:{maxHeight:"100%",display:"block",overflow:"auto"}}},_initOptions:function(d){var c=d.itemsList;d.items=d.items||[];if(d.value)for(var b in c)c[b].value=!!d.value[c[b].id];for(b in c)d.items.push({xtype:"checkbox",name:c[b].id,fieldLabel:c[b].label,value:!!c[b].value});arguments.callee.parent.apply(this,
arguments)},setValue:function(d){d=d||{};this.input.find("tr[data-id]").each(function(){var c=$(this),b=c.attr("data-id");value=d[b];c=c.find("input.fb-checkboxtable-checkbox:checkbox");"undefined"!==typeof value?c.get(0).checked=!0:c.get(0).checked=!1});return this},getValue:function(){var d=this,c={};d.input.find("input.fb-checkboxtable-checkbox:checkbox:checked").each(function(){var b=$(this).closest("tr[data-id]",d.input).attr("data-id");c[b]=b});return c},setItemsList:function(d){this.options.itemsList=
d;this.input&&this.renderItemsList(this.options.itemsList);return this},renderItemsList:function(d){if(!this.input)return!1;this.input.empty();var c=[],b;for(b in d)c.push([b,d[b]]);c.sort(this.sortItemsFunc);for(b in c)this.renderRow(c[b][0],c[b][1],this.input)},sortItemsFunc:function(d,c){d=d[1];c=c[1];return d<c?-1:1},renderRow:function(d,c,b){var e=generate_id();d=['<tr data-id="',d,'" ><td class="fb-checkboxtable-checkboxcol"><input id="',e,'" class="fb-checkboxtable-checkbox" type="checkbox"></td><td><label for="',
e,'">',toa.toHtml(c),"</label></td></tr>"].join("");b.append(d)}});toa.formBuilder.reg("checkboxtableBase",{defaults:{xtype:"checkboxtable",name:"checkboxtable",tag:"table",layout:"none",value:!1,minValue:1,maxValue:100,itemsList:!1,valueFildName:"ratio",defaultValue:1,width:"100%",cell:{css:{display:"block",overflow:"auto"}}},render:function(){arguments.callee.parent.apply(this,arguments);this.input.delegate(":checkbox","change",this.onCheckbox.bind(this))},setValue:function(d){var c=this;d=d||{};c.input.find("tr[data-id]").each(function(){var b=$(this),e=b.find("input.fb-checkboxtable-checkbox:checkbox"),
g=b.find("input.fb-checkboxtable-input"),k=b.attr("data-id"),k=d[k];"undefined"!==typeof k?(e.get(0).checked=!0,c.options.valueFildName&&(k=k[c.options.valueFildName]),g.val(k)):(e.get(0).checked=!1,g.val(c.options.defaultValue));c.check(b)});return this},getValue:function(){var d=this,c={};d.input.find("input.fb-checkboxtable-checkbox:checkbox:checked").each(function(){var b=$(this).closest("tr[data-id]",d.input),e=b.attr("data-id");c[e]=b.find("input.fb-checkboxtable-input").val()});return c},validate:function(){var d=
this,c=arguments.callee.parent.apply(d,arguments);if("undefined"!==typeof c)return c;d.input.find("input.fb-checkboxtable-checkbox:checkbox:checked").each(function(){var b=$(this).closest("tr[data-id]",d.input),e=b.attr("data-id"),b=b.find("input.fb-checkboxtable-input").val();TypeValidator.isIntRange(b,{min:d.options.minValue,max:d.options.maxValue})||(e="undefined"!==typeof d.options.itemsList[e].text?d.options.itemsList[e].text:d.options.itemsList[e],c=c||""+h(d.options.validateErrorPlaceholders,
{"{FIELD_NAME}":e,"{MIN}":d.options.minValue,"{MAX}":d.options.maxValue})+"<br />")});return c},renderRow:function(d,c,b){d=['<tr data-id="',d,'" >   <td class="fb-checkboxtable-checkboxcol">       <input id="fb-checkboxtable-checkbox-',d,'" class="fb-checkboxtable-checkbox" type="checkbox">   </td>   <td><label for="fb-checkboxtable-checkbox-',d,'">',toa.toHtml(c),'</label></td>   <td class="fb-checkboxtable-inputcol">       <input aria-label="',h(22355),'" class="fb-checkboxtable-input" style="height:13px; display:none" size="3" value="1">   </td></tr>'].join("");
b.append(d)},sortItemsFunc:function(d,c){d=d[1];c=c[1];var b="["==d.charAt(0),e="["==c.charAt(0);return b==e?d<c?-1:1:b<e?1:-1},onCheckbox:function(d){d=$(d.target).closest("tr[data-id]",this.input);this.check(d)},check:function(d){var c=d.find("input.fb-checkboxtable-checkbox:checkbox").get(0).checked,b=d.find("label").html(),b=b.length&&"["==b.charAt(0);d=d.find("input.fb-checkboxtable-input");b&&d.val(100);c&&!b?d.show():d.hide()}});toa.formBuilder.reg("checkboxtable",{defaults:{xtype:"checkboxtableextended",name:"checkboxtableextended",tag:"table",layout:"none",value:!1,minValue:1,maxValue:100,itemsList:!1,valueFildName:"ratio",defaultValue:1,width:"100%",cell:{css:{display:"block",overflow:"auto"}}},render:function(){arguments.callee.parent.apply(this,arguments);this.input.delegate(":checkbox","change",this.onCheckbox.bind(this))},setValue:function(d){var c=this;d=d||{};c.input.find("tr[data-id]").each(function(){var b=$(this),
e=b.find("input.fb-checkboxtable-checkbox:checkbox"),g=b.find("input.fb-checkboxtable-input"),k=b.attr("data-id"),k=d[k];"undefined"!==typeof k?(e.get(0).checked=!0,c.options.valueFildName&&(k=k[c.options.valueFildName]),g.val(k)):(e.get(0).checked=!1,g.val(c.options.defaultValue));c.check(b)});return this},getValue:function(){var d=this,c=[],b=0;d.input.find("input.fb-checkboxtable-checkbox:checkbox:checked").each(function(){var e=$(this).closest("tr[data-id]",d.input),g=e.attr("data-id"),k={};k.work_skill_id=
g;k.ratio=e.find("input.fb-checkboxtable-input").val();"1"===e.find("input.fb-checkboxtable-input-is-group").val()&&(k.isGroup=!0);c[b]=k;b++});return c},validate:function(){var d=this,c=arguments.callee.parent.apply(d,arguments);if("undefined"!==typeof c)return c;d.input.find("input.fb-checkboxtable-checkbox:checkbox:checked").each(function(){var b=$(this).closest("tr[data-id]",d.input),e=b.attr("data-id"),b=b.find("input.fb-checkboxtable-input").val();TypeValidator.isIntRange(b,{min:d.options.minValue,
max:d.options.maxValue})||(c=c||""+h(d.options.validateErrorPlaceholders,{"{FIELD_NAME}":d.options.itemsList[e],"{MIN}":d.options.minValue,"{MAX}":d.options.maxValue})+"<br />")});return c},setItemsList:function(d){var c=[],b;for(b in d)c.push([b,d[b]]);c.sort(this.sortItemsFunc.bind(this));this.renderItemsList(c);this.options.itemsList=d;return this},renderItemsList:function(d){if(!this.input)return!1;this.input.empty();for(var c in d)this.renderRow(d[c],this.input)},getItem:function(d){d+="";for(var c in this.options.itemsList)if(this.options.itemsList[c][0]===
d)return this.options.itemsList[c][1].text;return null},renderRow:function(d,c){var b=['<tr data-id="',d[0],'" >   <td class="fb-checkboxtable-checkboxcol">       <input id="fb-checkboxtable-checkbox-',d[0],'" class="fb-checkboxtable-checkbox" type="checkbox">   </td>   <td><label for="fb-checkboxtable-checkbox-',d[0],'">',toa.toHtml(d[1].text),'</label></td>   <td class="fb-checkboxtable-inputcol">       <input aria-label="',h(22355),'" class="fb-checkboxtable-input" style="height:13px; display:none" size="3" value="1">       <input type="hidden" class="fb-checkboxtable-input-is-group" value="',
d[1].isGroup?1:0,'">   </td></tr>'].join("");c.append(b)},sortItemsFunc:function(d,c){var b="undefined"!==typeof d[1].isGroup,e="undefined"!==typeof c[1].isGroup;return b==e?d[1].text<c[1].text?-1:1:b<e?1:-1},onCheckbox:function(d){d=$(d.target).closest("tr[data-id]",this.input);this.check(d)},check:function(d){var c=d.find("input.fb-checkboxtable-checkbox:checkbox").get(0).checked;d.find("label").html();var b="1"===d.find("input.fb-checkboxtable-input-is-group").val();d=d.find("input.fb-checkboxtable-input");
b&&d.val(100);c&&!b?d.show():d.hide()}});toa.formBuilder.reg("checkboxtable",{possibleItems:[],activeRecords:null,inactiveRecords:null,calendars:[],defaults:{xtype:"checkboxtablewithdates",name:"checkboxtablewithdates",tag:"div",layout:"none",id:"ws_form",value:!1,minValue:1,maxValue:100,itemsList:!1,valueFildName:"ratio",defaultValue:1,width:"100%",cell:{css:{display:"block",overflow:"auto"}}},renderRow:function(d,c){if("undefined"!==typeof this.getItem(d.work_skill_id)){var b=d.inactive?toa.toHtml(this.getItem(d.work_skill_id)+" ("+h(15424)+
")"):toa.toHtml(this.getItem(d.work_skill_id)),e=$(['<tr class="fb-checkboxtablewithdates-row" data-id="',d.work_skill_id,'" >   <td class="fb-checkboxtable-checkboxcol">       <input id="fb-checkboxtable-checkbox-',d.work_skill_id,'" class="fb-checkboxtable-checkbox" type="checkbox" checked="checked">   </td>   <td><label style="display: inline-block; width: 120px; word-wrap: break-word;" for="fb-checkboxtable-checkbox-',d.work_skill_id,'">',b,'</label></td>   <td class="fb-checkboxtable-inputcol">       <input class="fb-checkboxtable-input fb-checkboxtable-input-ratio" style="height: 18px;margin: 5px;" size="3" value="',
d.ratio,'">       <input type="hidden" class="fb-checkboxtable-input-inactive" value="',d.inactive?1:0,'">       <input type="hidden" class="fb-checkboxtable-input-is-group" value="',d.isGroup?1:0,'">   </td>   <td class="fb-checkboxtable-cal-from" style="width: 95px;">       <span class="can_be_hidden">           <input type=hidden class="cal1value ">           <input class="cal1" style="width: 65px;">       </span>   </td>   <td class="fb-checkboxtable-cal-from" style="width: 95px;">       <span class="can_be_hidden">           <input type=hidden class="cal2value ">           <input class="cal2 " style="width: 65px;">       </span>   </td></tr>'].join("")),
g=toa.date.isDateNotArchived(toa.datetime.formatDate("iso",toa.datetime.yesterdayDate()),this.options.timeZoneDiff)?toa.datetime.formatDate("iso",toa.datetime.yesterdayDate()):toa.datetime.formatDate("iso",toa.datetime.currentDate()),b=new toa.view.calendar.Datepicker(e.find(".cal1"),{minDate:g,maxDate:"2999-12-31",name:"date-from"});this.calendars.push(b);b.addListener("changeDate",function(b,c){e.find("input.cal1value").val(c)});g=new toa.view.calendar.Datepicker(e.find(".cal2"),{minDate:g,maxDate:"2999-12-31",
name:"date-to"});this.calendars.push(g);g.addListener("changeDate",function(b,c){e.find("input.cal2value").val(c)});d.start_date&&(b.setDate(d.start_date),e.find(".cal1value").val(d.start_date));d.end_date&&(g.setDate(d.end_date),e.find(".cal2value").val(d.end_date));this.check(e);c.append(e)}},checkToDate:function(d){var c=new Date(this.editDialog.find("date-from").getValue());d=new Date(d);if(c&&d&&c>d)return h(5294)},getValue:function(){var d=this,c=[],b=0;d.input.find("tr").each(function(){var e=
$(this).closest("tr[data-id]",d.input),g=e.attr("data-id");if(!e.find('input[type="checkbox"]').length||e.find('input[type="checkbox"]').length&&e.find("input.fb-checkboxtable-checkbox:checkbox").get(0).checked){var k={};k.work_skill_id=g;k.ratio=e.find("input.fb-checkboxtable-input").val();k.start_date=e.find("input.cal1value").val();"1"===e.find("input.fb-checkboxtable-input-inactive").val()&&(k.isInactive=!0);"1"===e.find("input.fb-checkboxtable-input-is-group").val()&&(k.isGroup=!0);""!=e.find("input.cal2value").val()&&
(k.end_date=e.find("input.cal2value").val());c[b]=k;b++}});return c},renderInactiveRow:function(d,c){if(null!==typeof this.getItem(d.work_skill_id)){var b=r(15421,{"{FROM}":toa.date.formatDate("date",toa.date.parseDate("iso",d.start_date)),"{TO}":toa.date.formatDate("date",toa.date.parseDate("iso",d.end_date))}),b=100!=d.ratio?"("+d.ratio+(d.ratio?", ":" ")+b+")":"("+b+")",b="<label>"+(d.inactive?toa.toHtml(this.getItem(d.work_skill_id)+" ("+h(15424)+")"):toa.toHtml(this.getItem(d.work_skill_id)))+
"</label>"+b,b=$(['<tr data-id="',d.work_skill_id,'" >   <td class="fb-checkboxtable-checkboxcol">&#x25cf; ',b,'<span style="display:none"><input id="fb-checkboxtable-checkbox-',d.work_skill_id,'" class="fb-checkboxtable-checkbox" type="checkbox" checked="checked">       <input class="fb-checkboxtable-input" style="height:13px;" size="3" value="',d.ratio,'">       <input type="hidden" class="fb-checkboxtable-input-inactive" value="',d.inactive?1:0,'">       <input type="hidden" class="fb-checkboxtable-input-is-group" value="',
d.isGroup?1:0,'">   <input class="cal1value" value="',d.start_date?d.start_date:"",'">   <input class="cal2value" value="',d.end_date?d.end_date:"",'"></span>   </td></tr>'].join(""));c.append(b)}},check:function(d){var c=d.find("input.fb-checkboxtable-checkbox:checkbox").get(0).checked;d.find("label").html();var b="1"===d.find("input.fb-checkboxtable-input-is-group").val();d=d.find("input.fb-checkboxtable-input");b&&d.val(100);c&&!b?d.show():d.hide()},setValue:function(d){d=d||{};if(!this.input)return!1;
this.input.empty();this.activeRecords=this.createElement().appendTo(this.input);this.inactiveRecords=this.createElement().css({padding:"6px","line-height":"1.3em",color:"grey"}).appendTo(this.input);for(var c in this.options.itemsList)for(var b in d)d.hasOwnProperty(b)&&this.options.itemsList[c][0]===d[b].work_skill_id+""&&("undefined"===typeof d[b].end_date||toa.date.isDateNotArchived(d[b].end_date,this.options.timeZoneDiff)?this.renderRow(d[b],this.activeRecords):this.renderInactiveRow(d[b],this.inactiveRecords));
return this},setItemsList:function(d){var c=[],b;for(b in d)c.push([b,d[b]]);this.options.itemsList=c;this.options.itemsList.sort(this.sortItemsFunc.bind(this));return this},getItem:function(d){d+="";for(var c in this.options.itemsList)if(this.options.itemsList[c][0]===d)return this.options.itemsList[c][1].text;return null},sortItemsFunc:function(d,c){var b="undefined"!==typeof d[1].isGroup,e="undefined"!==typeof c[1].isGroup;return b==e?d[1].text<c[1].text?-1:1:b<e?-1:1},destroyCalendars:function(){$.each(this.calendars,
function(d,c){c.destroy()})},validate:function(){var d=this,c="";d.input.find("input.fb-checkboxtable-checkbox:checkbox:checked").each(function(){var b=$(this).closest("tr[data-id]",d.input),e=b.attr("data-id"),b=b.find("input.fb-checkboxtable-input").val();TypeValidator.isIntRange(b,{min:d.options.minValue,max:d.options.maxValue})||(c=c||""+h(d.options.validateErrorPlaceholders,{"{FIELD_NAME}":d.getItem(e),"{MIN}":d.options.minValue,"{MAX}":d.options.maxValue})+"<br />")});return c}});toa.createWidget.reg("field",{defaults:{xtype:"multiselect_labeled",defaultLabel:"-",buttonClass:"multiselect-tip-button",tipClass:"multiselect-tip",value:!1,tag:"div"},tipButton:!1,tip:!1,dynamicLabel:!1,multiselect:!1,_init:function(){},renderInput:function(d){arguments.callee.parent.apply(this,arguments);this.input.append(this._generateDynamicLabel(),this._generateEditButton());this.tip=$("<div>",{"class":this.options.tipClass});this.tip.appendTo("body");this.tip.Tip({zIndex:2004,notOutsideElements:["."+
this.options.buttonClass],closable:!0});this._generateMultiselect().renderTo(this.tip);this._generateDynamicLabel()},_toggleMultiselectEvent:function(d,c){this.tip.Tip("isOpen")?this.tip.Tip("hide"):this.tip.Tip("showAt",this.tipButton)},_generateEditButton:function(){return this.tipButton=$("<div>",{"class":this.options.buttonClass,text:h(462)}).button({icons:{primary:"ui-icon-modify"},text:!1}).click(this._toggleMultiselectEvent.bind(this))},_generateDynamicLabel:function(){var d="";!1===this.dynamicLabel&&
(this.dynamicLabel=$("<span>"));if(this.multiselect){var c=this.multiselect.getValue(),b;for(b in c)c[b]&&(d+=this.multiselect.getLabelById(b)+", ");d.length&&(d=d.substr(0,d.length-2))}else d=this.options.defaultLabel;this.dynamicLabel.html(d||this.options.defaultLabel);return this.dynamicLabel},_generateMultiselect:function(){var d=this;d.multiselect=new toa.createWidget({xtype:"checkboxlist",name:"workskills",itemsList:d.options.itemsList,listeners:{change:function(c){d._generateDynamicLabel()}}});
return d.multiselect},getValue:function(){return this.multiselect.getValue()},setValue:function(d){this.multiselect.setValue(d)},destroy:function(){arguments.callee.parent.apply(this,arguments);this.tipButton.remove();this.tip.remove()}});toa.formBuilder.reg("field",{defaults:{xtype:"select",layout:"none",withEmptyOption:!0},_initOptions:function(d){d.items=d.items||[];if(d.options)for(var c in d.options)d.items.push({xtype:"option",value:c,text:d.options[c]});return arguments.callee.parent.apply(this,[d])},addOptions:function(d){this.addItems(d);this.renderChildren(this.input)},setOptions:function(d){var c;this.clear();c=this.options.withEmptyOption?[{xtype:"option",value:"",label:""}]:[];for(var b in d)c.push({xtype:"option",value:b,
text:d[b]});this.addOptions(c)}});toa.formBuilder.reg("field",{defaults:{xtype:"option"},renderInput:function(d){if(this.parent&&this.parent.options.value==this.options.value)var c=this.getOptions(this.options,{attr:{defaultSelected:1,selected:"selected"}});this.input=this.createElement("option",this.formatOptions(c||this.options));this.input.appendTo(d)}});toa.formBuilder.reg("field",{defaults:{xtype:"button",addClass:"toa-button"},formatOptions:function(d){d.html=d.html||d.value;return arguments.callee.parent.apply(this,[d])},createElement:function(d,c){if(!toa.browser.msie)return arguments.callee.parent.apply(this,[d,c]);c||(c=this.formatOptions(this.options));if("submit"===c.type)var b=$('<input type="submit" value="'+(c.html||"&nbsp;")+'" />');else b=$('<button type="button"></button>'),"undefined"!=typeof c.html&&b.html(c.html),"undefined"!=typeof c.text&&
b.text(c.text);b.attr(c.attr||{});b.css(c.css||{});b.bind(c.listeners||{});b.addClass("fb fb-"+(c.xtype||"widget")+" "+(c.addClass||""));b.data("fbwidget",this);b.addClass("fb-"+c.xtype);return b}});toa.formBuilder.reg("button",{defaults:{xtype:"menuButton",tag:"button",items:[]},_itemList:null,_isOpen:!1,_initOptions:function(d){this.callParent(d);this.options.text||(delete this.options.text,this.options.html='<div class="icon-actions">&nbsp;</div>');this.options.menuItems=$.extend({},this.options.items);this.options.items={}},render:function(d){var c=this;d=c.callParent(d);c.moreIcon=$("<div/>").addClass("icon-arrow-down");c.moreIcon.append("&nbsp;");c.input.append(c.moreIcon);c._itemList=
c._createItems(c.options.menuItems);c._itemList.Tip("option","notOutsideElements",c.input);c.input.on("click",function(b){c._isOpen?(c._isOpen=!1,c.input.removeClass("toa-button-opened"),c._itemList.Tip("hide")):(c._isOpen=!0,c.input.addClass("toa-button-opened"),c._itemList.Tip("show",c.input,"bottom","left"));b.stopPropagation()});return d},onClickItem:function(d){d={name:d.name||"",widget:this,eventData:d};this.input.removeClass("toa-button-opened");this._itemList.Tip("hide");this.input.trigger("menuItemClick",
d)},_createItems:function(d){var c=this,b,e,g;b=$("<div/>");b.addClass("toa-dropdown-content");b.Tip({callout:!1,className:"toa-dropdown",minHeight:null,minWidth:null,onHide:function(){c._isOpen=!1;c.input.removeClass("toa-button-opened")}});for(g in d)e=$("<div/>").append(d[g].text),e.addClass("toa-dropdown-item"),d[g].css&&e.css(d[g].css),d[g].label&&e.attr("data-label",d[g].label),e.on("click",c.onClickItem.bind(c,d[g])),e.on("keydown",function(b){if(13===b.keyCode||32==b.keyCode)b.stopPropagation(),
c.onClickItem(d[g]),b.preventDefault()}),b.append(e);return b},destroy:function(){this._itemList.remove();this.callParent()},getButtonByLabel:function(d){return this._itemList.find("[data-label="+d+"]")}});toa.formBuilder.reg("button",{defaults:{xtype:"filterButton",tag:"button",attr:{"aria-haspopup":"true"}},render:function(){var d=arguments.callee.parent.apply(this,arguments);this.input.addClass("fb-button");this.input.html("<span>"+this.input.html()+"</span>");this.canIcon=$("<div/>");this.canIcon.append("&nbsp;");this.input.append(this.canIcon);this.moreIcon=$("<div/>").addClass("icon-arrow-down");this.moreIcon.append("&nbsp;");this.input.append(this.moreIcon);return d},setState:function(d){switch(d){case "closed":this.input.removeClass("toa-button-opened");
break;case "open":this.input.addClass("toa-button-opened");break;case "filtered":this.canIcon.addClass("icon-filter-used");break;case "filterEmpty":this.canIcon.removeClass("icon-filter-used")}},removeState:function(d){switch(d){case "filtered":this.input.removeClass("icon-filter-used")}}});toa.formBuilder.reg("field",{defaults:{xtype:"editlist",name:"editlist",tag:"div"},setValue:function(d){for(var c in d)this.addInput(d[c].id,toa.toHtmlSafe(d[c].name),d[c].value||"",d[c].mandatory||!1,d[c].lang||!1)},reset:function(){this.input.closest("tr.fb-fieldset-row").nextUntil("tr.fb-fieldset-row").remove()},addInput:function(d,c,b,e,g){var k=generate_id();e=e?"*":"&nbsp";this.input.closest("tr.fb-fieldset-row").nextAll("tr.fb-editlist-row").addBack().last().after(['<tr class="fb fb-editlist-row fb-layout-fieldset-row"><td class="fb fb-widget fb-editlist-mandatory"><span class="fb-mandatory">',
"*"===e?'<abbr id="req_'+k+'" class="ofsc-abbr-mandatory" title="'+h(22351)+'">*</abbr>':"&nbsp",'</span></td><td class="fb fb-widget fb-editlist-label"><label id="',k,'">',c,'</label></td><td class="fb fb-widget fb-editlist-input"><input aria-labelledby="req_',k," ",k,'" ',"*"==e?"required":"",g?' lang="'+g+'"':"",' type="text" name="',d,'" value="',toa.toHtml(b),'"></td></tr>'].join(""))},getValue:function(){var d={};this.input.closest("tr.fb-fieldset-row").nextUntil("tr.fb-fieldset-row").each(function(){var c=
$(this).find("input");d[c.attr("name")]=c.val()});return d}});toa.formBuilder.reg("editlist",{defaults:{xtype:"editlistGlossary",name:"editlistGlossary",tag:"div"},setValue:function(d){for(var c in d)this.addInput(d[c].id,d[c].name,d[c].value||"",d[c].default_value||"")},addInput:function(d,c,b,e){var g=this.input.closest("tr.fb-fieldset-row").nextAll("tr.fb-editlist-row").addBack().last(),g=$('<tr class="fb fb-editlist-row"></tr>').insertAfter(g),k=generate_id();g.html(['<td class="fb fb-widget fb-editlist-mandatory"></td><td class="fb fb-widget fb-editlist-label"><label for="',
k,'"><span>',c,'</span></label></td><td class="fb fb-widget fb-editlist-input"><input id="',k,'" type="text" name="',d,'" value="',toa.toHtml(b),'"></td><td>','<input type="button" value="'+h(11923)+'" />',"</td>"].join(""));var l=g.find("input[name="+d+"]");d=g.find("input[type=button]");d.click(function(){l.val(e)});e&&e.length||d.attr("disabled","disabled")}});toa.createWidget.reg("field",{defaults:{xtype:"popupLabel",name:"popupLabel",buttonClass:"multiselect-tip-button",buttonText:toa.glossary({id:15414}),tag:"div",css:{"float":"left",width:"85%"},iconClass:"ui-icon-modify"},render:function(d){var c=this;c.options.html=toa.toHtml(c.options.value);c.options.value="";arguments.callee.parent.apply(c,arguments);c.popupButton=c._generateEditButton().appendTo(d);c.popupButton.click(function(b){c.input.trigger("popup",c,b)})},_generateEditButton:function(){return $("<div>",
{"class":this.options.buttonClass,text:this.options.buttonText,attr:{"aria-label":toa.glossary({id:15414})+"_"+generate_id()}}).button({icons:{primary:this.options.iconClass},text:!1}).on("keydown",function(d){d=d.keyCode||d.which;d!==$.ui.keyCode.ENTER&&d!==$.ui.keyCode.SPACE||$(this).click()})},setValue:function(d){this.input.html(toa.toHtml(d))},getValue:function(){return this.input.html()}});toa.createWidget.reg("field",{defaults:{xtype:"popupLabelWithAdd",name:"popupLabelWithAdd",buttonClass:"multiselect-tip-button",buttonTextEdit:toa.glossary({id:15414}),buttonTextAdd:toa.glossary({id:15415}),tag:"div",css:{"float":"left",width:"250px",padding:"3px 0 3px 6px"},iconClassEdit:"ui-icon-modify",iconClassAdd:"ui-icon-add-workskill"},render:function(d){var c=this;c.options.html=toa.toHtml(c.options.value);c.options.value="";arguments.callee.parent.apply(c,arguments);var b=$("<div>").addClass("worksrill-button-wrapper");
c.popupButtonEdit=c._generateEditButton().appendTo(b);c.popupButtonEdit.click(function(b){c.input.trigger("editPopup",c,b)});c.popupButtonAdd=c._generateAddButton().appendTo(b);c.popupButtonAdd.click(function(b){c.input.trigger("addPopup",c,b)});b.appendTo(d)},hideEditButton:function(){this.popupButtonEdit.hide()},showEditButton:function(){this.popupButtonEdit.show()},_generateEditButton:function(){return $("<div>",{"class":this.options.buttonClass,text:this.options.buttonTextEdit}).button({icons:{primary:this.options.iconClassEdit},
text:!1})},_generateAddButton:function(){return $("<div>",{"class":this.options.buttonClass,text:this.options.buttonTextAdd}).button({icons:{primary:this.options.iconClassAdd},text:!1})},setValue:function(d){this.input.html(d)},getValue:function(){return this.input.html()}});toa.formBuilder.reg("panel",{defaults:{xtype:"panelTitle",tag:"div",layout:"hbox"}});toa.createWidget.reg("panel",{calendar:null,defaults:{xtype:"calendarExtended",name:"calendar",tag:"div",layout:"none",defaultMode:null,modes:[]},_create:function(){arguments.callee.parent.apply(this,arguments);this.calendar=new toa.view.calendar.CalendarExtended(null,{buttonMode:this.options.modes});this.options.today&&this.calendar.setToday(this.options.today)},getLabel:function(){return this.calendar.formatDate(this.calendar.getDate())},setDate:function(d,c){toa.isString(d)||(d=toa.date.formatDate("iso",
d));return c?this.calendar.updateDate(d):this.calendar.setDate(d)},setMaxDate:function(d){this.calendar.updateDate(d)},render:function(d){arguments.callee.parent.apply(this,arguments);this.calendar.renderTo(this.input);this.calendar.setMode(this.options.defaultMode);this.calendar.updateDates(this.options.selectedDates)}});toa.createWidget.reg("panel",{calendar:null,defaults:{xtype:"calendar",name:"calendar",tag:"div",layout:"none"},_create:function(){arguments.callee.parent.apply(this,arguments);this.calendar=new toa.view.calendar.Calendar(null);this.options.today&&this.calendar.setToday(this.options.today)},setDate:function(d,c){toa.isString(d)||(d=toa.date.formatDate("iso",d));return c?this.calendar.updateDate(d):this.calendar.setDate(d)},render:function(d){arguments.callee.parent.apply(this,arguments);this.calendar.renderTo(this.input)}});toa.formBuilder.reg("input",{defaults:{xtype:"simpleCalendar",name:"simpleCalendar",tag:"input",fieldLabel:"",value:""},_create:function(){arguments.callee.parent.apply(this,arguments)},renderMandatory:function(d){var c=this;c.mandatory=c.createElement("input",{attr:{type:"checkbox"}}).appendTo(d);c.mandatory.bind("click",function(b,e){c.checked()?c.enable():c.disable();c.input.trigger("dateUnlock")})},render:function(d){var c=this;arguments.callee.parent.apply(c,arguments);c.inputHidden=$('<input type="hidden" name="'+
c.options.name+'_hidden" value="'+c.options.value+'" />');c.input.css("float","left");c.input.after(c.inputHidden);c.calendar=new toa.view.calendar.Datepicker(c.input,c.options);c.calendar.addListener("change",function(b,e){if(""===c.input.val())c.inputHidden.val("");else try{var d=toa.date.parseDate("date",c.input.val()),k=toa.date.formatDate("iso",d);c.calendar.setDate(k);c.inputHidden.val(k)}catch(l){c.inputHidden.val(c.input.val())}});c.calendar.addListener("changeDate",function(b,e){c.inputHidden.val(e)});
void 0!==c.mandatory?c.checked()?c.enable():c.disable():c.enable()},reset:function(){this.calendar.setDate()},setValue:function(d){d=toa.date.parseDate("date",d);return this.calendar.setDate(toa.date.formatDate("iso",d))},getValue:function(){return this.inputHidden.val()},checked:function(){return this.mandatory.prop("checked")},setChecked:function(){this.mandatory.attr("checked","checked");this.enable()},unsetChecked:function(){this.mandatory.removeAttr("checked");this.disable()},disable:function(){this.calendar.disable();
this.inputHidden.attr("disabled","disabled")},enable:function(){this.calendar.enable();this.inputHidden.removeAttr("disabled")},destroy:function(){this.calendar.destroy()}});toa.formBuilder.reg("field",{defaults:{xtype:"timePicker",name:"timePicker",fieldLabel:"",tag:"div",value:"",minutesStepIncrement:5,format:"H",items:[{xtype:"select",name:"hours",value:"",css:{width:"45%"}},{xtype:"select",name:"minutes",value:"",fieldLabel:":",css:{width:"45%"}}]},_create:function(){arguments.callee.parent.apply(this,arguments)},renderMandatory:function(d){var c=this;c.mandatory=c.createElement("input",{attr:{type:"checkbox"}}).appendTo(d);c.mandatory.bind("click",function(b,e){c.checked()?
c.enable():c.disable();c.input.trigger("timeUnlock")})},render:function(d){arguments.callee.parent.apply(this,arguments);this.disable();for(var c,b=0;24>b;b++){var e=b;c=toa.date.formatDate(this.options.format,new Date(0,0,0,b,0,0));e=(10>e?"0":"")+e;$('<option value="'+e+'">'+c+"</option>").appendTo(this.items[0].input)}for(b=0;60>b;b+=this.options.minutesStepIncrement)e=b,e=(10>e?"0":"")+e,$('<option value="'+e+'">'+e+"</option>").appendTo(this.items[1].input)},renderHours:function(d){var c;this.items[0].input.empty();
for(var b=0;24>b;b++){var e=b;c=toa.date.formatDate(d,new Date(0,0,0,b,0,0));e=(10>e?"0":"")+e;$('<option value="'+e+'">'+c+"</option>").appendTo(this.items[0].input)}},checked:function(){return this.mandatory.prop("checked")},enable:function(){for(var d in this.options.items)this.items[d].input.removeAttr("disabled")},disable:function(){for(var d in this.options.items)this.items[d].input.attr("disabled",!0)},getValue:function(){if(this.checked())return this.items[0].getValue()+":"+this.items[1].getValue()},
setValue:function(d){d=d.split(":");this.items[0].setValue(d[0]);this.items[1].setValue(d[1])},getHours:function(){return this.items[0].getValue()},getMinutes:function(){return this.items[1].getValue()},setChecked:function(){this.mandatory.attr("checked","checked");this.enable()},unsetChecked:function(){this.mandatory.removeAttr("checked");this.disable()}});(function(d){d.widget("toaUi.ConfigGrid",{options:{gridClass:"toa-confgrid",checkbox:!1,actions:!1,cols:!1,pageSize:20,renderPageTo:null,colSwapList:null,page:{from:0,count:0,size:20,total:0,sortBy:"id",sortDir:"ASC",rows:{}},translate:{of:"of",previous:"&lt;&lt;Previous",next:"Next&gt;&gt;",selected:"With {SELECTED_COUNT} selected: ",modify:"Modify"}},_create:function(){var c=this.options,b=this.element;this.isIpad=!1;var e=navigator.userAgent.toLowerCase();if(0<=e.indexOf("iphone")||0<=e.indexOf("ipad"))this.isIpad=
!0;this.footer=d('<div class="'+this.options.gridClass+'-footer" />');this.caption=c.renderPageTo?d(c.renderPageTo):d("<caption/>");this.actions=d("<span/>").hide().addClass(this.options.gridClass+"-actions");this._setPagerEvents();this._setActionEvents();e=d("<thead/>");this.head=d("<tr/>").appendTo(e);this._setHeadEvents();this.body=d("<tbody/>");this._setBodyEvents();this.table=d('<table width="100%" cellspacing="1" cellpadding="2"/>').addClass("oj-table-js ").addClass(this.options.gridClass);
c.renderPageTo||this.table.append(this.caption);this.table.append(e).append(this.body).appendTo(b);this.footer.appendTo(b);this.nameToId={}},_setHeadEvents:function(){var c=this;c.head.delegate("th."+c.options.gridClass+"-checkbox>input:checkbox","change",c.toggleAll.bind(c));c.head.delegate("th[data-sortable=true]","click",function(b){c._handleHeaderActions(b,d(this))});c.head.delegate("th[data-sortable=true]","keydown",function(b){if(13===b.keyCode||32==b.keyCode)b.stopPropagation(),c._handleHeaderActions(b,
d(this)),b.preventDefault()});c.head.delegate("th[data-swap-column=true]","click",function(b){0==d(b.target).closest(".swap-column").length&&(d(".swap-column",this).is(":visible")?d(".swap-column").hide():(d(".swap-column").hide(),d(".swap-column",this).show()));b.stopPropagation();d("body").off("click",c._bodyMousedownHandler).on("click",c._bodyMousedownHandler.bind(c))});c.head.delegate(".swap-column li.enabled","click",function(b){var e=d(b.target).attr("data-id"),g=d(d(b.target).closest("th")[0]).attr("data-id");
c._trigger("onSwapColumn",b,{from:c.page.from,size:c.page.size||c.options.pageSize,swapFrom:g,swapTo:e})})},_handleHeaderActions:function(c,b){var e=b.attr("data-name");this._trigger("onSort",c,{from:this.page.from,size:this.page.size||this.options.pageSize,sortBy:e,sortDir:this.page.sortBy==e?"ASC"==this.page.sortDir?"DESC":"ASC":"ASC"})},_bodyMousedownHandler:function(c){d(".swap-column").hide();d("body").off("click",self._bodyMousedownHandler)},_setBodyEvents:function(){var c=this;c.isIpad&&(c.body.delegate("tr[data-row]",
"mouseover",function(){c.table.find("tr[data-row]").removeClass("hover");c.table.find(".auto-hide").hide()}),d(window).on("resize",function(){c._updateButtonPos(c.table)}));c.body.delegate("tr[data-row]","mouseover focusin",c._showButtons.bind(c));c.body.delegate("tr[data-row]","mouseout",function(b){b=d(this);b.removeClass("hover");b.find(".auto-hide").css({display:"none"})});c.body.delegate("td","click keypress",function(b){if(!d(this).find(".auto-hide").length)return!0;var e=d(this).closest("td[data-col]"),
g=e.attr("data-col"),e=e.parent().attr("data-row");c._trigger("onModifyClick",b,{row:e,col:g});var k=c.options.cols[g].onModifyClick;d.isFunction(k)&&k.apply(this,[b,{row:e,col:g}])});c.body.delegate("td."+c.options.gridClass+"-checkbox>input:checkbox","change",c._checkActions.bind(c))},_setActionEvents:function(){var c=this;c.caption.delegate("span."+c.options.gridClass+"-action","mousedown",function(b){c._handleGroupActions(b,c)});c.caption.delegate("span."+c.options.gridClass+"-action","keydown",
function(b){if(13===b.keyCode||32==b.keyCode)b.stopPropagation(),c._handleGroupActions(b,c),b.preventDefault()})},_handleGroupActions:function(c,b){var e=[];b.body.find("td."+b.options.gridClass+"-checkbox>input:checked").each(function(){e.push(d(this).closest("tr[data-row]").attr("data-row"))});b._trigger("onGroupAction",c,{action:d(c.target).attr("data-action"),items:e})},_setPagerEvents:function(){var c=this;c.footer.delegate("span."+c.options.gridClass+"-page","mousedown",function(b){if(d(this).hasClass("toa-confgrid-active"))return!1;
var e=parseInt(d(this).attr("data-page"),10),g=parseInt(c.page.size||c.options.pageSize,10);c._trigger("onPageChange",b,{from:(e-1)*g,size:g,sortBy:c.page.sortBy,sortDir:c.page.sortDir})})},_init:function(){this.setTitle();this.currentPage=0;this.options.page&&this.setPage(this.options.page)},setTitle:function(){var c=this;c.head.empty();c.options.checkbox&&c.head.append('<th class="'+c.options.gridClass+'-checkbox th_background"><input type=checkbox aria-label="'+h(12033)+'"></th>');c.nameToId={};
d.map(c.options.cols,function(b,e){var g='<span role="button" aria-label="'+b.title+'" class="icon">&nbsp;</span>',k=b.width?' width="'+b.width+'"':"",l=b.sortable?' data-sortable=true tabindex="0" role="button"':"",n=b.swapColumn?" data-swap-column=true aria-haspopup=true ":"",p=b.id?' data-id="'+b.id+'"':"",s=b.headClass?' class="'+b.headClass+'"':"",t=d("<th "+l+p+s+" "+k+'data-name="'+b.name+'" scope="col">'+b.title+g+"</th>");b.items&&0!=b.items.length&&(t=d("<th "+l+n+p+s+" "+k+'data-name="'+
b.name+'" scope="col"><div class="inlineStructure">'+b.title+g+"</div></th>"));n&&t.append(c._setSwapColumns());b.items&&0!=b.items.length&&t.append(c._setTitleItems(b.items));!1===b.visible&&t.hide();c.head.append(t);c.nameToId[b.name]=e})},_setTitleItems:function(c){for(var b=d('<span class="title-items">'),e=0;e<c.length;e++){var g=d(c[e].html);g.on(c[e].events||{});b.append(g)}return b},_setSwapColumns:function(){var c=this.options.colSwapList;return c?(new toa.Template('<div class="swap-column-container"><ul class="swap-column"><%for(var i = 0; i < _swapCols.length; i++) {%><li data-id="<%- _swapCols[i].id %>" class="<%= _swapCols[i].inactive? "disabled": "enabled" %>"><%- _swapCols[i].name %></li><% } %></ul></div>')).compile().apply({_swapCols:c}):
!1},getPageState:function(){return this.page},setPage:function(c){c&&(this.page=c);this._updatePager();this._updateSort();this.body.empty();this.rowCount=0;this.unselectAll();for(var b in this.page.rows)this.addRow(this.page.rows[b]);this.clearMessages()},clearMessages:function(){this.element.find("div.mess-div").remove()},setGroupActionMessage:function(c,b,e){e||this.clearMessages();c='<div class="mess-div">\n                <ul class="'+("error"==b?"error":"info")+'">\n                    <li>'+
c+"</li>\n                </ul>\n            </div>";0<this.element.find("#content_caption_alta").length?this.element.find("#content_caption_alta").after(c):this.element.prepend(c)},updateAttr:function(c){this.element.find(".oj-table-js").attr("aria-label",c)},addRow:function(c){var b=this,e=d('<tr data-row="'+b.rowCount+'"/>');b.options.checkbox&&e.append('<td class="'+b.options.gridClass+'-checkbox"><input aria-label="'+h(8074)+"_"+b.rowCount+'" type=checkbox></td>');b.colIndex=0;d.map(b.options.cols,
function(d,k){b.addCell(e,c,d,k)});0<d(e).find("span.hide-mass-action").length&&d(e).find("input[type=checkbox]").remove();b.rowCount++;b.body.append(e)},addCell:function(c,b,e){if(!1!==e.visible){var g=b[e.name]||"";e.rowHeader?(c=d("<th/>").attr("data-col",this.colIndex).appendTo(c),c.attr("scope","row")):c=d("<td/>").attr("data-col",this.colIndex).appendTo(c);this.colIndex++;e.colClass&&c.addClass(e.colClass);if(d.isFunction(e.format)){if(g=e.format.apply(c,[e,b]),!1===g)return}else if(toa.isString(e.format)){var k=
d.toaUi.ConfigGrid.format[e.format];if(d.isFunction(k)&&(g=k.apply(c,[e,b]),!1===g))return}c.html(g);if(e.modify){c.addClass("modify-cell");g=e.modify;if(d.isFunction(e.modify)&&(g=e.modify.apply(c,[e,b]),!1===g))return;!0===g?c.append('<div role="button" class="modify-icon auto-hide" tabindex="0" data-modify_item_label="'+b.label+'" title="'+this.options.translate.modify+" "+e.title+'">&nbsp;</div>'):d("<button/>").addClass("auto-hide").html(g).appendTo(c)}}},hideCol:function(c){d.isArray(c)||(c=
[c]);for(var b in c){var e=c[b];"undefined"!==typeof this.nameToId[e]&&(this.options.cols[this.nameToId[e]].visible=!1,this.head.find("[data-name="+e+"]").hide())}},showCol:function(c){d.isArray(c)||(c=[c]);for(var b in c){var e=c[b];"undefined"!==typeof this.nameToId[e]&&(this.options.cols[this.nameToId[e]].visible=!0,this.head.find("[data-name="+e+"]").show())}},_updateSort:function(){var c=this;c.head.find("th[data-name]>span.icon").each(function(b){b=d(this);b.removeClass(c.options.gridClass+
"-sort-down "+c.options.gridClass+"-sort-up");b.parent().removeAttr("aria-sort");if(b.parent().attr("data-name")==c.page.sortBy){var e="DESC"==c.page.sortDir?c.options.gridClass+"-sort-up":c.options.gridClass+"-sort-down",g="DESC"==c.page.sortDir?"descending":"ascending";b.parent().attr("aria-sort",g);b.addClass(e);b.attr("aria-label","DESC"==c.page.sortDir?h(18138):h(18137))}})},_updatePager:function(){var c='<span class="'+this.options.gridClass+'-pager">'+this._getPager(this.page)+'</span><span class="'+
this.options.gridClass+'-pagelabel">'+this._getPageLabel(this.page)+"</span>";this.caption.html("");this.footer.html(c)},_getPager:function(){var c=this.page.size||this.options.pageSize,b=Math.ceil(this.page.total/c);if(2>b)return"";this.currentPage=c=parseInt(this.page.from/c,10)+1;var e=1<c?this._getPagerPage(c-1,!1,this.options.translate.previous):"";if(5<c)var d=this._getPagerPage(1)+" ... ",k=c-3;else d=" ",k=1;if(5<b-c)var l="  ... "+this._getPagerPage(b),n=c+3;else l=" ",n=b;e+=d;for(d=k;d<=
n;d++)e+=this._getPagerPage(d,d==c);e+=l;c!=b&&(e+=this._getPagerPage(c+1,!1,this.options.translate.next));return e},_getPagerPage:function(c,b,e){return" <span "+(b?"":'role="link"')+' class="'+this.options.gridClass+"-page"+(b?" "+this.options.gridClass+"-active":"")+'" data-page='+c+" >"+(e||c)+"</span> "},_getPageLabel:function(c){return 0==this.page.count?"":this.page.from+1+"-"+(this.page.from+this.page.count)+" "+this.options.translate.of+" "+this.page.total},toggleAll:function(c){c.target.checked?
this.selectAll():this.unselectAll()},selectAll:function(){this.body.find("td."+this.options.gridClass+"-checkbox>input:checkbox").each(function(){this.checked=!0});this._checkActions()},unselectAll:function(){this.body.find("td."+this.options.gridClass+"-checkbox>input:checkbox").each(function(){this.checked=!1});this._checkActions()},_checkActions:function(){var c=this.body.find("td."+this.options.gridClass+"-checkbox>input:checked").length;c?this._updateActions(c):(c=this.head.find("td."+this.options.gridClass+
"-checkbox>input:checkbox"),c.length&&(c[0].checked=!1),this._updatePager())},_showButtons:function(c){c=d(c.target).closest("tr","table");this.table.find("tr[data-row]").removeClass("hover");this._updateButtonPos(this.table,!1);c.addClass("hover");this._updateButtonPos(c,!0)},_updateButtonPos:function(c,b){var e=this;c.find(".auto-hide").each(function(){var c=d(this),k=c.closest("td"),l=k.position(),k={left:l.left+(k.innerWidth()-c.outerWidth())-2,top:l.top+e.element.scrollTop()+(k.innerHeight()-
c.outerHeight())/2};k.display=b?"block":"none";c.css(k)})},_updateActions:function(c){var b=this,e='<span class="'+b.options.gridClass+'-actions"><span class="icon '+b.options.gridClass+'-with">&nbsp;</span>'+b.options.translate.selected.replace("{SELECTED_COUNT}",c);d.map(b.options.actions,function(c,d){e+=b._getAction(c)});e+="</span>";b.footer.html("");b.caption.html(e)},_getAction:function(c){return'&nbsp;&nbsp;<span role="link" class="'+this.options.gridClass+'-action" data-action="'+c.name+
'" tabindex="0">'+(c.title||c.name)+"</span>"},_setOption:function(c,b){d.Widget.prototype._setOption.apply(this,arguments);switch(c){case "cols":this._init()}},_destroy:function(){this.footer.remove();this.footer=null;this.actions.remove();this.actions=null;this.caption.remove();this.caption=null;this.head.remove();this.head=null;this.body.remove();this.body=null;this.table.remove();this.table=null;this.element.remove();this.options=this.page=this.nameToId=this.element=null;for(var c in this.bindings)this.bindings[c].remove(),
delete this.bindings[c];this.bindings=null}});d.toaUi.ConfigGrid.format={}})(jQuery);(function(d){d.widget("toaUi.ScrolledGrid",d.toaUi.ConfigGrid,{_updateButtonPos:function(c,b){var e=this.element.parent().scrollTop();c.find(".auto-hide").each(function(){var c=d(this),k=c.closest("td"),l=k.position(),k={left:l.left+(k.innerWidth()-c.outerWidth())-2,top:l.top+e+(k.innerHeight()-c.outerHeight())/2};b&&(k.display="block");c.css(k)})},showEmptyRow:function(c){var b=d('<tr data-row="'+this.rowCount+'"/>');this.colIndex=1;d('<td data-cell="'+this.colIndex+'"/>').attr("colspan",this.options.cols.length+
this.options.actions.length).addClass("cell-center").text(c).appendTo(b);this.rowCount++;this.body.append(b);return b}})})(jQuery);toa.ns("$.toaUi.ConfigGrid.format.status",function(d,c){var b="",e="";"string"===typeof c[d.name]?(b="active"==c[d.name]?"green":"red",e="active"==c[d.name]?h(30):h(31)):(b=c[d.name]?"green":"red",e=c[d.name]?h(30):h(31));return'<span style="display:inline-block" role="img" tabindex="0" aria-label="'+e+'" class="'+b+'">&nbsp;</span>'});toa.ns("$.toaUi.ConfigGrid.format.locked",function(d,c){return'<span style="display:inline-block" class="'+("0000-00-00 00:00:00"==c[d.name]?"statusUnlocked":"statusLocked")+'">&nbsp;</span>'});toa.ns("$.toaUi.ConfigGrid.format.join",function(d,c){var b=[],e=c[d.name],g;for(g in e)b.push(e[g].name||e[g]);e="; ";"string"===typeof d.joinSeparator&&(e=d.joinSeparator);return toa.toHtml(b.join(e))});toa.ns("toa.controllers.config.BaseConfigScreen",function(d,c){var b=d.Controller;return d.define(b,function(){this._create.apply(this,arguments)},{defaultOptions:{titleLabel:"Configuration",entityName:"entity",itemNameField:"name",itemIdField:"id",serverControllerName:"Configcontroller",defautlEditDialogValue:{},securityModuleLabel:"",backButtonLabel:"company_settings_configuration",searchPlaceholder:"Search",page:{from:0,size:20,sortBy:"name",sortDir:"ASC",mess:null}},generateElement:function(b){this.parentDiv=
c('<div class="toa-panel-content jet-css-only" id="'+b+'"><div class="sub_content"><div id="inner_content"><div class="jet-css-only"><div class="jet-css-only-page-content"><div class="html"></div></div></div></div></div><div id="footer" class="footer"></div></div>');this.gridDiv=this.parentDiv.find(".html");this.headerDiv=this.parentDiv.find("#inner_content");this.parentDiv.find("#footer").html(d.toHtml(this.sandbox.model("companySettings").settings.copyright))},initTranslations:function(){},toString:function(){return this.sandbox.name||
"config.Base controller"},_create:function(c){if(!c.options||!c.options.content||!c.options.title)throw"There is no content or title in options";var d=this;b.prototype._create.call(this,c);d._init();d.sandbox.bind("global.interface.refresh",function(b,c){if(c.manual)d.onChange(b)},d);d.resume(c.options)},_initOptions:function(b){this.options=c.extend({},this.defaultOptions,b||{});this.options.itemNameField=this.options.itemNameField||"name"},_init:function(b){this.initTranslations();this._initOptions(b);
this._createGridDiv();this._initGrid();this._initEditDialog()},_createGridDiv:function(){this.gridDiv=c("<div/>");var b=this.gridDiv.attr("id");"undefined"!==typeof b&&!1!==b||this.gridDiv.attr("id",this.options.securityModuleLabel)},_createCaption:function(){var b=this.headerDiv||this.gridDiv;this.capt=c("<div/>",{id:"content_caption_alta"}).prependTo(b);this.panelTitle=d.view.control.create({xtype:"PanelTitleAlta",resourceTreeButton:!1,calendar:!1,filter:!1,backButton:!0,headerResponsive:_DATA.page_label,
backButtonIcon:"",backButtonLabel:_DATA.glossary.action_links[this.options.backButtonLabel],backButtonHint:h(16257),titleText:this.options.titleLabel,listeners:{backButtonClick:this.navigateToScreen.bind(this,this.options.backButtonLabel)}});this.panelTitle.render((this.parentDiv||this.gridDiv).find("#content_caption_alta"));this.searchBox=d.view.control.create({xtype:"SearchBox",placeholder:this.options.searchPlaceholder||"",listeners:{searchCleared:function(){this.searchHandler("")}.bind(this),
search:function(b,c){this.searchHandler(c.key)}.bind(this)}});this.searchBox.render(b.find("#content_caption_alta div.search"));b.find("#content_caption_alta div.search").removeClass("toa-hidden")},addBackButton:function(b){b=b||"company_settings_configuration";d.view.control.create({xtype:"Button",label:h(1960),name:"backButton",listeners:{click:this.navigateToScreen.bind(this,b)}}).render(this.capt.find("div.backButton").empty())},navigateToScreen:function(b){"company_settings_configuration"===
b?(this.suspend(),$app.navigation().redirect("company_settings_configuration")):d.app.trigger("layout.menu.click",{label:b,url:"",name:_DATA.glossary.action_links[b],params:{}})},setTitle:function(b){c("#config-screen-title").text(b)},searchHandler:function(b){this.searchKey=b;this._searchKeyChanged=!0;this.onChange("internal.search")},_createCaptionControls:function(){var b,g;b=this.getCaptionActionsDescription();this.capt.find(".toa-button-panel").remove();var k=c("<div/>").addClass("toa-button-panel"),
l;for(l in b)g=c('<button class="toa-button" >'+b[l].title+"</button>"),g.attr(b[l].attributes||{}),g.bind(b[l].listeners||{}),k.append(g);b=c('[data-menu-container="'+_DATA.page_label+'-menu"]').last().find(".toa-view-control-panel-toolbar");d.currentInterface===INTERFACE.MOBILITY&&c(window).width()<=RESPONSIVE_WIDTH.DESKTOP&&0<b.length?(b.empty(),b.append(k)):this.capt.find(".toa-view-control-panel-toolbar").append(k)},_initGrid:function(){this.gridDiv.ConfigGrid({checkbox:!!this.getGroupActionsDescription(),
actions:this.getGroupActionsDescription(),pageSize:this.gridPageSize||20,translate:{of:h(1752),previous:h(463),next:h(464),selected:h(8548),modify:h(462)},cols:this.getColumnsDescription(),onPageChange:this.onChange.bind(this),colSwapList:this.getColumnSwapList(),onSwapColumn:this.onChange.bind(this),onSort:this.onChange.bind(this),onGroupAction:this.onGroupAction.bind(this),onModifyClick:this.onModifyClick.bind(this)})},_initGridPageState:function(){this.gridDiv.ConfigGrid({page:this.options.page||
this.defaultOptions.page})},_initEditDialog:function(){var b={xtype:"dialog",title:"Edit",layout:"vbox",listeners:{ok:this.onSave.bind(this)},jqdialog:{closeText:h(18250)},bottomPanel:{items:[{},{value:h(6413)},{value:h(12)}]},items:[{xtype:"form",name:"editform",layout:"fieldset",items:this.getEditDialogFieldsDescription()}]};"function"===typeof this.modifyEditDialogDescription&&this.modifyEditDialogDescription(b);this.editDialog=d.formBuilder(b);this.editDialog.renderTo(this.gridDiv)},getCaptionActionsDescription:function(){return 2===
this.options.access?[{title:h(1954),listeners:{click:this.addNew.bind(this)}}]:!1},getGroupActionsDescription:function(){return 2==this.options.access?[{name:"delete",title:h(1201)},{name:"activate",title:h(10513)},{name:"deactivate",title:h(10514)}]:!1},getColumnSwapList:function(){return null},getColumnsDescription:function(){return[{name:"id",title:"ID",colClass:"cell-left",width:"1%",sortable:!0},{name:this.options.itemNameField,title:"Name",colClass:"cell-center",modify:!0,sortable:!0}]},getKeyField:function(){return this.options.itemIdField||
"id"},getEditDialogFieldsDescription:function(){return[{xtype:"hidden",name:"id",value:0},{xtype:"input",name:this.options.itemNameField,fieldLabel:"Name",allowBlank:!1,vtype:"min3symbol"},{xtype:"input",name:"label",fieldLabel:"Label",allowBlank:!1,vtype:"min3symbol"},{xtype:"checkbox",name:"status",fieldLabel:"Active",value:!0}]},requestParamFilter:function(b){b||(b=this.gridDiv.ConfigGrid("getPageState"),b={from:b.from,size:b.size,sortBy:b.sortBy,sortDir:b.sortDir});b.search=this.searchKey||"";
return b},onModifyClick:function(b,c){this.gridDiv.ConfigGrid("option","cols")[c.col].name===this.options.itemNameField&&this.edit(c.row)},onChange:function(b,c){c=this.requestParamFilter(c);c.company=this.sandbox.options.company;this._searchKeyChanged&&(c.from=0,this._searchKeyChanged=!1);this.sandbox.trigger("global.data.get",{controller:this.options.serverControllerName,method:"list",params:c,responseHandler:this.onUpdate.bind(this)})},onUpdate:function(b,c){c.page.access&&(this.options.access=
c.page.access);this._createCaptionControls();this._initGrid();this._initEditDialog();c.action_inline&&c.action_inline.length&&this.setTitle(c.action_inline);c.page&&(this._initGridPageState(),this.gridDiv.ConfigGrid("setPage",c.page));this.gridDiv.ConfigGrid("clearMessages");this.options.mess&&(this.gridDiv.ConfigGrid("setGroupActionMessage",this.options.mess.text,this.options.mess.type,!0),this.options.mess=null);c.success&&1!=c.success&&this.gridDiv.ConfigGrid("setGroupActionMessage",c.success,
"success",!0);c.error&&this.gridDiv.ConfigGrid("setGroupActionMessage",c.error,"error",!0);app.focusToTheLastSelectedElement&&app.focusToTheLastSelectedElement()},onGroupAction:function(b,c){var k=c.items.length;if("delete"==c.action)d.ui.Confirm({text:h(11843,{"{COUNT}":k,"{NAME}":this.defaultOptions.entityName}),acceptButtonHandler:function(){this.onGroupActionDo(b,c)}.bind(this)});else if("deactivate"==c.action)d.ui.Confirm({text:h(11845,{"{COUNT}":k,"{NAME}":this.defaultOptions.entityName}),acceptButtonHandler:function(){this.onGroupActionDo(b,
c)}.bind(this)});else this.onGroupActionDo(b,c)},onGroupActionDo:function(b,c){var d={},l;for(l in c.items)d[l]=this.rowByRowNum(c.items[l])[this.getKeyField()];l={};l[this.getKeyField()]=d;l.company=this.sandbox.options.company;var n=this;this.sandbox.trigger("global.data.get",{controller:this.options.serverControllerName,method:c.action,params:l,responseHandler:function(b,c){c.success?(n.options.mess={text:c.success,type:"success"},n.onChange()):n.gridDiv.ConfigGrid("setGroupActionMessage",c.error,
"error")}})},onSave:function(b){var c=this;b=c.editDialog.forAll("validate");c.editDialog.setErrors(b)||(b=c.editDialog.forAll("getValue"),b.company=c.sandbox.options.company,c.sandbox.trigger("global.data.get",{controller:c.options.serverControllerName,method:"save",params:b,responseHandler:function(b,e){e.success?(c.editDialog.close(),c.onChange()):c.editDialog.setError(e.error||"Internal error")}}))},suspend:function(b){this.requestHolder&&this.requestHolder.readyState&&1===this.requestHolder.readyState&&
this.requestHolder.abort();this.panelTitle&&(this.panelTitle.destroy(),this.panelTitle=null);this.options&&this.options.title&&(this.options.title.remove(),this.options.title=null);this.title&&(this.title.remove(),this.title=null);this.gridDiv&&(this.gridDiv.remove(),this.gridDiv=null);this.parentDiv&&(this.parentDiv.remove(),this.parentDiv=null);this.headerDiv&&(this.headerDiv.remove(),this.headerDiv=null);this.searchBox&&(this.searchBox.destroy(),this.searchBox=null);this.editDialog&&(this.editDialog.destroy(),
this.editDialog=null);this.capt&&(this.capt.remove(),this.capt=null)},resume:function(b){this._init(this.sandbox.options);this.sandbox.trigger("layout.tabs.set",{tabs:0,show:0});var c=this.sandbox.options;this.content=c.content=b.content;this.title=c.title=b.title;this._createCaption();this.gridDiv&&(b.content.append(b.title).append(this.parentDiv||this.gridDiv),b.content.attr({"data-title":_DATA.page_label}),this.searchBox.setOption("value",this.searchKey),this.onChange("internal.resume"))},rowByRowNum:function(b){return this.gridDiv.ConfigGrid("getPageState").rows[b]},
addNew:function(){this.options.addDialogTitle||(this.options.addDialogTitle="Add "+this.options.entityName);this.editDialog.setTitle(this.options.addDialogTitle);this.updateForm(this.options.defautlEditDialogValue)},edit:function(b){this.options.editDialogTitle||(this.options.editDialogTitle="Edit "+this.options.entityName);this.editDialog.setTitle(this.options.editDialogTitle+': "'+this.rowByRowNum(b)[this.options.itemNameField]+'"');this.updateForm(this.rowByRowNum(b))},updateForm:function(b){this.editDialog.reset();
this.editDialog.forAll("reset");this.editDialog.open();this.editDialog.setValues(b)}},{})}(toa,$));(function(d){var c=d.Controller;d.controllers.AssignHint=d.define(c,function(){this.delay=800;this.hint=this.timeout=null;this.blocked=!1;this.state=1;this.cacheLifeTime=1E4;this.lastCacheUpdate=0;this._create.apply(this,arguments)},{toString:function(){return"Activity/provider/user/inventory hint controller"},_create:function(b){c.prototype._create.call(this,b);this.blocked=!1;this.hint=$("<div/>");this.hintTipDisabled=[];this.hint.Tip({minWidth:250,minHeight:50,className:"toa-hint-tip  toa-hint",
closable:!0,closeOnOutsideClick:!0,heightFollowContent:!0,onHide:function(){this.state=1}.bind(this)});this.sandbox.bind({"global.hint.assign":this.assign,"global.hint.show":this.show,"global.hint.hide":this.hide,"global.hint.block":this.block,"global.hint.unblock":this.unblock,"global.hint.setHintTip":this.setHintTip})},assign:function(b,c){if(c&&c.elements){var d=!1;"undefined"!==typeof c.disableHover&&(d=!0);for(var k=0;k<c.elements.length;k++){var l=$(c.elements[k]),n=$.extend({aid:l.attr("aid"),
pid:l.attr("pid"),uid:l.attr("uid"),invid:l.attr("data-inventory-id"),date:l.attr("data-date"),offset:l.attr("data-offset"),limit:l.attr("data-limit"),show_links:[],add_links:[],context:c.context||null,location:c.location||"topActivitiesPanel",isLockShow:function(){return!1}},c);!d&&l.delegate("[aid],[pid],[uid],[data-inventory-id], [data-on-call], [data-travel-estimation-alert]","mouseover",n,this.onHover.bind(this));l.delegate("[aid],[pid],[uid],[data-inventory-id],  [data-on-call], [data-travel-estimation-alert]",
"click keypress",n,this.onClick.bind(this));!d&&l.delegate("[aid]","dblclick keypress",n,this.onDblClick.bind(this))}}},show:function(b,c,g){if(c.target&&c.html){c.closable&&c.html&&c.html==h(8074)&&(c.html="");var k=this;k.hint.html(c.html||"");c.overflow&&k.hint.css&&k.hint.css("overflow",c.overflow);"multi_activities"===c.target.data("type")&&(g.hint=k.hint,k.hint.off("click","[aid]"),k.hint.delegate("[aid]","click",g,this.onMultiActivityClick.bind(this,c)),k.hint.off("mousedown touchstart",".toaGantt-tb"),
k.hint.delegate(".toaGantt-tb","mousedown touchstart",d.helper.activity.makeDraggable.bind(this)));!0===c.useEndOfSection&&k.hint.find(".toa-hint-section-end").nextAll(".toa-hint-field").remove();k.state=c.closable?3:2;k.hint.Tip("option","callout",{side:"top",position:15});g&&g.location&&("topActivitiesPanel"===g.location||"bottomActivitiesPanel"===g.location)&&k.hint.Tip("option","calculateViewSpecificAnchorOptions",function(b,c,e,d){c={container:{width:0,height:0},offset:{top:0,left:0},anchor:{width:0,
shiftWidth:0,height:0}};if(b&&b.length&&e&&e.length){var g=e[0].getBoundingClientRect();c.offset.top=g.top;c.offset.left=g.left;"g"===e[0].tagName?(c.anchor.width=g.width,c.anchor.height=g.height):(c.anchor.width=e.outerWidth(),c.anchor.height=e.outerHeight());c.container.width=b.outerWidth();c.container.height=b.outerHeight();g=e.closest(".ui-droppable");if(g.length){b=g.offset();var g=g.outerWidth(),g=b.left+g,k=c.offset.left+c.anchor.width,l=0;e=e.find(":first-child");("bottom"===d||"top"===d)&&
e.length&&e.hasClass("toaGantt-tb-travel")&&(l=e.outerWidth());k>g?(c.anchor.width=g-c.offset.left,c.offset.left+l>=g&&(l=0)):c.offset.left<b.left&&(l=l-b.left+c.offset.left||0,c.offset.left=b.left,c.anchor.width=k-b.left);c.offset.left+=l;c.anchor.width-=l}}return c});k.hint.Tip("option","closable",c.closable);k.hint.Tip("option","notOutsideElements",[c.target]);k.hint.Tip("option","heightFollowContent",!0);_DATA.is_mobility_app&&(k.hint.Tip("option","className","toa-hint-tip  toa-hint resource_hint_tip_container"),
k.hint.Tip("option","closable",!1));k.isHintTipDisabled(g.location)&&!c.html.includes("hint-activity")||k.hint.Tip("showAt",$(c.target));if(c.closable){b=c.target.data("actions")||[];var l=c.target.data("addActions")||[],n=!1;_DATA.is_mobility_app?(b=this.processActionDeleteResourceFromGroup(b,c),c.target.attr("par_date")&&(g.date=c.target.attr("par_date")),n=$app.model().community().isAuthorized(),$(".toa-hint-resource-action-header .toa-resource-hint-actions-bar").removeClass("toa-resource-hint-actions-bar-hide"),
b&&(g.getDate&&g.getDate(g.location)||"undefined"!==typeof c.target.attr("aid")||"undefined"!==typeof c.target.attr("data-inventory-id"))?(hintWidth=(hintContainerWidth=$(".resource_hint_tip_container").width())?hintContainerWidth:k.hint.width(),k.hint.append(k.createActions(b.concat(l),hintWidth,g).addClass("hint_links_mobility"))):l&&k.hint.append(k.createActions(l,k.hint.width(),g).addClass("hint_links_mobility"))):(b&&(g.getDate&&g.getDate()||"undefined"!==typeof c.target.attr("aid")||"undefined"!==
typeof c.target.attr("data-inventory-id"))&&k.hint.append(k.createActions(b,k.hint.width(),g).addClass("hint_links")),l&&k.hint.append(k.createActions(l,k.hint.width(),g).addClass("hint_addlinks")),n=d.community&&d.community.transport);if(n)for(l=0;l<b.length;l++)b[l].event&&"sn.chat.create"===b[l].event&&b[l].params&&b[l].params.address&&(_DATA.is_mobility_app||d.app.model("Contacts").requestContactWithAddress(b[l].params.address,{success:function(b){k.hint&&k.hint.is(":visible")&&(k.hint.find(".start-chat-link").show(),
k.hint.Tip("showAt",$(c.target)))}}))}l=k.hint;b=g.location;k.pid=c.target.attr("pid");if(k.isHintTipDisabled(b)&&"undefined"!==typeof g.disableHover&&g.disableHover&&!g.activitySearchHint){var l=$("<div/>").addClass("toa-resource-popUp").append(l),n=c.target.data("hint_resource"),p=k.hint.Tip("getContainer"),s=k.hint.find(".toa-hint-resource-action-header");d.app.trigger("hang.tree.resourcePopUp",{content:l,title:s&&s.length?s:n,container:p,screenName:b})}else k.hint.Tip("getContainer").append(l),
k.hint.Tip("option","callout",{side:"top",position:15}),k.hint.Tip("showAt",$(c.target));_DATA.is_mobility_app&&(l=c.target.data("hint_uid"),n=c.target.data("hint_ulogin"),k.hint.find(".start-chat-link").hide(),l&&n&&k.checkCommunityAccess(l,n),$("a.community").on("click",k.startChat.bind(k,n,b,g)),$("a.info").on("click",k.goToResourceInfo.bind(k,g)),$("a.route").on("click",k.goToRoute.bind(k,g)),$("a.add-to-group").on("click",k.openAddToGroupPopup.bind(k,g)),$("span.resource_calendar").on("click",
k.goToResourceCalendar.bind(k,g)),$("span.resource_work_zones").on("click",k.goToResourceWorkZones.bind(k,g)),$("span.resource_locations").on("click",k.goToResourceLocations.bind(k,g)),$("span.resource_work_skills").on("click",k.goToResourceWorkSkills.bind(k,g)),$("span.resource_inventory").on("click",k.goToResourceInventory.bind(k,g)))}},processActionDeleteResourceFromGroup:function(b,c){var d=c.target.data("group-id")||0;$.each(b,function(c,e){e&&"del_from_group"===e.label&&(d?"undefined"!==typeof e.params&&
(b[c].params.gid=d):b.splice(c,1))});return b},isHintTipDisabled:function(b){return _DATA.is_mobility_app&&this.hintTipDisabled[b]&&this.hintTipDisabled[b].showHint},checkCommunityAccess:function(b,c){var d=$app.model().communityService().getLoginForCommunity(c);$app.model().communityService().communityContact().searchByAddress(d,1).then(function(c){c.total&&$app.model().user().getId()!==b?this.showChatIcon():this.hideChatIcon()}.bind(this)).catch(function(b){}.bind(this))},showChatIcon:function(){$("a.community").removeClass("community-hide");
this.hint.find(".start-chat-link").show();this.hint.find(".hint-resource-name").addClass("community-show")},hideChatIcon:function(){$("a.community").addClass("community-hide");this.hint.find(".start-chat-link").hide();this.hint.find(".hint-resource-name").removeClass("community-show")},startChat:function(b,c,g,k){g&&g.stopPropagation&&g.stopPropagation();b=$app.model().communityService().getLoginForCommunity(b);this.sandbox.trigger("sn.chat.create",{address:b});this.isHintTipDisabled(c)&&d.app.trigger("hang.tree.hide",
{screenName:c});this.hide();k&&k.context&&k.context.popup&&(k.context.popup.hide(),k.context._sandbox.trigger("routing.run.popup.has.been.closed"))},logActionLinkEvents:function(b){(b||$app.eventLoggingService)&&$app.eventLoggingService().pushEvent(new app.eventLogging.EventLogging(app.eventLogging.EventLoggingConstants.EVENT_RESOURCE_HINT_ACTION_LINK,{p:b}))},goToResourceInfo:function(b){this.pid&&(this.logActionLinkEvents("r"),$app.navigation().redirect("resource-info/"+this.pid),b&&b.context&&
b.context.popup&&(b.context.popup.hide(),b.context._sandbox.trigger("routing.run.popup.has.been.closed")))},goToResourceCalendar:function(b){this.pid&&(this.logActionLinkEvents("rc"),$app.navigation().redirect("resource-calendar/"+this.pid),b&&b.context&&b.context.popup&&(b.context.popup.hide(),b.context._sandbox.trigger("routing.run.popup.has.been.closed")))},goToResourceWorkZones:function(b){this.pid&&(this.logActionLinkEvents("rz"),$app.navigation().redirect("resource-work-zones/"+this.pid),b&&
b.context&&b.context.popup&&(b.context.popup.hide(),b.context._sandbox.trigger("routing.run.popup.has.been.closed")))},goToResourceLocations:function(b){this.pid&&(this.logActionLinkEvents("rl"),$app.navigation().redirect("resource-locations/"+this.pid),b&&b.context&&b.context.popup&&(b.context.popup.hide(),b.context._sandbox.trigger("routing.run.popup.has.been.closed")))},goToResourceWorkSkills:function(b){this.pid&&(this.logActionLinkEvents("rs"),$app.navigation().redirect("resource-work-skills/"+
this.pid),b&&b.context&&b.context.popup&&(b.context.popup.hide(),b.context._sandbox.trigger("routing.run.popup.has.been.closed")))},goToResourceInventory:function(b){this.pid&&(this.logActionLinkEvents("ri"),$app.navigation().redirect($app.model().urlService().generateUrl("#grid/inventory?no-date=true&__pid=")+this.pid),b&&b.context&&b.context.popup&&(b.context.popup.hide(),b.context._sandbox.trigger("routing.run.popup.has.been.closed")))},getRouteDate:function(b){if((b=b&&b.getDate&&b.getDate()||
null)&&b!==d.date.DAY_WITHOUT_DATE&&$app.model().switchDate().getState().isValidDate(d.date.parseDate("iso",b)))return b;b=d.app.model("companySettings").settings.user.tz_diff;return d.date.formatDate("iso",d.date.currentDate(b))},goToRoute:function(b){if(this.pid){var c=$app.model().providerService(),d=$app.storage();c.goToProviderBusinessDay(this.pid,this.getRouteDate(b)).then(function(b){d.removeMetaData("a_teamid");d.removeMetaData("providerList");d.setMetaData("pname",c.getCurrentProvider().get("pname"));
d.setMetaData("holdState",{activity:{},inventory:{},request:{}});b.delta&&$app.controller().redirect("#"+app.context.getResourceHomeScreen(),!0)}.bind(this)).catch(function(b){$app.errorHandler().handleErrorEvent(b)});this.hide();b&&b.context&&b.context.popup&&(b.context.popup.hide(),b.context._sandbox.trigger("routing.run.popup.has.been.closed"))}},openAddToGroupPopup:function(b){this.pid&&(this.hide(),require("jbf/components/dialogs/resource-group-dialog/resource-group-dialog").invoke(this.pid).then(function(){var b=
{trees:{}};b.trees[TOP_PANEL_MAIN_TREE]={};b.trees[BOTTOM_PANEL_MAIN_TREE]={};d.app.trigger("global.data.get",{controller:"Resourcegroups",method:"reloadGroup",params:b,responseHandler:function(b,c){}.bind(this)})}.bind(this)))},getHeader:function(b){return b.data("short_hint")!==h(8074)&&b.data("header")?b.data("header"):""},showShort:function(b,c,d){var k=this.getHeader(b)+b.data("short_hint"),k=$("<div>").append(k);k.find("#activityMap").remove();k=k.html();b.data("short_hint")&&this.show("interganl",
{target:b,html:k||"",closable:!1,useEndOfSection:d||!1,overflow:"hidden"},c)},getShortHint:function(b){if(d.currentInterface===INTERFACE.MOBILITY){if(b.data("short_hint")===h(8074))return b.data("header");if(""===b.data("detailed_hint"))return b.data("header")+b.data("short_hint")}return b.data("short_hint")},showDetailed:function(b,c){clearTimeout(this.timeout);var d=(this.getShortHint(b)||"")+(b.data("detailed_hint")||"");this.show("interganl",{target:b,html:d,closable:!0,overflow:"auto"},c);this.renderMap(b)},
showGroupHint:function(b,c){var d=this;clearTimeout(d.timeout);var k=b.parent().parent().data("group-id"),l=_DATA.resource_groups.groups_list[k]||{name:b.parent().find(".rtl-prov-name").text()},n=require("jbf/core/api-layer"),p=require("jbf/app/transports/url-builders/module-action-url-builder");n.requireSync("api-app",1).getTransport().send(new p("managedgroup","getDescription"),{groupManagement:JSON.stringify({id:k})}).then(function(n){var p=n.getContent()&&n.getContent().groupManagement||{};n=
[{event:"resourceGroup.delete",name:h(224704),params:{gid:k,currentName:l.name}},{event:"resourceGroup.edit",name:h(20025),params:{gid:k,currentName:l.name}}];d.hint.html($('<div class="header ___toa-hint-resource-action-header"/>').append('<h3 class="header-title allow-select ___hint-resource-name">'+l.name+"</h3>"));for(var u=require("jbf/models/resource/resource-type-entity"),v=p.roles,w=[],u=[{role:u.RESOURCE_ROLE_BUCKET,iconClass:"icon-role-org-unit"},{role:u.RESOURCE_ROLE_ORGANIZATION_UNIT,
iconClass:"icon-role-org-unit"},{role:u.RESOURCE_ROLE_FIELD_RESOURCE,iconClass:"icon-role-field-resource"},{role:u.RESOURCE_ROLE_VEHICLE,iconClass:"icon-role-vehicle"},{role:u.RESOURCE_ROLE_TOOL,iconClass:"icon-role-tool"},{role:u.RESOURCE_ROLE_MANAGER,iconClass:"icon-role-manager"}],x=0;x<u.length;++x){var y=u[x];v[y.role]&&w.push({iconClass:y.iconClass,title:v[y.role].name,value:v[y.role].count})}var z="";w.forEach(function(b){z+='<div class="child-list-summary-item"><div class="child-list-summary-item-icon '+
b.iconClass+'" title="'+b.title+'"></div><div class="child-list-summary-value">'+b.value+"</div></div>"});v=$('<div class="scrollable-area">');w=$('<div class="card-content-wrapper">');u=$('<div class="entity-info">');u.append('<div class="child-list"><div class="child-list-summary" title="'+p.description+'">'+z+"</div></div>");p.filterName&&u.append('<div class="entity-info-block allow-select"><span>'+h(24165)+"</span> <span>"+p.filterName+"</span></div>");w.append(u);v.append(w);p=$('<div class="card-actions">');
p.append(d.createActions(n,d.hint.width(),c).addClass("hint_links_mobility"));v.append(p);d.hint.append(v);d.state=3;d.gid=b.data("group-id");d.hint.Tip({minHeight:10,closable:!0,closeOnOutsideClick:!0,callout:{side:"top",position:15},heightFollowContent:!0});d.hint.Tip("option","className","___toa-hint-tip toa-hint resource_group_hint_tip_container");d.hint.Tip("option","closable",!1);d.hint.Tip("showAt",b)}.bind(this))},hide:function(){this.state=1;clearTimeout(this.timeout);this.hint.Tip("hide",
!0)},block:function(){this.hide();this.blocked=!0;clearTimeout(this.timeout)},unblock:function(){this.blocked=!1},setHintTip:function(b,c){this.hintTipDisabled[c.screenName]=c},onMultiActivityClick:function(b,c){var d=$(c.currentTarget),k=c.data.hint;d.data("type","month-hint-activity");this.request(d,"","",function(){var l=d.data("actions")||"",n=d.data("addActions")||"",p={},s=d.data("short_hint")||"",t=k.html(),u=$('<div class="multi-hint-arrow"></div>'),s=k.html(t+s);s.find("table").hide();s.find(".hint_links").hide();
k.prepend(u);u.off().on("click",function(l){$(this).remove();k.find("div:visible").remove();k.find("table").show();!c.data.add_links||1!==_DATA.dates.length&&"undefined"===typeof d.attr("aid")||(k.append(this.createActions(b.target.data("actions"),k.width(),c.data).addClass("hint_links")),k.Tip("option","callout",{side:"top",position:15}),k.Tip("showAt",b.target))}.bind(this));n&&k.append(this.createActions(n,k.width(),p).addClass("hint_addlinks"));!l||1!==_DATA.dates.length&&"undefined"===typeof d.attr("aid")||
k.append(this.createActions(l,k.width(),p).addClass("hint_links"));k.Tip("option","callout",{side:"top",position:15});k.Tip("showAt",b.target)}.bind(this),c.data.getDate?c.data.getDate():null)},onClick:function(b){if(!$(b.target).hasClass("toa-assign-hint-ignore")){var c=this;b.stopPropagation();b.preventDefault();if(("click"===b.type||32===b.keyCode)&&!c.blocked)if(c.hint.is(":visible")&&3==c.state)c.hint.Tip("hide");else{var d=$(b.currentTarget);if(!d.parent().hasClass("map-list"))if(d.data("requested"))c.state=
4;else{clearTimeout(c.timeout);$(b.target).hasClass("activity-icon")&&b.data&&(b.data.activitySearchHint=!0);var k=b.data||{};if("function"!==typeof k.isLockShow||!k.isLockShow())if(b=b.originalEvent||b,b=(new Date).getTime(),d.data("detailed_hint")&&b-c.lastCacheUpdate<c.cacheLifeTime)c.showDetailed(d,k);else if(0<d.parent().parent().data("group-id"))c.showGroupHint(d,k);else if(d.data("on-call")&&d.data("short_hint"))c.showDetailed(d,{});else{var l=null;$(document).on("mousemove",function(b){l=
b}.bind(c));c.request(d,k.show_links,k.add_links,function(b){c.lastCacheUpdate=(new Date).getTime();if(b.data("hovered")||null==l)this.inverseTabindex(),this.showDetailed(b,k)}.bind(c,d),k.getDate?k.getDate(k.location):null);this.sandbox.trigger("assignhint.click",d,this)}}}}},onHover:function(b){var c=this;if(!c.blocked&&!$(b.target).hasClass("toa-assign-hint-ignore")){var d=$(b.currentTarget);"multiday_activity_segment"==d.attr("data-activity-type")&&($('.toaGantt-tb[data-master-id="'+d.attr("data-master-id")+
'"]').addClass("toaGantt-multiday-segment"),$('.toaGantt-tb[aid="'+d.attr("data-master-id")+'"]').addClass("toaGantt-multiday-segment"));"multiday_activity"==d.attr("data-activity-type")&&(d.addClass("toaGantt-multiday-segment"),$('.toaGantt-tb[data-master-id="'+d.attr("aid")+'"]').addClass("toaGantt-multiday-segment"));d.data("hovered",!0);if(!d.data("requested")&&3!=c.state&&4!=c.state){var k=b.data||{};b=b.originalEvent||b;clearTimeout(c.timeout);b=(new Date).getTime();d.data("on-call")&&(c.timeout=
setTimeout(function(b){b.data("hovered")&&c.showShort(b,{})}.bind(c,d),c.delay));d.data("short_hint")&&b-c.lastCacheUpdate<c.cacheLifeTime&&!d.data("offset")?c.timeout=setTimeout(function(b){b.data("hovered")&&this.showShort(b,k,!0)}.bind(c,d),c.delay):c.timeout=setTimeout(function(){c.request(d,k.show_links,k.add_links,function(b){c.lastCacheUpdate=(new Date).getTime();b.data("hovered")&&(4==c.state?this.showDetailed(b,k):this.showShort(b,k,!0))}.bind(c,d),k.getDate?k.getDate():null)},c.delay);d.one("mouseout",
c.onOut.bind(c))}}},onOut:function(b){$(b.currentTarget).removeData("hovered");$(".toaGantt-multiday-segment").removeClass("toaGantt-multiday-segment");3==this.state||_DATA.is_mobility_app&&window.innerWidth<=RESPONSIVE_WIDTH.MIN||this.hide()},request:function(b,c,d,k,l){var n=b.attr("aid")||b.attr("pid")||b.attr("data-inventory-id")||b.attr("data-travel-estimation-alert"),p="";if(n&&!b.attr("resourcegroup")){var s=this.createResponseCallback.bind(this);b.attr("month-hint-activity")&&(s=this.createActivityHintResponseCallback.bind(this));
b.attr("data-travel-estimation-alert")&&(s=this.createTravelEstimationAlertCallback.bind(this));b.attr("data-date")&&!b.attr("data-travel-estimation-alert")&&(oneActivityInRoute=!1,b.attr("aid")&&(oneActivityInRoute=1==b.attr("aid").split(",").filter(function(b){if(!isNaN(parseInt(b,10)))return b}).length),oneActivityInRoute||(s=this.createMultiActivitiesResponseCallback.bind(this)));"month-hint-activity"===b.data("type")&&(s=this.createActivityHintResponseCallback.bind(this),p=b.data("type"),d="");
b.data("requested",!0);var t=window.$app?$app.model().provider().get("pid"):"";this._treeDate=l;this.sandbox.trigger("global.data.get",{controller:"Hint",method:b.attr("data-travel-estimation-alert")&&"travelestimationwarning"||b.attr("data-date")&&!oneActivityInRoute&&"monthactivity"||b.attr("aid")&&"activity"||b.attr("pid")&&"provider"||b.attr("data-inventory-id")&&"inventory",params:{id:n,type:p,treeDate:l,par_pid:b.attr("par_pid")||b.attr("data-inventory-source-pid")||t,par_aid:b.attr("par_aid")||
b.attr("data-inventory-source-aid")||"",par_date:b.attr("par_date")||"",show_links:c||"",add_links:d||"",date:b.attr("data-date")||"",offset:b.attr("data-offset")||"",limit:b.attr("data-limit")||"",pool:b.attr("data-inventory-pool")||"",pid:b.attr("data-inventory-source-pid")||"",action_pid:b.attr("data-inventory-target-pid")||"",aid:b.attr("data-inventory-source-aid")||"",targ_el:b.attr("data-inventory-id")?get_tab_id(b[0]):""},responseHandler:s(b,k)})}},createTravelEstimationAlertCallback:function(b,
c){var d=this;return function(k,l){b.removeData("requested");b.data("short_hint",l.short);c.apply(d,[b])}},createMultiActivitiesResponseCallback:function(b,c){var d=this;return function(k,l){b.removeData("requested");b.data("actions",l.hint_actions);b.data("short_hint",d.multiActivitiesHintHtmlGenerators(l.monthActivitiesHintData));b.data("type","multi_activities");c.apply(d,[b])}},multiActivitiesHintHtmlGenerators:function(b){return d.TemplateCache.create("views/hint/content/multiActivities",["<table><%=content%></table>"]).apply({content:this.multiActivitiesRowsHtmlGenerator(b)})},
multiActivitiesRowsHtmlGenerator:function(b){var c="",g;for(g in b)if(b.hasOwnProperty(g))var k=d.helper.activity.createActivityBar(new d.Activity(b[g].activity),0,1,0,1),c=c+d.TemplateCache.create("views/hint/row/multiActivities",["<tr>",'<td class="multi-hint"><%=activity%></td>',"<td><%=activityDescriptionHtml%></td>","</tr>"]).apply({activity:k,activityDescriptionHtml:b[g].short});return c},createActivityHintResponseCallback:function(b,c){var d=this;return function(k,l){b.removeData("requested");
b.data("type","multi_activities");b.data("short_hint",l.short);b.data("addActions",l.hint_addActions);b.data("actions",l.hint_actions);c.apply(d,[b])}},createResponseCallback:function(b,c){var d=this;return function(k,l){b.removeData("requested");b.data("short_hint",l["short"]);b.data("header",l.header);b.data("hint_resource",l.hint_resource);b.data("hint_ulogin",l.hint_ulogin);b.data("hint_uid",l.hint_uid);b.data("detailed_hint",l.detailed);b.data("addActions",l.hint_addActions);b.data("actions",
l.hint_actions);b.data("map",l.map||null);b.data("group-id",b.parents(":eq(6)").data("group-id"));c.apply(d,[b])}},renderMap:function(b){if(null!==b.data("map")&&"found"===b.data("map").mapStatus){this.mapContainer=null;$("#activityMap").addClass("activityMapEnabled");this.mapContainer&&"function"===typeof this.mapContainer.destroy&&(this.mapContainer.destroy(),this.mapContainer=null);this.mapContainer=new app.map.oracle.MapContainer({container:"activityMap",staticMap:!0,modeSwitcher:!1,markerLayer:!1,
routesLayer:!1,circleLayer:!1,initOnDemand:!0});var c=this.mapContainer.createVectorLayer("singleMarker"),d=new app.map.oracle.TextMarker(b.data("map").mapLatitude,b.data("map").mapLongitude,{color:"#A2C036",text:"A",textColor:"#333"});c.addFeature(d);this.mapContainer.addLayer(c);this.mapContainer.setCenterAndZoom({lat:b.data("map").mapLatitude,lng:b.data("map").mapLongitude},16);this.mapContainer.initInstance();this.oracleMapAccessibility()}else $("#activityMap").removeAttr("style")},oracleMapAccessibility:function(){$("#activityMap [id^=oracleMapDiv]").attr("tabindex",
"0");$("#activityMap [id^=oracleMapDiv] img").attr("alt","map component")},renderDrivingDirections:function(b,c){var g=new d.views.directions.DirectionsView(c.route,c.params),k=new d.ui.Popup({title:h(5806),view:g,autoOpen:!0,width:700});k.setPositionCenter();g.renderAll(k)},_isDisableAction:function(b){if(isMobilityApp()&&b&&b.params&&b.params.action){var c=new app.modelActivity(b.params.aid);if("schedule_book_activity"==b.label&&"undefined"!==typeof c&&"pending"!=c.getActivityStatus())return!0;
if(b.params.actionOptions&&"form_link"===b.params.actionOptions.type)return!app.getFormCollection().has(b.params.action)}return!1},createActions:function(b,c,g){var k,l,n,p,s,t,u,v,w,x=this;c=c||300;t=$("<div/>").addClass("toa-hint").css({position:"absolute",left:"-100000px",top:"0",padding:"10px"}).appendTo("body");u=$("<div/>").addClass("hint_links").appendTo(t);l=$("<div/>");b=$.isArray(b)?b:[b];for(k in b)if(n="",void 0!==b[k]){p=b[k].params;if("sn.chat.create"===b[k].event)n=" start-chat-link";
else switch(b[k].label){case "resource_calendar":n=" resource_calendar";break;case "resource_work_zones":n=" resource_work_zones";break;case "resource_locations":n=" resource_locations";break;case "resource_work_skills":n=" resource_work_skills";break;case "resource_inventory":n=" resource_inventory"}p.hint_location=g.location;n=$("<span/>").addClass("hint_link span_link"+n).attr("role","link").attr("tabindex","0").attr("disabled",this._isDisableAction(b[k])).append(b[k].name).data("name",k).on("click keypress",
function(b,c,e,g,k){if(("click"===b.type||13===b.keyCode||"click"===k.type||13===k.keyCode)&&!x._isDisableAction(e)){if(g.context&&g.context.popup){if(_DATA.is_mobility_app&&"app.interface.showin"===b){b=app.di().create("navigation");b.getBucketNonTrackingHistoryData().push(app.model.contextLayout.constants.MAIN_MENU_ITEMS.supervisor_activities,{pid:c.pid,date:c.date||g.date});_DATA.temporaryActivityViewData={pid:c.pid,date:c.date||g.date};b.replaceState("view_activities").then(function(){g.context._sandbox.trigger("interface.activitiesScreen.showInPanel",
c);g.context.popup.hide();g.context._sandbox.trigger("routing.run.popup.has.been.closed")});return}g.context.popup.hide();g.context._sandbox.trigger("routing.run.popup.has.been.closed")}if(isMobilityAction(c.action,c))invokeMobilityScreen({action:c.action,pid:c.pid,aid:c.aid,date:c.date,actionOptions:c.actionOptions||{}});else if("select_provider"==c.action||"global.provider.select"==b){var l;try{l=JSON.parse($app.model().accessScreen()._accessScreenSource._currentScreen).module}catch(n){l=_DATA.page_label}"view_activities"!==
l?x.handlerSelectResource(c.pid,c.date):(c.goToMainTree=!0,d.app&&d.app.trigger("global.provider.select",c))}else if("oracle_knowledge"===c.action)$app.navigation().redirect("#knowledge/"+c.aid);else{if(c.actionOptions&&"view_directions"==c.actionOptions.baseLabel)return d.app.trigger("global.data.get",{controller:"Map",method:"drivingDirections",params:c,responseHandler:x.renderDrivingDirections}),!0;x.sandbox.trigger(b,c);_DATA.is_mobility_app&&k.originalEvent.stopPropagation();_DATA&&!_DATA.is_mobility_app&&
c&&"change_activity"===c.action&&require(["loader"],function(b){b.jetCssHack()})}x.isHintTipDisabled(p.hint_location)&&d.app.trigger("hang.tree.hide",{screenName:p.hint_location});x.hide()}}.bind(void 0,b[k].event,p,b[k],g));v=$("<span/>").addClass("hint_link span_link").append($.trim(b[k].name));w=$("<span/>").append(" &nbsp; ");u.append(v).append(w);t.width()>c&&(s&&s.detach(),u.empty(),u.append(v).append(w),l.append($("<br/>")));s=$('<span role="separator" />').append(" &nbsp; ");b[parseInt(k)+
1]&&"sn.chat.create"===b[parseInt(k)+1].event&&s.addClass("start-chat-seperator");"sn.chat.create"===b[k].event&&(s.addClass("start-chat-seperator"),n.hide());!g.context||"RunReportDetails"!==g.context.toString()||"Move"!==b[k].name&&"Select resource"!==b[k].name||n.attr("disabled",!0);l.append(n);l.append(s)}s&&s.detach();t.remove();return l},onDblClick:function(b,c){var d=this,k=$(b.currentTarget).closest("[aid]");"dblclick"!==b.type&&13!==b.keyCode||!k.length||-1!==k.attr("aid").indexOf(",")||
"true"===k.attr("is-single-click")||(d.block(),k={action:"change_activity",aid:k.attr("aid"),pid:k.attr("par_pid"),date:k.attr("par_date")},isMobilityAction(k.action,k)?invokeMobilityScreen(k):(require(["loader"],function(b){b.detachModule()}),this.sandbox.trigger("interface.actions.click",k)),setTimeout(function(){d.unblock()},1E3))},inverseTabindex:function(){var b=d.app.getInstance("view_activities");if(b=b&&b.options&&b.options.content||!1)b.find('[tabindex="0"]').attr("tabindex","-1"),b.find('input[type="checkbox"]').attr("tabindex",
"-1")},handlerSelectResource:function(b,c){var d=app.di().create("navigation"),k=app.di().create("screens.ContextService");c=c||$app.model().provider().getDate("Y-m-d");var l=app.context.getResourceHomeScreen(),n=app.di().create("helper.url.create",!0);if(k.isVisibleAction("mobile_supervisor","supervisor_activities"))d.getBucketNonTrackingHistoryData().push(app.model.contextLayout.constants.MAIN_MENU_ITEMS.supervisor_activities,{pid:b,date:c}),d.getHistoryState().setData({isRoot:!0}),d.replaceState(n(app.di().create("model.ActionLink").baseActions.select_provider));
else{if(app.context.isHomeScreen(l))return d.goBackToHomeScreenAndWipeHistory();k=n("#"+l)+"/pid="+b+"/date="+c;d.redirect(k)}}})})(toa);(function(d){d.DocumentTitle=d.define(null,function(){this._create.apply(this,arguments)},{options:{company:"Oracle Field Service",prov:!1,page:"Loading...",withoutProvider:{}},toString:function(){return"Title controller"},_create:function(c){var b=this;b.sandbox=c;b.o=c.options||{};b.sandbox.bind("layout.menu.selected",function(c,d){b.o.page=d.name;b.o.page_label=d.label;b.o.prov=b._getProviderDetails();b._update()},b);b.sandbox.bind("layout.menu.click",function(c,d){b.o.page=d.name;b.o.page_label=
d.label;b.o.prov=b._getProviderDetails();b._update()},b);b.sandbox.bind("layout.menu.changeTitle",function(c,d){b.o.page=d.name;b.o.page_label=d.label;b.o.prov=b._getProviderDetails();b._update()},b);b.sandbox.bind("global.provider.changed",function(c,d){b.o.prov=b._getProviderDetails();b._update()},b);b.sandbox.bind("system.title.setResource",function(c,d){b.o.prov=d.resourceName;b._update()},b)},_getProviderDetails:function(){if(3===d.currentInterface)return!1;var c=d.ResourcesTree&&d.ResourcesTree.getCurrent();
return c?c.getName():!1},_update:function(){var c=[],b=this.o.page||"",e=this.o.page_label||"";""==b&&"undefined"!==typeof _DATA.glossary.action_links[e]&&(b=_DATA.glossary.action_links[e]);var e="",g=r(18044),k=r(1668),l=["view_activities","forecasting","routing_run_list","view_quota"];!this.o.prov||this.o.withoutProvider&&this.o.withoutProvider[this.o.page_label]||0==(this.o.page_label||"").indexOf("company_settings")?b!=g&&-1===l.indexOf(this.o.page_label)&&-1===(this.o.page_label||"").indexOf("reports_custom")&&
(e=g):e=this.o.prov;7===d.currentInterface&&c.push(d.auth.instance_id);c.push(b);c.push(e);c.push(k);document.title=c.filter(function(b){return""!=b&&null!=b}).join(" - ")},destroy:function(c,b){}})})(toa);(function(d){d.widgets.accessHoursPopup=d.define(null,function(){var c=arguments;this.options={input:null,onSave:function(){}};this.setOptions(c[0]);this.editor=this.accessHoursDialog=null;requirejs(["components/accessHoursEditor/accessHoursEditor"],function(b){this.setOptions.apply(this,c);this.editor=new b({input:this.options.input,onSave:this.closePopup.bind(this),onClose:this.closePopup.bind(this),userData:d.app.model("companySettings").getUser()})}.bind(this))},{setOptions:function(c){$.extend(this.options,
c)},openPopup:function(c){c=this.editor.getTemplate();this.accessHoursDialog=new d.ui.Popup({title:d.glossary({id:15379}),html:c,buttons:null,footerHeight:0,popup_extra_css_class:"access-hours-popup",onClose:this.closePopup.bind(this)});this.editor.init(this.accessHoursDialog);$(this.accessHoursDialog._dom.footer).remove();$(this.accessHoursDialog._dom.contentMarginTop).remove();this.accessHoursDialog.show()},closePopup:function(){this.accessHoursDialog.destroy();this.options.onSave()}})})(toa);toa.ns("toa.controlers.ImportPopup",function(){return toa.define(null,function(){},{importTpl:'<div class="import_popup">,<div class="title_row">,<div class="import_count import_title">,<span class = "wrap_content_for_progress">,<%-Import%>,</span>,</div>,<div class="validation_count validation_title">,<span class = "wrap_content_for_progress">,<%-Validation%>,</span>,</div>,<div class="item_title">&nbsp;</div>,</div>,<div class="content">,<div class="success_row">,<div class="import_count">&nbsp;</div>,<div class="validation_count">&nbsp;</div>,<div class="item_title"><%-Successfully_imported%></div>,</div>,<div class="warnings_row">,<div class="import_count">&nbsp;</div>,<div class="validation_count">&nbsp;</div>,<div class="item_title"><%-Imported_with_warnings%></div>,</div>,<div class="not_imported_row">,<div class="import_count">&nbsp;</div>,<div class="validation_count">&nbsp;</div>,<div class="item_title"><%-Not_imported%></div>,</div>,</div>,</div>'.split(","),
importContinues:!1,popupOpened:!1,toString:function(){return"Import profiles popup"},open:function(d,c){var b=this;this.popupOpened=!0;this.importContent=$((new toa.Template(this.importTpl)).apply({Import:h(13295),Validation:h(13296),Successfully_imported:h(13297),Imported_with_warnings:h(13298),Not_imported:h(13299)}));var e=$("<div />").html(this.importContent),g=e.find(".content");this.validationSuccess=g.find(".success_row .validation_count");this.validationWarning=g.find(".warnings_row .validation_count");
this.validationError=g.find(".not_imported_row .validation_count");this.importSuccess=g.find(".success_row .import_count");this.importWarning=g.find(".warnings_row .import_count");this.importError=g.find(".not_imported_row .import_count");this.validation_title=e.find(".validation_title");this.import_title=e.find(".import_title");this.ErrorRow=g.find(".not_imported_row");this.setValidationValues(0,0,0);this.columnLoadIndicator=new this.runColumnLoadIndicator(this.validation_title);this.ImportPopup=
new toa.ui.Popup({title:"",html:this.importContent,autoOpen:!1,onClose:function(){b.popupOpened=!1;this.destroy();b.importContinues?toa.ui.Alert({text:h(13306)}):request({url:"?cmd="+d+"&sub="+c.sub+"&action=layout_list&do=stop&id="+c.id})},buttons:[{id:"validation_log_btn",text:h(13301),type:"link",display:!1,position:"left",click:function(){post({cmd:d,sub:c.sub,action:"layout_list",id:c.id,"do":"export_preview_log"})}},{id:"import_log_btn",text:h(13302),type:"link",display:!1,position:"left",click:function(){post({cmd:d,
sub:c.sub,action:"layout_list",id:c.id,"do":"export_preview_log"})}},{id:"cancel_btn",text:h(13303),click:function(){request({url:"?cmd="+d+"&sub="+c.sub+"&action=layout_list&do=stop&id="+c.id});b.popupOpened=!1;this.destroy()}},{id:"import_btn",text:h(13304),disable:!0,type:"submit",click:function(){b.importStart();request({url:"?cmd="+d+"&sub="+c.sub+"&action=layout_list&do=make&id="+c.id})}},{id:"close_btn",text:h(13305),display:!1,type:"submit",click:function(){b.popupOpened=!1;this.destroy();
b.importContinues?toa.ui.Alert({text:h(13306)}):request({url:"?cmd="+d+"&sub="+c.sub+"&action=layout_list&do=stop&id="+c.id})}}]});this.ImportPopup.setMaxWidth(440);this.ImportPopup.show()},requestValidationCounters:function(d,c){this.popupOpened&&setTimeout(function(){request({url:"?cmd="+d+"&sub="+c.sub+"&action=layout_list&do=get_status_validation&id="+c.id})},2E3)},requestImportCounters:function(d,c){this.popupOpened&&setTimeout(function(){request({url:"?cmd="+d+"&sub="+c.sub+"&action=layout_list&do=get_status_import&id="+
c.id})},2E3)},importComplete:function(){this.importContinues=!1;this.ImportPopup.displayNoneButton("cancel_btn");this.ImportPopup.displayNoneButton("import_btn");this.ImportPopup.displayNoneButton("validation_log_btn");this.ImportPopup.displayInlineButton("import_log_btn");this.ImportPopup.displayInlineButton("close_btn");this.columnLoadIndicator.stop()},validationComplete:function(){this.ImportPopup.displayInlineButton("validation_log_btn");this.ImportPopup.displayInlineButton("cancel_btn");this.ImportPopup.displayInlineButton("import_btn");
this.ImportPopup.enableButton("import_btn");this.ImportPopup.displayNoneButton("close_btn");this.columnLoadIndicator.stop()},importStart:function(){this.importContinues=!0;this.ImportPopup.displayNoneButton("cancel_btn");this.ImportPopup.displayNoneButton("validation_log_btn");this.ImportPopup.displayNoneButton("import_btn");this.ImportPopup.displayInlineButton("close_btn");this.columnLoadIndicator.stop();this.columnLoadIndicator=new this.runColumnLoadIndicator(this.import_title)},setValidationValues:function(d,
c,b){this.validationSuccess.html(d);this.validationWarning.html(c);this.validationError.html(b);0<b&&this.ErrorRow.addClass("red_warning")},setImportValues:function(d,c,b){d=d||"0";c=c||"0";b=b||"0";d+""!==this.validationSuccess.html()?(this.importSuccess.html(d),this.importSuccess.removeClass("success")):(this.importSuccess.html("&nbsp;"),this.importSuccess.addClass("success"));c+""!==this.validationWarning.html()?(this.importWarning.html(c),this.importWarning.removeClass("success")):(this.importWarning.html("&nbsp;"),
this.importWarning.addClass("success"));this.importError.html(b)},setTitle:function(d){this.ImportPopup.setTitle(d)},hide:function(){this.popupOpened=!1;this.ImportPopup.destroy()},runColumnLoadIndicator:function(d){var c={progressElement:$('<span class="progress_box">'),container:null,pointCounter:0,runed:!1,start:function(b){this.container=$(b);this.container.append(this.progressElement);this.run(!0)},run:function(b){this.pointCounter++;3<this.pointCounter&&(this.pointCounter=0);if(this.runed=b||
this.runed)$(".progress_box",this.container).html(Array(this.pointCounter+1).join(".")),setTimeout(function(){this.run()}.bind(this),500)},stop:function(){this.runed=!1;this.progressElement.remove()}};c.start(d);return c}})}());(function(d,c,b){d.HScroller=d.define(null,function(c){this.options=b.extend({},{onContentResize:function(){},onSelect:function(){},position:0,length:3,cellWidth:200,disableButtons:!1},c);this.activitiesArray=[];this.hintActivityCount=this.options.length;this.currentPosition=this.options.position},{createButtonsTemplate:function(){this.buttonLeft=b("<button>").text("<");this.buttonRight=b("<button>").text(">");this.buttonLeft.addClass("hscroller-button").addClass("hscroller-button-left").css({position:"absolute",
height:40,width:17,marginTop:-20,top:"50%",left:-18});this.buttonRight.addClass("hscroller-button").addClass("hscroller-button-right").css({position:"absolute",height:40,width:17,marginTop:-20,top:"50%",right:-18});this.buttonLeft.appendTo(this.el);this.buttonRight.appendTo(this.el)},createBaseTemplate:function(){this.el=b("<div>").css({position:"relative"}).empty();this.holder=b("<div>").addClass("holder").css({position:"relative",overflow:"hidden"});this.holder.appendTo(this.el);!0!==this.options.disableButtons&&
this.createButtonsTemplate()},init:function(c){this.createBaseTemplate();this.activitiesArray=c;var d=b("<tr></tr>");b.each(this.activitiesArray,function(c,e){var n=b('<td valign="top"></td>').attr("position",c).css({padding:0}).addClass("hscroller-cell");b(e).width(this.options.cellWidth);n.append(e);d.append(n)}.bind(this));c=b("<table></table>").css({borderCollapse:"none",position:"relative",left:0,top:0});c.append(d);c.appendTo(this.holder);this.parentResize(this.options.mapWidth);this.container=
b('<div class="toa-hint toa-map-hint resource_hint_tip_container">').append(this.el);this.update(this.container);return this.container},initEvents:function(c){c.on("click touchstart",".hscroller-button-left",function(){this.locked||this.scrollLeft()}.bind(this));c.on("click touchstart",".hscroller-button-right",function(){this.locked||this.scrollRight()}.bind(this));if(b.fn.mousewheel&&this.activitiesArray.length>this.hintActivityCount)c.on("mousewheel",".holder",function(b,c,e,d){b.stopPropagation();
if(this.locked)return null;0<c?this.scrollLeft():0>c&&this.scrollRight()}.bind(this))},getOptimalLength:function(){var b=0.5*this._parentWidth/this.options.cellWidth,b=b>this.activitiesArray.length?this.activitiesArray.length:b,b=3<b?3:b;return 1>=b?1:b},parentResize:function(b){b&&(this._parentWidth=b,this.setLength(this.getOptimalLength()))},setLength:function(b){var c=this.hintActivityCount;b=Math.floor(b);if(0>=b)throw"Cannot set length less or equal to 0";this.hintActivityCount=b;if(c!==this.hintActivityCount&&
(this.update(),this.holder))this.options.onContentResize(this.holder.outerWidth(),this.holder.outerHeight())},scrollTo:function(c){c=Math.floor(c);if(0==this.currentPosition&&0>=c||c>=this.activitiesArray.length)return!1;this.currentPosition=c;c=-b('.toa-hint td[position="'+this.currentPosition+'"]').position().left;this.update();this.lock();b(".toa-hint table").animate({left:c},200,function(){this.unlock()}.bind(this))},lock:function(){this.locked=!0},unlock:function(){this.locked=!1},update:function(b){this.updateHolder(b);
this.updateButtons(b)},updateHolder:function(b){this.holder&&this.holder.width(this.options.cellWidth*this.hintActivityCount)},updateButtons:function(c){var d=c?c.find(".hscroller-button-right"):b(".hscroller-button-right");c=c?c.find(".hscroller-button-left"):b(".hscroller-button-left");d&&c&&(showRight=this.isEnd(),d.toggle(!showRight),showLeft=this.isStart(),c.toggle(!showLeft))},isEnd:function(){return this.currentPosition>=this.activitiesArray.length-this.hintActivityCount},isStart:function(){return 0>=
this.currentPosition},scrollLeft:function(){this.scrollTo(this.currentPosition-this.hintActivityCount)},scrollRight:function(){this.scrollTo(this.currentPosition+this.hintActivityCount)}})})(toa,window,jQuery);toa.view.Header={init:function(d){this.sandbox=d;var c=0;new toa.DocumentTitle(this.sandbox,{withoutProvider:{}});this.sandbox.bind("layout.menu.addClosableTab",function(b,e){var d;c++;toa.app.model("pageLabels").findItem(e.label)||(d=e.label||"TabId"+c);_DATA.content_url=e.url+"&tabId="+d;return e.label||d},this)},setDisable:function(){},setEnable:function(){}};(function(d){var c=d.models.ObservableModel;d.ns("toa.models.TimeIntervalModel",d.define(c,function(b){c.apply(this,arguments);this._fillModel(b)},{_fillModel:function(b){this.reset({},{silent:!0});this.set(this._parseInterval(b),{silent:!0})},getLabel:function(){return this.get("label","")},isAllDay:function(){return this.get("allDay",!1)},isZeroLength:function(){return this.get("zeroLength",!1)},isBefore:function(){return this.get("before",!1)},isAfter:function(){return this.get("after",!1)},isUsual:function(){return!(this.isAllDay()||
this.isBefore()||this.isAfter()||this.isZeroLength())},getStartTime:function(){var b=this.get("start",!1);return b?b.timestamp:!1},getEndTime:function(){var b=this.get("end",!1);return b?b.timestamp:!1},getIntervalText:function(b){b=b||!1;return b?(b=this.get(b,!1))?b.timeString||"":"":this.get("text",this.getLabel())},_getIntervalTimeObject:function(b){var c=b.split(":");b=parseInt(c[0]);var g=c[1]||"00",c=!1;23<b&&(b-=24,c=!0);b=d.date.parseDate("time",b+":"+g);c&&b.setDate(b.getDate()+1);return b},
_isNextDay:function(b){var c=d.date.currentDate();return b.getDate()!==c.getDate()?!0:!1},_fillIntervalPart:function(b){b=this._getIntervalTimeObject(b);var c=b.getHours(),g=b.getMinutes(),k=d.date.formatDate(g?"time":"time_short",b);this._isNextDay(b)&&(c+=24,k+="+1");return{timestamp:b.getTime(),hours:c,minutes:g,timeString:k}},_parseInterval:function(b){if("undefined"===typeof b)throw"interval is undefined";if("undefined"===typeof b.label)throw"label is undefined";var c=b.label;if("all"===c)return b.allDay=
!0,b.text=h(20461),b;c=c.split("-");1===c.length?(b.zeroLength=!0,b.start=this._fillIntervalPart(c[0]),b.end=b.start,b.text=b.start.timeString):c[0]?c[1]?(b.start=this._fillIntervalPart(c[0]),b.end=this._fillIntervalPart(c[1]),b.text=[b.start.timeString,b.end.timeString].join(" - ")):(b.after=!0,b.start=this._fillIntervalPart(c[0]),b.end=!1,b.text=r(20465,{"{INTERVAL_VALUE}":b.start.timeString})):(b.before=!0,b.start=!1,b.end=this._fillIntervalPart(c[1]),b.text=r(20464,{"{INTERVAL_VALUE}":b.end.timeString}));
return b},hasIntersectionWith:function(b){return this.getStartTime()===b.getStartTime()&&this.getEndTime()===b.getEndTime()||this.getEndTime()>b.getStartTime()&&b.getEndTime()>this.getStartTime()||this.isBefore()&&(b.isBefore()||this.getEndTime()>b.getStartTime())||!this.isBefore()&&b.isBefore()&&this.getStartTime()<b.getEndTime()||this.isAfter()&&(b.isAfter()||this.getStartTime()<b.getEndTime())||!this.isAfter()&&b.isAfter()&&this.getEndTime()>b.getStartTime()||this.isZeroLength()&&!b.isZeroLength()&&
this.getStartTime()>b.getStartTime()&&this.getEndTime()<b.getEndTime()||!this.isZeroLength()&&b.isZeroLength()&&this.getStartTime()<b.getStartTime()&&this.getEndTime()>b.getEndTime()||this.getStartTime()<b.getEndTime()&&b.getStartTime()<this.getStartTime()||this.getEndTime()>b.getStartTime()&&b.getEndTime()>this.getEndTime()?!0:!1},isValid:function(){return this.getStartTime()&&this.getEndTime()&&this.getEndTime()<this.getStartTime()?!1:!0},subscribeOnChild:function(b){b.addListener("all",function(){this.notify.apply(this,
arguments)},this)},toJSON:function(){var b=c.prototype.toJSON.apply(this,arguments);this.idField in this.attributes||delete b[this.idField];return b}}))})(toa);(function(d){var c=d.models.ObservableCollection;d.ns("toa.models.TimeIntervalsCollection",d.define(c,function(b){c.apply(this,arguments);b&&this._fillCollection(b)},{modelConstructor:d.models.TimeIntervalModel,setData:function(b){this._fillCollection(b)},_fillCollection:function(b){this.clear({silent:!0});b=b instanceof Array?b:b.split(",");$.each(b,function(b,c){var d={label:c.trim()};this.add(d,{silent:!0})}.bind(this))},find:function(b,c,d){return this.findBy(function(d){return d.get(b)==c},null,
d)},findBy:function(b,c,d){b=this.findIndexBy(b,c,d);return-1<b?this.models[b]:null},findIndexBy:function(b,c,d){var k=this.models;d=d||0;for(var l=k.length;d<l;d++)if(b.call(c||this,k[d]))return d;return-1},comparator:function(b,c){if(b.isAllDay())return-1;if(c.isAllDay())return 1;if(b.isBefore()||c.isAfter())return-1;if(c.isBefore()||b.isAfter())return 1;var d,k;if(b.getStartTime()&&c.getStartTime()&&(d=b.getStartTime(),k=c.getStartTime(),d===k)){if(b.isZeroLength())return-1;if(c.isZeroLength())return 1}return d===
k?0:d?k?d<k?-1:1:1:-1},serializeLabels:function(){return this.pluck("label").join(",")}}))})(toa);(function(d){d.ns("toa.widgets.TimeIntervalsEditor",d.define(null,function(c,b){this.field=$(c);this.container=this.field.parent();this.options=b||{};this.title=b.title||"Time Intervals";this.timeIntervalsString=b.intervals||"";this.defaultIntervalsString=b.default_intervals||"all";this.isReadOnlyMode=b.isReadOnlyMode||!1;this.dialog=null;this.init()},{mainTemplate:'<div class="sectionItemList timeIntervalsWidget"><% if (!isReadOnlyMode) { %><div aria-label="<%= h(462/* Modify */) %><%=  h(20458 /* Capacity Intervals */) %>" role="button" class="editTimeIntervals ui-button multiselect-tip-button ui-button-icon-only" title="<%= h(462/* Modify */) %>" tabindex="0"><span class="ui-icon ui-button-icon-primary ui-icon-modify oj-ux-ico-edit"></span><span class="ui-button-text"><%= h(462/* Modify */) %></span></div><% } %><div class="selectedItems"></div><div class="clear"></div></div>',
listItemTemplate:'<div class="listItem"><%- text %></div>',dialogTemplate:'<div class="dialogListSection"><div class="listTopPanel"><div class="dialogInfo"></div><div class="dialogAdd"><div aria-label="<%= h(20471/* Add new Interval */) %>" role="button" class="dialogIconBtn addIcon" title="<%= h(20471/* Add new Interval */) %>" tabindex="0"></div></div></div><div class="listWrapper"><div class="intervalsList"></div></div></div><div class="dialogFormSection"></div>',dialogListItemTemplate:'<div class="intervalRow" data-label="<%- label %>"><div class="intervalRowDelete"><div aria-label="<%= h(21056/*Remove item*/) %>" role="button" class="dialogIconBtn deleteIcon" tabindex="0"></div></div><div class="intervalRowContent text"><%- text %></div></div>',
dialogFormTemplate:'<% var selected = \' selected="selected"\'; %><% var hrs = mins = 0; %><div class="addIntervalForm"><table class="generalInfo" cellpadding="0" cellspacing="0"><tr><td class="infoLabel"><label id="from_day"><%= h(20472/* From */) %></label></td><td class="infoValue"><select aria-labelledby="from_day" tabindex="0" class="start hoursSelect"><option value="-1"<%- !start ? selected : \'\' %><% if (start && !end) { %> disabled="disabled"<% } %>><%= h(20469/* Beginning of day */) %></option><% for (hrs = 0; hrs < hoursList.length; hrs++) { %><option value="<%- hrs %>"<%- (start && start.hours == hrs) ? selected : \'\' %>><%- hoursList[hrs] %></option><% } %></select><span class="start timeDelimiter<% if (!start) { %> toa-hidden<% } %>"> : </span><select aria-labelledby="from_day" tabindex="0" class="start minutesSelect<% if (!start) { %> toa-hidden<% } %>"><% for (mins = 0; mins < 60; mins++) { %><option value="<%- mins %>"<%- (start && start.minutes == mins) ? selected : \'\' %>><%- mins < 10 ? ("0" + mins) : mins %></option><% } %></select></td></tr><tr><td class="infoLabel"><label id="to_day"><%= h(20473/* To */) %></label></td><td class="infoValue"><select aria-labelledby="to_day" tabindex="0" class="end hoursSelect"><% for (hrs = 0; hrs < hoursList.length; hrs++) { %><option value="<%- hrs %>"<%- (end && end.hours == hrs) ? selected : \'\' %>><%- hoursList[hrs] %></option><% } %><option value="-1"<%- !end ? selected : \'\' %><% if (!start && end) { %> disabled="disabled"<% } %>><%= h(20470/* End of day */) %></option></select><span class="end timeDelimiter<% if (!end) { %> toa-hidden<% } %>"> : </span><select aria-labelledby="to_day" class="end minutesSelect<% if (!end) { %> toa-hidden<% } %>"><% for (mins = 0; mins < 60; mins++) { %><option value="<%- mins %>"<%- (end && end.minutes == mins) ? selected : \'\' %>><%- mins < 10 ? ("0" + mins) : mins %></option><% } %></select></td></tr></table><div class="errorLine"></div></div>',
init:function(){this.timeIntervals=new d.models.TimeIntervalsCollection(this.timeIntervalsString);var c=this.timeIntervals.find("label","all");c&&c.remove();this.defaultIntervals=new d.models.TimeIntervalsCollection(this.defaultIntervalsString);this.dialogIntervals=null;this._getHoursList();this._mainTpl=new d.Template(this.mainTemplate);this._listItemTpl=new d.Template(this.listItemTemplate);this._dialogTpl=new d.Template(this.dialogTemplate);this._dialogListItemTpl=new d.Template(this.dialogListItemTemplate);
this._dialogFormTpl=new d.Template(this.dialogFormTemplate);this.render()},_getHoursList:function(){this.hoursList=[];for(var c=0;48>c;c++){var b=c,e=!1;23<c&&(b-=24,e=!0);b=d.date.parseDate("time",b+":00");b=d.date.formatDate("time_short",b);e&&(b+="+1");this.hoursList.push(b)}},destroy:function(){this._$el.remove();this._$el=null;this.container.find(".editTimeIntervals").off("click");this.container.find(".editTimeIntervals").off("keypress");this.mainTemplate=this.listItemTemplate=this.dialogTemplate=
this.dialogListItemTemplate=this.dialogFormTemplate=null;this._mainTpl.destroy();this._listItemTpl.destroy();this._dialogTpl.destroy();this._dialogListItemTpl.destroy();this._dialogFormTpl.destroy();this.hoursList=null;this.defaultIntervals.clear();this.defaultIntervals=null;this.timeIntervals.clear();this.timeIntervals=null},render:function(){var c=$(this._mainTpl.apply({isReadOnlyMode:this.isReadOnlyMode}));this._$el=0<c.length?c:this.container;this.container.append(c);this.container.find(".editTimeIntervals").on("click",
this.openDialog.bind(this));this.container.find(".editTimeIntervals").on("keypress",this.openDialog.bind(this));this.renderList();return this},renderList:function(){var c="",b=this._$el.find(".selectedItems"),e=0<this.timeIntervals.getCount()?this.timeIntervals.models:this.defaultIntervals.models;$.each(e,function(b,e){c+=this._listItemTpl.apply({text:e.get("text","")})}.bind(this));b.empty();b.append(c)},openDialog:function(c){if("keypress"!==c.type||13===c.keyCode||32===c.keyCode){this.dialogIntervals=
this.timeIntervals.clone();c=$(this._dialogTpl.apply());var b=[{text:h(14621),position:"left",click:this.closeDialog.bind(this),id:"dialogCancelBtn"},{text:h(12252),type:"submit",position:"right",click:this.saveIntervals.bind(this),id:"dialogSubmitBtn"},{text:h(14621),click:this.dismissChanges.bind(this),position:"left",id:"formDismissBtn"},{text:h(14220),type:"submit",click:this.addInterval.bind(this),position:"right",id:"formAddBtn"}];this.dialog=new d.ui.Popup({title:this.title,width:400,height:450,
autoOpen:!0,html:c,modal:!0,popup_extra_css_class:"timeIntervalsEditorDialog",onClose:this.closeDialog.bind(this),buttons:b});c=$(this.dialog.getDomContent());this.dialogListSection=c.find(".dialogListSection");this.dialogFormSection=c.find(".dialogFormSection");this.dialogListContainer=this.dialogListSection.find(".intervalsList");this.dialogListSection.find(".addIcon").on("click",this.renderDialogForm.bind(this));this.dialogListSection.find(".addIcon").on("keypress",this.renderDialogForm.bind(this));
this.renderDialogList()}},_showFormButtons:function(c){!0===c?(this.dialog.displayNoneButton("dialogCancelBtn"),this.dialog.displayNoneButton("dialogSubmitBtn"),this.dialog.displayInlineButton("formDismissBtn"),this.dialog.displayInlineButton("formAddBtn")):(this.dialog.displayNoneButton("formDismissBtn"),this.dialog.displayNoneButton("formAddBtn"),this.dialog.displayInlineButton("dialogCancelBtn"),this.dialog.displayInlineButton("dialogSubmitBtn"))},renderDialogList:function(){this.dismissChanges();
this.dialogListContainer.empty();this.checkEmptyList();$.each(this.dialogIntervals.models,function(c,b){var e=this._dialogListItemTpl.apply(b.toJSON());this.dialogListContainer.append(e)}.bind(this));this.dialogListContainer.find(".deleteIcon").on("click",this.removeListItem.bind(this));this.dialogListContainer.find(".deleteIcon").on("keypress",this.removeListItem.bind(this))},removeListItem:function(c){if("keypress"!==c.type||13===c.keyCode||32===c.keyCode){c=$(c.target).closest(".intervalRow",this.dialogListContainer);
var b=c.attr("data-label"),b=this.dialogIntervals.find("label",b);c.remove();b.remove();this.checkEmptyList()}},checkEmptyList:function(){0===this.dialogIntervals.getCount()&&this.dialogListContainer.append('<div class="emptyList">'+h(20475)+"</div>")},renderDialogForm:function(c){if("keypress"!==c.type||13===c.keyCode||32===c.keyCode)this.dialogListSection.hide(),this.form=$(this._dialogFormTpl.apply({label:"",start:!1,end:{hours:0,minutes:0},hoursList:this.hoursList})),this.dialogFormSection.append(this.form),
this.form.find(".hoursSelect").on("change",this.onChangeHours.bind(this)),this.dialogFormSection.show(),this.dialogFormSection.find(".start.hoursSelect").focus(),this._showFormButtons(!0),this.dialog.setTitle(h(20471))},onChangeHours:function(c){var b=$(c.target);c=b.val();var e=b.hasClass("start")?"start":"end",b=this.form.find("."+("start"===e?"end":"start")+'.hoursSelect option[value="-1"]'),d=this.form.find("."+e+".minutesSelect"),e=this.form.find("."+e+".timeDelimiter");"-1"===c?(d.val("0"),
d.addClass("toa-hidden"),e.addClass("toa-hidden"),b.prop("disabled",!0)):(e.removeClass("toa-hidden"),d.removeClass("toa-hidden"),b.prop("disabled",!1))},dismissChanges:function(c){this.dialogFormSection.empty();this.dialogFormSection.hide();this.dialogListSection.show();this.form=null;this._showFormButtons(!1);this.dialog.setTitle(this.title)},_getLabelPart:function(c){var b="",e=this.form.find("."+c+".hoursSelect").val();"-1"!==e&&(b+=10>parseInt(e)?"0"+e:e,c=this.form.find("."+c+".minutesSelect").val(),
0<parseInt(c)&&(b+=":"+(10>parseInt(c)?"0"+c:c)));return b},_generateNewLabel:function(){var c=this._getLabelPart("start"),b=this._getLabelPart("end"),e=c;c!==b&&(e+="-"+b);c||"00"!==b||(e=b);return e},addInterval:function(c){c=this._generateNewLabel();var b=new d.models.TimeIntervalModel({label:c});b.isValid()?this._checkIntervalIntersection(this.dialogIntervals,c)?(this.dialogIntervals.add(b),this.renderDialogList(),this.dialogListSection.find(".addIcon").focus()):this.showIntervalError(h(20467)):
this.showIntervalError(h(20468,{"{START_TIME}":h(20472),"{END_TIME}":h(20473)}))},_checkIntervalIntersection:function(c,b){for(var e=new d.models.TimeIntervalModel({label:b}),g=!1,k=0;k<c.getCount();k++)if(c.models[k].hasIntersectionWith(e)){g=!0;break}return!g},closeDialog:function(c){this.dialog.destroy();this.dialogIntervals=null},saveIntervals:function(c){this.timeIntervals.reset(this.dialogIntervals.toJSON());this.field.val(this.timeIntervals.serializeLabels());this.closeDialog();this.renderList()},
showIntervalError:function(c){this.form.find(".errorLine").text(c)}}))})(toa);(function(d,c){var b=d.Controller;d.controllers.DispatchView=d.define(b,function(c){b.apply(this,arguments);this.bitMask={PLUGIN_OPTION_TAB_LAYOUT:1,PLUGIN_OPTION_SCROLLBARS:2,PLUGIN_OPTION_IS_ONLINE:4,PLUGIN_OPTION_IS_SERVER_SCRIPT:8,PLUGIN_OPTION_MENU_ITEM:16};this.controllers=c.options.controllers;this.companySettings=c.options.companySettings;this.company=c.options.company;for(var d in this.controllers)this.getDesc(d).state="stop";this.currentScreen=null;this.tabs=0;c.bind("layout.page.changed",
this.handleTreeUpdates);c.bind({"layout.page.beforeChange":"tabClose","layout.page.changed":"tabChange","app.interface.showin":"onShowIn","search.provider.highlight":"selectListScreen","layout.menu.click":"menuClick","layout.menu.closeTab":"onClosePopup","layout.tabs.set":"onTabsSet","layout.caption.set":"onCaptionSet","layout.caption.filterClose":"onFilterClose","layout.resourceTree.close":"onResourceTreeClose","multidayactivity.action":"onMultidayActions","register.dispatch.controller":"registerController",
"suspend.dispatch.controller":"suspendController"});this.hanlerOnOpenTree=this.onButtonTreeClick.bind(this);this.hanlerOnChangeDate=this.onChangeDate.bind(this);this.hanlerOnBackButtonClick=this.onCloseClick.bind(this);this.hanlerOnFilterApply=this.onFilterApply.bind(this)},{toString:function(){return"Dispatch view controller"},TAB_ACTIONS:1,TAB_PROVIDERS_TREE:2,TAB_BUCKET_TREE:4,TAB_PERMISSIONS_TREE:8,TAB_CONTACT_LIST:16,isController:function(b){return this.getDesc(b)},registerController:function(b,
c){for(var d in c)this.controllers[d]||(this.controllers[d]=c[d],this.getDesc(d).state="stop")},suspendController:function(b,c){c.label&&this.isController(c.label)&&this.disable(c.label)},tabClose:function(b,d){this.isController(this.currentScreen)&&this.disable(d.from);_DATA.destructor&&(_DATA.destructor(),_DATA.destructor=null);c("body").trigger("mousedown")},tabChange:function(b,c){this.currentScreen=c.to;this.isController(c.to)?(_DATA.content_url=this.getDesc(c.to).url||"doRefresh",this.enable(c.to,
c.params||{})):this.isPlugin(c)?(this.controllers[c.label]={controller:"PluginsIframe",state:"stop",options:{plugin:c.label,pluginUrl:_DATA.content_url}},this.enable(c.to,c.params||{})):c.newTab||(_DATA.content_url=_DATA.content_url||"doRefresh",this.sandbox.trigger("global.data.get",{url:"?"+d.ltrim(_DATA.content_url,"?"),keep_in_history:!0,responseHandler:function(b,c){}}))},handleTreeUpdates:function(b,c){d.ResourcesTree&&("view_activities"!==c.to?d.ResourcesTree.enableAutoUpdate():d.ResourcesTree.disableAutoUpdate())},
isPlugin:function(b){b=this.sandbox.model("companySettings").getActionsDesc(b.label);if(null===b)return!1;var c=this.bitMask;return b.options&c.PLUGIN_OPTION_MENU_ITEM&&b.options&c.PLUGIN_OPTION_TAB_LAYOUT},getDesc:function(b){if(d.isString(b)&&!this.controllers[b]){var c=b.match(/config\_(.+)\.(.+)/);c&&this.controllers["company_settings_"+c[2]]&&(this.controllers[b]=d.clone(this.controllers["company_settings_"+c[2]]),this.controllers[b].state="stop",this.controllers[b].company=c[1])}return this.controllers[b]},
enable:function(b,d){var k=this.getDesc(b);switch(k.state){case "stop":var l={title:c("<div/>"),content:this.sandbox.options.target.empty(),options:k.options,company:k.company,params:d};this.sandbox.trigger("app.controller.register",{instance:b,controller:k.controller,params:l});k.state="run";break;case "suspend":l={title:c("<div/>"),content:this.sandbox.options.target.empty(),options:k.options,params:d},this.sandbox.trigger("app.controller.resume",{instance:b,params:l}),k.state="run"}},disable:function(b){"run"==
this.getDesc(b).state&&(this.sandbox.trigger("app.controller.suspend",{instance:b}),this.getDesc(b).state="suspend")},selectListScreen:function(b,c){this.onShowIn("internal",c);this.sandbox.trigger("interface.panels.highlightActivity",c)},onShowIn:function(b,c){"view_activities"!=this.currentScreen&&this.menuClick("internal",{label:"view_activities",url:this.getDesc("view_activities").url,params:{skipReload:!0}});this.sandbox.trigger("interface.activitiesScreen.showInPanel",c)},menuClick:function(b,
g){var k="",l;if(!d.isUndefined(g.label))if("company_settings_configuration"===g.label)$app.navigation().redirect("company_settings_configuration");else{var n=this.sandbox.model("companySettings").getActionsDesc(g.label);if(g.url)k=g.url;else if(l=this.sandbox.model("pageLabels"),l=l.findItem(g.label))k=l.url;_DATA.data_type="";n&&n.type&&n.type===app.constants.PLUGIN_TYPE_EXTERNAL&&(_DATA.data_type=n.type);if(n&&n.type&&n.type===app.constants.PLUGIN_TYPE_EXTERNAL&&!n.options&1)n.url="?"+k,openExternalPlugin(n);
else if(this.companySettings.isPopupAction(g.label))this.sandbox.trigger("interface.actions.click",{action:g.label,url:k});else{this.sandbox.trigger("layout.page.beforeChange",{to:g.label,from:_DATA.page_label});l=_DATA.page_label;var p=c("#manage-content");_DATA.page_label=g.label;_DATA.content_url=k||!1;/apple/i.test(navigator.vendor)&&p.addClass("is_safari");p.attr({"data-title":_DATA.page_label});if("routing_run_list"!==g.label){p.hasClass("no-full-height")&&p.removeClass("no-full-height");if(jetPages[g.label]){require(["loader"],
function(b){b.run(g)});this.lastLabel=g.label;this.sandbox.trigger("layout.menu.select",{label:_DATA.page_label});return}require(["loader"],function(b){"company_settings_themes"===_DATA.page_label||"company_settings_wmt_theme"===_DATA.page_label?b.jetCssHack(!0):b.jetCssHack()})}else p.hasClass("no-full-height")||p.addClass("no-full-height"),require(["loader"],function(b){b.jetCssHack()});this.tabs=0;this.sandbox.trigger("layout.page.changed",{to:_DATA.page_label,from:l,label:g.label,params:g.params});
_DATA.page_label!=l&&(Tabset.selectedTabId=!1);n||(this.lastLabel=g.label,this.sandbox.trigger("layout.menu.select",{label:_DATA.page_label}))}}},onMultidayActions:function(b,c){c.params={pid:c.pid,aid:c.aid,date:c.date};d.app.trigger("global.data.get",c)},onClosePopup:function(b){this.lastUrl?(this.sandbox.trigger("global.data.get",{url:this.lastUrl,keep_in_history:!0,responseHandler:function(b,c){}}),this.lastUrl=!1):this.menuClick("Internal",{label:this.lastLabel})},onCaptionSet:function(b,g){this.title&&
this.title.destroy();this.titleInstall=!1;var k="PanelTitle",l=c("#content_caption");0<="company_settings_business_rules company_settings_shifts company_settings_work_schedules company_settings_non_working_reasons company_settings_work_zone_dictionary company_settings_regions_list company_settings_time_slots_list company_settings_resource_types_list company_settings_activity_types_list company_settings_properties_list company_settings_glossary_list company_settings_display company_settings_filters_list company_settings_login_policies_list company_settings_statistics company_settings_OKCS_integration company_settings_collaboration company_settings_surveys company_settings_surveys_list config_company.surveys config_ca_company_surveys_list company_settings_holidays config_company.holidays company_settings_about_company".split(" ").indexOf(_DATA.page_label)?
(k="PanelTitleAlta",l=0<c("#content_caption_alta").length?c("#content_caption_alta"):c("<div/>",{id:"content_caption_alta"}).prependTo("#inner_content"),c(".toa-panel-content").addClass("toa-panel-content-alta")):c(".toa-panel-content").removeClass("toa-panel-content-alta");k={xtype:k,listeners:{openTree:this.hanlerOnOpenTree,changeDate:this.hanlerOnChangeDate,backButtonClick:this.hanlerOnBackButtonClick,filterApply:this.hanlerOnFilterApply}};d.currentInterface===INTERFACE.MOBILITY&&(k.screenName=
window.isReportsScreen?SCREEN_MAPPINGS.dashboard:_DATA.page_label,k.headerResponsive=window.isReportsScreen||ORDER_OF_REMOVAL[_DATA.page_label]?_DATA.page_label:null);this.title=d.view.control.create(k);"undefined"!==typeof g.caption_info&&"undefined"!==typeof g.caption_info.browser_title_with_breadcrumbs||this.recursiveGetName(g,"page_name",this.setHTMLTitle.bind(this,_DATA.page_label));this.titleInstall||this.setHTMLTitle(_DATA.page_label,g.caption_info&&g.caption_info.browser_title_with_breadcrumbs?
g.caption_info.browser_title_with_breadcrumbs:g.caption);this.onTabsSet("internal",g);this.title.setOption("titleText",g.caption||"");this.setBackButton(g.caption_info);this.setCalendar(g.caption_info);c("div#content_caption").not(":first").remove();l.empty();k.screenName===SCREEN_MAPPINGS.dashboard&&(l.prependTo(c("#content-manage-container")),l.addClass("dashboard-panel-title"));this.title.render(l);this.setFilter(g);this.addActionsButtons(g.actions,g.actionsmd);this.multilineProcessing();d.currentInterface!==
INTERFACE.MOBILITY&&"company_settings_work_zone_dictionary"===_DATA.page_label||"company_settings_regions_list"===_DATA.page_label?(c(".work-zone-key").html(c("tr.customer td").html()),c("tr.customer").remove(),c(".work-zone-key").removeClass("toa-hidden"),c(".jet-screen-title").css("min-width","1130px")):d.currentInterface!==INTERFACE.MOBILITY&&"company_settings_properties_list"===_DATA.page_label?c(".jet-screen-title").css("min-width","825px"):"company_settings_collaboration"===_DATA.page_label||
"company_settings_display"===_DATA.page_label||"company_settings_activity_types_list"===_DATA.page_label||"reports_dashboard"===_DATA.page_label||"company_settings_collaboration"===_DATA.page_label||"company_settings_user_types"===_DATA.page_label?require(["loader"],function(b){b.jetCssHack(!0)}):"company_settings_about_company"===_DATA.page_label&&c(".jet-screen-title-single-line").css("border-bottom","0px");app.focusToTheLastSelectedElement&&app.focusToTheLastSelectedElement()},setHTMLTitle:function(b,
g){this.titleInstall=!0;d.app.trigger("layout.menu.changeTitle",{label:b,url:"",name:g,params:{}});d.currentInterface===INTERFACE.MOBILITY&&window.isReportsScreen&&c("#inner_content").prepend('<div class="screen-header">'+g+"</div>")},recursiveGetName:function(b,c,d){for(var l in b){if(l==c&&""!=b[l]){d(b[l]);break}if("object"==typeof b[l]&&0<Object.keys(b[l]).length){this.recursiveGetName(b[l],c,d);break}}},setFilter:function(b){this.title.setOption("filter",!!b.filter_content||!!b.filter_desc);
if(b.filter_desc)this.title.setOption("filterDesc",b.filter_desc);else{this.title.setOption("filterContent",b.filter_content);var c=this.title.getChild("filterButton");b.filter_content&&initFilter(c.getForm(),b.filter_params,b.filter_js_post_check)}},onFilterApply:function(b,c){this.sandbox.trigger("interface.filter.changed",{values:c.values})},onFilterClose:function(b,c){this.title.closeFilter()},addActionsButtons:function(b,c){var k=[];if("setting_calendars_list"==_DATA.page_label&&b&&b.length){for(var l=
{},n=0;n<b.length;n++){var p=b[n];k.push({name:"action"+n,text:p.label});l["action"+n]=p.js}n=""==h(10162)?"icon-actions":"";p=""==h(10162)?"":h(10162);k=d.view.control.create({xtype:"button.Menu",icon:n,text:p,attr:{"aria-haspopup":"true"},menuItems:k,listeners:{menuItemClick:function(b,c){eval(l[c.name].replace(/&amp;/g,"&"))}}});this.title.getChild("actionPanel").appendChild(k);this.title.getChild("actionPanel").rerender()}else k=this.formatActionsButtons(b,c),this.title.getChild("actionPanel").getContainer().html(k),
d.currentInterface===INTERFACE.MOBILITY&&d.HeaderResponsive.hideTip()},multilineProcessing:function(){""===this.title.getChild("actionPanel").getContainer().children().html()&&this.title.getChild("filterButton").getOption("hidden")&&this.title.addClass("jet-screen-title-single-line")},formatActionsButtons:function(b,c){var d=["<span class=toa-button-panel>"];if(b)for(var l=0;l<b.length;l++){var n=b[l];d.push('<button class="toa-button" id="',n.identifier,'" onclick="',n.js,'">',n.label,"</button>")}if(c)for(l=
0;l<c.length;l++)n=c[l],d.push('<button class="toa-button" onmousedown="',n.js,'">',n.label,"</button>");d.push("</span>");return d.join("")},onFilterChange:function(b,c){var d=this.title.getChild("filterButton");d.close();c&&c.filtered?d.setState("filtered"):d.setState("filterEmpty")},onTabsSet:function(b,d){_DATA.tabs.set_tabs(d.tabs,d.show);void 0!=d.tabs&&(this.tabs=d.tabs);if(this.title){var k=_DATA.tabs.isVisible(this.tabs)&&!_DATA.tabs.isOpened(this.tabs);this.title.setOption("resourceTreeButton",
k);"external"===_DATA.data_type&&c(".toa-panel-content").removeClass("toa-panel-content-alta")}},onResourceTreeClose:function(){this.title&&this.title.setOption("resourceTreeButton",_DATA.tabs.isVisible(this.tabs))},onButtonTreeClick:function(){_DATA.tabs.show(this.tabs)},setCalendar:function(b){b&&b.calendar?(this.title.setOption("todayDate",b.calendar.today),this.title.setOption("selectedDate",b.date||this.sandbox.get("date")),this.title.setOption("minDate",b.calendar.start),this.title.setOption("maxDate",
b.calendar.end),this.title.setOption("calendar",!0)):this.title.setOption("calendar",!1)},onChangeDate:function(b,c){this.sandbox.trigger("global.date.set",{date:c.date,doRequest:{url:"?date="+c.date+("view_quota"==_DATA.page_label?"&refresh=1":"")}})},setBackButton:function(b){b&&b.last_url&&(this.lastUrl=b.last_url);b&&b.back?(this.title.setOption("backButton",!0),b.back.name?(this.title.setOption("backButtonLabel",b.back.name),this.title.setOption("backButtonIcon",!1),this.title.setOption("backButtonHint",
h(16257))):(this.title.setOption("backButtonLabel",""),this.title.setOption("backButtonIcon","icon-close"),this.title.setOption("backButtonHint",h(6413))),b.back.label=b.back.label||_DATA.page_label,0==(b.back.label||"").indexOf("company_settings")&&"company_settings_display_layout_structure"!=b.back.label&&"company_settings_api_layout_structure"!=b.back.label&&(b.back.trigger="layout.menu.click"),this.title.setOption("backButtonParams",b.back)):this.title.setOption("backButton",!1)},onCloseClick:function(b,
c){var d=this.title.getOption("backButtonParams");d.trigger?this.sandbox.trigger(d.trigger,d):this.menuClick("internal",d)}})})(toa,$);(function(d){var c=d.Controller,b=d.helper.resourceTree.Droppable,e=d.view.ResourceTreePanel;d.ns("toa.controllers.ResourceTree",d.define(c,function(g){c.apply(this,arguments);this.container=g.options.container;this.treeState=g.options.treeState;this.panel=new e(this.container,{state:this.treeState,draggable:!0,withCloseButton:!0,screenName:SCREEN_MAPPINGS.dashboard});d.currentInterface===INTERFACE.MOBILITY&&d.widgets.HangTree.getHangTree().registerTree({screen:SCREEN_MAPPINGS.dashboard,content:$("#tab2 .toa-tree-panel"),
container:$("#tab2"),tree:this.panel,droppable:g});this.panel.addListener("panel.hide",this.hide.bind(this));this.panel.addListener("panel.show",this.show.bind(this));g.trigger("global.hint.assign",{elements:[this.container]});new b(g,this.panel);this.panel.addListener("provider.selected",function(b,c){c===this.panel.getSelectedProviderId()&&this.sandbox.trigger("global.interface.refresh")}.bind(this));this.panel.state.addListener("provider selected",function(b,c,e,d){b=e?!0:!1;if(c!=this.sandbox.get("pid")||
this.sandbox.get("is_favorite_pid")!==+b)this.sandbox.set("pid",c),this.sandbox.set("is_favorite_pid",+b),this.sandbox.set("is_group",0),this.sandbox.trigger("global.provider.changed",{pid:c,isFavorite:b,isGroup:!1,resourceTreeSelection:d})}.bind(this));this.panel.state.addListener("group selected",function(b,c){var e=c?!0:!1;if(c!=this.sandbox.get("pid")||this.sandbox.get("is_favorite_pid")!==+e)this.sandbox.set("pid",0),this.sandbox.set("is_favorite_pid",+e),this.sandbox.set("is_group",1),this.sandbox.trigger("global.provider.changed",
{pid:0,isFavorite:!0,isGroup:!0,resourceTreeSelection:{groupId:c,rootPid:0,selectedPid:0}})}.bind(this));g.bind({"global.provider.select":function(b,c){c.hint_location&&"bottomActivitiesPanel"===c.hint_location?this.sandbox.trigger("interface.activitiesScreen.bottomProviderSelect",c):(c.goToMainTree&&delete this.treeState.getResourceGroups().selection.groupId,this.treeState.selectProvider(c.pid))}.bind(this),"global.date.changed":function(b,c){this.treeState.setDate(c.date)}.bind(this),"interface.resourcesTree.updateScroll":function(){this.treeState.setScrollOffset(this.treeState.getScrollOffset())}.bind(this),
"interface.favorite.applyFavoriteList":function(b,c){this.treeState&&this.treeState.getResourceFavorites()&&this.treeState.getResourceFavorites().update(c)}.bind(this)});this.treeState.selectProvider(g.get("resourceTreeSelection"))},{toString:function(){return"Resource tree controller"},hide:function(){_DATA.tabs.hide(2);this.sandbox.trigger("layout.resourceTree.close",{manual:!0})},show:function(){_DATA.tabs.show(2)}}))})(toa);toa.ns("toa.ui.Confirm",function(d){var c=r(13294),b=r(12411),e=r(13292),g=["br","b"],k=d.acceptButtonHandler,l=function(){},n=function(){},p=$('<div style="outline: none;" />');if("function"!==typeof d.acceptButtonHandler)throw Error("On confirm element missed required option for success function");if("undefined"!==typeof d.dismissButtonHandler){if("function"!==typeof d.dismissButtonHandler)throw Error("On confirm element, dismiss function has wrong format");l=d.dismissButtonHandler}if("undefined"!==
typeof d.onCloseHandler){if("function"!==typeof d.onCloseHandler)throw Error("On confirm element, dismiss function has wrong format");n=d.onCloseHandler}if("undefined"!==typeof d.title){if("string"!==typeof d.title)throw Error("On confirm element, title has wrong format");c=d.title}if(!("string"===typeof d.text&&""!==d.text||d.text instanceof jQuery))throw Error("On confirm element missed required option for window message");if("undefined"!==typeof d.acceptButtonText){if("string"!==typeof d.acceptButtonText||
""===d.acceptButtonText)throw Error("On confirm element, success button text in wrong format");b=d.acceptButtonText}if("undefined"!==typeof d.dismissButtonText){if("string"!==typeof d.dismissButtonText||""===d.dismissButtonText)throw Error("On confirm element, dismiss button text in wrong format");e=d.dismissButtonText}if("boolean"===typeof d.hasMarkup&&!0===d.hasMarkup){var s="<"+g.join("><")+">",g=d.text.replace(/\x3c!--[\s\S]*?--\x3e|<\?(?:php)?[\s\S]*?\?>/gi,"").replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,
function(b,c){return-1<s.indexOf("<"+c.toLowerCase()+">")?b:""});p.html(g)}else p.text(d.text);var t=new toa.ui.Popup({title:c,html:p,autoOpen:!0,popup_extra_css_class:d.popup_extra_css_class?d.popup_extra_css_class:null,onClose:function(){t.destroy();t=null;n()}.bind(this),buttons:[{id:"discard_btn",text:e,visible:!0,click:function(){v();l()}},{id:"ok_btn",text:b,type:"submit",visible:!0,click:function(){v();k()}}]}),u=function(b){if("Escape"!==b.key&&"Enter"!==b.key)return!0;v();switch(b.keyCode){case 27:l();
break;case 13:k()}b.stopPropagation();return!1};$(document).on("keydown",u);var v=function(){$(document).off("keydown",u);t&&t.destroy();t=null}});toa.ns("toa.ui.Alert",function(d){var c=d.titleText||h(13293),b=d.popup_extra_css_class||"",e=d.acceptButtonText||h(12411),g=function(){},k=function(){},l=d.text;b&&"redwood-styles-popup"===b&&(e=h(16226),b+=" alert-popup");if("undefined"!==typeof d.title){if("string"!==typeof d.title)throw Error("On confirm element, title has wrong format");c=d.title}if(!("string"===typeof d.text&&""!==d.text||d.text instanceof jQuery))throw Error("On confirm element missed required option for window message");if("undefined"!==
typeof d.acceptButtonText){if("string"!==typeof d.acceptButtonText||""===d.acceptButtonText)throw Error("On confirm element, success button text in wrong format");e=d.acceptButtonText}if("undefined"!==typeof d.clickButtonHandler){if("function"!==typeof d.clickButtonHandler)throw Error("On confirm element, dismiss function has wrong format");g=d.clickButtonHandler}if("undefined"!==typeof d.onCloseHandler){if("function"!==typeof d.onCloseHandler)throw Error("On confirm element, dismiss function has wrong format");
k=d.onCloseHandler}$(document).off("focusin");var n=new toa.ui.Popup({title:c,html:l,popup_extra_css_class:b,autoOpen:!0,onClose:function(){n.destroy();n=null;k()}.bind(this),buttons:[{id:"ok_btn",text:e,type:"submit",visible:!0,click:function(){n.destroy();n=null;g()}}]})});(function(){toa.ns("toa.ui.TemplateSimpleGrid",toa.define(null,function(){},{getTemplates:function(){return{container:(new toa.Template(['<div class="toa-grid"><table class="grid-content-table" <%=ariaLabel%>><caption></caption><%=headerHtml%><%=contentHtml%></table></div>'])).compile(),header:(new toa.Template(['<tr class="heads">','<td class="selectCell"><input type="checkbox" name="selected_all" value="all"/></td>',"<%=headerCellsHtml%>","</tr>"])).compile(),headerCell:(new toa.Template(['<th scope="col" role="button" tabindex="0" data-name="<%- column.id %>"',
'data-sort="<%-column.order||""%>"','aria-sort="<%=!!column.order ? column.order + "ending"  : "none"%>"','data-sort="<%-column.order||""%>"','class="head <%=column.headClassName || ""%> <%=column.sortable ?  (column.order != "" ? "sort" + column.order : "") : "non-sortable"%>">',"<%=column.label%>",'<div aria-label="'+h(18137)+'" class="arrow_asc">&darr;</div>','<div aria-label="'+h(18138)+'" class="arrow_desc">&uarr;</div>',"<% if (column.filter && column.filter === true) { %>",'<div class="arrow_filter <%=column.statusFilter || "" %>"></div>',
"<% } %>","</th>"])).compile(),content:(new toa.Template(["<%=contentHtml%>"])).compile(),row:(new toa.Template(['<tr class="row" data-id="<%-id%>">','<td class="selectCell"><input type="checkbox" name="selected" value=""/></td>',"<%= cells %>","</tr>"])).compile(),rowheader:(new toa.Template(['<th scope="row" class="cell <%-className||""%>">',"<%=value%>","</th>"])).compile(),cell:(new toa.Template(['<td class="cell <%-className||""%>">',"<%=value%>","</td>"])).compile(),message:(new toa.Template(['<tr class="grid-message-<%=(type? type: "info")%>"><td  colspan="<%=countColumn%>"><%-text%></td></tr>'])).compile()}}}))})();toa.ns("toa.views.workZones.EditForm",function(){var d=toa.mixins.EventEmitter,c=toa.define(null,function(b,c){this.template=new toa.Template('<div class="toa-work-zone"><form class="forms"><input type="hidden" name="wzid" value="<%- wzid %>"><table class="form" role="presentation"><tr class="bct name"><td width="1"><label id="lbl_name_mandatory"><abbr class="ofsc-abbr-mandatory" title="<%- abbr_mandatory %>">*</abbr></label></td><td align="left"><label id="lbl_name"><%- name.label %></label></td><td colspan="2" width="70%"><input type="text" tabindex="0" aria-labelledby="lbl_name lbl_name_mandatory" name="name" class="pwi1" value="<%- name.value %>" maxlength="255"></td></tr><tr class="bct label"><td width="1"><label id="lbl_label_mandatory"><abbr class="ofsc-abbr-mandatory" title="<%- abbr_mandatory %>">*</abbr></label></td><td align="left"><label id="lbl_label"><%- label.label %></label></td><td colspan="2" width="70%"><input type="text" tabindex="0" aria-labelledby="lbl_label lbl_label_mandatory" name="label" class="pwi1" value="<%- label.value %>" maxlength="255"></td></tr><tr class="bct"><td width="1"></td><td align="left"><label id="lbl_status"><%- status.label %></label></td><td colspan="2"><select name="status" tabindex="0" aria-labelledby="lbl_status" class="pwi2"><% for (var key in fields.status) { %><option value="<%- key %>" <% if (key === status.value) { %>selected<% } %>><%- fields.status[key] %></option><% } %></select></td></tr><tr class="bct"><td width="1"></td><td align="left"><label id="lbl_delimiter"><%- delimiter.label %></label></td><td colspan="2"><select name="delimiter" tabindex="0" aria-labelledby="lbl_delimiter" class="pwi2"><% for (var key in fields.delimiter) { %><option value="<%- key %>" <% if (key === delimiter.value) { %>selected<% } %>><%- fields.delimiter[key] %></option><% } %></select></td></tr><tr class="bct"><td width="1"></td><td align="left"><label id="lbl_travelarea"><%- travelarea.label %></label></td><td colspan="2"><select name="travelarea" tabindex="0" aria-labelledby="lbl_travelarea" class="pwi2"><% for (var i = 0, len = fields.travelarea.length; i < len; i++) { %><option value="<%- fields.travelarea[i].key %>" <% if (fields.travelarea[i].key === travelarea.value) { %>selected<% } %>><%- fields.travelarea[i].name %></option><% } %></select></td></tr><tr class="bct locations" valign="top"><td width="1"></td><td align="left"><label id="lbl_locations"><%- locations.label %></label></td><td colspan="2"><textarea name="locations" tabindex="0" aria-labelledby="lbl_locations" class="pwi8" rows="6"><%- locations.value %></textarea></td></tr><tr class="bct shapes" valign="top"><td width="1"></td><td align="left"><label id="lbl_shapes"><%- shapes.label %></label></td><td colspan="2"><textarea name="shapes" tabindex="0" aria-labelledby="lbl_shapes" class="pwi8" rows="6"><%- shapes.value %></textarea></td></tr></table></form></div>');
this.form=$.extend(!0,{wzid:0,abbr_mandatory:h(22351),name:{label:"Work zone name",value:""},label:{label:"Work zone label",value:""},status:{label:"Status",value:""},delimiter:{label:"Delimiter",value:""},travelarea:{label:"Travel Area",value:""},locations:{label:"Work Zone Keys",value:""},shapes:{label:"Work Zone Shapes",value:""}},{fields:c},b)},{template:null,container:null,maxCharacterLimit:50,messages:{name:5064,label:6292,locations:"work_zone_keys_validation_error",shapes:"work_zone_shapes_validation_error"},
render:function(b){var c=this.template.apply(this.form);this.container=$(b);this.container.html(c);$('select[name="delimiter"]',this.container).on("change",this.changeDelimiter.bind(this))},getFields:function(){return $(".forms",this.container).serializeArray()},validate:function(b){var c=[],d="line"==$('select[name="delimiter"]',this.container).val()?"\n":",";$.each(b,function(b,l){var n=!1;if(!this.messages.hasOwnProperty(l.name))return!0;var p=$.trim(l.value),s=$("tr."+l.name,this.container);switch(l.name){case "name":case "label":if(!p.length||
255<p.length)n=!0,c.push({id:l.name,message:h(this.messages[l.name])});break;case "locations":case "shapes":p=p.split(d),$.each(p,function(b,d){var g=$.trim(d);g.length>this.maxCharacterLimit&&(n=!0,c.push({id:l.name+"-"+b,message:r(this.messages[l.name],{"{NAME}":g,"{COUNT_CHARACTER}":this.maxCharacterLimit})}))}.bind(this))}if(n)return s.css("color","#E60000"),!0;s.css("color","#414141")}.bind(this));return c},changeDelimiter:function(){var b=$('select[name="delimiter"]',this.container).val(),c=
$('textarea[name="locations"]',this.container),d=$('textarea[name="shapes"]',this.container);"line"==b?(d.val(d.val().replace(/\s*\,\s*/g,"\n")),c.val(c.val().replace(/\s*\,\s*/g,"\n"))):(d.val(d.val().replace(/\s*\n\s*/g,", ")),c.val(c.val().replace(/\s*\n\s*/g,", ")))}});toa.mixin(c.prototype,d);return c}());(function(d){var c=(new d.Template(['<div class="toa-uploadFile">','<input required class="file" tabindex="0" type="file" name="<%-formName%>" <% if (typeAccept) { %> accept="<%-typeAccept%>" <% } %> <% if (ariaLabelledBy) { %> aria-labelledby="<%-ariaLabelledBy%>" <% } %>  />','<input class="url" tabindex="0" <% if (ariaLabelledBy) { %> aria-labelledby="<%-ariaLabelledBy%>" <% } %> type="text" value="" />','<button class="toa-button" tabindex="0"><%-h(12097)%></button>',"</div>"])).compile();d.ns("toa.view.uploadFile",
d.define(null,function(b){this.target=b},$.extend({},d.mixins.EventEmitter,{fileSize:0,fileType:"",render:function(b,e,d){b=$(c.apply({formName:b,typeAccept:e||"",ariaLabelledBy:d||!1}));this.fileForm=b.find("[type=file]");this.urlField=b.find(".url");this.fileForm.on("change",this.onChangeFileUpload.bind(this));this.target.append(b)},onChangeFileUpload:function(b){if(b=b.currentTarget.files[0]){this.fileSize=b.size;this.fileType=b.type;var c=new FileReader;c.onload=function(b){this.file=b.target.result;
this.notify("change")}.bind(this);c.readAsDataURL(b);this.urlField.val(b.name)}},getFileSize:function(){return this.fileSize},getFileType:function(){return this.fileType},reset:function(){this.fileForm&&this.fileForm.val("")},getFile:function(){return this.file}})))})(toa);(function(d){d.widgets.MultiselectOptionDialog=d.define(null,function(c){this.options=c||{};this._defaults={width:300,height:450};this.dialog=null;this._options=$.extend(this._defaults,c);this.collection=this._options.data;this.collection.selected=$.extend(!0,[],this._options.data.selected);this._render(c);this._initEventListeners();this.itemsChosen=[]},{events:{"click .multiselectDeleteIcon":"_deleteItem","click .multiselectAddIcon":"_addItem","keyup .multiselectSearchInput":"_onTypeSearch","click .clearSearchButton":"_onClickClearSearch",
"change .multiselectFilterable":"_onChangeItem"},_initEventListeners:function(){$.each(this.events,function(c,b){var e=this._$el,d=c.split(" ");if(1!==d.length&&2!==d.length||!d[0].length)throw Error("Incorrect description of event selector ("+c+")");var k=b;"string"===typeof b&&(k=this[b]);if(!k||"function"!==typeof k)throw Error('Incorrect event handler for selector "'+c+'"');2===d.length&&(e=d[1],e=this._$el.find(e).addBack().filter(e));e.off().on(d[0],k.bind(this));if("click"===d[0])e.on("keypress",
this._onEnterKeyHandler.bind(this,k))}.bind(this))},_onEnterKeyHandler:function(c,b){if(13==b.which)return c.call(this,b),!1},_getEditItems:function(){(this._sortField=this._options.editOptions.sortField)&&this.collection.selected.sort(this._sortItems.bind(this));this.collection.selectedIds=this._getSelectedIds();return this._getList()},_getList:function(){return this._getEditContent({collection:this.collection.selected,editable:this._options.editOptions.editable,inlineStructure:this._options.editOptions.inlineStructure||
!1,sort:this._options.editOptions.sortable||!1})},_updateEditScreen:function(){var c=this._getList();this._container.html(c);this.options.editOptions&&!0==this.options.editOptions.sortable&&this._makeSortable();this._initEventListeners();this._applyPopupStyles("edit")},_getSelectedIds:function(){for(var c=[],b=0;b<this.collection.selected.length;b++)c.push(this.collection.selected[b]._id.toString());return c},_sortItems:function(c,b){return c[this._sortField]>b[this._sortField]?1:c[this._sortField]<
b[this._sortField]?-1:0},_render:function(c){var b=null;this.collection.duplicateIds=this._getDuplicateIds();c.editOptions?b=this._getEditItems():(this.collection.selectedIds=this._getSelectedIds(),b=this._getFilterContent({collection:this.collection.all}));var e=$('<div class="multiselect-container">');e.append(b);b=[{text:h(14621),click:function(){c.persistentList||0!=this.collection.selected.length?(this.itemsChosen=[],this._goToEditScreen()):this.dialog.destroy()}.bind(this),position:"left",id:"cancelBtn"},
{text:h(14220),type:"submit",click:function(){this._goToEditScreen(!0)}.bind(this),position:"right",id:"addBtn"}];if(c.editOptions&&c.editOptions.buttons)for(var g=0;g<b.length;g++)for(var k=0;k<c.editOptions.buttons.length;k++)b[g].id==c.editOptions.buttons[k].id&&(b[g]=$.extend(b[g],c.editOptions.buttons[k]));this.dialog=new d.ui.Popup({title:c.title,isTitleHtml:c.isTitleHtml?!0:!1,width:c.width,height:c.height,autoOpen:!0,modal:!0,onClose:c.onClose||this.destroy.bind(this),buttons:c.editOptions?
c.buttons.concat(b):c.buttons});this.dialog.setContent(e);c.editOptions&&!0==c.editOptions.sortable&&this._makeSortable();this._$el=$(this.dialog._dom.base);this._container=this._$el.find(".multiselect-container").parent();this._container.css({"overflow-x":"hidden"});$("body").hasClass("themeredwood")||this._container.css({"margin-top":"-10px"});this._showAddBtns(!1);$(".nodeText").show();setTimeout(function(){this._$el.find(":focusable").eq(0).focus()}.bind(this),100);c.editOptions?this._applyPopupStyles("edit"):
this._applyPopupStyles();c.persistentList||0!=this.collection.selected.length||this._addItem(!1)},destroy:function(){this.collection=null;this.dialog.destroy()},_applyPopupStyles:function(c){var b=this._container.height();"edit"==c?this._container.find(".multiselectEditContainer").css({height:b-5}):(this._container.find(".multiselectEditContainer").css("height","0"),this._container.find(".multiselectFilterContainer").css({height:b-5}));c=parseInt((b-50)/b*100)+"%";this._container.find(".multiselectListSection").css({height:c})},
_makeSortable:function(){$(".multiselectListSection  .multiselectListContainer").sortable({axis:"y",scroll:!1,opacity:0.9,helper:"clone",placeholder:"toa-grid-setup-placeholder",hideOrigin:!1,start:function(c,b){b.item.show().addClass("toa-grid-setup-row-gost")},stop:function(c,b){b.item.removeClass("toa-grid-setup-row-gost");var e=b.item.index(),d=parseInt(b.item.attr("data-index")),k=this.collection.selected[d];d!=e&&(d<e?e+=1:d+=1,this.collection.selected.splice(e,0,k),this.collection.selected.splice(d,
1),this._updateItems("update"),this._updateEditScreen(),this.collection.selectedIds=this._getSelectedIds())}.bind(this)});d.touch.setTouchDraggable(".multiselectSortHelper")},_getEditContent:function(c){var b='<div class="multiselectEditContainer"><div class="multiselectAddContainer"><% if ( !inlineStructure ) {%><div class="multiErrorMessage"><% if(items.length == 0){ %><span class="multiselectHelper"><%=infoMsg%></span><%}%></div><% } else {%><div class="org-name-container"><span class="org-name">'+
h(11978)+'<span>:&nbsp;</span></span><span><%=itemInfo%></span></div><% } %><div class="multiselect-btn"><div aria-label="<%= h(11935/* Add new */) %>" role="button" class="multiselectAddIcon" tabindex="0"></div></div><% if ( inlineStructure ) {%><div class="error-container"><div class="multiErrorMessage"><% if(items.length == 0){ %><span class="multiselectHelper"><%=infoMsg%></span><%}%></div></div><% } %></div><div class="multiselectListSection"><div class="multiselectListContainer"><%for(var count = 0; count < items.length; count++) {%><div class="multiselectRow" data-index="<%- count %>"><div aria-label="<%= h(21056/*Remove item*/) %>" aria-describedby="lbl-<%- items[count]._id %> lbl-<%- items[count]._id %>-additional" id="cbFilterable-<%- items[count]._id %>" class="multiselectDeleteIcon" role="button" tabindex="0"></div><div class="multiselectElems"><% if( !inlineStructure ) {%><label id="lbl-<%- items[count]._id %>" ><%- all[items[count]._id] || items[count]._id %></label><% if(duplicateIds.indexOf(items[count]._id) != -1 && labelLookup) {%><label id="lbl-<%- items[count]._id %>-additional" class="multi-label-grey"> - <%- labelLookup[items[count]._id] %></label><% } %></span><% } else {%><div class="inlineContainer"><div class="inlineName"><%- all[items[count]._id] %></div><% } %><% if(editable) {%><% if( !inlineStructure ) {%><div class="multiselectTemplate"><% for(var item in editable.fields) {%><% if(editable.fields[item].type == "textbox") {%><input aria-label="<%- editable.fields[item].ariaLabel || ""%>" type="text" class="multi-edit-item prop-<%-item%>" style="width:<%- editable.fields[item].width %>px;" value="<%- items[count][editable.fields[item].value] || ""%>" maxlength="<%-editable.fields[item].maxlength%>"><% } else if(editable.fields[item].type == "select") {%><select aria-label="<%- editable.fields[item].ariaLabel || ""%>" class="multi-edit-item-select prop-<%-item%>" style="width:<%- editable.fields[item].width %>px;" value="<%- items[count][editable.fields[item].value] || ""%>"><% for(var option in editable.fields[item].options){ %><option value="<%- option%>"<% if(items[count][editable.fields[item].value] == option) {%>selected<% } %>><%- editable.fields[item].options[option]%></option><% } %></select><% } %><% if(editable.fields[item].type == "label") {%><span class="multiselect-editable-label"><%-editable.fields[item].value%></span><% } %><% } %></div><% } else {%><% for(var item in editable.fields) {%><div class="inline-textbox-holder"><input aria-label="<%- items[count][editable.fields[item].ariaLabel] || ""%>" type="text" class="inline-input multi-edit-item prop-<%-item%>" style="width:<%- editable.fields[item].width %>px;" value="<%- items[count][editable.fields[item].value] || ""%>" maxlength="<%-editable.fields[item].maxlength%>"></div><% } %></div><% } %><%}%></div><% if( !inlineStructure ) {%><div class="multiselectSortHelper multiselectSortIcon"></div><% } %></div><% } %></div></div></div><div class="multiselectFilterContainer"></div>';
return(new d.Template(b)).compile().apply({items:c.collection,all:this.collection.all,editable:c.editable,inlineStructure:c.inlineStructure,sort:c.sort,duplicateIds:this.collection.duplicateIds||[],labelLookup:this.collection.label,infoMsg:h(17077),itemInfo:this.collection.itemInfo||""})},_getFilterContent:function(c){return(new d.Template('<div class="multiselectSearch" role="search"><i class="searchIcon"></i><input aria-label="<%= h(7746/* Search */) %>" class="multiselectSearchInput" ><a class="clearSearchButton hidden"></a></div><div class="multiselectListSection"><div class="multiselectFilterCont multiselectRowContainer"><%for(var item in items) {%><div class="multiselectRow"><div><input id="cbFilterable-<%- item %>" class="multiselectFilterable" type="checkbox" <% if (selectedIds.length > 0 && selectedIds.indexOf(item) != -1) {%>checked="checked"<% } %>></div><div class="multiselectLabel"><label for="cbFilterable-<%- item %>"><%- items[item] %><% if(langsWithoutGlossary[item]) { %><span class="multi-label-grey">* <%- langInfo %></span><% } %><% if(duplicateIds.indexOf(item) != -1 && labelLookup) {%><span class="multi-label-grey"> - <%- labelLookup[item] %></span></label><% } %></div></div><% } %></div></div>')).compile().apply({items:c.collection,
selectedIds:this.collection.selectedIds||[],labelLookup:this.collection.label,duplicateIds:this.collection.duplicateIds||[],langInfo:this.collection.langInfo||"",langsWithoutGlossary:this.collection.langsWithoutGlossary||[]})},_deleteItem:function(c){var b=$(c.target).attr("id").split(/-(.+)/)[1];this._setItemsEnabled(!1,b);$(c.target).parent().remove();0==this.collection.selected.length&&$(".multiselectAddContainer .multiErrorMessage").html(h(17077)).addClass("multiselectHelper")},_showAddBtns:function(c){c?
(this._$el.find("button").hide(),this._$el.find('button[data-popupbtnid="cancelBtn"]').show(),this._$el.find('button[data-popupbtnid="addBtn"]').show()):(this._$el.find("button").show(),this._$el.find('button[data-popupbtnid="cancelBtn"]').hide(),this._$el.find('button[data-popupbtnid="addBtn"]').hide())},_addItem:function(c){var b=this._getFilterContent({collection:this.collection.all});this.showItemView(c,b)},showItemView:function(c,b){var e=c?500:0,d=this._$el.find(".multiselectFilterContainer"),
k=this._$el.find(".multiselectEditContainer");k.html("");$(".multiselectAddContainer .multiErrorMessage").html("");d.append(b||"");this._options.editOptions&&this._showAddBtns(!0);$(".nodeText").hide();this._applyPopupStyles();this._initEventListeners();k.animate({right:"285px"},e);d.animate({right:"0px"},e)},_onTypeSearch:function(c){c=$(c.target).val().toLowerCase();this._filterList(c)},_filterList:function(c){var b=this._$el.find(".multiselectFilterCont .multiselectRow"),e=this._$el.find(".clearSearchButton");
if(!c)return e.toggleClass("hidden",!0),$.each(b,function(b,c){$(c).toggleClass("hidden",!1)}),!1;e.toggleClass("hidden",!1);$.each(b,function(b,e){var d=$(e),n=-1<d.find("label").text().toLowerCase().indexOf(c);d.toggleClass("hidden",!n)})},_onClickClearSearch:function(){this._$el.find(".clearSearchButton").toggleClass("hidden",!0);this._$el.find(".multiselectSearchInput").val("");this._filterList()},_setItemsEnabled:function(c,b){var e=this.collection.selectedIds.indexOf(b);this.collection.selected.splice(e,
1);this.collection.selectedIds=this._getSelectedIds()},_setItemsInTemp:function(c,b){for(var e=0;e<this.itemsChosen.length;e++)if(this.itemsChosen[e]._id==b)return this.itemsChosen[e].assigned=c,!1;this.itemsChosen.push({_id:b,assigned:c})},_updateItems:function(c){for(var b=0;b<this.itemsChosen.length;b++){var e=this.collection.selectedIds.indexOf(this.itemsChosen[b]._id);if(-1==e){if(this.itemsChosen[b].assigned&&(this.collection.selected.push({_id:this.itemsChosen[b]._id}),this._options.editOptions&&
this._options.editOptions.editable)){var e=this.collection.selected.length,d;for(d in this._options.editOptions.editable.fields)this.collection.selected[e-1][d]=""}}else!this.itemsChosen[b].assigned&&this.collection.selected.splice(e,1);this.collection.selectedIds=this._getSelectedIds()}this.itemsChosen=[];if("update"==c)for(b=0;b<this.collection.selected.length;b++)if(c=$(".multiselectRow")[b],this._sortField&&(this.collection.selected[b][this._sortField]=b),this._options.editOptions&&this._options.editOptions.editable)for(d=
this._options.editOptions.editable.props,e=0;e<d.length;e++)this.collection.selected[b][d[e]]=$(c).find(".prop-"+d[e]).val()},_onChangeItem:function(c){var b=$(c.target).attr("id").split(/-(.+)/)[1];c=$(c.target).is(":checked");this._setItemsInTemp(c,b)},_goToEditScreen:function(c){var b=this._$el.find(".multiselectFilterContainer");this._$el.find(".multiselectEditContainer").animate({right:"0px"},500,function(){c&&this._updateItems("add");this._updateEditScreen();this._showAddBtns(!1);$(".nodeText").show();
this._$el.find(":focusable").first().focus();b.html("")}.bind(this));b.animate({right:"-285px"},500)},_getDuplicateIds:function(){var c=[],b=[],e=[],d=this.collection.all,k;for(k in d){var l=b.indexOf(d[k]);-1!=l&&(c.push(k),c.push(e[l]));b.push(d[k]);e.push(k)}return c},getSelectedObject:function(){this._updateItems("update");return this.collection.selected},validate:function(){if(this._options.editOptions.editable)for(var c=0;c<this.collection.selected.length;c++)for(var b=$(".multiselectRow")[c],
e=this._options.editOptions.editable.propsToValidate,d=0;d<e.length;d++){var k=$(b).find(".prop-"+e[d]).val();if(!k||0==k||"cslength"==e[d]&&!/^\+?\d+$/.test(k))return $(".multiselectAddContainer .multiErrorMessage").html(this.options.validataionTxt||h(481)),!0}if(this._options.nonEmpty&&0==this.collection.selected.length)return $(".multiselectAddContainer .multiErrorMessage").html(this.options.nonEmpty.validationText).removeClass("multiselectHelper"),!0},fieldsValidation:function(){var c=!0,b=!1,
e=null,d=null;if(this._options.editOptions.editable)for(var k=0;k<this.collection.selected.length;k++){var l=$(".multiselectRow")[k],n=this._options.editOptions.editable.fields,p;for(p in n)if(0!=$(l).find(".prop-"+p).length){var d=$(l).find(".prop-"+p),e=d.val(),b=n[p],s;for(s in b){switch(s){case "minvalue":c=isInt(e)&&e>=b[s];break;case "maxvalue":c=isInt(e)&&e<=b[s];break;case "maxlength":c=e.length<=b[s]}if(!c)return $(".multiselectAddContainer .multiErrorMessage").html(this.options.validataionTxt||
h(481)),d.focus(),!1}}}return c},showErrorMsg:function(c){$(".multiselectAddContainer .multiErrorMessage").text(c).removeClass("multiselectHelper")}})})(toa);(function(d){var c=d.widgets.MultiselectOptionDialog;d.widgets.MultiselectActivityFiltersDialog=d.define(c,function(b){c.apply(this,arguments)},{events:{"click .multiselectDeleteIcon":"_deleteItem","click .multiselectAddIcon":"_addItem","click .multiselectEdit":"_editItem","click .ap-shape-option":"_onClickActivityShape","change #ap-select-filter":"_onChangeFilter"},shapes:[{id:"1",name:"big circle"},{id:"3",name:"square"},{id:"4",name:"diamond"},{id:"5",name:"triangle"},{id:"6",name:"star"}],_getSelectedIds:function(){return $.map(this.collection.selected||
[],function(b,c){return""+c})},_getEditContent:function(b){var c='<div class="multiselectEditContainer"><div class="multiselectAddContainer"><div class="multiErrorMessage"><% if(items.length == 0){ %><span class="multiselectHelper"><%= infoMsg %></span><%}%></div><div class="multiselect-btn" <% if (limit && items.length >= limit) {%>style="visibility: hidden;"<% } %>><div aria-label="<%= h(11935/* Add new */) %>" role="button" class="multiselectAddIcon" tabindex="0"></div></div></div><div class="multiselectListSection"><div class="multiselectFreeContainer"><div class="multiselectRow"><div class="multiselectEmptyIcon" role="none" tabindex="-1" aria-hidden="true"></div><div class="multiselectElems"><label id="lbl-urgent" ><div class="activity-grade" id="urgent-activities-grade"><div class="activity-grade-image activity-shape-0" aria-label="urgent circle" role="img"></div><div class="activity-grade-colors urgent"></div><div class="activity-grade-text">'+
h(225007)+'</div></div></label></div></div></div><div class="multiselectListContainer"><%for(var count = 0; count < items.length; count++) {%><div class="multiselectRow" data-index="<%- count %>"><div aria-label="<%= h(21056/*Remove item*/) %>" aria-describedby="lbl-<%- items[count]._id %> lbl-<%- items[count]._id %>-additional" id="cbFilterable-<%- items[count]._id %>" class="multiselectDeleteIcon" role="button" tabindex="0"></div><div class="multiselectElems multiselectEdit" data-index="<%- count %>"><div class="activity-grade"><div class="activity-grade-image activity-shape-<%- items[count].shape %>" aria-label="<%- shapes[items[count].shape] %>" role="img"></div><div class="activity-grade-colors"></div><div class="activity-grade-text"><% if (!items[count].valid) { %><span class="error">'+
h(225005)+'</span> <% } %><%- items[count].val %></div></div></div><div class="multiselectSortHelper multiselectSortIcon" aria-label="'+h(23872)+'" role="button"></div></div><% } %></div><div class="multiselectFreeContainer"><div class="multiselectRow"><div class="multiselectEmptyIcon" role="none" tabindex="-1" aria-hidden="true"></div><div class="multiselectElems"><label id="lbl-urgent" ><div class="activity-grade" id="urgent-activities-grade-2"><div class="activity-grade-image activity-shape-2" aria-label="small circle" role="img"></div><div class="activity-grade-colors"></div><div class="activity-grade-text">'+
h(225008)+'</div></div></label></div></div></div></div></div><div class="multiselectFilterContainer"></div>';return(new d.Template(c)).apply({items:this.getSelectedInfo(b.collection),infoMsg:h(17077),limit:this.options.limit,shapes:this.shapesById(this.shapes)})},shapesById:function(b){var c={},d;for(d in b)c[b[d].id]=b[d].name;return c},getSelectedInfo:function(b){var c=this.collection.all;return $.map(b,function(b,d){var l=[],n=c.enum[b.cfid]||"";$.each(b.conditions,function(d,k){if(!k.cfcvalue)return!0;
$.each(c.fields,function(c,e){if(e.dynamic.value==b.cfid&&-1!==c.indexOf(k.cfcfield,c.length-k.cfcfield.length))return l.push(e.enum&&e.enum[k.cfcvalue]?e.enum[k.cfcvalue]:k.cfcvalue),!1})});l.length&&(n+=": "+l.join("; "));return{_id:d,val:n,shape:b.shape,valid:!1!==b.valid}})},_onClickActivityShape:function(b){b=$(b.currentTarget);b.parent().find(".oj-selected").removeClass("oj-selected").attr("aria-selected",!1);b.addClass("oj-selected").attr("aria-selected",!0);$("#ap-shape-value").val(b.data("shape"))},
_addItem:function(b){c.prototype._addItem.call(this,b);b=$("#ap-select-filter",this._$el).val();this.changeFilterField(b)},_editItem:function(b){var c=$(b.currentTarget).data("index");if(b=this.collection.selected[c])c=this._getFilterContent({collection:this.collection.all,index:c,item:b}),this.showItemView(!0,c),this.changeFilterField(b.cfid,b.conditions)},_onChangeFilter:function(b){b=$(b.target).val();this.changeFilterField(b)},changeFilterField:function(b,c){c=c||[];var d=0,k=$.map(this.collection.all.fields,
function(k,n){if(b!=k.dynamic.value)return null;var p=null,s=n.split("_").splice(3).join("_"),t;for(t in c)if(""+c[t].cfcfield===s){p=c[t];break}var u=p&&p.cfcvalue||k.default,v='<label for="ap-filter-value">'+k.view.label+"</label>";s&&(v+='<input type="hidden" name="conditions['+d+'][cfcfield]" value="'+s+'">');p&&"undefined"!==typeof p.id&&(v+='<input type="hidden" name="conditions['+d+'][id]" value="'+p.id+'">');if("text"===k.view.gui)v+='<input type="text" name="conditions['+d+'][cfcvalue]" value="'+
(u||k.default||"")+'" />';else if("combobox"===k.view.gui){v+='<select name="conditions['+d+'][cfcvalue]" aria-labelledby="ap-filter-value">';for(t in k.enum)v+='<option value="'+t+'"'+(u==t?" selected":"")+">"+k.enum[t]+"</option>";v+="</select>"}d++;return v});this._clearErrors();return $(".ap-filter-dynamic",this._$el).html(k.join(""))},_getFilterContent:function(b){var c=b.item||{};return(new d.Template('<div class="multiselectListSection jet-css-only ap-list-section"><form class="ap-filter-form" data-index="<%- index %>"><label for="ap-shapes-set"><%- shapesSetLabel %></label><div class="oj-buttonset-multi activity-grade" id="ap-shapes-set"><% for (var i = 0; i < shapes.length; i++) {%><span class="oj-button ap-shape-option<% if (shapes[i].id == shape) {%> oj-selected<% } %>" aria-selected="<% if (shapes[i].id == shape) {%>true<% } %>" data-shape="<%- shapes[i].id %>" role="button" tabindex="0" aria-label="<%- shapes[i].name %>"><span class="activity-grade-image activity-shape-<%- shapes[i].id %>" aria-label="<%- shapes[i].name %>" role="img"></span></span><% } %></div><input type="hidden" id="ap-shape-value" name="shape" value="<%- shape %>" /><label id="ap-filter-field"><%- filterFieldLabel %></label><select name="cfid" id="ap-select-filter" aria-labelledby="ap-filter-field"><% for (var filter in filters) {%><option value="<%- filter %>" <% if (filter == cfid) {%>selected<% } %>><%- filters[filter] %></option><% } %></select><div class="ap-filter-dynamic"></div></form></div>')).compile().apply({shapesSetLabel:h(225012),
filterFieldLabel:h(225006),filters:b.collection.enum,cfid:c.cfid||b.collection.default,shape:c.shape||"1",shapes:this.shapes,index:"undefined"!==typeof b.index?b.index:-1})},_updateItems:function(b){if("add"===b){var c={},d=/([^\]\[]+)/g;b=$(".ap-filter-form",this._$el);var k=b.data("index");b.serializeArray().forEach(function(b){for(var k,p=[],s=b.value;k=d.exec(b.name);)p.push(k[0]);if(1===p.length)c[b.name]=s;else if(1<p.length){var t=c,u=p.length-1;$.each(p,function(b,c){"undefined"===typeof t[c]&&
(t[c]=b===u?s:{});t=t[c]})}});-1<k&&this.collection.selected[k]?this.collection.selected[k]=c:this.collection.selected.push(c)}},_goToEditScreen:function(b){if(!b||this._validateFilter())this._clearErrors(),c.prototype._goToEditScreen.call(this,b)},_validateFilter:function(){for(var b=$(".ap-filter-form",this._$el).serializeArray(),c=0;c<b.length;c++){var d=b[c].name,k=b[c].value;if("cfid"===d&&"0"===k||0===d.indexOf("conditions")&&""===k)return this.dialog.setErrors([{id:1,message:h(225004)}]),!1}return!0},
_clearErrors:function(){this.dialog.setErrors([])},_deleteItem:function(b){c.prototype._deleteItem.call(this,b);this._updateEditScreen()}})})(toa);(function(d){d.widgets.HangTree=d.define(null,function(){this.treeObj={};this.popUp=[];this.currentScreen=null;this.MIN_TREE_HEIGHT=400;this.bindListeners()},{registerTree:function(c){this.setTreeOptions(c);this.assignActivityHint(c.droppable,c.content)},registerPanel:function(c,b){"undefined"===typeof this.treeObj[c]&&(this.treeObj[c]={});this.treeObj[c].panelElement=b;this.currentScreen=c;b.on("click",this.openHangTree.bind(this));b.on("keypress",function(b){13===b.keyCode&&this.openHangTree.call(this,
b)}.bind(this))},isScreenWidthModified:function(){"undefined"===typeof this.previous_screen_width&&(this.previous_screen_width=0);var c=this.previous_screen_width!==(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth);this.previous_screen_width=window.innerWidth;return c},isSmallScreen:function(){return(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<=RESPONSIVE_WIDTH.MIN},initializeTreeTip:function(){if(!this.isTipInitialized()){var c=
_DATA.dispatcher_container;this.currentScreen===SCREEN_MAPPINGS.forecasting&&(c="#content-jet");this.getCurrentTree().content.Tip({minWidth:250,width:350,minHeight:this.MIN_TREE_HEIGHT,className:"hang-tree tip_container_"+this.currentScreen,callout:!1,container:c,onHide:this.onHintHide.bind(this),notOutsideElements:this.treeObj[this.currentScreen].panelElement});this.getCurrentTree().content.attr("tabindex","-1");0<this.getCurrentTree().container.find(".toa-tree-panel, .toa-panel, .oj-treeview-list").length&&
this.getCurrentTree().content.Tip("getContainer").append(this.getCurrentTree().content);this.getCurrentTree().droppable&&(c=this.getCurrentTree().tree,c.container=this.getCurrentTree().content.Tip("getContainer"),new d.helper.resourceTree.Droppable(this.getCurrentTree().droppable,c))}},assignActivityHint:function(c,b){this.isActivityScreen()&&c.trigger("global.hint.assign",{elements:[b],disableHover:!0,location:this.currentScreen,getDate:function(b){b&&(this.currentScreen=b);if("undefined"!==typeof this.getCurrentTree().tree.state&&
"undefined"!==typeof this.getCurrentTree().tree.state.treeDate)return this.getCurrentTree().tree.state.treeDate}.bind(this)})},isActivityScreen:function(){return this.currentScreen===SCREEN_MAPPINGS.activity_top||this.currentScreen===SCREEN_MAPPINGS.activity_bottom},onHintHide:function(c){c=c||this.currentScreen;this.treeObj[c].panelElement.removeClass("panel-title-border")},getCurrentTree:function(){return this.treeObj[this.currentScreen]},isTipInitialized:function(){var c=!0;this.getCurrentTree().container&&
0<this.getCurrentTree().container.find(".toa-tree-panel, .toa-panel, .oj-treeview-list").length&&(c=!1);return c},bindListeners:function(){d.app.bind("hang.tree.pin",this.pinHangTree.bind(this));d.app.bind("hang.tree.resourcePopUp",this.resourcePopUpHangTree.bind(this));d.app.bind("hang.tree.hide",this.hideHangTree.bind(this));$(window).on("resize",this.makeResponsive.bind(this))},makeResponsive:function(){this.isScreenWidthModified()&&this.isSmallScreen()&&this.refreshAll()},refreshAll:function(){for(var c in this.treeObj){var b=
this.treeObj[c].screen;"undefined"!=typeof _DATA&&"undefined"!=typeof _DATA.page_label&&_DATA.page_label.includes("report")?this.getTreeState(b)&&_DATA.tabs.tabs[2].visible&&this.refresh(b):this.getTreeState(b)&&this.refresh(b)}},addListeners:function(){this.currentScreen===SCREEN_MAPPINGS.forecasting&&this.getCurrentTree().signalEmitter?this.getCurrentTree().signalEmitter.addListner("forecasting.resourcetree.selected",this.onResourceSelected.bind(this.getCurrentTree())):this.getCurrentTree().tree.addListener("provider.selected",
this.onResourceSelected.bind(this.getCurrentTree()))},onResourceSelected:function(){"hang"===this.currentTreeState&&this.content.Tip("hide")},resourcePopUpHangTree:function(c,b){var e=b.screenName;"undefined"===typeof this.popUp[e]&&(this.popUp[e]={});this.popUp[e]=b;var g=this.getCurrentTree().content,k=g.Tip("getContainer");$(".toa-popUp-resource-panel-title").remove();var l='<div class="toa-popUp-resource-panel-title"><a type="button "class="toa-popUp-back-button" name="resource-hint-close" aria-label="Click to go back to Resource Tree" title=<%-backButtonText%>></a>'+
("object"===typeof b.title&&b.title.length?b.title.html():'<div class="toa-popUp-resource-header-title" aria-label=<%-panelTitle%>><%-panelTitle%></div>');"</div>";l=new d.Template(l);k.prepend(l.apply({backButtonText:h(16257),panelTitle:b.title}));k.append(this.popUp[e].content).addClass("resource_hint_tip_container").css({height:"auto",width:"auto"});g.hide();$(".toa-hint-resource-path").hide();$(".toa-popUp-resource-panel-title").show();$("a.toa-popUp-back-button").on("click",this.popUpClose.bind(this,
this.currentScreen));g.Tip("option","minHeight",k.height());g.Tip("showAt",this.treeObj[e].target,"bottom")},popUpClose:function(c){c=c||this.currentScreen;if(this.popUp[c]&&this.popUp[c].content&&this.popUp[c].content.hasClass("toa-resource-popUp")){var b=this.treeObj[c].content,e=$(b).Tip("originalSize").height,d=$(b).Tip("originalSize").width;b.Tip("getContainer").css({height:e,width:d}).removeClass("resource_hint_tip_container");b.show();$(".toa-hint-resource-path").show();$(".toa-popUp-resource-panel-title").hide();
this.popUp[c].container.append(this.popUp[c].content);this.popUp[c].content.removeClass("toa-resource-popUp");b.Tip("option","minHeight",this.MIN_TREE_HEIGHT);b.Tip("showAt",this.treeObj[c].target,"bottom");this.scrollIntoView()}},hideHangTree:function(c,b){"undefined"!=typeof this.treeObj[b.screenName]&&this.treeObj[b.screenName].content&&(this.popUpClose(b.screenName),this.treeObj[b.screenName].content.Tip("hide"),this.onHintHide(b.screenName))},pinHangTree:function(c,b){this.currentScreen=b.attr("data-screen");
b.hasClass("toa-icon-resource-tree-hang")?this.hangTree():(this.pinTree(),this.scrollIntoView())},scrollIntoView:function(c){c&&_DATA.page_label.match(/(reports_*)\w+/g)?(c=c.top,c=$(".edt-selected:visible").offset().top-c,$(".edtree:visible")[0].scrollTo(0,c)):((c=$(".edt-selected:visible").get(0))&&c.scrollIntoView(!1),(c=$(".edt-selected:visible").get(1))&&c.scrollIntoView(!1))},openHangTree:function(c){$(c.currentTarget).hasClass("toa-panel-tree-open")&&(this.currentScreen=$(c.currentTarget).attr("data-screen"),
this.initializeTreeTip(),this.getCurrentTree().content.Tip("isOpen")?this.getCurrentTree().content.Tip("hide"):$(c.currentTarget).hasClass("toa-panel-tree-open")&&($(c.currentTarget).addClass("panel-title-border"),this.initializeTreeTip(),this.treeObj[this.currentScreen].target=c.target,this.getCurrentTree().content.Tip("showAt",c.currentTarget,"bottom"),this.getCurrentTree().content.focus(),this.popUpClose()),this.scrollIntoView())},getTreeState:function(c){var b=!1;"object"===typeof this.treeObj[c]&&
(b=this.treeObj[c].currentTreeState);return b},setTreeState:function(c,b){this.currentScreen=c;if("hang"===b)this.hangTree();else if("pin"===b){var e=$(".edt-selected:visible").offset();this.initializeTreeTip();this.pinTree();this.scrollIntoView(e)}else this.refresh(c)},setTreeOptions:function(c){"undefined"===typeof this.treeObj[c.screen]&&(this.treeObj[c.screen]={});$.extend(this.treeObj[c.screen],c);this.currentScreen=c.screen;this.addListeners()},pinTree:function(){this.isActivityScreen()&&this.getCurrentTree().droppable.trigger("global.hint.setHintTip",
{screenName:this.currentScreen,showHint:!1});this.getCurrentTree().panelElement&&(this.getCurrentTree().panelElement.removeClass("toa-panel-tree-open"),this.getCurrentTree().panelElement.attr("tabindex","-1"));this.isTipInitialized()&&(this.getCurrentTree().container.append(this.getCurrentTree().content),this.getCurrentTree().content.removeClass("ui-tip-content"));this.getCurrentTree().content.Tip("hide");$(_DATA.dispatcher_container).mousedown();this.getCurrentTree().currentTreeState="pin";this.getCurrentTree().content.find(".toa-hang-tree-icon").addClass("toa-icon-resource-tree-hang");
this.getCurrentTree().content.find(".toa-hang-tree-icon").removeClass("toa-icon-resource-tree-pin");this.currentScreen===SCREEN_MAPPINGS.forecasting&&this.getCurrentTree().signalEmitter?this.getCurrentTree().signalEmitter.dispatch("resourcetree.hang"):this.getCurrentTree().tree.notify("panel.show")},hangTree:function(){this.isActivityScreen()&&this.getCurrentTree().droppable.trigger("global.hint.setHintTip",{screenName:this.currentScreen,showHint:!0});this.getCurrentTree().panelElement&&(this.getCurrentTree().panelElement.addClass("toa-panel-tree-open"),
this.getCurrentTree().panelElement.attr("tabindex","0"));this.initializeTreeTip();this.getCurrentTree().content.find(".toa-hang-tree-icon").addClass("toa-icon-resource-tree-pin");this.getCurrentTree().content.find(".toa-hang-tree-icon").removeClass("toa-icon-resource-tree-hang");this.currentScreen===SCREEN_MAPPINGS.forecasting&&this.getCurrentTree().signalEmitter?this.getCurrentTree().signalEmitter.dispatch("forecasting.resourcetree.hide"):this.getCurrentTree().tree.notify("panel.hide");this.getCurrentTree().currentTreeState=
"hang"},refresh:function(c,b){if("object"===typeof this.treeObj[c]){this.currentScreen=c;var e=this.treeObj[c].currentTreeState;this.isSmallScreen()&&"hang"!==e?this.hangTree():b||(this.initializeTreeTip(),"hang"===e?this.hangTree():this.pinTree())}}},{hangTreeInstance:null,getHangTree:function(){null===this.hangTreeInstance&&(this.hangTreeInstance=new d.widgets.HangTree);return this.hangTreeInstance}})})(toa);(function(d,c,b){d.HeaderResponsive=d.define(null,function(c){this.orderOfRemoval={MAX:[],DESKTOP:[4,6],TAB:[3,1,4,6],PHONE:[5,3,1,4,6],MIN:[2,5,3,1,4,6]};this.popupIndex={ACTION:4};this.options=c;this.hint=c.hint;this.hint.Tip("option","onHide",this.closeTipHandler.bind(this));this.menuButton=c.menuButton;this.header=c.headerPanel;this.className=c.className;c.orderOfRemoval&&b.extend(this.orderOfRemoval,c.orderOfRemoval);c.popupIndex&&b.extend(this.popupIndex,c.popupIndex);this.isForecastingScreen()?
this.panelContainer=".forecasting-panel-contents":this.panelContainer=ORDER_OF_REMOVAL[this.className]?"":"tr.toa-view-control-layout-table-row";this.view={currentView:"MAX",previousView:"MAX"};this.bindListeners();this.makeResponsive()},{bindListeners:function(){b(c).on("resize",this.makeResponsive.bind(this));this.menuButton.on("click",this.openMenu.bind(this));this.applyIndex()},getScreenSize:function(){var b={};"object"===typeof _DATA&&_DATA.is_mobility_app&&(b={width:c.innerWidth||document.documentElement.clientWidth||
document.body.clientWidth,height:c.innerHeight||document.documentElement.clientHeight||document.body.clientHeight});return b},applyIndex:function(){for(var c=this.header.find(this.panelContainer).children().length?this.header.find(this.panelContainer).children():this.header.children(),d=0;d<c.length;d++)b(c[d]).attr("data-item-index",d),c[d].children.actionPanel&&c[d].classList.add("actionPanel")},isForecastingScreen:function(){return this.className===SCREEN_MAPPINGS.forecasting},hideBaselineSettingTooltip:function(){var c;
b(".routing-baseline-icon").hover(function(){c=b(this).attr("title");c.length&&this.innerText===c&&b(this).attr("title","")},function(){0!==c.length&&b(this).attr("title",c)})},makeResponsive:function(){var e=b(".toa-twopanel-horizontal").width()||this.getScreenSize().width;this.hideBaselineSettingTooltip();e&&(b("*[data-calendar-min-date]").changeDateFormat(),"undefined"===typeof this.previous_screen_width&&(this.previous_screen_width=0),this.previous_screen_width!==c.innerWidth&&(this.previous_screen_width=
c.innerWidth,this.closeAllMenu()),d.view.control.PanelTitle.prototype.manageActionPanel(e),e>RESPONSIVE_WIDTH.DESKTOP?this.copyElements("MAX"):e<=RESPONSIVE_WIDTH.DESKTOP&&e>=RESPONSIVE_WIDTH.TAB?this.copyElements("DESKTOP"):e<RESPONSIVE_WIDTH.TAB&&e>RESPONSIVE_WIDTH.PHONE?this.copyElements("TAB"):e<=RESPONSIVE_WIDTH.PHONE&&e>RESPONSIVE_WIDTH.MIN?this.copyElements("PHONE"):this.copyElements("MIN"))},copyElements:function(e){var g=this.menuButton.parent().get(0)===this.header.get(0)?this.menuButton:
this.menuButton.parent(),k=b(".toa-twopanel-horizontal").width();"MAX"===e||0===this.orderOfRemoval[e].length?g.addClass("hideOptionsMenu"):g.removeClass("hideOptionsMenu");if(this.view.currentView!==e){this.view.previousView=this.view.currentView;this.view.currentView=e;var l=this.hint.Tip("content").find(".headerMenuContent");l.children();var n=this.header.find(this.panelContainer).length?this.header.find(this.panelContainer):this.header,p=[],s=[],t=0;if(RESPONSIVE_WIDTH[this.view.previousView]>
RESPONSIVE_WIDTH[this.view.currentView])for(var p=this.orderOfRemoval[e].filter(function(b){if(-1===this.orderOfRemoval[this.view.previousView].indexOf(b))return!0}.bind(this)),u=p.length-1;0<=u;u--){var l=this.hint.Tip("content").find(".headerMenuContent"),v=p[u],w=b(n.find("*[data-item-index="+v+"]"));if(v===this.popupIndex.ACTION&&!this.isForecastingScreen()&&!c.isReportsScreen){v=w.find('div[name="actionPanel"]');this.popupIndex.ACTION_CLASS=v.attr("data-action-screen");var x=b("."+this.popupIndex.ACTION_CLASS),
y=b('<div class="actionsMenuContainer">').addClass("action-menu-actionPanel_"+this.className);0!==x.length&&(y.append(x.children().clone(!0)),d.HeaderResponsive.moveButtonMenu(x,y));w.append(y);0===v.children().length&&w.addClass("hideContent")}w.off("click",this.hidePopup.bind(this)).on("click",this.hidePopup.bind(this));l.prepend(w)}else for(this.orderOfRemoval[this.view.previousView].slice(0).sort().map(function(b){-1!==this.orderOfRemoval[e].indexOf(b)?t++:(p.push(b-t),s.push(b))}.bind(this)),
u=0;u<p.length;u++)s[u]!==this.popupIndex.ACTION||this.isForecastingScreen()||b(".action-menu-actionPanel_"+this.className).remove(),w=n.children()[p[u]]||n.children().last(),b(w).before(l.find("*[data-item-index="+s[u]+"]").removeClass("hideContent"));d.view.control.PanelTitle.prototype.manageActionPanel(k);d.HeaderResponsive.hideTip(g)}},openMenu:function(c){this.hint.Tip("isOpen")?this.closeTip():(this.closeAllMenu(),this.menuButton.addClass("menu-button-pressed"),this.hint.Tip("showAt",b(c.currentTarget)),
this.hint.focus())},hidePopup:function(c){var d=this.hint.Tip("getContainer").position().top;this.closeTip();if("object"===typeof c&&0!==b(c.target).closest(".ui-tip.headerResponsiveMenu").length){var k=b(c.target.closest("[data-item-index]")).attr("data-item-index");if(0===b(c.currentTarget).find('button[name="filterButton"]').length&&"filterButton"!==b(c.currentTarget).attr("name")||!b(c.currentTarget).parent().hasClass("headerMenuContent"))"object"===typeof this.options.popupIndex[k]&&(this.options.popupIndex[k].backButtonText&&
(l=this.getBackContainer(this.options.popupIndex[k].backButtonText),b(this.options.popupIndex[k].popupClass).prepend(l)),b(this.options.popupIndex[k].popupClass).addClass("headerResponsivePopup").off("click",".backButton").on("click",".backButton",function(){this.closeAllMenu();this.hint.Tip("showAt",this.menuButton)}.bind(this)),RESPONSIVE_WIDTH.MIN<this.getScreenSize().width&&0<d&&b(this.options.popupIndex[k].popupClass)[0].style.setProperty("top",d-b(".header-wrapper").height()+"px","important"));
else{var l=this.getBackContainer(h(13280));c=b(c.currentTarget).find("button:first").attr("data-filter-screen")||b(c.currentTarget).attr("data-filter-screen");b("."+c).prepend(l).addClass("headerResponsivePopup");b("."+c).off().on("click",".backButton",function(){this.closeAllMenu();this.hint.Tip("showAt",this.menuButton)}.bind(this));l=b("."+c+" .ui-tip-content");if(RESPONSIVE_WIDTH.MIN<this.getScreenSize().width&&0<d)for(l.css("max-height",parseFloat(this.getScreenSize().height)-parseFloat(b(".headerResponsiveBackContainer").css("height"))-
d-30+"px"),c=0;c<l.parent().length;c++)l.parent()[c].style.setProperty("top",d+"px","important"),l.parent()[c].style.setProperty("max-height",parseFloat(this.getScreenSize().height)-d-30+"px","important")}}},getBackContainer:function(b){return(new d.Template('<div class="headerResponsiveBackContainer"><button class="backButton" aria-label="<%=buttonText%>" title="<%=buttonText%>"></button><span class="title" aria-label="<%=title%>"><%=title%></span></div>')).apply({buttonText:h(16257),title:b||""})},
closeTipHandler:function(){this.menuButton.removeClass("menu-button-pressed")},closeTip:function(){this.hint.Tip("hide");b(".headerResponsiveBackContainer").remove();b(".headerResponsivePopup").removeClass("headerResponsivePopup")},closeFilterPopUp:function(){if(this.isForecastingScreen()){var b=document.querySelector("#filterMenu.headerResponsivePopup"),c=document.querySelector("#dateMenu.headerResponsivePopup");(b=b?b:c)&&b.isOpen()&&b.close()}},closeAllMenu:function(){this.closeFilterPopUp();this.closeTip();
var c=b("#dateMenu");c.length&&c.ojPopup("close","#dateFilter");b(_DATA.dispatcher_container).mousedown().mouseup()}},{moveButtonMenu:function(b,c){0<b.last().find("button").length&&(c.children().last().detach().insertBefore(c.children().first()),c.children().last().detach().insertBefore(c.children().first()))},copyActionPanel:function(c){var g=b("."+c);0!==g.length?(b(".action-menu-"+c).html(g.children().clone(!0)),d.HeaderResponsive.moveButtonMenu(g,b(".action-menu-"+c)),b('div[data-action-screen="'+
c+'"]').parent().removeClass("hideContent")):(b(".action-menu-"+c).html(""),c=b('div[data-action-screen="'+c+'"]'),0<c.length&&!c[0].hasChildNodes()&&c.parent().addClass("hideContent"));d.HeaderResponsive.hideTip()},hideTip:function(c){for(var d=b(".ui-tip.headerResponsiveMenu>.ui-tip-content"),k=0;k<d.length;k++){var l=b(d[k]),n=l.attr("data-menu-container"),l=l.parent(),p=l.css("display");l.show();0===d[k].offsetHeight?(b("."+n).attr("disabled",!0),"object"===typeof c&&c.find("."+n).attr("disabled",
!0)):(b("."+n).attr("disabled",!1),"object"===typeof c&&c.find("."+n).attr("disabled",!1));l.css("display",p)}}})})(toa,window,jQuery);toa.ns("toa.classes.fileUploader.FileService",function(){var d=toa.define(null,function(c){$.extend(this.options,c||{})},{file:null,uploadId:null,attemptsCount:0,isUploading:!1,currentOffset:0,totalChunkCount:0,options:{prepareUrl:null,uploadUrl:null,finishUrl:null,abortUrl:null,acceptedTypes:[],minSize:0,maxSize:0,sliceSize:1048576},validationErrors:[],errorMappings:[],errorMessages:[],setUploadId:function(c){this.uploadId=c;return this},setFile:function(c){this.file=c;this.totalChunkCount=Math.ceil(this.file.size/
this.options.sliceSize);return this},getFileName:function(){return this.file?this.file.name:""},getFileSize:function(){return this.file?this.file.size:0},isUploading:function(){return this.isUploading},validate:function(){this.validationErrors=[];this.errorMessages=[];return this.validateEmpty()&&this.validateFormat()&&this.validateSize()},validateFormat:function(){if(this.options.acceptedTypes&&-1!==this.options.acceptedTypes.indexOf(this.file.type))return!0;var c=this.getErrorMsgTemplate(toa.classes.fileUploader.FileService.ERROR_CODE_TYPE);
this.validationErrors.push(toa.classes.fileUploader.FileService.ERROR_CODE_TYPE);this.errorMessages.push(c);return!1},validateSize:function(){if(this.file.size<=this.options.maxSize&&this.file.size>=this.options.minSize)return!0;var c=this.getErrorMsgTemplate(toa.classes.fileUploader.FileService.ERROR_CODE_SIZE);this.validationErrors.push(toa.classes.fileUploader.FileService.ERROR_CODE_SIZE);this.errorMessages.push(c.replace("{MAX}",Math.ceil(this.options.maxSize/1024/1024)).replace("{MIN}",Math.ceil(this.options.minSize/
1024/1024)));return!1},validateEmpty:function(){if(this.file)return!0;var c=this.getErrorMsgTemplate(toa.classes.fileUploader.FileService.ERROR_CODE_EMPTY);this.validationErrors.push(toa.classes.fileUploader.FileService.ERROR_CODE_EMPTY);this.errorMessages.push(c);return!1},getErrorMessages:function(){return this.errorMessages},setErrorMappings:function(c){this.errorMappings=c},getErrorMsgTemplate:function(c){return this.errorMappings[c]||""+c},start:function(c){this.file&&this.startUpload(this.options.sliceSize,
c)},resume:function(){this.resumeUpload(this.options.sliceSize)},_getReader:function(){return new FileReader},_request:function(c){c.url&&$.ajax({type:c.method||"POST",url:c.url+"&output=ajax&"+GetSessId(),cache:!1,data:c.data||null,dataType:"json",headers:c.headers||{},processData:!1,contentType:c.contentType||!1,success:c.responseHandler||function(){},error:c.errorHandler||function(){}});return this},startUpload:function(c,b){this.uploadId?(this.isUploading=!0,this.uploadFileSlice(0,this.file.size>=
c?c:this.file.size)):this._request({url:this.options.prepareUrl,data:JSON.stringify(b),responseHandler:function(b){this.uploadId=b.uploadId;this.isUploading=!0;this.uploadFileSlice(0,this.file.size>=c?c:this.file.size)}.bind(this),errorHandler:function(b){this.notify(toa.classes.fileUploader.FileService.EVENT.ERROR,b)}.bind(this)})},resumeUpload:function(c){this.isUploading=!0;this.notify(toa.classes.fileUploader.FileService.EVENT.RESUME);this.uploadFileSlice(this.currentOffset,c)},uploadFileSlice:function(c,
b){if(!window.FileReader||!window.Blob)return null;var e=this.getSlice(c,c+b),d=this._getReader();d.onloadend=function(e){this.currentOffset=c;this.isUploading&&e.target.readyState===FileReader.DONE&&(e=Array.prototype.map.call(e.target.result,function(b){return b.charCodeAt(0)&255}),e=new Uint8Array(e),this._request({headers:{"Portion-Size":b,"Portion-Chunk-Offset":Math.floor(c/this.options.sliceSize)+1,"Total-Chunk-Count":this.totalChunkCount,"Upload-Id":this.uploadId},contentType:"application/x-binary; charset=x-user-defined",
url:this.options.uploadUrl,data:e.buffer,responseHandler:this.successSliceUploadHandler.bind(this,c+b,b),errorHandler:this.errorSliceUploadHandler.bind(this,c,b)}))}.bind(this);d.readAsBinaryString(e)},getSlice:function(c,b){var e=this.file.slice?"slice":this.file.webkitSlice?"webkitSlice":this.file.mozSlice?"mozSlice":null;return e?this.file[e].apply(this.file,arguments):null},successSliceUploadHandler:function(c,b,e){this.notify(toa.classes.fileUploader.FileService.EVENT.SUCCESS,c,b,this.file.size,
e);0<this.attemptsCount&&(this.attemptsCount=0);this.file.size>c?(b=c+b>this.file.size?this.file.size-c:b,this.uploadFileSlice(c,b)):this.finishUpload()},errorSliceUploadHandler:function(c,b,e){var d=e.responseJSON&&e.status?e.responseJSON.error:h(227166);this.notify(toa.classes.fileUploader.FileService.EVENT.ERROR,d);this.attemptsCount++;2>this.attemptsCount?setTimeout(function(){b=c+b>this.file.size?this.file.size-c:b;this.uploadFileSlice(c,b)}.bind(this),1E4):(this.isUploading=!1,this.notify(toa.classes.fileUploader.FileService.EVENT.ABORT,
d),e.status&&this._request({headers:{"Upload-Id":this.uploadId},url:this.options.abortUrl}))},finishUpload:function(){this.isUploading=!1;this.options.finishUrl&&this._request({headers:{"Upload-Id":this.uploadId},url:this.options.finishUrl,responseHandler:function(c){this.notify(toa.classes.fileUploader.FileService.EVENT.FINISH,c)}.bind(this),errorHandler:function(c){this.notify(toa.classes.fileUploader.FileService.EVENT.ERROR,c)}.bind(this)})}},{ERROR_CODE_EMPTY:1,ERROR_CODE_TYPE:2,ERROR_CODE_SIZE:3,
EVENT:{SUCCESS:"upload.success",ERROR:"upload.error",ABORT:"upload.abort",FINISH:"upload.finish",PAUSE:"upload.pause",RESUME:"upload.resume"}});toa.mixin(d.prototype,toa.mixins.EventEmitter);return d}());toa.ns("toa.controllers.MoveReasons",function(d,c){var b,e,g=d.Controller;return d.define(g,function(b,c,e){g.call(this,c,e)},{allowModify:!1,reasonCollection:{},collectionView:null,defaultLanguage:1,_create:function(c,d){b=b||require("knockout");e=e||require("jbf/core/modules/adaptive-popup/adaptive-popup");this.allowModify=c;this.i18n=d.i18n||{};this.languages=d.languages;this.conditions=d.conditions||{};this.initModels();this.initCollectionView(c,d.reasonItems,d.shortConditionNames||{});this.collectionView.render()},
initModels:function(){this.reasonCollection=new d.models.moveReasons.Collection;this.reasonCollection.addListener("add",this.createNew,this);return this},initCollectionView:function(b,e,g){var p=$app.model().user().get("ulanguage")||this.defaultLanguage;this.collectionView=new d.views.moveReasons.ListView({collection:this.reasonCollection,controller:this,allowModify:b,languageId:p,reasonItems:e,conditions:g});c.each(e,function(b,c){this.reasonCollection.add(c,{silent:!0})}.bind(this));this.collectionView.addListener("addMoveReason",
this.addMoveReason,this);this.collectionView.addListener("edit",this.edit,this);return this},edit:function(b,c){if(this.allowModify){var e=this.reasonCollection.get(c);e&&this.showPopup(e,function(){this.collectionView.modelViews[c].$el.find(".move-reason-edit").focus()})}},createNew:function(b,c){this.collectionView.render(c.getId())},addMoveReason:function(){this.allowModify&&this.showPopup(void 0,function(){c(".move-reasons-table, .no-move-reason-hint").filter(function(b,e){return"hidden"!==c(e).css("display")}).find(".move-reason-create").focus()})},
showPopup:function(c,d){var g={status:"active",conditions:31},p=c?this.i18n.edit_title:this.i18n.add_title,g=c?Object.assign({uid:c.getId()},c.attributes):g,s=new e('<visuals:popup-header class="adaptive-popup-header" params="title: title, close: onDismiss"></visuals:popup-header><visuals:move-reasons params="entity: entity,placeholders: placeholders,conditions: conditions,languages: languages,submit: onSubmit,dismiss: onDismiss"></visuals:move-reasons>',{title:p,entity:g,placeholders:this.i18n,conditions:this.conditions,
languages:this.languages,onSubmit:function(b,c){c?(this.reasonCollection.update(c,b),this.collectionView.render()):this.reasonCollection.add(b);this.submitPopup(s);d.apply(this)}.bind(this),onDismiss:function(){s.dispose();d.apply(this)}.bind(this)},this,b.observable("adaptive-popup-general-wrapper--extra-wide adaptive-popup-general-wrapper--fullscreen"));s.show()},submitPopup:function(b){b.dispose()}})}(toa,$));toa.ns("toa.controllers.MapLayers",function(d,c){var b=d.Controller,e,g;return d.define(b,function(c,d,n,p,s){this.langLabels=p||{};this.allowModify=d;this.layersData=n;this.initModels();this.initViews(d,n);this.loadData(n.allLayers,n.uploadedLayers,n.population_failed);this.collectionView.render();b.apply(this,arguments);s&&s.map_layer&&this.openMapLayerToEdit(s.map_layer);g=g||require("knockout");e=e||require("jbf/core/modules/adaptive-popup/adaptive-popup");this.syncLayers()},{mapLayerCollection:{},
uploadedMapLayerCollection:{},collectionView:null,addFormView:null,editFormView:null,langLabels:{},allowModify:!1,layersData:{},showFirstError:!0,initModels:function(){this.mapLayerCollection=new d.models.mapLayers.Collection;this.mapLayerCollection.addListener("add",this.createNew,this);this.uploadedMapLayerCollection=new d.models.mapLayers.Collection;return this},initViews:function(b,c){this.initCollectionView(b,c);this.addFormView=new d.views.mapLayers.AddFormView({controller:this,allowModify:b,
uLang:c.uLang,userTypes:c.user_types,langLabels:this.langLabels,languages:c.languages,uploadedLayers:this.uploadedMapLayerCollection});this.addFormView.addListener("data_loaded",function(){this.addFormView.fullUploadedLayersCollection=this.uploadedMapLayerCollection.clone()},this);return this},openMapLayerToEdit:function(b){if(!b)return!1;c.each(this.layersData.allLayers,function(c,e){if(e.layer_id==b)return this.edit("edit",b),!1}.bind(this))},initCollectionView:function(b,c){this.collectionView=
new d.views.mapLayers.ListView({collection:this.mapLayerCollection,controller:this,allowModify:b,uLang:c.uLang,userTypes:c.user_types});this.collectionView.addListener("add_new",this.add,this);this.collectionView.addListener("edit",this.edit,this);this.collectionView.addListener("remove",this.remove,this);this.collectionView.addListener("permissions",this.editPermissions,this);return this},initEditFormView:function(b){var c=b.isMapLayer()?d.views.mapLayers.MapLayerEditFormView:d.views.mapLayers.WorkZoneEditFormView;
this.editFormView&&this.editFormView.destroy();this.editFormView=new c({controller:this,allowModify:this.allowModify,uLang:this.layersData.uLang,userTypes:this.layersData.user_types,langLabels:this.langLabels,languages:this.layersData.languages,formsAndPlugins:this.layersData.formsAndPlugins,uploadedLayers:this.uploadedMapLayerCollection});this.editFormView.addListener("popup.close",function(b){this.editFormView&&this.editFormView.destroy();this.editFormView=null}.bind(this));return this.editFormView.render(b)},
loadData:function(b,e,d){c.each(b,function(b,c){this.mapLayerCollection.add(c,{silent:!0})}.bind(this));c.each(e,function(b,c){this.uploadedMapLayerCollection.add(c,{silent:!0})}.bind(this));this.mapLayerCollection.layersWithInitialPopulationFailed=d;this.addFormView.notify("data_loaded");return this},createNew:function(b,c){this.collectionView.render(c.getId())},add:function(){var b=function(){c(".cm_layers_create:visible").focus()};this.addFormView.destroy();var d=new e('<visuals:popup-header class="adaptive-popup-header" params="title: title, close: onDismiss"></visuals:popup-header><visuals:map-layers params="title: title, form: form,submit: onSubmit,dismiss: onDismiss"></visuals:move-activities>',
{title:h(16925),form:this.addFormView.render(),onSubmit:function(){this.submitPopup(d,"add")&&b.apply(this)}.bind(this),onDismiss:function(){this.destroyPopup(d);b.apply(this)}.bind(this)},this,g.observable("adaptive-popup-general-wrapper--extra-wide adaptive-popup-general-wrapper--fullscreen"));d.show()},submitPopup:function(b,c){if(!this.allowModify)return this.destroyPopup(b);var e="add"===c?this.addFormView:this.editFormView;e.clearErrors();var g=e.getFormData();if(e.validate(g,c,this.showFirstError)){g=
new d.models.mapLayers.Model(g);if(!this.mapLayerCollection.isLabelUnique(g)){e.showErrors([{field:"layer_label",message:h(16924).replace("%s",g.get("layer_label"))}]);return}("add"===c?this._processAddedLayer:this._processEditedLayer).apply(this,[g]);return this.destroyPopup(b)}e.clearFileServiceFromData(g&&g.layer_label||"");e.showErrors(e.getValidationErrors())},_isInternal:function(b){return"api"===b||"uploaded"===b||"local"===b},_processAddedLayer:function(b){var c=b.get("layer_type");this._isInternal(c)&&
b.set({layer_type:"internal"});b.get("layer_id")||b.set({layer_id:this.mapLayerCollection.getIdForNewItem()});"uploaded"===c&&b.setAction("merge");this.mapLayerCollection.add(b)},edit:function(b,c){var d=this.mapLayerCollection.get(c),p=function(){this.collectionView.modelViews[c].$el.find(".layer-hint").focus()},s=new e('<visuals:popup-header class="adaptive-popup-header" params="title: title, close: onDismiss"></visuals:popup-header><visuals:map-layers params="title: title, notAllowModify: notAllowModify, form: form,submit: onSubmit,dismiss: onDismiss"></visuals:move-activities>',
{title:h(16926),notAllowModify:!1===this.allowModify,form:this.initEditFormView(d),onSubmit:function(){this.submitPopup(s,"edit")&&p.apply(this)}.bind(this),onDismiss:function(){this.destroyPopup(s);p.apply(this)}.bind(this)},this,g.observable("adaptive-popup-general-wrapper--extra-wide adaptive-popup-general-wrapper--fullscreen"));s.show();this.editFormView.previewLayer();this.editFormView.recalculateCellWidth()},_processEditedLayer:function(b){var c=b.get("layer_type"),e=b.get("layer_status"),g=
this.editFormView.model.getId();"api"!==c&&"uploaded"!==c||b.set({layer_type:"internal"});"uploaded"===c&&(b.set(this.uploadedMapLayerCollection.get(b.getId()).toJSON()),b.set({layer_id:g,layer_status:e}));this.editFormView.model.set(b.toJSON());b=this.collectionView.modelViews[g];b.render("uploaded"===c?"merge":"update");b.updateLayerProgressStatus(this.editFormView.model.get("progress_status",d.models.mapLayers.Model.PROGRESS_STATUS.IS_NOT_LOADED))},remove:function(b,c){(c.hasAction("merge")||c.hasAction("add"))&&
this.mapLayerCollection.remove(c);this.mapLayerCollection.hasAlive()||this.collectionView.toggleHint(!0)},editPermissions:function(b,e){var g=this.mapLayerCollection.get(e),p=g.get("user_types"),s=[];p&&(0===p.length||1===p.length&&p[0]===d.models.mapLayers.Model.ALL_USER_TYPE_ID?c.each(this.collectionView.userTypesLookup,function(b,c){s.push({_id:b,label:c})}.bind(this)):c.each(p,function(b,c){s.push({_id:c,label:this.collectionView.userTypesLookup[c]})}.bind(this)));var t=new d.widgets.MultiselectOptionDialog({title:h(16029),
width:400,height:500,editOptions:{sortable:!0,sortField:"csorder"},data:{all:this.collectionView.userTypesLookup,selected:s,label:this.collectionView.userTypesLookup},buttons:[{text:h(12252),type:"submit",position:"right",id:"multiselectSubmitBtn",click:function(b){if(!t.fieldsValidation())return!1;this.updateLayerUserTypes(t.getSelectedObject(),g);t.destroy();this.collectionView.modelViews[e].$el.find(".layer-hint").focus()}.bind(this)}]})},updateLayerUserTypes:function(b,e){var g=[];Object.keys(this.collectionView.userTypesLookup).length===
b.length||0===b.length?g=[d.models.mapLayers.Model.ALL_USER_TYPE_ID]:c.each(b,function(b,c){g.push(parseInt(c._id))});e.set({user_types:g});var p=this.collectionView.modelViews[e.getId()];p.render("update");p.updateLayerProgressStatus(e.get("progress_status",d.models.mapLayers.Model.PROGRESS_STATUS.IS_NOT_LOADED))},processLayerJobStatus:function(b,c){this.editFormView&&this.editFormView.processingLayerJobStatus(c)},destroyPopup:function(b){this.editFormView&&this.editFormView.notify("popup.close");
b&&b.dispose();return this},syncLayers:function(){request({url:"?controller=mapwriter&method=syncLayers",responseHandler:this.processSyncResponse.bind(this)})},processSyncResponse:function(b){b=b||{};b=b.updated||{};for(var c in b)if(b[c].layer_job_id&&b[c].layer_id){var e=this.mapLayerCollection.get(b[c].layer_id),d=this.collectionView.modelViews[e.getId()];e.set({layer_job_id:b[c].layer_job_id});d.render("update");d.startTrackingJobStatus()}}})}(toa,$));(function(d){var c=d.models.ObservableModel;d.ns("toa.models.moveReasons.Model",d.define(c,function(b){c.apply(this,arguments);this.id=this.getId()},{setAction:function(b){this.hasAction("")||(this._action=b)},hasAction:function(b){return b?this._action===b:!!this._action},getName:function(b){b=b||null;var c="",d=this.get("translations",{}),k;for(k in d)if(d.hasOwnProperty(k)&&d[k].id&&d[k].id===b){c=d[k].value;break}return c}}))})(toa);(function(d){var c=d.models.ObservableCollection;d.ns("toa.models.moveReasons.Collection",d.define(c,function(){c.apply(this,arguments);this.language={id:$app.model().user().get("ulanguage")||1,code:$app.model().user().getLanguage()||"en"}},{modelConstructor:d.models.moveReasons.Model,language:{},getLanguage:function(){return this.language},sort:function(b){b=b||{};var c=this.getLanguage();this.models.sort(function(b,d){if(b.get("status")!==d.get("status"))return"active"===b.get("status")?-1:"active"===
d.get("status")?1:0;var l=b.getName(c.id)||"",n=d.getName(c.id)||"";return l.localeCompare(n,c.code)});b.silent||this.notify("reset")},update:function(b,c,d){d=d||{};(b=this.get(b))&&b.set(c);!0!=d.doNotAutoSort&&this.sort({silent:!0});d.silent||this.notify("update",b,this.indexOf(b))}}))})(toa);(function(d,c){d.ns("toa.views.moveReasons.BaseView",d.define(null,function(b){this.options=b||{}},c.extend({},d.mixins.EventEmitter,{initEvents:function(){c.each(this.events,function(b,c){var d=this.$container||this.$el,k=b.split(" ");if(1!==k.length&&2!==k.length||!k[0].length)throw Error("Incorrect description of event selector ("+b+")");var l=c;"string"===typeof c&&(l=this[c]);if(!l||"function"!==typeof l)throw Error('Incorrect event handler for selector "'+b+'"');if(2===k.length)d.on(k[0],k[1],
l.bind(this));else d.on(k[0],l.bind(this))}.bind(this))}})))})(toa,$);(function(d,c){var b=d.views.moveReasons.BaseView;d.ns("toa.views.moveReasons.ListView",d.define(b,function(e){b.apply(this,arguments);this.$container=c(".move-reasons-table-container",_DATA.content);this.$el=c("table tbody",this.$container);this.collection=this.options.collection;this.modelViews=[];this.controller=e.controller;this.allowModify=e.allowModify;this.languageId=e.languageId||1;this.conditionsLookup=e.conditions||{};this.isEventsInit=!1},{events:{"click .move-reason-create":"addNewReason",
"keypress .move-reason-create":"addNewReason"},toggleHint:function(b){var d=c(".move-reasons-table",this.$container),k=c(".no-move-reason-hint",this.$container);b?(d.hide(),k.show()):(d.show(),k.hide())},render:function(b){this.$el.empty();this.collection.each(function(c){var d="read";b&&c.getId()===b&&(d=c.hasAction("merge")?"merge":"add");this.renderItem(c,d)}.bind(this));this.isEventsInit||(this.isEventsInit=!0,this.initEvents());this.toggleHint(0===this.collection.getCount());return this},renderItem:function(b,
c){var k=new d.views.moveReasons.ItemView({model:b,allowModify:this.allowModify,languageId:this.languageId,conditions:this.conditionsLookup}),l=k.render(c);k.addListener("edit",this.controller.edit,this.controller);this.$el.append(l);this.modelViews[b.getId()]=k},addNewReason:function(b){if("keypress"!==b.type||13===b.keyCode)b.preventDefault(),this.notify("addMoveReason")}}))})(toa,$);(function(d,c){var b=d.views.moveReasons.BaseView;d.ns("toa.views.moveReasons.ItemView",d.define(b,function(e){b.apply(this,arguments);this.$el=c('<tr class="move-reason-data" align="center"></tr>');this.model=this.options.model;this.allowModify=e.allowModify;this.languageId=e.languageId||1;this.conditionsLookup=e.conditions||{};this.allowDelete=!0},{events:{"click .move-reason-edit":"edit","keypress .move-reason-edit":"edit"},getItemTemplate:function(){return['<th align="left" scope="row" class="font-normal <%= itemStatus %>"><div class="move-reason-info"><span><%- moveReasonName %></span><%= hiddenFields %></div><div class="notice"><span class="move-reason-status"><%= status %></span></div></th><td class="move-reason-user-types notice" align="left"><%= conditionsLabels %></td>',
'<td><div role="button" aria-dropeffect="popup" class="multiselect-tip-button move-reason-edit" tabindex="0"><div class="ui-button-icon-only"><span class="ui-icon ui-button-icon-primary ui-icon-modify oj-ux-ico-edit" title="'+h(16927)+'"></span><span class="ui-button-text">'+h(16927)+"</span></div></div></td>"].join("")},getHiddenFieldsTemplate:function(){return'<% if (move_reason_id) { %><input type="hidden" name="move_reasons[<%- uid %>][move_reason_id]" value="<%- move_reason_id %>" /><% } %><input type="hidden" name="move_reasons[<%- uid %>][conditions]" value="<%- conditions %>" /><input type="hidden" name="move_reasons[<%- uid %>][status]" value="<%- status %>" /><% for(var i = 0; i < translations.length; i++) { %><input type="hidden" name="move_reasons[<%- uid %>][translations][<%- translations[i]["id"] %>]" value="<%- translations[i]["value"] %>" /><% } %>'},
render:function(b){this.$el.html(c(this.getHtml(b)));this.initEvents();return this.$el},getHtml:function(b){return(new d.Template(this.getItemTemplate())).apply({languageId:this.languageId,conditionsLabels:this.renderConditionsLabels(this.model),status:this.renderStatus(this.model),moveReasonName:this.model.getName(this.languageId),hiddenFields:this.renderHiddenFields(this.model),itemStatus:"inactive"===this.model.get("status","")?"inactive":""})},renderStatus:function(b){return"inactive"===b.get("status",
"")?h("move_reason_status_inactive"):""},renderConditionsLabels:function(b){b=b.get("conditions",0);var c="";if(0!==b&&31!==(b&31)){var c=[],d;for(d in this.conditionsLookup)this.conditionsLookup.hasOwnProperty(d)&&b&d&&c.push(this.conditionsLookup[d]);c=c.join(", ")}return c?c:'<span class="condition-label-not-set"></span>'},renderHiddenFields:function(b){return(new d.Template(this.getHiddenFieldsTemplate())).apply({uid:b.getId(),move_reason_id:b.get("move_reason_id"),conditions:b.get("conditions"),
status:b.get("status"),translations:c.map(b.get("translations"),function(b){return{id:b.id,value:b.value||""}})})},edit:function(){this.notify("edit",this.model.getId())}}))})(toa,$);(function(d){var c=d.models.ObservableModel;d.ns("toa.models.mapLayers.Model",d.define(c,function(b){b=$.extend({user_types:b.selected_user_type_ids&&b.selected_user_type_ids.length?b.selected_user_type_ids:[d.models.mapLayers.Model.ALL_USER_TYPE_ID],layer_assignment:"layer"},b);b.layer_id=parseInt(b.layer_id);b.layer_srid=0<b.layer_srid?b.layer_srid:"";delete b.selected_user_type_ids;c.apply(this,[b])},{idField:"layer_id",setAction:function(b){this.hasAction()||(this._action=b)},hasAction:function(b){return b?
this._action===b:!!this._action},getInfo:function(){var b=this.toJSON(),c=[],d=this.getId();c.push({name_suffix:"["+[d,"action"].join("][")+"]",value:this._action,className:!1});if("delete"===this._action){var b=["layer_id","progress_status"],k;for(k in b)b.hasOwnProperty(k)&&c.push({name_suffix:"["+[d,b[k]].join("][")+"]",value:this.get(b[k]),className:!0});return c}for(var l in b)if(b.hasOwnProperty(l)&&"translations"!==l)if(k=b[l],k instanceof Object)for(var n in k){var p=k[n];if(p instanceof Object)for(var s in p){var t=
p[s];c.push({name_suffix:"["+[d,l,n,s].join("][")+"]",value:t,className:!1})}else c.push({name_suffix:"["+[d,l,n].join("][")+"]",value:p,className:!1})}else c.push({name_suffix:"["+[d,l].join("][")+"]",value:k,className:!0});for(var u in b.translations)b.translations.hasOwnProperty(u)&&(l=b.translations[u],c.push({name_suffix:"["+[d,"translations",l.id].join("][")+"]",value:l.value,className:!1}));return c},getStatusesOfUnusedLayer:function(){return[d.models.mapLayers.Model.PROGRESS_STATUS.PENDING,
d.models.mapLayers.Model.PROGRESS_STATUS.CONVERTING,d.models.mapLayers.Model.PROGRESS_STATUS.MIGRATING,d.models.mapLayers.Model.PROGRESS_STATUS.RECTIFYING,d.models.mapLayers.Model.PROGRESS_STATUS.FAILED,d.models.mapLayers.Model.PROGRESS_STATUS.IS_NOT_LOADED,d.models.mapLayers.Model.PROGRESS_STATUS.NOT_AVAILABLE,d.models.mapLayers.Model.PROGRESS_STATUS.FILE_WAIT,d.models.mapLayers.Model.PROGRESS_STATUS.FILE_UPLOADING,d.models.mapLayers.Model.PROGRESS_STATUS.FILE_UPLOADING_FAILED]},isMapLayer:function(){return"layer"===
this.get("layer_assignment")},isPopulationJobFailed:function(b){return b===d.models.mapLayers.Model.PROGRESS_STATUS.FAILED||b===d.models.mapLayers.Model.PROGRESS_STATUS.NOT_AVAILABLE},isLocal:function(){var b=this.get("layer_source_url");return-1!==String(b||"").indexOf("local://")}},{ALL_USER_TYPE_ID:-1,DEFAULT_WZ_LABEL:"wz_layer",PROGRESS_STATUS:{PENDING:"pending",CONVERTING:"converting",MIGRATING:"migrating",RECTIFYING:"rectifying",SUCCEEDED:"succeeded",FAILED:"failed",IS_NOT_LOADED:"is_not_loaded",
NOT_AVAILABLE:"not_available",EXTERNAL:"external",PROCESSING:"processing",FILE_WAIT:"file_wait",FILE_UPLOADING:"file_uploading",FILE_UPLOADING_FAILED:"file_uploading_failed"}}))})(toa);(function(d){var c=d.models.ObservableCollection;d.ns("toa.models.mapLayers.Collection",d.define(c,function(){c.apply(this,arguments)},{modelConstructor:d.models.mapLayers.Model,layersWithInitialPopulationFailed:[],comparator:function(b,c){return"work_zone"===b.get("layer_assignment")?-1:"work_zone"===c.get("layer_assignment")?1:0},getIdForNewItem:function(){var b=this.pluck("layer_id").sort(function(b,c){return b-c});return 0<b.length?b.pop()+1:1},hasAlive:function(){for(var b=this.getCount(),c=
0;c<b;c++)if(!this.models[c].hasAction("delete"))return!0;return!1},hasWorkZoneLayer:function(){return-1!==$.inArray("work_zone",this.pluck("layer_assignment"))},filterByField:function(b,c){var d=[];this.each(function(k){k.get(b)===c&&d.push(k.toJSON())});return d},isLabelUnique:function(b){var c=this.pluck("layer_label"),d=b.get("layer_label");isNaN(b.getId())||delete c[c.indexOf(d)];return-1===$.inArray(d,c)}}))})(toa);(function(){toa.ns("toa.views.mapLayers.FormValidator",{validationErrors:[],rules:{general:{layer_label:{layer:[{rule:"mandatory"},{rule:"maxLength",data:24},{rule:"regexp",data:"^[A-z0-9_]+$"}],work_zone:[]},layer_status:{all:[{rule:"mandatory"}]},layer_assignment:{all:[{rule:"mandatory"}]}},populateLayerTypes:{api:{},internal:{layer_source_url:{all:[{rule:"mandatory"},{rule:"maxLength",data:1024},{rule:"regexp",data:'(^local:\\/\\/[^"]+$)|(^https:\\/\\/[^ "]+$)'}]},username:{all:[{rule:"maxLength",
data:1024}]},password:{all:[{rule:"maxLength",data:1024}]},layer_srid:{all:[{rule:"mandatory"},{rule:"maxLength",data:1024}]}},external:{layer_url:{all:[{rule:"mandatory"},{rule:"maxLength",data:1024},{rule:"regexp",data:'^(https)://[^ "]+$'}]},layer_source_name:{all:[{rule:"mandatory"},{rule:"maxLength",data:1024}]},layer_theme:{all:[{rule:"mandatory"},{rule:"maxLength",data:1024}]}},local:{layer_file:{all:[{rule:"custom",data:{validator:"fileService"}}]},layer_srid:{all:[{rule:"mandatory"},{rule:"maxLength",
data:1024}]}}}},editModeRules:{general:{layer_shape_identifier:{work_zone:[{rule:"mandatory",data:["progress_status",toa.models.mapLayers.Model.PROGRESS_STATUS.SUCCEEDED]}],layer:[]}},populateLayerTypes:{internal:{layer_shape_hints:{layer:[{rule:"shapeHints"}]}}}},getFieldLabel:function(d){return{layer_label:h(16919),layer_status:h(16921),layer_assignment:"",layer_source_url:h(21607),username:h(21608),password:h(21609),layer_srid:h(21610),layer_url:h(16909),layer_source_name:h(16907),layer_theme:h(16908),
layer_shape_identifier:h(15935),layer_shape_hints:h(21630)}[d]||""},getValidationErrors:function(){return this.validationErrors},validate:function(d,c,b){this.validationErrors=[];var e=this.validateTranslations(d.translations),e=this.validateFields(d,this.getRules(this.rules,d),b)&&e;"edit"===c&&(e=this.validateFields(d,this.getRules(this.editModeRules,d),b)&&e);return e},validateTranslations:function(d){var c=!0;$.each(d,function(b,e){var d;e.mandatory&&!e.value?d=h(5406).replace("%s",h(68)):255<
e.value.length&&(d=h(16917).replace("%s",e.name).replace("%s",255));d&&(this.validationErrors.push({field:"lang-"+e.id,message:d}),c=!1)}.bind(this));return c},validateFields:function(d,c,b){var e=!0,g;for(g in c)if(c.hasOwnProperty(g))for(var k in c[g])if(c[g].hasOwnProperty(k)){var l=this["validate_"+c[g][k].rule](d,g,c[g][k].data),n=!0;l&&(this.validationErrors.push({field:g,message:l}),n=!1);e=n&&e;if(l&&b)break}return e},getRules:function(d,c){var b=this._processRulesSection(c.layer_assignment,
d.general),e=this._processRulesSection(c.layer_assignment,d.populateLayerTypes[c.layer_type]);return $.extend({},b,e)},_processRulesSection:function(d,c){var b=[],e;for(e in c)c.hasOwnProperty(e)&&(b[e]=c[e][d]||c[e].all);return b},validate_mandatory:function(d,c,b){return b&&d[b[0]]!==b[1]?"":d[c]?"":h(5406).replace("%s",this.getFieldLabel(c))},validate_maxLength:function(d,c,b){return d[c]&&d[c].length>b?h(16917).replace("{FIELD}",this.getFieldLabel(c).toLowerCase()).replace("{LENGTH}",b):""},validate_regexp:function(d,
c,b){var e=h("layer_url_validation_msg");"layer_label"==c&&(e=h(17104));return RegExp(b).test(d[c])?"":e},validate_shapeHints:function(d,c){var b=[];$.each(d[c],function(c,d){d.visible&&!d.defaultName&&b.push({field:d.sourceColumn,error:h(225613)})}.bind(this));return 0<b.length?b:""},validate_custom:function(d,c,b){d=b.validator;c=[];this[d].setErrorMappings(this.getMessagesForValidator(d));this[d].validate()||(c=this[d].getErrorMessages());return c.join(";")},getMessagesForValidator:function(d){return{fileService:{1:h(227159),
2:h(227160),3:h(227161)}}[d]||{}}})})();(function(d,c){d.ns("toa.views.mapLayers.BaseView",d.define(null,function(b){this.options=b||{}},c.extend({},d.mixins.EventEmitter,{initEvents:function(){c.each(this.events,function(b,c){var d=this.$container||this.$el,k=b.split(" ");if(1!==k.length&&2!==k.length||!k[0].length)throw Error("Incorrect description of event selector ("+b+")");var l=c;"string"===typeof c&&(l=this[c]);if(!l||"function"!==typeof l)throw Error('Incorrect event handler for selector "'+b+'"');if(2===k.length)d.on(k[0],k[1],
l.bind(this));else d.on(k[0],l.bind(this))}.bind(this))},getLayerJobStatus:function(b){return{pending:h(21617),converting:h(21618),migrating:h(21619),rectifying:h(21620),succeeded:h(21621),failed:h(21622),is_not_loaded:h(21623),not_available:h(21624),external:h(21625),processing:h(21626)}[b]||""}})))})(toa,$);(function(d,c){var b=d.views.mapLayers.BaseView;d.ns("toa.views.mapLayers.BaseFormView",d.define(b,function(e){b.apply(this,arguments);this.$el=c('<div class="row layer-popup-content">');this.controller=e.controller;this.allowModify=e.allowModify;this.uLang=e.uLang||"English";this.userTypesLookup=e.userTypes||{};this.langLabels=e.langLabels;this.uploadedLayers=e.uploadedLayers.clone();this.formsAndPlugins=e.formsAndPlugins||{};_DATA.layer_file_upload=_DATA.layer_file_upload||{};this.fileService=new d.classes.fileUploader.FileService({acceptedTypes:["application/zip",
"application/octet-stream","application/zip-compressed","application/x-zip-compressed","multipart/x-zip"],maxSize:157286400,prepareUrl:"",uploadUrl:d.Ajax.prototype.route("mapwriter","shapeFileUpload"),finishUrl:d.Ajax.prototype.route("mapwriter","finishShapeFileUpload"),abortUrl:d.Ajax.prototype.route("mapwriter","abortShapeFileUpload"),sliceSize:524288});this.setLanguages(e.languages);this.setPopulateLayerTypesDefaultDescription()},c.extend({},d.views.mapLayers.FormValidator,{events:{"change .populate-layer-type-select":"populateLayerTypeOnChange",
"keyup .file-button":"onFileButton"},_multilanguageNameElementTemplate:'<div class="translations-wrapper"><% for (var index in translations) { %><% var translation = translations[index]; %><% var langAttr = langLabels[translation.id]; %><div class="form-row-title-and-content"><div class="form-row-title"><label class="form-row-label" for="cm_lang_<%- translation.id %>"><%- translation.name %><% if (translation.mandatory) { %>*<% } %></label></div><div class="form-row-content"><input type="text" lang="<%- langAttr %>" name="lang-<%- translation.id %>" id="cm_lang_<%- translation.id %>" class="<% if (translation.mandatory) { %>mandatory<% } %> form-item" <% if (translation.mandatory) { %> required <% } %> value="<%- translation.value %>" <%= mode %> /></div><div class="clearfix"></div></div><% } %></div>',
_labelElementTemplate:'<div class="form-row-title-and-content"><div class="form-row-title"><label for="cm_layer_label"><%- label %>*</label></div><div class="form-row-content"><input required type="text" name="layer_label" id="cm_layer_label" value="<%- value %>" <%- mode %> /></div><div class="clearfix"></div></div>',_statusElementTemplate:'<div class="layer-status-wrapper"><div class="form-row-title-and-content"><div class="form-row-title"><label for="cm-layer-status"><%- label %></label></div><div class="form-row-content"><% for (var option in options) { %><label class="cm-layer-status-label <%- mode %>"><%- options[option] %><input type="radio" name="layer_status" value="<%- option %>" <% if (option === value ) { %>checked="checked"<% } %> <%- mode %>/><span class="checkmark <%- mode %>"></span></label><% } %></div><div class="clearfix"></div></div></div>',
_selectLayerTypeElementTemplate:'<% if (showLabel) { %><div><label for="cm_layer_type"><%- label %></label></div><% } %><p><div class="select-wrapper_dropdown"><select class="populate-layer-type-select form-item" name="layer_type" id="cm_layer_type"  <%- mode %>><% for (var option in options) { %><% if (!options[option].display) { continue; } %><option value="<%- option %>" <% if (options[option].active) { %>selected="selected"<% } %>><%- options[option].title %></option><% } %></select></div></p>',
_populateLayerFormTemplate:'<table role="none" id="<%- type %>" class="populate-layer-type active"><tr class="fb fb-editlist-row item-row"><td colspan="2"><% if (type === "uploaded") { %><%= uploadedLayers %><% }else{ %><span class="notice"><%- description.desc %></span><% } %></td></tr><% for (input in description.inputs) { %><% if (description.inputs[input].assignment && description.inputs[input].assignment !== assignment) { continue; } %><tr class="fb fb-editlist-row item-row"><td><div class="form-row-title-and-content"><div class="form-row-title"><label class="form-row-label" for="cm_layer_type_<%- input %>"><%- description.inputs[input].label %><% if (description.inputs[input].mandatory) { %>*<% } %></label></div><div class="form-row-content"><% var value = layer[input] || ""; %><% var inputType = description.inputs[input].type || "text"; %><% if (inputType === "file") { %> <% var ariaLabelledBy = description.inputs[input].ariaLabelledBy || ""; %><div class="toa-uploadFile"><input <% if (description.inputs[input].mandatory) { %> required <% } %>  class="file" tabindex="-1" type="file" readonly name="<%-input%>" <%- mode %> aria-label="<%-h(227165)%>" id="cm_layer_type_<%-input%>" <% if (ariaLabelledBy) { %> aria-labelledby="<%-ariaLabelledBy%>" <% } %>  /><label class="toa-button file-button" for="cm_layer_type_<%-input%>" role="button" aria-controls="cm_layer_type_<%-input%>" aria-label="<%-h(227165)%>"data-file-id="cm_layer_type_<%-input%>" tabindex="0"><%-h(227165)%></label><span class="cm_layer_file_name"></span></div><% }else{ %><input type="<%- inputType %>" name="<%- input %>" id="cm_layer_type_<%- input %>" class="<% if (description.inputs[input].mandatory) { %>mandatory<% } %> form-item" <% if (description.inputs[input].mandatory) { %> required <% } %> value="<%- value  %>" <%- mode %> /><% } %></div><div class="clearfix"></div></div></td></tr><% if (description.inputs[input].notice) {  %> <tr class="fb fb-editlist-row"><td colspan="2"><span class="notice"><%- description.inputs[input].notice %></span></td></tr><% } %><% } %></table>',
_uploadedLayersTemplate:'<table class="custom-map-layers-uploaded-shapes" summary="<%= summary %>"><thead><tr><% for(var i = 0, keys = Object.keys(titles), len = keys.length; i < len; i++) { %><th scope="col"<% if (i == 0) { %> colspan="2"<% } %>><%- titles[keys[i]] %></th><% } %></tr></thead><tbody><% for(var i = 0, keys = Object.keys(layers), len = keys.length; i < len; i++) { %><% var layer = layers[keys[i]] %><tr><td><input type="radio" name="uploaded-shapes-layer-id" id="uploaded_shapes_layer_<%- layer.layer_id %>" value="<%- layer.layer_id %>" <% if(layer.layer_id === checked) { %>checked<% } %> /></td><td scope="row"><label for="uploaded_shapes_layer_<%- layer.layer_id %>"><%- layer.layer_label %></label></td><td><%- layer.layer_updated %></td><td><%- layer.layer_source_url %></td></tr><% } %></tbody></table>',
setPopulateLayerTypesDefaultDescription:function(b){this.populateLayerTypes=c.extend({local:{title:h(227163),desc:h(227169),display:!0,active:!0,inputs:{layer_file:{label:h(227162),notice:h(227158).replace("{MAX}",Math.ceil(150)),type:"file",mandatory:!0},layer_srid:{label:h(21610),mandatory:!0}}},internal:{title:h(21603),desc:h(21606),display:!0,inputs:{layer_source_url:{label:h(21607),mandatory:!0,trim:!0},username:{label:h(21608)},password:{label:h(21609)},layer_srid:{label:h(21610),mandatory:!0}}},
api:{title:h(21602),desc:h(21605),display:!0,inputs:{}},uploaded:{title:h(21650),desc:"",display:!1,inputs:{}},external:{title:h(21604),desc:h(21611),display:!0,inputs:{layer_url:{label:h(16909),mandatory:!0,trim:!0},layer_source_name:{label:h(16907),mandatory:!0},layer_theme:{label:h(16908),mandatory:!0}}}},b||{});return this},setLanguages:function(b){var d=[];c.each(b,function(b,c){d[c.id]=c});this.languagesLookup=d;return this},getActivePopulateLayerType:function(){var b="";c.each(this.populateLayerTypes,
function(c,d){d.active&&(b=c)});return b},setPopulateLayerTypeActive:function(b){c.each(this.populateLayerTypes,function(b){this.populateLayerTypes[b].active=!1}.bind(this));this.populateLayerTypes[b]&&(this.populateLayerTypes[b].active=!0);return this},render:function(b,d){this.model=this.model||b;this.setPopulateLayerTypesDescription();this.$el.html(c(this.getHtml()));d||this.initEvents();return this.$el},setPopulateLayerTypesDescription:function(){this.setPopulateLayerTypeActive("local");this.populateLayerTypes.uploaded.display=
0<this.uploadedLayers.getCount();return this},populateLayerTypeOnChange:function(b){b=c(b.target).val();this.setPopulateLayerTypeActive(b);var d=this.renderPopulateLayerForm(this.model,this.allowModify);c(".populate-type",this.$el).html(d);"uploaded"===b?c(".label-row",this.$el).hide():c(".label-row",this.$el).show()},onFileButton:function(b){var c=b.target.getAttribute("data-file-id");!c||32!==b.keyCode&&13!==b.keyCode||(b.preventDefault(),this.$el.find("#"+c).click())},layerFileOnChange:function(b){if(b=
b.currentTarget.files[0])c(".cm_layer_file_name",this.$el).html(b.name),this.fileService.setFile(b)},renderMultilanguageNameElement:function(b,c){c=void 0!==c?c:this.allowModify;return(new d.Template(this._multilanguageNameElementTemplate)).apply({mode:c?"":"disabled",translations:b.get("translations",[{id:1,mandatory:1,name:"English",value:""}]),langLabels:this.langLabels})},renderLabelElement:function(b,c){c=void 0!==c?c:this.allowModify;return(new d.Template(this._labelElementTemplate)).apply({mode:c?
"":"disabled",label:h(16919),value:b.get("layer_label","")})},renderStatusElement:function(b,c){c=void 0!==c?c:this.allowModify;return(new d.Template(this._statusElementTemplate)).apply({mode:c?"":"disabled",label:h(16921),value:b.get("layer_status","inactive"),options:this.getStatuses()})},renderSelectLayerTypeElement:function(b,c,k){k=void 0!==k?k:this.allowModify;return(new d.Template(this._selectLayerTypeElementTemplate)).apply({mode:k?"":"disabled",label:h(21601),options:this.populateLayerTypes,
showLabel:c||!1})},renderPopulateLayerForm:function(b,c){var k=this.getActivePopulateLayerType();c=void 0!==c?c:this.allowModify;return(new d.Template(this._populateLayerFormTemplate)).apply({mode:c?"":"disabled",type:k,assignment:b.get("layer_assignment"),description:this.populateLayerTypes[k],uploadedLayers:"uploaded"===k?this.renderUploadedLayers():"",layer:b.toJSON()})},renderUploadedLayers:function(){if(0===this.uploadedLayers.getCount())return"";var b=this.uploadedLayers.toJSON();return(new d.Template(this._uploadedLayersTemplate)).apply({layers:b,
titles:{layer_label:h(21652),last_uploaded:h(21653),source_url:h(21654)},checked:b[0].layer_id,summary:h(21650)})},destroy:function(){this.$el=c('<div class="row layer-popup-content">');this.setPopulateLayerTypesDescription();this.model=null},getFormData:function(){var b={translations:[],layer_assignment:c("input[name='layer_assignment']:checked",this.$el).val(),layer_label:c("input[name='layer_label']",this.$el).val(),layer_status:c("[name='layer_status']:checked",this.$el).val(),layer_type:c("select[name='layer_type']",
this.$el).val()},d=this.$el.find("input[type='text'][name*='lang-']");c.each(d,function(d,g){var n=c(g),p=n.val();n.hasClass("mandatory")&&(b.layer_name=p);n=this.getLanguageIdByLabel(n.attr("lang"));b.translations.push(c.extend({},this.languagesLookup[n],{value:p}))}.bind(this));b.layer_type&&(d=Object.keys(this.populateLayerTypes[b.layer_type].inputs),c.each(d,function(d,g){b[g]=c("input[name='"+g+"']",this.$el).val();this.populateLayerTypes[b.layer_type].inputs[g].trim&&(b[g]=b[g].trim())}.bind(this)),
"uploaded"===b.layer_type&&(d=c("input[name='uploaded-shapes-layer-id']:checked",this.$el).val(),b.layer_id=parseInt(d),b.layer_label=this.uploadedLayers.get(d).get("layer_label")));return b},getLanguageIdByLabel:function(b){for(var c in this.langLabels)if(this.langLabels[c]===b)return c},getMandatoryLanguageData:function(){for(var b in this.languagesLookup)if(this.languagesLookup.hasOwnProperty(b)&&this.languagesLookup[b].mandatory)return{id:b,name:this.languagesLookup[b].name,value:this.languagesLookup[b].value,
mandatory:!0}},showErrors:function(b){var d=c(".jbf-form-content"),k=c(".layer_shape_hints-error");0<k.length&&k.remove();c.each(b,function(b,e){if("layer_shape_hints"!==e.field){var k=c("[name='"+e.field+"']",this.$el);d.animate({scrollTop:0},1);d.animate({scrollTop:k.position().top-d.height()/2},600);c('<span class="layer_shape_hints-error error error_field"></span>').text(e.message).insertAfter(k);k.addClass("hasError");return!0}k=c('input[value="'+e.message[0].field+'"]',this.$el);c.each(e.message,
function(b,d){var e=c('input[value="'+d.field+'"]',this.$el),g=c(e.parent().parent().find("input")[2]),e=c(e.parent().parent());c('<span class="layer_shape_hints-error error error_field"></span>').text(d.error).insertAfter(g);g.addClass("layer-shape-hint-error");e.find(".oj-table-data-cell").each(function(b,d){c(d).addClass("layer_shape_hints-cell-error")})}.bind(this));d.animate({scrollTop:0},1);d.animate({scrollTop:k.parent().position().top-d.height()/2},600)}.bind(this));return this},clearErrors:function(){c(".error_field",
this.$el).remove();c(".hasError",this.$el).removeClass("hasError");c(".layer-shape-hint-error").removeClass("layer-shape-hint-error");c(".layer_shape_hints-cell-error").removeClass("layer_shape_hints-cell-error");return this},getStatuses:function(){return{active:h(16922),inactive:h(16923)}},getAssignments:function(){return{work_zone:h(15930),layer:h(15931)}},clearFileServiceFromData:function(b){_DATA.layer_file_upload&&_DATA.layer_file_upload[b]&&(_DATA.layer_file_upload[b]=null)}})))})(toa,$);(function(d,c){var b=d.views.mapLayers.BaseFormView;d.ns("toa.views.mapLayers.AddFormView",d.define(b,function(c){b.apply(this,arguments)},{events:{"click .layer-assignment-select":"shapesAssignmentOnChange","change .populate-layer-type-select":"populateLayerTypeOnChange","change #cm_layer_type_layer_file":"layerFileOnChange","keyup .file-button":"onFileButton"},_mainTemplate:'<div class="add-map-layer"><div class="col-md-6"><div class="layer-popup-content-box layer-popup-left-box map-layer-base-fields"><h2 class="box-header"><%- infoTitle %></h2><%= selectShapesAssignmentElement %><% if (showLayerInfo) { %><div><span class="fb-mandatory"><label class="edit-map-layer-label"><%- layerName %></label></span><%= multilanguageNameElement %><%= labelElement %><%= statusElement %></div><% } %></div></div><div class="col-md-6"><div class="layer-popup-content-box layer-popup-right-box map-layer-base-fields"><h2 class="box-header"><%- shapesTitle %></h2><div class="box-content"><div class="layer-shapes-settings"><div class="select-layer-type"><%= selectLayerTypeElement %></div><div class="populate-type"><%= populateLayer %></div></div></div></div></div></div>',
_selectShapesAssignmentElementTemplate:'<div class="select-shapes-assignment layer-status-wrapper"><% for (var option in options) { %><p><label class="cm-layer-status-label no-float"><input type="radio" class="layer-assignment-select" name="layer_assignment" value="<%- option %>" <% if (option === value) { %>checked="checked"<% } %><% if (mode) { %> disabled<% } %>><span class="checkmark <%- mode %>"></span><%- options[option] %></label></p><% if (mode && option === "work_zone") { %><p class="notice"><%- note %></p><% } %><% } %></div>',
render:function(c){this.model=new d.models.mapLayers.Model({translations:this.languagesLookup});this.uploadedLayers.reset(this.fullUploadedLayersCollection.filterByField("layer_assignment","layer"));return b.prototype.render.apply(this,arguments)},getHtml:function(){return(new d.Template(this._mainTemplate)).apply({showLayerInfo:this.model.isMapLayer(),infoTitle:h(21635),layerName:h(16911),shapesTitle:h(21636),selectShapesAssignmentElement:this.renderSelectShapesAssignmentElement(this.model),multilanguageNameElement:this.renderMultilanguageNameElement(this.model),
labelElement:this.renderLabelElement(this.model),statusElement:this.renderStatusElement(this.model),selectLayerTypeElement:this.renderSelectLayerTypeElement(this.model,!0),populateLayer:this.renderPopulateLayerForm(this.model)})},renderSelectShapesAssignmentElement:function(b){var c=this.controller.mapLayerCollection.hasWorkZoneLayer();return(new d.Template(this._selectShapesAssignmentElementTemplate)).apply({options:this.getAssignments(),value:b.get("layer_assignment"),mode:c,note:h(15937)})},shapesAssignmentOnChange:function(d){d=
c(d.target).val();this.model.set({layer_assignment:d});this.uploadedLayers.reset(this.fullUploadedLayersCollection.filterByField("layer_assignment",d));this.populateLayerTypes.external.display="layer"===d;b.prototype.render.apply(this,[this.model,!0])},getFormData:function(){var c=b.prototype.getFormData.apply(this);c.layer_assignment&&"work_zone"===c.layer_assignment&&(c.layer_label=d.models.mapLayers.Model.DEFAULT_WZ_LABEL,c.layer_status="active",c.layer_name=h(15933),c.translations=[this.getMandatoryLanguageData()],
c.translations[0].value=c.layer_name);"local"===c.layer_type&&this.fileService.getFileSize()?(this.fileService.setUploadId(c.layer_label),_DATA.layer_file_upload[c.layer_label]=this.fileService,c.layer_source_url="local://"+this.fileService.getFileName()):(c.layer_file&&(c.layer_file=""),this.clearFileServiceFromData(c.layer_label));return c}}))})(toa,$);(function(d,c){var b=d.views.mapLayers.BaseFormView;d.ns("toa.views.mapLayers.EditFormView",d.define(b,function(c){b.apply(this,arguments)},{events:{'change .shape-hint-column-visibility>label>input[type="checkbox"]':"changeShapeHintColumnVisibility","change .populate-layer-type-select":"populateLayerTypeOnChange","click .layer-source-url-download":"downloadShapeFile","change #cm_layer_type_layer_file":"layerFileOnChange","change #cm_forms_and_plugins":"changePluginFormFieldColumnVisibility"},_mainTemplate:'<div class="edit-map-layer"><div class="col-md-6"><div class="layer-popup-content-box layer-popup-left-box map-layer-base-fields"><span class="fb-mandatory"><label class="edit-map-layer-label"><%- layerName %></label></span><%= multilanguageNameElement %><div class="edit-map-layer-status-section"><%= labelElement %><%= statusElement %></div></div></div><div class="col-md-6"><div class="layer-popup-content-box layer-popup-right-box"></div></div><div class="clearfix"></div><div class="layer-popup-content-box map-layer-base-fields"><h2 class="box-header"><%- shapesTitle %></h2><div class="box-content box-content-right-side"><%= shapeFilePopulationResults %></div></div></div>',
_shapeFilePopulationResultsTemplate:'<% if (showNotification) { %><div class="layer-shapes-notification<% if (error) { %> error<% } %>"><p><%= notification %></p></div><% } %><% if (showSettings) { %><div class="layer-shapes-settings"><%= shapesSettings %></div><% } %>',_shapeSettingsTemplate:'<table class="internal-layer-shapes-settings" role="none"><% for (i in fields) { %><% if (fields[i].value) { %><tr><td class="name-column"><label><%- fields[i].label %></label></td><% var raw = fields[i].html || false; %><% if (raw) { %><td class="value-column"><%= fields[i].value %></td><% } else { %><td class="value-column"><span><%- fields[i].value %></span></td><% } %></tr><% } %><% } %></table>',
_externalLayerFieldsTemplate:'<tr class="<%- name %>"><td><span class="fb-mandatory">*</span><label for="cm_external_layer_<%- name %>"><%- label %></label></td><td><input type="text" name="<%- name %>" id="cm_external_layer_<%- name %>" value="<%- value %>" <%- mode %>/></td></tr>',_layerShapeColumnSelectTemplate:'<tr><td><% if (name === "layer_shape_identifier") { %><span class="fb-mandatory">*</span><% } %><label class="edit-map-layer-label" for="cm_shape_column_<%- name %>"><%- label %></label></td><td><div class="select-wrapper_dropdown"><select<% if (name === "layer_shape_identifier") { %> required<% } %> <%- mode %> class="form-item" name="<%- name %>" id="cm_shape_column_<%- name %>"><option value=""<% if ("" === selected ) { %> selected="selected"<% } %>></option><% for (option in options) { %><option value="<%- options[option].sourceColumn %>" <% if (options[option].sourceColumn === selected ) { %>selected="selected"<% } %>><%- options[option].sourceColumn %></option><% } %></select></div></td></tr>',
_createShapeHintColumnsTemplate:'<div class="shape-hint-columns oj-table-horizontal-grid"><h2 class="edit-map-layer-label"><%- labels["shape_hint_columns_caption"] %></h2><span class="notice"><%- notice %></span><table class="oj-table-element oj-component-initnode" aria-label="<%= h(21630/*Shape Hint Columns:*/) %>"><thead class="oj-table-header table-header"><tr class="oj-table-header-row"><th class="oj-table-column-header-cell" aria-hidden="true" role="none">&nbsp;</th><th class="oj-table-column-header-cell"><div class="oj-table-column-header"><div class="oj-table-column-header-text" id="shape-hint-column-source-name"><%- labels["shape_hint_columns_source_name"] %></div></div></th><th class="oj-table-column-header-cell"><div class="oj-table-column-header"><div class="oj-table-column-header-text" id="shape-hint-column-custom-name"><%- labels["shape_hint_columns_custom_name"] %></div></div></th><th class="oj-table-column-header-cell plugin-form-field <% if (!pluginLinkDisplay) { %> hidden<% } %>"><div class="oj-table-column-header"><div class="oj-table-column-header-text" id="shape-hint-column-plugin-form-field"><%- labels["shape_hint_columns_plugin_form_field"] %></div></div></th></tr></thead><tbody class="oj-table-body table-body"><% if ( !!hints && !$.isEmptyObject(hints) ) { %><tr class="oj-table-body-row shape-hint-column shape-hint-column-latlong <% if (!pluginLinkDisplay) { %>hidden<% } %>"><td class="oj-table-data-cell oj-form-control-inherit shape-hint-column-visibility first-cell" headers="shape-hint-column-source-name"><label class="container"><input aria-label="cm_hint_visible" name="customShapePffLatitude:visible" type="checkbox" value="1" disabled="disabled" checked="checked" /><span class="checkmark checkmark-disabled"></span></label></td><td class="oj-table-data-cell oj-form-control-inherit shape-hint-column-source" headers="shape-hint-column-source-name"><span><%- pluginLinkValues["shape_hint_values_latitude"] %></span><input aria-label="cm_hint_source" name="customShapePffLatitude:sourceColumn" value="_LATITUDE" type="hidden" <%- mode %>/></td><td class="oj-table-data-cell oj-form-control-inherit shape-hint-column-custom-name disabled" headers="shape-hint-column-custom-name"><input aria-label="cm_hint_default" name="customShapePffLatitude:defaultName" type="text" value="" disabled /></td><td class="oj-table-data-cell oj-form-control-inherit shape-hint-column-custom-name plugin-form-field" headers="shape-hint-column-plugin-form-field"><input aria-label="cm_hint_pluginFormFieldLabel" type="text" name="customShapePffLatitude:pluginFormField" <%- mode %> value="<% if ( customShapePffLatitude.pluginFormField ) { %><%- customShapePffLatitude.pluginFormField %><% } %>"/></td></tr><tr class="oj-table-body-row shape-hint-column shape-hint-column-latlong <% if (!pluginLinkDisplay) { %>hidden<% } %>"><td class="oj-table-data-cell oj-form-control-inherit shape-hint-column-visibility first-cell" headers="shape-hint-column-source-name"><label class="container"><input aria-label="cm_hint_visible" name="customShapePffLongitude:visible" type="checkbox" value="1" disabled="disabled" checked="checked" /><span class="checkmark checkmark-disabled"></span></label></td><td class="oj-table-data-cell oj-form-control-inherit shape-hint-column-source" headers="shape-hint-column-source-name"><span><%- pluginLinkValues["shape_hint_values_longitude"] %></span><input aria-label="cm_hint_source"name="customShapePffLongitude:sourceColumn" value="_LONGITUDE" type="hidden" <%- mode %>/></td><td class="oj-table-data-cell oj-form-control-inherit shape-hint-column-custom-name disabled" headers="shape-hint-column-custom-name"><input aria-label="cm_hint_default" name="customShapePffLongitude:defaultName" type="text" value="" disabled /></td><td class="oj-table-data-cell oj-form-control-inherit shape-hint-column-custom-name plugin-form-field" headers="shape-hint-column-plugin-form-field"><input aria-label="cm_hint_pluginFormFieldLabel" type="text" name="customShapePffLongitude:pluginFormField"<%- mode %> value="<% if ( customShapePffLongitude.pluginFormField) { %><%- customShapePffLongitude.pluginFormField %><% } %>"/></td></tr><% for (hint in hints) { %><tr class="oj-table-body-row shape-hint-column"><td class="oj-table-data-cell oj-form-control-inherit shape-hint-column-visibility first-cell" headers="shape-hint-column-source-name"><label class="container <%- mode %>"><input aria-label="cm_hint_<%- hint %>:visible" name="<%- hint %>:visible" type="checkbox" value="1" <%- mode %> <% if ( hints[hint].visible ) { %> checked<% } %> /><span class="checkmark <%- mode %>"></span></label></td><td class="oj-table-data-cell oj-form-control-inherit shape-hint-column-source" headers="shape-hint-column-source-name"><span id="layer_shape_hints_<%- hints[hint].sourceColumn %>"><%- hints[hint].sourceColumn %></span><input aria-label="cm_hint_<%- hint %>:source"name="<%- hint %>:sourceColumn" type="hidden" value="<%- hints[hint].sourceColumn %>" /></td><td class="oj-table-data-cell oj-form-control-inherit shape-hint-column-custom-name<% if ( !hints[hint].visible ) { %> disabled<% } %>" headers="shape-hint-column-custom-name"><input aria-label="cm_hint_<%- hint %>:default"name="<%- hint %>:defaultName" type="text" <%- mode %> value="<% if (hints[hint].defaultName !== undefined) { %><%- hints[hint].defaultName %><% } %>" <% if ( !hints[hint].visible ) { %> disabled<% } %> /></td><td class="oj-table-data-cell oj-form-control-inherit shape-hint-column-custom-name plugin-form-field<% if ( !hints[hint].visible ) { %> disabled<% } %><% if (!pluginLinkDisplay) { %> hidden<% } %>" headers="shape-hint-column-plugin-form-field"><input aria-label="cm_hint_<%- hint %>:pluginFormFieldLabel"name="<%- hint %>:pluginFormField" type="text" <%- mode %> value="<% if (hints[hint].pluginFormField !== undefined) { %><%- hints[hint].pluginFormField %><% } %>" <% if ( !hints[hint].visible ) { %> disabled<% } %> /></td></tr><% } %><% } else { %><tr class="shape-hint-column"><td class="oj-table-data-cell oj-form-control-inherit" colspan="3" headers="shape-hint-column-source-name"><span><%- labels["shape_hint_columns_empty"] %></span></td></td><% } %></tbody></table></div>',
_createFormsAndPluginTemplate:'<table class="forms-and-plugins-settings" role="none"><tr><td><label class="edit-map-layer-label" for="cm_forms_and_plugins"><%- fieldLabel %></label></td><td><div class="forms-and-plugins"><div class="select-wrapper_dropdown"><select id="cm_forms_and_plugins" name="forms-and-plugins" class="form-item" <%- mode%>><option value=""></option><% for (group in structure) { %><optgroup label="<%-structure[group].title %>" data-type="<%-structure[group].groupType%>"><% for (i in structure[group].child) { %><option value="<%- structure[group].child[i].id %>" <% if (structure[group].child[i].selected) { %>selected="selected"<% } %>><%- structure[group].child[i].title.replace(/(.{22})..+/, "$1...") %></option><% } %></optgroup><% } %></select></div></div></td></tr></table><div class="notice-wrapper"><div class="notice-inner"><span class="notice"><%- sectionLabel %></span></div></div>',
changeShapeHintColumnVisibility:function(b){b=b.target;var d=c(b).closest(".shape-hint-column");b.checked?(d.find(".shape-hint-column-custom-name").removeClass("disabled"),d.find(".shape-hint-column-custom-name input").removeAttr("disabled")):(d.find(".shape-hint-column-custom-name").addClass("disabled"),d.find(".shape-hint-column-custom-name input").attr("disabled","true"),d.find("input.layer-shape-hint-error").removeClass("layer-shape-hint-error"),d.find("span.layer_shape_hints-error").remove(),
d.find(".layer_shape_hints-cell-error").removeClass("layer_shape_hints-cell-error"))},changePluginFormFieldColumnVisibility:function(b){var d=[".table-header th.plugin-form-field",".table-body .plugin-form-field",".table-body .shape-hint-column-latlong"];c(b.target).val()?(this.operateWithLatLongInputsPluginLinkEnabled(),c(d.join(", "),this.$el).removeClass("hidden")):(this.operateWithLatLongInputsPluginLinkDisabled(),c(d.join(", "),this.$el).addClass("hidden"));this.recalculateCellWidth()},operateWithLatLongInputsPluginLinkEnabled:function(){c('.shape-hint-column-latlong input[type="checkbox"]',
this.$el).prop("checked",!0);c('.shape-hint-column-latlong input[type="checkbox"]',this.$el).prop("disabled",!0);c('.shape-hint-column-latlong .plugin-form-field input[type="text"]',this.$el).prop("disabled",!1)},operateWithLatLongInputsPluginLinkDisabled:function(){c('.shape-hint-column-latlong input[type="checkbox"]',this.$el).prop("checked",!1);c('.shape-hint-column-latlong input[type="checkbox"]',this.$el).prop("disabled",!1);c('.shape-hint-column-latlong .plugin-form-field input[type="text"]',
this.$el).prop("disabled",!0)},recalculateCellWidth:function(){var b=c(".oj-table-column-header-cell:visible",this.$el).length,d;c(".oj-table-column-header-cell",this.$el).each(function(k,l){d=0===k?8:92/(b-1);c(l).css("width",d+"%")});c(".oj-table-data-cell:not(.first-cell)",this.$el).each(function(d,g){c(g).css("width",92/(b-1)+"%")})},processingLayerJobStatus:function(b){if(!this.model||this.model.getId()!==b.modelId)return this;this.$el.find(".box-content-right-side").html(this.renderShapeFilePopulationResults(this.model,
b.status,b.error));this.recalculateCellWidth();parseInt(this.model.get("form_id"),10)||parseInt(this.model.get("action_link_id"),10)?this.operateWithLatLongInputsPluginLinkEnabled():this.operateWithLatLongInputsPluginLinkDisabled();return this.previewLayer(b.status)},previewLayer:function(b){b=b||this.model.get("progress_status",d.models.mapLayers.Model.PROGRESS_STATUS.IS_NOT_LOADED);if(b===d.models.mapLayers.Model.PROGRESS_STATUS.SUCCEEDED||b===d.models.mapLayers.Model.PROGRESS_STATUS.EXTERNAL)"internal"===
this.model.get("layer_type")&&this.normalizeHintTableSize(),c(".layer-popup-right-box>div",this.$el).is(".shape-map-layer-holder")||this.displayMap();return this},normalizeHintTableSize:function(){var b=c(".shape-hint-column",this.$el),d=0;5<b.length&&(b.each(function(b,e){if(5<=b)return!1;d+=c(e).outerHeight(!0)}),c(".table-body ul",this.$el).height(d))},renderShapeFilePopulationResults:function(b,c,k){c=c||b.get("progress_status",d.models.mapLayers.Model.PROGRESS_STATUS.IS_NOT_LOADED);c===d.models.mapLayers.Model.PROGRESS_STATUS.FAILED&&
(b.isLocal()?(this.setPopulateLayerTypeActive("local"),b.set({layer_srid:""})):this.setPopulateLayerTypeActive("internal"));var l=b.isPopulationJobFailed(c),n=c!==d.models.mapLayers.Model.PROGRESS_STATUS.IS_NOT_LOADED||!b.isMapLayer(),p=c!==d.models.mapLayers.Model.PROGRESS_STATUS.NOT_AVAILABLE||c!==d.models.mapLayers.Model.PROGRESS_STATUS.PROCESSING;return(new d.Template(this._shapeFilePopulationResultsTemplate)).apply({showNotification:n,showSettings:p,error:l,notification:n?this._getNotificationForShapeFilePopulationResults(b.get("layer_type"),
c,k):"",shapesSettings:p?this._getShapesSettings(b,c):""})},_getNotificationForShapeFilePopulationResults:function(b,c,k){if("external"===b)return h(21645);b=Array(4).join('<span class="loader-blink-dot"></span>');switch(c){case d.models.mapLayers.Model.PROGRESS_STATUS.NOT_AVAILABLE:return h(21637);case d.models.mapLayers.Model.PROGRESS_STATUS.IS_NOT_LOADED:return h(15936);case d.models.mapLayers.Model.PROGRESS_STATUS.FAILED:return h(21638)+(k?" "+h(k):"");case d.models.mapLayers.Model.PROGRESS_STATUS.SUCCEEDED:return h(21644);
case d.models.mapLayers.Model.PROGRESS_STATUS.PROCESSING:return b;default:return h(21642)+" "+this.getLayerJobStatus(c)+b+"</p><p>"+h(21643)}},_getShapesSettings:function(b,c){return"external"===b.get("layer_type")?this.renderShapeSettingsElement(b)+"<table>"+this.renderExternalLayerFieldsTemplate(b)+"</table>":c===d.models.mapLayers.Model.PROGRESS_STATUS.FAILED||c===d.models.mapLayers.Model.PROGRESS_STATUS.IS_NOT_LOADED?'<div class="select-layer-type">'+this.renderSelectLayerTypeElement(b,!0,this.allowModify)+
'</div><div class="populate-type">'+this.renderPopulateLayerForm(b)+"</div>":c===d.models.mapLayers.Model.PROGRESS_STATUS.SUCCEEDED?this._getShapeSettingForSucceededStatus(b):this.renderShapeSettingsElement(b)},formatLayerSourceUrlField:function(b){var c={value:b,label:h(21628),html:!1};b=String(b||"").split("local://");2===b.length&&(c.value=(new d.Template('<a class="layer-source-url-download"><%- value %></a>')).apply({value:b[1]}),c.html=!0,c.label=h(227167));return c},downloadShapeFile:function(b){b=
this.model.get("layer_label",d.models.mapLayers.Model.DEFAULT_WZ_LABEL);b=d.Ajax.prototype.route("mapwriter","downloadShapeFile")+"&layerLabel="+b;download_file(b)},renderLayerShapeTitleSelect:function(b){return(new d.Template(this._layerShapeColumnSelectTemplate)).apply({label:h(21629),name:"layer_shape_title",options:b.get("layer_shape_hints",[]),selected:b.get("layer_shape_title"),mode:this.allowModify?"":" disabled"})},renderShapeIdentifierSelect:function(b){return(new d.Template(this._layerShapeColumnSelectTemplate)).apply({label:h(15935),
name:"layer_shape_identifier",options:b.get("layer_shape_columns",[]),selected:b.get("layer_shape_identifier"),mode:this.allowModify?"":" disabled"})},renderExternalLayerFieldsTemplate:function(b){var g="";c.each(this.populateLayerTypes.external.inputs,function(c,l){g+=(new d.Template(this._externalLayerFieldsTemplate)).apply({mode:this.allowModify?"":" disabled",label:l.label,name:c,value:b.get(c)})}.bind(this));return g},renderCreateShapeHintColumnsTemplate:function(b){var c=0!==parseInt(b.get("form_id"),
10)||0!==parseInt(b.get("action_link_id"),10),k=b.get("layer_shape_hints",[]).sort(function(b,c){return b.visible===c.visible?0:b.visible?-1:1});return(new d.Template(this._createShapeHintColumnsTemplate)).apply({labels:{shape_hint_columns_caption:h(21630),shape_hint_columns_source_name:h(21631),shape_hint_columns_custom_name:h(21632),shape_hint_columns_plugin_form_field:h(225610),shape_hint_columns_empty:h(21634)},hints:k,notice:h(16934),pluginLinkDisplay:c,customShapePffLatitude:b.get("custom_shape__latitude",
[]),customShapePffLongitude:b.get("custom_shape__longitude",[]),pluginLinkValues:{shape_hint_values_latitude:h(225611),shape_hint_values_longitude:h(225612)},mode:this.allowModify?"":" disabled"})},renderFormsAndPluginTemplate:function(b){return(new d.Template(this._createFormsAndPluginTemplate)).apply({structure:this.populateStructureForShapeHint(b),sectionLabel:h(19505),fieldLabel:h(19504),mode:this.allowModify?"":" disabled"})},populateStructureForShapeHint:function(b){var d=[],k=c.map(this.formsAndPlugins.forms||
{},function(c,d){return{id:d,title:c,selected:parseInt(d,10)===parseInt(b.get("form_id"),10)}}),l=c.map(this.formsAndPlugins.plugins||{},function(c,d){return{id:d,title:c,selected:parseInt(d,10)===parseInt(b.get("action_link_id"),10)}});0<k.length&&d.push({groupType:this.constructor.groupTypeForms,title:h(19519),child:k});0<l.length&&d.push({groupType:this.constructor.groupTypePlugins,title:h(227111),child:l});return d},displayMap:function(b){var d='<div id="shape-map-layer-'+this.model.getId()+'" class="shape-map-layer-holder"></div>';
b=c(d).appendTo(b||this.$el.find(".layer-popup-right-box"));this.map=new app.map.oracle.MapContainer({container:b,navigationControl:{visible:!1},initOnDemand:!0,markerLayer:!1,routesLayer:!1,circleLayer:!1,droppable:!1});this.map.initInstance().done(function(b){this.onMapInit()}.bind(this));return!0},getHintBtnData:function(){var b=c('select[name="forms-and-plugins"] option:selected',this.$el),d=b.val();return d?b.parent().data("type")===this.constructor.groupTypeForms?{action_link_id:0,form_id:d}:
{action_link_id:d,form_id:0}:{action_link_id:0,form_id:0}},getFormData:function(){var d=b.prototype.getFormData.apply(this),d=c.extend({},this.model.toJSON(),d);if("external"===d.layer_type){var g=Object.keys(this.populateLayerTypes.external.inputs);c.each(g,function(b,g){d[g]=c("input[name='"+g+"']",this.$el).val()}.bind(this))}c.each(["layer_shape_title","layer_shape_identifier"],function(b,g){var n=c("select[name='"+g+"']",this.$el).val();d[g]=n?n:""}.bind(this));g=c(".shape-hint-column").find("input");
0<g.length&&(d.layer_shape_hints=[]);c.each(g,function(b,g){var n=c(g).attr("name").split(":"),p=n[0],n=n[1],s="visible"===n?c(g).is(":checked"):c(g).val();s&&(d.layer_shape_hints[p]||(d.layer_shape_hints[p]=[]),d.layer_shape_hints[p][n]=s)}.bind(this));"work_zone"===d.layer_assignment&&(d.layer_status="active");"local"===d.layer_type&&this.fileService.getFileSize()?(this.fileService.setUploadId(d.layer_label),_DATA.layer_file_upload[d.layer_label]=this.fileService,d.layer_source_url="local://"+this.fileService.getFileName()):
(d.layer_file&&(d.layer_file=""),this.clearFileServiceFromData(d.layer_label));return c.extend(d,this.getHintBtnData())},destroy:function(){this.map&&(this.cancelDataRequest(),this.map.destroy(),this.map=null);b.prototype.destroy.apply(this)},cancelDataRequest:function(){if(this.model){var b="work_zone"===this.model.get("layer_assignment")?"workzones":this.model.get("layer_label","");(b=this.map.getLayer(b))&&b.getInstance().getDataRequest&&b.getInstance().getDataRequest.abort()}}},{groupTypeForms:"forms",
groupTypePlugins:"plugins"}))})(toa,$);(function(d,c){var b=d.views.mapLayers.EditFormView;d.ns("toa.views.mapLayers.MapLayerEditFormView",d.define(b,function(c){b.apply(this,arguments)},{render:function(c){this.populateLayerTypes.external.display=!0;this.uploadedLayers.reset(this.uploadedLayers.filterByField("layer_assignment","layer"));return b.prototype.render.apply(this,arguments)},getHtml:function(){return(new d.Template(this._mainTemplate)).apply({layerName:h(16911),shapesTitle:h(21636),multilanguageNameElement:this.renderMultilanguageNameElement(this.model,
this.allowModify),labelElement:this.renderLabelElement(this.model,!1),statusElement:this.renderStatusElement(this.model,this.allowModify),shapeFilePopulationResults:this.renderShapeFilePopulationResults(this.model)})},_getShapeSettingForSucceededStatus:function(b){var c=h(16935);return this.renderShapeSettingsElement(b)+'<table class="layer-shape-title-table" role="none">'+this.renderLayerShapeTitleSelect(b)+'</table><div class="notice-wrapper"><div class="notice-inner"><span class="notice">'+c+"</span></div></div>"+
this.renderFormsAndPluginTemplate(b)+this.renderCreateShapeHintColumnsTemplate(b)},renderShapeSettingsElement:function(b){var c=[{value:b.get("layer_type"),label:h(21651)}];"external"!==b.get("layer_type")&&(c.push({value:b.get("layer_updated"),label:h(21615)}),c.push({value:b.get("layer_srid"),label:h(21610)}),c.push(this.formatLayerSourceUrlField(b.get("layer_source_url"))));return(new d.Template(this._shapeSettingsTemplate)).apply({fields:c})},onMapInit:function(){if(this.map){var b=this.model.get("layer_type"),
c={};"external"===b&&(c.url=this.model.get("layer_url"),c.theme=this.model.get("layer_theme"),c.dataSource=this.model.get("layer_source_name"));var d=new app.map.oracle.CustomerLayer(this.model.get("layer_label"),b,c),l=function(){d.fitBounds();d.getInstance().deleteListener(OM.event.LayerEvent.FEATURES_LOADED,l)};d.getInstance().addListener(OM.event.LayerEvent.FEATURES_LOADED,l);this.map.addLayer(d)}}}))})(toa,$);(function(d,c){var b=d.views.mapLayers.EditFormView;d.ns("toa.views.mapLayers.WorkZoneEditFormView",d.define(b,function(c){b.apply(this,arguments)},{render:function(c){this.populateLayerTypes.external.display=!1;this.uploadedLayers.reset(this.uploadedLayers.filterByField("layer_assignment","work_zone"));return b.prototype.render.apply(this,arguments)},getHtml:function(){return(new d.Template(this._mainTemplate)).apply({infoTitle:h(21635),layerName:h(16911),shapesTitle:h(21636),multilanguageNameElement:this.renderMultilanguageNameElement(this.model,
!1),labelElement:this.renderLabelElement(this.model,!1),statusElement:"",shapeFilePopulationResults:this.renderShapeFilePopulationResults(this.model)})},_getShapeSettingForSucceededStatus:function(b){var c=h(15934);return this.renderShapeSettingsElement(b)+'<table class="layer-shape-title-table" role="none">'+this.renderShapeIdentifierSelect(b)+'</table><span class="notice">'+c+"</span>"},renderShapeSettingsElement:function(b){return(new d.Template(this._shapeSettingsTemplate)).apply({fields:[{value:b.get("layer_updated"),
label:h(21615)},{value:b.get("layer_srid"),label:h(21610)},this.formatLayerSourceUrlField(b.get("layer_source_url"))]})},onMapInit:function(){if(this.map){var b=new app.map.oracle.WorkzoneLayer("workzones",{workZonesInfo:"*",defaultColor:"#e7584a",checkShapeFileAvailability:!1});this.map.addLayer(b)}}}))})(toa,$);(function(d,c){var b=d.views.mapLayers.BaseView;d.ns("toa.views.mapLayers.ListView",d.define(b,function(d){b.apply(this,arguments);this.$container=c(".custom-map-layers-table-container",_DATA.content);this.$el=c("table tbody",this.$container);this.collection=this.options.collection;this.modelViews=[];this.controller=d.controller;this.allowModify=d.allowModify;this.uLang=d.uLang||"English";this.userTypesLookup=d.userTypes||{}},{events:{"click .cm_layers_create":"addNew","keypress .cm_layers_create":"addNew"},
toggleHint:function(b){var d=c(".custom-map-layers-table",this.$container),k=c(".no-layers-hint",this.$container);b?(d.hide(),k.show()):(d.show(),k.hide())},render:function(b){this.$el.empty();var c=void 0!==b;this.collection.each(function(d){var l="read";b&&d.getId()===b&&(l=d.hasAction("merge")?"merge":"add");this.renderItem(d,l,c)}.bind(this));c||this.initEvents();this.toggleHint(0===this.collection.getCount());return this},renderItem:function(b,c,k){var l=new (b.isMapLayer()?d.views.mapLayers.ItemView:
d.views.mapLayers.WorkZonesItemView)({model:b,allowModify:this.allowModify,uLang:this.uLang,userTypes:this.userTypesLookup});c=l.render(c);l.addListener("edit",this.controller.edit,this.controller);l.addListener("remove",this.controller.remove,this.controller);l.addListener("permissions",this.controller.editPermissions,this.controller);l.addListener("layer-job-status",this.controller.processLayerJobStatus,this.controller);this.$el.append(c);l.checkJobStatus(k);this.modelViews[b.getId()]=l},addNew:function(b){if("keypress"!==
b.type||13===b.keyCode)b.preventDefault(),this.notify("add_new")}}))})(toa,$);(function(d,c){var b=d.views.mapLayers.BaseView;d.ns("toa.views.mapLayers.ItemView",d.define(b,function(d){b.apply(this,arguments);this.$el=c('<tr class="layer-data" align="center"></tr>');this.model=this.options.model;this.allowModify=d.allowModify;this.uLang=d.uLang||"English";this.userTypesLookup=d.userTypes||{};this.allowDelete=!0},{deleteShapes:!1,events:{"click .layer-hint":"openHint","keypress .layer-hint":"openHint"},_itemTemplate:'<td class="layer_status_icon"><div role="img" class="" aria-label="">&nbsp;</div></td><th align="left" scope="row" class="font-normal"><div class="layer_info"><%= layer_name %><%= hidden_info %></div><div class="notice"><span class="layer-status"></span><span class="dots-loader notice"></span><span class="last-updated"><%- last_updated %>:&nbsp;<span class="pretty-date" data-lang="<%- uLang %>"><%- updated %></span></span></div></th><td class="layer_user_types" align="left"><%= userTypeLabels %></td><td><div role="button" aria-dropeffect="popup" class="layer-hint" tabindex="0"></div></td>',
_layerNameTemplate:'<span class="cm_layers_last_name_text"><%- layerName %></span><input class="input_layer_name cm_layers_last_name_text" type="hidden" value="<%- layerName %>"<%- mode %> />',_hiddenInfoItemTemplate:'<input type="hidden" name="direct[cm_layers]<%- name_suffix %>" value="<%- value %>"<% if (className) { %> class="layer_label"<% } %> />',_deleteConfirmationPopup:'<div><p><%- mainLabel %></p><% if (showShapesConfirmation) { %><p><label><input type="checkbox" id="deleteShapes"><%- checkboxLabel %></label></p><% } %></div>',
render:function(b){this.$el.html(c(this.getHtml(b)));this.model.hasAction("delete")&&this.$el.hide();this.initEvents();return this.$el},getHtml:function(b){return(new d.Template(this._itemTemplate)).apply({uLang:this.uLang,last_updated:h(16943),userTypeLabels:this.renderUserTypeLabels(this.model),layer_name:this.renderLayerName(this.model),layer_label:this.model.get("layer_label"),hidden_info:this.renderHiddenInfo(this.model,b),updated:this.model.get("layer_updated")})},renderUserTypeLabels:function(b){b=
b.get("user_types",[d.models.mapLayers.Model.ALL_USER_TYPE_ID]);var c=[],k="";if(b.length)if(1===b.length&&b[0]===d.models.mapLayers.Model.ALL_USER_TYPE_ID)k='<span class="user_types_label all-types">'+h(15925)+"</span>";else{for(var k=0,l=b.length;k<l;k++)c.push('<span class="user_types_label">'+this.userTypesLookup[b[k]]+"</span>");2<c.length?(k=h(15926),k=k.replace("{USER_TYPES}",c[0]),k=k.replace("{COUNT}",c.length-1)):k=c.join(", ")}return k},renderLayerName:function(b){return(new d.Template(this._layerNameTemplate)).apply({layerName:b.get("layer_name"),
mode:this.allowModify?"":" disabled"})},renderHiddenInfo:function(b,c){if("read"===c&&!b.hasAction())return"";b.setAction(c);var k=b.getInfo(),l=[],n;for(n in k)l.push((new d.Template(this._hiddenInfoItemTemplate)).apply(k[n]));return l.join("")},edit:function(){this.hint.Tip("hide");this.notify("edit",this.model.getId())},deleteConfirmation:function(){this.hint.Tip("hide");if(this.allowModify&&this.allowDelete)var b=new d.ui.Popup({title:h(15941).replace("{LAYER_NAME}",this.model.get("layer_name")),
width:400,autoOpen:!0,modal:!0,html:this._getContentForConfirmationPopup(),onClose:function(){b.destroy()},buttons:[{id:"dialogCancelBtn",text:h(14621),position:"left",click:function(){b.destroy()}},{id:"submit",text:h(445),type:"submit",position:"right",click:function(){b.destroy();this.delete()}.bind(this)}]})},_getContentForConfirmationPopup:function(){var b=c((new d.Template(this._deleteConfirmationPopup)).apply({mainLabel:h(15939),checkboxLabel:h(15940),showShapesConfirmation:"internal"===this.model.get("layer_type")&&
this.model.get("progress_status")===d.models.mapLayers.Model.PROGRESS_STATUS.SUCCEEDED}));b.on("click","#deleteShapes",function(b){this.deleteShapes=b.target.checked}.bind(this));return b},delete:function(){if(this.model.hasAction("add")||this.model.hasAction("merge"))this.$el.remove();else if(this.$el.hide(),c(".layer_info",this.$el).html(this.renderHiddenInfo(this.model,"delete")),this.deleteShapes){var b=c((new d.Template(this._hiddenInfoItemTemplate)).apply({name_suffix:"["+[this.model.getId(),
"delete_shapes"].join("][")+"]",value:1,className:!1}));c(".layer_info",this.$el).append(b)}this.notify("remove",this.model)},editPermissions:function(){this.hint.Tip("hide");this.notify("permissions",this.model.getId())},openHint:function(b){if("keypress"!==b.type||13===b.keyCode)this.hint||this.initHint(),this.hint.Tip("showAt",b.target,"left"),this.hint.find("[tabindex]").first().focus()},getHintItemsData:function(){return[{label:h(16927),className:"layer-modify",readWrite:!1},{label:h(16928),
className:"layer-delete",readWrite:!0},{label:h(16929),className:"layer-permissions",readWrite:!0}]},initHint:function(){var b=[];c.each(this.getHintItemsData(),function(c,k){!this.allowModify&&k.readWrite||b.push((new d.Template('<div role="link" class="data-settings-row <%- className %>" tabindex="0"><span><%- label %></span></div>')).apply(k))}.bind(this));this.hint=c('<div class="map-layer-hint map-layer-data-settings">'+b.join("")+"</div>");this.hint.Tip({minWidth:170,minHeight:33*b.length,height:37*
b.length,zIndex:2020});this.hint.on("click",".layer-modify",this.edit.bind(this));this.hint.on("keypress",".layer-modify",function(b){27!==b.keyCode&&this.edit()}.bind(this));this.hint.on("click",".layer-delete",this.deleteConfirmation.bind(this));this.hint.on("keypress",".layer-delete",function(b){27!==b.keyCode&&this.deleteConfirmation()}.bind(this));this.allowDelete||this.hint.find(".layer-delete").addClass("layer-delete-disabled");this.hint.on("click",".layer-permissions",this.editPermissions.bind(this));
this.hint.on("keypress",".layer-permissions",function(b){27!==b.keyCode&&this.editPermissions()}.bind(this));this.hint.Tip("option","callout",{side:"right",position:10});return this},checkJobStatus:function(b){var c=this.model.get("layer_job_id"),k=this.model.get("layer_label");_DATA.layer_file_upload&&_DATA.layer_file_upload[k]?b?b=d.models.mapLayers.Model.PROGRESS_STATUS.IS_NOT_LOADED:(b=_DATA.layer_file_upload[k],b.addListener(d.classes.fileUploader.FileService.EVENT.SUCCESS,this.uploadProgressHandler,
this),b.addListener(d.classes.fileUploader.FileService.EVENT.FINISH,this.finishUploadHandler,this),b.addListener(d.classes.fileUploader.FileService.EVENT.ABORT,this.uploadErrorHandler,this),b.start({}),b=d.models.mapLayers.Model.PROGRESS_STATUS.FILE_UPLOADING):c&&!b?(this.startTrackingJobStatus(),b=d.models.mapLayers.Model.PROGRESS_STATUS.PROCESSING):b=b?this.model.get("progress_status",d.models.mapLayers.Model.PROGRESS_STATUS.IS_NOT_LOADED):this.defineInitialLayerStatus();this.updateLayerProgressStatus(b);
return this},defineInitialLayerStatus:function(){var b=d.models.mapLayers.Model.PROGRESS_STATUS.IS_NOT_LOADED;switch(this.model.get("layer_type")){case "external":b=d.models.mapLayers.Model.PROGRESS_STATUS.EXTERNAL;break;case "api":case "internal":b=-1!==c.inArray(this.model.getId(),this.model.collection.layersWithInitialPopulationFailed)?d.models.mapLayers.Model.PROGRESS_STATUS.NOT_AVAILABLE:d.models.mapLayers.Model.PROGRESS_STATUS.IS_NOT_LOADED}return b},startTrackingJobStatus:function(){this.allowDelete=
!1;this.hint&&this.hint.find(".layer-delete").addClass("layer-delete-disabled");clearInterval(this.__checkStatusInterval);this.initCheckStatusTimeout();return this},initCheckStatusTimeout:function(){this.__checkStatusTimeout=setTimeout(function(){"company_settings_business_rules"!==_DATA.page_label?(this.notify("layer-job-status",{status:d.models.mapLayers.Model.PROGRESS_STATUS.NOT_AVAILABLE}),this.updateLayerProgressStatus(d.models.mapLayers.Model.PROGRESS_STATUS.NOT_AVAILABLE)):this.checkStatus()}.bind(this),
5E3);return this},checkStatus:function(){request({url:"?controller=mapwriter&method=getLayerJobStatus",data:{layer_job_id:this.model.get("layer_job_id"),assignment:this.model.get("layer_assignment")},responseHandler:this.checkStatusResponseHandler.bind(this),errorHandler:function(b){this.notify("layer-job-status",{status:d.models.mapLayers.Model.PROGRESS_STATUS.NOT_AVAILABLE,modelId:this.model.getId(),error:""});this.updateLayerProgressStatus(d.models.mapLayers.Model.PROGRESS_STATUS.NOT_AVAILABLE)}.bind(this)})},
checkStatusResponseHandler:function(b){var g=b.progress?b.progress:d.models.mapLayers.Model.PROGRESS_STATUS.NOT_AVAILABLE;-1!==c.inArray(g,[d.models.mapLayers.Model.PROGRESS_STATUS.SUCCEEDED,d.models.mapLayers.Model.PROGRESS_STATUS.FAILED,d.models.mapLayers.Model.PROGRESS_STATUS.NOT_AVAILABLE])?(this.allowDelete=!0,this.hint&&this.hint.find(".layer-delete").removeClass("layer-delete-disabled")):this.initCheckStatusTimeout();g===d.models.mapLayers.Model.PROGRESS_STATUS.SUCCEEDED&&"internal"===this.model.get("layer_type")&&
this.getColumns();this.notify("layer-job-status",{status:g,modelId:this.model.getId(),error:b.error||""});this.updateLayerProgressStatus(g)},updateLayerProgressStatus:function(b){this.model.set({progress_status:b});this.$el.find("div.layer-hint").attr("aria-label",h(11888));var g=this.$el.find('.layer_status_icon>div[role="img"]'),k=this.$el.find(".layer-status");if(b===d.models.mapLayers.Model.PROGRESS_STATUS.SUCCEEDED||"external"===this.model.get("layer_type"))g.addClass("active"===this.model.get("layer_status")?
"green":"red"),g.attr("aria-label","active"===this.model.get("layer_status")?h(15403):h(15404));-1!==c.inArray(b,this.model.getStatusesOfUnusedLayer())&&(g.addClass("red"),g.attr("aria-label",h(15404)));g=Array(4).join('<span class="loader-blink-dot"></span>');k.removeClass("error");switch(b){case d.models.mapLayers.Model.PROGRESS_STATUS.SUCCEEDED:k.hide();this.$el.find(".last-updated").show();break;case d.models.mapLayers.Model.PROGRESS_STATUS.IS_NOT_LOADED:k.html(this.model.hasAction("merge")?h(15942):
h(15936));break;case d.models.mapLayers.Model.PROGRESS_STATUS.EXTERNAL:k.html(this.getLayerJobStatus(b));break;case d.models.mapLayers.Model.PROGRESS_STATUS.FAILED:case d.models.mapLayers.Model.PROGRESS_STATUS.NOT_AVAILABLE:k.html(this.getLayerJobStatus(b)).addClass("error");break;case d.models.mapLayers.Model.PROGRESS_STATUS.PROCESSING:k.html(g);break;case d.models.mapLayers.Model.PROGRESS_STATUS.FILE_UPLOADING:k.html(h(227164).replace("{NUM}",0));break;default:k.html(this.getLayerJobStatus(b)+g)}c(".pretty-date",
this.$el).prettyDate({interval:6E4})},getColumns:function(){request({url:"?controller=mapwriter&method=getLayerColumns",data:{layer_label:this.model.get("layer_label")},responseHandler:function(b){b.layer_columns&&this.model.set({layer_shape_hints:b.layer_columns.layer_shape_hints,layer_shape_title:b.layer_columns.layer_shape_title,custom_shape__latitude:b.layer_columns.custom_shape__latitude,custom_shape__longitude:b.layer_columns.custom_shape__longitude});this.notify("layer-job-status",{status:d.models.mapLayers.Model.PROGRESS_STATUS.SUCCEEDED,
modelId:this.model.getId()});this.updateLayerProgressStatus(d.models.mapLayers.Model.PROGRESS_STATUS.SUCCEEDED)}.bind(this)})},uploadProgressHandler:function(b,c,d,l){c=Math.round(c/l*100);b=this.$el.find(".layer-status");c=h(227164).replace("{NUM}",c);b.html(c)},finishUploadHandler:function(b,c){c&&c.layer_job_id&&(this.model.set({layer_job_id:c.layer_job_id}),this.clearUpload(),this.checkJobStatus(!1))},uploadErrorHandler:function(b,c){this.$el.find(".layer-status").html(c).addClass("error");this.clearUpload()},
clearUpload:function(){var b=this.model.get("layer_label");_DATA.layer_file_upload&&_DATA.layer_file_upload[b]&&(_DATA.layer_file_upload[b]=null)}}))})(toa,$);(function(d,c){var b=d.views.mapLayers.ItemView;d.ns("toa.views.mapLayers.WorkZonesItemView",d.define(b,function(c){b.apply(this,arguments)},{renderUserTypeLabels:function(){return""},getHintItemsData:function(){return[{label:h(16927),className:"layer-modify",readWrite:!1},{label:h(16928),className:"layer-delete",readWrite:!0}]},getColumns:function(){request({url:"?controller=mapwriter&method=getShapeColumns",responseHandler:function(b){b.columns&&this.model.set({layer_shape_columns:c.map(b.columns,
function(b){return{sourceColumn:b}})});this.notify("layer-job-status",{status:d.models.mapLayers.Model.PROGRESS_STATUS.SUCCEEDED,modelId:this.model.getId()});this.updateLayerProgressStatus(d.models.mapLayers.Model.PROGRESS_STATUS.SUCCEEDED)}.bind(this)})}}))})(toa,$);(function(d){var c=d.models.ObservableModel;d.ns("toa.models.userTypes.BaseModel",d.define(c,function(b){c.apply(this,arguments)},{subscribeOnChild:function(b){b.addListener("all",function(){this.notify.apply(this,arguments)},this)},toJSON:function(){var b=c.prototype.toJSON.apply(this,arguments);this.idField in this.attributes||delete b[this.idField];return b}}))})(toa);(function(d){var c=d.models.ObservableCollection;d.ns("toa.models.userTypes.BaseCollection",d.define(c,function(){c.apply(this,arguments)},{modelConstructor:d.models.userTypes.BaseModel,where:function(b,c){var d=[];this.each(function(k,l){k.get(b)===c&&d.push(k)},this);return d},first:function(){return this.models[0]||null},find:function(b,c,d){return this.findBy(function(d){return d.get(b)==c},null,d)},findBy:function(b,c,d){b=this.findIndexBy(b,c,d);return-1<b?this.models[b]:null},findIndexBy:function(b,
c,d){var k=this.models;d=d||0;for(var l=k.length;d<l;d++)if(b.call(c||this,k[d]))return d;return-1},compact:function(){for(var b=this.compactData.apply(this,arguments),c=new this.constructor,d=0,k=b.length;d<k;d++)c.add(b[d],{silent:!0});return c},compactData:function(){var b=[],c=Array.prototype.slice.call(arguments,0);this.each(function(d){d=d.pick(c);b.push(d)});return b}}))})(toa);(function(d){var c=d.models.userTypes.BaseCollection;d.ns("toa.models.userTypes.SortableCollection",d.define(c,function(){c.apply(this,arguments)},{comparator:function(b,c){var d=b.get("status",null),k=c.get("status",null);if("active"===d&&"active"!==k)return-1;if("active"===k&&"active"!==d)return 1;var l=+b.id,n=+c.id;b.get("translation")&&c.get("translation")?(l=b.get("translation"),n=c.get("translation")):b.get("label")&&c.get("label")&&(l=b.get("label"),n=c.get("label"));if(l==n)return 0;if(!l)return-1;
if(!n)return 1;for(var l="string"===typeof l?l.toLowerCase():l,n="string"===typeof n?n.toLowerCase():n,d=/(\.\d+)|(\d+)|(\D+)/g,p=String(l).match(d),s=String(n).match(d),t=Math.min(p.length,s.length),u=0;u<t;u++)if(d=p[u],k=s[u],d!==k)return l=+d,n=+k,isNaN(l)||isNaN(n)?d<k?-1:1:l<n?-1:1;return p.length!=s.length?p.length-s.length:l<n?-1:1}}))})(toa);(function(d){var c=d.models.userTypes.BaseModel;d.ns("toa.models.userTypes.UserType",d.define(c,function(){c.apply(this,arguments)},{idField:"type_id",isRemovable:function(){return 0===this.get("users")}}))})(toa);(function(d){var c=d.models.userTypes.BaseCollection;d.ns("toa.models.userTypes.LayoutParticipants",d.define(c,function(){c.apply(this,arguments)},{modelConstructor:d.models.ObservableModel,getParticipantsList:function(b){var c=[];"undefined"!==typeof b?this.each(function(d){+b!==+d.get("type_id")&&c.push(d.get("translation"))}):c=this.pluck("translation");return c}}))})(toa);(function(d){d.ns("toa.views.userTypes.BaseView",d.define(null,function(c){this.options=c||{};this.model=this.options.model;this.collectionModel=this.options.collectionModel;this._tpl=new d.Template(this.template)},$.extend({},d.mixins.EventEmitter,{template:"",regions:{},events:{},tag:"",render:function(c,b){b||c.empty();var d=$(this.getHtml());this._container=c;this._$el=0<d.length?d:c;c.append(d);this.initEvents();return this},getData:function(){return this.model&&this.model.toJSON()||{}},getHtml:function(){return this._tpl.apply(this.getData())},
initEvents:function(){$.each(this.events,function(c,b){var d=this._$el,g=c.split(" ");if(1!==g.length&&2!==g.length||!g[0].length)throw Error("Incorrect description of event selector ("+c+")");var k=b;"string"===typeof b&&(k=this[b]);if(!k||"function"!==typeof k)throw Error('Incorrect event handler for selector "'+c+'"');2===g.length&&(d=g[1],d=this._$el.find(d).addBack().filter(d));d.on(g[0],k.bind(this))}.bind(this))},showRegion:function(c,b){var d=this.regions[c],g=this._container.find(d).first();
g.length||console.error("Couldn't find \""+c+'" region ("'+d+'")');b.render(g)},hideRegion:function(c,b){b.hideRegion();this.hideRegionHeading(c)},hideRegionHeading:function(c){this._$el.find(this.regionHeading[c]).hide()},hide:function(){this._$el&&this._$el.hide()},show:function(){this._$el&&this._$el.show()},_notifyOnChild:function(c,b){var d=Array.prototype.slice.call(arguments);d[0]=b;d[1]=c;this.notify.apply(this,d)},_subscribeChildView:function(c){c.addListener("all",$.proxy(this._notifyOnChild,
this,c))},destroy:function(){$.isEmptyObject(this._childViews)||($.each(this._childViews,function(c,b){b.destroy.apply(b)}.bind(this)),this._childViews=[]);this.notify("destroy",this)},_destruct:function(){$.isEmptyObject(this._childViews)||($.each(this._childViews,function(b,c){c._destruct.apply(c)}.bind(this)),this._childViews=[]);for(var c in this._events_uids)this.removeListener(parseInt(c));this.template&&(this.template=null);this._tpl&&(this._tpl.destroy(),this._tpl=null);this._$el&&(this._$el.remove(),
this._$el=null);this._container&&(this._container.remove(),this._container=null);try{this.destroy()}catch(b){}}})))})(toa);(function(d){var c=d.views.userTypes.BaseView;d.ns("toa.views.userTypes.BaseForm",d.define(c,function(b){c.apply(this,arguments)},{validate:function(){this.hideErrors();var b=!1;$.each(this.validators,function(c,d){var k=this._container.find(d.selector);$.each(k,function(c,e){var k=this.validateField(e,d.rules);k&&k.length&&(this.showError(e,k),b=!0)}.bind(this))}.bind(this));return!b},validateField:function(b,c){var d="";$.each(c,function(c,e){var n=this[e+"FieldValidate"];if(n)return d=n.apply(this,
[b])}.bind(this));return d},mandatoryFieldValidate:function(b){b=$(b).val();var c="";""===$.trim(b)&&(c=h(15905));return c},showError:function(b,c){var d=$("<div>").addClass("infoError").text(c);$(b).after(d);$(b).parent().parent().addClass("invalid")},hideErrors:function(){this._container.find(".infoError").remove();this._container.find(".invalid").removeClass("invalid")},hideError:function(b){b=b.target;$(b).nextAll(".infoError").remove();$(b).parent().parent().removeClass("invalid")}}))})(toa);(function(d){var c=d.views.userTypes.BaseView;d.ns("toa.views.userTypes.BaseCollectionView",d.define(c,function(b){c.apply(this,arguments);this.collection=this.options.collection;this.model=this.options.model},{template:"",childRegion:"",childView:{},childSeparator:"",render:function(b,d){d||b.empty();this._childViews=[];c.prototype.render.apply(this,arguments);var g=this.getRegionContainer();this._renderCollection(g);this._container=b;return this},getRegionContainer:function(){var b=this.childRegion;
return b?this._container.find(b).first():this._container},_renderCollection:function(b){var c=this.collection.getCount();this.collection.each(function(d,k){var l=new this.childView({model:d,collection:this.collection});this._subscribeChildView(l);this._childViews.push(l);l.render(b,!0);this.childSeparator&&k!==c-1&&b.append(this.childSeparator)},this)},hideRegion:function(){this._container.hide()},applyUpwardHierarchicalPermissions:function(){$.each(this._container.find("div.permission"),function(b,
c){var d=$(c).attr("parent"),d=this._container.find('div.permission[current="'+d+'"]');0<d.length&&!1===d.find(":checkbox").is(":checked")&&$(c).hide()}.bind(this))}}))})(toa);(function(d){var c=d.views.userTypes.BaseView;d.ns("toa.views.userTypes.Container",d.define(c,function(){c.apply(this,arguments)},{template:'<div class="leftPanelContainer"><div class="leftPanel"></div></div><div class="rightPanelContainer"><div class="rightPanel jet-css-only"></div></div>',regions:{leftPanel:".leftPanel",rightPanel:".rightPanel"}}))})(toa);(function(d){var c=d.views.userTypes.BaseForm;d.ns("toa.views.userTypes.UserType",d.define(c,function(){c.apply(this,arguments)},{events:{"change input.typeLabel":"onChangeLabel","change input.typeName":"onChangeName","change select.typeCopyFrom":"onChangeCopyFrom","change input.cbShareDisplay":"onChangeShareDisplay"},validators:[{selector:".required",rules:["mandatory"]},{selector:".typeLabel",rules:["isLabelUnique"]}],onChangeLabel:function(b){b=$(b.target).val();this.model.set({label:b})},onChangeName:function(b){b=
$(b.target).val();this.model.set({name:b})},onChangeCopyFrom:function(b){b=$(b.target).val();var c=0==b,d=this._container.find(".cbShareDisplay"),k=this._container.find(".copyingNotice");c?(k.addClass("toa-hidden"),d.is(":checked")&&(d.prop("checked",!1),this.model.set({is_shared:0})),d.parent().addClass("toa-disabled")):(k.removeClass("toa-hidden"),d.parent().removeClass("toa-disabled"));d.prop("disabled",c);this.model.set({copy_from_id:b})},onChangeShareDisplay:function(b){b=$(b.target).is(":checked");
this.model.set({is_shared:+b})},isLabelUniqueFieldValidate:function(b){b=$(b).val();var c="";this.model.get("typesList").where("label",b).length&&(c=h(16018));return c},template:'<form class="toa-form-horizontal add-user-type"><div class="form-group"><div class="control-group"><label id="lbl_type_label" class="control-label"><abbr class="ofsc-abbr-mandatory asterisk" title="<%= h(22351)/* required */ %>">*</abbr><%= h(1645)/*Label*/ %></label><div class="controls"><input aria-labelledby="lbl_type_label" required type="text" class="typeLabel required" autofocus></div></div><div class="control-group"><label id="lbl_type_name" class="control-label"><abbr class="ofsc-abbr-mandatory asterisk" title="<%= h(22351)/* required */ %>">*</abbr><%= h(68)/*Name*/ %></label><div class="controls"><input aria-labelledby="lbl_type_name" required type="text" class="typeName required" maxlength="255"></div></div></div><div class="form-group"><div class="control-group"><label for="select_type_copy_from" class="control-label"><%= h(16038)/*As copy of*/ %></label><div class="controls"><select id="select_type_copy_from" class="typeCopyFrom"><option value="0" selected="selected"></option><optgroup label="<%= h(16014)/*User Types*/ %>"><% for(i in typesList) { %><option value="<%- typesList[i].type_id %>" <%= (\'undefined\' !== typeof typesList[i].status && \'active\' !== typesList[i].status ) ? \'class="toa-disabled-color"\' : \'\' %>><%- typesList[i].translation %></option><% } %></optgroup></select><br /><label class="cb-control inline toa-disabled"><input type="checkbox" class="cbShareDisplay" disabled="disabled"><%= h(16039)/*Share screen configuration*/ %></label></div></div></div><div class="form-group-last copyingNotice toa-hidden info"><%= h(15915)/* User Type settings will be copied. This may take some time */ %></div></form>'}))})(toa);(function(d){var c=d.views.userTypes.BaseView;d.ns("toa.views.userTypes.FilterableItem",d.define(c,function(b){c.apply(this,arguments)},{events:{"click .listItem":"onItemClick"},template:"<div class=\"listItem<%= ('undefined' !== typeof status && '' !== status && 'active' !== status ) ? ' toa-disabled' : '' %>\"><%- translation %></div>",onItemClick:function(b){this.notify("click:listitem",this)}}))})(toa);(function(d){var c=d.views.userTypes.BaseCollectionView;d.ns("toa.views.userTypes.FilterableView",d.define(c,function(b){c.apply(this,arguments);this.popupTitle=b.popupTitle||h(15028)},{events:{"click .multiselect-tip-button":"onClickSelectButton","keypress .multiselect-tip-button":"onClickSelectButton"},endOfLine:",",childRegion:".selectedLabels",childView:d.views.userTypes.FilterableItem,template:'<div class="sectionItemList <% if (isEmptyItemList) {%>emptySectionItemList<% } %>"><div role="button" aria-label="'+
h(462)+' <%=ariaId%>" data-container_class="<%=containerClass%>" tabindex="0" class="ui-button multiselect-tip-button ui-button-icon-only" title="'+h(462)+'"><span class="ui-icon ui-button-icon-primary ui-icon-modify"></span><span class="ui-button-text">'+h(462)+'</span></div><div class="selectedLabels"></div><div class="clear"></div></div>',getData:function(){var b=c.prototype.getData.apply(this,arguments),d=this.collection.find("assigned",!0);b.isEmptyItemList=!d;b.ariaId=generate_id();b.containerClass=
this.options.containerClass;return b},_renderCollection:function(b){var c=this.collection.where("assigned",!0);$.each(c,function(c,d){var e=new this.childView({model:d,collection:this.collection});this._subscribeChildView(e);this._childViews.push(e);e.render(b,!0)}.bind(this))},applyChanges:function(b){b.each(function(b){var c=b.get("id");b=b.get("assigned");(c=this.collection.find("id",c))&&c.get("assigned")!==b&&(c.set({assigned:b}),this.notify("change:assigned",c,b))}.bind(this));this.render(this._container)},
onClickSelectButton:function(b){if("keypress"!==b.type||13===b.keyCode){var c=this.collection.compact("id","assigned","translation","disabled");b=d.create("toa.views.userTypes.FilterableList",{model:this.model,collection:c});var g=new d.ui.Popup({title:this.popupTitle,width:300,autoOpen:!0,view:b,modal:!0,onClose:function(){g.destroy()},buttons:[{text:h(14621),position:"left",click:function(){g.destroy()}},{text:h(12252),type:"submit",position:"right",click:function(b){$(b.target).removeClass("toa-button-active").addClass("toa-button-disable");
this.applyChanges(c);g.destroy()}.bind(this)}]})}}}))})(toa);(function(d){var c=d.views.userTypes.BaseView;d.ns("toa.views.userTypes.FilterableListItem",d.define(c,function(b){c.apply(this,arguments);this.model.addListener("change",this.onChangeModel,this)},{events:{"change .cbFilterableItem":"onChangeState"},template:'<tr><td class="colCheckbox"><input id="cbFilterableLI-<%- id %>" class="cbFilterableItem" type="checkbox" <% if (\'undefined\' !== typeof disabled && disabled) {%>disabled="disabled"<% } %> <% if (assigned) {%>checked="checked"<% } %>></td><td><label for="cbFilterableLI-<%- id %>" <%= (\'undefined\' !== typeof status && \'\' !== status && \'active\' !== status ) ? \'class="toa-disabled"\' : \'\' %>><%- translation %></label></td></tr>',
onChangeModel:function(b,c){this._$el.find(".cbFilterableItem").prop("checked",c.assigned)},onChangeState:function(b){b=$(b.target).is(":checked");this.notify("list:change",this.model,b)}}))})(toa);(function(d){var c=d.views.userTypes.BaseCollectionView;d.ns("toa.views.userTypes.FilterableList",d.define(c,function(b){this.filterable=!1!==b.filterable;this.filterSelect=b.filterSelect||!1;c.apply(this,arguments);this.addListener("list:change",this.onChangeAssigned,this)},{events:{"keyup .filterableSearchInput":"onTypeSearch","click .filterSelectAll":"onClickSelectAll","click .filterClearAll":"onClickClearAll","click .clearSearchButton":"onClickClearSearch"},childRegion:".checkboxTable tbody",
childView:d.views.userTypes.FilterableListItem,template:'<div class="filterableList"><% if (filterable) { %><div class="filterableSearch"><i class="searchIcon"></i><input aria-label="<%-h(13745)%>" class="filterableSearchInput" autofocus ><i class="clearSearchButton hidden"></i></div><% } %><% if (filterSelect) { %><div class="filterSelectBox"><i class="icon icon-filter"></i><span><%= h(3412)/*Filter*/ %>:</span><a href="#" class="hint_link filterSelectAll"><%= h(12033)/*Select all*/ %></a> - <a href="#" class="hint_link filterClearAll"><%= h(12034)/*Clear all*/ %></a></div><% } %><div class="filterableListSection"><table class="checkboxTable"><tbody></tbody></table></div></div>',
getData:function(){var b=c.prototype.getData.apply(this,arguments);b.filterable=this.filterable;b.filterSelect=this.filterSelect;return b},onChangeAssigned:function(b,c,d,k){var l=d.get("id"),n=d.get("profileId");if(!n)return d.set({assigned:k}),!0;this.collection.each(function(b,c){if(n===b.get("profileId")){var d={silent:l===b.get("id")};b.set({assigned:k},d)}},this)},onTypeSearch:function(b){b=$(b.target).val().toLowerCase();this.filterList(b)},filterList:function(b){var c=this._container.find(".checkboxTable tr"),
d=this._container.find(".clearSearchButton");if(!b)return d.toggleClass("hidden",!0),$.each(c,function(b,c){$(c).toggleClass("hidden",!1)}),!1;d.toggleClass("hidden",!1);$.each(c,function(c,d){var e=$(d),g=-1<e.find("label").text().toLowerCase().indexOf(b);e.toggleClass("hidden",!g)})},onClickSelectAll:function(){this.setItemsEnabled(!0);this.filterHiddenItems();return!1},onClickClearAll:function(){this.setItemsEnabled(!1);this.filterHiddenItems();return!1},setItemsEnabled:function(b){this.collection.each(function(c,
d){c.set({assigned:b});c.set({disabled:!1})})},filterHiddenItems:function(){var b=this._container.find(".checkboxTable tr"),c=this;$.each(b,function(b,d){var l=$(d);if(l.hasClass("hidden")){var n=l.find("input").prop("id").replace("cbFilterable-","");c.collection.each(function(b){b.get("id")===parseInt(n)&&b.set({disabled:!0,assigned:!1})})}})},onClickClearSearch:function(b){this._container.find(".clearSearchButton").toggleClass("hidden",!0);this._container.find(".filterableSearchInput").val("");
this.filterList()}}))})(toa);(function(d){var c=d.views.userTypes.BaseView;d.ns("toa.views.userTypes.FileUploadForm",d.define(c,function(){c.apply(this,arguments)},{events:{"change .import-form-file":"onChangeFileUpload"},template:'<form class="user-types-import-form" action="?controller=usertype&method=validate" method="POST"><div class="import-form-row" id="lbl_fileImport"><div class="import-form-label"><abbr class="import-form-mandatory-field ofsc-abbr-mandatory" title="<%= h(22351)/* required */ %>">*</abbr><%= h(12096)/*Choose file*/ %></div><div class="import-form-pseudo-file"><input aria-labelledby="lbl_fileImport" tabindex="0" type="text" class="import-form-fileText"><input aria-labelledby="lbl_fileImport" tabindex="0" required type="file" name="fileImport" accept="text/xml" size="1" class="import-form-file"><input type="button" class="toa-button" tabindex="0" value="<%= h(12097)/*Browse...*/ %>" ></div><br></div></form>',
onChangeFileUpload:function(b){b=b.target.value.replace(/^.*[\\\/]/,"");if(!b)return!1;var c=this._container.find(".import-form-fileText"),d=b.split(".").pop();c.val(b);this.model.set({fileType:"xml"===d?"text/xml":d,fileName:b});return!1},getFileType:function(){return this.model.get("fileType")},getFileName:function(){return this.model.get("fileName")}}))})(toa);(function(d){var c=d.views.userTypes.BaseView;d.ns("toa.views.userTypes.ImportForm",d.define(c,function(b){c.apply(this,arguments);this.controller=b&&b.controller||"usertype"},{importSessionId:null,isValidationFinished:!1,isImportFinished:!1,requestCounter:0,errorCount:0,_statusXhr:null,render:function(){return!1},show:function(b,c){this.importSessionId=c;this.validateModel=d.create("toa.models.userTypes.BaseModel");this.importModel=d.create("toa.models.userTypes.BaseModel");this.importView=d.create("toa.views.userTypes.ImportView");
this.popup=new d.ui.Popup({title:b||h(15916),autoOpen:!0,view:this.importView,modal:!0,buttons:[{id:"cancel_btn",text:h(14621),position:"right",click:this.closeForm.bind(this)},{id:"validate_btn",text:h(12099),type:"submit",position:"right",display:!1,click:this.runValidationAgain.bind(this)},{id:"import_btn",text:h(13295),type:"submit",position:"right",display:!1,click:this.runImport.bind(this)},{id:"close_btn",text:h(13305),display:!1,click:this.closeForm.bind(this)}],onClose:this.closeForm.bind(this)});
this.popup.setPositionCenter();this.runValidation();return this},saveStatusXhr:function(b){this._statusXhr=b},runValidation:function(){this.requestCounter=0;this.validationInterval=setInterval(this.validationRequest.bind(this),2E3);this.beforeStartValidation();$(this.popup.getDomContent()).addClass("import_popup_validating");return this.validationRequest()},runValidationAgain:function(){this.beforeStartValidation();d.app.trigger("global.data.get",{params:{import_session_id:this.importSessionId},controller:this.controller,
method:"validateAgain",responseHandler:this.runValidation.bind(this),errorHandler:this.errorHandler.bind(this)})},validationRequest:function(){if(this.isValidationFinished)return!1;this.importView.setValidationProgress(this.requestCounter++);if(this._statusXhr&&4!==this._statusXhr.readyState)return!1;d.app.trigger("global.data.get",{params:{import_session_id:this.importSessionId},controller:this.controller,method:"getValidationStatus",requestHandler:this.saveStatusXhr.bind(this),responseHandler:this.validationHandler.bind(this),
errorHandler:this.errorHandler.bind(this)})},beforeStartValidation:function(){this.clearError();this.popup.displayNoneButton("import_btn");this.popup.displayNoneButton("validate_btn")},validationHandler:function(b,c){this._statusXhr=null;if("OK"!==c.status)return this.performHalt(c.error_msg||""),!1;this.clearError();var d=c.validation||{},k="validated"===d.status;this.validateModel.set(d);this.importView.setValidationStatus(this.validateModel,k);this.importView.setValidationLog(this.validateModel);
this.importView.setValidationProgress(this.requestCounter);k&&this.validationComplete(this.validateModel)},validationComplete:function(b){if(this.popup.isDestroyed)return!1;this.finishValidation(!0);$(this.popup.getDomContent()).removeClass("import_popup_validating").addClass("import_popup_validated");b=b.get("progress");"valid"!==b.status&&"warnings"!==b.status||this.popup.displayInlineButton("import_btn");this.importView.setValidationSuccess(this.validateModel);this.notify("validation.finish")},
finishValidation:function(b){this.isValidationFinished=b;this.validationInterval&&(clearInterval(this.validationInterval),this.validationInterval=null);this.importView.clearValidationProgress()},runImport:function(){if(!this.isValidationFinished)return!1;this.beforeStartImport();$(this.popup.getDomContent()).addClass("import_popup_importing");d.app.trigger("global.data.get",{params:{import_session_id:this.importSessionId},controller:this.controller,method:"import",responseHandler:this.afterStartImport.bind(this),
errorHandler:this.errorHandler.bind(this)});return!1},beforeStartImport:function(){this.popup.displayNoneButton("import_btn");this.popup.displayNoneButton("cancel_btn");this.popup.displayInlineButton("close_btn")},afterStartImport:function(){this._statusXhr=null;this.requestCounter=0;this.importInterval=setInterval(this.importRequest.bind(this),2E3);return this.importRequest()},importRequest:function(){if(this.isImportFinished)return!1;this.importView.setImportProgress(this.requestCounter++);if(this._statusXhr&&
4!==this._statusXhr.readyState)return!1;d.app.trigger("global.data.get",{params:{import_session_id:this.importSessionId},controller:this.controller,method:"getImportStatus",requestHandler:this.saveStatusXhr.bind(this),responseHandler:this.importHandler.bind(this),errorHandler:this.errorHandler.bind(this)})},importHandler:function(b,c){if("OK"!==c.status)return this.performHalt(c.error_msg||""),"undefined"!==typeof c.import.status&&"re_validation"===c.import.status&&(this.validateModel.set(c.import),
this.popup.displayInlineButton("validate_btn"),$(this.popup.getDomContent()).removeClass("import_popup_validated import_popup_imported import_popup_halt import_popup_validating import_popup_importing"),this.importView.resetState()),!1;this.clearError();var d=c.import||{},k="imported"===d.status;this.importModel.set(d);this.importView.setImportStatus(this.importModel,k);this.importView.setImportProgress(this.requestCounter);k&&this.importComplete()},importComplete:function(){this.isImportFinished=
!0;this.importInterval&&(clearInterval(this.importInterval),this.importInterval=null);$(this.popup.getDomContent()).removeClass("import_popup_importing").addClass("import_popup_imported");this.importView.clearImportProgress();this.importView.setImportSuccess(this.validateModel,this.importModel);$('li[data-tab-label="display"]').trigger("click");this.notify("import.finish")},clearImportingData:function(){d.app.trigger("global.data.get",{params:{import_session_id:this.importSessionId},controller:this.controller,
method:"clearImportingData",errorHandler:this.errorHandler.bind(this)})},performHalt:function(b){b&&this.setError(b);this.isImportFinished=this.isValidationFinished=!1;this.validationInterval&&(clearInterval(this.validationInterval),this.validationInterval=null);this.importInterval&&(clearInterval(this.importInterval),this.importInterval=null);this.importView.clearValidationProgress();this.importView.clearImportProgress();this.popup.displayNoneButton("close_btn");this.popup.displayInlineButton("cancel_btn");
$(this.popup.getDomContent()).removeClass("import_popup_validating import_popup_importing").addClass("import_popup_halt");return!1},setError:function(b){this.errorCount++;this.showError("statusError",b);10<this.errorCount&&this.validationInterval&&(this.errorCount=0,clearInterval(this.validationInterval));10<this.errorCount&&this.importInterval&&(this.errorCount=0,clearInterval(this.importInterval))},clearError:function(){this.popup.setErrors([])},showError:function(b,c){if(this.popup.isDestroyed)return!1;
this.popup.setErrors([{id:b,message:c||h(5555)}])},errorHandler:function(b,c,d){this._statusXhr=null;this.setError(d)},closeForm:function(){this.validationInterval&&clearInterval(this.validationInterval);this.importInterval&&(clearInterval(this.importInterval),this.notify("import.finish"));this.clearImportingData();this.destroy()},destroy:function(){this.popup.destroy()}}))})(toa);(function(d){var c=d.views.userTypes.BaseView;d.ns("toa.views.userTypes.ImportView",d.define(c,function(){c.apply(this,arguments);this._tplLog=new d.Template(this.templateLog)},{events:{"click .import_log_toggle":"toggleValidationLog"},template:'<div class="import_popup import_user_types"><div class="title_row"><div class="import_count import_title"><span class = "wrap_content_for_progress"><%= h(13295)/*Import*/ %></span><span class="progress_box"></span></div><div class="validation_count validation_title"><span class = "wrap_content_for_progress"><%= h(13296)/*Validation*/ %></span><span class="progress_box"></span></div><div class="item_title"><%= h(18905)/*Results*/ %></div></div><div class="content"><div class="success_row"><div class="import_count"><div class="import_progress"><div class="progressbar-value"></div></div><span>&nbsp;</span></div><div class="validation_count"><div class="validation_progress"><div class="progressbar-value"></div></div><span>&nbsp;</span></div><div class="item_title"><%= h(13297)/*Successfully imported*/ %></div></div><div class="warnings_row"><div class="import_count"><span>&nbsp;</span></div><div class="validation_count"><span>&nbsp;</span></div><div class="item_title"><%= h(13298)/*Imported with warnings*/ %></div></div><div class="not_imported_row"><div class="import_count"><span>&nbsp;</span></div><div class="validation_count"><span>&nbsp;</span></div><div class="item_title"><%= h(13299)/*Not imported*/ %></div></div><div class="import_log_section"><div class="import_log_header"><a class="import_log_toggle"><%= h(18906)/*Validation Details*/ %></a></div><div class="import_log_container"><div class="import_log"></div></div></div></div></div>',
templateLog:'<table class="import_log_table">   <% for (var section in log) { %>     <% for (var key in log[section]) { var sublog = log[section][key]; if (!sublog["@stt"]) continue; %>     <tr class="iLog_section iLog_<%- sublog["@stt"] %>">         <th class="iLog_title" colspan="4"><%= sublog["@key"] %><span class="iLog_status"><%= sublog["@stm"] %></span></th>     </tr>         <% for (var i in sublog["@msg"]) { var msg = sublog["@msg"][i]; if (!msg.lvl) continue; msg.msg = msg.msg.replace(/&quot;/g, \'"\'); %>         <tr class="iLog_msg iLog_<%- msg.lvl %>">             <td class="iLog_msg_content"><%- msg.msg %> <small><%- msg.act %></small></td>             <td class="iLog_line_title"><%= msg.row ? h(18907)/* Line */ : "" %></td>             <td class="iLog_line"><%= msg.row ? msg.row : "" %></td>         </tr>           <% } %>       <% } %>   <% } %></table>',
render:function(){c.prototype.render.apply(this,arguments);this.afterRender();return this},afterRender:function(){var b=this._container;this.validationSuccess=b.find(".success_row .validation_count span");this.validationWarning=b.find(".warnings_row .validation_count span");this.validationError=b.find(".not_imported_row .validation_count span");this.validationLogContainer=b.find(".import_log");this.validationProgress=b.find(".validation_progress .progressbar-value");this.importSuccess=b.find(".success_row .import_count span");
this.importWarning=b.find(".warnings_row .import_count span");this.importError=b.find(".not_imported_row .import_count span");this.ErrorRow=b.find(".not_imported_row");this.importProgress=b.find(".import_progress .progressbar-value")},setValidationStatus:function(b,c){var d=b.get("progress")||{};0<parseInt(d.total)&&(d=100*parseInt(d.progress)/parseInt(d.total),this.validationProgress.css("width",(2<d?d:2)+"%"),this.validationProgress.find("span").text(d.toFixed(0)+"%"));c&&this.validationProgress.css("width",
"100%")},setValidationLog:function(b){b=b.get("log")||[];this.validationLogContainer.empty().html(this._tplLog.apply({log:b}));jQuery.isEmptyObject(b)||this.showValidationLog()},setValidationSuccess:function(b){b=b.get("progress")||{};"undefined"!==typeof b.user_types&&(this.validationSuccess.empty().html(b.user_types.valid||"&nbsp;"),this.validationWarning.empty().html(b.user_types.warnings||"&nbsp;"),this.validationError.empty().html(b.user_types.invalid||"&nbsp;"),this.ErrorRow.toggleClass("red_warning",
0<b.user_types.invalid))},setImportStatus:function(b,c){var d=b.get("progress")||{};0<parseInt(d.total)&&(d=100*parseInt(d.progress)/parseInt(d.total),this.importProgress.css("width",(2<d?d:2)+"%"),this.importProgress.find("span").text(d.toFixed(0)+"%"));c&&this.importProgress.css("width","100%")},setImportSuccess:function(b,c){var d={valid:0,warnings:0,invalid:0},k=$.extend({},d,b.get("progress").user_types||{}),d=$.extend({},d,c.get("progress").user_types||{});this.importSuccess.empty().html(d.valid||
"&nbsp;");this.importWarning.empty().html(d.warnings||"&nbsp;");k.valid+k.warnings==d.valid+d.warnings?(d.valid&&this.importSuccess.parent().addClass("success"),d.warnings&&this.importWarning.parent().addClass("success")):(this.importSuccess.empty().html(d.valid||"&nbsp;").addClass("error"),this.importWarning.empty().html(d.warnings||"&nbsp;").addClass("error"))},clearValidationProgress:function(){this._container.find(".validation_title .progress_box").text("");this.validationProgress.css("width",
"100%")},setValidationProgress:function(b){b=b%3||3;this._container.find(".validation_title .progress_box").empty().text(Array(b+1).join("."))},clearImportProgress:function(){this._container.find(".import_title .progress_box").empty()},setImportProgress:function(b){b=b%3||3;this._container.find(".import_title .progress_box").empty().text(Array(b+1).join("."))},resetState:function(){var b=this._container;this.hideValidationLog();this.validationLogContainer.empty();b.find(".validation_count:not(.validation_title) span, .import_count:not(.import_title) span").empty().html("&nbsp;");
b.find(".progress_box").empty();b.find(".progressbar-value").empty().css("width","2%");b.find(".not_imported_row.red_warning").removeClass("red_warning")},showValidationLog:function(){this.validationLogContainer.closest(".import_log_section").addClass("opened")},hideValidationLog:function(){this.validationLogContainer.closest(".import_log_section").removeClass("opened")},toggleValidationLog:function(b){$(b.target).closest(".import_log_section").toggleClass("opened")}}))})(toa);(function(d){var c=d.views.userTypes.BaseView;d.ns("toa.views.userTypes.ImportUploadForm",d.define(c,function(b){c.apply(this,arguments)},{render:function(){return!1},show:function(){this.fileUploadForm=d.create("toa.views.userTypes.FileUploadForm",{model:new d.models.userTypes.BaseModel});this.popup=new d.ui.Popup({title:h(15916),height:150,autoOpen:!0,view:this.fileUploadForm,modal:!0,buttons:[{text:h(14621),position:"right",click:this.closeForm.bind(this)},{id:"validate_btn",text:h(12099),type:"submit",
position:"right",click:this.submitUploadForm.bind(this)}],onClose:this.closeForm.bind(this)});this.popup.setPositionCenter();$(window).bind("keydown.import",this.onKeydown.bind(this));return this},submitUploadForm:function(){this.setPopupButtonDisabled("validate_btn",!0,!0);if(this.validateForm()){var b=0;"undefined"!==typeof $.ajaxSettings.timeout&&(b=$.ajaxSettings.timeout);$.ajaxSettings.timeout=0;ajaxForm($(this.popup.getDomContent()).find("form.user-types-import-form")[0],{responseHandler:function(c){$.ajaxSettings.timeout=
b;if(c&&c.import_session_id){var d=this.fileUploadForm.model;d.set({importSessionId:c.import_session_id});c.file_name&&d.set("fileName",c.file_name);this.notify("import.validate",this,d)}else this.setErrorMessages([c.error_msg||h(5555)]),this.setPopupButtonDisabled("validate_btn",!1,!0)}.bind(this),errorHandler:function(){$.ajaxSettings.timeout=b;this.setErrorMessages([h(5555)]);this.setPopupButtonDisabled("validate_btn",!1,!0)}.bind(this)});return!1}this.setPopupButtonDisabled("validate_btn",!1,
!0)},setPopupButtonDisabled:function(b,c,d){if(b=this.popup._dom.buttons[b])$(b).toggleClass("toa-button-disable",c),d&&c?$(b).removeClass("toa-button-active"):d&&!c&&$(b).addClass("toa-button-active")},validateForm:function(){var b=[];this.fileUploadForm.getFileName()?"text/xml"!=this.fileUploadForm.getFileType()&&b.push(h(11994)):b.push(h(12100));this.setErrorMessages(b);return 0==b.length},setErrorMessages:function(b){if(1>b.length)return this.popup.removeErrors(),!1;for(var c=0,d=[];c<b.length;c++)d.push({id:c+
1,message:b[c]});this.popup.setErrors(d)},onKeydown:function(b){13==b.keyCode&&this.submitUploadForm()},closeForm:function(){this.destroy()},destroy:function(){$(window).unbind("keydown.import");this.popup.destroy()}}))})(toa);(function(d){var c=d.views.userTypes.FilterableList;d.ns("toa.views.userTypes.FilterableExportList",d.define(c,function(b){c.apply(this,arguments)},{onChangeAssigned:function(b,c,d,k){var l=d.get("id"),n=d.get("profileId");this.collection.each(function(b,c){if(n===b.get("profileId")){var d={silent:l===b.get("id")};b.set({assigned:k},d)}},this)}}))})(toa);(function(d){var c=d.views.userTypes.BaseView;d.ns("toa.views.userTypes.generalTab.LoginPolicy",d.define(c,function(){c.apply(this,arguments)},{template:'<option value="<%- id %>" <%- (assigned ? "selected" : "") %>><%- translation %></option>'}))})(toa);(function(d){var c=d.views.userTypes.BaseCollectionView;d.ns("toa.views.userTypes.generalTab.LoginPolicies",d.define(c,function(){c.apply(this,arguments)},{events:{change:"changePolicy"},template:'<select class="infoValueDropdown" id="typePolicy"></select>',childView:d.views.userTypes.generalTab.LoginPolicy,childRegion:"#typePolicy",changePolicy:function(b){var c=$(b.target).val();this.collection.each(function(b){b.set({assigned:b.id===c})})}}))})(toa);(function(d){var c=d.views.userTypes.BaseView;d.ns("toa.views.userTypes.generalTab.Application",d.define(c,function(){c.apply(this,arguments)},{template:'<option value="<%- id %>" <%- (assigned ? "selected" : "") %>><%- translation %></option>'}))})(toa);(function(d){var c=d.views.userTypes.BaseCollectionView;d.ns("toa.views.userTypes.generalTab.Applications",d.define(c,function(){c.apply(this,arguments)},{events:{change:"changeApplication"},template:'<select class="infoValueDropdown" id="applicationsSelect"></select>',childView:d.views.userTypes.generalTab.Application,childRegion:"#applicationsSelect",changeApplication:function(b){var c=$(b.target).val();this.notify("userTypes.generalTab.select.application",{application_id:c},this);this.collection.each(function(b){b.set({assigned:b.id===
c})})}}))})(toa);(function(d){var c=d.views.userTypes.BaseCollectionView;d.ns("toa.views.userTypes.generalTab.ManagedTypes",d.define(c,function(){c.apply(this,arguments);this.popupTitle=h(16029)},{childRegion:".filterableView",childView:d.views.userTypes.FilterableView,template:'<div class="filterableView"></div>',_renderCollection:function(b){var c=new this.childView({popupTitle:this.popupTitle,collection:this.collection,containerClass:this._container.attr("class")});this._subscribeChildView(c);this._childViews.push(c);
c.render(b,!0)},assignType:function(b,c){var d=this.collection.find("id",b);d&&(d.set({assigned:c}),this.render(this._container))}}))})(toa);(function(d){var c=d.views.userTypes.BaseView;d.ns("toa.views.userTypes.generalTab.Permission",d.define(c,function(){c.apply(this,arguments)},{events:{"change .permissionCheckbox":"permissionChanged"},template:'<div class="permission<%- (parent ? "Secondary" : "") %>  permission-label-<%- label %>"><label class="checkboxLabel"><input type="checkbox" class="permissionCheckbox" <%- (assigned ? "checked" : "") %>><%- (translation || label || "") %></label></div>',permissionChanged:function(b){b=$(b.target);
this.applyHierarhicalPermissions(b);this.notify("permission:changed",this.model,b.is(":checked"))},getParentPermissionElement:function(b){return b.parents("div.permissionSecondary").first().prevAll(".permission").first().find(":checkbox")},getChildPermissionsElements:function(b){return b.parents("div.permission").first().nextUntil(".permission").find(":checkbox")},applyHierarhicalPermissions:function(b){var c=this.getParentPermissionElement(b),d=this.getChildPermissionsElements(b);c&&b.is(":checked")&&
!c.is(":checked")&&(c.prop({checked:!0}),this.notify("permission:changed",this.model,!0,!0));d&&$.each(d,function(c,d){b.is(":checked")!==$(d).is(":checked")&&d.click();b.is(":checked")?$(d).closest("div").show():$(d).closest("div").hide()}.bind(this))}}))})(toa);(function(d){var c=d.views.userTypes.BaseView;d.ns("toa.views.userTypes.generalTab.CollaborationPermission",d.define(c,function(){c.apply(this,arguments)},{events:{"change .permissionCheckbox":"permissionChanged"},template:'<div class="permission" parent="<%- parent %>" current="<%- label %>"><label class="checkboxLabel"><input type="checkbox" class="permissionCheckbox" <%- (assigned ? "checked" : "") %>><%- (translation || label || "") %></label></div>',permissionChanged:function(b){b=$(b.target);
this.applyDownardHierarchicalPermissions(b);this.notify("permission:changed",this.model,b.is(":checked"))},getChildPermissionsElements:function(b,c,d){var k=this,l=$(b).parents("div.permission").first().attr("current");b=$(b).parents("div.permission").first().nextUntil("[parent!='"+l+"']");$.each(b,function(b,l){c.push(l);!0===d&&(c=k.getChildPermissionsElements($(l).find(":checkbox"),c,d))});return c},applyDownardHierarchicalPermissions:function(b){var c=!0;b.is(":checked")&&(c=!1);(c=this.getChildPermissionsElements(b,
[],c))&&$.each(c,function(c,d){$(d).find(":checkbox").is(":checked")&&$(d).find(":checkbox").click();b.is(":checked")?$(d).show():$(d).hide()}.bind(this))}}))})(toa);(function(d){var c=d.views.userTypes.BaseCollectionView;d.ns("toa.views.userTypes.generalTab.Permissions",d.define(c,function(){c.apply(this,arguments)},{template:"",childView:d.views.userTypes.generalTab.Permission,_renderCollection:function(b){$.each(this.collection.where("parent",""),function(c,d){var k=new this.childView({model:d});this._subscribeChildView(k);this._childViews.push(k);k.render(b,!0);$.each(this.collection.where("parent",d.get("label")),function(c,e){var k=new this.childView({model:e});
this._subscribeChildView(k);this._childViews.push(k);k.render(b,!0);!1===d.get("assigned")&&k.hide()}.bind(this))}.bind(this))}}))})(toa);(function(d){var c=d.views.userTypes.BaseCollectionView;d.ns("toa.views.userTypes.generalTab.PermissionCollectionView",d.define(c,function(){c.apply(this,arguments)},{template:"",childView:d.views.userTypes.generalTab.Permission}))})(toa);(function(d){var c=d.views.userTypes.BaseCollectionView;d.ns("toa.views.userTypes.generalTab.ActivityPermissionCollectionView",d.define(c,function(){c.apply(this,arguments)},{template:"",childView:d.views.userTypes.generalTab.Permission,render:function(b,d){this.collection.models.sort(function(b,c){return b.attributes.label===c.attributes.label?0:"visual_assignment_assistant"===b.attributes.label?"allow_move_from_non_scheduled_to_scheduled"===c.attributes.label?0:-1:c.attributes.label>b.attributes.label?
-1:1});c.prototype.render.apply(this,arguments)}}))})(toa);(function(d){var c=d.views.userTypes.BaseCollectionView;d.ns("toa.views.userTypes.generalTab.CollaborationPermissionCollectionView",d.define(c,function(){c.apply(this,arguments)},{template:"",childView:d.views.userTypes.generalTab.CollaborationPermission,applyHierarchicalPermissions:function(){this.applyUpwardHierarchicalPermissions()}}))})(toa);(function(d){var c=d.views.userTypes.BaseForm;d.ns("toa.views.userTypes.GeneralTab",d.define(c,function(b){c.apply(this,arguments)},{regions:{loginPolicies:".loginPoliciesRegion",managedTypes:".managedTypesRegion",managedByTypes:".managedByTypesRegion",access:".accessRegion",permissions:".permissionsRegion",collaboration:".collaborationRegion",activity:".activityRegion",resource:".resourceRegion"},regionFields:{loginPolicies:"login_policy_id",applications:"applications",managedTypes:"managed_user_types",
managedByTypes:"managed_by_user_types",access:"interface_permissions",permissions:"feature_permissions",collaboration:"collaboration_permissions",activity:"activity_permissions",resource:"resource_permissions"},regionViews:{loginPolicies:d.views.userTypes.generalTab.LoginPolicies,applications:d.views.userTypes.generalTab.Applications,managedTypes:d.views.userTypes.generalTab.ManagedTypes,managedByTypes:d.views.userTypes.generalTab.ManagedTypes,access:d.views.userTypes.generalTab.PermissionCollectionView,
permissions:d.views.userTypes.generalTab.Permissions,collaboration:d.views.userTypes.generalTab.CollaborationPermissionCollectionView,activity:d.views.userTypes.generalTab.ActivityPermissionCollectionView,resource:d.views.userTypes.generalTab.PermissionCollectionView},regionHeading:{collaboration:".collaborationRegionHeading"},events:{"change #typeLabel":"changeLabel","change #typeName":"changeName","change #typeActive":"changeStatus","focus input.require":"hideError","change #applications":"changeApplications"},
validators:[{selector:".require",rules:["mandatory"]},{selector:"#typeLabel",rules:["isLabelUnique"]}],changeLabel:function(b){b=$(b.target).val();this.model.set({label:b})},changeName:function(b){b=$(b.target).val();this.model.set({translation:b})},changeStatus:function(b){this.model.set({status:$(b.target).is(":checked")?"active":"inactive"})},changeAssigned:function(b,c,d,k,l){(b=c._container.hasClass("managedTypesRegion")?"managedByTypes":null)||(b=c._container.hasClass("managedByTypesRegion")?
"managedTypes":null);k&&b&&(c=k.get("id"),c===this.model.get("type_id")&&(k=this._childViews[b]||null)&&k.assignType&&k.assignType(c,l))},changeApplications:function(b){this.displayApplication($(b.target).is(":checked"))},isLabelUniqueFieldValidate:function(b){var c=$(b).val();b="";c=this.model.get("managed_user_types").where("label",c);c.length&&c[0].id!=this.model.get("type_id")&&(b=h(16018));return b},selectApplications:function(b,c,d){this.model.set({application_id:d.application_id})},displayApplication:function(b){var c;
c=this._container.find(".applicationsSection");if(!0==b){if(c.removeClass("toa-hidden"),b=this._container.find("#applicationsSelect"))b=$(b).val(),this.model.set({application_id:b})}else c.addClass("toa-hidden"),this.model.set({application_id:0})},render:function(b){this._childViews={};c.prototype.render.apply(this,arguments);$.each(this.regions,function(b){var c=new this.regionViews[b]({collection:this.model.get(this.regionFields[b])});this._subscribeChildView(c);this._childViews[b]=c;"activity"!=
b&&"collaboration"!==b||c.collection.models.sort(function(b,c){return b.attributes.label===c.attributes.label?0:c.attributes.label>b.attributes.label?-1:1});this.showRegion(b,c);"collaboration"===b&&(0===c.collection.models.length?this.hideRegion(b,c):c.applyHierarchicalPermissions())}.bind(this));this._container=b;this.addListener("userTypes.generalTab.select.application",this.selectApplications,this);this.addListener("change:assigned",this.changeAssigned,this);return this},template:'<div class="generalSettingsLeft"><h1 class="settingsSection"><%= h(16035)/*User type info*/ %></h1><table role="none" class="generalInfo" aria-label="<%= h(16035)/*User type info*/ %>"><tr><td class="infoMandatory" id="lbl_typeLabel_required"><abbr class="ofsc-abbr-mandatory" title="<%= h(22351)/* required */ %>">*</abbr></td><td class="infoLabel" id="lbl_typeLabel" ><%= h(1645)/* Label */ %></td><td class="infoValue"><input required type="text" aria-labelledby="lbl_typeLabel_required lbl_typeLabel" class="infoValueText require" value="<%- (label || \'\') %>" id="typeLabel"></td></tr><tr><td class="infoMandatory" id="lbl_typeName_required"><abbr class="ofsc-abbr-mandatory" title="<%= h(22351)/* required */ %>">*</abbr></td><td class="infoLabel" id="lbl_typeName"><%= h(68)/* Name */ %></td><td class="infoValue"><input required type="text" aria-labelledby="lbl_typeName_required lbl_typeName" class="infoValueText require" value="<%- (translation || \'\') %>" id="typeName"></td></tr><tr><td class="infoMandatory"></td><td class="infoLabel"><label for="typeActive"><%= h(13250)/* Active */ %></label></td><td class="infoValue"><input type="checkbox" class="infoValueCheckbox" id="typeActive" <%- ("active" === status ? "checked" : "") %>></td></tr><tr><td class="infoMandatory"></td><td class="infoLabel"><label for="typePolicy"><%= h(7360)/* Login policy */ %></label></td><td class="infoValue loginPoliciesRegion"></td></tr></table><h1 class="settingsSection"><%= h(16030)/*Can create users of the following user types*/ %></h1><div class="managedTypesRegion"></div><h1 class="settingsSection"><%= h(16031)/*Can be created by users of the following user types*/ %></h1><div class="managedByTypesRegion"></div></div><div class="generalSettingsRight"><h1 class="settingsSection"><%= h(16033)/*Access settings*/ %></h1><div class="permissionsContainer accessRegion"></div><% if (true && legacy_api_access) { %><div><label class="checkboxLabel allowApplication"><input type="checkbox" id="applications" <%- (application_id > 0 ? "checked" : "") %> /><%-h(21164)%></label></div><table class="applicationsSection <%- (application_id > 0 ? "" : "toa-hidden") %>"><tr><td width="60%"><label for="applicationsSelect"><%-h(21165)%></label></td><td class="permissionsContainer applicationsRegion"></td></tr></table><% } %><h1 class="settingsSection"><%= h(16036)/*Permissions*/ %></h1><div class="permissionsContainer permissionsRegion"></div><h1 class="settingsSection collaborationRegionHeading"><%= h(16023)/*Collaboration*/ %></h1><div class="permissionsContainer collaborationRegion"></div><h1 class="settingsSection"><%= h(16034)/*Activity Management*/ %></h1><div class="permissionsContainer activityRegion"></div><h1 class="settingsSection"><%= h(16043)/*Resource Management*/ %></h1><div class="permissionsContainer resourceRegion"></div></div>'}))})(toa);(function(d){var c=d.views.userTypes.BaseView;d.ns("toa.views.userTypes.DisplayTab",d.define(c,function(b){c.apply(this,arguments)},{_childViews:[],events:{"click .settingsSection":"onSectionClick","keydown .settingsSection":"onSectionClick"},regions:{config:{modelField:"shared_with",selector:".configLayouts",view:"toa.views.userTypes.SharedDisplay",disabled:!0},mobility:{modelField:"mobility",selector:"#mobilityLayouts",view:"toa.views.userTypes.displayTab.ContextDependency",disabled:!0},general:{modelField:"general",
selector:"#generalLayouts",view:"toa.views.userTypes.displayTab.ContextDependency",disabled:!1}},render:function(b){c.prototype.render.apply(this,arguments);this.renderRegion();this.afterRender();return this},renderRegion:function(){$.each(this.regions,function(b,c){if(!this.model.get(c.modelField))return!0;var g=d.create(c.view,{collection:this.model.get(c.modelField)}),k=this._container.find(c.selector).first();g.render(k);this._subscribeChildView(g);this._childViews.push(g);"mobility"!==c.modelField&&
c.disabled&&this.disableSection(c.modelField)}.bind(this))},afterRender:function(){this.setActiveItem()},onSectionClick:function(b){if("undefined"!==typeof b.keyCode){if(13!==b.keyCode)return;b.stopPropagation()}b=$(b.target);if(!b.hasClass("disabled")){this._container.find(".section").removeClass("selected");var c=b.next();if(c.is(":visible"))return c.slideUp(0),!1;this._container.find(".apiSectionContainer").slideUp(0);var d=b.data("section-id");c.slideDown(0,function(){this.setActiveItem(d)}.bind(this));
this.notify("section:selected",this,d)}},setActiveItem:function(b){var c=this.regions.mobility;b=b?b:c.modelField;this._container.find(".layoutsContainer").hide();this._container.find("#displaySection_"+b).show();this._container.find(".section").removeClass("selected");this._container.find(".section[data-section-id="+b+"]").addClass("selected")},disableSection:function(b){this._container.find(".settingsSection[data-section-id="+b+"]").addClass("disabled")},template:'<div class="configLayouts"></div><div class="usertype-display-tab" role="tablist"><div class="section" data-section-id="mobility" role="tab"><h1 class="settingsSection display" role="button" tabindex="0" data-section-id="mobility"><%= h(3278)/*Mobility*/ %></h1><div id="displaySection_mobility" class="layoutsContainer mobility" role="tabpanel"><div class="layoutsInnerContainer"><div id="mobilityLayouts" class="contextLayoutsCanvas mobility"> </div></div></div></div><div class="section" data-section-id="general" role="tab"><h1 class="settingsSection display" role="button" tabindex="0" data-section-id="general"><%= h(16065)/*Collaboration and Identifiers*/ %></h1><div id="displaySection_general" class="layoutsContainer general" role="tabpanel"><div class="layoutsInnerContainer"><div id="generalLayouts" class="contextLayoutsCanvas general"> </div></div></div></div>'}))})(toa);(function(d){var c=d.views.userTypes.BaseView;d.ns("toa.views.userTypes.FilterTab",d.define(c,function(b){c.apply(this,arguments)},{_childViews:[],regions:[{fieldType:"model",fieldKey:"shared_with",selector:".fieldsSharedContainer",view:"toa.views.userTypes.filterTab.FieldSharedDisplay"},{fieldType:"model",fieldKey:"fieldrestrictions",selector:".fieldsRegion",view:"toa.views.userTypes.filterTab.FieldRestrictions"},{fieldType:"collection",fieldKey:"filters",selector:".filtersRegion",view:"toa.views.userTypes.filterTab.FilterVisiblity"}],
render:function(b){c.prototype.render.apply(this,arguments);this.renderRegion();return this},renderRegion:function(){$.each(this.regions,function(b,c){var g={};g[c.fieldType]=this.model.get(c.fieldKey);var g=d.create(c.view,g),k=this._container.find(c.selector).first();g.render(k);this._subscribeChildView(g);this._childViews.push(g)}.bind(this))},template:'<div class="filtersSettingsContainer"><h1 class="settingsSection"><%= r(16026) %></h1><div class="fieldsRegion"></div><div class="fieldsSharedContainer"></div><h1 class="settingsSection"><%= r(16027) %></h1><div class="filtersRegion"></div></div>'}))})(toa);(function(d){var c=d.views.userTypes.BaseView;d.ns("toa.views.userTypes.displayTab.ContextDependency",d.define(c,function(){c.apply(this,arguments);this.collection=this.options.collection;this.collection.models=this.removePrintFromActivityGrid(this.collection.models);this.plumb_instance=jsPlumb.getInstance({DragOptions:{cursor:"pointer",zIndex:2E3},HoverClass:"connector-hover"});this.addListener("destroy",this.destroyConnections.bind(this))},{plumb_instance:null,padLeft:1,padTop:0.5,intervalRatio:1.5,
blockElementMaxWidth:16,blockElementMaxHeight:3,clickOnContext:0,events:{"click .context":"onContextLayoutClick","keypress .context":"onContextLayoutClick","click .contextLayout":"onContextLayoutClick","keypress .contextLayout":"onContextLayoutClick"},removePrintFromActivityGrid:function(b){for(var c=0;c<b.length;c++)"mobile_print_activity_grid"===b[c].attributes.label&&b.splice(c,1);return b},render:function(b){var c={anchors:["Right","Left"],paintStyle:{lineWidth:1,strokeStyle:"#2070bb",outlineColor:"rgba(0,0,0,0)",
outlineWidth:6,joinstyle:"round"},hoverPaintStyle:{strokeStyle:"#f00",lineWidth:3},detachable:!1,endpointsOnTop:!0,endpoint:"Dot",overlays:[["PlainArrow",{location:1,width:10,length:15}]],labelStyle:{cssClass:"screenLabel"}},d=document.createDocumentFragment(),k={},l;this.collection.each(function(b){var c=b.get("label"),e=document.createElement("div"),l=b.get("layout_id")?"contextLayout":"context";e.setAttribute("role","link");e.setAttribute("tabindex","0");+b.get("context_id")||(l="emptyLayout");
-1!==$.inArray(c,["web_level_activities","web_level_users","web_level_inventories","mobile_level_activities"])&&(l+=" notClickable");-1!==$.inArray(c,["mobile_dashboard"])&&(l+=" hiddenLayout");e.className=l+" _jsPlumb_endpoint_anchor_";e.id="context_"+c;e.setAttribute("data-context-id",b.get("context_id"));e.innerHTML=b.get("translation");c=parseFloat(b.get("position_x"));b=parseFloat(b.get("position_y"));c=this.padLeft+c;e.style.left=c+"em";e.style.top=this.padTop+b+"em";e.style.maxWidth=this.blockElementMaxWidth+
"em";e.style.maxHeight=this.blockElementMaxHeight+"em";d.appendChild(e);"undefined"===typeof k["left_"+c]&&(k["left_"+c]=[]);k["left_"+c].push(e)},this);b.append(d);l=this.updateContextElementsIntervalRatio(k);b.width(l.width+this.blockElementMaxWidth+"em");b.height(l.height+this.padTop+this.blockElementMaxHeight+"em");this.collection.each(function(b){var d=b.get("parents");if(d&&d.getCount()){var g=b.get("label");d.each(function(b){var d=b.get("side_from",null),k=b.get("side_to",null);c.connector=
["Flowchart",{stub:30,cornerRadius:10}];c.anchors=d&&k?[this.ucFirst(d),this.ucFirst(k)]:null;"bottomLeft"==d&&"topLeft"==k&&(c.anchors=[[0,1,0,1,10,0],[0,0,0,-1,10,0]]);"topLeft"==d&&"bottomLeft"==k&&(c.anchors=[[0,0,0,-1,10,0],[0,1,0,1,10,0]]);"mobile_activity_grid"==g&&"mobile_provider_hint"==b.get("label")&&(c.anchors=["BottomCenter",[0,0,0,-1,32.5,0]]);c.anchor="Continuous";c.source="context_"+b.get("label");c.target="context_"+g;this.plumb_instance.connect(c)},this)}},this);this._$el=b;this.initEvents()},
_destruct:function(){this.destroyConnections();c.prototype._destruct.apply()},onContextLayoutClick:function(b){"keypress"===b.type&&13!==b.keyCode||$(b.target).hasClass("notClickable")||(b=$(b.target).data("context-id"),b=this.collection.find("context_id",b),this.notifyClick(b))},notifyClick:function(b){this.clickOnContext++;if(2<=this.clickOnContext)return this.clickOnContext=0,!1;this.notify("context:clicked",b)},ucFirst:function(b){return b.charAt(0).toUpperCase()+b.slice(1)},destroyConnections:function(){var b=
this;b._$el&&b.plumb_instance&&(b._$el.children("div").each(function(){b.plumb_instance.remove(this)}),b.plumb_instance.reset(),b.plumb_instance=null);return!1},updateContextElementsIntervalRatio:function(b){var c,d,k,l,n={width:0,height:0,updateSize:function(b){var c=parseFloat(b.style.top);b=parseFloat(b.style.left);this.width=b>this.width?b:this.width;this.height=c>this.height?c:this.height}};for(d in b)if(2>b[d].length)0<b[d].length&&n.updateSize(b[d][0]);else for(b[d].sort(function(b,c){return parseFloat(b.style.top)-
parseFloat(c.style.top)}),c=1;c<b[d].length;c++)k=c/this.intervalRatio,l=b[d][c],l.style.top=parseFloat(l.style.top)+k+"em",n.updateSize(b[d][c]);return n}}))})(toa);(function(d){var c=d.views.userTypes.BaseView;d.ns("toa.views.userTypes.ConfigDisplayToolBar",d.define(c,function(){c.apply(this,arguments)},{events:{"click .btnSaveSettings":"onClickSave","click .btnCancelSettings":"onClickCancel"},template:'<table class="footerTable"><tr><td><button type="button" class="toa-button btnCancelSettings"><%= h(14621) /*Cancel*/ %></button></td><td width="100%"></td><td><button type="button" class="toa-button pullRight btnSaveSettings"><%= h(12) /*Save*/ %></button></td></tr></table>',
onClickCancel:function(b){this.notify("action:cancel",this)},onClickSave:function(b){this.notify("action:save",this)}}))})(toa);(function(d){var c=d.views.userTypes.BaseCollectionView;d.ns("toa.views.userTypes.ConfigSharedDisplay",d.define(c,function(b){c.apply(this,arguments);this.addListener("share:update",this.onShareUpdate,this)},{events:{"change .sourceTypes":"onChangeSource","change .radioAction":"onChageAction","click .submitAction":"onSubmitAction","click .cancelAction":"onCancelAction"},childView:d.views.userTypes.generalTab.LoginPolicy,childRegion:".sourceTypes",template:'<div class="configSharedDisplay"><h1><%= h(16062) /*Screen configuration*/ %>:</h1><div class="control-group"><label class="checkbox"><input class="radioAction" type="radio" name="displayOption" value="share" <% if (action == \'share\') { %>checked="checked"<% } %> /><span id="lbl_radio_action_share"><%= h(16054) /*Use Screen configuration of*/ %></span></label><select class="sourceTypes" aria-labelledby="lbl_radio_action_share"></select></div><div class="control-group"><label class="checkbox"><input class="radioAction" type="radio" name="displayOption" value="copy" <% if (action == \'copy\') { %>checked="checked"<% } %> /><span id="lbl_radio_action_copy"><%= h(16055) /*Create Screen configuration as copy of*/ %></span></label><select class="sourceTypes" aria-labelledby="lbl_radio_action_copy"></select></div><div class="control-group"><label class="checkbox"><input class="radioAction" type="radio" name="displayOption" value="new" <% if (action == \'new\') { %>checked="checked"<% } %> /><span><%= h(16056) /*Create empty Screen configuration*/ %></span></label></div><div class="actions"><button class="toa-button popup-button-standard cancelAction" style="display: inline;"><%= h(14621)/*Cancel*/ %></button><button class="toa-button popup-button-submit toa-button-active submitAction" style="display: inline;margin-left:10px;"><%= h(15041)/*Apply*/ %></button></div><div class="notification"></div></div>',
render:function(b,d){c.prototype.render.apply(this,arguments);this.afterRender();return this},afterRender:function(){var b=this._container.find("input.radioAction:checked");0===b.length&&(b=this._container.find("input.radioAction").first());b.prop("checked",!0).trigger("change");var c=this.model.get("shared_with");c&&1===c.length&&$.each(this._container.find(".sourceTypes option"),function(b,d){$(d).text()===c[0]&&$(d).attr("selected","selected")}.bind(this))},getRegionContainer:function(){var b=
this.childRegion;return b?this._container.find(b):this._container},onChangeSource:function(b){b=$(b.target);var c=b.parent().find("input");c.prop("checked",!0);this.notify("share:update",c.val(),b.val());return!1},onChageAction:function(b){b=$(b.target);var c=b.parent().next("select");this.notify("share:update",b.val(),c.val());return!1},onSubmitAction:function(b){this.notify("action:save");return!1},onCancelAction:function(b){this.notify("action:cancel");return!1},onShareUpdate:function(b,c,g){var k=
"";b=this._container.find(".notification");var l=this.model.get("profileId"),l=this.getTypesByProfile(l);"share"==c&&(k=(k=this.collection.find("id",g))&&k.get("profileId"),k=this.getTypesByProfile(k),k=d.glossary({id:16058,translations:{"{SHARED_USER_TYPES}":k.join(", "),"{CURRENT_USER_TYPE}":this.model.get("translation")}}));"copy"==c&&(g=this.collection.find("id",g),k=d.glossary({id:16059,translations:{"{COPY_USER_TYPE}":g?g.get("translation"):"","{CURRENT_USER_TYPE}":this.model.get("translation")}}));
"new"==c&&(k=d.glossary({id:16060,translations:{"{CURRENT_USER_TYPE}":this.model.get("translation")}}));0==l.length&&(k+=" "+h(16061));b.text(k)},getTypesByProfile:function(b){var c=[];this.collection.each(function(d,k){d.get("profileId")===b&&c.push(d.get("translation"))});return c}}))})(toa);(function(d){var c=d.views.userTypes.BaseView;d.ns("toa.views.userTypes.SharedDisplayItem",d.define(c,function(b){c.apply(this,arguments)},{template:'<span class="listItem"><%- name %></span>'}))})(toa);(function(d){var c=d.views.userTypes.BaseView;d.ns("toa.views.userTypes.SharedDisplay",d.define(c,function(b){c.apply(this,arguments);this.collection=this.options.collection},{events:{"click .changeLink":"onClickModify"},template:'<div class="sharedDisplay"><% if (sharedWith.length) { %><span class="label"><%= h(16063)/*Screen configuration shared with*/ %></span><div class="sharedWithItems"><%= sharedWith.join(\'<span>,&nbsp;</span>\') %><% if (otherSharedWith.length) { %><span>...</span><% } %></div><a href="#" class="changeLink"><%= h(13243)/*Change*/ %></a><% } else { %><div class="textRight"><a href="#" role="link" class="changeLink"><%= h(16064)/*Copy/share screen configuration*/ %></a></div><% } %></div>',
getData:function(){var b=0,d=c.prototype.getData.apply(this,arguments);d.otherSharedWith=[];d.sharedWith=this.collection.pluck("name");b=d.sharedWith.length;3<b&&(d.otherSharedWith=d.sharedWith.splice(3,b-3));return d},onClickModify:function(b){this.notify("config:clicked",this.collection);return!1}}))})(toa);(function(d){var c=d.views.userTypes.BaseView;d.ns("toa.views.userTypes.SettingsButtons",d.define(c,function(){c.apply(this,arguments)},{events:{"click .btnSaveSettings":"onClickSave"},template:'<table class="footerTable"><tr><td><div class="leftSideBar"></div></td><td width="100%"><div class="info"></div></td><td><div class="settingsButtons"><button type="submit" class="toa-button toa-button-active pullRight btnSaveSettings"><%= h(12) /*Save*/ %></button></div></td></tr></table>',showNotification:function(b){if(!this._container)return!1;
this._container.find(".info").text(b)},clearNotification:function(){this.showNotification("")},setBtnDisabled:function(b,c){if(!this._container)return!1;this._container.find(".btn"+b+"Settings").toggleClass("toa-button-disable",c)},setBtnVisible:function(b,c){if(!this._container)return!1;this._container.find(".btn"+b+"Settings").toggleClass("hidden",!c)},onClickSave:function(b){if($(b.target).hasClass("toa-button-disable"))return!1;this.notify("save:clicked",this)}}))})(toa);(function(d){var c=d.views.userTypes.BaseView;d.ns("toa.views.userTypes.Settings",d.define(c,function(){c.apply(this,arguments)},{regions:{tabs:".settingsTabs",tabContent:".settingsContent",statusBar:".statusBar"},clearContent:function(){$(this._container).find(".settingsContent").empty()},template:'<div class="settings" role="tablist"><div id="typeSettings" class="typeSettings"><ul class="settingsTabs" id="typeSettingsTabs"></ul><div class="settingsContainer"><div class="settings-content"><div id="typeSettingsContent" class="settingsContent" role="tabpanel"></div><div class="statusBar"></div></div></div></div></div>'}))})(toa);(function(d){var c=d.views.userTypes.BaseView;d.ns("toa.views.userTypes.SettingsPanel",d.define(c,function(){c.apply(this,arguments)},{template:'<div id="typeSettings" class="settings"><ul class="settingsTabs" id="typeSettingsTabs"></ul><div class="settingsContainer"></div></div><div class="settingsButtons"></div>',regions:{tabSelector:"#typeSettingsTabs",settings:".settingsContainer",buttons:".settingsButtons"}}))})(toa);(function(d){var c=d.views.userTypes.BaseView;d.ns("toa.views.userTypes.SettingsTabLabel",d.define(c,function(){c.apply(this,arguments)},{events:{click:"selectTab","keydown .settingsTab":"onKeyPress"},template:'<li role="tab" class="settingsTab" data-tab-label="<%- label %>" tabindex="0"><%= title %></li>',onKeyPress:function(b){13==b.keyCode&&$(b.currentTarget).trigger("click");37==b.keyCode?$("li.settingsTab").is(":focus")?$("li.settingsTab:focus").prev().focus():$("li.settingsTab:first-child").focus():
39==b.keyCode&&($("li.settingsTab").is(":focus")?$("li.settingsTab:focus").next().focus():$("li.settingsTab:first-child").focus())},selectTab:function(b){b=$(b.target);b.hasClass("disabled")||this.notify("tab:selected",b.data("tab-label"))}}))})(toa);(function(d){var c=d.views.userTypes.BaseCollectionView;d.ns("toa.views.userTypes.SettingsTabs",d.define(c,function(){c.apply(this,arguments)},{template:"",childView:d.views.userTypes.SettingsTabLabel,childRegion:"",highlightTab:function(b){this._$el.find(".settingsTab").removeClass("selected");this._$el.find(".settingsTab[data-tab-label="+b+"]").addClass("selected")},setActiveTab:function(b){var c=0;if(b)var d=this.collection.findIndexBy(function(c){return c.get("label")===b}),c=0<=d?d:c;this._childViews[c]._$el.click()},
disableTab:function(b){this._$el.find(".settingsTab[data-tab-label="+b+"]").addClass("disabled")},enableTab:function(b){this._$el.find(".settingsTab[data-tab-label="+b+"]").removeClass("disabled")}}))})(toa);(function(d){var c=d.views.userTypes.BaseView;d.ns("toa.views.userTypes.TypeName",d.define(c,function(){c.apply(this,arguments)},{events:{"click .typesListItem":"selectType","keypress .typesListItem":"selectType"},template:'<tr class="typesListItem <%= (\'active\' === status ? \'active\' : \'\') %>" role="link" tabindex="0"><td class="listStatus"><div class="typesListUsersStatus"></div></td><td class="typesListUser""><div class="typesListUsersName"><%- translation %></div><div class="typesListLabel"><%- label %></div></td><td class="listUsersCount"><small class="typesListUsersCount"><%- users %></small><div class=""><%= h(16631) %></div></td></tr>',
selectType:function(b){"keypress"===b.type&&13!==b.keyCode||this.notify("type:selected",this.model.get("type_id"))}}))})(toa);(function(d){var c=d.views.userTypes.BaseView;d.ns("toa.views.userTypes.TypesListControls",d.define(c,function(){c.apply(this,arguments)},{events:{"click .typesListButton.add":"actionAdd","click .typesListButton.remove":"actionDelete"},template:'<div class="typesListControls"><button aria-label="<%= h(16008) %>" class="typesListButton add">&nbsp;</button><button aria-label="<%= h(19650) %>" class="typesListButton remove">&nbsp;</button><div>',actionAdd:function(b){this.notify("typeaction:add",b,this)},
actionDelete:function(b){this.notify("typeaction:delete",b,this)}}))})(toa);(function(d){var c=d.views.userTypes.BaseCollectionView;d.ns("toa.views.userTypes.TypesList",d.define(c,function(){c.apply(this,arguments);this.selectedView=null},{template:'<div class="typesListContainerInner"><div id="userTypesList"><table class="typesList" role="none" aria-label="<%= h(16014)/*User Types*/ %>"></table></div></div>',childView:d.views.userTypes.TypeName,childRegion:".typesList",highlightSelected:function(b){this.selectedView=b;$.each(this._childViews,function(b,c){c._$el.removeClass("selected")});
b._$el.addClass("selected")},getTypeId:function(){var b=this.getActiveItem();return b?b.get("type_id"):null},getSelectedIndex:function(){return this.selectedView?this.getViewIndexByModel(this.selectedView.model):-1},getViewIndexByModel:function(b){var c=-1,d=b.get("type_id");$.each(this._childViews,function(b,l){if(l.model.get("type_id")==d)return c=b,!1});return c},getSiblingChildView:function(b){var c=this._childViews.length;if(0==c)return null;if(!b||0>b)b=0;return(b=b<=c-1?this._childViews[b]:
this._childViews[c-1])&&b.model?b.model:null},getActiveItem:function(){var b=null;this.selectedView&&this.selectedView.model&&(b=this.selectedView.model);return b},setActiveItem:function(b,c,d){if(!b)return-1;b=this.getViewIndexByModel(b);-1<b&&this._childViews[b]&&(c?this.highlightSelected(this._childViews[b]):this._childViews[b]._$el.click(),d&&this.scrollToItem(this._childViews[b]));return b},scrollToItem:function(b){var c=this._container.find(".typesListContainerInner"),d=c.outerHeight(),k=this.getRegionContainer();
d<k.outerHeight()&&(k=k.children(":first").position().top,b=b._$el.position().top-k,b>d/2&&c.scrollTop(b-d/2))},selectFirst:function(){return 0<this._childViews.length?this.setActiveItem(this._childViews[0].model):-1}}))})(toa);(function(d){var c=d.views.userTypes.BaseView;d.ns("toa.views.userTypes.TypesListPanel",d.define(c,function(){c.apply(this,arguments)},{template:'<div class="typesListControls"></div><div class="typesListContainer"></div>',regions:{controls:".typesListControls",list:".typesListContainer"}}))})(toa);(function(d){var c=d.views.userTypes.BaseView;d.ns("toa.views.userTypes.filterTab.FieldRestrictions",d.define(c,function(b){c.apply(this,arguments)},{events:{"change .cbFutureDays":"onChangeFutureDays","change .future_days_limit":"onChangeDaysLimit","change .future_days_without_restriction":"onClickDaysRestriction","click .span_link":"onClickRestrictionsLink"},template:'<div class="filtersSectionContainer"><table class="restrictions"><tr><td class="restrictionsLabel"><input type="checkbox" class="cbFutureDays" id="future_days_limit" <% if (future_days_limit.enabled) { %> checked="checked"<% } %>><label for="future_days_limit">'+
r(16024)+'</label></td><td class="restrictionsSelection"><select aria-label="<%= h(3299) %>" class="future_days_limit" <% if (!future_days_limit.enabled) { %>disabled="disabled"<% } %>><% for (var i = 0; i < future_days_limit.options.length; i++) { %><option value="<%- i %>" <% if (i == future_days_limit.value) { %> selected="selected"<% } %>><%- future_days_limit.options[i] %></option><% } %></select></td></tr><tr><td class="restrictionsLabel"><input type="checkbox" class="cbFutureDays" id="future_days_without_restriction" <% if (future_days_without_restriction.enabled) { %> checked="checked"<% } %>><label for="future_days_without_restriction">'+
h(16025)+"</label><p>"+r(225401,{"{LINK}":'<a href="#" class="span_link">',"{/LINK}":"</a>"})+'</p></td><td class="restrictionsSelection"><select aria-label="<%= h(3299) %>" class="future_days_without_restriction" <% if (!future_days_without_restriction.enabled) { %> disabled="disabled"<% } %>><% for (var i = 0; i < future_days_without_restriction.options.length; i++) { %><option value="<%- i %>" <% if (i == future_days_without_restriction.value) { %> selected="selected"<% } %>><%- future_days_without_restriction.options[i] %></option><% } %></select></td></tr></table></div>',
onClickRestrictionsLink:function(b){b=this.model.get("layout");this.notify("filter:layout",b,"display");return!1},onChangeFutureDays:function(b){var c=$(b.target);b=c.prop("id");var c=c.is(":checked"),d=this._container.find("select."+b),k=c?d.val():"1000";d.prop("disabled",!c);this.notify("filter:restriction",b,k);return!1},onChangeDaysLimit:function(b){b=$(b.target);this.notify("filter:restriction","future_days_limit",b.val());return!1},onClickDaysRestriction:function(b){b=$(b.target);this.notify("filter:restriction",
"future_days_without_restriction",b.val());return!1}}))})(toa);(function(d){var c=d.views.userTypes.BaseView;d.ns("toa.views.userTypes.FilterVisiblityItem",d.define(c,function(){c.apply(this,arguments)},{events:{"click .listItem":"onItemClick"},template:"<div class=\"listItem<%= ('undefined' !== typeof status && '' !== status && 'active' !== status ) ? ' toa-disabled' : '' %>\"><%- translation %></div>",onItemClick:function(b){this.notify("click:listitem",this)}}))})(toa);(function(d){var c=d.views.userTypes.BaseView;d.ns("toa.views.userTypes.FilterableVisibilityListItem",d.define(c,function(b){c.apply(this,arguments);this.model.addListener("change",this.onChangeModel,this)},{events:{"change .cbFilterableItem":"onChangeState"},template:'<tr><td class="colCheckbox"><input id="cbFilterable-<%- filter_id %>" class="cbFilterableItem" type="checkbox" <% if (\'undefined\' !== typeof disabled && disabled) {%>disabled="disabled"<% } %> <% if (assigned) {%>checked="checked"<% } %>></td><td><label for="cbFilterable-<%- filter_id %>" <%= (\'undefined\' !== typeof status && \'\' !== status && \'active\' !== status ) ? \'class="toa-disabled"\' : \'\' %>><%- translation %></label></td></tr>',
onChangeModel:function(b,c){this._$el.find(".cbFilterableItem").prop("checked",c.assigned)},onChangeState:function(b){b=$(b.target).is(":checked");this.notify("list:change",this.model,b)}}))})(toa);(function(d){var c=d.views.userTypes.BaseCollectionView;d.ns("toa.views.userTypes.FilterableVisibilityList",d.define(c,function(b){this.filterable=!1!==b.filterable;this.filterSelect=b.filterSelect||!1;c.apply(this,arguments);this.addListener("list:change",this.onChangeAssigned,this)},{events:{"keyup .filterableSearchInput":"onTypeSearch","click .filterSelectAll":"onClickSelectAll","click .filterClearAll":"onClickClearAll","click .clearSearchButton":"onClickClearSearch"},childRegion:".checkboxTable tbody",
childView:d.views.userTypes.FilterableVisibilityListItem,template:'<div class="filterableList"><% if (filterable) { %><div class="filterableSearch"><i class="searchIcon"></i><input aria-label="<%-h(13745)%>" class="filterableSearchInput" autofocus ><i class="clearSearchButton hidden"></i></div><% } %><% if (filterSelect) { %><div class="filterSelectBox"><i class="icon icon-filter"></i><span><%= h(3412)/*Filter*/ %>:</span><a href="#" class="hint_link filterSelectAll"><%= h(12033)/*Select all*/ %></a> - <a href="#" class="hint_link filterClearAll"><%= h(12034)/*Clear all*/ %></a></div><% } %><div class="filterableListSection"><table class="checkboxTable"><tbody></tbody></table></div></div>',
getData:function(){var b=c.prototype.getData.apply(this,arguments);b.filterable=this.filterable;b.filterSelect=this.filterSelect;b.isEmptyCollection=this.collection&&0>=this.collection.models.length;return b},onChangeAssigned:function(b,c,d,k){var l=d.get("filter_id"),n=d.get("profileId");if(!n)return d.set({assigned:k}),!0;this.collection.each(function(b,c){if(n===b.get("profileId")){var d={silent:l===b.get("filter_id")};b.set({assigned:k},d)}},this)},onTypeSearch:function(b){b=$(b.target).val().toLowerCase();
this.filterList(b)},filterList:function(b){var c=this._container.find(".checkboxTable tr"),d=this._container.find(".clearSearchButton");if(!b)return d.toggleClass("hidden",!0),$.each(c,function(b,c){$(c).toggleClass("hidden",!1)}),!1;d.toggleClass("hidden",!1);$.each(c,function(c,d){var e=$(d),g=-1<e.find("label").text().toLowerCase().indexOf(b);e.toggleClass("hidden",!g)})},onClickSelectAll:function(){this.setItemsEnabled(!0);return!1},onClickClearAll:function(){this.setItemsEnabled(!1);return!1},
setItemsEnabled:function(b){this.collection.each(function(c,d){c.set({assigned:b})})},onClickClearSearch:function(b){this._container.find(".clearSearchButton").toggleClass("hidden",!0);this._container.find(".filterableSearchInput").val("");this.filterList()}}))})(toa);(function(d){var c=d.views.userTypes.BaseCollectionView;d.ns("toa.views.userTypes.filterTab.FilterVisiblity",d.define(c,function(b){c.apply(this,arguments);this.popupTitle=b.popupTitle||h(15028)},{events:{"click .multiselect-tip-button":"onClickSelectButton","keypress .multiselect-tip-button":"onClickSelectButton"},endOfLine:",",childRegion:".selectedLabels",childView:d.views.userTypes.FilterVisiblityItem,template:'<% if (isEmptyCollection) { %><div class="toa-disabled"><%= h(16044)/*No available filters for restricting visible activities*/ %></div></div><% } else { %><div class="sectionItemList <% if (isEmptyItemList) {%>emptySectionItemList<% } %>"><div role="button" class="ui-button multiselect-tip-button ui-button-icon-only" tabindex="0" title="'+
h(462)+'"><span class="ui-icon ui-button-icon-primary ui-icon-modify"></span><span class="ui-button-text">'+h(462)+'</span></div><div class="selectedLabels"></div><div class="clear"></div></div><% } %>',getData:function(){var b=c.prototype.getData.apply(this,arguments),d=this.collection.find("assigned",!0);b.isEmptyCollection=this.collection&&0>=this.collection.models.length;b.isEmptyItemList=d?!1:!0;return b},_renderCollection:function(b){var c=this.collection.where("assigned",!0);$.each(c,function(c,
d){var e=new this.childView({model:d,collection:this.collection});this._subscribeChildView(e);this._childViews.push(e);e.render(b,!0)}.bind(this))},applyChanges:function(b){b.each(function(b){var c=b.get("filter_id");b=b.get("assigned");(c=this.collection.find("filter_id",c))&&c.get("assigned")!==b&&(c.set({assigned:b}),this.notify("change:assigned",c,b))}.bind(this));this.render(this._container)},onClickSelectButton:function(b){if("keypress"!==b.type||13===b.keyCode){var c=this.collection.compact("filter_id",
"assigned","translation");b=d.create("toa.views.userTypes.FilterableVisibilityList",{model:this.model,collection:c});var g=new d.ui.Popup({title:this.popupTitle,width:300,autoOpen:!0,view:b,modal:!0,onClose:function(){g.destroy()},buttons:[{text:h(14621),position:"left",click:function(){g.destroy()}},{text:h(12252),type:"submit",position:"right",click:function(b){$(b.target).removeClass("toa-button-active").addClass("toa-button-disable");this.applyChanges(c);g.destroy()}.bind(this)}]})}}}))})(toa);(function(d){var c=d.views.userTypes.BaseView;d.ns("toa.views.userTypes.filterTab.FieldSharedDisplay",d.define(c,function(b){c.apply(this,arguments);this.collection=this.options.model},{template:'<% if (sharedWith.length) { %><div class="fieldRestrictionsShared"><span>'+r(10403,{"{USER_TYPE}":"<div class=\"sharedWithItems\"><%= sharedWith.join('<span>,&nbsp;</span>') %><% if (otherSharedWith.length) { %><span>...</span><% } %>.</div>"})+"</span><span><%= h(10414)/* Please navigate to Screen Configuration to view/change data */ %></span></div><% } %>",
getData:function(){var b,d=c.prototype.getData.apply(this,arguments);d.otherSharedWith=[];d.sharedWith=this.collection.pluck("name");b=d.sharedWith.length;3<b&&(d.otherSharedWith=d.sharedWith.splice(3,b-3));return d}}))})(toa);(function(d){var c=d.views.userTypes.BaseView;d.ns("toa.views.userTypes.apiTab",d.define(c,function(b){c.apply(this,arguments)},{events:{"change .cbApiActive":"onChangeApiActive","click .apiAvailableFieldsLink":"onClickLayoutLink","click .settingsSection":"onClickSettingsSection"},render:function(b,d){c.prototype.render.apply(this,arguments);this.notify("api:render",this);return this},setActiveSection:function(b,c){var d=this._container.find(".settingsSection[data-section-id='"+b+"']");d.length||
(d=this._container.find(".settingsSection:first"));this.activateSection(d)},activateSection:function(b,c,d){var k=b.next();if(k.is(":visible"))return k.slideUp(),!1;c?(this._container.find(".apiSectionContainer").slideUp(),k.slideDown()):(this._container.find(".apiSectionContainer").hide(),k.show());d&&this.notify("section:selected",this,b.data("section-id"))},disableSection:function(b,c){var d=this._container.find(".settingsSection[data-section-id='"+b+"']");if(!d.length)return!1;d=d.next();d.find(".assignedContainer .cbApiActive, .apiCoreSelect .cbApiActive").prop("disabled",
!c);c?d.find(".apiAvailableFieldsLink").removeClass("toa-disabled"):d.find(".apiAvailableFieldsLink").addClass("toa-disabled")},getData:function(){var b={},c={core_api_activity:0,core_api_inventory:1,core_api_resource:2,core_api_user:3,core_api_events:4,core_api_dailyextract:5,core_api_collaboration:6};this.model&&(b=this.model.toJSON(),b.permissions&&(b.permissions=this.getApiNodes(b.permissions,"",2),$.each(b.permissions,function(d,k){if("core_api"==k.label)return b.permissions[d].children.sort(function(b,
d){return c[b.label]-c[d.label]}),!1})),b.layouts&&(b.layouts=this.getLayouts(b.layouts)));return b},getApiNodes:function(b,c,d){var k=[];d&&$.each(b,function(l,n){if(n.parent===c){var p=$.extend({},n,{children:this.getApiNodes(b,n.label,d-1)});k.push(p)}}.bind(this));return k},getLayouts:function(b){var c={};$.each(b,function(b,d){var l=d.parent;l&&(c[l]=c[l]||[],c[l].push(d))}.bind(this));$.each(c,function(b,c){c.sort(function(b,c){var d=b.superentity||0,e=c.superentity||0;return d>e?1:d<e?-1:0})});
return c},onClickLayoutLink:function(b){b=$(b.target);b.hasClass("toa-disabled")||(b=this.model.get("layouts").find("context_id",b.data("context-id")),this.notify("api:layout",this,b,"api"));return!1},onClickSettingsSection:function(b){b=$(b.target);this.activateSection(b,!0,!0);return!1},onChangeApiActive:function(b){var c=$(b.target),d=c.data("id");b=c.is(":checked");var k=b&1;c.is("select")&&(k=c.val(),b=0<k);c.hasClass("sectionCheckbox")&&this.disableSection(d,b);this.notify("api:interface",this,
d,b,k);(c=c.data("child-id")||!1)&&this.notify("api:interface",this,c,b,k);return!1},template:'<div class="apiSettingsContainer"><% var children = null; %><% var layoutList = null; %><% var hasChildren, hasLayouts, hasOneMethod; %><% var isCoreApi, isMetadataApi, isCapacityQuotaApi, isPartsCatalogApi, isOutboundApi; %><% for (var i = 0; i < permissions.length; i++) { %><% layoutList = layouts[permissions[i].label]; %><% hasChildren = permissions[i].children && permissions[i].children.length; %><% hasLayouts = layoutList && layoutList.length; %><% hasOneMethod = hasChildren && permissions[i].children.length == 1; %><% isCoreApi = permissions[i].label == "core_api"; %><% isMetadataApi = permissions[i].label == "metadata_api"; %><% isCapacityQuotaApi = permissions[i].label == "capacity_quota_api"; %><% isPartsCatalogApi = permissions[i].label == "api_parts_catalog"; %><% isOutboundApi = permissions[i].label == "outbound"; %><div class="section" data-section-id="<%- permissions[i].module_id %>"><div class="sectionCheckboxContainer"><input type="checkbox" class="sectionCheckbox cbApiActive" data-id="<%- permissions[i].module_id %>"<% if (hasOneMethod && (isPartsCatalogApi || isOutboundApi)) {%> data-child-id="<%- permissions[i].children[0].module_id %>"<% } %><% if (permissions[i].assigned) { %> checked="checked"<% } %>></div><h1 class="settingsSection api" data-section-id="<%- permissions[i].module_id %>"><%- (permissions[i].translation || permissions[i].label || "") %></h1><div class="apiSectionContainer" style="display: none;"><table class="apiMethods"><% if (isCoreApi || isMetadataApi || isCapacityQuotaApi) { %><% for (var k = 0; k < permissions[i].children.length; k++) { %><% children = permissions[i].children[k] %><tr><td class="apiCoreLabel"><%- children.translation %></td><td class="apiCoreSelect"><select class="sectionCheckbox cbApiActive" id="api_visiblity_<%- children.module_id %>" data-id="<%- children.module_id %>" <% if (!permissions[i].assigned) { %>disabled="disabled"<% } %>><option value="0" <% if (children.user_type_access == 0) { %>selected="selected"<% } %>><%= h(17701)/*Hidden*/ %></option><option value="1" <% if (children.user_type_access == 1) { %>selected="selected"<% } %>><%= h(17702)/*ReadOnly*/ %></option><% if (children.label != "core_api_dailyextract" && children.label != "metadata_api_capacity_area" && children.label != "capacity_quota_api_booking")  { %><option value="2" <% if (children.user_type_access == 2) { %>selected="selected"<% } %>><%= h(17703)/*ReadWrite*/ %></option><% } %></select></td><td class="apiCoreCustomConfigure"></td></tr><% } %><% } else { %><tr><td class="apiLabel"><%= h(16050)/*Available methods*/ %></td><% if (hasChildren && !(isPartsCatalogApi || isOutboundApi)) { %><td class="apiMethodsList"><div class="assignedContainer"><table class="assigned api"><% for (var k = 0; k < permissions[i].children.length; k++) { %><% children = permissions[i].children[k] %><tr><td class="assignedBox"><input type="checkbox" id="api_visiblity_<%- children.module_id %>" class="cbApiActive" data-id="<%- children.module_id %>" <% if (!permissions[i].assigned) { %>disabled="disabled"<% } %> <% if (children.assigned) { %>checked="checked"<% } %>></td><td class="assignedName"><label for="api_visiblity_<%- children.module_id %>"><%- children.translation %></label></td></tr><% } %></table></div></td><% } else { %><td class="apiMethodsEmpty toa-disabled"><%= h(16051)/*This API does not support individual method configuration. By selecting this API all methods will become available.*/ %></td><% } %><td class="apiLayouts"><% if (hasLayouts) { %><table><% for (var l = 0; l < layoutList.length; l++) { %><tr><td class="apiAvailableFields"><% if ("1" == layoutList[l].superentity) { %><%= h(16045)/*Available activity fields*/ %><% } else if ("2" == layoutList[l].superentity) { %><%= h(16046)/*Available inventory fields*/ %><% } else if ("3" == layoutList[l].superentity) { %><%= h(16047)/*Available resource fields*/ %><% } else if ("5" == layoutList[l].superentity) { %><%= h(16048)/*Available service requests fields*/ %><% } else if ("9" == layoutList[l].superentity) { %><%= h(16049) /*Available user fields*/ %><% }%></td><td><a class="apiAvailableFieldsLink span_link <% if (!permissions[i].assigned) { %>toa-disabled<% } %>" href="#" data-context-id="<%- (layoutList[l].context_id || 0) %>"><%= h(462)/*Modify*/ %></a></td></tr><% } %></table><% } %></td></tr><% } %></table></div></div><% } %></div>'}))})(toa);(function(d,c){d.ns("toa.userTypes.ServerConnector",d.define(null,function(b,c){this._triggerFunction=b;this._controller=c},{_triggerFunction:function(){},_controller:"",request:function(b,d){var g=c.Deferred();this._triggerFunction("global.data.get",{controller:this._controller,method:b,params:d||{},responseHandler:function(b,c){c.status&&"OK"===c.status?g.resolve(c):g.reject(c.error_code||0)}.bind(this)});return g.promise()}}))})(toa,$);(function(d,c){d.ns("toa.userTypes.DataMapper",d.define(null,function(b){this._serverConnector=b},{_modelConstructor:function(){},_serverGetMethod:"",_serverSaveMethod:"",_serverRemoveMethod:"",_serverGetField:"",_serverIdField:"",load:function(b,d){d=d||{};this._serverIdField&&(d[this._serverIdField]=b.id);var g=c.Deferred(),k=this._serverConnector.request(this._serverGetMethod,d);k.done(function(c){c&&c[this._serverGetField]||g.reject('Field "'+this._serverGetField+'" is not available');try{this._fillModel(b,
c[this._serverGetField]),g.resolve(b)}catch(d){g.reject("Unable to fill model with given data ("+d.message+")")}}.bind(this));k.fail(function(b){g.reject("Server error ("+b+") has occurred")});return g.promise()},create:function(b){var c=new this._modelConstructor;this._fillModel(c,b||{});return c},save:function(b){return this._serverConnector.request(this._serverSaveMethod,this.serialize(b))},remove:function(b){var c={};c[this._serverIdField||"id"]=b.getId();return this._serverConnector.request(this._serverRemoveMethod,
c)},_fillModel:function(b,c){b.reset({},{silent:!0});b.set(c,{silent:!0})},serialize:function(b){return b.toJSON()}}))})(toa,$);(function(d,c){var b=d.userTypes.DataMapper;d.ns("toa.userTypes.ComplexDataMapper",d.define(b,function(c,d){b.apply(this,arguments);this._fieldMappers=d},{_fillModel:function(b,d){b.reset({},{silent:!0});c.each(d,function(c,d){var g={};if(this._fieldMappers&&c in this._fieldMappers){var p=this._fieldMappers[c].create(d);null!==p&&(g[c]=p,b.subscribeOnChild(p))}else g[c]=d;b.set(g,{silent:!0})}.bind(this))},serialize:function(b){var d=b.toJSON();c.each(d,function(c,l){if(this._fieldMappers&&c in this._fieldMappers){var n=
this._fieldMappers[c].serialize(b.get(c));null!==n?d[c]=n:delete d[c]}}.bind(this));return d}}))})(toa,$);(function(d,c){var b=d.userTypes.DataMapper;d.ns("toa.userTypes.CollectionDataMapper",d.define(b,function(c,d){b.apply(this,arguments);this._itemMapper=d},{_modelConstructor:d.models.userTypes.BaseCollection,create:function(b){var c=new this._modelConstructor;this._comparator&&"function"===typeof this._comparator&&(c.comparator=this._comparator);this._fillModel(c,b||[]);return c},_fillModel:function(b,d){b.clear({silent:!0});c.each(d,function(c,d){var g=this._itemMapper.create(d);b.add(g,{silent:!0})}.bind(this))},
serialize:function(b){var c=[];b.each(function(b){c.push(this._itemMapper.serialize(b))},this);return c}}))})(toa,$);(function(d,c){d.ns("toa.userTypes.NullDataMapper",d.define(d.userTypes.DataMapper,null,{create:function(b){return null},serialize:function(b){return null}}))})(toa,$);(function(d){var c=d.userTypes.DataMapper;d.ns("toa.userTypes.dataMappers.BaseDataMapper",d.define(c,function(b){c.apply(this,arguments)},{_modelConstructor:d.models.userTypes.BaseModel}))})(toa);(function(d){var c=d.userTypes.CollectionDataMapper;d.ns("toa.userTypes.dataMappers.BaseCollectionDataMapper",d.define(c,function(b,d){c.apply(this,arguments);this._itemMapper=d},{_modelConstructor:d.models.userTypes.BaseCollection}))})(toa);(function(d){var c=d.userTypes.DataMapper;d.ns("toa.userTypes.dataMappers.UserTypeDataMapper",d.define(c,function(b){c.apply(this,arguments)},{_modelConstructor:d.models.userTypes.UserType,_serverSaveMethod:"create",_serverRemoveMethod:"delete",_serverIdField:"user_type_id",save:function(b){var d=b.get("copy_from_id")||0;this._serverSaveMethod=d&&0!=d?"copy":"create";return c.prototype.save.apply(this,arguments)},serialize:function(b){var c=b.get("copy_from_id")||0,d={label:b.get("label"),name:b.get("name")};
c&&0!=c&&(d.copy_from_id=c,d.is_shared=b.get("is_shared")||0);return d}}))})(toa);(function(d,c){var b=d.userTypes.CollectionDataMapper;d.ns("toa.userTypes.dataMappers.TypesListDataMapper",d.define(b,function(c,d){b.apply(this,arguments)},{_modelConstructor:d.models.userTypes.SortableCollection,_serverGetMethod:"getList",_serverGetField:"user_types"}))})(toa,$);(function(d,c){var b=d.userTypes.CollectionDataMapper;d.ns("toa.userTypes.dataMappers.LoginPolicyDataMapper",d.define(b,function(c,d,k){b.apply(this,arguments);this._initialModel=k},{_modelConstructor:d.models.userTypes.SortableCollection,_initialModelField:"login_policy",_fillModel:function(b,d){b.clear({silent:!0});c.each(this._initialModel.get(this._initialModelField,{}),function(c,l){var n=this._itemMapper.create({id:c,translation:l,assigned:d===c});b.add(n,{silent:!0})}.bind(this))},serialize:function(b){var c=
"";b.each(function(b){if(b.get("assigned"))return c=b.id,!1},this);return c}}))})(toa,$);(function(d,c){var b=d.userTypes.CollectionDataMapper;d.ns("toa.userTypes.dataMappers.ApplicationDataMapper",d.define(b,function(c,d,k){b.apply(this,arguments);this._initialModel=k},{_modelConstructor:d.models.userTypes.SortableCollection,_initialModelField:"applications",_fillModel:function(b,d){b.clear({silent:!0});c.each(this._initialModel.get(this._initialModelField,{}),function(c,l){var n=this._itemMapper.create({id:c,translation:l,assigned:d===c});b.add(n,{silent:!0})}.bind(this))},serialize:function(b){var c=
"";b.each(function(b){if(b.get("assigned"))return c=b.id,!1},this);return c}}))})(toa,$);(function(d,c){var b=d.userTypes.CollectionDataMapper;d.ns("toa.userTypes.dataMappers.TypesDataMapper",d.define(b,function(c,d,k){b.apply(this,arguments);this._initialModel=k},{_modelConstructor:d.models.userTypes.SortableCollection,_initialModelField:"",_fillModel:function(b,d){b.clear({silent:!0});c.each(this._initialModel.get(this._initialModelField,{}),function(k,l){var n={id:k,assigned:-1!==c.inArray(+k,d)};c.extend(n,l);n=this._itemMapper.create(n);b.add(n,{silent:!0})}.bind(this))},serialize:function(b){var c=
{};b.each(function(b){c[+b.id]=+b.get("assigned")});return c}}))})(toa,$);(function(d){var c=d.userTypes.dataMappers.TypesDataMapper;d.ns("toa.userTypes.dataMappers.ManagedTypesDataMapper",d.define(c,function(b,d,g){c.apply(this,arguments)},{_initialModelField:"user_types"}))})(toa);(function(d,c){var b=d.userTypes.CollectionDataMapper;d.ns("toa.userTypes.dataMappers.PermissionsDataMapper",d.define(b,function(c,d,k,l){b.apply(this,arguments);this._initialModel=k;this._currentUserTypeModel=l},{_modelConstructor:d.models.userTypes.BaseCollection,_initialModelField:"",_fillModel:function(b,d){b.clear({silent:!0});c.each(this._initialModel.get(this._initialModelField,{}),function(k,l){var n=c.extend({},l);n.assigned=-1!==c.inArray(+n.module_id,d);n=this._itemMapper.create(n);b.add(n,
{silent:!0})}.bind(this))},serialize:function(b){var c={},d=this._currentUserTypeModel.getId();b.each(function(b){var e=b.get("module_id");c[e]={user_type_id:d,module_id:b.get("module_id"),user_type_access:b.get("assigned")?1:0}});return c}}))})(toa,$);(function(d){var c=d.userTypes.dataMappers.PermissionsDataMapper;d.ns("toa.userTypes.dataMappers.ActivityPermissionsDataMapper",d.define(c,function(b,d,g){c.apply(this,arguments)},{_modelConstructor:d.models.userTypes.BaseCollection,_initialModelField:"activity_permissions"}))})(toa);(function(d){var c=d.userTypes.dataMappers.PermissionsDataMapper;d.ns("toa.userTypes.dataMappers.ResourcePermissionsDataMapper",d.define(c,function(b,d,g){c.apply(this,arguments)},{_modelConstructor:d.models.userTypes.BaseCollection,_initialModelField:"resource_permissions"}))})(toa);(function(d){var c=d.userTypes.dataMappers.PermissionsDataMapper;d.ns("toa.userTypes.dataMappers.FeaturePermissionsDataMapper",d.define(c,function(b,d,g){c.apply(this,arguments)},{_modelConstructor:d.models.userTypes.BaseCollection,_initialModelField:"feature_permissions"}))})(toa);(function(d){var c=d.userTypes.dataMappers.PermissionsDataMapper;d.ns("toa.userTypes.dataMappers.CollaborationPermissionsDataMapper",d.define(c,function(b,d,g){c.apply(this,arguments)},{_modelConstructor:d.models.userTypes.BaseCollection,_initialModelField:"collaboration_permissions"}))})(toa);(function(d){var c=d.userTypes.dataMappers.PermissionsDataMapper;d.ns("toa.userTypes.dataMappers.InterfacePermissionsDataMapper",d.define(c,function(b,d,g){c.apply(this,arguments)},{_modelConstructor:d.models.userTypes.BaseCollection,_initialModelField:"interface_permissions"}))})(toa);(function(d){var c=d.userTypes.DataMapper;d.ns("toa.userTypes.dataMappers.InitialGeneralDataMapper",d.define(c,function(b){c.apply(this,arguments)},{_modelConstructor:d.models.userTypes.BaseModel,_serverGetMethod:"getInitialGeneralSettings",_serverGetField:"initial_data"}))})(toa);(function(d,c){var b=d.userTypes.ComplexDataMapper;d.ns("toa.userTypes.dataMappers.GeneralSettingsDataMapper",d.define(b,function(c,d){b.apply(this,arguments)},{_modelConstructor:d.models.userTypes.BaseModel,_serverGetMethod:"loadUserTypeGeneralSettings",_serverSaveMethod:"updateGeneralSettings",_serverGetField:"user_type",_serverIdField:"user_type_id",_permissionsAggregatorField:"permissions",_permissionsFields:["interface_permissions","feature_permissions","activity_permissions","resource_permissions",
"collaboration_permissions"],_fillModel:function(d,g){var k=g[this._permissionsAggregatorField];c.each(this._permissionsFields,function(b,c){g[c]=k||[]});g.applications=g.application_id;0<g.applications&&(g.application_id=g.applications);b.prototype._fillModel.apply(this,arguments)},serialize:function(d){var g=b.prototype.serialize.apply(this,arguments);g[this._permissionsAggregatorField]={};var k=g[this._permissionsAggregatorField];c.each(this._permissionsFields,function(b,d){c.extend(k,g[d]);delete g[d]});
g.application_id||(g.application_id=0);delete g.applications;return g}}))})(toa,$);(function(d,c){var b=d.userTypes.ComplexDataMapper;d.ns("toa.userTypes.dataMappers.ContextsItemDataMapper",d.define(b,function(c,d){b.apply(this,arguments)},{_modelConstructor:d.models.userTypes.BaseModel}))})(toa,$);(function(d,c){var b=d.userTypes.CollectionDataMapper;d.ns("toa.userTypes.dataMappers.ContextsDataMapper",d.define(b,function(c,d,k){b.apply(this,arguments);this._initialModel=k},{_modelConstructor:d.models.userTypes.BaseCollection,_initialModelField:"",create:function(c){return null===c?null:b.prototype.create.apply(this,arguments)},_fillModel:function(b,d){b.clear({silent:!0});var k=this._initialModel.get(this._initialModelField,{});(c.isPlainObject(k)||c.isArray(k))&&c.each(k,function(k,n){var p=
{};c.each(d,function(b,c){if(c.context_id===n.context_id)return p=c,!1});var s=c.extend({},n,{layout_id:p.layout_id||null,shared:!(!p.shared||!0!==p.shared)}),s=this._itemMapper.create(s);b.add(s,{silent:!0})}.bind(this))}}))})(toa,$);(function(d,c){var b=d.userTypes.dataMappers.ContextsDataMapper;d.ns("toa.userTypes.dataMappers.MobilityContextsDataMapper",d.define(b,function(c,d,k){b.apply(this,arguments)},{_initialModelField:"mobility"}))})(toa,$);(function(d,c){var b=d.userTypes.CollectionDataMapper;d.ns("toa.userTypes.dataMappers.DisplaySharedWithDataMapper",d.define(b,function(c,d,k){b.apply(this,arguments)},{_initialModelField:"shared_with",_fillModel:function(b,d){b.clear({silent:!0});c.each(d,function(c,d){var g=this._itemMapper.create({name:d});b.add(g,{silent:!0})}.bind(this))},serialize:function(b){return null}}))})(toa,$);(function(d,c){var b=d.userTypes.dataMappers.ContextsDataMapper;d.ns("toa.userTypes.dataMappers.GeneralContextsDataMapper",d.define(b,function(c,d,k){b.apply(this,arguments)},{_initialModelField:"general",contexts:[{context_id:0,label:"context_collaboration",translation:h(16023),position_x:"38.00",position_y:"6.00",type:"identifier",childrens:["community_activity_details","community_inventory_details","community_resource_details","community_user_properties","community_resource_properties"]},{context_id:0,
label:"context_identifier",translation:h(16022),position_x:"0.00",position_y:"6.00",type:"identifier",childrens:["web_activity_identifier","web_inventory_identifier","web_support_identifier"]}],_fillModel:function(e,g){b.prototype._fillModel.apply(this,arguments);c.each(this.contexts,function(b,g){var n=!1;e.each(function(b){var e=b.get("label");if(-1<c.inArray(e,g.childrens)){var e=d.create("toa.models.userTypes.BaseCollection"),k=d.create("toa.models.userTypes.BaseModel");k.set({side_from:"right",
side_to:"left",label:g.label});e.add(k);b.set({parents:e},{silent:!0});n=!0}});n&&e.add(g,{silent:!0})}.bind(this))}}))})(toa,$);(function(d){var c=d.userTypes.DataMapper;d.ns("toa.userTypes.dataMappers.InitialDisplayDataMapper",d.define(c,function(b){c.apply(this,arguments)},{_modelConstructor:d.models.userTypes.BaseModel,_serverGetMethod:"getInitialDisplaySettings",_serverGetField:"initial_data"}))})(toa);(function(d,c){var b=d.userTypes.ComplexDataMapper;d.ns("toa.userTypes.dataMappers.DisplaySettingsDataMapper",d.define(b,function(c,d){b.apply(this,arguments)},{_modelConstructor:d.models.userTypes.BaseModel,_serverGetMethod:"loadUserTypeDisplaySettings",_serverGetField:"user_type",_serverIdField:"user_type_id"}))})(toa,$);(function(d,c){var b=d.userTypes.CollectionDataMapper;d.ns("toa.userTypes.dataMappers.LayoutParticipantsDataMapper",d.define(b,function(c,d){b.apply(this,arguments)},{_modelConstructor:d.models.userTypes.LayoutParticipants,_serverGetMethod:"getLayoutParticipants",_serverGetField:"participants",_serverIdField:"layout_id"}))})(toa,$);(function(d){var c=d.userTypes.DataMapper;d.ns("toa.userTypes.dataMappers.InitialFilterDataMapper",d.define(c,function(b){c.apply(this,arguments)},{_modelConstructor:d.models.userTypes.BaseModel,_serverGetMethod:"getInitialFilterSettings",_serverGetField:"initial_data"}))})(toa);(function(d,c){var b=d.userTypes.ComplexDataMapper;d.ns("toa.userTypes.dataMappers.FilterSettingsMapper",d.define(b,function(c,d){b.apply(this,arguments)},{_modelConstructor:d.models.userTypes.BaseModel,_serverGetMethod:"loadUserTypeFilterSettings",_serverSaveMethod:"updateUserTypeFiltersSettings",_serverGetField:"user_type",_serverIdField:"user_type_id",_restrictionsAggregatorField:"fieldrestrictions",_restrictionsFields:["layout","restrictions"],_fillModel:function(d,g){var k={};c.each(this._restrictionsFields,
function(b,c){k[c]=g[c]});g[this._restrictionsAggregatorField]=k;b.prototype._fillModel.apply(this,arguments)},serialize:function(c){var d=b.prototype.serialize.apply(this,arguments);return{user_type_id:d.type_id,filters:d.filters,restrictions:d[this._restrictionsAggregatorField]}}}))})(toa,$);(function(d,c){var b=d.userTypes.dataMappers.BaseDataMapper;d.ns("toa.userTypes.dataMappers.RestrictionsDataMapper",d.define(b,function(c,d,k){b.apply(this,arguments);this._itemMapper=d;this._initialModel=k},{_initialModelField:"future_days_options",_initialContexts:"contexts",_restrictionsField:"restrictions",_layoutField:"layout",_fillModel:function(b,g){var k={},l=this._initialModel.get(this._initialContexts,[]),n=this._initialModel.get(this._initialModelField,[]),p=g[this._restrictionsField]||
{};k[this._layoutField]={};c.each(l,function(b,e){var l=g[this._layoutField],l=l&&d.isObject(l)?l:{layout_id:null},l=c.extend(e,l),l=this._itemMapper.create(l);k[this._layoutField]=l;return!1}.bind(this));c.each(p,function(b,c){k[b]={value:c,options:n,enabled:"undefined"!==typeof n[c]}});b.reset(k,{silent:!0})},serialize:function(b){var d={};c.each(b.toJSON(),function(b,c){this._layoutField!==b&&(d[b]=c.value)}.bind(this));return d}}))})(toa,$);(function(d,c){var b=d.userTypes.CollectionDataMapper;d.ns("toa.userTypes.dataMappers.FilterVisibleDataMapper",d.define(b,function(c,d,k){b.apply(this,arguments);this._initialModel=k},{_modelConstructor:d.models.userTypes.BaseCollection,_initialModelField:"filters",_fillModel:function(b,d){b.clear({silent:!0});c.each(this._initialModel.get(this._initialModelField,{}),function(k,l){var n=c.extend({},l,{assigned:-1<c.inArray(+l.filter_id,d)}),n=this._itemMapper.create(n);b.add(n,{silent:!0})}.bind(this))},
serialize:function(b){var c={};b.each(function(b){c[+b.get("filter_id")]=+b.get("assigned")});return c}}))})(toa,$);(function(d,c){var b=d.userTypes.CollectionDataMapper;d.ns("toa.userTypes.dataMappers.ApiLayoutsDataMapper",d.define(b,function(c,d,k){b.apply(this,arguments);this._initialModel=k},{_modelConstructor:d.models.userTypes.BaseCollection,_initialModelField:"contexts",_contextRelation:{fileupload_set_inventory:"file_upload",fileupload_provider_info:"file_upload",fileupload_set_activity:"file_upload",soap_set_activity:"mobile_client",soap_set_inventory:"mobile_client",soap_send_request:"mobile_client",
soap_set_provider:"resource_management",soap_set_user:"resource_management"},_fillModel:function(b,d){b.clear({silent:!0});var k=this._initialModel.get(this._initialModelField,{});c.each(k,function(k,n){var p={},s={layout_id:null,parent:this.getContextRelation(n)};c.each(d,function(b,c){if(n.context_id&&c.context_id==n.context_id)return p=c,!1}.bind(this));s=c.extend(s,n,p);s=this._itemMapper.create(s);b.add(s,{silent:!0})}.bind(this));return this},getContextRelation:function(b){var c=null;b.label&&
(c=this._contextRelation[b.label]||null);return c},serialize:function(b){return null}}))})(toa,$);(function(d,c){var b=d.userTypes.CollectionDataMapper;d.ns("toa.userTypes.dataMappers.ApiPermissionsDataMapper",d.define(b,function(c,d,k){b.apply(this,arguments);this._initialModel=k},{_modelConstructor:d.models.userTypes.BaseCollection,_initialModelField:"interfaces",_fillModel:function(b,d){b.clear({silent:!0});var k=this._initialModel.get(this._initialModelField,{});c.each(k,function(k,n){var p=d[+n.module_id]&&d[+n.module_id].user_type_access,p=c.extend({},n,{assigned:0<p,user_type_access:p?
p:0}),p=this._itemMapper.create(p);b.add(p,{silent:!0})}.bind(this))},serialize:function(b){var c={};b.each(function(b){c[+b.get("module_id")]={user_type_access:+b.get("user_type_access")}});return c}}))})(toa,$);(function(d){var c=d.userTypes.DataMapper;d.ns("toa.userTypes.dataMappers.InitialApiDataMapper",d.define(c,function(b){c.apply(this,arguments)},{_modelConstructor:d.models.userTypes.BaseModel,_serverGetMethod:"getInitialApiSettings",_serverGetField:"user_type"}))})(toa);(function(d,c){var b=d.userTypes.ComplexDataMapper;d.ns("toa.userTypes.dataMappers.ApiSettingsDataMapper",d.define(b,function(c,d){b.apply(this,arguments)},{_modelConstructor:d.models.userTypes.BaseModel,_serverGetMethod:"loadUserTypeApiSettings",_serverSaveMethod:"updateUserTypeApiSettings",_serverGetField:"user_type",_serverIdField:"user_type_id",serialize:function(c){var d=b.prototype.serialize.apply(this,arguments);return{user_type_id:d.type_id,permissions:d.permissions}}}))})(toa,$);(function(d,c){var b=d.userTypes.dataMappers.BaseDataMapper;d.ns("toa.userTypes.dataMappers.LayoutMapper",d.define(b,function(c,d){b.apply(this,arguments)},{_serverGetMethod:"createLayout",_serverGetField:"layout"}))})(toa,$);(function(d,c){var b=d.userTypes.DataMapper;d.ns("toa.userTypes.dataMappers.ConfigDisplayMapper",d.define(b,function(c){b.apply(this,arguments)},{_modelConstructor:d.models.userTypes.BaseModel,_serverSaveMethod:"changeDisplayProfile"}))})(toa,$);(function(d){d.ns("toa.controllers.UserTypes",d.define(d.Controller,function(c){this.sandbox=c;this.content=c.options.content;this.triggerFunction=c.trigger.bind(c);this.setDefaultState();this.resume();this.clickOnContext=0},{toString:function(){return"UserTypes config screen controller"},tabsData:[],createPanelTitle:function(){this.panel=d.view.control.create({xtype:"PanelTitleAlta",addClass:"jet-css-only toa-panel-title jet-screen-title panel-title-usertype-settings",name:"titleCaption",titleText:h(16014),
resourceTreeButton:!1,backButton:!0,backButtonIcon:"",headerResponsive:_DATA.page_label,backButtonLabel:_DATA.glossary.action_links.company_settings_configuration,backButtonHint:h(16257),filter:!1,calendar:!1,listeners:{backButtonClick:function(){$app.navigation().redirect("company_settings_configuration")}},actions:[{xtype:"Button",label:h(13865),name:"export_usertypes",listeners:{click:this.onBtnExportClick.bind(this)}},{xtype:"Button",label:h(13295),name:"import_usertypes",listeners:{click:this.onBtnImportClick.bind(this)}}]});
this.panel.render(this.content)},initTranslations:function(){this.tabsData=[{label:"general",title:h(10465)},{label:"display",title:h(16062)},{label:"filter",title:h(16013)}]},resume:function(){this.initTranslations();this.setState("formChanged",!1);this.setState("permissionModified",!1);this.setState("initialLoad",!1);this.triggerFunction("layout.tabs.set",{tabs:0,show:0});this.triggerFunction("layout.menu.changeTitle",{label:"company_settings_user_types",url:"",name:_DATA.glossary.action_links.company_settings_user_types,
params:{}});$(".context").dblclick(function(c){c.preventDefault();return!1});this.createPanelTitle();this.getState("restore")||(this.setState("initialLoad",!0),this.initModels());this.initViews();this.showInitialViews();this.initImportForm();$.when(this.initialGeneralDataMapper.load(this.initialGeneralModel),this.initialDisplayDataMapper.load(this.initialDisplayModel),this.initialFilterDataMapper.load(this.initialFilterModel),this.initialApiDataMapper.load(this.initialApiModel),this.typesListMapper.load(this.typesListCollection)).done(function(){if(this.getState("restore")){var c=
this.getState("currentUserTypeModel");this.showPanelContent(c)}else this.showPanelContent()}.bind(this)).fail(function(c){this.sandbox.error(c);this.showError(h(16011))}.bind(this))},initModels:function(){var c=new d.userTypes.ServerConnector(this.triggerFunction,"usertype"),b=new d.userTypes.dataMappers.BaseDataMapper(c),e=new d.userTypes.dataMappers.BaseCollectionDataMapper(c,b);this.userTypeMapper=new d.userTypes.dataMappers.UserTypeDataMapper(c);this.typesListMapper=new d.userTypes.dataMappers.TypesListDataMapper(c,
this.userTypeMapper);this.typesListCollection=this.typesListMapper.create();this.initialGeneralDataMapper=new d.userTypes.dataMappers.InitialGeneralDataMapper(c);this.initialGeneralModel=this.initialGeneralDataMapper.create();this.getState("currentUserTypeModel")||this.setState("currentUserTypeModel",this.userTypeMapper.create());var g=this.getState("currentUserTypeModel"),g={login_policy_id:new d.userTypes.dataMappers.LoginPolicyDataMapper(c,b,this.initialGeneralModel),applications:new d.userTypes.dataMappers.ApplicationDataMapper(c,
b,this.initialGeneralModel),managed_user_types:new d.userTypes.dataMappers.ManagedTypesDataMapper(c,b,this.initialGeneralModel),managed_by_user_types:new d.userTypes.dataMappers.ManagedTypesDataMapper(c,b,this.initialGeneralModel),permissions:new d.userTypes.NullDataMapper(c,b,this.initialGeneralModel),interface_permissions:new d.userTypes.dataMappers.InterfacePermissionsDataMapper(c,b,this.initialGeneralModel,g),feature_permissions:new d.userTypes.dataMappers.FeaturePermissionsDataMapper(c,b,this.initialGeneralModel,
g),collaboration_permissions:new d.userTypes.dataMappers.CollaborationPermissionsDataMapper(c,b,this.initialGeneralModel,g),activity_permissions:new d.userTypes.dataMappers.ActivityPermissionsDataMapper(c,b,this.initialGeneralModel,g),resource_permissions:new d.userTypes.dataMappers.ResourcePermissionsDataMapper(c,b,this.initialGeneralModel,g)};this.generalSettingsMapper=new d.userTypes.dataMappers.GeneralSettingsDataMapper(c,g);this.generalSettingsModel=this.generalSettingsMapper.create();this.initialDisplayDataMapper=
new d.userTypes.dataMappers.InitialDisplayDataMapper(c);this.initialDisplayModel=this.initialDisplayDataMapper.create();g=new d.userTypes.dataMappers.ContextsItemDataMapper(null,{parents:e});g={type_id:new d.userTypes.NullDataMapper,label:new d.userTypes.NullDataMapper,translation:new d.userTypes.NullDataMapper,login_policy_id:new d.userTypes.NullDataMapper,status:new d.userTypes.NullDataMapper,mobility:new d.userTypes.dataMappers.MobilityContextsDataMapper(c,g,this.initialDisplayModel),general:new d.userTypes.dataMappers.GeneralContextsDataMapper(c,
g,this.initialDisplayModel),shared_with:new d.userTypes.dataMappers.DisplaySharedWithDataMapper(c,b,this.initialDisplayModel)};this.displaySettingsMapper=new d.userTypes.dataMappers.DisplaySettingsDataMapper(c,g);this.displaySettingsModel=this.displaySettingsMapper.create();this.configDisplayMapper=new d.userTypes.dataMappers.ConfigDisplayMapper(c);this.configDisplayModel=this.configDisplayMapper.create();this.initialFilterDataMapper=new d.userTypes.dataMappers.InitialFilterDataMapper(c);this.initialFilterModel=
this.initialFilterDataMapper.create();g={fieldrestrictions:new d.userTypes.dataMappers.RestrictionsDataMapper(c,b,this.initialFilterModel),filters:new d.userTypes.dataMappers.FilterVisibleDataMapper(c,b,this.initialFilterModel),shared_with:new d.userTypes.dataMappers.DisplaySharedWithDataMapper(c,b,this.initialDisplayModel)};this.filterSettingsMapper=new d.userTypes.dataMappers.FilterSettingsMapper(c,g);this.filterSettingsModel=this.filterSettingsMapper.create();this.tabsMapper=e;this.tabsCollection=
this.tabsMapper.create(this.tabsData);this.initialApiDataMapper=new d.userTypes.dataMappers.InitialApiDataMapper(c);this.initialApiModel=this.initialApiDataMapper.create();e={layouts:new d.userTypes.dataMappers.ApiLayoutsDataMapper(c,b,this.initialApiModel),permissions:new d.userTypes.dataMappers.ApiPermissionsDataMapper(c,b,this.initialApiModel)};this.apiSettingsMapper=new d.userTypes.dataMappers.ApiSettingsDataMapper(c,e);this.apiSettingsModel=this.apiSettingsMapper.create();this.layoutMapper=new d.userTypes.dataMappers.LayoutMapper(c,
b);c=function(){this.setState("formChanged",!0);this.settingsButtonsView.clearNotification()}.bind(this);this.generalSettingsModel.addListener("all",c);this.apiSettingsModel.addListener("all",c);this.filterSettingsModel.addListener("all",c)},initViews:function(){this.containerView=new d.views.userTypes.Container;this.settingsView=new d.views.userTypes.Settings;this.settingsButtonsView=new d.views.userTypes.SettingsButtons;this.typesListPanelView=new d.views.userTypes.TypesListPanel;this.typesListControlsView=
new d.views.userTypes.TypesListControls;this.typesListView=new d.views.userTypes.TypesList({collection:this.typesListCollection});this.settingsTabsView=new d.views.userTypes.SettingsTabs({collection:this.tabsCollection});this.generalTabView=new d.views.userTypes.GeneralTab({model:this.generalSettingsModel});this.generalTabView.addListener("permission:changed",function(c,b,d,g,k,l){g.set({assigned:k},{silent:l||!1});this.setState("permissionModified",!0)}.bind(this));this.displayTabView=new d.views.userTypes.DisplayTab({model:this.displaySettingsModel});
this.filterTabView=new d.views.userTypes.FilterTab({model:this.filterSettingsModel});this.filterTabView.addListener("filter:layout",this.onClickContext,this);this.filterTabView.addListener("filter:restriction",function(c,b,d,g){if(c=this.filterSettingsModel.get("fieldrestrictions")){b=$.extend({},c.get(d));var k={};b.value=g;k[d]=b;c.set(k)}}.bind(this));this.filterTabView.addListener("filter:visible",function(c,b,d,g,k){(c=this.filterSettingsModel.get("filters").find("filter_id",g))&&c.set({assigned:k})}.bind(this));
this.apiTabView=new d.views.userTypes.apiTab({model:this.apiSettingsModel});this.apiTabView.addListener("api:interface",function(c,b,d,g,k){if(c=this.apiSettingsModel.get("permissions").find("module_id",d))c.set({assigned:g}),c.set({user_type_access:k});return!1}.bind(this));this.apiTabView.addListener("api:render",function(c,b){if(this.getState("restore")){var d=this.getState("apiSection");b.setActiveSection(d)}}.bind(this));this.apiTabView.addListener("api:layout",this.onClickContext,this);this.apiTabView.addListener("section:selected",
function(c,b,d){this.setState("apiSection",d)}.bind(this));this.typesListView.addListener("type:selected",this.onTypeSelected.bind(this));this.settingsTabsView.addListener("tab:selected",this.onTabSelected.bind(this));this.displayTabView.addListener("section:selected",function(c,b,d){this.setState("displaySection",d)}.bind(this));this.displayTabView.addListener("context:clicked",this.onClickContext,this);this.displayTabView.addListener("config:clicked",this.onClickConfigDisplay.bind(this));this.typesListControlsView.addListener("typeaction:add",
this.onUserTypeAdd,this);this.typesListControlsView.addListener("typeaction:delete",this.onUserTypeDelete,this);this.settingsButtonsView.addListener("save:clicked",this.onClickSave.bind(this))},initImportForm:function(){this.importUploadForm=new d.views.userTypes.ImportUploadForm;this.importUploadForm.addListener("import.validate",function(c,b,e){c=(c=e.get("fileName"))?r(18983,{"{FILE_NAME}":c}):"";e=e.get("importSessionId");this.importForm=new d.views.userTypes.ImportForm;this.importUploadForm.closeForm();
this.importForm.show(c,e);this.importForm.addListener("import.finish",this.afterImport,this)}.bind(this))},afterImport:function(){this.afterChangeUserType(!0)},onClickSave:function(){this.saveTab().done(this.showTab.bind(this))},showInitialViews:function(){this.screen=$('<div id="toa-usertypes-screen"></div>');this.content.append(this.screen);this.containerView.render(this.screen);this.containerView.showRegion("rightPanel",this.settingsView);this.containerView.showRegion("leftPanel",this.typesListPanelView)},
showPanelContent:function(c){var b=-1;this.typesListPanelView.showRegion("controls",this.typesListControlsView);this.typesListPanelView.showRegion("list",this.typesListView);this.settingsView.showRegion("tabs",this.settingsTabsView);c&&(b=this.typesListView.setActiveItem(c,!1,!0));0>b&&this.typesListView.selectFirst()},loadTabData:function(c){var b=this[c+"SettingsModel"],d=this[c+"SettingsMapper"];b.set({id:this.getState("currentUserTypeModel").getId()},{silent:!0});return d.load(b).done(function(){"general"===
c&&this.processTab()}.bind(this)).fail(function(b){this.sandbox.error(b);this.showError(h(16016))}.bind(this))},showTab:function(c,b){var d=this.getState("tab"),g=this.tabsData[0].label;c=c||g;if(this.getState("initialLoad"))this.setState("initialLoad",!1),c=g,d=null;else if(c!==g&&!this.isTabEnabled(c)){this.processTab();this.setState("tab",g);this.showTabContent(g,d,b);return}this.setState("tab",c);this.loadTabData(c).done(function(){this.showTabContent(c,d,b)}.bind(this))},showTabContent:function(c,
b,d){if(c){var g=this[c+"TabView"],k=this[b+"TabView"];if("display"===c){var l=this.generalSettingsModel.get("interface_permissions"),n=this.displayTabView.regions,l=l.find("label","mobile");n.mobility.disabled=l&&!l.get("assigned")}k&&c!==b&&k.destroy.apply(k);this.settingsTabsView.highlightTab(c);this.settingsView.showRegion("tabContent",g);this.getState("restore")&&("display"===c&&(b=this.getState("displaySection"),g.setActiveItem(b)),this.setState("restore",!1));this.settingsView.showRegion("statusBar",
this.settingsButtonsView);this.settingsButtonsView.setBtnVisible("Save","display"!==c);this.settingsButtonsView.setBtnDisabled("Save",!1);d&&(c=h(394),this.getState("permissionModified")&&(c=h(16052),this.setState("permissionModified",!1)),this.settingsButtonsView.showNotification(c))}},saveTab:function(){var c=this.getState("tab"),b=this[c+"TabView"];if(b.validate&&!b.validate())return!1;var d=$.Deferred();this.settingsButtonsView.setBtnDisabled("Save",!0);this.saveTabData(c).done(function(){b.notify("action:save",
b);this.setState("formChanged",!1);if("general"===c)return this.afterChangeUserType(!0).done(function(){d.resolve(c,b,!0)}).fail(function(g){d.reject(c,b,!1)}),!1;d.resolve(c,b,!0)}.bind(this)).fail(function(g){var k=16010;3===g?k=16019:this.sandbox.error(g);this.showError(h(k));this.settingsButtonsView.setBtnDisabled("Save",!1);d.reject(c,b,!1)}.bind(this));return d.promise()},saveTabData:function(c){return this[c+"SettingsMapper"].save(this[c+"SettingsModel"])},isTabEnabled:function(c){var b=this.generalSettingsModel.get("interface_permissions");
return"api"===c?(c=b.find("label","api"))&&c.get("assigned"):!0},processTab:function(){$.each(["display","api"],function(c,b){this.isTabEnabled(b)?this.settingsTabsView.enableTab(b):this.settingsTabsView.disableTab(b)}.bind(this))},refreshTypeList:function(){var c=this.typesListView,b=c.getActiveItem(),d=c.getViewIndexByModel(b);this.typesListPanelView.showRegion("list",c);0>c.setActiveItem(b,!0,!0)&&(b=c.getSiblingChildView(d),c.setActiveItem(b,!1,!0))},onClickConfigDisplay:function(c,b){var e=this.compactTypesList(),
g=e.find("id",this.getState("currentUserTypeModel").getId()),k=b.collection.pluck("name"),k={action:"share",source_type_id:null,translation:"",user_type_id:this.getState("currentUserTypeModel").getId(),shared_with:k};g&&(k=$.extend(k,{translation:g.get("translation"),profileId:g.get("profileId")}),g.remove({silent:!0}));this.configDisplayModel.set(k,{silent:!0});e=new d.views.userTypes.ConfigSharedDisplay({model:this.configDisplayModel,collection:e});e.addListener("share:update",this.onUpdateConfigDisplay.bind(this));
e.addListener("action:cancel",this.onCancelConfigDisplay.bind(this));e.addListener("action:save",this.onSaveConfigDisplay.bind(this));this.settingsView.showRegion("tabContent",e)},onUpdateConfigDisplay:function(c,b,d){this.configDisplayModel.set({action:b,source_type_id:d?d:null})},onCancelConfigDisplay:function(c){this.showTab("display")},onSaveConfigDisplay:function(c){this.configDisplayMapper.save(this.configDisplayModel).done(this.afterSaveConfigDisplay.bind(this)).fail(function(b){this.sandbox.error(b);
this.showError(h(15918))}.bind(this))},afterSaveConfigDisplay:function(){this.afterChangeUserType().done(function(){this.showTab("display",!0)}.bind(this))},onClickContext:function(c,b,d,g){var k=function(){var b=d.get("layout_id"),c=g||d.get("type")||"";"mobile_print_route"===d.get("label")&&"wysiwyg"===c&&(c="grid");if(!b){this.clickOnContext++;if(2<=this.clickOnContext)return this.clickOnContext=0,!1;var k=this.layoutMapper.create(),b={type:"api"===g?"api":"display",context_id:d.get("context_id"),
user_type_id:this.getState("currentUserTypeModel").getId()};this.layoutMapper.load(k,b).done(function(){var b=k.get("layout_id");this.displayLayout(b,c)}.bind(this)).fail(function(b){this.sandbox.error(b);this.showError(h(15919))}.bind(this));return!1}this.displayLayout(b,c)}.bind(this);this.getState("formChanged")?this.showChangeConfirmation().done(function(b){"save"===b?this.saveTab().done(k.bind(this)):(k(),this.setState("formChanged",!1))}.bind(this)):k()},displayLayout:function(c,b){if(!c)return!1;
this.setState("restore",!0);if("wysiwyg"===b)return d.app.trigger("layout.menu.click",{label:"company_settings_wysiwyg",url:"",name:h(15001),params:{layout_id:c,typeid:this.getState("currentUserTypeModel").getId(),onClose:function(){d.app.trigger("layout.menu.click",{label:"company_settings_user_types",url:"",name:_DATA.glossary.action_links.company_settings_user_types})}}}),!1;var e=$.param({id:c,cmd:1==d.currentInterface||3==d.currentInterface?"company_settings":"config_ca_company",sub:"api"===
b?"api":"display",action:"layout_structure",output:"ajax"}),g=this;request({url:"?"+e,data:{typeid:this.getState("currentUserTypeModel").getId()},responseHandler:function(b){"undefined"===typeof b.cgData&&(g.showError(h(18116)),$('li[data-tab-label="display"]').trigger("click"))}})},onUserTypeAdd:function(c,b){var e=d.create("toa.models.userTypes.UserType",{name:"",label:"",typesList:this.typesListCollection}),g=d.create("toa.views.userTypes.UserType",{model:e}),k=new d.ui.Popup({title:h(16008),autoOpen:!0,
view:g,modal:!0,onClose:function(){k.destroy()},buttons:[{text:h(14621),position:"left",click:function(){k.destroy()}},{text:h(12252),type:"submit",position:"right",click:function(b){if(!g.validate())return!1;$(b.target).removeClass("toa-button-active").addClass("toa-button-disable");this.userTypeMapper.save(e).done(function(b){this.afterChangeUserType(!0);k.destroy()}.bind(this)).fail(function(c){var d=16003;79===c&&(d=16018);k.setErrors([{id:"errorWhileSaving",message:h(d)}]);$(b.target).removeClass("toa-button-disable").addClass("toa-button-active")}.bind(this))}.bind(this)}]})},
onUserTypeDelete:function(c,b){var e=this.typesListCollection.find("type_id",this.getState("currentUserTypeModel").getId()),g=e&&e.isRemovable()?new d.ui.Popup({title:h(13294),autoOpen:!0,html:h(16004),modal:!0,buttons:[{text:h(14621),position:"left",click:function(){g.destroy()}},{text:h(12252),type:"submit",position:"right",click:function(b){this.userTypeMapper.remove(e).done(this.afterChangeUserType.bind(this)).fail(function(b){var c=16007;3===b?c=16019:this.sandbox.error(b);this.showError(h(c)).always(this.refreshTypeList.bind(this))}.bind(this));
g.destroy()}.bind(this)}]}):new d.ui.Popup({title:h(16005),autoOpen:!0,html:h(16006),modal:!0,buttons:[{text:h(13305),type:"submit",position:"right",click:function(){g.destroy()}}]})},afterChangeUserType:function(c){var b=[this.typesListMapper.load(this.typesListCollection)];c&&b.push(this.initialGeneralDataMapper.load(this.initialGeneralModel));return $.when.apply($,b).done(this.refreshTypeList.bind(this)).fail(function(b){this.sandbox.error(b);this.showError(h(16011))}.bind(this))},showChangeConfirmation:function(){var c=
h(14603),b=h(16385),d=[{text:h(14621),position:"left",click:function(b){b.reject()}},{text:h(13242),position:"right",tpl:'<button class="popup-button toa-button">Ok</button>',click:function(b){b.resolve("discard")}},{text:h(13246),position:"right",type:"submit",click:function(b){b.resolve("save")}}];return this.showPopup(c,b,d)},onTabSelected:function(c,b,d){if(this.getState("formChanged"))return this.showChangeConfirmation().done(function(b){"save"===b?this.saveBeforeTabChange(d):"discard"===b&&
(this.setState("formChanged",!1),this.setState("permissionModified",!1),this.showTab(d))}.bind(this)),!1;this.settingsButtonsView.clearNotification();this.showTab(d)},saveBeforeTabChange:function(c){this.saveTab().done(function(b,d,g){if("general"===b&&c!==b)return this.loadTabData("general").done(function(b){this.showTab(c,g)}.bind(this)),!1;this.showTab(c,g)}.bind(this))},onTypeSelected:function(c,b,d){var g=b.model;this.clickOnContext=0;if(this.getState("formChanged"))return this.showChangeConfirmation().done(function(b){"save"===
b?this.saveTab().done(function(b,c){this.settingsView.clearContent();this.displayUserType(g,c)}.bind(this)):"discard"===b&&(this.settingsView.clearContent(),this.setState("formChanged",!1),this.setState("permissionModified",!1),this.displayUserType(g))}.bind(this)),!1;this.settingsView.clearContent();this.settingsButtonsView.clearNotification();this.displayUserType(g)},compactTypesList:function(){var c=new d.models.userTypes.BaseCollection;this.typesListCollection.each(function(b){c.add({id:b.get("type_id"),
translation:b.get("translation"),status:b.get("status"),profileId:b.get("display_profile_id"),assigned:!1},{silent:!0})});return c},displayUserType:function(c,b){var d=this.tabsData[0].label,g=this.getState("tab");this.getState("currentUserTypeModel").reset(c.toJSON());this.typesListView.setActiveItem(c,!0);if(g!==d)return this.loadTabData(d).done(function(){this.showTab(g,b)}.bind(this)),!1;this.showTab(g,b)},onBtnExportClick:function(){var c=this.compactTypesList(),b=d.create("toa.views.userTypes.FilterableExportList",
{filterSelect:!0,collection:c}),e=new d.ui.Popup({title:h(15917),width:300,autoOpen:!0,view:b,modal:!0,onClose:function(){e.destroy()},buttons:[{text:h(14621),position:"left",click:function(){e.destroy()}},{text:h(14622),position:"right",type:"submit",click:function(b){var d=[];c.each(function(b){!0!==b.get("assigned")||"undefined"!==typeof b.get("disabled")&&!1!==b.get("disabled")||d.push(b.get("id"))});if(!d.length)return e.setErrors([{id:"export",message:h(17082)}]),!1;this.exportUserTypes(d);
e.destroy();return!1}.bind(this)}]})},exportUserTypes:function(c){var b=c.length?Object.keys(c).map(function(b){return"ids[]="+c[b]}).join("&"):"";exportRequest({controller:"usertype",method:"export",ids:c.length?c:[]},b,!0)},onBtnImportClick:function(){this.importUploadForm.show()},suspend:function(c){this.destroy()},destroy:function(){this.settingsTabsView._destruct();this.settingsTabsView=null;this.containerView._destruct();this.containerView=null;this.settingsView._destruct();this.settingsView=
null;this.settingsButtonsView._destruct();this.settingsButtonsView=null;this.typesListPanelView._destruct();this.typesListPanelView=null;this.typesListControlsView._destruct();this.typesListControlsView=null;this.typesListView._destruct();this.typesListView=null;this.generalTabView._destruct();this.generalTabView=null;this.displayTabView._destruct();this.displayTabView=null;this.filterTabView._destruct();this.filterTabView=null;this.apiTabView._destruct();this.apiTabView=null;this.importUploadForm._destruct();
this.importUploadForm=null;this.importForm&&(this.importForm._destruct(),this.importForm=null);this.initialGeneralModel.destroy();this.generalSettingsModel.destroy();this.displaySettingsModel.destroy();this.configDisplayModel.destroy();this.initialFilterModel.destroy();this.filterSettingsModel.destroy();this.initialApiModel.destroy();this.apiSettingsModel.destroy();this.screen.empty();this.screen.remove()},setState:function(c,b){d.isString(c)?this.state[c]=b:d.isObject(c)?$.extend(this.state,c):!1===
c&&this.setDefaultState()},getState:function(c){return this.state[c]},setDefaultState:function(){this.state=$.extend(this.state,{restore:!1,currentUserTypeModel:null,tab:null,displaySection:0,permissionModified:!1,apiSection:0})},showError:function(c,b){c=c||h(3057);b=b||h(5651);return this.showPopup(b,c)},showPopup:function(c,b,e){c=c||"";b=b||"";var g=$.Deferred();e&&$.isArray(e)&&e.length?$.each(e,function(b,c){if("function"===typeof c.click){var d=c.click;c.click=function(){var b=Array.prototype.slice.call(arguments);
b.unshift(g);d.apply(this,b)}}}.bind(this)):e=[{text:h(445),position:"right",tpl:'<button class="popup-button toa-button"></button>',click:function(){g.reject()}}];g.always(function(){k.destroy()});var k=new d.ui.Popup({title:c,autoOpen:!0,html:b,modal:!0,onClose:function(){k.destroy();g.reject()},buttons:e});k._dom.base.id="toa-usertypes-popup";return g}}))})(toa);(function(d){var c=d.models.BaseModel;d.ns("toa.models.wmtTheme.WmtTheme",d.define(c,function(b){c.apply(this,arguments)},{idField:"label"}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.views.wmtTheme.DetailsButtons",d.define(c,function(){c.apply(this,arguments)},{events:{"click .saveButton":"onClickSave"},template:'<div class="info-message infoMessage"><%= h(394/*Settings were successfully updated*/) %></div><button type="submit" class="save-button saveButton" <% if (readOnlyMode === true) { %>  disabled  <% } %> ><%= h(12/*Save*/) %></button>',setBtnDisabled:function(b,c){if(!this._container)return!1;var d=this._container.find("."+
b+"Button");d.toggleClass("toa-button-disable",c);d.length&&d.each(function(b,d){d.toggleAttribute("disabled",c)})},onClickSave:function(b){this.notify("save:clicked",this)}}))})(toa);(function(d){d.ns("toa.views.wmtTheme.ServiceManifests",d.define(null,function(){},{},{translationsManifest:{translations:[{label:"scheduled",description:h(23834),placeholders:[]},{label:"serviceAddress",description:h(23835),placeholders:[]},{label:"detailsOfService",description:h(23836),placeholders:[]},{label:"notAssignedTechnicianWillArriveBetween1Line",description:h(23837),placeholders:["{ARRIVAL_TIME_RANGE}"]},{label:"notAssignedTechnicianWillArriveBetween2Line",description:h(23837),placeholders:["{ARRIVAL_TIME_RANGE}"]},
{label:"notAssignedTechnicianWillArriveDay1Line",description:h(23839),placeholders:[]},{label:"notAssignedTechnicianWillArriveDay2Line",description:h(23839),placeholders:[]},{label:"technicianWillArriveBetween1Line",description:h(23841),placeholders:["{ARRIVAL_TIME_RANGE}","{TECHNICIAN_NAME}"]},{label:"technicianWillArriveBetween2Line",description:h(23841),placeholders:["{ARRIVAL_TIME_RANGE}","{TECHNICIAN_NAME}"]},{label:"isYourTechnician",description:h(23843),placeholders:[]},{label:"onTheWayEta",
description:h(23844),placeholders:[]},{label:"hasArrived",description:h(23845),placeholders:[]},{label:"onTheWayTime1Line",description:h(23846),placeholders:["{TECHNICIAN_NAME}","{ETA}"]},{label:"onTheWayTime2Line",description:h(23846),placeholders:["{TECHNICIAN_NAME}","{ETA}"]},{label:"assigned",description:h(23850),placeholders:["{TECHNICIAN_NAME}"]},{label:"onTheWay",description:h(225508),placeholders:["{TECHNICIAN_NAME}"]},{label:"arrived",description:h(225509),placeholders:["{TECHNICIAN_NAME}"]},
{label:"feedbackHeader",description:h(225510),placeholders:[]},{label:"feedbackRatioQuestion",description:h(225511),placeholders:["{TECHNICIAN_NAME}"]},{label:"feedbackMessagePlaceholder",description:h(225512),placeholders:[]},{label:"btnCancel",description:h(225513),placeholders:[]},{label:"btnRescheduled",description:h(225514),placeholders:[]},{label:"feedbackSubmitButton",description:h(225515),placeholders:[]},{label:"btnCurrentLocation",description:h(225516),placeholders:[]},{label:"companyName",
description:h(225517),placeholders:[]},{label:"altTechnicianPhoto",description:h(225518),placeholders:["{TECHNICIAN_NAME}"]},{label:"willArrive",description:h(225519),placeholders:[]},{label:"onTheWayTimeLine",description:h(225520),placeholders:["{ETA}"]},{label:"finalScreenTitle",description:h(225521),placeholders:[]},{label:"timeAtTitle",description:h(225522),placeholders:[]},{label:"cancelActivityConfirmationMessage",description:h(225523),placeholders:[]},{label:"cancelActivityConfirmationSubmit",
description:h(225524),placeholders:[]},{label:"cancelActivityConfirmationDismiss",description:h(225525),placeholders:[]},{label:"activityActionOtherError",description:h(225692),placeholders:[]},{label:"activityActionNetworkError",description:h(225693),placeholders:[]}],placeholders:{"{TECHNICIAN_NAME}":h(225526),"{ETA}":h(225527),"{ARRIVAL_TIME_RANGE}":h(225528)}},supportedLanguages:"cs da de el en es fi fr hi hu it ja ko nb nl no pl pt ro ru sv tr tw zh".split(" "),defaultLanguageISO:"en-US",defaultTranslations:{scheduled:{cs:"Slu\u017eba je pl\u00e1nov\u00e1na",
da:"Din service er tidsplanlagt.",de:"Der Service ist terminiert",el:"\u0397 \u03c5\u03c0\u03b7\u03c1\u03b5\u03c3\u03af\u03b1 \u03c3\u03b1\u03c2 \u03c0\u03c1\u03bf\u03b3\u03c1\u03b1\u03bc\u03bc\u03b1\u03c4\u03af\u03c3\u03c4\u03b7\u03ba\u03b5",en:"Your service is scheduled",es:"El servicio est\u00e1 programado",fi:"Palvelu on ajoitettu",fr:"Votre service est planifi\u00e9",hi:"\u0906\u092a\u0915\u093e \u0938\u0930\u094d\u0935\u093f\u0938 \u0938\u092e\u092f \u0928\u093f\u0930\u094d\u0927\u093e\u0930\u093f\u0924 \u0915\u093f\u092f\u093e \u0917\u092f\u093e \u0939\u0948",
hu:"Szolg\u00e1ltat\u00e1sa \u00fctemezve",it:"Il servizio \u00e8 pianificato",ja:"\u30b5\u30fc\u30d3\u30b9\u306f\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3055\u308c\u3066\u3044\u307e\u3059",ko:"\uc11c\ube44\uc2a4\uac00 \uc2a4\ucf00\uc904\ub9c1\ub418\uc5c8\uc2b5\ub2c8\ub2e4.",nb:"Servicen er planlagt",nl:"Uw service is gepland.",no:"Servicen er planlagt",pl:"Us\u0142uga u\u017cytkownika zosta\u0142a zaplanowana",pt:"Seu servi\u00e7o est\u00e1 agendado",ro:"Serviciul dvs. este programat.",ru:"\u041e\u0431\u0441\u043b\u0443\u0436\u0438\u0432\u0430\u043d\u0438\u0435 \u0437\u0430\u043f\u043b\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u043e",
sv:"Service har schemalagts",tr:"Hizmetiniz \u00e7izelgelendi",tw:"\u60a8\u7684\u670d\u52d9\u5df2\u6392\u5b9a",zh:"\u5df2\u8ba1\u5212\u60a8\u7684\u670d\u52a1"},btnCancel:{cs:"Zru\u0161it",da:"Annuller",de:"Stornieren",el:"\u0386\u03ba\u03c5\u03c1\u03bf",en:"Cancel",es:"Cancelar",fi:"Peruuta",fr:"Annuler",hi:"\u0930\u0926\u094d\u0926 \u0915\u0930\u0947\u0902",hu:"M\u00e9gse",it:"Annulla",ja:"\u53d6\u6d88",ko:"\ucde8\uc18c",nb:"Avlys",nl:"Annuleren",no:"Avlys",pl:"Anuluj",pt:"Cancelar",ro:"Anulare",
ru:"\u041e\u0442\u043c\u0435\u043d\u0430",sv:"Avbryt",tr:"\u0130ptal Et",tw:"\u53d6\u6d88",zh:"\u53d6\u6d88"},btnReschedule:{cs:"P\u0159epl\u00e1novat",da:"Genplanl\u00e6g",de:"Neu terminieren",el:"\u0395\u03ba \u03bd\u03ad\u03bf\u03c5 \u03c0\u03c1\u03bf\u03b3\u03c1\u03b1\u03bc\u03bc\u03b1\u03c4\u03b9\u03c3\u03bc\u03cc\u03c2",en:"Reschedule",es:"Reprogramar",fi:"Ajoita uudelleen",fr:"Replanifier",hi:"\u0938\u0930\u094d\u0935\u093f\u0938 \u0938\u092e\u092f \u0926\u094b\u092c\u093e\u0930\u093e \u0928\u093f\u0930\u094d\u0927\u093e\u0930\u093f\u0924 \u0915\u0930\u0947\u0902",
hu:"\u00c1t\u00fctemez\u00e9s",it:"Ripianifica",ja:"\u518d\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb",ko:"\uc2a4\ucf00\uc904 \uc870\uc815",nb:"Endre tidspunkt",nl:"Opnieuw plannen",no:"Endre tidspunkt",pl:"Zaplanuj ponownie",pt:"Reagendar",ro:"Reprogramare",ru:"\u041f\u0435\u0440\u0435\u043d\u0435\u0441\u0442\u0438",sv:"Boka om",tr:"Yeniden \u00c7izelgele",tw:"\u91cd\u65b0\u6392\u5b9a",zh:"\u91cd\u65b0\u8ba1\u5212"},serviceAddress:{cs:"Servisn\u00ed adresa",da:"Serviceadresse",de:"Service-Adresse",el:"\u0394\u03b9\u03b5\u03cd\u03b8\u03c5\u03bd\u03c3\u03b7 \u03c5\u03c0\u03b7\u03c1\u03b5\u03c3\u03af\u03b1\u03c2",
en:"Service Address",es:"Direcci\u00f3n de Servicio",fi:"Palvelun osoite",fr:"Adresse de service",hi:"\u0938\u0947\u0935\u093e \u0915\u093e \u092a\u0924\u093e",hu:"Szolg\u00e1ltat\u00e1s c\u00edme",it:"Indirizzo servizio",ja:"\u30b5\u30fc\u30d3\u30b9\u30fb\u30a2\u30c9\u30ec\u30b9",ko:"\uc11c\ube44\uc2a4 \uc8fc\uc18c",nb:"Serviceadresse",nl:"Serviceadres",no:"Serviceadresse",pl:"Adres us\u0142ugi",pt:"Endere\u00e7o de Servi\u00e7o",ro:"Adres\u0103 serviciu",ru:"\u0410\u0434\u0440\u0435\u0441 \u043e\u0431\u0441\u043b\u0443\u0436\u0438\u0432\u0430\u043d\u0438\u044f",
sv:"Tj\u00e4nsteadress",tr:"Hizmet Adresi",tw:"\u670d\u52d9\u5730\u5740",zh:"\u670d\u52a1\u5730\u5740"},detailsOfService:{cs:"Slu\u017eba - detaily",da:"Detaljer om service",de:"Servicedetails",el:"\u039b\u03b5\u03c0\u03c4\u03bf\u03bc\u03ad\u03c1\u03b5\u03b9\u03b5\u03c2 \u03c5\u03c0\u03b7\u03c1\u03b5\u03c3\u03af\u03b1\u03c2",en:"Details of Service",es:"Detalles de Servicio",fi:"Palvelun tiedot",fr:"D\u00e9tails du service",hi:"\u0938\u0930\u094d\u0935\u093f\u0938 \u0935\u093f\u0935\u0930\u0923",hu:"Szolg\u00e1ltat\u00e1s adatai",
it:"Dettagli servizio",ja:"\u30b5\u30fc\u30d3\u30b9\u306e\u8a73\u7d30",ko:"\uc11c\ube44\uc2a4 \uc138\ubd80\uc815\ubcf4",nb:"Detaljer om service",nl:"Details van service",no:"Detaljer om service",pl:"Szczeg\u00f3\u0142y us\u0142ugi",pt:"Detalhes do Servi\u00e7o",ro:"Detalii serviciu",ru:"\u0421\u0432\u0435\u0434\u0435\u043d\u0438\u044f \u043e\u0431 \u043e\u0431\u0441\u043b\u0443\u0436\u0438\u0432\u0430\u043d\u0438\u0438",sv:"Servicedetaljer",tr:"Hizmet Detaylar\u0131",tw:"\u670d\u52d9\u8a73\u7d30\u8cc7\u6599",
zh:"\u670d\u52a1\u8be6\u7ec6\u4fe1\u606f"},technicianWillArriveBetween1Line:{cs:"Doraz\u00ed mezi:",da:"Vil ankomme mellem",de:"kommt zwischen",el:"\u0386\u03c6\u03b9\u03be\u03b7 \u03bc\u03b5\u03c4\u03b1\u03be\u03cd",en:"Will arrive between",es:"Llegar\u00e1 entre",fi:"Saapuu aikav\u00e4lill\u00e4",fr:"Va arriver entre",hi:"\u0906\u0917\u092e\u0928 \u0938\u092e\u092f",hu:"Ki\u00e9rkez\u00e9s id\u0151k\u00f6ze",it:"Arrivo previsto tra",ja:"\u6b21\u306e\u6642\u9593\u306e\u9593\u306b\u5230\u7740\u3057\u307e\u3059",
ko:"\ub3c4\ucc29 \uc608\uc815 \uc2dc\uac04:",nb:"Ankommer mellom",nl:"Zal aankomen tussen",no:"Ankommer mellom",pl:"Przybycie pomi\u0119dzy",pt:"Chegar\u00e1 entre",ro:"Va ajunge \u00eentre",ru:"\u041f\u0440\u0438\u0431\u044b\u0442\u0438\u0435 \u043c\u0435\u0436\u0434\u0443",sv:"anl\u00e4nder mellan",tr:"\u015eu saatler aras\u0131nda gelecek:",tw:"\u9810\u8a08\u62b5\u9054\u6642\u9593\u4ecb\u65bc",zh:"\u5c06\u5230\u8fbe\u7684\u65f6\u95f4\u8303\u56f4"},technicianWillArriveBetween2Line:{cs:"{ARRIVAL_TIME_RANGE}",
da:"{ARRIVAL_TIME_RANGE}",de:"{ARRIVAL_TIME_RANGE}",el:"{ARRIVAL_TIME_RANGE}",en:"{ARRIVAL_TIME_RANGE}",es:"{ARRIVAL_TIME_RANGE}",fi:"{ARRIVAL_TIME_RANGE}",fr:"{ARRIVAL_TIME_RANGE}",hi:"{ARRIVAL_TIME_RANGE}",hu:"{ARRIVAL_TIME_RANGE}",it:"{ARRIVAL_TIME_RANGE}",ja:"{ARRIVAL_TIME_RANGE}",ko:"{ARRIVAL_TIME_RANGE}",nb:"{ARRIVAL_TIME_RANGE}",nl:"{ARRIVAL_TIME_RANGE}",no:"{ARRIVAL_TIME_RANGE}",pl:"{ARRIVAL_TIME_RANGE}",pt:"{ARRIVAL_TIME_RANGE}",ro:"{ARRIVAL_TIME_RANGE}",ru:"{ARRIVAL_TIME_RANGE}",sv:"{ARRIVAL_TIME_RANGE}",
tr:"{ARRIVAL_TIME_RANGE}",tw:"{ARRIVAL_TIME_RANGE}",zh:"{ARRIVAL_TIME_RANGE}"},notAssignedTechnicianWillArriveBetween1Line:{cs:"Technik doraz\u00ed mezi:",da:"En tekniker vil ankomme mellem",de:"Ein Techniker kommt zwischen",el:"\u0388\u03bd\u03b1\u03c2 \u03c4\u03b5\u03c7\u03bd\u03b9\u03ba\u03cc\u03c2 \u03b8\u03b1 \u03b1\u03c6\u03b9\u03c7\u03b8\u03b5\u03af \u03bc\u03b5\u03c4\u03b1\u03be\u03cd",en:"A technician will arrive between",es:"Un t\u00e9cnico llegar\u00e1 entre",fi:"Teknikko saapuu aikav\u00e4lill\u00e4",
fr:"Un technicien va arriver entre",hi:"\u0924\u0915\u0928\u0940\u0936\u093f\u092f\u0928 \u0915\u0947 \u0906\u0917\u092e\u0928 \u0915\u093e \u0938\u092e\u092f",hu:"A technikus ki\u00e9rkez\u00e9s\u00e9nek id\u0151k\u00f6ze",it:"Un tecnico arriver\u00e0 tra",ja:"\u6280\u8853\u8005\u306f\u6b21\u306e\u6642\u9593\u306e\u9593\u306b\u5230\u7740\u3057\u307e\u3059",ko:"\uae30\uc220\uc790 \ub3c4\ucc29 \uc608\uc815 \uc2dc\uac04:",nb:"En tekniker ankommer mellom",nl:"Er zal een technicus aankomen tussen",no:"En tekniker ankommer mellom",
pl:"Technik przyb\u0119dzie pomi\u0119dzy",pt:"Um t\u00e9cnico chegar\u00e1 entre",ro:"Un tehnician va ajunge \u00eentre",ru:"\u0421\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442 \u043f\u0440\u0438\u0431\u0443\u0434\u0435\u0442 \u043c\u0435\u0436\u0434\u0443",sv:"En tekniker anl\u00e4nder mellan",tr:"Teknisyen \u015fu saatler aras\u0131nda gelecek:",tw:"\u6280\u8853\u54e1\u9810\u8a08\u62b5\u9054\u6642\u9593\u4ecb\u65bc",zh:"\u6280\u672f\u4eba\u5458\u5c06\u5230\u8fbe\u7684\u65f6\u95f4\u8303\u56f4"},
notAssignedTechnicianWillArriveBetween2Line:{cs:"{ARRIVAL_TIME_RANGE}",da:"{ARRIVAL_TIME_RANGE}",de:"{ARRIVAL_TIME_RANGE}",el:"{ARRIVAL_TIME_RANGE}",en:"{ARRIVAL_TIME_RANGE}",es:"{ARRIVAL_TIME_RANGE}",fi:"{ARRIVAL_TIME_RANGE}",fr:"{ARRIVAL_TIME_RANGE}",hi:"{ARRIVAL_TIME_RANGE}",hu:"{ARRIVAL_TIME_RANGE}",it:"{ARRIVAL_TIME_RANGE}",ja:"{ARRIVAL_TIME_RANGE}",ko:"{ARRIVAL_TIME_RANGE}",nb:"{ARRIVAL_TIME_RANGE}",nl:"{ARRIVAL_TIME_RANGE}",no:"{ARRIVAL_TIME_RANGE}",pl:"{ARRIVAL_TIME_RANGE}",pt:"{ARRIVAL_TIME_RANGE}",
ro:"{ARRIVAL_TIME_RANGE}",ru:"{ARRIVAL_TIME_RANGE}",sv:"{ARRIVAL_TIME_RANGE}",tr:"{ARRIVAL_TIME_RANGE}",tw:"{ARRIVAL_TIME_RANGE}",zh:"{ARRIVAL_TIME_RANGE}"},onTheWayTime1Line:{cs:"Doraz\u00ed p\u0159ibli\u017en\u011b za",da:"Ankommer om ca.",de:"Ankunft in etwa",el:"\u0386\u03c6\u03b9\u03be\u03b7 \u03c0\u03b5\u03c1\u03af\u03c0\u03bf\u03c5",en:"Arriving in about",es:"Llegando en",fi:"Saapuu arviolta",fr:"Va arriver dans environ",hi:"\u0906\u0917\u092e\u0928 \u0915\u093e \u0905\u0928\u0941\u092e\u093e\u0928\u093f\u0924 \u0938\u092e\u092f",
hu:"Ki\u00e9rkez\u00e9s k\u00f6r\u00fclbel\u00fcl",it:"In arrivo tra circa",ja:"\u3060\u3044\u305f\u3044\u6b21\u306e\u6642\u9593\u306b\u5230\u7740\u3057\u307e\u3059",ko:"\ub3c4\ucc29 \uc608\uc815 \uc2dc\uac04:",nb:"Ankommer om ca.",nl:"Komt aan in ongeveer",no:"Ankommer om ca.",pl:"Przybycie za oko\u0142o",pt:"Chegando em aproximadamente",ro:"Va ajunge \u00een aprox.",ru:"\u041f\u0440\u0438\u0431\u044b\u0442\u0438\u0435 \u043e\u043a\u043e\u043b\u043e",sv:"Anl\u00e4nder om cirka",tr:"Yakla\u015f\u0131k gelme zaman\u0131:",
tw:"\u9810\u8a08\u62b5\u9054\u6642\u9593\uff1a",zh:"\u5230\u8fbe\u7684\u5927\u81f4\u65f6\u95f4"},onTheWayTime2Line:{cs:"{ETA}",da:"{ETA}",de:"{ETA}",el:"{ETA}",en:"{ETA}",es:"{ETA}",fi:"{ETA}",fr:"{ETA}",hi:"{ETA}",hu:"{ETA}",it:"{ETA}",ja:"{ETA}",ko:"{ETA}",nb:"{ETA}",nl:"{ETA}",no:"{ETA}",pl:"{ETA}",pt:"{ETA}",ro:"{ETA}",ru:"{ETA}",sv:"{ETA}",tr:"{ETA}",tw:"{ETA}",zh:"{ETA}"},technicianWillArriveDay1Line:{cs:"Doraz\u00ed:",da:"Vil ankomme",de:"kommt",el:"\u0386\u03c6\u03b9\u03be\u03b7",en:"Will arrive",
es:"Llegar\u00e1 a las",fi:"Saapuu",fr:"Va arriver",hi:"\u0906\u0917\u092e\u0928 \u0938\u092e\u092f",hu:"V\u00e1rhat\u00f3 ki\u00e9rkez\u00e9s",it:"Arrivo previsto",ja:"\u6b21\u306e\u6642\u9593\u306b\u5230\u7740\u3057\u307e\u3059",ko:"\ub3c4\ucc29 \uc608\uc815 \uc2dc\uac04:",nb:"Ankommer",nl:"Zal aankomen",no:"Ankommer",pl:"Przyb\u0119dzie",pt:"Chegar\u00e1",ro:"Va ajunge",ru:"\u041f\u0440\u0438\u0431\u044b\u0442\u0438\u0435",sv:"anl\u00e4nder",tr:"Gelme zaman\u0131:",tw:"\u9810\u8a08\u62b5\u9054\u6642\u9593\u70ba",
zh:"\u5c06\u5230\u8fbe\u7684\u65f6\u95f4"},technicianWillArriveDay2Line:{cs:"b\u011bhem dne",da:"i l\u00f8bet af dagen",de:"im Laufe des Tages",el:"\u03c3\u03c4\u03b7 \u03b4\u03b9\u03ac\u03c1\u03ba\u03b5\u03b9\u03b1 \u03c4\u03b7\u03c2 \u03b7\u03bc\u03ad\u03c1\u03b1\u03c2",en:"during the day",es:"durante el d\u00eda",fi:"p\u00e4iv\u00e4n aikana",fr:"dans la journ\u00e9e",hi:"\u0926\u093f\u0928 \u092e\u0947\u0902",hu:"a nap folyam\u00e1n",it:"in giornata",ja:"\u65e5\u4e2d",ko:"\ud574\ub2f9\uc77c \uc911",
nb:"i l\u00f8pet av dagen",nl:"overdag",no:"i l\u00f8pet av dagen",pl:"w ci\u0105gu dnia",pt:"durante o dia",ro:"\u00een timpul zilei",ru:"\u0432 \u0442\u0435\u0447\u0435\u043d\u0438\u0435 \u0434\u043d\u044f",sv:"under dagen",tr:"g\u00fcn i\u00e7inde",tw:"\u7576\u65e5\u5167",zh:"\u767d\u5929"},notAssignedTechnicianWillArriveDay1Line:{cs:"Technik doraz\u00ed:",da:"En tekniker vil ankomme",de:"Ein Techniker kommt",el:"\u0388\u03bd\u03b1\u03c2 \u03c4\u03b5\u03c7\u03bd\u03b9\u03ba\u03cc\u03c2 \u03b8\u03b1 \u03b1\u03c6\u03b9\u03c7\u03b8\u03b5\u03af",
en:"A technician will arrive",es:"Un t\u00e9cnico llegar\u00e1",fi:"Teknikko saapuu viikonp\u00e4iv\u00e4n\u00e4",fr:"Un technicien va arriver",hi:"\u0924\u0915\u0928\u0940\u0936\u093f\u092f\u0928",hu:"A technikus v\u00e1rhat\u00f3 ki\u00e9rkez\u00e9se",it:"Un tecnico arriver\u00e0",ja:"\u6280\u8853\u8005\u306f\u6b21\u306e\u66dc\u65e5\u306b\u5230\u7740\u3057\u307e\u3059",ko:"\uae30\uc220\uc790 \ub3c4\ucc29 \uc608\uc815 \uc694\uc77c:",nb:"En tekniker ankommer",nl:"Er zal een technicus aankomen op",
no:"En tekniker ankommer",pl:"Technik przyb\u0119dzie",pt:"Um t\u00e9cnico chegar\u00e1",ro:"Un tehnician va ajunge \u00eentre",ru:"\u0421\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442 \u043f\u0440\u0438\u0431\u0443\u0434\u0435\u0442",sv:"En tekniker anl\u00e4nder",tr:"Teknisyen \u015fu g\u00fcn gelecek:",tw:"\u6280\u8853\u54e1\u9810\u8a08\u62b5\u9054\u6642\u9593\u70ba",zh:"\u6280\u672f\u4eba\u5458\u5c06\u5230\u8fbe\u7684\u65f6\u95f4"},notAssignedTechnicianWillArriveDay2Line:{cs:"b\u011bhem dne",
da:"i l\u00f8bet af dagen",de:"im Laufe des Tages",el:"\u03c3\u03c4\u03b7 \u03b4\u03b9\u03ac\u03c1\u03ba\u03b5\u03b9\u03b1 \u03c4\u03b7\u03c2 \u03b7\u03bc\u03ad\u03c1\u03b1\u03c2",en:"during the day",es:"durante el d\u00eda",fi:"p\u00e4iv\u00e4n aikana",fr:"dans la journ\u00e9e",hi:"\u0915\u093e \u0906\u0917\u092e\u0928 \u0926\u093f\u0928 \u092e\u0947\u0902 \u0939\u094b\u0917\u093e",hu:"a nap folyam\u00e1n",it:"in giornata",ja:"\u65e5\u4e2d",ko:"\ud574\ub2f9\uc77c \uc911",nb:"i l\u00f8pet av dagen",
nl:"overdag",no:"i l\u00f8pet av dagen",pl:"w ci\u0105gu dnia",pt:"durante o dia",ro:"\u00een timpul zilei",ru:"\u0432 \u0442\u0435\u0447\u0435\u043d\u0438\u0435 \u0434\u043d\u044f",sv:"under dagen",tr:"g\u00fcn i\u00e7inde",tw:"\u7576\u65e5\u5167",zh:"\u767d\u5929"},assigned:{cs:"V\u00e1\u0161 technik se jmenuje {TECHNICIAN_NAME}",da:"{TECHNICIAN_NAME} er din tekniker",de:"{TECHNICIAN_NAME} ist Ihr Techniker",el:"\u039f {TECHNICIAN_NAME} \u03b5\u03af\u03bd\u03b1\u03b9 \u03bf \u03c4\u03b5\u03c7\u03bd\u03b9\u03ba\u03cc\u03c2 \u03c3\u03b1\u03c2",
en:"{TECHNICIAN_NAME} is your technician",es:"Su t\u00e9cnico es {TECHNICIAN_NAME}",fi:"{TECHNICIAN_NAME} on teknikkosi",fr:"{TECHNICIAN_NAME} est votre technicien",hi:"{TECHNICIAN_NAME} \u0906\u092a\u0915\u093e \u0924\u0915\u0928\u0940\u0936\u093f\u092f\u0928 \u0939\u0948",hu:"Az \u00d6n technikusa {TECHNICIAN_NAME}",it:"{TECHNICIAN_NAME} \u00e8 il tecnico assegnato",ja:"{TECHNICIAN_NAME}\u304c\u62c5\u5f53\u6280\u8853\u8005\u3067\u3059",ko:"{TECHNICIAN_NAME}\uc774(\uac00) \ub2f4\ub2f9 \uae30\uc220\uc790\uc785\ub2c8\ub2e4.",
nb:"{TECHNICIAN_NAME} er teknikeren din",nl:"{TECHNICIAN_NAME} is uw technicus.",no:"{TECHNICIAN_NAME} er teknikeren din",pl:"Pa\u0144stwa technik to: {TECHNICIAN_NAME}",pt:"{TECHNICIAN_NAME} \u00e9 o seu t\u00e9cnico",ro:"{TECHNICIAN_NAME} este tehnicianul dvs.",ru:"\u0412\u0430\u043c \u043d\u0430\u0437\u043d\u0430\u0447\u0435\u043d \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442 {TECHNICIAN_NAME}",sv:"{TECHNICIAN_NAME} \u00e4r din tekniker",tr:"Teknisyeniniz: {TECHNICIAN_NAME}",tw:"{TECHNICIAN_NAME} \u662f\u60a8\u7684\u6280\u8853\u54e1",
zh:"{TECHNICIAN_NAME} \u662f\u60a8\u7684\u6280\u672f\u4eba\u5458"},onTheWay:{cs:"Technik {TECHNICIAN_NAME} je na cest\u011b",da:"{TECHNICIAN_NAME} er p\u00e5 vej",de:"{TECHNICIAN_NAME} ist auf dem Weg",el:"\u039f \u03c4\u03b5\u03c7\u03bd\u03b9\u03ba\u03cc\u03c2 {TECHNICIAN_NAME} \u03b5\u03af\u03bd\u03b1\u03b9 \u03ba\u03b1\u03b8' \u03bf\u03b4\u03cc\u03bd",en:"{TECHNICIAN_NAME} is on the way",es:"{TECHNICIAN_NAME} est\u00e1 en camino",fi:"{TECHNICIAN_NAME} on matkalla",fr:"{TECHNICIAN_NAME} est en route",
hi:"{TECHNICIAN_NAME} \u0906 \u0930\u0939\u093e \u0939\u0948",hu:"{TECHNICIAN_NAME} \u00faton van",it:"{TECHNICIAN_NAME} \u00e8 in arrivo",ja:"{TECHNICIAN_NAME}\u306f\u3082\u3046\u3059\u3050\u5230\u7740\u3057\u307e\u3059",ko:"{TECHNICIAN_NAME}\uc774(\uac00) \uc774\ub3d9 \uc911\uc785\ub2c8\ub2e4.",nb:"{TECHNICIAN_NAME} er p\u00e5 vei",nl:"{TECHNICIAN_NAME} is onderweg.",no:"{TECHNICIAN_NAME} er p\u00e5 vei",pl:"{TECHNICIAN_NAME} jest w drodze",pt:"{TECHNICIAN_NAME} est\u00e1 a caminho",ro:"{TECHNICIAN_NAME} este pe drum",
ru:"{TECHNICIAN_NAME} \u0443\u0436\u0435 \u0432 \u043f\u0443\u0442\u0438",sv:"{TECHNICIAN_NAME} \u00e4r p\u00e5 v\u00e4g",tr:"{TECHNICIAN_NAME} yolda",tw:"{TECHNICIAN_NAME} \u5df2\u5728\u9014\u4e2d",zh:"{TECHNICIAN_NAME} \u5728\u9014\u4e2d"},arrived:{cs:"Technik {TECHNICIAN_NAME} je na m\u00edst\u011b",da:"{TECHNICIAN_NAME} er ankommet",de:"{TECHNICIAN_NAME} ist angekommen",el:"\u039f \u03c4\u03b5\u03c7\u03bd\u03b9\u03ba\u03cc\u03c2 {TECHNICIAN_NAME} \u03ad\u03c7\u03b5\u03b9 \u03b1\u03c6\u03b9\u03c7\u03b8\u03b5\u03af",
en:"{TECHNICIAN_NAME} has arrived",es:"{TECHNICIAN_NAME} ha llegado",fi:"{TECHNICIAN_NAME} on saapunut",fr:"{TECHNICIAN_NAME} est arriv\u00e9",hi:"{TECHNICIAN_NAME} \u092a\u0939\u0941\u0902\u091a \u0917\u092f\u093e \u0939\u0948",hu:"{TECHNICIAN_NAME} ki\u00e9rkezett",it:"{TECHNICIAN_NAME} \u00e8 arrivato",ja:"{TECHNICIAN_NAME}\u306f\u5230\u7740\u3057\u307e\u3057\u305f",ko:"{TECHNICIAN_NAME}\uc774(\uac00) \ub3c4\ucc29\ud588\uc2b5\ub2c8\ub2e4.",nb:"{TECHNICIAN_NAME} har ankommet",nl:"{TECHNICIAN_NAME} is aangekomen.",
no:"{TECHNICIAN_NAME} har ankommet",pl:"Przyby\u0142 technik: {TECHNICIAN_NAME}",pt:"{TECHNICIAN_NAME} chegou",ro:"{TECHNICIAN_NAME} a ajuns",ru:"{TECHNICIAN_NAME} \u0443\u0436\u0435 \u043d\u0430 \u043c\u0435\u0441\u0442\u0435",sv:"{TECHNICIAN_NAME} har anl\u00e4nt",tr:"{TECHNICIAN_NAME} geldi",tw:"{TECHNICIAN_NAME} \u5df2\u62b5\u9054",zh:"{TECHNICIAN_NAME} \u5df2\u5230\u8fbe"},feedbackHeader:{cs:"Ohodno\u0165te slu\u017eby",da:"Bed\u00f8m din service",de:"Bewerten Sie den Service",el:"\u0392\u03b1\u03b8\u03bc\u03bf\u03bb\u03bf\u03b3\u03ae\u03c3\u03c4\u03b5 \u03c4\u03b7\u03bd \u03c5\u03c0\u03b7\u03c1\u03b5\u03c3\u03af\u03b1 \u03c3\u03b1\u03c2",
en:"Rate Your Service",es:"Califique el servicio",fi:"Arvioi palvelu",fr:"Evaluez votre service",hi:"\u0905\u092a\u0928\u0940 \u0938\u0930\u094d\u0935\u093f\u0938 \u0915\u094b \u0930\u0947\u091f \u0915\u0930\u0947\u0902",hu:"\u00c9rt\u00e9kelje a szolg\u00e1ltat\u00e1st",it:"Valuta il servizio",ja:"\u30b5\u30fc\u30d3\u30b9\u306e\u8a55\u4fa1",ko:"\uc11c\ube44\uc2a4 \ud3c9\uac00",nb:"Vurder servicen",nl:"Beoordeel uw service",no:"Vurder servicen",pl:"Oce\u0144 us\u0142ug\u0119",pt:"Classifique seu Servi\u00e7o",
ro:"Evalua\u0163i serviciul",ru:"\u041e\u0446\u0435\u043d\u0438\u0442\u0435 \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u043e\u0431\u0441\u043b\u0443\u0436\u0438\u0432\u0430\u043d\u0438\u044f",sv:"Betygs\u00e4tt servicen",tr:"Hizmetinizi De\u011ferlendirin",tw:"\u670d\u52d9\u8a55\u5206",zh:"\u8bc4\u4ef7\u670d\u52a1"},feedbackRatioQuestion:{cs:"Jak jste spokojeni se slu\u017ebami technika {TECHNICIAN_NAME}?",da:"Hvordan var {TECHNICIAN_NAME}s service?",de:"Wie war der Service von {TECHNICIAN_NAME}?",
el:"\u03a0\u03ce\u03c2 \u03ae\u03c4\u03b1\u03bd \u03b7 \u03c5\u03c0\u03b7\u03c1\u03b5\u03c3\u03af\u03b1 \u03c4\u03bf\u03c5 \u03c4\u03b5\u03c7\u03bd\u03b9\u03ba\u03bf\u03cd {TECHNICIAN_NAME};",en:"How was {TECHNICIAN_NAME}'s service?",es:"\u00bfC\u00f3mo ha sido el servicio de {TECHNICIAN_NAME}?",fi:"Miten arvioisit teknikon {TECHNICIAN_NAME} palvelua?",fr:"Comment \u00e9valuez-vous le service de {TECHNICIAN_NAME} ?",hi:"{TECHNICIAN_NAME} \u0928\u0947 \u0915\u0948\u0938\u0940 \u0938\u0930\u094d\u0935\u093f\u0938 \u0915\u0940 \u0925\u0940? ",
hu:"Mennyire volt el\u00e9gedett {TECHNICIAN_NAME} szolg\u00e1ltat\u00e1s\u00e1val?",it:"Qual \u00e8 la sua valutazione del servizio di {TECHNICIAN_NAME}?",ja:"{TECHNICIAN_NAME}\u306e\u30b5\u30fc\u30d3\u30b9\u306f\u3044\u304b\u304c\u3067\u3057\u305f\u304b?",ko:"{TECHNICIAN_NAME}\uc758 \uc11c\ube44\uc2a4\ub294 \uc5b4\ub560\uc2b5\ub2c8\uae4c?",nb:"Hvordan utf\u00f8rte {TECHNICIAN_NAME} servicen?",nl:"Hoe was de service van {TECHNICIAN_NAME}?",no:"Hvordan utf\u00f8rte {TECHNICIAN_NAME} servicen?",pl:"Jak oceniaj\u0105 Pa\u0144stwo us\u0142ug\u0119 \u015bwiadczon\u0105 przez technika: {TECHNICIAN_NAME}?",
pt:"Como foi o servi\u00e7o do {TECHNICIAN_NAME}?",ro:"Cum a fost serviciul prestat de {TECHNICIAN_NAME}?",ru:"\u041a\u0430\u043a \u0440\u0430\u0431\u043e\u0442\u0430\u043b(\u0430) {TECHNICIAN_NAME}?",sv:"Hur upplevde du {TECHNICIAN_NAME}s service?",tr:"{TECHNICIAN_NAME} adl\u0131 teknisyenin hizmeti nas\u0131ld\u0131?",tw:"{TECHNICIAN_NAME} \u7684\u670d\u52d9\u5982\u4f55\uff1f",zh:"{TECHNICIAN_NAME} \u7684\u670d\u52a1\u600e\u4e48\u6837\uff1f"},feedbackMessagePlaceholder:{cs:"M\u016f\u017eete p\u0159ipojit koment\u00e1\u0159",
da:"Du kan efterlade en kommentar",de:"Sie k\u00f6nnen einen Kommentar hinterlassen",el:"\u039c\u03c0\u03bf\u03c1\u03b5\u03af\u03c4\u03b5 \u03bd\u03b1 \u03b1\u03c6\u03ae\u03c3\u03b5\u03c4\u03b5 \u03ad\u03bd\u03b1 \u03c3\u03c7\u03cc\u03bb\u03b9\u03bf",en:"You can leave a comment",es:"Puede dejar un comentario",fi:"Voit lis\u00e4t\u00e4 kommentteja",fr:"Vous pouvez laisser un commentaire",hi:"\u0906\u092a \u091f\u093f\u092a\u094d\u092a\u0923\u0940 \u0926\u0947 \u0938\u0915\u0924\u0947 \u0939\u0948\u0902",
hu:"\u00cdrhat egy visszajelz\u00e9st",it:"\u00c8 possibile lasciare un commento",ja:"\u30b3\u30e1\u30f3\u30c8\u3092\u6b8b\u3057\u3066\u304f\u3060\u3055\u3044",ko:"\uc124\uba85\uc744 \ub0a8\uae38 \uc218 \uc788\uc2b5\ub2c8\ub2e4.",nb:"Du kan skrive inn en kommentar",nl:"U kunt een opmerking achterlaten.",no:"Du kan skrive inn en kommentar",pl:"Mo\u017cna pozostawi\u0107 komentarz",pt:"Voc\u00ea pode deixar um coment\u00e1rio",ro:"Pute\u0163i l\u0103sa un comentariu",ru:"\u0412\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439",
sv:"Du kan l\u00e4mna en kommentar",tr:"Yorum b\u0131rakabilirsiniz",tw:"\u60a8\u53ef\u4ee5\u7d66\u4e88\u8a55\u8ad6",zh:"\u60a8\u53ef\u4ee5\u53d1\u8868\u8bc4\u8bba"},feedbackSubmitButton:{cs:"Odeslat",da:"Afsend",de:"Weiterleiten",el:"\u03a5\u03c0\u03bf\u03b2\u03bf\u03bb\u03ae",en:"Submit",es:"Enviar",fi:"L\u00e4het\u00e4",fr:"Soumettre",hi:"\u0938\u092c\u092e\u093f\u091f \u0915\u0930\u0947\u0902",hu:"K\u00fcld\u00e9s",it:"Sottometti",ja:"\u9001\u4fe1",ko:"\uc81c\ucd9c",nb:"Send",nl:"Versturen",no:"Send",
pl:"Prze\u015blij",pt:"Enviar",ro:"Trimitere",ru:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c",sv:"Skicka",tr:"G\u00f6nder",tw:"\u63d0\u4ea4",zh:"\u63d0\u4ea4"},btnCurrentLocation:{cs:"Aktu\u00e1ln\u00ed m\u00edsto",da:"Aktuel lokation",de:"Aktueller Standort",el:"\u03a4\u03c1\u03ad\u03c7\u03bf\u03c5\u03c3\u03b1 \u03c4\u03bf\u03c0\u03bf\u03b8\u03b5\u03c3\u03af\u03b1",en:"Current location",es:"Ubicaci\u00f3n actual",fi:"Nykyinen sijainti",fr:"Lieu actuel",hi:"\u0935\u0930\u094d\u0924\u092e\u093e\u0928 \u0938\u094d\u0925\u093e\u0928",
hu:"Aktu\u00e1lis helysz\u00edn",it:"Posizione corrente",ja:"\u73fe\u5728\u306e\u5834\u6240",ko:"\ud604\uc7ac \uc704\uce58",nb:"Gjeldende sted",nl:"Huidige locatie",no:"Gjeldende sted",pl:"Bie\u017c\u0105ca lokalizacja",pt:"Local atual",ro:"Loca\u0163ie curent\u0103",ru:"\u0422\u0435\u043a\u0443\u0449\u0435\u0435 \u0440\u0430\u0441\u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u0435",sv:"Aktuell plats",tr:"Ge\u00e7erli lokasyon",tw:"\u76ee\u524d\u4f4d\u7f6e",zh:"\u5f53\u524d\u4f4d\u7f6e"},altTechnicianPhoto:{cs:"Fotografie technika {TECHNICIAN_NAME}",
da:"{TECHNICIAN_NAME}s billede",de:"Foto von {TECHNICIAN_NAME}",el:"\u03a6\u03c9\u03c4\u03bf\u03b3\u03c1\u03b1\u03c6\u03af\u03b1 \u03c4\u03bf\u03c5 \u03c4\u03b5\u03c7\u03bd\u03b9\u03ba\u03bf\u03cd {TECHNICIAN_NAME}",en:"{TECHNICIAN_NAME}'s photo",es:"Foto de {TECHNICIAN_NAME}",fi:"Teknikon {TECHNICIAN_NAME} kuva",fr:"Photo de {TECHNICIAN_NAME}",hi:"{TECHNICIAN_NAME} \u0915\u0940 \u095e\u094b\u091f\u094b",hu:"{TECHNICIAN_NAME} f\u00e9nyk\u00e9pe",it:"Foto di {TECHNICIAN_NAME}",ja:"{TECHNICIAN_NAME}\u306e\u5199\u771f",
ko:"{TECHNICIAN_NAME}\uc758 \uc0ac\uc9c4",nb:"Bilde av {TECHNICIAN_NAME}",nl:"Foto van {TECHNICIAN_NAME}",no:"Bilde av {TECHNICIAN_NAME}",pl:"Zdj\u0119cie technika {TECHNICIAN_NAME}",pt:"Foto do {TECHNICIAN_NAME}",ro:"Fotografia tehnicianului {TECHNICIAN_NAME}",ru:"\u0424\u043e\u0442\u043e - {TECHNICIAN_NAME}",sv:"Foto p\u00e5 {TECHNICIAN_NAME}",tr:"{TECHNICIAN_NAME} adl\u0131 teknisyenin foto\u011fraf\u0131",tw:"{TECHNICIAN_NAME} \u7684\u76f8\u7247",zh:"{TECHNICIAN_NAME} \u7684\u7167\u7247"},companyName:{cs:"Spole\u010dnost",
da:"Firma",de:"Unternehmen",el:"\u0395\u03c4\u03b1\u03b9\u03c1\u03b5\u03af\u03b1",en:"Company",es:"Compa\u00f1\u00eda",fi:"Yritys",fr:"Soci\u00e9t\u00e9",hi:"\u0915\u0902\u092a\u0928\u0940",hu:"V\u00e1llalat",it:"Societ\u00e0",ja:"\u4f1a\u793e",ko:"\ud68c\uc0ac",nb:"Selskap",nl:"Bedrijf",no:"Selskap",pl:"Przedsi\u0119biorstwo",pt:"Empresa",ro:"Companie",ru:"\u041a\u043e\u043c\u043f\u0430\u043d\u0438\u044f",sv:"F\u00f6retag",tr:"\u015eirket",tw:"\u516c\u53f8",zh:"\u516c\u53f8"},willArrive:{cs:"Doraz\u00ed:",
da:"Vil ankomme",de:"Kommt",el:"\u0386\u03c6\u03b9\u03be\u03b7",en:"Will arrive",es:"Llegar\u00e1",fi:"Saapuu",fr:"Va arriver",hi:"\u0906\u0917\u092e\u0928 \u0938\u092e\u092f",hu:"V\u00e1rhat\u00f3 ki\u00e9rkez\u00e9s",it:"Arrivo previsto",ja:"\u6b21\u306e\u6642\u9593\u306b\u5230\u7740\u3057\u307e\u3059",ko:"\ub3c4\ucc29 \uc608\uc815 \uc2dc\uac04:",nb:"Ankommer",nl:"Zal aankomen",no:"Ankommer",pl:"Przyb\u0119dzie",pt:"Chegar\u00e1",ro:"Va ajunge",ru:"\u041f\u0440\u0438\u0431\u044b\u0442\u0438\u0435",
sv:"Anl\u00e4nder",tr:"Gelme zaman\u0131:",tw:"\u9810\u8a08\u62b5\u9054\u6642\u9593\u70ba",zh:"\u5c06\u5230\u8fbe\u7684\u65f6\u95f4"},onTheWayTimeLine:{cs:"Doraz\u00ed: {ETA}",da:"Vil ankomme om {ETA}",de:"Ankunft in {ETA}",el:"\u0386\u03c6\u03b9\u03be\u03b7 \u03c3\u03c4\u03b9\u03c2 {ETA}",en:"Will arrive in {ETA}",es:"Llagar\u00e1 en {ETA}",fi:"Saapuu arviolta {ETA}",fr:"Va arriver dans {ETA}",hi:"{ETA} \u092c\u091c\u0947 \u0906\u0917\u092e\u0928 \u0939\u094b\u0917\u093e",hu:"V\u00e1rhat\u00f3 ki\u00e9rkez\u00e9s: {ETA}",
it:"Arrivo previsto tra {ETA}",ja:"{ETA}\u306b\u5230\u7740\u3057\u307e\u3059",ko:"\ub3c4\ucc29 \uc608\uc815 \uc2dc\uac04: {ETA}",nb:"Ankommer om {ETA}",nl:"Zal aankomen in {ETA}",no:"Ankommer om {ETA}",pl:"Przyb\u0119dzie za {ETA}",pt:"Chegar\u00e1 em {ETA}",ro:"Va ajunge peste {ETA}",ru:"\u041f\u0440\u0438\u0431\u044b\u0442\u0438\u0435 \u043e\u0436\u0438\u0434\u0430\u0435\u0442\u0441\u044f {ETA}",sv:"Anl\u00e4nder om {ETA}",tr:"Gelme zaman\u0131: {ETA}",tw:"\u5c07\u65bc {ETA} \u5167\u62b5\u9054",
zh:"\u5c06\u4e8e {ETA} \u5230\u8fbe"},technicianWillArriveBetween3Line:{cs:"Mezi",da:"Mellem",de:"Zwischen",el:"\u039c\u03b5\u03c4\u03b1\u03be\u03cd",en:"Between",es:"Entre",fi:"V\u00e4lill\u00e4",fr:"Entre",hi:"\u0938\u092e\u092f\u093e\u0902\u0924\u0930\u093e\u0932",hu:"Ezek k\u00f6z\u00f6tt",it:"Tra",ja:"\u6b21\u306e\u9593",ko:"\ub2e4\uc74c \uc2dc\uac04 \uc0ac\uc774",nb:"Mellom",nl:"Tussen",no:"Mellom",pl:"Mi\u0119dzy",pt:"Entre",ro:"\u00centre",ru:"\u043c\u0435\u0436\u0434\u0443",sv:"Mellan",tr:"Aras\u0131nda",
tw:"\u4ecb\u65bc",zh:"\u65f6\u95f4\u8303\u56f4"},finalScreenTitle:{cs:"D\u011bkujeme!",da:"Tak!",de:"Vielen Dank!",el:"\u0395\u03c5\u03c7\u03b1\u03c1\u03b9\u03c3\u03c4\u03bf\u03cd\u03bc\u03b5!",en:"Thank you!",es:"Muchas gracias.",fi:"Kiitos!",fr:"Merci !",hi:"\u0927\u0928\u094d\u092f\u0935\u093e\u0926!",hu:"K\u00f6sz\u00f6nj\u00fck!",it:"Grazie.",ja:"\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3057\u305f\u3002",ko:"\uac10\uc0ac\ud569\ub2c8\ub2e4.",nb:"Takk!",nl:"Hartelijk dank!",no:"Takk!",
pl:"Dzi\u0119kujemy",pt:"Obrigado!",ro:"V\u0103 mul\u0163umim!",ru:"\u0411\u043b\u0430\u0433\u043e\u0434\u0430\u0440\u0438\u043c \u0432\u0430\u0441!",sv:"Tack!",tr:"Te\u015fekk\u00fcr ederiz!",tw:"\u611f\u8b1d\u60a8\uff01",zh:"\u975e\u5e38\u611f\u8c22\uff01"},timeAtTitle:{cs:"V",da:"Kl.",de:"Um",el:"\u03a3\u03c4\u03b9\u03c2",en:"At",es:"A las",fi:"Ajankohta",fr:"A",hi:"\u0938\u094d\u0925\u093e\u0928",hu:"Id\u0151pont:",it:"Alle",ja:"\u6642\u9593",ko:"\uc2dc\uac04:",nb:"Kl.",nl:"Om",no:"Kl.",pl:"O",
pt:"\u00e0s",ro:"La",ru:"\u0432",sv:"Klockan",tr:"Saat:",tw:"\u5728",zh:"\u5728"},isYourTechnician:{cs:"je v\u00e1\u0161 technik",da:"er din tekniker",de:"ist Ihr Techniker",el:"\u03b5\u03af\u03bd\u03b1\u03b9 \u03bf \u03c4\u03b5\u03c7\u03bd\u03b9\u03ba\u03cc\u03c2 \u03c3\u03b1\u03c2",en:"is your technician",es:"es su t\u00e9cnico",fi:"on teknikkosi",fr:"est votre technicien",hi:"\u092a\u0930 \u0906\u092a\u0915\u093e \u0924\u0915\u0928\u0940\u0936\u093f\u092f\u0928 \u0939\u0948",hu:"az \u00d6n technikusa",
it:"\u00e8 il tecnico assegnato",ja:"\u62c5\u5f53\u6280\u8853\u8005\u3067\u3059",ko:"\uc774(\uac00) \ub2f4\ub2f9 \uae30\uc220\uc790\uc785\ub2c8\ub2e4.",nb:"er teknikeren din",nl:"is uw technicus.",no:"er teknikeren din",pl:"to Pa\u0144stwa technik",pt:"\u00e9 o seu t\u00e9cnico",ro:"este tehnicianul dvs.",ru:"- \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0431\u0443\u0434\u0435\u0442 \u0432\u0430\u0441 \u043e\u0431\u0441\u043b\u0443\u0436\u0438\u0432\u0430\u0442\u044c",
sv:"\u00e4r din tekniker",tr:"teknisyeninizin ad\u0131d\u0131r.",tw:"\u662f\u60a8\u7684\u6280\u8853\u54e1",zh:"\u662f\u60a8\u7684\u6280\u672f\u4eba\u5458"},onTheWayEta:{cs:"doraz\u00ed: {ETA}",da:"vil ankomme om {ETA}",de:"kommt in {ETA}",el:"\u03b8\u03b1 \u03b5\u03af\u03bd\u03b1\u03b9 \u03c3\u03c4\u03b9\u03c2 {ETA}",en:"will be in {ETA}",es:"estar\u00e1 en {ETA}",fi:"on paikalla arviolta {ETA}",fr:"sera dans {ETA}",hi:"{ETA} \u092c\u091c\u0947 \u092f\u0939\u093e\u0902 \u0939\u094b\u0917\u093e",hu:"V\u00e1rhat\u00f3 \u00e9rkez\u00e9s: {ETA}",
it:"arriver\u00e0 tra {ETA}",ja:"{ETA}\u306b\u9593\u306b\u5408\u3044\u307e\u3059",ko:"{ETA}\uc5d0 \ub3c4\ucc29 \uc608\uc815",nb:"ankommer om {ETA}",nl:"komt aan in {ETA}.",no:"ankommer om {ETA}",pl:"b\u0119dzie za {ETA}",pt:"estar\u00e1 em {ETA}",ro:"va ajunge peste {ETA}",ru:"\u043f\u0440\u0438\u0431\u044b\u0442\u0438\u0435 \u043e\u0436\u0438\u0434\u0430\u0435\u0442\u0441\u044f {ETA}",sv:"kommer om {ETA}",tr:"adl\u0131 teknisyenin gelme zaman\u0131: {ETA}",tw:"\u5c07\u65bc {ETA} \u5167\u62b5\u9054",
zh:"\u5c06\u4e8e {ETA} \u5230\u8fbe"},hasArrived:{cs:"je na m\u00edst\u011b",da:"er ankommet",de:"ist angekommen",el:"\u03ad\u03c7\u03b5\u03b9 \u03b1\u03c6\u03b9\u03c7\u03b8\u03b5\u03af",en:"has arrived",es:"ha llegado",fi:"on saapunut",fr:"est arriv\u00e9",hi:"\u0906\u0917\u092e\u0928 \u0939\u094b \u091a\u0941\u0915\u093e \u0939\u0948",hu:"ki\u00e9rkezett",it:"\u00e8 arrivato",ja:"\u5230\u7740\u3057\u307e\u3057\u305f",ko:"\ub3c4\ucc29\ud568",nb:"har ankommet",nl:"is aangekomen.",no:"har ankommet",
pl:"przyby\u0142(-a)",pt:"chegou",ro:"a ajuns",ru:"\u0443\u0436\u0435 \u043d\u0430 \u043c\u0435\u0441\u0442\u0435",sv:"har anl\u00e4nt",tr:"geldi",tw:"\u5df2\u62b5\u9054",zh:"\u5df2\u5230\u8fbe"},etaLessThan1Minute:{cs:"m\u00e9n\u011b ne\u017e minuta",da:"mindre end et minut",de:"weniger als einer Minute",el:"\u03bb\u03b9\u03b3\u03cc\u03c4\u03b5\u03c1\u03bf \u03b1\u03c0\u03cc \u03ad\u03bd\u03b1 \u03bb\u03b5\u03c0\u03c4\u03cc",en:"less than a minute",es:"menos de un minuto",fi:"minuutin kuluessa",
fr:"moins d'une minute",hi:"\u090f\u0915 \u092e\u093f\u0928\u091f \u0938\u0947 \u0915\u092e \u0938\u092e\u092f",hu:"kevesebb, mint egy perc",it:"meno di un minuto",ja:"1\u5206\u672a\u6e80",ko:"1\ubd84 \ubbf8\ub9cc",nb:"mindre enn et minutt",nl:"minder dan een minuut",no:"mindre enn et minutt",pl:"mniej ni\u017c minut\u0119",pt:"menos de um minuto",ro:"mai pu\u0163in de un minut",ru:"\u0432 \u0442\u0435\u0447\u0435\u043d\u0438\u0435 \u043c\u0438\u043d\u0443\u0442\u044b",sv:"mindre \u00e4n en minut",
tr:"bir dakikadan az",tw:"\u4e00\u5206\u9418\u5167",zh:"\u5c0f\u4e8e 1 \u5206\u949f"},rateButtonTitle:{cs:["{VALUE} star","{VALUE} stars"],da:["{VALUE} star","{VALUE} stars"],de:["{VALUE} star","{VALUE} stars"],el:["{VALUE} star","{VALUE} stars"],en:["{VALUE} star","{VALUE} stars"],es:["{VALUE} star","{VALUE} stars"],fi:["{VALUE} star","{VALUE} stars"],fr:["{VALUE} star","{VALUE} stars"],hi:["{VALUE} star","{VALUE} stars"],hu:["{VALUE} star","{VALUE} stars"],it:["{VALUE} star","{VALUE} stars"],ja:["{VALUE} star",
"{VALUE} stars"],ko:["{VALUE} star","{VALUE} stars"],nb:["{VALUE} star","{VALUE} stars"],nl:["{VALUE} star","{VALUE} stars"],no:["{VALUE} star","{VALUE} stars"],pl:["{VALUE} star","{VALUE} stars"],pt:["{VALUE} star","{VALUE} stars"],ro:["{VALUE} star","{VALUE} stars"],ru:["{VALUE} star","{VALUE} stars"],sv:["{VALUE} star","{VALUE} stars"],tr:["{VALUE} star","{VALUE} stars"],tw:["{VALUE} star","{VALUE} stars"],zh:["{VALUE} star","{VALUE} stars"]},cancelActivityConfirmationMessage:{cs:"Opravdu chcete sch\u016fzku zru\u0161it?",
da:"Er du sikker p\u00e5, at du vil annullere din m\u00f8deaftale?",de:"M\u00f6chten Sie Ihren Termin wirklich stornieren?",el:"\u0395\u03af\u03c3\u03c4\u03b5 \u03b2\u03ad\u03b2\u03b1\u03b9\u03bf\u03b9 \u03cc\u03c4\u03b9 \u03b8\u03ad\u03bb\u03b5\u03c4\u03b5 \u03bd\u03b1 \u03b1\u03ba\u03c5\u03c1\u03ce\u03c3\u03b5\u03c4\u03b5 \u03c4\u03bf \u03c1\u03b1\u03bd\u03c4\u03b5\u03b2\u03bf\u03cd \u03c3\u03b1\u03c2;",en:"Are you sure you want to cancel your appointment?",es:"\u00bfSeguro que desea cancelar la cita?",
fi:"Haluatko varmasti peruuttaa tapaamisen?",fr:"Voulez-vous vraiment annuler votre rendez-vous ?",hi:"\u0915\u094d\u092f\u093e \u0906\u092a \u0935\u093e\u0915\u0908 \u0905\u092a\u0928\u093e \u0905\u092a\u0949\u0907\u0902\u091f\u092e\u0947\u0902\u091f \u0930\u0926\u094d\u0926 \u0915\u0930\u0928\u093e \u091a\u093e\u0939\u0924\u0947 \u0939\u0948\u0902?",hu:"Biztosan \u00e9rv\u00e9nytelen\u00edti a tal\u00e1lkoz\u00f3t?",it:"Annullare l'appuntamento?",ja:"\u30a2\u30dd\u30a4\u30f3\u30c8\u30e1\u30f3\u30c8\u3092\u53d6\u308a\u6d88\u3057\u307e\u3059\u304b?",
ko:"\uc57d\uc18d\uc744 \ucde8\uc18c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?",nb:"Er du sikker p\u00e5 at du vil avlyse avtalen?",nl:"Wilt u uw afspraak annuleren?",no:"Er du sikker p\u00e5 at du vil avlyse avtalen?",pl:"Czy na pewno anulowa\u0107 to spotkanie?",pt:"Tem certeza de que deseja cancelar seu agendamento?",ro:"Sigur anula\u0163i \u00eent\u00e2lnirea?",ru:"\u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u0432\u0441\u0442\u0440\u0435\u0447\u0443?",sv:"Vill du verkligen avbryta bokningen?",
tr:"Randevunuzu iptal etmek istedi\u011finize emin misiniz?",tw:"\u60a8\u662f\u5426\u78ba\u5b9a\u8981\u53d6\u6d88\u9810\u7d04\uff1f",zh:"\u662f\u5426\u786e\u5b9a\u8981\u53d6\u6d88\u60a8\u7684\u9884\u7ea6\uff1f"},cancelActivityConfirmationDismiss:{cs:"Zru\u0161it",da:"Afvis",de:"Verwerfen",el:"\u039c\u03b1\u03c4\u03b1\u03af\u03c9\u03c3\u03b7",en:"Dismiss",es:"Descartar",fi:"Hylk\u00e4\u00e4",fr:"Rejeter",hi:"\u0928\u093f\u0930\u0938\u094d\u0924 \u0915\u0930\u0947\u0902",hu:"Elvet\u00e9s",it:"Elimina",
ja:"\u7d42\u4e86",ko:"\ud574\uc81c",nb:"Forkast",nl:"Annuleren",no:"Forkast",pl:"Odrzu\u0107",pt:"Descartar",ro:"Abandonare",ru:"\u041f\u0440\u0435\u043a\u0440\u0430\u0442\u0438\u0442\u044c",sv:"St\u00e4ng",tr:"Reddet",tw:"\u64a4\u92b7",zh:"\u653e\u5f03"},cancelActivityConfirmationSubmit:{cs:"Potvrdit",da:"Bekr\u00e6ft",de:"Best\u00e4tigen",el:"\u0395\u03c0\u03b9\u03b2\u03b5\u03b2\u03b1\u03af\u03c9\u03c3\u03b7",en:"Confirm",es:"Confirmar",fi:"Vahvista",fr:"Confirmer",hi:"\u092a\u0941\u0937\u094d\u091f\u093f \u0915\u0930\u0947\u0902",
hu:"Meger\u0151s\u00edt\u00e9s",it:"Conferma",ja:"\u78ba\u8a8d",ko:"\ud655\uc778",nb:"Bekreft",nl:"Bevestigen",no:"Bekreft",pl:"Potwierd\u017a",pt:"Confirmar",ro:"Confirmare",ru:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u0435",sv:"Bekr\u00e4fta",tr:"Teyit Et",tw:"\u78ba\u8a8d",zh:"\u786e\u8ba4"},activityActionNetworkError:{cs:"Byla zji\u0161t\u011bna nestabilita s\u00edt\u011b. Zkontrolujte p\u0159ipojen\u00ed",da:"Ustabilt netv\u00e6rk fundet. Tjek forbindelsen",de:"Netzwerkinstabilit\u00e4t ermittelt. Pr\u00fcfen Sie die Verbindung",
el:"\u0395\u03bd\u03c4\u03bf\u03c0\u03af\u03c3\u03c4\u03b7\u03ba\u03b5 \u03b1\u03c3\u03c4\u03ac\u03b8\u03b5\u03b9\u03b1 \u03b4\u03b9\u03ba\u03c4\u03cd\u03bf\u03c5. \u0395\u03bb\u03ad\u03b3\u03be\u03c4\u03b5 \u03c4\u03b7 \u03c3\u03cd\u03bd\u03b4\u03b5\u03c3\u03b7",en:"Network instability detected. Check the connection",es:"Se ha detectado inestabilidad de red. Compruebe la conexi\u00f3n.",fi:"Ongelmia verkkoyhteydess\u00e4. Tarkista yhteys",fr:"Instabilit\u00e9 r\u00e9seau d\u00e9tect\u00e9e. V\u00e9rifiez la connexion",
hi:"\u0928\u0947\u091f\u0935\u0930\u094d\u0915 \u0905\u0938\u094d\u0925\u093f\u0930 \u0939\u094b\u0928\u093e \u092a\u0924\u093e \u091a\u0932\u093e \u0939\u0948. \u0915\u0928\u0947\u0915\u094d\u0936\u0928 \u091c\u093e\u0902\u091a\u0947\u0902",hu:"H\u00e1l\u00f3zati instabilit\u00e1st \u00e9rz\u00e9kelt a rendszer. Ellen\u0151rizze a kapcsolatot.",it:"Instabilit\u00e0 di rete rilevata. Controllare la connessione.",ja:"\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u72b6\u614b\u304c\u4e0d\u5b89\u5b9a\u3067\u3059\u3002\u63a5\u7d9a\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044",
ko:"\ub124\ud2b8\uc6cc\ud06c \ubd88\uc548\uc815\uc774 \uac10\uc9c0\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \uc5f0\uacb0\uc744 \ud655\uc778\ud558\uc2ed\uc2dc\uc624.",nb:"Nettverket er ustabilt. Kontroller tilkoblingen.",nl:"Netwerkinstabiliteit gedetecteerd. Controleer de verbinding.",no:"Nettverket er ustabilt. Kontroller tilkoblingen.",pl:"Wykryto niestabilno\u015b\u0107 sieci. Nale\u017cy sprawdzi\u0107 po\u0142\u0105czenie",pt:"Foi detectada uma instabilidade na rede. Verifique a conex\u00e3o",ro:"A fost detectat\u0103 o instabilitate a re\u0163elei. Verifica\u0163i conexiunea",
ru:"\u041d\u0435\u0441\u0442\u0430\u0431\u0438\u043b\u044c\u043d\u0430\u044f \u0440\u0430\u0431\u043e\u0442\u0430 \u0441\u0435\u0442\u0438. \u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435.",sv:"N\u00e4tverket \u00e4r instabilt. Kontrollera anslutningen",tr:"A\u011f tutars\u0131zl\u0131\u011f\u0131 alg\u0131land\u0131. Ba\u011flant\u0131y\u0131 kontrol edin",tw:"\u5075\u6e2c\u5230\u7db2\u8def\u6709\u4e0d\u7a69\u5b9a\u60c5\u5f62\u3002\u8acb\u6aa2\u67e5\u9023\u7dda\u3002",
zh:"\u68c0\u6d4b\u5230\u7f51\u7edc\u4e0d\u7a33\u5b9a\u3002\u8bf7\u68c0\u67e5\u8fde\u63a5"},activityActionOtherError:{cs:"Omlouv\u00e1me se, vyskytly se pot\u00ed\u017ee. Opakujte akci pozd\u011bji.",da:"Noget gik galt. Pr\u00f8v igen senere",de:"Leider ist ein Fehler aufgetreten. Versuchen Sie es sp\u00e4ter erneut",el:"\u03a0\u03b1\u03c1\u03bf\u03c5\u03c3\u03b9\u03ac\u03c3\u03c4\u03b7\u03ba\u03b5 \u03ba\u03ac\u03c0\u03bf\u03b9\u03bf \u03c0\u03c1\u03cc\u03b2\u03bb\u03b7\u03bc\u03b1. \u0394\u03bf\u03ba\u03b9\u03bc\u03ac\u03c3\u03c4\u03b5 \u03be\u03b1\u03bd\u03ac \u03b1\u03c1\u03b3\u03cc\u03c4\u03b5\u03c1\u03b1",
en:"Sorry, something went wrong there. Try again later",es:"Se produjo alg\u00fan error. Vuelva a intentarlo m\u00e1s tarde.",fi:"Jokin meni vikaan. Yrit\u00e4 my\u00f6hemmin uudelleen",fr:"Un probl\u00e8me est survenu. R\u00e9essayez plus tard.",hi:"\u0915\u094d\u0937\u092e\u093e \u0915\u0930\u0947\u0902, \u0915\u0941\u091b \u0924\u094d\u0930\u0941\u091f\u093f \u0939\u0941\u0908 \u0939\u0948. \u0915\u0941\u091b \u0938\u092e\u092f \u092c\u093e\u0926 \u092b\u093f\u0930 \u0938\u0947 \u0915\u094b\u0936\u093f\u0936 \u0915\u0930\u0947\u0902",
hu:"Valamilyen hiba t\u00f6rt\u00e9nt. Pr\u00f3b\u00e1lja meg \u00fajra k\u00e9s\u0151bb.",it:"Si \u00e8 verificato un errore. Riprovare pi\u00f9 tardi.",ja:"\u554f\u984c\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u5f8c\u3067\u518d\u8a66\u884c\u3057\u3066\u304f\u3060\u3055\u3044\u3002",ko:"\uc8c4\uc1a1\ud569\ub2c8\ub2e4. \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4. \ub098\uc911\uc5d0 \ub2e4\uc2dc \uc2dc\ub3c4\ud558\uc2ed\uc2dc\uc624.",nb:"Noe gikk galt. Pr\u00f8v p\u00e5 nytt senere.",
nl:"Er is iets misgegaan. Probeer het later opnieuw.",no:"Noe gikk galt. Pr\u00f8v p\u00e5 nytt senere.",pl:"Wyst\u0105pi\u0142 b\u0142\u0105d. Nale\u017cy spr\u00f3bowa\u0107 ponownie p\u00f3\u017aniej",pt:"Algo deu errado. Tente novamente mais tarde",ro:"Ne pare r\u0103u, ceva nu a func\u0163ionat. \u00cencerca\u0163i din nou mai t\u00e2rziu.",ru:"\u0412\u043e\u0437\u043d\u0438\u043a\u043b\u0438 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b, \u043f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u043e\u043f\u044b\u0442\u043a\u0443 \u043f\u043e\u0437\u0436\u0435",
sv:"N\u00e5got gick tyv\u00e4rr fel. F\u00f6rs\u00f6k igen senare",tr:"Ne yaz\u0131k ki burada bir sorun olu\u015ftu. Daha sonra yeniden deneyin",tw:"\u62b1\u6b49\uff0c\u767c\u751f\u932f\u8aa4\u3002\u8acb\u7a0d\u5f8c\u91cd\u8a66\u3002",zh:"\u5f88\u62b1\u6b49\uff0c\u53d1\u751f\u4e86\u9519\u8bef\u3002\u8bf7\u7a0d\u540e\u91cd\u8bd5"},today:{cs:"dnes",da:"i dag",de:"heute",el:"\u03c3\u03ae\u03bc\u03b5\u03c1\u03b1",en:"today",es:"hoy",fi:"t\u00e4n\u00e4\u00e4n",fr:"aujourd'hui",hi:"\u0906\u091c",hu:"a mai nap",
it:"oggi",ja:"\u672c\u65e5",ko:"\uc624\ub298",nb:"i dag",nl:"vandaag",no:"i dag",pl:"dzisiaj",pt:"hoje",ro:"ast\u0103zi",ru:"\u0441\u0435\u0433\u043e\u0434\u043d\u044f",sv:"idag",tr:"bug\u00fcn",tw:"\u4eca\u65e5",zh:"\u4eca\u5929"},tomorrow:{cs:"z\u00edtra",da:"i morgen",de:"morgen",el:"\u03b1\u03cd\u03c1\u03b9\u03bf",en:"tomorrow",es:"ma\u00f1ana",fi:"huomenna",fr:"demain",hi:"\u0915\u0932",hu:"holnap",it:"domani",ja:"\u660e\u65e5",ko:"\ub0b4\uc77c",nb:"i morgen",nl:"morgen",no:"i morgen",pl:"jutro",
pt:"amanh\u00e3",ro:"m\u00e2ine",ru:"\u0437\u0430\u0432\u0442\u0440\u0430",sv:"imorgon",tr:"yar\u0131n",tw:"\u660e\u5929",zh:"\u660e\u5929"}},availableThemes:["theme-bright","theme-hero","theme-minimal"],initialThemesData:{"theme-bright":{label:"",description:"",content:'{"destinationIconAnchor":"bottom","resourceIconAnchor":"bottom","mainColor":"#309fdb","backgroundColor":"#fff","backgroundImage":"","favicon":"data:image/x-icon;base64,AAABAAEAMjIAAAEAIADIKAAAFgAAACgAAAAyAAAAZAAAAAEAIAAAAAAAECcAACMuAAAjLgAAAAAAAAAAAACzs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/5OTk/+bm5v/m5ub/5ubm/+bm5v/Ozs7/s7Oz/7Ozs/+1tbX/1tbW/+rq6v/j4+P/wsLC/7Ozs/+zs7P/s7Oz/7Ozs//AwMD/4uLi/+rq6v/Z2dn/t7e3/7Ozs/+zs7P/s7Oz/7S0tP/S0tL/6Ojo/+Xl5f/Hx8f/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs//9/f3//////////////////////9zc3P+zs7P/s7Oz/+fn5//////////////////+/v7/xcXF/7Ozs/+zs7P/wMDA//z8/P/////////////////v7+//tLS0/7Ozs/+zs7P/4eHh///////////////////////Ozs7/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz//39/f/4+Pj/wcHB/8HBwf/BwcH/urq6/7Ozs//ExMT///////Dw8P+9vb3/0dHR///////q6ur/s7Oz/7Ozs//l5eX//////9XV1f+9vb3/7e3t///////IyMj/s7Oz/7u7u///////9vb2/8DAwP/Kysr//v7+//Ly8v+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P//f39//b29v+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/83Nzf//////2tra/7Ozs/+0tLT///////Ly8v+zs7P/s7Oz/+7u7v//////ubm5/7Ozs//V1dX//////9HR0f+zs7P/xMTE///////j4+P/s7Oz/7Ozs//39/f/+/v7/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs//9/f3/9vb2/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/zc3N///////Z2dn/s7Oz/7Ozs///////8/Pz/7Ozs/+zs7P/7u7u//////+4uLj/s7Oz/9XV1f//////0tLS/7Ozs//ExMT//////+Li4v+zs7P/s7Oz//b29v/8/Pz/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz//39/f/29vb/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs//Nzc3//////9nZ2f+zs7P/s7Oz///////z8/P/s7Oz/7Ozs//u7u7//////7i4uP/BwcH/3d3d///////S0tL/s7Oz/8TExP//////4uLi/7Ozs/+zs7P/9vb2//z8/P+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P//f39//b29v+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/83Nzf//////2dnZ/7Ozs/+zs7P///////Pz8/+zs7P/s7Oz/+7u7v//////uLi4//j4+P///////////9LS0v+zs7P/xMTE///////i4uL/s7Oz/7Ozs//29vb//Pz8/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs//9/f3/9vb2/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/zc3N///////Z2dn/s7Oz/7Ozs///////8/Pz/7Ozs/+zs7P/7u7u//////+4uLj/zs7O/9HR0f/R0dH/v7+//7Ozs//ExMT//////+Li4v+zs7P/s7Oz//b29v/8/Pz/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz//39/f/29vb/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs//Nzc3//////9nZ2f+zs7P/s7Oz///////z8/P/s7Oz/7Ozs//u7u7//////7i4uP+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/8TExP//////4uLi/7Ozs/+zs7P/9vb2//z8/P+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P//f39//b29v+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/83Nzf//////2dnZ/7Ozs/+zs7P///////Pz8/+zs7P/s7Oz/+7u7v//////uLi4/7Ozs//Dw8P/1tbW/8HBwf+zs7P/xMTE///////i4uL/s7Oz/7Ozs//29vb//Pz8/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs//9/f3/9vb2/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/y8vL///////e3t7/s7Oz/7i4uP//////8fHx/7Ozs/+zs7P/7e3t//////+9vb3/s7Oz/9ra2v//////z8/P/7Ozs/+/v7///////+fn5/+zs7P/tLS0//r6+v/5+fn/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz//39/f/29vb/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+6urr//Pz8//z8/P/f39//7u7u///////d3d3/s7Oz/7Ozs//Y2Nj///////Dw8P/e3t7/+/v7//39/f+9vb3/s7Oz/7S0tP/4+Pj//v7+/+Hh4f/q6ur//////+Xl5f+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P//f39//b29v+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs//Nzc3/+/v7////////////7Ozs/7e3t/+zs7P/s7Oz/7W1tf/o6Oj////////////8/Pz/0dHR/7Ozs/+zs7P/s7Oz/8bGxv/5+fn////////////x8fH/urq6/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs//Dw8P/wsLC/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+5ubn/yMjI/8HBwf+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs//AwMD/yMjI/7q6uv+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7e3t//Hx8f/w8PD/7S0tP+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==","resourceNameProp":"pname","showResourcePhoto":true,"showPositionOnMap":true,"showTechnicianRoute":true,"showActivityType":true,"logo":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNi4wLjQsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9ItCo0LDRgF8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgd2lkdGg9IjYwcHgiIGhlaWdodD0iNjBweCIgdmlld0JveD0iMCAwIDYwIDYwIiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCA2MCA2MCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+DQo8Zz4NCgk8Zz4NCgkJPHJlY3QgeT0iMCIgZmlsbD0iI0IzQjNCMyIgd2lkdGg9IjYwIiBoZWlnaHQ9IjYwIi8+DQoJPC9nPg0KCTxnPg0KCQk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMTIuMDQyLDM4LjAwMVYyMi41MzhoMi4yMTV2MTMuMjQ4aDQuMzg3djIuMjE2SDEyLjA0MnoiLz4NCgkJPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTIxLjE4NywyNi4xODdjMC0wLjYyMywwLjEwOC0xLjE3MywwLjMyNi0xLjY1MWMwLjIxNy0wLjQ3OCwwLjUwNy0wLjg3NSwwLjg2OS0xLjE5NA0KCQkJYzAuMzQ4LTAuMzA0LDAuNzQyLTAuNTM1LDEuMTg0LTAuNjk1YzAuNDQyLTAuMTU5LDAuODg3LTAuMjM5LDEuMzM2LTAuMjM5YzAuNDQ5LDAsMC44OTQsMC4wOCwxLjMzNSwwLjIzOQ0KCQkJYzAuNDQxLDAuMTYsMC44NDMsMC4zOTEsMS4yMDYsMC42OTVjMC4zNDcsMC4zMTksMC42MywwLjcxNywwLjg0NywxLjE5NGMwLjIxNywwLjQ3OCwwLjMyNiwxLjAyOCwwLjMyNiwxLjY1MXY4LjE2Ng0KCQkJYzAsMC42NTEtMC4xMDksMS4yMDktMC4zMjYsMS42NzJjLTAuMjE3LDAuNDY0LTAuNSwwLjg0Ny0wLjg0NywxLjE1MWMtMC4zNjIsMC4zMTgtMC43NjQsMC41NTgtMS4yMDYsMC43MTcNCgkJCWMtMC40NDIsMC4xNTktMC44ODcsMC4yMzgtMS4zMzUsMC4yMzhjLTAuNDQ5LDAtMC44OTQtMC4wNzktMS4zMzYtMC4yMzhjLTAuNDQxLTAuMTU5LTAuODM2LTAuMzk4LTEuMTg0LTAuNzE3DQoJCQljLTAuMzYyLTAuMzA1LTAuNjUxLTAuNjg4LTAuODY5LTEuMTUxYy0wLjIxNy0wLjQ2My0wLjMyNi0xLjAyMS0wLjMyNi0xLjY3MlYyNi4xODd6IE0yMy40MDIsMzQuMzUzDQoJCQljMCwwLjUzNiwwLjE0OCwwLjkzMSwwLjQ0NSwxLjE4NGMwLjI5NiwwLjI1MywwLjY0NywwLjM4LDEuMDUzLDAuMzhjMC40MDUsMCwwLjc1Ni0wLjEyNywxLjA1My0wLjM4DQoJCQljMC4yOTYtMC4yNTMsMC40NDUtMC42NDcsMC40NDUtMS4xODR2LTguMTY2YzAtMC41MzYtMC4xNDktMC45My0wLjQ0NS0xLjE4NGMtMC4yOTctMC4yNTMtMC42NDgtMC4zOC0xLjA1My0wLjM4DQoJCQljLTAuNDA2LDAtMC43NTcsMC4xMjctMS4wNTMsMC4zOGMtMC4yOTcsMC4yNTMtMC40NDUsMC42NDgtMC40NDUsMS4xODRWMzQuMzUzeiIvPg0KCQk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMzEuNDU3LDI2LjE4N2MwLTAuNjIzLDAuMTA5LTEuMTczLDAuMzI2LTEuNjUxYzAuMjE3LTAuNDc4LDAuNTA3LTAuODc1LDAuODY5LTEuMTk0DQoJCQljMC4zNDgtMC4zMDQsMC43NDItMC41MzUsMS4xODQtMC42OTVjMC40NDEtMC4xNTksMC44ODctMC4yMzksMS4zMzYtMC4yMzljMC40NDgsMCwwLjg5MywwLjA4LDEuMzM1LDAuMjM5DQoJCQljMC40NDEsMC4xNiwwLjg0MywwLjM5MSwxLjIwNiwwLjY5NWMwLjM0NywwLjMxOSwwLjYyOSwwLjcxNywwLjg0NiwxLjE5NGMwLjIxOCwwLjQ3OCwwLjMyNiwxLjAyOCwwLjMyNiwxLjY1MXYwLjc4MkgzNi42Nw0KCQkJdi0wLjc4MmMwLTAuNTM2LTAuMTQ4LTAuOTMtMC40NDUtMS4xODRzLTAuNjQ4LTAuMzgtMS4wNTMtMC4zOGMtMC40MDYsMC0wLjc1OCwwLjEyNy0xLjA1NCwwLjM4DQoJCQljLTAuMjk3LDAuMjUzLTAuNDQ1LDAuNjQ4LTAuNDQ1LDEuMTg0djguMTY2YzAsMC41MzYsMC4xNDgsMC45MzEsMC40NDUsMS4xODRjMC4yOTYsMC4yNTMsMC42NDcsMC4zOCwxLjA1NCwwLjM4DQoJCQljMC40MDQsMCwwLjc1Ni0wLjEyNywxLjA1My0wLjM4czAuNDQ1LTAuNjQ3LDAuNDQ1LTEuMTg0di0yLjkxaC0xLjc2di0xLjk1NWgzLjk3NXY0Ljg2NWMwLDAuNjUxLTAuMTA4LDEuMjA5LTAuMzI2LDEuNjcyDQoJCQljLTAuMjE3LDAuNDY0LTAuNDk5LDAuODQ3LTAuODQ2LDEuMTUxYy0wLjM2MywwLjMxOC0wLjc2NSwwLjU1OC0xLjIwNiwwLjcxN2MtMC40NDIsMC4xNTktMC44ODcsMC4yMzgtMS4zMzUsMC4yMzgNCgkJCWMtMC40NDksMC0wLjg5NS0wLjA3OS0xLjMzNi0wLjIzOFMzMywzNy40OTQsMzIuNjUyLDM3LjE3NmMtMC4zNjItMC4zMDUtMC42NTItMC42ODgtMC44NjktMS4xNTENCgkJCWMtMC4yMTctMC40NjMtMC4zMjYtMS4wMjEtMC4zMjYtMS42NzJWMjYuMTg3eiIvPg0KCQk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNNDEuNzI4LDI2LjE4N2MwLTAuNjIzLDAuMTA4LTEuMTczLDAuMzI1LTEuNjUxYzAuMjE4LTAuNDc4LDAuNTA4LTAuODc1LDAuODY5LTEuMTk0DQoJCQljMC4zNDgtMC4zMDQsMC43NDItMC41MzUsMS4xODQtMC42OTVjMC40NDEtMC4xNTksMC44ODctMC4yMzksMS4zMzYtMC4yMzlzMC44OTQsMC4wOCwxLjMzNiwwLjIzOQ0KCQkJYzAuNDQxLDAuMTYsMC44NDMsMC4zOTEsMS4yMDUsMC42OTVjMC4zNDgsMC4zMTksMC42MywwLjcxNywwLjg0NywxLjE5NGMwLjIxOCwwLjQ3OCwwLjMyNiwxLjAyOCwwLjMyNiwxLjY1MXY4LjE2Ng0KCQkJYzAsMC42NTEtMC4xMDgsMS4yMDktMC4zMjYsMS42NzJjLTAuMjE3LDAuNDY0LTAuNDk5LDAuODQ3LTAuODQ3LDEuMTUxYy0wLjM2MiwwLjMxOC0wLjc2NCwwLjU1OC0xLjIwNSwwLjcxNw0KCQkJYy0wLjQ0MiwwLjE1OS0wLjg4NywwLjIzOC0xLjMzNiwwLjIzOHMtMC44OTUtMC4wNzktMS4zMzYtMC4yMzhzLTAuODM2LTAuMzk4LTEuMTg0LTAuNzE3Yy0wLjM2MS0wLjMwNS0wLjY1MS0wLjY4OC0wLjg2OS0xLjE1MQ0KCQkJYy0wLjIxNy0wLjQ2My0wLjMyNS0xLjAyMS0wLjMyNS0xLjY3MlYyNi4xODd6IE00My45NDMsMzQuMzUzYzAsMC41MzYsMC4xNDgsMC45MzEsMC40NDUsMS4xODQNCgkJCWMwLjI5NiwwLjI1MywwLjY0NiwwLjM4LDEuMDUzLDAuMzhjMC40MDUsMCwwLjc1Ni0wLjEyNywxLjA1My0wLjM4czAuNDQ1LTAuNjQ3LDAuNDQ1LTEuMTg0di04LjE2Ng0KCQkJYzAtMC41MzYtMC4xNDgtMC45My0wLjQ0NS0xLjE4NHMtMC42NDctMC4zOC0xLjA1My0wLjM4Yy0wLjQwNiwwLTAuNzU3LDAuMTI3LTEuMDUzLDAuMzhjLTAuMjk3LDAuMjUzLTAuNDQ1LDAuNjQ4LTAuNDQ1LDEuMTg0DQoJCQlWMzQuMzUzeiIvPg0KCTwvZz4NCjwvZz4NCjwvc3ZnPg0K","resourceIcon":"techIcon1","destinationIcon":"locIcon1","enableFeedback":true,"enableActivityCancel":false,"scoreWidgetStyle":"stars","enableComment":true,"scoreProp":"XR_SCORE","feedbackMode":"commentAndRate","commentProp":"XR_COMMENT","translations":{}, "isDigitalAssistantAvailable": false, "applicationId":"", "oracleChatServerURI":"", "oracleChatChannelId":"", "arrivalTimeRange": "ETA", "technicianDelay": "0", "customerAddressVisibility": "customerAddress", "customerPositionOnMap": "exactPosition", "lang": "en-US", "customDomainName": "" }',
version:1,update_date:0,template_label:"theme-bright"},"theme-hero":{label:"",description:"",content:'{"destinationIconAnchor":"bottom","resourceIconAnchor":"bottom","mainColor":"#fff","backgroundColor":"#309fdb","backgroundImage":"","favicon":"data:image/x-icon;base64,AAABAAEAMjIAAAEAIADIKAAAFgAAACgAAAAyAAAAZAAAAAEAIAAAAAAAECcAACMuAAAjLgAAAAAAAAAAAACzs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/5OTk/+bm5v/m5ub/5ubm/+bm5v/Ozs7/s7Oz/7Ozs/+1tbX/1tbW/+rq6v/j4+P/wsLC/7Ozs/+zs7P/s7Oz/7Ozs//AwMD/4uLi/+rq6v/Z2dn/t7e3/7Ozs/+zs7P/s7Oz/7S0tP/S0tL/6Ojo/+Xl5f/Hx8f/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs//9/f3//////////////////////9zc3P+zs7P/s7Oz/+fn5//////////////////+/v7/xcXF/7Ozs/+zs7P/wMDA//z8/P/////////////////v7+//tLS0/7Ozs/+zs7P/4eHh///////////////////////Ozs7/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz//39/f/4+Pj/wcHB/8HBwf/BwcH/urq6/7Ozs//ExMT///////Dw8P+9vb3/0dHR///////q6ur/s7Oz/7Ozs//l5eX//////9XV1f+9vb3/7e3t///////IyMj/s7Oz/7u7u///////9vb2/8DAwP/Kysr//v7+//Ly8v+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P//f39//b29v+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/83Nzf//////2tra/7Ozs/+0tLT///////Ly8v+zs7P/s7Oz/+7u7v//////ubm5/7Ozs//V1dX//////9HR0f+zs7P/xMTE///////j4+P/s7Oz/7Ozs//39/f/+/v7/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs//9/f3/9vb2/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/zc3N///////Z2dn/s7Oz/7Ozs///////8/Pz/7Ozs/+zs7P/7u7u//////+4uLj/s7Oz/9XV1f//////0tLS/7Ozs//ExMT//////+Li4v+zs7P/s7Oz//b29v/8/Pz/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz//39/f/29vb/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs//Nzc3//////9nZ2f+zs7P/s7Oz///////z8/P/s7Oz/7Ozs//u7u7//////7i4uP/BwcH/3d3d///////S0tL/s7Oz/8TExP//////4uLi/7Ozs/+zs7P/9vb2//z8/P+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P//f39//b29v+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/83Nzf//////2dnZ/7Ozs/+zs7P///////Pz8/+zs7P/s7Oz/+7u7v//////uLi4//j4+P///////////9LS0v+zs7P/xMTE///////i4uL/s7Oz/7Ozs//29vb//Pz8/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs//9/f3/9vb2/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/zc3N///////Z2dn/s7Oz/7Ozs///////8/Pz/7Ozs/+zs7P/7u7u//////+4uLj/zs7O/9HR0f/R0dH/v7+//7Ozs//ExMT//////+Li4v+zs7P/s7Oz//b29v/8/Pz/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz//39/f/29vb/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs//Nzc3//////9nZ2f+zs7P/s7Oz///////z8/P/s7Oz/7Ozs//u7u7//////7i4uP+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/8TExP//////4uLi/7Ozs/+zs7P/9vb2//z8/P+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P//f39//b29v+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/83Nzf//////2dnZ/7Ozs/+zs7P///////Pz8/+zs7P/s7Oz/+7u7v//////uLi4/7Ozs//Dw8P/1tbW/8HBwf+zs7P/xMTE///////i4uL/s7Oz/7Ozs//29vb//Pz8/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs//9/f3/9vb2/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/y8vL///////e3t7/s7Oz/7i4uP//////8fHx/7Ozs/+zs7P/7e3t//////+9vb3/s7Oz/9ra2v//////z8/P/7Ozs/+/v7///////+fn5/+zs7P/tLS0//r6+v/5+fn/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz//39/f/29vb/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+6urr//Pz8//z8/P/f39//7u7u///////d3d3/s7Oz/7Ozs//Y2Nj///////Dw8P/e3t7/+/v7//39/f+9vb3/s7Oz/7S0tP/4+Pj//v7+/+Hh4f/q6ur//////+Xl5f+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P//f39//b29v+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs//Nzc3/+/v7////////////7Ozs/7e3t/+zs7P/s7Oz/7W1tf/o6Oj////////////8/Pz/0dHR/7Ozs/+zs7P/s7Oz/8bGxv/5+fn////////////x8fH/urq6/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs//Dw8P/wsLC/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+5ubn/yMjI/8HBwf+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs//AwMD/yMjI/7q6uv+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7e3t//Hx8f/w8PD/7S0tP+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==","resourceNameProp":"pname","showResourcePhoto":true,"showPositionOnMap":false,"showTechnicianRoute":true,"showActivityType":true,"logo":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNi4wLjQsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9ItCo0LDRgF8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgd2lkdGg9IjYwcHgiIGhlaWdodD0iNjBweCIgdmlld0JveD0iMCAwIDYwIDYwIiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCA2MCA2MCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+DQo8Zz4NCgk8Zz4NCgkJPHJlY3QgeT0iMCIgZmlsbD0iI0IzQjNCMyIgd2lkdGg9IjYwIiBoZWlnaHQ9IjYwIi8+DQoJPC9nPg0KCTxnPg0KCQk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMTIuMDQyLDM4LjAwMVYyMi41MzhoMi4yMTV2MTMuMjQ4aDQuMzg3djIuMjE2SDEyLjA0MnoiLz4NCgkJPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTIxLjE4NywyNi4xODdjMC0wLjYyMywwLjEwOC0xLjE3MywwLjMyNi0xLjY1MWMwLjIxNy0wLjQ3OCwwLjUwNy0wLjg3NSwwLjg2OS0xLjE5NA0KCQkJYzAuMzQ4LTAuMzA0LDAuNzQyLTAuNTM1LDEuMTg0LTAuNjk1YzAuNDQyLTAuMTU5LDAuODg3LTAuMjM5LDEuMzM2LTAuMjM5YzAuNDQ5LDAsMC44OTQsMC4wOCwxLjMzNSwwLjIzOQ0KCQkJYzAuNDQxLDAuMTYsMC44NDMsMC4zOTEsMS4yMDYsMC42OTVjMC4zNDcsMC4zMTksMC42MywwLjcxNywwLjg0NywxLjE5NGMwLjIxNywwLjQ3OCwwLjMyNiwxLjAyOCwwLjMyNiwxLjY1MXY4LjE2Ng0KCQkJYzAsMC42NTEtMC4xMDksMS4yMDktMC4zMjYsMS42NzJjLTAuMjE3LDAuNDY0LTAuNSwwLjg0Ny0wLjg0NywxLjE1MWMtMC4zNjIsMC4zMTgtMC43NjQsMC41NTgtMS4yMDYsMC43MTcNCgkJCWMtMC40NDIsMC4xNTktMC44ODcsMC4yMzgtMS4zMzUsMC4yMzhjLTAuNDQ5LDAtMC44OTQtMC4wNzktMS4zMzYtMC4yMzhjLTAuNDQxLTAuMTU5LTAuODM2LTAuMzk4LTEuMTg0LTAuNzE3DQoJCQljLTAuMzYyLTAuMzA1LTAuNjUxLTAuNjg4LTAuODY5LTEuMTUxYy0wLjIxNy0wLjQ2My0wLjMyNi0xLjAyMS0wLjMyNi0xLjY3MlYyNi4xODd6IE0yMy40MDIsMzQuMzUzDQoJCQljMCwwLjUzNiwwLjE0OCwwLjkzMSwwLjQ0NSwxLjE4NGMwLjI5NiwwLjI1MywwLjY0NywwLjM4LDEuMDUzLDAuMzhjMC40MDUsMCwwLjc1Ni0wLjEyNywxLjA1My0wLjM4DQoJCQljMC4yOTYtMC4yNTMsMC40NDUtMC42NDcsMC40NDUtMS4xODR2LTguMTY2YzAtMC41MzYtMC4xNDktMC45My0wLjQ0NS0xLjE4NGMtMC4yOTctMC4yNTMtMC42NDgtMC4zOC0xLjA1My0wLjM4DQoJCQljLTAuNDA2LDAtMC43NTcsMC4xMjctMS4wNTMsMC4zOGMtMC4yOTcsMC4yNTMtMC40NDUsMC42NDgtMC40NDUsMS4xODRWMzQuMzUzeiIvPg0KCQk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMzEuNDU3LDI2LjE4N2MwLTAuNjIzLDAuMTA5LTEuMTczLDAuMzI2LTEuNjUxYzAuMjE3LTAuNDc4LDAuNTA3LTAuODc1LDAuODY5LTEuMTk0DQoJCQljMC4zNDgtMC4zMDQsMC43NDItMC41MzUsMS4xODQtMC42OTVjMC40NDEtMC4xNTksMC44ODctMC4yMzksMS4zMzYtMC4yMzljMC40NDgsMCwwLjg5MywwLjA4LDEuMzM1LDAuMjM5DQoJCQljMC40NDEsMC4xNiwwLjg0MywwLjM5MSwxLjIwNiwwLjY5NWMwLjM0NywwLjMxOSwwLjYyOSwwLjcxNywwLjg0NiwxLjE5NGMwLjIxOCwwLjQ3OCwwLjMyNiwxLjAyOCwwLjMyNiwxLjY1MXYwLjc4MkgzNi42Nw0KCQkJdi0wLjc4MmMwLTAuNTM2LTAuMTQ4LTAuOTMtMC40NDUtMS4xODRzLTAuNjQ4LTAuMzgtMS4wNTMtMC4zOGMtMC40MDYsMC0wLjc1OCwwLjEyNy0xLjA1NCwwLjM4DQoJCQljLTAuMjk3LDAuMjUzLTAuNDQ1LDAuNjQ4LTAuNDQ1LDEuMTg0djguMTY2YzAsMC41MzYsMC4xNDgsMC45MzEsMC40NDUsMS4xODRjMC4yOTYsMC4yNTMsMC42NDcsMC4zOCwxLjA1NCwwLjM4DQoJCQljMC40MDQsMCwwLjc1Ni0wLjEyNywxLjA1My0wLjM4czAuNDQ1LTAuNjQ3LDAuNDQ1LTEuMTg0di0yLjkxaC0xLjc2di0xLjk1NWgzLjk3NXY0Ljg2NWMwLDAuNjUxLTAuMTA4LDEuMjA5LTAuMzI2LDEuNjcyDQoJCQljLTAuMjE3LDAuNDY0LTAuNDk5LDAuODQ3LTAuODQ2LDEuMTUxYy0wLjM2MywwLjMxOC0wLjc2NSwwLjU1OC0xLjIwNiwwLjcxN2MtMC40NDIsMC4xNTktMC44ODcsMC4yMzgtMS4zMzUsMC4yMzgNCgkJCWMtMC40NDksMC0wLjg5NS0wLjA3OS0xLjMzNi0wLjIzOFMzMywzNy40OTQsMzIuNjUyLDM3LjE3NmMtMC4zNjItMC4zMDUtMC42NTItMC42ODgtMC44NjktMS4xNTENCgkJCWMtMC4yMTctMC40NjMtMC4zMjYtMS4wMjEtMC4zMjYtMS42NzJWMjYuMTg3eiIvPg0KCQk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNNDEuNzI4LDI2LjE4N2MwLTAuNjIzLDAuMTA4LTEuMTczLDAuMzI1LTEuNjUxYzAuMjE4LTAuNDc4LDAuNTA4LTAuODc1LDAuODY5LTEuMTk0DQoJCQljMC4zNDgtMC4zMDQsMC43NDItMC41MzUsMS4xODQtMC42OTVjMC40NDEtMC4xNTksMC44ODctMC4yMzksMS4zMzYtMC4yMzlzMC44OTQsMC4wOCwxLjMzNiwwLjIzOQ0KCQkJYzAuNDQxLDAuMTYsMC44NDMsMC4zOTEsMS4yMDUsMC42OTVjMC4zNDgsMC4zMTksMC42MywwLjcxNywwLjg0NywxLjE5NGMwLjIxOCwwLjQ3OCwwLjMyNiwxLjAyOCwwLjMyNiwxLjY1MXY4LjE2Ng0KCQkJYzAsMC42NTEtMC4xMDgsMS4yMDktMC4zMjYsMS42NzJjLTAuMjE3LDAuNDY0LTAuNDk5LDAuODQ3LTAuODQ3LDEuMTUxYy0wLjM2MiwwLjMxOC0wLjc2NCwwLjU1OC0xLjIwNSwwLjcxNw0KCQkJYy0wLjQ0MiwwLjE1OS0wLjg4NywwLjIzOC0xLjMzNiwwLjIzOHMtMC44OTUtMC4wNzktMS4zMzYtMC4yMzhzLTAuODM2LTAuMzk4LTEuMTg0LTAuNzE3Yy0wLjM2MS0wLjMwNS0wLjY1MS0wLjY4OC0wLjg2OS0xLjE1MQ0KCQkJYy0wLjIxNy0wLjQ2My0wLjMyNS0xLjAyMS0wLjMyNS0xLjY3MlYyNi4xODd6IE00My45NDMsMzQuMzUzYzAsMC41MzYsMC4xNDgsMC45MzEsMC40NDUsMS4xODQNCgkJCWMwLjI5NiwwLjI1MywwLjY0NiwwLjM4LDEuMDUzLDAuMzhjMC40MDUsMCwwLjc1Ni0wLjEyNywxLjA1My0wLjM4czAuNDQ1LTAuNjQ3LDAuNDQ1LTEuMTg0di04LjE2Ng0KCQkJYzAtMC41MzYtMC4xNDgtMC45My0wLjQ0NS0xLjE4NHMtMC42NDctMC4zOC0xLjA1My0wLjM4Yy0wLjQwNiwwLTAuNzU3LDAuMTI3LTEuMDUzLDAuMzhjLTAuMjk3LDAuMjUzLTAuNDQ1LDAuNjQ4LTAuNDQ1LDEuMTg0DQoJCQlWMzQuMzUzeiIvPg0KCTwvZz4NCjwvZz4NCjwvc3ZnPg0K","resourceIcon":"techIcon1","destinationIcon":"locIcon1","enableFeedback": true,"enableActivityCancel":false,"scoreWidgetStyle":"stars","enableComment":true,"feedbackMode":"commentAndRate","scoreProp":"XR_SCORE","commentProp":"XR_COMMENT","translations":{}, "isDigitalAssistantAvailable": false, "applicationId":"", "oracleChatServerURI":"", "oracleChatChannelId":"", "arrivalTimeRange": "ETA", "technicianDelay": "0", "customerAddressVisibility": "customerAddress", "customerPositionOnMap": "exactPosition", "lang": "en-US", "customDomainName": ""}',
version:1,update_date:0,template_label:"theme-hero"},"theme-minimal":{label:"",description:"",content:'{"destinationIconAnchor":"bottom","resourceIconAnchor":"bottom","mainColor":"#e95b54","backgroundColor":"#fff","backgroundImage":"","favicon":"data:image/x-icon;base64,AAABAAEAMjIAAAEAIADIKAAAFgAAACgAAAAyAAAAZAAAAAEAIAAAAAAAECcAACMuAAAjLgAAAAAAAAAAAACzs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/5OTk/+bm5v/m5ub/5ubm/+bm5v/Ozs7/s7Oz/7Ozs/+1tbX/1tbW/+rq6v/j4+P/wsLC/7Ozs/+zs7P/s7Oz/7Ozs//AwMD/4uLi/+rq6v/Z2dn/t7e3/7Ozs/+zs7P/s7Oz/7S0tP/S0tL/6Ojo/+Xl5f/Hx8f/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs//9/f3//////////////////////9zc3P+zs7P/s7Oz/+fn5//////////////////+/v7/xcXF/7Ozs/+zs7P/wMDA//z8/P/////////////////v7+//tLS0/7Ozs/+zs7P/4eHh///////////////////////Ozs7/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz//39/f/4+Pj/wcHB/8HBwf/BwcH/urq6/7Ozs//ExMT///////Dw8P+9vb3/0dHR///////q6ur/s7Oz/7Ozs//l5eX//////9XV1f+9vb3/7e3t///////IyMj/s7Oz/7u7u///////9vb2/8DAwP/Kysr//v7+//Ly8v+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P//f39//b29v+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/83Nzf//////2tra/7Ozs/+0tLT///////Ly8v+zs7P/s7Oz/+7u7v//////ubm5/7Ozs//V1dX//////9HR0f+zs7P/xMTE///////j4+P/s7Oz/7Ozs//39/f/+/v7/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs//9/f3/9vb2/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/zc3N///////Z2dn/s7Oz/7Ozs///////8/Pz/7Ozs/+zs7P/7u7u//////+4uLj/s7Oz/9XV1f//////0tLS/7Ozs//ExMT//////+Li4v+zs7P/s7Oz//b29v/8/Pz/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz//39/f/29vb/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs//Nzc3//////9nZ2f+zs7P/s7Oz///////z8/P/s7Oz/7Ozs//u7u7//////7i4uP/BwcH/3d3d///////S0tL/s7Oz/8TExP//////4uLi/7Ozs/+zs7P/9vb2//z8/P+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P//f39//b29v+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/83Nzf//////2dnZ/7Ozs/+zs7P///////Pz8/+zs7P/s7Oz/+7u7v//////uLi4//j4+P///////////9LS0v+zs7P/xMTE///////i4uL/s7Oz/7Ozs//29vb//Pz8/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs//9/f3/9vb2/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/zc3N///////Z2dn/s7Oz/7Ozs///////8/Pz/7Ozs/+zs7P/7u7u//////+4uLj/zs7O/9HR0f/R0dH/v7+//7Ozs//ExMT//////+Li4v+zs7P/s7Oz//b29v/8/Pz/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz//39/f/29vb/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs//Nzc3//////9nZ2f+zs7P/s7Oz///////z8/P/s7Oz/7Ozs//u7u7//////7i4uP+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/8TExP//////4uLi/7Ozs/+zs7P/9vb2//z8/P+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P//f39//b29v+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/83Nzf//////2dnZ/7Ozs/+zs7P///////Pz8/+zs7P/s7Oz/+7u7v//////uLi4/7Ozs//Dw8P/1tbW/8HBwf+zs7P/xMTE///////i4uL/s7Oz/7Ozs//29vb//Pz8/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs//9/f3/9vb2/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/y8vL///////e3t7/s7Oz/7i4uP//////8fHx/7Ozs/+zs7P/7e3t//////+9vb3/s7Oz/9ra2v//////z8/P/7Ozs/+/v7///////+fn5/+zs7P/tLS0//r6+v/5+fn/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz//39/f/29vb/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+6urr//Pz8//z8/P/f39//7u7u///////d3d3/s7Oz/7Ozs//Y2Nj///////Dw8P/e3t7/+/v7//39/f+9vb3/s7Oz/7S0tP/4+Pj//v7+/+Hh4f/q6ur//////+Xl5f+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P//f39//b29v+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs//Nzc3/+/v7////////////7Ozs/7e3t/+zs7P/s7Oz/7W1tf/o6Oj////////////8/Pz/0dHR/7Ozs/+zs7P/s7Oz/8bGxv/5+fn////////////x8fH/urq6/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs//Dw8P/wsLC/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+5ubn/yMjI/8HBwf+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs//AwMD/yMjI/7q6uv+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7e3t//Hx8f/w8PD/7S0tP+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/s7Oz/7Ozs/+zs7P/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==","resourceNameProp":"pname","showResourcePhoto":true,"showPositionOnMap":true,"showTechnicianRoute":true,"showActivityType":true,"logo":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNi4wLjQsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9ItCo0LDRgF8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgd2lkdGg9IjYwcHgiIGhlaWdodD0iNjBweCIgdmlld0JveD0iMCAwIDYwIDYwIiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCA2MCA2MCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+DQo8Zz4NCgk8Zz4NCgkJPHJlY3QgeT0iMCIgZmlsbD0iI0IzQjNCMyIgd2lkdGg9IjYwIiBoZWlnaHQ9IjYwIi8+DQoJPC9nPg0KCTxnPg0KCQk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMTIuMDQyLDM4LjAwMVYyMi41MzhoMi4yMTV2MTMuMjQ4aDQuMzg3djIuMjE2SDEyLjA0MnoiLz4NCgkJPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTIxLjE4NywyNi4xODdjMC0wLjYyMywwLjEwOC0xLjE3MywwLjMyNi0xLjY1MWMwLjIxNy0wLjQ3OCwwLjUwNy0wLjg3NSwwLjg2OS0xLjE5NA0KCQkJYzAuMzQ4LTAuMzA0LDAuNzQyLTAuNTM1LDEuMTg0LTAuNjk1YzAuNDQyLTAuMTU5LDAuODg3LTAuMjM5LDEuMzM2LTAuMjM5YzAuNDQ5LDAsMC44OTQsMC4wOCwxLjMzNSwwLjIzOQ0KCQkJYzAuNDQxLDAuMTYsMC44NDMsMC4zOTEsMS4yMDYsMC42OTVjMC4zNDcsMC4zMTksMC42MywwLjcxNywwLjg0NywxLjE5NGMwLjIxNywwLjQ3OCwwLjMyNiwxLjAyOCwwLjMyNiwxLjY1MXY4LjE2Ng0KCQkJYzAsMC42NTEtMC4xMDksMS4yMDktMC4zMjYsMS42NzJjLTAuMjE3LDAuNDY0LTAuNSwwLjg0Ny0wLjg0NywxLjE1MWMtMC4zNjIsMC4zMTgtMC43NjQsMC41NTgtMS4yMDYsMC43MTcNCgkJCWMtMC40NDIsMC4xNTktMC44ODcsMC4yMzgtMS4zMzUsMC4yMzhjLTAuNDQ5LDAtMC44OTQtMC4wNzktMS4zMzYtMC4yMzhjLTAuNDQxLTAuMTU5LTAuODM2LTAuMzk4LTEuMTg0LTAuNzE3DQoJCQljLTAuMzYyLTAuMzA1LTAuNjUxLTAuNjg4LTAuODY5LTEuMTUxYy0wLjIxNy0wLjQ2My0wLjMyNi0xLjAyMS0wLjMyNi0xLjY3MlYyNi4xODd6IE0yMy40MDIsMzQuMzUzDQoJCQljMCwwLjUzNiwwLjE0OCwwLjkzMSwwLjQ0NSwxLjE4NGMwLjI5NiwwLjI1MywwLjY0NywwLjM4LDEuMDUzLDAuMzhjMC40MDUsMCwwLjc1Ni0wLjEyNywxLjA1My0wLjM4DQoJCQljMC4yOTYtMC4yNTMsMC40NDUtMC42NDcsMC40NDUtMS4xODR2LTguMTY2YzAtMC41MzYtMC4xNDktMC45My0wLjQ0NS0xLjE4NGMtMC4yOTctMC4yNTMtMC42NDgtMC4zOC0xLjA1My0wLjM4DQoJCQljLTAuNDA2LDAtMC43NTcsMC4xMjctMS4wNTMsMC4zOGMtMC4yOTcsMC4yNTMtMC40NDUsMC42NDgtMC40NDUsMS4xODRWMzQuMzUzeiIvPg0KCQk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMzEuNDU3LDI2LjE4N2MwLTAuNjIzLDAuMTA5LTEuMTczLDAuMzI2LTEuNjUxYzAuMjE3LTAuNDc4LDAuNTA3LTAuODc1LDAuODY5LTEuMTk0DQoJCQljMC4zNDgtMC4zMDQsMC43NDItMC41MzUsMS4xODQtMC42OTVjMC40NDEtMC4xNTksMC44ODctMC4yMzksMS4zMzYtMC4yMzljMC40NDgsMCwwLjg5MywwLjA4LDEuMzM1LDAuMjM5DQoJCQljMC40NDEsMC4xNiwwLjg0MywwLjM5MSwxLjIwNiwwLjY5NWMwLjM0NywwLjMxOSwwLjYyOSwwLjcxNywwLjg0NiwxLjE5NGMwLjIxOCwwLjQ3OCwwLjMyNiwxLjAyOCwwLjMyNiwxLjY1MXYwLjc4MkgzNi42Nw0KCQkJdi0wLjc4MmMwLTAuNTM2LTAuMTQ4LTAuOTMtMC40NDUtMS4xODRzLTAuNjQ4LTAuMzgtMS4wNTMtMC4zOGMtMC40MDYsMC0wLjc1OCwwLjEyNy0xLjA1NCwwLjM4DQoJCQljLTAuMjk3LDAuMjUzLTAuNDQ1LDAuNjQ4LTAuNDQ1LDEuMTg0djguMTY2YzAsMC41MzYsMC4xNDgsMC45MzEsMC40NDUsMS4xODRjMC4yOTYsMC4yNTMsMC42NDcsMC4zOCwxLjA1NCwwLjM4DQoJCQljMC40MDQsMCwwLjc1Ni0wLjEyNywxLjA1My0wLjM4czAuNDQ1LTAuNjQ3LDAuNDQ1LTEuMTg0di0yLjkxaC0xLjc2di0xLjk1NWgzLjk3NXY0Ljg2NWMwLDAuNjUxLTAuMTA4LDEuMjA5LTAuMzI2LDEuNjcyDQoJCQljLTAuMjE3LDAuNDY0LTAuNDk5LDAuODQ3LTAuODQ2LDEuMTUxYy0wLjM2MywwLjMxOC0wLjc2NSwwLjU1OC0xLjIwNiwwLjcxN2MtMC40NDIsMC4xNTktMC44ODcsMC4yMzgtMS4zMzUsMC4yMzgNCgkJCWMtMC40NDksMC0wLjg5NS0wLjA3OS0xLjMzNi0wLjIzOFMzMywzNy40OTQsMzIuNjUyLDM3LjE3NmMtMC4zNjItMC4zMDUtMC42NTItMC42ODgtMC44NjktMS4xNTENCgkJCWMtMC4yMTctMC40NjMtMC4zMjYtMS4wMjEtMC4zMjYtMS42NzJWMjYuMTg3eiIvPg0KCQk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNNDEuNzI4LDI2LjE4N2MwLTAuNjIzLDAuMTA4LTEuMTczLDAuMzI1LTEuNjUxYzAuMjE4LTAuNDc4LDAuNTA4LTAuODc1LDAuODY5LTEuMTk0DQoJCQljMC4zNDgtMC4zMDQsMC43NDItMC41MzUsMS4xODQtMC42OTVjMC40NDEtMC4xNTksMC44ODctMC4yMzksMS4zMzYtMC4yMzlzMC44OTQsMC4wOCwxLjMzNiwwLjIzOQ0KCQkJYzAuNDQxLDAuMTYsMC44NDMsMC4zOTEsMS4yMDUsMC42OTVjMC4zNDgsMC4zMTksMC42MywwLjcxNywwLjg0NywxLjE5NGMwLjIxOCwwLjQ3OCwwLjMyNiwxLjAyOCwwLjMyNiwxLjY1MXY4LjE2Ng0KCQkJYzAsMC42NTEtMC4xMDgsMS4yMDktMC4zMjYsMS42NzJjLTAuMjE3LDAuNDY0LTAuNDk5LDAuODQ3LTAuODQ3LDEuMTUxYy0wLjM2MiwwLjMxOC0wLjc2NCwwLjU1OC0xLjIwNSwwLjcxNw0KCQkJYy0wLjQ0MiwwLjE1OS0wLjg4NywwLjIzOC0xLjMzNiwwLjIzOHMtMC44OTUtMC4wNzktMS4zMzYtMC4yMzhzLTAuODM2LTAuMzk4LTEuMTg0LTAuNzE3Yy0wLjM2MS0wLjMwNS0wLjY1MS0wLjY4OC0wLjg2OS0xLjE1MQ0KCQkJYy0wLjIxNy0wLjQ2My0wLjMyNS0xLjAyMS0wLjMyNS0xLjY3MlYyNi4xODd6IE00My45NDMsMzQuMzUzYzAsMC41MzYsMC4xNDgsMC45MzEsMC40NDUsMS4xODQNCgkJCWMwLjI5NiwwLjI1MywwLjY0NiwwLjM4LDEuMDUzLDAuMzhjMC40MDUsMCwwLjc1Ni0wLjEyNywxLjA1My0wLjM4czAuNDQ1LTAuNjQ3LDAuNDQ1LTEuMTg0di04LjE2Ng0KCQkJYzAtMC41MzYtMC4xNDgtMC45My0wLjQ0NS0xLjE4NHMtMC42NDctMC4zOC0xLjA1My0wLjM4Yy0wLjQwNiwwLTAuNzU3LDAuMTI3LTEuMDUzLDAuMzhjLTAuMjk3LDAuMjUzLTAuNDQ1LDAuNjQ4LTAuNDQ1LDEuMTg0DQoJCQlWMzQuMzUzeiIvPg0KCTwvZz4NCjwvZz4NCjwvc3ZnPg0K","resourceIcon":"techIcon1","destinationIcon":"locIcon1","enableFeedback":true,"enableActivityCancel":false,"scoreWidgetStyle":"stars","enableComment":true,"scoreProp":"XR_SCORE","feedbackMode":"commentAndRate","commentProp":"XR_COMMENT","translations":{}, "isDigitalAssistantAvailable": false, "applicationId":"", "oracleChatServerURI":"", "oracleChatChannelId":"", "arrivalTimeRange": "ETA", "technicianDelay": "0", "customerAddressVisibility": "customerAddress", "customerPositionOnMap": "exactPosition", "lang": "en-US", "customDomainName": ""}',
version:1,update_date:0,template_label:"theme-minimal"}},themeManifests:{"theme-bright":{label:"theme-bright",title:"Bright",localizationTranslations:[{label:"companyName"},{label:"serviceAddress"},{label:"scheduled"},{label:"detailsOfService"},{label:"assigned"},{label:"onTheWay"},{label:"willArrive"},{label:"technicianWillArriveBetween1Line"},{label:"technicianWillArriveBetween2Line"},{label:"notAssignedTechnicianWillArriveBetween1Line"},{label:"notAssignedTechnicianWillArriveBetween2Line"},{label:"notAssignedTechnicianWillArriveDay1Line"},
{label:"notAssignedTechnicianWillArriveDay2Line"},{label:"onTheWayTime1Line"},{label:"onTheWayTime2Line"},{label:"arrived"},{label:"finalScreenTitle"},{label:"activityActionNetworkError"},{label:"activityActionOtherError"}],feedbackTranslations:[{label:"feedbackHeader"},{label:"feedbackRatioQuestion",visible:"this.feedbackMode() === 'rate' || this.feedbackMode() === 'commentAndRate'"},{label:"feedbackMessagePlaceholder",visible:"this.feedbackMode() === 'comment' || this.feedbackMode() === 'commentAndRate'"},
{label:"feedbackSubmitButton"}],activityCancelTranslations:[{label:"btnCancel"},{label:"cancelActivityConfirmationMessage"},{label:"cancelActivityConfirmationSubmit"},{label:"cancelActivityConfirmationDismiss"}]},"theme-hero":{label:"theme-hero",title:"Hero",localizationTranslations:[{label:"companyName"},{label:"scheduled"},{label:"serviceAddress"},{label:"detailsOfService"},{label:"isYourTechnician"},{label:"willArrive"},{label:"onTheWayEta"},{label:"hasArrived"},{label:"finalScreenTitle"},{label:"activityActionNetworkError"},
{label:"activityActionOtherError"}],feedbackTranslations:[{label:"feedbackHeader"},{label:"feedbackRatioQuestion",visible:"this.feedbackMode() === 'rate' || this.feedbackMode() === 'commentAndRate'"},{label:"feedbackMessagePlaceholder",visible:"this.feedbackMode() === 'comment' || this.feedbackMode() === 'commentAndRate'"},{label:"feedbackSubmitButton"}],activityCancelTranslations:[{label:"btnCancel"},{label:"cancelActivityConfirmationMessage"},{label:"cancelActivityConfirmationSubmit"},{label:"cancelActivityConfirmationDismiss"}]},
"theme-minimal":{label:"theme-minimal",title:"Minimal",localizationTranslations:[{label:"companyName"},{label:"scheduled"},{label:"notAssignedTechnicianWillArriveBetween1Line"},{label:"notAssignedTechnicianWillArriveBetween2Line"},{label:"timeAtTitle"},{label:"serviceAddress"},{label:"detailsOfService"},{label:"isYourTechnician"},{label:"willArrive"},{label:"onTheWayEta"},{label:"hasArrived"},{label:"finalScreenTitle"},{label:"activityActionNetworkError"},{label:"activityActionOtherError"}],feedbackTranslations:[{label:"feedbackHeader"},
{label:"feedbackRatioQuestion",visible:"this.feedbackMode() === 'rate' || this.feedbackMode() === 'commentAndRate'"},{label:"feedbackMessagePlaceholder",visible:"this.feedbackMode() === 'comment' || this.feedbackMode() === 'commentAndRate'"},{label:"feedbackSubmitButton"}],activityCancelTranslations:[{label:"btnCancel"},{label:"cancelActivityConfirmationMessage"},{label:"cancelActivityConfirmationSubmit"},{label:"cancelActivityConfirmationDismiss"}]}}}))})(toa);(function(d){var c,b=d.views.wmtTheme.ServiceManifests,e=d.views.BaseForm,g="techIcon1 techIcon2 techIcon3 techIcon4 techIcon5 techIcon6 locIcon1 locIcon2 locIcon3".split(" ");d.ns("toa.views.wmtTheme.DetailsForm",d.define(e,function(b){e.apply(this,arguments);c=c||require("knockout");this.templatesData=b.templatesData;this.screenModel=b.screenModel;this.postMessageData={name:"set",data:{status:"onTheWay",resourceDetails:{resourceId:"33001",phone:"555003300100",name:"ARNDT, William"},activityDetails:{serviceWindowStart:"18:10:00",
serviceWindowEnd:"18:30:00",deliveryWindowStart:"08:15:00",deliveryWindowEnd:"08:45:00",timeDeliveredStart:"09:15:00",timeDeliveredEnd:"09:55:00",date:"2019-11-11",startTime:"2019-09-19 20:50:00",endTime:"2019-09-07 09:09:00",activityType:"PL",timeSlot:"all-day",city:"Brooklyn",postalCode:"11221",stateProvince:"NY",streetAddress:"12345 Stuyvesant Ave",activityId:4225372,timeZoneDiff:-240,timeZoneIANA:"America/New_York"},activityTypes:[{label:"PL",name:"Plumbing"}],longitude:-81.27517,latitude:28.79454,
theme:{}}};this.zoomIframeStatus="notAssigned";require(["ojtranslations/nls/localeElements"],function(b){this.ojetLangs=b}.bind(this))},{template:'<div><div id="detailsContainer"><div class="popup-anchor"></div><div class="versionHistory"><div class="screensListContainer"><div class="screensList"><div id="unassignedScreenWrapper" tabindex="0" class="frame-wrapper"><div class="iframe-o-h"><iframe id="unassignedScreen" tabindex="-1" class="screen-frame" title="'+h(24276)+'"></iframe></div></div><div class="screen-arrow"></div><div id="assignedScreenWrapper" tabindex="0" class="frame-wrapper"><div class="iframe-o-h"><iframe id="assignedScreen" tabindex="-1" class="screen-frame" title="'+
h(24277)+'"></iframe></div></div><div class="screen-arrow"></div><div id="onTheWayScreenWrapper" tabindex="0" class="frame-wrapper"><div class="iframe-o-h"><iframe id="onTheWayScreen" tabindex="-1" class="screen-frame" title="'+h(24278)+'"></iframe></div></div><div class="screen-arrow"></div><div id="inProgressScreenWrapper" tabindex="0" class="frame-wrapper"><div class="iframe-o-h"><iframe id="inProgressScreen" tabindex="-1" class="screen-frame" title="'+h(24279)+'"></iframe></div></div><div class="screen-arrow" data-bind="visible: model.enableFeedback().length"></div><div id="feedbackScreenWrapper" tabindex="0"  class="frame-wrapper" data-bind="visible: model.enableFeedback().length"><div class="iframe-o-h"><iframe id="feedbackScreen" tabindex="-1" class="screen-frame" title="'+
h(24280)+'"></iframe></div></div></div><div class="label-list"><div class="screen-label">'+h(24276)+'</div><div class="screen-label">'+h(24277)+'</div><div class="screen-label">'+h(24278)+'</div><div class="screen-label">'+h(24279)+'</div><div class="screen-label" data-bind="visible: model.enableFeedback().length">'+h(24280)+'</div></div></div></div><oj-popup id="wmt-zoommed-iframe-popup" class="wmt-iframe-popup"><iframe id="zoommedIframeScreen" class="zoomed-iframe-screen"></iframe><button id="iframePopupBtnClose" class="iframe-popup-btn-close">+</button></oj-popup><oj-popup id="wmt-translation-description-popup">\x3c!-- ko if: selectedTranslation --\x3e<div class="wmt-theme-details-screen"><div class="wmt-translation-info"><div class="wmt-translation-info-row"><div class="wmt-translation-info-row-title">'+
h(23831)+'</div><div class="wmt-translation-info-row-value" data-bind="text: selectedTranslation().description()"></div></div><div class="wmt-translation-info-row"><div class="wmt-translation-info-row-title">'+h(23832)+'</div><div class="wmt-translation-info-row-value" data-bind="text: selectedTranslation().defaultValue"></div></div>\x3c!-- ko if: selectedTranslation().placeholders().length > 0 --\x3e<div class="wmt-translation-info-section-header">'+h(23833)+'</div><div data-bind="foreach: selectedTranslation().placeholders()"><div class="wmt-translation-info-placeholder" data-bind="click: $parent.insertPlaceholder"><span class="wmt-translation-info-placeholder-label" data-bind="text: label"></span><span class="wmt-translation-info-placeholder-description" data-bind="text: description"></span></div></div>\x3c!-- /ko --\x3e</div></div>\x3c!-- /ko --\x3e</oj-popup><div id="jet-component-container"><oj-tab-bar aria-label="'+
h(24200)+'" display="all" edge="start" selection="{{selectedTab}}" data-ofsc-role="entity-lst" ><ul><li id="branding" data-ofsc-role="button" data-ofsc-operation="branding"><a href="#"><span class="oj-tabbar-item-icon demo-icon-font-24"></span>'+h(24271)+'</a></li><li id="technician" data-ofsc-role="button" data-ofsc-operation="attributes"><a href="#"><span class="oj-tabbar-item-icon demo-icon-font-24"></span>'+h(225660)+'</a></li><li id="map" data-ofsc-role="button" data-ofsc-operation="map"><a href="#"><span class="oj-tabbar-item-icon demo-icon-font-24"></span>'+
h(225661)+'</a></li><li id="localization" data-ofsc-role="button" data-ofsc-operation="localization"><a href="#"><span class="oj-tabbar-item-icon demo-icon-font-24"></span>'+h(24273)+'</a></li><li id="feedback" data-ofsc-role="button" data-ofsc-operation="feedback"><a href="#"><span class="oj-tabbar-item-icon demo-icon-font-24"></span>'+h(24274)+'</a></li><li id="communications" data-ofsc-role="button" data-ofsc-operation="communications"><a href="#"><span class="oj-tabbar-item-icon demo-icon-font-24"></span>'+
h(24275)+'</a></li></ul></oj-tab-bar><div class="config-content"><div class="panel" id="branding-panel" data-bind="visible: (selectedTab() === \'branding\')"><dl class="tab-panel"><dt><div class="oj-flex-bar-start"><oj-label class="oj-label-inline" data-ofsc-role="field-label" data-ofsc-field="label">'+h(24266)+'</oj-label></div></dt><dd><div><span class="label-jet" data-bind="text: model.label" data-ofsc-role="field-value" data-ofsc-field="label"></span></div></dd><dt><div class="oj-flex-bar-start"><oj-label class="oj-label-inline" for="description" data-ofsc-role="field-label" data-ofsc-field="description">'+
h(24267)+'</oj-label></div></dt><dd><oj-text-area id="description" value="{{model.description}}" data-ofsc-role="field-value" data-ofsc-field="description" data-bind="readonly: readOnlyMode"></oj-text-area><div data-bind="foreach: getErrorListArray(\'description\')"><p data-bind="text: $data" class="oj-text-sm input-hint input-error active-error"></p></div></dd><dt><div class="oj-flex-bar-start"><oj-label class="oj-label-inline" for="templateLabel" data-ofsc-role="field-label" data-ofsc-field="templateLabel">'+
h(24270)+'</oj-label></div></dt><dd><div class="oj-flex-bar-middle"><oj-select-one id="templateLabel" value="{{model.template_label}}" data-ofsc-role="field-value" data-ofsc-field="templateLabel" options="[[templatesLabels]]" data-bind="disable: readOnlyMode"></oj-select-one></div></dd><dt><div class="oj-flex-bar-start"><oj-label class="oj-label-inline" data-ofsc-role="field-label" data-ofsc-field="mainColor">'+h(23804)+'</oj-label></div></dt><dd><div class="oj-bar-middle pos-r"><input type="text" id="mainColor" class="main-color" aria-label="'+
h(23804)+'" data-bind="value: model.mainColor, disable: readOnlyMode" autocomplete="off" data-ofsc-role="field-value" data-ofsc-field="mainColor"><label id="mainColorHint" class="main-color-hint"></label><oj-popup id="mainColorPalettePopup" class="popup-no-padding"><div class="demo-palette-panel oj-panel oj-panel-shadow-lg wmt-theme-palette-panel"><oj-color-palette id="mainColorPalette" class="demo-palette-picker" palette="[[colors]]" swatch-size="sm" layout="grid" value="{{paletteMainColor}}"></oj-color-palette></div></oj-popup><div data-bind="foreach: getErrorListArray(\'mainColor\')"><p data-bind="text: $data" class="oj-text-sm input-hint input-error active-error"></p></div></div></dd><dt><div class="oj-flex-bar-start"><oj-label class="oj-label-inline" data-ofsc-role="field-label" data-ofsc-field="backgroundColor">'+
h(23805)+'</oj-label></div></dt><dd><div class="oj-bar-middle pos-r"><input type="text" id="backgroundColor" class="background-color" aria-label="'+h(23805)+'" data-bind="value: model.backgroundColor, disable: readOnlyMode" autocomplete="off" data-ofsc-role="field-value" data-ofsc-field="backgroundColor"><label id="backgroundColorHint" class="background-color-hint"></label><oj-popup id="backgroundColorPalettePopup" class="popup-no-padding"><div class="demo-palette-panel oj-panel oj-panel-shadow-lg wmt-theme-palette-panel"><oj-color-palette id="backgroundColorPalette" class="demo-palette-picker" palette="[[colors]]" swatch-size="sm" layout="grid" value="{{paletteBackgroundColor}}"></oj-color-palette></div></oj-popup><div data-bind="foreach: getErrorListArray(\'backgroundColor\')"><p data-bind="text: $data" class="oj-text-sm input-hint input-error active-error"></p></div></div></dd><dt data-bind="visible: model.template_label() === \'theme-hero\'"><div class="oj-flex-bar-start"><oj-label class="oj-label-inline">'+
h(23806)+'</oj-label></div></dt><dd data-bind="visible: model.template_label() === \'theme-hero\'"><div class="picture-loader-container no-preview"><div class="controls-wrapper"><span class="input-file-name" data-bind="text: backgroundImageName"></span><label for="chooseBackgroundImage" class="loader-lbl">'+h(22960)+'<input type="file" id="chooseBackgroundImage" class="loader-btn" data-bind="disable: readOnlyMode"></label></div><p class="oj-text-sm input-hint">'+h(24057)+'</p><div data-bind="foreach: getErrorListArray(\'backgroundImage\')"><p data-bind="text: $data" class="oj-text-sm input-hint input-error active-error"></p></div></div></dd><dt><div class="oj-flex-bar-start"><oj-label class="oj-label-inline no-tm-label" data-ofsc-role="field-label" data-ofsc-field="chooseLogo">'+
h(23813)+'</oj-label></div></dt><dd><div class="picture-loader-container no-preview"><div class="controls-wrapper"><span class="input-file-name" data-bind="text: companyLogoName"></span><label for="chooseLogo" class="loader-lbl">'+h(22960)+'<input type="file" id="chooseLogo" class="loader-btn" data-bind="disable: readOnlyMode"></label></div><p class="oj-text-sm input-hint">'+h(24282)+'</p><div data-bind="foreach: getErrorListArray(\'logo\')"><p data-bind="text: $data" class="oj-text-sm input-hint input-error active-error"></p></div></div></dd><dt><div class="oj-flex-bar-start"><oj-label class="oj-label-inline no-tm-label" data-ofsc-role="field-label" data-ofsc-field="chooseFavicon">'+
h(23812)+'</oj-label></div></dt><dd><div class="picture-loader-container no-preview"><div class="controls-wrapper"><span class="input-file-name" data-bind="text: companyFaviconName"></span><label for="chooseFavicon" class="loader-lbl">'+h(22960)+'<input type="file" id="chooseFavicon" class="loader-btn" data-bind="disable: readOnlyMode"></label></div><p class="oj-text-sm input-hint">'+h(24053)+'</p><div data-bind="foreach: getErrorListArray(\'favicon\')"><p data-bind="text: $data" class="oj-text-sm input-hint input-error active-error"></p></div></div></dd><dt><div class="oj-flex-bar-start"><oj-label class="oj-label-inline" for="customDomainName" data-ofsc-role="field-label" data-ofsc-field="customDomainName">'+
h(225662)+'</oj-label></div></dt><dd><div class="oj-flex-bar-middle d-block"><oj-input-text value="{{model.customDomainName}}" id="customDomainName" data-ofsc-role="field-value" data-bind="readonly: readOnlyMode" data-ofsc-field="technicianApproximate" aria-label="customDomainName"></oj-input-text><p class="oj-text-sm input-hint">'+h(225663)+'</p><div data-bind="foreach: getErrorListArray(\'customDomainName\')"><p data-bind="text: $data" class="oj-text-sm input-hint input-error active-error"></p></div></div></dd></dl></div><div data-bind="visible: (selectedTab() === \'technician\')" id="technician-panel" class="panel"><dl class="tab-panel"><dt><div class="oj-flex-bar-start"><oj-label class="oj-label-inline" for="arrivalTimeRange" data-ofsc-role="field-label" data-ofsc-field="arrivalTimeRange">'+
h(225664)+'</oj-label></div></dt><dd><div class="oj-flex-bar-middle d-block"><oj-select-one value="{{model.arrivalTimeRange}}" options="[[arrivalTimeRangeOptions]]" id="arrivalTimeRange" data-ofsc-role="field-value" data-ofsc-field="arrivalTimeRange" data-bind="disable: readOnlyMode"></oj-select-one><p class="oj-text-sm input-hint">'+h(225665)+'</p></div></dd><dt><div class="oj-flex-bar-start"><oj-label class="oj-label-inline" for="serviceDetailsVisibility" data-ofsc-role="field-label" data-ofsc-field="serviceDetailsVisibility">'+
h(225666)+'</oj-label></div></dt><dd><div class="oj-flex-bar-middle d-block"><oj-select-one value="{{serviceDetailsVisibility}}" options="[[serviceDetailsVisibilityOptions]]" id="serviceDetailsVisibility" data-bind="disable: readOnlyMode"data-ofsc-role="field-value" data-ofsc-field="serviceDetailsVisibility"></oj-select-one><p class="oj-text-sm input-hint">'+h(225667)+'</p></div></dd><dt><div class="oj-flex-bar-start"><oj-label class="oj-label-inline" for="customerAddressVisibility" data-ofsc-role="field-label" data-ofsc-field="customerAddressVisibility">'+
h(225668)+'</oj-label></div></dt><dd><div class="oj-flex-bar-middle d-block"><oj-select-one value="{{model.customerAddressVisibility}}" options="[[customerAddressVisibilityOptions]]" id="customerAddressVisibility" data-bind="disable: readOnlyMode"data-ofsc-role="field-value" data-ofsc-field="customerAddressVisibility"></oj-select-one><p class="oj-text-sm input-hint">'+h(225669)+'</p></div></dd><dt><div class="oj-flex-bar-start"><oj-label class="oj-label-inline" for="resourceNameProp" data-ofsc-role="field-label" data-ofsc-field="resourceNameProp">'+
h(23828)+'</oj-label></div></dt><dd><div class="oj-flex-bar-middle d-block"><oj-select-one value="{{model.resourceNameProp}}" options="[[resourceProperties]]" id="resourceNameProp" data-bind="disable: readOnlyMode"data-ofsc-role="field-value" data-ofsc-field="resourceNameProp"></oj-select-one><p class="oj-text-sm input-hint">'+h(225670)+'</p></div></dd><dt><div class="oj-flex-bar-start"><oj-label class="oj-label-inline" for="showResourcePhoto" data-ofsc-role="field-label" data-ofsc-field="showResourcePhoto">'+
h(225671)+'</oj-label></div></dt><dd><div class="oj-flex-bar-middle"><oj-checkboxset id="showResourcePhoto" value="{{model.showResourcePhoto}}" data-bind="disable: readOnlyMode"data-ofsc-role="field-value" data-ofsc-field="showResourcePhoto"><oj-option aria-label="'+h(225671)+'" value="true"></oj-option></oj-checkboxset></div></dd></dl></div><div data-bind="visible: (selectedTab() === \'map\')" id="map-panel" class="panel"><dl class="tab-panel"><dt><div class="oj-flex-bar-start"><oj-label class="oj-label-inline" for="customerPositionOnMap" data-ofsc-role="field-label" data-ofsc-field="customerPositionOnMap">'+
h(225672)+'</oj-label></div></dt><dd><div class="oj-flex-bar-middle d-block"><oj-select-one value="{{model.customerPositionOnMap}}" options="[[customerPositionOnMapOptions]]" id="customerPositionOnMap" data-bind="disable: readOnlyMode"data-ofsc-role="field-value" data-ofsc-field="customerPositionOnMap"></oj-select-one></div></dd><dt data-bind="visible: !isLocationIconHidden()"><div class="oj-flex-bar-start"><oj-label class="oj-label-inline" data-ofsc-role="field-label" data-ofsc-field="loadedDestinationIcon">'+
h(225673)+'</oj-label></div></dt><dd data-bind="visible: !isLocationIconHidden()"><div class="flex-cont"><div class="img-combobox"><div class="select-wrapper"><div id="customDestinationIconImg" data-bind="style: { \'background-image\': selectedDestinationIcon }" class="preview-img"></div><div class="select-input" tabindex="0" id="locationIconSelect">'+h(23823)+'</div><oj-popup id="customDestinationIconPopup" class="wmt-img-combobox-popup" ><div class="flex-cont"><ul class="img-list"><li class="img-item" data-bind="visible: loadedDestinationIcon() !== \'\', css: {\'anchor-frame\' : model.destinationIcon().length > 10}"><div class="icon-preview-large" data-bind="style: { \'background-image\': selectedDestinationIcon }"></div><div class="anchor center" data-bind="css: {\'active\': model.destinationIconAnchor() === \'center\'}"></div><div class="anchor bottom" data-bind="css: {\'active\': model.destinationIconAnchor() === \'bottom\'}"></div></li></ul><div class="img-radio"><oj-label class="oj-label-inline" data-ofsc-role="field-label" data-ofsc-field="destinationIconAnchor">'+
h(23820)+'</oj-label><oj-radioset id="destinationIconAnchorMode" value="{{model.destinationIconAnchor}}" data-bind="readonly: readOnlyMode" data-ofsc-role="field-value" data-ofsc-field="destinationIconAnchor"><oj-option value="center">'+h(23808)+'</oj-option><oj-option value="bottom">'+h(23807)+'</oj-option></oj-radioset></div></div></oj-popup></div><oj-popup id="locationIconPopup" tabindex="0" class="wmt-img-combobox-popup"><ul class="img-list"><li class="img-item" data-bind="click: setDestinationIcon"><img id="locIcon1" data-bind="attr:{src: defaultLocationIcons[\'locIcon1\']}" alt=""></li><li class="img-item" data-bind="click: setDestinationIcon"><img id="locIcon2" data-bind="attr:{src: defaultLocationIcons[\'locIcon2\']}" alt=""></li><li class="img-item" data-bind="click: setDestinationIcon"><img id="locIcon3" data-bind="attr:{src: defaultLocationIcons[\'locIcon3\']}" alt=""></li></ul></oj-popup></div><label for="chooseLocationIcon" class="add-img-lbl">'+
h(22960)+'<input id="chooseLocationIcon" tabinex="0" type="file" class="add-img-input" data-bind="disable: readOnlyMode"></label></div><div data-bind="foreach: getErrorListArray(\'destinationIcon\')"><p data-bind="text: $data" class="oj-text-sm input-hint input-error active-error"></p></div></dd><dt data-bind="visible: !isTechnicianPositionOnMapHidden()"><div class="oj-flex-bar-start"><oj-label class="oj-label-inline" for="technicianPositionOnMap" data-ofsc-role="field-label" data-ofsc-field="technicianPositionOnMap">'+
h(225674)+'</oj-label></div></dt><dd data-bind="visible: !isTechnicianPositionOnMapHidden()"><div class="oj-flex-bar-middle d-block"><oj-select-one value="{{technicianPositionOnMap}}" options="[[technicianPositionOnMapOptions()]]" id="technicianPositionOnMap" data-bind="disable: readOnlyMode" data-ofsc-role="field-value" data-ofsc-field="technicianPositionOnMap"></oj-select-one></div></dd><dt data-bind="visible: !isTechnicianApproximateHidden()"><div class="oj-flex-bar-start"><oj-label class="oj-label-inline" for="technicianDelay" data-ofsc-role="field-label" data-ofsc-field="technicianDelay">'+
h(225675)+'</oj-label></div></dt><dd data-bind="visible: !isTechnicianApproximateHidden()"><div class="oj-flex-bar-middle d-block"><div class="delay-wrapper"><oj-input-text value="{{model.technicianDelay}}" id="technicianDelay" data-ofsc-role="field-value" data-ofsc-field="technicianApproximate" data-bind="readonly: readOnlyMode" aria-label="technicianDelay"></oj-input-text><div>'+h(225691)+'</div></div><p class="oj-text-sm input-hint">'+h(225676)+'</p><div data-bind="foreach: getErrorListArray(\'technicianDelay\')"><p data-bind="text: $data" class="oj-text-sm input-hint input-error active-error"></p></div></div></dd><dt data-bind="visible: !isTechnicianIconHidden()"><div class="oj-flex-bar-start"><oj-label class="oj-label-inline" data-ofsc-role="field-label" data-ofsc-field="loadedTechnicianIcon">'+
h(23827)+'</oj-label></div></dt><dd data-bind="visible: !isTechnicianIconHidden()"><div class="flex-cont"><div class="img-combobox"><div class="select-wrapper"><div id="customResourceIconImg" data-bind="style: { \'background-image\': selectedResourceIcon }" class="preview-img"></div><div class="select-input" tabindex="0" id="technicianIconSelect">'+h(23823)+'</div><oj-popup id="customResourceIconPopup" class="wmt-img-combobox-popup"><div class="flex-cont"><ul class="img-list"><li class="img-item" data-bind="visible: loadedTechnicianIcon() !== \'\', css: {\'anchor-frame\' : model.resourceIcon().length > 10}"><div class="icon-preview-large" data-bind="style: { \'background-image\': selectedResourceIcon}"></div><div class="anchor center" data-bind="css: {\'active\': model.resourceIconAnchor() === \'center\'}"></div><div class="anchor bottom" data-bind="css: {\'active\': model.resourceIconAnchor() === \'bottom\'}"></div></li></ul><div class="img-radio "><oj-label class="oj-label-inline" data-ofsc-role="field-label" data-ofsc-field="resourceIconAnchor">'+
h(23820)+'</oj-label><oj-radioset id="resourceIconAnchorMode" value="{{model.resourceIconAnchor}}" data-bind="readonly: readOnlyMode" data-ofsc-role="field-value" data-ofsc-field="resourceIconAnchor"><oj-option value="center">'+h(23808)+'</oj-option><oj-option value="bottom">'+h(23807)+'</oj-option></oj-radioset></div></div></oj-popup></div><oj-popup id="technicianIconPopup" class="wmt-img-combobox-popup"><ul class="img-list"><li class="img-item" data-bind="click: setTechnicianIcon"><img id="techIcon1" data-bind="attr:{src: defaultTechnicianIcons[\'techIcon1\']}" alt=""></li><li class="img-item" data-bind="click: setTechnicianIcon"><img id="techIcon2" data-bind="attr:{src: defaultTechnicianIcons[\'techIcon2\']}" alt=""></li><li class="img-item" data-bind="click: setTechnicianIcon"><img id="techIcon3" data-bind="attr:{src: defaultTechnicianIcons[\'techIcon3\']}" alt=""></li><li class="img-item" data-bind="click: setTechnicianIcon"><img id="techIcon4" data-bind="attr:{src: defaultTechnicianIcons[\'techIcon4\']}" alt=""></li><li class="img-item" data-bind="click: setTechnicianIcon"><img id="techIcon5" data-bind="attr:{src: defaultTechnicianIcons[\'techIcon5\']}" alt=""></li><li class="img-item" data-bind="click: setTechnicianIcon"><img id="techIcon6" data-bind="attr:{src: defaultTechnicianIcons[\'techIcon6\']}" alt=""></li></ul></oj-popup></div><label for="chooseTechnicianIcon" class="add-img-lbl">'+
h(22960)+'<input id="chooseTechnicianIcon" tabinex="0" type="file" class="add-img-input" data-bind="disable: readOnlyMode"></label></div><div data-bind="foreach: getErrorListArray(\'resourceIcon\')"><p data-bind="text: $data" class="oj-text-sm input-hint input-error active-error"></p></div></dd></dl></div><div class="panel" id="localization-panel" data-bind="visible: (selectedTab() === \'localization\')"><dl class="tab-panel"><dt><div class="oj-flex-bar-start"><oj-label class="oj-label-inline" for="lang" data-ofsc-role="field-label" data-ofsc-field="lang">'+
h(225677)+'</oj-label></div></dt><dd><div class="oj-flex-bar-middle d-block"><oj-select-one value="{{model.lang}}" options="[[localesList]]" id="lang" data-bind="disable: readOnlyMode" data-ofsc-role="field-value" data-ofsc-field="lang"></oj-select-one><p class="oj-text-sm input-hint">'+h(225678)+'</p></div></dd><dt></dt><dd><div class="translations-list" data-bind="foreach: localizationTranslations">\x3c!-- ko if: visible --\x3e<div class="translation-row" data-bind="attr: { \'data-label\': translation.label }"><div class="translation-value-wrapper"><div class="translation-value translation-value--short" data-bind="css: { overridden: translation.isOverridden, focused: translation.isValueFocused }"><input class="oj-form-control oj-component-initnode" data-bind="textInput: translation.value, readonly: $parent.readOnlyMode, attr: { placeholder: translation.defaultValue, \'aria-label\': translation.defaultValue, id: translation.id, \'data-ofsc-field\': translation.id}, event: { focus: translation.onValueFocus, blur: translation.onValueBlur }" placeholder="{{translation.defaultValue}}"data-ofsc-role="field-value"><div class="translation-actions"><a class="translation-actions-button oj-fwk-icon help-icon oj-clickable-icon-nocontext" data-bind="click: translation.showInfo"></a></div><div data-bind="foreach: $root.getErrorListArray(translation.label)"><p data-bind="text: $data" class="oj-text-sm input-hint input-error active-error"></p></div></div></div></div>\x3c!-- /ko --\x3e</div></dd></dl></div><div data-bind="visible: (selectedTab() === \'feedback\')" id="feedback-panel" class="panel"><dl class="tab-panel"><dt><div class="oj-flex-bar-start"><oj-label for="enableFeedback" class="oj-label-inline" data-ofsc-role="field-label" data-ofsc-field="enableFeedback">'+
h(23818)+'</oj-label></div></dt><dd><div class="oj-flex-bar-middle"><oj-checkboxset id="enableFeedback" value="{{model.enableFeedback}}" data-bind="disable: readOnlyMode" data-ofsc-role="field-value" data-ofsc-field="enableFeedback"><oj-option aria-label="'+h(23818)+'" value="true"></oj-option></oj-checkboxset></div></dd><dt data-bind="visible: model.enableFeedback().length"><div class="oj-flex-bar-start"><oj-label class="oj-label-inline" for="feedbackMode" data-ofsc-role="field-label" data-ofsc-field="feedbackMode">'+
h(24274)+'</oj-label></div></dt><dd data-bind="visible: model.enableFeedback().length"><div class="oj-flex-bar-middle"><oj-radioset id="feedbackModeId" value="{{model.feedbackMode}}" data-bind="readonly: readOnlyMode" data-ofsc-role="field-value" data-ofsc-field="feedbackMode"><oj-option id="commentAndRate" value="commentAndRate">'+h(23809)+'</oj-option><oj-option id="comment" value="comment">'+h(23810)+'</oj-option><oj-option id="rate" value="rate">'+h(23811)+'</oj-option></oj-radioset></div></dd><dt data-bind="visible: model.enableFeedback().length && (model.feedbackMode() !== \'rate\') "><div class="oj-flex-bar-start"><oj-label class="oj-label-inline" for="commentProp" data-ofsc-role="field-label" data-ofsc-field="commentProp">'+
h(23822)+'</oj-label></div></dt><dd data-bind="visible: model.enableFeedback().length && (model.feedbackMode() !== \'rate\')"><oj-select-one id="commentProp" class="normal-list-fields" value="{{model.commentProp}}" options="[[commentProperties]]" data-bind="disable: readOnlyMode" data-ofsc-role="field-value" data-ofsc-field="commentProp"></oj-select-one></dd><dt data-bind="visible: model.enableFeedback().length && (model.feedbackMode() !== \'comment\')"><div class="oj-flex-bar-start"><oj-label class="oj-label-inline" for="scoreProp" data-ofsc-role="field-label" data-ofsc-field="scoreProp">'+
h(14224)+'</oj-label></div></dt><dd data-bind="visible: model.enableFeedback().length && (model.feedbackMode() !== \'comment\')"><oj-select-one id="scoreProp" class="normal-list-fields" value="{{model.scoreProp}}" options="[[rateProperties]]" data-bind="disable: readOnlyMode" data-ofsc-role="field-value" data-ofsc-field="scoreProp"></oj-select-one></dd><dt data-bind="visible: model.enableFeedback().length"><div class="oj-flex-bar-start"><oj-label class="oj-label-inline">'+h(24273)+'</oj-label></div></dt><dd data-bind="visible: model.enableFeedback().length"></dd><dt><div class="oj-flex-bar-start"><oj-label class="oj-label-inline"></oj-label></div></dt><dd data-bind="visible: model.enableFeedback().length, foreach: feedbackTranslations">\x3c!-- ko if: visible --\x3e<div class="translation-row" data-bind="attr: { \'data-label\': translation.label }"><div class="translation-value-wrapper"><div class="translation-value translation-value--short" data-bind="css: { overridden: translation.isOverridden, focused: translation.isValueFocused }"><input class="oj-form-control oj-component-initnode"  data-bind="textInput: translation.value, readonly: $parent.readOnlyMode, attr: { placeholder: translation.defaultValue, \'aria-label\' : translation.defaultValue, id: translation.id, \'data-ofsc-field\': translation.id}, event: { focus: translation.onValueFocus, blur: translation.onValueBlur }"  placeholder="{{translation.defaultValue}}" data-ofsc-role="field-value"><div class="translation-actions"><a class="translation-actions-button oj-fwk-icon help-icon oj-clickable-icon-nocontext" data-bind="click: translation.showInfo"></a></div><div data-bind="foreach: $root.getErrorListArray(translation.label)"><p data-bind="text: $data" class="oj-text-sm input-hint input-error active-error"></p></div></div></div></div>\x3c!-- /ko --\x3e</dd></dl></div><div data-bind="visible: (selectedTab() === \'communications\')" id="communications-panel" class="panel"><dl class="tab-panel"><dt><div class="oj-flex-bar-start"><oj-label class="oj-label-inline" id="enableActivityCancelLabel" data-ofsc-role="field-label" data-ofsc-field="enableActivityCancelLabel">'+
h(23817)+'</oj-label></div></dt><dd><div class="oj-flex-bar-middle"><oj-checkboxset id="enableActivityCancel" value="{{model.enableActivityCancel}}" labelled-by="enableActivityCancelLabel" data-bind="disable: readOnlyMode" data-ofsc-role="field-value" data-ofsc-field="enableActivityCancel"><oj-option value="true" aria-label="'+h(23817)+'"></oj-option></oj-checkboxset></div></dd><dt data-bind="visible: model.enableActivityCancel().length"><div class="oj-flex-bar-start"><oj-label class="oj-label-inline">'+
h(24273)+'</oj-label></div></dt><dd data-bind="visible: model.enableActivityCancel().length"></dd><dt data-bind="visible: model.enableActivityCancel().length"><div class="oj-flex-bar-start"><oj-label class="oj-label-inline"></oj-label></div></dt><dd data-bind="visible: model.enableActivityCancel().length, foreach: activityCancelTranslations">\x3c!-- ko if: visible --\x3e<div class="translation-row" data-bind="attr: { \'data-label\': translation.label }"><div class="translation-value-wrapper"><div class="translation-value translation-value--short" data-bind="css: { overridden: translation.isOverridden, focused: translation.isValueFocused }"><input class="oj-form-control oj-component-initnode"  data-bind="textInput: translation.value, readonly: $parent.readOnlyMode, attr: { placeholder: translation.defaultValue, \'aria-label\': translation.defaultValue, id: translation.id, \'data-ofsc-field\': translation.id}, event: { focus: translation.onValueFocus, blur: translation.onValueBlur }"  placeholder="{{translation.defaultValue}}" data-ofsc-role="field-value"><div class="translation-actions"><a class="translation-actions-button oj-fwk-icon help-icon oj-clickable-icon-nocontext" data-bind="click: translation.showInfo"></a></div><div data-bind="foreach: $root.getErrorListArray(translation.label)"><p data-bind="text: $data" class="oj-text-sm input-hint input-error active-error"></p></div></div></div></div>\x3c!-- /ko --\x3e</dd><dt><div class="oj-flex-bar-start"><oj-label class="oj-label-inline" id="isDigitalAssistantAvailableLabel" data-ofsc-role="field-label" data-ofsc-field="isDigitalAssistantAvailable">'+
h(23819)+'</oj-label></div></dt><dd><div class="oj-flex-bar-middle"><oj-checkboxset id="isDigitalAssistantAvailable" value="{{model.isDigitalAssistantAvailable}}" labelled-by="isDigitalAssistantAvailableLabel" data-bind="disable: readOnlyMode" data-ofsc-role="field-value" data-ofsc-field="isDigitalAssistantAvailable"><oj-option value="true" aria-label="'+h(23819)+'"></oj-option></oj-checkboxset></div><p class="oj-text-sm input-hint">'+h(23830)+'</p></dd><dt data-bind="visible: model.isDigitalAssistantAvailable().length && isOdaSdkApplicationIdWasFilled"><div class="oj-flex-bar-start"><oj-label class="oj-label-inline" for="applicationId" data-ofsc-role="field-label" data-ofsc-field="applicationId">'+
h(23801)+'</oj-label></div></dt><dd data-bind="visible: model.isDigitalAssistantAvailable().length && isOdaSdkApplicationIdWasFilled"><div class="oj-flex-bar-middle d-block"><oj-input-text value="{{model.applicationId}}" id="applicationId" data-bind="readonly: readOnlyMode" data-ofsc-role="field-value" data-ofsc-field="applicationId" aria-label="'+h(23801)+'"></oj-input-text><p class="oj-text-sm input-hint">'+h(23814)+'</p><div data-bind="foreach: getErrorListArray(\'applicationId\')"><p data-bind="text: $data" class="oj-text-sm input-hint input-error active-error"></p></div></div></dd><dt data-bind="visible: model.isDigitalAssistantAvailable().length"><div class="oj-flex-bar-start"><oj-label class="oj-label-inline" for="oracleChatServerURI" data-ofsc-role="field-label" data-ofsc-field="odaUri">'+
h(23803)+'</oj-label></div></dt><dd data-bind="visible: model.isDigitalAssistantAvailable().length"><div class="oj-flex-bar-middle d-block"><oj-input-text value="{{model.oracleChatServerURI}}" id="oracleChatServerURI" data-bind="readonly: readOnlyMode" data-ofsc-role="field-value" data-ofsc-field="odaUri" aria-label="'+h(23803)+'"></oj-input-text><p class="oj-text-sm input-hint">'+h(23816)+'</p><div data-bind="foreach: getErrorListArray(\'oracleChatServerURI\')"><p data-bind="text: $data" class="oj-text-sm input-hint input-error active-error"></p></div></div></dd><dt data-bind="visible: model.isDigitalAssistantAvailable().length"><div class="oj-flex-bar-start"><oj-label class="oj-label-inline" for="oracleChatChannelId" data-ofsc-role="field-label" data-ofsc-field="odaUri">'+
h(23802)+'</oj-label></div></dt><dd data-bind="visible: model.isDigitalAssistantAvailable().length"><div class="oj-flex-bar-middle d-block"><oj-input-text value="{{model.oracleChatChannelId}}" id="oracleChatChannelId" data-bind="readonly: readOnlyMode" data-ofsc-role="field-value" data-ofsc-field="odaUri" aria-label="'+h(23802)+'"></oj-input-text><p class="oj-text-sm input-hint">'+h(23815)+'</p><div data-bind="foreach: getErrorListArray(\'oracleChatChannelId\')"><p data-bind="text: $data" class="oj-text-sm input-hint input-error active-error"></p></div></div></dd></dl></div></div></div></div></div>',
events:{"input #mainColor":"changeMainColor","input #backgroundColor":"changeBackgroundColor","click #mainColor":"showMainColorPalette","click #backgroundColor":"showBackgroundColorPalette","change #chooseLogo":"setLogoImg","change #chooseBackgroundImage":"setBackgroundImage","change #chooseFavicon":"setFaviconImg","click #chooseLocationIcon":"resetFileInput","click #chooseTechnicianIcon":"resetFileInput","change #chooseTechnicianIcon":"setTechnicianIcon","change #chooseLocationIcon":"setLocationIcon",
"click #unassignedScreenWrapper":"showZoommedIframe","click #assignedScreenWrapper":"showZoommedIframe","click #onTheWayScreenWrapper":"showZoommedIframe","click #inProgressScreenWrapper":"showZoommedIframe","click #feedbackScreenWrapper":"showZoommedIframe","keyup #unassignedScreenWrapper":"showIframeByKeyboard","keyup #assignedScreenWrapper":"showIframeByKeyboard","keyup #onTheWayScreenWrapper":"showIframeByKeyboard","keyup #inProgressScreenWrapper":"showIframeByKeyboard","keyup #feedbackScreenWrapper":"showIframeByKeyboard",
"click #iframePopupBtnClose":"hideZoommedIframe","click #technicianIconSelect":"showTechnicianPopup","click #locationIconSelect":"showLocationPopup","click #customDestinationIconImg":"showCustomDestinationIconPopup","click #customResourceIconImg":"showCustomResourceIconPopup"},dispose:function(){window.removeEventListener("message",this.onPostMessageReceived);this._modelSubscription&&this.model&&this.model.removeListener(this._modelSubscription);this._modelSubscription=null;if(this._viewModelSubscriptions){for(var b=
0;b<this._viewModelSubscriptions.length;++b)this._viewModelSubscriptions[b]&&this._viewModelSubscriptions[b].dispose();this._viewModelSubscriptions=null}this._$el&&c.cleanNode(this._$el.find("#detailsContainer")[0]);this.viewModel=null;if(this._eventListenersList){for(b=0;b<this._eventListenersList.length;++b)this._eventListenersList[b]&&document.body.removeEventListener(this._eventListenersList[b].type,this[this._eventListenersList[b].func]);this._eventListenersList=null}},hide:function(){this.dispose();
e.prototype.hide.apply(this)},initEvents:function(){e.prototype.initEvents.apply(this);for(var d=[{color:new oj.Color("#DEDF54")},{color:new oj.Color("#E9EA92")},{color:new oj.Color("#ECF1CD")},{color:new oj.Color("#FAFFD9")},{color:new oj.Color("#FAFCE8")},{color:new oj.Color("#FBCE4A")},{color:new oj.Color("#FCDE8A")},{color:new oj.Color("#FCEDC8")},{color:new oj.Color("#FFFDD6")},{color:new oj.Color("#FCFBE8")},{color:new oj.Color("#ED813E")},{color:new oj.Color("#F3AC7A")},{color:new oj.Color("#F9DDC0")},
{color:new oj.Color("#FFF4D5")},{color:new oj.Color("#FCF7E8")},{color:new oj.Color("#E95B54")},{color:new oj.Color("#ED9286")},{color:new oj.Color("#F6CAB7")},{color:new oj.Color("#FFEFDB")},{color:new oj.Color("#FCF5EB")},{color:new oj.Color("#E85D88")},{color:new oj.Color("#EC96AD")},{color:new oj.Color("#F6CED2")},{color:new oj.Color("#FFEFF2")},{color:new oj.Color("#FCF5F6")},{color:new oj.Color("#CA589D")},{color:new oj.Color("#D992BC")},{color:new oj.Color("#EFCDDF")},{color:new oj.Color("#FFE7FB")},
{color:new oj.Color("#FCF2FB")},{color:new oj.Color("#854E9B")},{color:new oj.Color("#A984B8")},{color:new oj.Color("#D9C4DE")},{color:new oj.Color("#F4E3FF")},{color:new oj.Color("#F7F0FC")},{color:new oj.Color("#5A68AD")},{color:new oj.Color("#8B92C7")},{color:new oj.Color("#C5C3DF")},{color:new oj.Color("#E4E3FF")},{color:new oj.Color("#F0F0FC")},{color:new oj.Color("#309FDB")},{color:new oj.Color("#84BBE6")},{color:new oj.Color("#C5D9EE")},{color:new oj.Color("#DCF1FF")},{color:new oj.Color("#EBF5FC")},
{color:new oj.Color("#13B6CF")},{color:new oj.Color("#83CDDE")},{color:new oj.Color("#C6E8F5")},{color:new oj.Color("#D0F4FF")},{color:new oj.Color("#E6F7FC")},{color:new oj.Color("#2EBFBC")},{color:new oj.Color("#96D1CE")},{color:new oj.Color("#C6F4F5")},{color:new oj.Color("#D7FFFF")},{color:new oj.Color("#E8FCFC")},{color:new oj.Color("#3CAF85")},{color:new oj.Color("#89C7AD")},{color:new oj.Color("#C7E4DE")},{color:new oj.Color("#DEFFF8")},{color:new oj.Color("#EDFCF9")},{color:new oj.Color("#81BB5F")},
{color:new oj.Color("#AED292")},{color:new oj.Color("#D1E7CC")},{color:new oj.Color("#E6FFE0")},{color:new oj.Color("#F0FCED")}],g=[],n=0;n<b.availableThemes.length;++n){var p=b.availableThemes[n];g.push({value:p,label:b.themeManifests[p].title})}if(n=JSON.parse(b.initialThemesData[this.model.get("template_label")].content)){var s={},t=!1;for(p in n)n.hasOwnProperty(p)&&void 0===this.model.get(p)&&(s[p]=n[p],t=!0);t&&this.model.set(s)}n=c.observableArray([]);s=this.screenModel.get("resourceProperties");
for(p in s)n.push({value:p,label:s[p]});s=c.observableArray([]);t=this.screenModel.get("commentProperties");for(p in t)s.push({value:p,label:t[p]});var t=c.observableArray([]),u=this.screenModel.get("rateProperties");for(p in u)t.push({value:p,label:u[p]});var v=h(225679),w={},u=this.screenModel.get("locale"),x=u.all_langs_labels,y=u.company_langs,z=u.all_countries,A=u.ulanguage;for(p in x)w[x[p]]=p;var B=/^([a-z]{2})-(?:Han[ts]-)?([a-z]{2})$/i,D=[];Object.keys(this.ojetLangs).filter(function(b){return(b=
B.exec(b))?b[1]:!1}.bind(this)).forEach(function(b){var c=B.exec(b),d=c[1],c=c[2];"zh"==d&&(d=c.toLowerCase());d=y[w[d]];void 0!==d&&(c=z[c].translations[A],d=v.replace("$lang",d).replace("$country",c),D.push({value:b,label:d}))}.bind(this));this.viewModel={readOnlyMode:this.readOnlyMode,resourceProperties:n,technicianPositionOnMap:c.observable("hide"),serviceDetailsVisibility:c.observable("hide"),localesList:D,arrivalTimeRangeOptions:[{value:"hide",label:h(225680)},{value:"oneByOne",label:h(225681)},
{value:"timeNotified",label:h(225682)},{value:"deliveryWindow",label:h(225683)},{value:"serviceWindow",label:h(225684)},{value:"ETA",label:h(225685)}],customerAddressVisibilityOptions:[{value:"hide",label:h(225680)},{value:"customerAddress",label:h(225668)}],serviceDetailsVisibilityOptions:[{value:"hide",label:h(225680)},{value:"activityType",label:h(225686)}],customerPositionOnMapOptions:[{value:"hide",label:h(225680)},{value:"exactPosition",label:h(225687)},{value:"approximatePosition",label:h(225688)}],
technicianPositionOnMapOptions:c.pureComputed(function(){return"approximatePosition"==this.viewModel.model.customerPositionOnMap()?[{value:"hide",label:h(225680)},{value:"showWithoutTrack",label:h(225690)}]:[{value:"hide",label:h(225680)},{value:"showWithTrack",label:h(225689)},{value:"showWithoutTrack",label:h(225690)}]}.bind(this)),isLocationIconHidden:c.pureComputed(function(){return"exactPosition"!=this.viewModel.model.customerPositionOnMap()}.bind(this)),isTechnicianPositionOnMapHidden:c.pureComputed(function(){return"hide"==
this.viewModel.model.customerPositionOnMap()}.bind(this)),isTechnicianIconHidden:c.pureComputed(function(){return"hide"==this.viewModel.model.customerPositionOnMap()||"hide"==this.viewModel.technicianPositionOnMap()}.bind(this)),isTechnicianApproximateHidden:c.pureComputed(function(){return"hide"==this.viewModel.model.customerPositionOnMap()||"hide"==this.viewModel.technicianPositionOnMap()}.bind(this)),commentProperties:s,rateProperties:t,currentTemplate:c.observable(this.model.attributes.template_label||
b.availableThemes[0]),selectedTab:c.observable("branding"),colors:c.observable(d),paletteMainColor:c.observable(),paletteBackgroundColor:c.observable(),model:{},isOdaSdkApplicationIdWasFilled:!!this.model.attributes.applicationId,backgroundImageName:c.observable(),companyLogoName:c.observable(),companyFaviconName:c.observable(),translations:c.observableArray([]),selectedTranslation:c.observable(null),placeholders:b.translationsManifest.placeholders,templatesLabels:g,insertPlaceholder:function(b){var c=
this.viewModel.selectedTranslation();if(c){var d=c.value(),e=d.length,g=document.getElementById(c.id);g&&void 0!==g.selectionStart&&(e=g.selectionStart||0);c.value(d.substr(0,e)+b.label+d.substr(e))}}.bind(this),loadedTechnicianIcon:c.observable(""),setTechnicianIcon:function(b,c){"IMG"===c.target.tagName&&(""===c.target.id?this.model.resourceIcon(c.target.src):this.model.resourceIcon(c.target.id))},loadedDestinationIcon:c.observable(""),setDestinationIcon:function(b,c){"IMG"===c.target.tagName&&
(""===c.target.id?this.model.destinationIcon(c.target.src):this.model.destinationIcon(c.target.id))},defaultTechnicianIcons:{techIcon1:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNi4wLjQsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9Imljb24iIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB3aWR0aD0iNDhweCIgaGVpZ2h0PSI1OHB4IiB2aWV3Qm94PSIwIDAgNDggNTgiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDQ4IDU4IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnPg0KCTxnPg0KCQk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNNy4zOTksNDAuNjU3QzIuOTQ5LDM2LjIwOSwwLjUsMzAuMzA0LDAuNSwyNC4wMjRTMi45NDksMTEuODM2LDcuMzk2LDcuMzg4DQoJCQljNC40MzgtNC40NDUsMTAuMzM2LTYuODkzLDE2LjYwNi02Ljg5M2M2LjI3MSwwLDEyLjE3MywyLjQ0OCwxNi42MTcsNi44OTNjOS4xMjEsOS4xMzYsOS4xNDcsMjQuMDMsMC4wNTksMzMuMjAyTDI0LDU3LjI4Nw0KCQkJTDcuMzk5LDQwLjY1N3oiLz4NCgkJPHBhdGggZmlsbD0iIzMwOUZEQiIgZD0iTTI0LjAwMiwwLjk5NWM2LjEzOCwwLDExLjkxMywyLjM5NiwxNi4yNjMsNi43NDZjOC45MjgsOC45NDIsOC45NTQsMjMuNTIsMC4wNjEsMzIuNDk0TDI0LDU2LjU4DQoJCQlMNy43NzUsNDAuMzI3Yy0wLjAwOS0wLjAxLTAuMDE4LTAuMDE5LTAuMDI2LTAuMDI3QzMuMzk3LDM1Ljk1LDEsMzAuMTcsMSwyNC4wMjRTMy4zOTcsMTIuMDk1LDcuNzUsNy43NDENCgkJCUMxMi4wOTMsMy4zOTEsMTcuODY1LDAuOTk1LDI0LjAwMiwwLjk5NSBNMjQuMDAyLTAuMDA1Yy02LjEzOCwwLTEyLjI3MywyLjM0Ni0xNi45Niw3LjA0Yy05LjM4OSw5LjM5My05LjM4OSwyNC41ODksMCwzMy45NzMNCgkJCWwwLjAwMywwLjAwNEwyNCw1Ny45OTVsMTcuMDMzLTE3LjA1NGM5LjMwOS05LjM5NCw5LjI4OS0yNC41NDItMC4wNjEtMzMuOTA3QzM2LjI4MSwyLjM0MiwzMC4xNDEtMC4wMDUsMjQuMDAyLTAuMDA1DQoJCQlMMjQuMDAyLTAuMDA1eiIvPg0KCTwvZz4NCgk8Zz4NCgkJPGNpcmNsZSBmaWxsPSIjMzA5RkRCIiBjeD0iMzMuNDkyIiBjeT0iMzIuNzg4IiByPSIyLjY2MiIvPg0KCQk8Y2lyY2xlIGZpbGw9IiMzMDlGREIiIGN4PSIxNy4wNDMiIGN5PSIzMi43ODgiIHI9IjIuNjYyIi8+DQoJCTxwb2x5Z29uIGZpbGw9IiMzMDlGREIiIHBvaW50cz0iMzIuMzE2LDE4Ljc4NCAzNi4yMzgsMjQuNjY2IDM0LjgzOCwyNC42NjYgMzIuMjg1LDIwLjc0NSAyNy40MTYsMjAuNzQ1IDI3LjQxNiwyNC42NjYgDQoJCQkxMS43MzEsMjQuNjY2IDExLjczMSwxOC43ODQgCQkiLz4NCgkJPHBhdGggZmlsbD0iIzMwOUZEQiIgZD0iTTM2LjgwNywzMS4wNzRjLTAuNjE3LTEuMi0xLjg3MS0yLjAxOC0zLjMxNC0yLjAxOGMtMS45NjMsMC0zLjU1NSwxLjUyMy0zLjY5OSwzLjQ1MWgtOS4wNTINCgkJCWMtMC4xNDUtMS45Mi0xLjczNC0zLjM4My0zLjY5OC0zLjM4M2MtMS45MTksMC0zLjQ4MSwxLjUxMy0zLjY4NSwzLjM4M2gtMS42MjVsLTAuMDAzLTYuODYxaDI1LjQ4OHY1LjQ0NQ0KCQkJQzM3LjIxOSwzMS4wOTIsMzYuODAxLDMxLjA5OSwzNi44MDcsMzEuMDc0eiIvPg0KCTwvZz4NCjwvZz4NCjwvc3ZnPg0K",
techIcon2:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNi4wLjQsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9Imljb24iIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB3aWR0aD0iMzNweCIgaGVpZ2h0PSIzM3B4IiB2aWV3Qm94PSIwIDAgMzMgMzMiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDMzIDMzIiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnPg0KCTxjaXJjbGUgZmlsbD0iIzMwOUZEQiIgc3Ryb2tlPSIjRkZGRkZGIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGN4PSIxNi41MDEiIGN5PSIxNi41IiByPSIxNiIvPg0KCTxnPg0KCQk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMjMuNTAxLDIxLjEwMmMwLTAuMzMyLTAuMjcxLTAuNjAyLTAuNjAyLTAuNjAyaC0wLjc5OWMtMC4zMywwLTAuNiwwLjI3LTAuNiwwLjYwMlYyMy45DQoJCQljMCwwLjMzLDAuMjcsMC42LDAuNiwwLjZoMC43OTljMC4zMywwLDAuNjAyLTAuMjcsMC42MDItMC42VjIxLjEwMnoiLz4NCgk8L2c+DQoJPGc+DQoJCTxwYXRoIGZpbGw9IiNGRkZGRkYiIGQ9Ik0xMS41MDEsMjEuMTAyYzAtMC4zMzItMC4yNzEtMC42MDItMC42MDItMC42MDJoLTAuNzk3Yy0wLjMzMSwwLTAuNjAyLDAuMjctMC42MDIsMC42MDJWMjMuOQ0KCQkJYzAsMC4zMywwLjI3MSwwLjYsMC42MDIsMC42aDAuNzk5YzAuMzMsMCwwLjYwMS0wLjI3LDAuNjAxLTAuNkwxMS41MDEsMjEuMTAyTDExLjUwMSwyMS4xMDJ6Ii8+DQoJPC9nPg0KCTxnPg0KCQk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMjQuNDY2LDEzLjVjLTAuMDIxLTAuMjY0LTAuMDUzLTAuNTI3LTAuMDg2LTAuNzI3bC0wLjc1OC00LjU0OUMyMy41NTYsNy44MjYsMjMuMTcxLDcuNSwyMi43NjcsNy41DQoJCQlIMTAuMjM2Yy0wLjQwMiwwLTAuNzg4LDAuMzI2LTAuODU1LDAuNzI3bC0wLjc1OSw0LjU0OWMtMC4wMzIsMC4xOTktMC4wNjIsMC40NjEtMC4wODQsMC43MjVIMjQuNDY2TDI0LjQ2NiwxMy41eiIvPg0KCQk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNOC41MDEsMTQuNXY2LjI2NGMwLDAuNDA2LDAuMzMyLDAuNzM2LDAuNzM0LDAuNzM2aDE0LjUyOWMwLjQwNCwwLDAuNzM2LTAuMzMsMC43MzYtMC43MzZWMTQuNUg4LjUwMXoiLz4NCgk8L2c+DQoJPGNpcmNsZSBmaWxsPSIjMzA5RkRCIiBjeD0iMTAuNTAxIiBjeT0iMTguNSIgcj0iMSIvPg0KCTxjaXJjbGUgZmlsbD0iIzMwOUZEQiIgY3g9IjIyLjUwMSIgY3k9IjE4LjUiIHI9IjEiLz4NCgk8cmVjdCB4PSIxMy41MDEiIHk9IjE3LjUiIGZpbGw9IiMzMDlGREIiIHdpZHRoPSI2IiBoZWlnaHQ9IjIiLz4NCgk8cG9seWdvbiBmaWxsPSIjMzA5RkRCIiBwb2ludHM9IjIzLjUwMSwxMy44NjUgOS41MDEsMTMuODY1IDEwLjEyNSw5LjUgMjIuNzUxLDkuNSAJIi8+DQo8L2c+DQo8L3N2Zz4NCg==",
techIcon3:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNi4wLjQsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9Imljb24iIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB3aWR0aD0iNDhweCIgaGVpZ2h0PSI0OHB4IiB2aWV3Qm94PSIwIDAgNDggNDgiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDQ4IDQ4IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnPg0KCTxjaXJjbGUgb3BhY2l0eT0iMC40IiBmaWxsPSIjMzA5RkRCIiBjeD0iMjQiIGN5PSIyNCIgcj0iMjQiLz4NCgk8Y2lyY2xlIGZpbGw9IiMzMDlGREIiIGN4PSIyNCIgY3k9IjI0IiByPSIxNiIvPg0KCTxnPg0KCQk8Y2lyY2xlIGZpbGw9IiNGRkZGRkYiIGN4PSIzMC41MTYiIGN5PSIyNy40NjYiIHI9IjEuNzc0Ii8+DQoJCTxjaXJjbGUgZmlsbD0iI0ZGRkZGRiIgY3g9IjE5LjU0OSIgY3k9IjI3LjQ2NiIgcj0iMS43NzQiLz4NCgkJPHBvbHlnb24gZmlsbD0iI0ZGRkZGRiIgcG9pbnRzPSIyOS43MzIsMTguMTMxIDMyLjM0NiwyMi4wNTEgMzEuNDE0LDIyLjA1MSAyOS43MTIsMTkuNDM4IDI2LjQ2NSwxOS40MzggMjYuNDY1LDIyLjA1MSANCgkJCTE2LjAwOCwyMi4wNTEgMTYuMDA4LDE4LjEzMSAJCSIvPg0KCQk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMzIuNzI2LDI2LjMyNGMtMC40MTEtMC44MDEtMS4yNDctMS4zNDYtMi4yMS0xLjM0NmMtMS4zMDgsMC0yLjM3LDEuMDE2LTIuNDY3LDIuMzAxaC02LjAzMw0KCQkJYy0wLjA5OC0xLjI3OS0xLjE1Ny0yLjI1Ni0yLjQ2Ny0yLjI1NmMtMS4yNzksMC0yLjMyLDEuMDEtMi40NTUsMi4yNTZIMTYuMDFsLTAuMDAyLTQuNTc0SDMzdjMuNjI5DQoJCQlDMzMsMjYuMzM0LDMyLjcyMiwyNi4zNCwzMi43MjYsMjYuMzI0eiIvPg0KCTwvZz4NCjwvZz4NCjwvc3ZnPg0K",
techIcon4:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9ImRlbGl2ZXJ5X3RydWNrIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiDQoJIHk9IjBweCIgd2lkdGg9IjI3cHgiIGhlaWdodD0iNDhweCIgdmlld0JveD0iMCAwIDI3IDQ4IiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAyNyA0OCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+DQo8Zz4NCgk8cmVjdCB4PSI0LjY5MiIgeT0iMiIgZmlsbD0iI0VCRUJFQiIgd2lkdGg9IjE3LjU5OCIgaGVpZ2h0PSIxMS41Ii8+DQoJPHJlY3QgeD0iNi4wMDIiIHk9IjQ3IiBmaWxsPSIjNEQ0RDREIiB3aWR0aD0iMTUiIGhlaWdodD0iMSIvPg0KCTxyZWN0IHg9IjcuMDAyIiB5PSIxNCIgZmlsbD0iIzMzMzMzMyIgd2lkdGg9IjEzIiBoZWlnaHQ9IjEiLz4NCgk8cmVjdCB4PSIyLjAwMiIgeT0iNDcuMDAyIiBmaWxsPSIjRUQxQzI0IiB3aWR0aD0iMS45OTciIGhlaWdodD0iMC45OTYiLz4NCgk8cmVjdCB4PSIyMy4wMDIiIHk9IjQ3LjAwMiIgZmlsbD0iI0VEMUMyNCIgd2lkdGg9IjEuOTk3IiBoZWlnaHQ9IjAuOTk2Ii8+DQoJPHJlY3QgeD0iOS4wMDIiIGZpbGw9IiM0RDRENEQiIHdpZHRoPSI5IiBoZWlnaHQ9IjEiLz4NCgk8cGF0aCBmaWxsPSIjMzMzMzMzIiBkPSJNMjAuMDAyLDNjMC41NTEsMCwxLDAuNDQ5LDEsMXYzaC0xNVY0YzAtMC41NTEsMC40NS0xLDEtMUgyMC4wMDJ6Ii8+DQoJPHBhdGggZmlsbD0iIzgwODA4MCIgZD0iTTQuMDAyLDR2OWMwLDAuNTQ5LDAuNDUsMSwxLDFoMTdjMC41NTEsMCwxLTAuNDUxLDEtMVY0YzAtMS42NDgtMS4zNS0zLTMtM2gtMTMNCgkJQzUuMzUzLDEsNC4wMDIsMi4zNTIsNC4wMDIsNHogTTIwLjAwMiwyYzEuMTA0LDAsMiwwLjg5NiwyLDJ2OWgtMTdWNGMwLTEuMTA0LDAuODk3LTIsMi0ySDIwLjAwMnoiLz4NCgk8cmVjdCB4PSIyLjAwMiIgeT0iMTYiIGZpbGw9IiNGRkZGRkYiIHdpZHRoPSIyMyIgaGVpZ2h0PSIzMCIvPg0KCTxwYXRoIGZpbGw9IiM4MDgwODAiIGQ9Ik0yLjAwMiwxNmgyM3YzMGgtMjNWMTYgTTEuMDAyLDE2djMwYzAsMC41NTEsMC40NDgsMSwxLDFoMjNjMC41NTMsMCwxLTAuNDQ5LDEtMVYxNmMwLTAuNTUzLTAuNDQ3LTEtMS0xDQoJCWgtMjNDMS40NSwxNSwxLjAwMiwxNS40NDcsMS4wMDIsMTZMMS4wMDIsMTZ6Ii8+DQoJPHBvbHlnb24gZmlsbD0iIzMzMzMzMyIgcG9pbnRzPSIyMi4wMDIsNiAyNC4wMDIsNiAyNC4wMDIsNyAyNy4wMDIsNyAyNy4wMDIsNS42MTMgMjQuMDAyLDUgMjIuMDAyLDUgCSIvPg0KCTxwb2x5Z29uIGZpbGw9IiMzMzMzMzMiIHBvaW50cz0iNS4wMDIsNiAzLjAwMiw2IDMuMDAyLDcgMC4wMDIsNyAwLjAwMiw1LjYxMyAzLjAwMiw1IDUuMDAyLDUgCSIvPg0KCTxyZWN0IHg9IjIyLjAwMSIgeT0iMiIgZmlsbD0iI0VEMUMyNCIgd2lkdGg9IjEuMDAxIiBoZWlnaHQ9IjEiLz4NCgk8cmVjdCB4PSI0LjAwMiIgeT0iMiIgZmlsbD0iI0VEMUMyNCIgd2lkdGg9IjEuMDAxIiBoZWlnaHQ9IjEiLz4NCgk8cmVjdCB4PSI2LjAwMiIgZmlsbD0iIzMzMzMzMyIgd2lkdGg9IjIiIGhlaWdodD0iMSIvPg0KCTxyZWN0IHg9IjE5LjAwMiIgZmlsbD0iIzMzMzMzMyIgd2lkdGg9IjIiIGhlaWdodD0iMSIvPg0KPC9nPg0KPC9zdmc+DQo=",
techIcon5:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9InZhbiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHdpZHRoPSIyM3B4IiBoZWlnaHQ9IjQxcHgiIHZpZXdCb3g9IjAgMCAyMyA0MSIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMjMgNDEiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPHBhdGggZmlsbD0iI0ZBRkFGQSIgZD0iTTIwLjUxOSwzNy4xNzZjMCwxLjM3OS0xLjE3OCwyLjUtMi42MjUsMi41SDUuMTQ0Yy0xLjQ0NywwLTIuNjI1LTEuMTIxLTIuNjI1LTIuNVY1LjEwMg0KCWMwLTIuMTI5LDEuNTc1LTQuNDI2LDQuMTIxLTQuNDI2aDkuNjQ2YzIuMjkzLDAsNC4yMzEsMi4wMjUsNC4yMzEsNC40MjZMMjAuNTE5LDM3LjE3NkwyMC41MTksMzcuMTc2eiIvPg0KPHBhdGggZmlsbD0iIzgwODA4MCIgZD0iTTMuMDAyLDQuOTI2YzAtMiwxLjQ5Ni0zLjkyNiwzLjYyMS0zLjkyNmg5LjY0NmMyLjEyNSwwLDMuNzMxLDEuOTI2LDMuNzMxLDMuOTI2VjM3DQoJYzAsMS4xMDItMC45NTcsMi0yLjEyNSwySDUuMTI3Yy0xLjE2OCwwLTIuMTI1LTAuODk4LTIuMTI1LTJWNC45MjYgTTIuMDAyLDQuOTI2VjM3YzAsMS42NTQsMS40MDIsMywzLjEyNSwzaDEyLjc1DQoJYzEuNzIzLDAsMy4xMjUtMS4zNDYsMy4xMjUtM1Y0LjkyNkMyMS4wMDIsMi4yNTYsMTguODM1LDAsMTYuMjcsMEg2LjYyM0M0LjA3NSwwLDIuMDAyLDIuMjEsMi4wMDIsNC45MjZMMi4wMDIsNC45MjZ6Ii8+DQo8cG9seWdvbiBmaWxsPSIjMzMzMzMzIiBwb2ludHM9IjIzLjAwMiw4IDIzLjAwMiw5IDIwLjAwMiw5IDIwLjAwMiw3ICIvPg0KPHBvbHlnb24gZmlsbD0iIzMzMzMzMyIgcG9pbnRzPSIzLjAwMiw3IDMuMDAyLDkgMC4wMDIsOSAwLjAwMiw4ICIvPg0KPHBhdGggZmlsbD0iIzMzMzMzMyIgZD0iTTQuMDAyLDl2NmgxNVY5YzAtMS0xLTItMi0yaC0xMUM1LjAwMiw3LDQuMDAyLDgsNC4wMDIsOXoiLz4NCjxnPg0KCTxwYXRoIGZpbGw9IiMzMzMzMzMiIGQ9Ik0xOS41MTYsM2gtMi41MTRsLTEtMmgxQzE4LjEyNSwxLDE5LjA5NiwxLjg5MSwxOS41MTYsM3oiLz4NCjwvZz4NCjxnPg0KCTxwYXRoIGZpbGw9IiMzMzMzMzMiIGQ9Ik02LjAwMiwxaDFsLTEsMkgzLjQ4OEMzLjkwOCwxLjg5MSw0Ljg3OSwxLDYuMDAyLDF6Ii8+DQo8L2c+DQo8cmVjdCB4PSI3LjAwMiIgeT0iMCIgZmlsbD0iIzMzMzMzMyIgd2lkdGg9IjkiIGhlaWdodD0iMSIvPg0KPHJlY3QgeD0iNi4wMDIiIHk9IjQwIiBmaWxsPSIjNEQ0RDREIiB3aWR0aD0iMTEiIGhlaWdodD0iMSIvPg0KPHJlY3QgeD0iNi4wMDIiIHk9IjE3IiBmaWxsPSIjQ0NDQ0NDIiB3aWR0aD0iMSIgaGVpZ2h0PSIxOCIvPg0KPHJlY3QgeD0iOS4wMDIiIHk9IjE3IiBmaWxsPSIjQ0NDQ0NDIiB3aWR0aD0iMSIgaGVpZ2h0PSIxOCIvPg0KPHJlY3QgeD0iMTMuMDAyIiB5PSIxNyIgZmlsbD0iI0NDQ0NDQyIgd2lkdGg9IjEiIGhlaWdodD0iMTgiLz4NCjxyZWN0IHg9IjE2LjAwMiIgeT0iMTciIGZpbGw9IiNDQ0NDQ0MiIHdpZHRoPSIxIiBoZWlnaHQ9IjE4Ii8+DQo8cmVjdCB4PSIzLjAwNSIgeT0iMy4wMDMiIGZpbGw9IiNFRDFDMjQiIHdpZHRoPSIwLjk5NyIgaGVpZ2h0PSIwLjk5NyIvPg0KPHJlY3QgeD0iMTkuMDE3IiB5PSIzIiBmaWxsPSIjRUQxQzI0IiB3aWR0aD0iMC45OTciIGhlaWdodD0iMC45OTciLz4NCjxyZWN0IHg9IjE4LjAwNSIgeT0iMzkuMDA0IiBmaWxsPSIjRUQxQzI0IiB3aWR0aD0iMC45OTciIGhlaWdodD0iMS45OTYiLz4NCjxyZWN0IHg9IjQuMDAyIiB5PSIzOS4wMDQiIGZpbGw9IiNFRDFDMjQiIHdpZHRoPSIwLjk5NyIgaGVpZ2h0PSIxLjk5NiIvPg0KPHBvbHlnb24gZmlsbD0iIzgwODA4MCIgcG9pbnRzPSIxNS4wMDIsNiAxNi4wMDIsNyA3LjAwMiw3IDguMDAyLDYgIi8+DQo8L3N2Zz4NCg==",
techIcon6:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9ImNhciIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHdpZHRoPSIxN3B4IiBoZWlnaHQ9IjM3cHgiIHZpZXdCb3g9IjAgMCAxNyAzNyIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTcgMzciIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTAuMDAxLDE1YzAsMi45MDIsMCw5LjY0OSwwLDEyYzAsMi4zNTIsMS4wMDEsNywxLjAwMSw3YzAuMjg3LDEsMS40MTQsMiwyLjU4MiwyaDEwDQoJYzEuMTY4LDAsMi4xMzEtMSwyLjQxOC0yYzAsMCwxLTQuMjg5LDEtN3MwLTkuNzkxLDAtMTJjMC0yLjg1Mi0xLTEwLTEtMTBjLTAuNzE3LTIuMzMxLTIuNjY5LTQtNC00aC03Yy0xLjQ3NiwwLTMuNjIsMi00LDQNCglDMS4wMDIsNSwwLjAwMSwxMi4wOTgsMC4wMDEsMTVMMC4wMDEsMTV6Ii8+DQo8cGF0aCBmaWxsPSIjODA4MDgwIiBkPSJNMS4wMDIsMTVjMC0yLjc5OSwwLjc5LTguNjU3LDEuMDE5LTEwLjAwMVMzLjQ4OCwyLDUuMDAyLDJoN2MxLjUxOCwwLDIuNzk4LDEuNzE4LDMuMDEsMi45OTkNCgljMC4yMjUsMS4zNTcsMC45OSw3LjI1MSwwLjk5LDEwVjI3YzAsMi41NjEtMC45NjMsNi43MjEtMC45NjMsNi43MjZsMCwwQzE0Ljg2NSwzNC4zMzgsMTQuMjU4LDM1LDEzLjU4NCwzNWgtMTANCgljLTAuNjk1LDAtMS40MjktMC42NjQtMS42MTItMS4yNDhDMS44NzcsMzMuMzExLDEuMDAyLDI5LjExLDEuMDAyLDI3VjE1IE0wLjAwMSwxNWMwLDIuOTAyLDAsOS42NDksMCwxMmMwLDIuMzUyLDEuMDAxLDcsMS4wMDEsNw0KCWMwLjI4NywxLDEuNDE0LDIsMi41ODIsMmgxMGMxLjE2OCwwLDIuMTMxLTEsMi40MTgtMmMwLDAsMS00LjI4OSwxLTdzMC05Ljc5MSwwLTEyYzAtMi44NTItMS0xMC0xLTEwYy0wLjcxNy0yLjMzMS0yLjY2OS00LTQtNGgtNw0KCWMtMS40NzYsMC0zLjYyLDItNCw0QzEuMDAyLDUsMC4wMDEsMTIuMDk4LDAuMDAxLDE1TDAuMDAxLDE1eiIvPg0KPGc+DQoJPHBhdGggZmlsbD0iIzMzMzMzMyIgZD0iTTExLjAwMiw4YzEuMDQyLDAsMy4zOTYsMS4xODksMy41MDIsMi40N2MwLDAsMC41MTksNC41OTksMC41MTksNi40NzNjMCwxLjQ1MywwLjAxOSw1LjI4LDAsNy4wNjINCgkJYy0wLjAyMSwxLjk5NS0xLDQuOTc5LTEsNC45NzlDMTMuNjkxLDI5LjgwOSwxMi45MTUsMzEsMTIuMDAyLDMxaC03Yy0wLjkxMSwwLTEuNzQyLTEuMzA3LTEuOTU4LTEuOTU0DQoJCWMwLDAtMS4wNDItMy4wNDYtMS4wNDItNS4wNDZjMC0xLjU0MywwLTUuMDUsMC02Ljk1OGMwLTEuOTA3LDAuNzkxLTYuNTcyLDAuNzkxLTYuNTcyQzMuMTY5LDguOTgyLDUuMDQ0LDgsNi4wMDIsOEgxMS4wMDJ6Ii8+DQo8L2c+DQo8cmVjdCB4PSIyLjAwMiIgeT0iMzUiIGZpbGw9IiNFRDFDMjQiIHdpZHRoPSIyIiBoZWlnaHQ9IjEiLz4NCjxyZWN0IHg9IjEzLjAwMiIgeT0iMzUiIGZpbGw9IiNFRDFDMjQiIHdpZHRoPSIyIiBoZWlnaHQ9IjEiLz4NCjxwb2x5Z29uIGZpbGw9IiM0RDRENEQiIHBvaW50cz0iNS4wMDIsMSA2LjAwMiwwIDExLjAwMiwwIDEyLjAwMiwxICIvPg0KPHJlY3QgeD0iNS4wMDMiIHk9IjEuMDAxIiBmaWxsPSIjQ0NDQ0NDIiB3aWR0aD0iNyIgaGVpZ2h0PSIyIi8+DQo8cmVjdCB4PSIzLjAwMiIgeT0iMzYiIGZpbGw9IiM0RDRENEQiIHdpZHRoPSIxMSIgaGVpZ2h0PSIxIi8+DQo8Zz4NCgk8cGF0aCBmaWxsPSIjMzMzMzMzIiBkPSJNMS4wMjYsNC45OTlsNC0ybDEtMS45OTlINC44M0MzLjY4NCwwLjk5OSwxLjM4MSwyLjg1NSwxLjAyNiw0Ljk5OXoiLz4NCjwvZz4NCjxnPg0KCTxwYXRoIGZpbGw9IiMzMzMzMzMiIGQ9Ik0xMi4xNDMsMWgtMS4xNDFsMSwxLjk5OWw0LDJDMTUuNTAzLDIuOTk5LDEzLjI4OSwwLjk5OSwxMi4xNDMsMXoiLz4NCjwvZz4NCjxwYXRoIGZpbGw9IiNGRkZGRkYiIGQ9Ik0xNS4yODUsOC40MzlMMTQuNDgsNy44NDJjLTEuMDE0LDEuMzYzLTEuNzk3LDMuNDI2LTIuMjg5LDUuODM0Yy0xLjE2OC0wLjE4OC0yLjM5OC0wLjI5My0zLjY4LTAuMjkzDQoJYy0wLjAwMywwLTAuMDA3LDAtMC4wMSwwcy0wLjAwNywwLTAuMDEsMGMtMS4yODEsMC0yLjUxMiwwLjEwNS0zLjY4LDAuMjkzQzQuMzIsMTEuMjY4LDMuNTM3LDkuMjA1LDIuNTIzLDcuODQyTDEuNzE5LDguNDM5DQoJYzEuNjQ1LDIuMjA5LDIuNjY2LDYuNDM1LDIuNjY2LDExLjAyOGMwLDQuNDg3LTAuOTg2LDguNjY1LTIuNTc0LDEwLjkwM2wwLjgxNiwwLjU3OGMwLjc1NC0xLjA2NSwxLjM2Ny0yLjQ5OCwxLjgyOC00LjE1Ng0KCWMxLjI3MSwwLjIyNSwyLjYyMywwLjM1NSw0LjAzNywwLjM1NWMwLjAwMywwLDAuMDA3LDAsMC4wMSwwczAuMDA3LDAsMC4wMSwwYzEuNDE0LDAsMi43NjYtMC4xMzEsNC4wMzctMC4zNTUNCgljMC40NjEsMS42NTgsMS4wNzQsMy4wOTEsMS44MjgsNC4xNTZsMC44MTYtMC41NzhjLTEuNTg4LTIuMjM4LTIuNTc0LTYuNDE2LTIuNTc0LTEwLjkwM0MxMi42MTksMTQuODc0LDEzLjY0MSwxMC42NDgsMTUuMjg1LDguNDM5DQoJeiIvPg0KPC9zdmc+DQo="},
defaultLocationIcons:{locIcon1:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNi4wLjQsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9Imljb24iIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB3aWR0aD0iMzJweCIgaGVpZ2h0PSIzOXB4IiB2aWV3Qm94PSIwLjUgNDguNSAzMiAzOSIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwLjUgNDguNSAzMiAzOSIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+DQo8Zz4NCgk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMjcuODU1LDc2LjAzMWM2LjIwNS02LjMxMyw2LjE5Mi0xNi41LTAuMDQxLTIyLjc5N2MtNi4yNTYtNi4zMTItMTYuMzcyLTYuMzE0LTIyLjYyMSwwDQoJCWMtNi4yNTksNi4zMTUtNi4yNTksMTYuNTMzLDAsMjIuODQzbDAuMDAyLDAuMDAzbDAsMEwxNi41LDg3LjVMMjcuODU1LDc2LjAzMUwyNy44NTUsNzYuMDMxeiIvPg0KCTxwYXRoIGZpbGw9IiMzMDlGREIiIGQ9Ik0xNi41LDQ5LjVjNC4wMDEsMCw3Ljc2OCwxLjU3NiwxMC42MDQsNC40MzhjNS44MjgsNS44ODgsNS44NDYsMTUuNDg0LDAuMDQxLDIxLjM5MUwxNi41LDg2LjA3OA0KCQlMNS45MzEsNzUuNGMtMC4wMDktMC4wMS0wLjAxOC0wLjAyLTAuMDI2LTAuMDI3Yy01Ljg1OS01LjkwNi01Ljg1OS0xNS41MjEsMC4wMDEtMjEuNDM2QzguNzM3LDUxLjA3NiwxMi41LDQ5LjUsMTYuNSw0OS41DQoJCSBNMTYuNSw0OC41Yy00LjA5MiwwLTguMTgyLDEuNTc4LTExLjMwNiw0LjczNGMtNi4yNTksNi4zMTUtNi4yNTksMTYuNTMzLDAsMjIuODQzbDAuMDAyLDAuMDAzTDE2LjUsODcuNWwxMS4zNTUtMTEuNDY5DQoJCWM2LjIwNS02LjMxMyw2LjE5Mi0xNi41LTAuMDQxLTIyLjc5N0MyNC42ODgsNTAuMDc5LDIwLjU5Myw0OC41LDE2LjUsNDguNUwxNi41LDQ4LjV6Ii8+DQo8L2c+DQo8cG9seWdvbiBmaWxsPSIjMzA5RkRCIiBwb2ludHM9IjI0LjUsNzEuNSAxOC41LDcxLjUgMTguNSw2Ni41IDE0LjUsNjYuNSAxNC41LDcxLjUgOC41LDcxLjUgOC41LDYzLjUgMTYuNSw1OC41IDI0LjUsNjMuNSAiLz4NCjwvc3ZnPg0K",
locIcon2:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNi4wLjQsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9Imljb24iIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB3aWR0aD0iMzJweCIgaGVpZ2h0PSIzMnB4IiB2aWV3Qm94PSI4IDggMzIgMzIiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgOCA4IDMyIDMyIiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnPg0KCTxjaXJjbGUgZmlsbD0iIzMwOUZEQiIgY3g9IjI0IiBjeT0iMjQiIHI9IjE2Ii8+DQoJPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTI0LDljOC4yNzEsMCwxNSw2LjcyOSwxNSwxNWMwLDguMjcxLTYuNzI5LDE1LTE1LDE1Yy04LjI3MSwwLTE1LTYuNzI5LTE1LTE1QzksMTUuNzI5LDE1LjcyOSw5LDI0LDkNCgkJIE0yNCw4QzE1LjE2Myw4LDgsMTUuMTYzLDgsMjRzNy4xNjMsMTYsMTYsMTZzMTYtNy4xNjMsMTYtMTZTMzIuODM3LDgsMjQsOEwyNCw4eiIvPg0KPC9nPg0KPGc+DQoJPHBvbHlnb24gZmlsbD0iI0ZGRkZGRiIgcG9pbnRzPSIzMiwzMyAyNiwzMyAyNiwyNiAyMiwyNiAyMiwzMyAxNiwzMyAxNiwyMyAyNCwxNyAzMS45OTksMjMgCSIvPg0KCTxwb2x5Z29uIGZpbGw9IiNGRkZGRkYiIHBvaW50cz0iMTMuOTM5LDIzIDI0LjAwMSwxNS4yNjIgMzQuMDYxLDIzIDM2Ljk5OSwyMyAyNCwxMyAxMSwyMyAJIi8+DQo8L2c+DQo8L3N2Zz4NCg==",
locIcon3:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNi4wLjQsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9Imljb24iIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB3aWR0aD0iNDhweCIgaGVpZ2h0PSI0OHB4IiB2aWV3Qm94PSIwIDAgNDggNDgiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDQ4IDQ4IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxjaXJjbGUgb3BhY2l0eT0iMC40IiBmaWxsPSIjMzA5RkRCIiBjeD0iMjQiIGN5PSIyNCIgcj0iMjQiLz4NCjxjaXJjbGUgZmlsbD0iIzMwOUZEQiIgY3g9IjI0IiBjeT0iMjQiIHI9IjE2Ii8+DQo8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMjQsMThsLTgsM2wwLDhoMTF2LTVoM3Y1aDJ2LThMMjQsMTh6IE0yNCwyN2gtNnYtM2g2VjI3eiIvPg0KPC9zdmc+DQo="},
setTechnicianIconAnchor:function(b,c){this.model.resourceIconAnchor(c.currentTarget.classList[1])},setDestinationIconAnchor:function(b,c){this.model.destinationIconAnchor(c.currentTarget.classList[1])},selectedResourceIcon:c.pureComputed(function(){var b=this.viewModel.model.resourceIcon();return'url("'+(10<b.length?b:this.viewModel.defaultTechnicianIcons[b]).replace(/"/g,'\\"')+'")'}.bind(this)),selectedDestinationIcon:c.pureComputed(function(){var b=this.viewModel.model.destinationIcon();return'url("'+
(10<b.length?b:this.viewModel.defaultLocationIcons[b]).replace(/"/g,'\\"')+'")'}.bind(this)),errorListsDictionary:{},getErrorList:function(b){this.viewModel.errorListsDictionary[b]||(this.viewModel.errorListsDictionary[b]=c.observableArray([]));return this.viewModel.errorListsDictionary[b]}.bind(this),addError:function(b,c){var d=this.viewModel.getErrorList(b);-1===d.indexOf(c)&&d.push(c)}.bind(this),getErrorListArray:function(b){return this.viewModel.getErrorList(b)()}.bind(this),clearErrorList:function(b){this.viewModel.getErrorList(b)([])}.bind(this)};
this._viewModelSubscriptions=[];Object.keys(this.model.attributes).forEach(function(b){this.viewModel.model[b]=c.observable(!0===this.model.get(b)||"true"===this.model.get(b)?["true"]:!1===this.model.get(b)||"false"===this.model.get(b)?[]:this.model.get(b));this._viewModelSubscriptions.push(this.viewModel.model[b].subscribe(function(c){var d={};c=Array.isArray(c)?0!==c.length:c;d[b]=c;this.model.get(b)!==c&&(this.model.set(d),d={name:"set",data:{theme:{content:{}}}},d.data.theme.template_label=this.model.get("template_label"),
d.data.theme.content[b]=c,this.updateIframes(d),this.viewModel.clearErrorList(b))}.bind(this)))}.bind(this));this._modelSubscription=this.model.addListener("change",function(b,d){for(var e in d)if(d.hasOwnProperty(e)&&this.viewModel.model[e]&&c.isObservable(this.viewModel.model[e]))if(!0===d[e]||"true"===d[e]){if(0===this.viewModel.model[e]().length)this.viewModel.model[e](["true"])}else if(!1===d[e]||"false"===d[e]){if(0!==this.viewModel.model[e]().length)this.viewModel.model[e]([])}else if(this.viewModel.model[e]()!==
d[e])this.viewModel.model[e](d[e])}.bind(this));0<this.viewModel.model.showPositionOnMap().length&&0<this.viewModel.model.showTechnicianRoute().length&&this.viewModel.technicianPositionOnMap("showWithTrack");0<this.viewModel.model.showPositionOnMap().length&&0==this.viewModel.model.showTechnicianRoute().length&&this.viewModel.technicianPositionOnMap("showWithoutTrack");0<this.viewModel.model.showActivityType().length&&this.viewModel.serviceDetailsVisibility("activityType");0==this.viewModel.model.showActivityType().length&&
this.viewModel.serviceDetailsVisibility("hide");this._viewModelSubscriptions.push(this.viewModel.technicianPositionOnMap.subscribe(function(b){switch(b){case "hide":this.viewModel.model.showTechnicianRoute([]);this.viewModel.model.showPositionOnMap([]);break;case "showWithTrack":this.viewModel.model.showTechnicianRoute(["true"]);this.viewModel.model.showPositionOnMap(["true"]);break;case "showWithoutTrack":this.viewModel.model.showTechnicianRoute([]),this.viewModel.model.showPositionOnMap(["true"])}}.bind(this)));
this._viewModelSubscriptions.push(this.viewModel.model.customerPositionOnMap.subscribe(function(b){switch(b){case "hide":this.viewModel.technicianPositionOnMap("hide");break;case "exactPosition":this.viewModel.technicianPositionOnMap("showWithoutTrack");break;case "approximatePosition":this.viewModel.technicianPositionOnMap("showWithoutTrack")}}.bind(this)));this._viewModelSubscriptions.push(this.viewModel.serviceDetailsVisibility.subscribe(function(b){switch(b){case "hide":this.viewModel.model.showActivityType([]);
break;case "activityType":this.viewModel.model.showActivityType(["true"])}}.bind(this)));10<this.viewModel.model.resourceIcon().length&&this.viewModel.loadedTechnicianIcon(this.viewModel.model.resourceIcon());10<this.viewModel.model.destinationIcon().length&&this.viewModel.loadedDestinationIcon(this.viewModel.model.destinationIcon());this.viewModel.model.mainColor.subscribe(function(b){b._r||(this.viewModel.paletteMainColor(new oj.Color(b)),document.querySelector("#mainColorHint").style.backgroundColor=
b)}.bind(this));this.viewModel.model.template_label.subscribe(function(b){this.setNewTemplate(b)}.bind(this));this.viewModel.paletteMainColor.subscribe(function(b){b._r&&(b=this.rgbToHex(b._r,b._g,b._b),this.viewModel.model.mainColor(b),document.querySelector("#mainColorHint").style.backgroundColor=b)}.bind(this));this.viewModel.model.backgroundColor.subscribe(function(b){b._r||(this.viewModel.paletteBackgroundColor(new oj.Color(b)),document.querySelector("#backgroundColorHint").style.backgroundColor=
b)}.bind(this));this.viewModel.paletteBackgroundColor.subscribe(function(b){b._r&&(b=this.rgbToHex(b._r,b._g,b._b),this.viewModel.model.backgroundColor(b),document.querySelector("#backgroundColorHint").style.backgroundColor=b)}.bind(this));document.querySelector("#mainColorHint").style.backgroundColor=this.viewModel.model.mainColor();document.querySelector("#backgroundColorHint").style.backgroundColor=this.viewModel.model.backgroundColor();this.assignedIframe=document.getElementById("assignedScreen");
this.onTheWayIframe=document.getElementById("onTheWayScreen");this.inProgressIframe=document.getElementById("inProgressScreen");this.unassigendIframe=document.getElementById("unassignedScreen");this.feedbackIframe=document.getElementById("feedbackScreen");this.zoomedIframe=document.getElementById("zoommedIframeScreen");window.addEventListener("message",this.onPostMessageReceived.bind(this),!1);d=this.screenModel.get("previewUrl");this.assignedIframe.src=d;this.onTheWayIframe.src=d;this.inProgressIframe.src=
d;this.unassigendIframe.src=d;this.feedbackIframe.src=d;this.zoomedIframe.src=d;var d=this.model.get("translations"),g=b.translationsManifest.translations,C={},F=this.langCode(b.defaultLanguageISO);this.themeLangCode=c.pureComputed(function(){var c=(this.viewModel.model.lang()||b.defaultLanguageISO).split("-").shift();return b.supportedLanguages.includes(c)?c:F},this);this._viewModelSubscriptions.push(this.viewModel.model.lang.subscribe(function(){var c=this.themeLangCode();Object.keys(C).forEach(function(d){C[d].defaultValue(b.defaultTranslations[d][c])}.bind(this))}.bind(this)));
p=this.themeLangCode();for(n=0;n<g.length;++n)s=g[n],void 0!=b.defaultTranslations[s.label]&&(t=d[s.label]||"",t={id:"wmt-i18n-value-"+s.label,isValueFocused:c.observable(!1),label:s.label,defaultValue:c.observable(b.defaultTranslations[s.label][p]),placeholders:c.pureComputed(function(c){return c.placeholders.map(function(c){return{label:c,description:b.translationsManifest.placeholders[c]}}.bind(this))}.bind(this,s)),value:c.observable(t),description:c.pureComputed(function(b){return b.description}.bind(this,
s))},t.isOverridden=c.pureComputed(function(b){return b.value()!==b.defaultValue()}.bind(this,t)),t.resetValue=function(b,c){this.value(this.defaultValue());c.stopPropagation();c.preventDefault();var d=document.getElementById(this.id);d&&d.focus()}.bind(t),t.showInfo=function(b,c){this.viewModel.selectedTranslation(b.translation);document.getElementById("wmt-translation-description-popup").open("#"+b.translation.id)}.bind(this),t.onValueBlur=function(){this.isValueFocused(!1)}.bind(t),t.onValueFocus=
function(){this.isValueFocused(!0)}.bind(t),t.value.subscribe(function(b,c,d){var e=this.model.get("translations");d===c()?delete e[b]:e[b]=d;this.model.set({translations:e});e={};e[b]=d===c()?null:d;this.viewModel.clearErrorList(b);this.updateIframes({name:"set",data:{theme:{content:{translations:e}}}})}.bind(this,s.label,t.defaultValue)),C[s.label]=t);this.viewModel.localizationTranslations=c.pureComputed(function(){return this.getTranslationsList("localizationTranslations",C)}.bind(this));this.viewModel.feedbackTranslations=
c.pureComputed(function(){return this.getTranslationsList("feedbackTranslations",C)}.bind(this));this.viewModel.activityCancelTranslations=c.pureComputed(function(){return this.getTranslationsList("activityCancelTranslations",C)}.bind(this));"null"===this.model.get("description")&&this.model.set({description:""});c.applyBindings(this.viewModel,this._$el.find("#detailsContainer")[0]);this._eventListenersList=[]},getTranslationsList:function(d,e){var g=this.viewModel.currentTemplate();return b.themeManifests[g][d].map(function(b){return{translation:e[b.label],
visible:b.visible?c.pureComputed(function(){return eval(b.visible)}.bind(this.viewModel.model)):!0}}.bind(this))},langCode:function(b){return b.split("-").shift()},validators:[{selector:".require",rules:["mandatory"]}],validateTranslation:function(b){if(b.translation.label===subkey&&0<b.translation.placeholders().length){var c=this.model.attributes[key][subkey].match(/\{.*?\}/g);if(c)for(var d=0,e=c.length;d<e;d++){var g=!0;b.translation.placeholders().forEach(function(b){c[d]===b.label&&(g=!1)}.bind(this));
if(g){this.viewModel.addError(subkey,h(24060));break}}}},validate:function(){var b=["destinationIcon","favicon","logo","resourceIcon","backgroundImage"];for(key in this.model.attributes)if(-1!==b.indexOf(key))"destinationIcon"!==key&&"resourceIcon"!==key||this.isFileFormatCorrect(this.model.attributes[key],["svg","png","jpeg","gif"],g)&&30720>this.calculateBase64ImageSize(this.model.attributes[key].length)||this.viewModel.addError(key,h(24056)),"favicon"===key&&(!this.isFileFormatCorrect(this.model.attributes[key],
["gif","png","icon"])||30720<this.calculateBase64ImageSize(this.model.attributes[key].length))&&this.viewModel.addError(key,h(24054)),"logo"===key&&102400<this.calculateBase64ImageSize(this.model.attributes[key].length)&&this.viewModel.addError(key,h(24052)),"backgroundImage"===key&&256E3<this.calculateBase64ImageSize(this.model.attributes[key].length)&&this.viewModel.addError(key,h(24058));else if("translations"===key)for(subkey in this.model.attributes[key])256<this.model.attributes[key][subkey].length&&
this.viewModel.addError(subkey,h(24260)),this.viewModel.localizationTranslations().forEach(this.validateTranslation.bind(this)),this.viewModel.feedbackTranslations().forEach(this.validateTranslation.bind(this)),this.viewModel.activityCancelTranslations().forEach(this.validateTranslation.bind(this));else null!==this.model.attributes[key]&&256<this.model.attributes[key].length&&this.viewModel.addError(key,h(24260)),"mainColor"!==key&&"backgroundColor"!==key||this.model.attributes[key].match(/^#([0-9a-f]{3}|[0-9a-f]{6})$\b/gi)||
this.viewModel.addError(key,h(24061)),"technicianDelay"===key&&(!this.model.attributes[key].match(/^0{1}$|^[1-9]{1}[0-9]*$/gi)||30<parseInt(this.model.attributes[key]))&&this.viewModel.addError(key,h(225694)),"customDomainName"===key&&0<this.model.attributes[key].length&&!this.model.attributes[key].match(/^(https?:\/\/).+\..+/gi)&&this.viewModel.addError(key,h(225695));b=document.getElementsByClassName("active-error");if(0<b.length)switch(b[0].closest(".panel").id){case "branding-panel":this.viewModel.selectedTab("branding");
break;case "technician-panel":this.viewModel.selectedTab("technician");break;case "localization-panel":this.viewModel.selectedTab("localization");break;case "feedback-panel":this.viewModel.selectedTab("feedback");break;case "communications-panel":this.viewModel.selectedTab("communications");break;case "map-panel":this.viewModel.selectedTab("map")}return 0===b.length},onPostMessageReceived:function(b){if("ready"===b.data.name){var c=JSON.parse(JSON.stringify(this.postMessageData));c.data.theme.template_label=
this.model.get("template_label");c.data.theme.content=this.model.attributes;switch(b.source){case this.assignedIframe.contentWindow:c.data.status="assigned";this.assignedIframe.contentWindow.postMessage(c,"*");break;case this.onTheWayIframe.contentWindow:c.data.status="onTheWay";this.onTheWayIframe.contentWindow.postMessage(c,"*");break;case this.inProgressIframe.contentWindow:c.data.status="started";this.inProgressIframe.contentWindow.postMessage(c,"*");break;case this.unassigendIframe.contentWindow:c.data.status=
"notAssigned";c.data.resourceDetails=null;this.unassigendIframe.contentWindow.postMessage(c,"*");break;case this.feedbackIframe.contentWindow:c.data.status="completed";this.feedbackIframe.contentWindow.postMessage(c,"*");break;case this.zoomedIframe.contentWindow:c.data.status=this.zoomIframeStatus,this.zoomedIframe.contentWindow.postMessage(c,"*")}}},updateIframes:function(b){document.getElementById("unassignedScreen").contentWindow.postMessage(b,"*");document.getElementById("assignedScreen").contentWindow.postMessage(b,
"*");document.getElementById("onTheWayScreen").contentWindow.postMessage(b,"*");document.getElementById("inProgressScreen").contentWindow.postMessage(b,"*");document.getElementById("feedbackScreen").contentWindow.postMessage(b,"*");document.getElementById("zoommedIframeScreen").contentWindow.postMessage(b,"*")},setNewTemplate:function(b){this.viewModel.currentTemplate(b);if(this.templatesData[b]){var d=JSON.parse(this.templatesData[b].content),e;for(e in d)d.hasOwnProperty(e)&&!this.viewModel.model[e]&&
(this.viewModel.model[e]=c.observable(d[e]));this.updateIframes({name:"set",data:{theme:{template_label:b}}})}},calculateBase64ImageSize:function(b){return b/4*3},readImg:function(b,d){if(b.files&&b.files[0]){var e=new FileReader;e.onload=function(b){this.viewModel.model[d]||(this.viewModel.model[d]=c.observable());this.viewModel.model[d](b.target.result);"resourceIcon"===d&&(this.viewModel.loadedTechnicianIcon(b.target.result),this.showCustomResourceIconPopup());"destinationIcon"===d&&(this.viewModel.loadedDestinationIcon(b.target.result),
this.showCustomDestinationIconPopup())}.bind(this);e.readAsDataURL(b.files[0])}},isFileFormatCorrect:function(b,c,d){if(d&&d.length)for(var e=0,g=d.length;e<g;e++)if(b===d[e])return!0;b=b.substring(0,b.indexOf(";"));e=0;for(g=c.length;e<g;e++)if(-1!==b.indexOf(c[e]))return!0;return!1},setLogoImg:function(b){this.viewModel.companyLogoName(b.target.files[0].name);this.readImg(b.target,"logo")},setBackgroundImage:function(b){this.viewModel.backgroundImageName(b.target.files[0].name);this.readImg(b.target,
"backgroundImage")},setFaviconImg:function(b){this.viewModel.companyFaviconName(b.target.files[0].name);this.readImg(b.target,"favicon")},setTechnicianIcon:function(b){this.readImg(b.target,"resourceIcon")},setLocationIcon:function(b){this.readImg(b.target,"destinationIcon")},showIframeByKeyboard:function(b){13!=b.keyCode&&32!=b.keyCode||this.showZoommedIframe(b)},showZoommedIframe:function(b){var c=document.getElementById("wmt-zoommed-iframe-popup"),d="center";if(900<document.documentElement.clientHeight&&
1179>document.documentElement.clientWidth||900>=document.documentElement.clientHeight&&958>document.documentElement.clientWidth){if(!this.model.get("enableFeedback")&&"inProgressScreenWrapper"===b.target.id||"feedbackScreenWrapper"===b.target.id)d="right";"unassignedScreenWrapper"===b.target.id&&(d="left")}b.target.id&&c.open("#"+b.target.id,{my:{horizontal:d,vertical:"top"},at:{horizontal:d,vertical:"top"}});c=document.getElementById("zoommedIframeScreen");switch(b.currentTarget.id){case "unassignedScreenWrapper":this.zoomIframeStatus=
"notAssigned";break;case "assignedScreenWrapper":this.zoomIframeStatus="assigned";break;case "onTheWayScreenWrapper":this.zoomIframeStatus="onTheWay";break;case "inProgressScreenWrapper":this.zoomIframeStatus="started";break;case "feedbackScreenWrapper":this.zoomIframeStatus="completed"}c.contentWindow.postMessage({name:"set",data:{status:this.zoomIframeStatus}},"*")},hideZoommedIframe:function(b){document.getElementById("wmt-zoommed-iframe-popup").close()},changeMainColor:function(b){b=$(b.target).val();
document.querySelector("#mainColorHint").style.backgroundColor=b;this.model.set({name:b})},changeBackgroundColor:function(b){b=$(b.target).val();document.querySelector("#backgroundColorHint").style.backgroundColor=b;this.model.set({name:b})},showMainColorPalette:function(){this.readOnlyMode||document.getElementById("mainColorPalettePopup").open("#mainColor")},showCustomDestinationIconPopup:function(){if(!this.readOnlyMode){var b;10<this.viewModel.model.destinationIcon().length&&(b=document.getElementById("customDestinationIconPopup"),
b.open("#customDestinationIconImg"))}},showCustomResourceIconPopup:function(){if(!this.readOnlyMode){var b;10<this.viewModel.model.resourceIcon().length&&(b=document.getElementById("customResourceIconPopup"),b.open("#customResourceIconImg"))}},resetFileInput:function(b){b.target.value=""},showBackgroundColorPalette:function(){this.readOnlyMode||document.getElementById("backgroundColorPalettePopup").open("#backgroundColor")},showTechnicianPopup:function(){this.readOnlyMode||document.getElementById("technicianIconPopup").open("#technicianIconSelect")},
showLocationPopup:function(){this.readOnlyMode||document.getElementById("locationIconPopup").open("#locationIconSelect")},componentToHex:function(b){b=b.toString(16);return 1===b.length?"0"+b:b},rgbToHex:function(b,c,d){return"#"+this.componentToHex(b)+this.componentToHex(c)+this.componentToHex(d)}}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.views.wmtTheme.Container",d.define(c,function(){c.apply(this,arguments)},{template:'<div class="detailPanelContainer"><div class="detailsContainer"><div class="detailsContent"></div><div class="screen-footer screenFooter"></div></div></div>',regions:{detailsContent:".detailsContent",screenFooter:".screenFooter"}}))})(toa);(function(d,c){d.ns("toa.wmtTheme.ServerConnector",d.define(null,function(b,c){this._triggerFunction=b;this._controller=c},{_triggerFunction:function(){},_controller:"",request:function(b,e){var g=c.Deferred(),k=new FormData,l=GetSessId(),n=d.Ajax.prototype.route(this._controller,b);c.each(e,function(b,d){c.isPlainObject(d)||c.isArray(d)?c.each(d,function(c,d){k.append(b+"["+c+"]",d)}):k.append(b,d)});k.append(l.substr(0,l.indexOf("=")),l.substr(l.indexOf("=")+1,l.length-l.indexOf("=")));c.ajax({type:"POST",
url:n+"&output=ajax",cache:!1,data:k,dataType:"json",processData:!1,contentType:!1,success:function(b){if(b){if(isError(b))return processError(options,b),reject(b);d.reloader.clear();show_content.apply(window,[b])&&(b.status&&"OK"===b.status?g.resolve(b):g.reject(b.error_code||0,b.error_text||""))}}.bind(this),error:g.reject});return g.promise()}}))})(toa,$);(function(d){var c=d.classes.BaseDataMapper;d.ns("toa.wmtTheme.dataMappers.WmtThemeDataMapper",d.define(c,function(b){c.apply(this,arguments)},{_serverSaveMethod:"addWmtTheme",_serverRemoveMethod:"deleteWmtTheme",_serverSetDefaultMethod:"setDefaultWmtTheme",_serverIdField:"label",_modelConstructor:d.models.wmtTheme.WmtTheme,setDefault:function(b){var c={};c[this._serverIdField]=b.getId();return this._serverConnector.request(this._serverSetDefaultMethod,c)}}))})(toa);(function(d){var c=d.classes.BaseDataMapper;d.ns("toa.wmtTheme.dataMappers.WmtThemeDetailsDataMapper",d.define(c,function(b,d){c.apply(this,arguments)},{_serverIdField:"label",_serverGetField:"themeDetails",_serverGetMethod:"getWmtThemeDetails",_serverSaveMethod:"updateWmtThemeDetails",_modelConstructor:d.models.wmtTheme.WmtTheme,serialize:function(b){var c={fields:{content:{}}};for(key in b.attributes)c.fields.content[key]=b.attributes[key];c.fields.property_mapping=JSON.stringify({scoreProp:b.get("scoreProp"),
commentProp:b.get("commentProp"),resourceNameProp:b.get("resourceNameProp")});c.fields.label=b.get("label");c.fields.description=b.get("description");c.fields.is_default=b.get("is_default");c.fields.template_label=b.get("template_label");c.fields.customDomainName=b.get("customDomainName");delete c.fields.content.label;delete c.fields.content.description;delete c.fields.content.is_default;delete c.fields.content.template_label;delete c.fields.content.update_date;c.fields.content=JSON.stringify(c.fields.content);
return c}}))})(toa);(function(d,c){var b=d.classes.CollectionDataMapper;d.ns("toa.wmtTheme.dataMappers.WmtThemeListDataMapper",d.define(b,function(c){b.apply(this,[c,new d.classes.BaseDataMapper])},{_serverGetField:"wmtThemesList",_serverGetMethod:"getList"}))})(toa,$);(function(d,c){var b=d.classes.BaseDataMapper;d.ns("toa.wmtTheme.dataMappers.WmtThemeScreenDataMapper",d.define(b,function(c){b.apply(this,[c,new d.classes.BaseDataMapper])},{_serverGetField:"screen",_serverGetMethod:"getScreenDetails"}))})(toa,$);(function(d){d.ns("toa.controllers.WmtTheme",d.define(d.Controller,function(c){this.sandbox=c;this.content=c.options.content;this.triggerFunction=c.trigger.bind(c);c=document.head;c.getAttribute("data-resource");var b=document.createElement("link");b.rel="stylesheet";b.id="jet-alta-style1";b.href="https://www.oracle.com/webfolder/technetwork/jet/css/samples/cookbook/demo.css";c.insertBefore(b,c.firstElementChild);b=document.createElement("link");b.rel="stylesheet";b.id="jet-alta-style2";b.href="https://www.oracle.com/webfolder/technetwork/jet/css/samples/site/demo-alta-site-min.css";
c.insertBefore(b,c.firstElementChild);this.resume(this.sandbox.options)},{toString:function(){return"WMTheme config screen controller"},createPanelTitle:function(c){this.panel=d.view.control.create({xtype:"PanelTitleAlta",addClass:"jet-css-only toa-panel-title jet-screen-title panel-title-themes",name:"titleCaption",titleText:c.params.themeLabel,resourceTreeButton:!1,backButton:!0,backButtonIcon:"",headerResponsive:_DATA.page_label,backButtonLabel:_DATA.glossary.action_links.company_settings_themes,
backButtonHint:h(16257),filter:!1,calendar:!1,listeners:{backButtonClick:function(){d.app.trigger("layout.menu.click",{label:"company_settings_themes",url:"cmd=company_settings&sub=themes",name:"",params:{}})}},actions:[]});this.panel.render(this.content)},resume:function(c){this.triggerFunction("layout.tabs.set",{tabs:0,show:0});this.triggerFunction("layout.menu.changeTitle",{label:"company_settings_wmt_theme",url:"",name:h(24256),params:{}});this.createPanelTitle(c);this.initModels();this.initViews({readOnlyMode:c&&
c.params&&c.params.readOnlyMode||!1});this.showInitialViews();c=c.params.themeLabel;$.when(this.loadScreen(),this.loadWmtThemeDetails(c)).done(function(){require("knockout ojs/ojnavigationlist ojs/ojlabel ojs/ojselectcombobox ojs/ojcheckboxset ojs/ojinputtext ojs/ojcolorpalette ojs/ojradioset ojs/ojpopup".split(" "),function(){this.showWmtThemeDetails()}.bind(this))}.bind(this)).fail(function(b){switch(b){case 111:this.showError(h(24062));break;default:this.sandbox.error(b),this.showError(h(24255))}}.bind(this))},
initModels:function(){var c=new d.wmtTheme.ServerConnector(this.triggerFunction,"wmttheme"),b=new d.classes.BaseDataMapper(c);this.wmtThemeScreenMapper=new d.wmtTheme.dataMappers.WmtThemeScreenDataMapper(c,{resourceProperties:b,$commentProperties:b,$rateProperties:b});this.wmtThemeScreenModel=this.wmtThemeScreenMapper.create();this.wmtThemeDetailsMapper=new d.wmtTheme.dataMappers.WmtThemeDetailsDataMapper(c);this.wmtThemeDetailsModel=this.wmtThemeDetailsMapper.create()},initViews:function(c){this.containerView=
new d.views.wmtTheme.Container;c=c&&c.readOnlyMode||!1;this.detailsButtonsView=new d.views.wmtTheme.DetailsButtons({model:this.wmtThemeScreenModel,readOnlyMode:c});this.detailsFormView=new d.views.wmtTheme.DetailsForm({model:this.wmtThemeDetailsModel,templatesData:d.views.wmtTheme.ServiceManifests.initialThemesData,screenModel:this.wmtThemeScreenModel,readOnlyMode:c});this.detailsButtonsView.addListener("save:clicked",this.onSaveClicked.bind(this))},onSaveClicked:function(){var c=this.detailsFormView;
if(c.validate&&!c.validate())return!1;this.saveWmtTheme().then(function(){this.detailsButtonsView.setBtnDisabled("save",!1);this.detailsButtonsView.getContainer().find(".infoMessage").addClass("info-message--show");setTimeout(function(){this.detailsButtonsView.getContainer().find(".infoMessage").removeClass("info-message--show")}.bind(this),5E3)}.bind(this))},saveWmtTheme:function(){var c=$.Deferred();this.detailsButtonsView.setBtnDisabled("save",!0);this.wmtThemeDetailsMapper.save(this.wmtThemeDetailsModel).done(function(){c.resolve()}.bind(this)).fail(function(b,
d){var g;if(d&&"error"!==d)g=d;else switch(b){case 79:g=h(24268);break;case 94:g=h(20556);break;case 111:g=h(24062);break;default:g=h(24259),this.sandbox.error(b)}this.showError(g);this.detailsButtonsView.setBtnDisabled("save",!1);c.reject()}.bind(this));return c.promise()},showInitialViews:function(){this.screen=$('<div class="wmt-theme-details-screen"></div>');this.content.append(this.screen);this.containerView.render(this.screen)},loadScreen:function(){return this.wmtThemeScreenMapper.load(this.wmtThemeScreenModel)},
loadWmtThemeDetails:function(c){var b=this.wmtThemeDetailsModel,d=this.wmtThemeDetailsMapper;b.set({label:c},{silent:!0});return d.load(b)},showWmtThemeDetails:function(){this.containerView.showRegion("detailsContent",this.detailsFormView);this.containerView.showRegion("screenFooter",this.detailsButtonsView)},showError:function(c,b){c=c||h(24254);b=b||h(5651);return this.showPopup(b,c)},suspend:function(c){this.destroy()},destroy:function(){this.detailsFormView&&this.detailsFormView.hide();this.screen.empty()}}))})(toa);(function(d){var c='<form class="jet-css-only activity-linktemplate-form">;<%=sequence%>;<%=interval%>;<%=constraints%>;<%=general%>;<%=status%>;</form>'.split(";"),b='<div class="section sequence-group <%=classes%> type-<%=sequenceValue%>">,<% for(var i = 0; i < types.length; i++) { %>,<div role="button" aria-disabled="<%-readonlyMode%>" <%=tabIndex%> aria-labelledby="seq_lbl_<%-i%>" aria-pressed="<% if (types[i] == sequenceValue) { %>true<%} else {%>false<%}%>" data-type="<%-types[i]%>" class="sequence-type <%-types[i]%> <% if (types[i] == sequenceValue) { %>selected<%}%>">,<span>&nbsp;</span>,</div>,<% } %>,<p id="seq_lbl_0" class="node-sequence node-finish-to-start"><%-h(11890)%></p>,<p id="seq_lbl_1" class="node-sequence node-start-to-start"><%-h(11891)%></p>,<p id="seq_lbl_2" class="node-sequence node-simultaneous"><%-h(11892)%></p>,<p id="seq_lbl_3" class="node-sequence node-related"><%-h(11893)%></p>,</div>'.split(","),
e='<div class="section interval">;<h2 class="node-finish-to-start"><%-h(11894)%></h2>;<h2 class="node-start-to-start"><%-h(11895)%></h2>;<div class="input-section">;<div class="toa-formrow">;<div class="formLabel label_min_interval label_min_interval_value"><label id="minimum_interval"><%-h(11896)%></label>:</div>;<div class="formField">;<%=minimumInterval%>;</div>;</div>;<div class="toa-formrow">;<div class="formLabel label_max_interval label_max_interval_value"><label id="maximum_interval"><%-h(11916)%></label>:</div>;<div class="formField">;<%=maximumInterval%>;</div>;</div>;</div>;</div>'.split(";"),
g='<div class="section constraints">,<div class="input-section-constrain">,<div class="toa-formrow">,<div class="formField"><label><input type="checkbox" <% if (assignmentValue != "") {%>checked="checked"<%} %> name="assignment_enable" class="assignment" /><b class="label_assignment"><%-h(11898)%></b></label></div>,</div>,<div class="toa-formrow assignmentType <% if (assignmentValue == "") {%>hidden"<%} %>">,<div class="formField">,<% for (var i = 0; i < assignmentList.length; i++) { %>,<label>,<input type="radio" name="assignment" value="<%-assignmentList[i].value%>" <% if (assignmentValue == assignmentList[i].value) {%>checked="checked"<% } %> /><%-assignmentList[i].name%>,</label><br/>,<% } %>,</div>,</div><br/>,<div class="toa-formrow">,<div class="formField">,<label>,<input type="checkbox" <% if (schedulingValue != "") {%>checked="checked"<%} %> name="scheduling_enable" class="scheduling" /><b class="label_scheduling"><%-h(11899)%></b>,</label>,</div>,</div>,<div class="toa-formrow schedulingType <% if (schedulingValue == "") {%>hidden<%} %>">,<div class="formField">,<% for (var i = 0; i < schedulingList.length; i++) { %>,<label>,<input type="radio" name="scheduling" value="<%-schedulingList[i].value%>" <% if (schedulingValue == schedulingList[i].value) {%>checked="checked"<% } %> /><%-schedulingList[i].name%>,</label><br/>,<% } %>,</div>,</div>,</div>,</div>'.split(","),
k='<div class="section general">;<div class="reverse-link-block">;<h2><%-h(11903)%></h2>;<div class="input-section">;<div class="toa-formrow">;<% if (Object.keys(language).length === 1) {%>;<% for (var i in language) {%>;<div class="formLabel language-mandatory label_reverse_name_<%-i%>">*<%-h(11901)%>:</div>;<div class="formField"><input aria-required="true" required <%if(i == 1){%>placeholder="<%-h(11918)%>" value="<%-reverseName[i] || h(11918)%>" class="placeholderInput" <%} else {%> value="<%-reverseName[i] || ""%>" <%}%> type="input" name="reverse_name[<%-i%>]" /></div>;<% } %>;<% } else {%>;<div class="formLabel"><%-h(11901)%></div>;<% for (var i in language) {%>;<div class="lang_row">;<div class="language-mandatory label_reverse_name_<%-i%>"><label title="<%-language[i]%>" id="link1_lbl_<%-i%>"><abbr class="ofsc-abbr-mandatory" title="<%-h(22351)%>">*</abbr><%-language[i]%>:</label></div>;<div class="formField"><input aria-labelledby="link1_lbl_<%-i%>" required <%if(i == 1){%>placeholder="<%-h(11918)%>" value="<%-reverseName[i] || h(11918)%>" class="placeholderInput" <%} else {%> value="<%-reverseName[i] || ""%>" <%}%> type="input" name="reverse_name[<%-i%>]" /></div>;</div>;<% } %>;<% } %>;</div>;<div class="toa-formrow">;<div class="formLabel label_reverse_label formLabelMandatory"><label id="link1_lbl"><abbr class="ofsc-abbr-mandatory" title="<%-h(22351)%>">*</abbr><%-h(11902)%>:</label></div>;<div class="formField"><input required placeholder="<%-h(11918)%>" aria-labelledby="link1_lbl" class="placeholderInput" type="input" name="reverse_label" value="<%-reverseLabel||h(11918)%>" /></div>;</div>;</div>;</div>;<div class="regular-link-block">;<h2 class="node-regular-link"><%-h(11913)%></h2>;<h2 class="node-both-link"><%-h(11914)%></h2>;<div class="input-section">;<div class="toa-formrow">;<% if (Object.keys(language).length === 1) {%>;<% for (var i in language) {%>;<div class="formLabel language-mandatory label_regular_name_<%-i%>">*<%-h(11901)%>:</div>;<div class="formField"><input aria-required="true" required <%if(i == 1){%>placeholder="<%-h(11917)%>" class="placeholderInput" value="<%-regularName[i] || h(11917)%>"<%} else {%> value="<%-regularName[i] || ""%>" <% } %> type="input" name="regular_name[<%-i%>]" /></div>;<% } %>;<% } else {%>;<div class="formLabel"><%-h(11901)%>:</div>;<% for (var i in language) {%>;<div class="lang_row">;<div class="language-mandatory label_regular_name_<%-i%>"><label title="<%-language[i]%>" id="link2_lbl_<%-i%>"><abbr class="ofsc-abbr-mandatory" title="<%-h(22351)%>">*</abbr><%-language[i]%>:</label></div>;<div class="formField"><input aria-labelledby="link2_lbl_<%-i%>" required <%if(i == 1){%>placeholder="<%-h(11917)%>" class="placeholderInput" value="<%-regularName[i] || h(11917)%>"<%} else {%> value="<%-regularName[i] || ""%>" <% } %> type="input" name="regular_name[<%-i%>]" /></div>;</div>;<% } %>;<% } %>;</div>;<div class="toa-formrow">;<div class="formLabel label_regular_label formLabelMandatory"><label id="link2_lbl"><abbr class="ofsc-abbr-mandatory" title="<%-h(22351)%>">*</abbr><%-h(11902)%>:</label></div>;<div class="formField"><input aria-required="true" required placeholder="<%-h(11917)%>" aria-labelledby="link2_lbl" value="<%-regularLabel||h(11917)%>" class="placeholderInput" type="input" name="regular_label" /></div>;</div>;</div>;</div>;</div>'.split(";"),
l='<div class="section status">;<div>;<div class="input-section">;<div class="toa-formrow">;<div class="formLabel"><%-h(11904)%>:</div>;<div class="formField"><label><input type="checkbox" name="status" <% if (status) {%>checked="checked"<%} %> /><%-h(11905)%></label></div>;</div>;</div>;</div>;</div>'.split(";");d.view.ActivityLinkTemplateForm=d.define(null,function(){this.compileForm=(new d.Template(c)).compile();this.compileSequence=(new d.Template(b)).compile();this.compileInterval=(new d.Template(e)).compile();
this.compileConstraints=(new d.Template(g)).compile();this.compileGeneral=(new d.Template(k)).compile();this.compileStatus=(new d.Template(l)).compile();delete c;delete b;delete e;delete g;delete k;delete l},{compileForm:null,errorLabels:[],titlePopup:"",show:function(b){this.popup&&this.destroy();this.options=b;this.options.form||(this.options.form={id_type:"",sequence:"",min_interval:"",min_interval_value:"",max_interval:"",max_interval_value:"",assignment:"",scheduling:"",regular_name:"",regular_label:"",
reverse_name:"",reverse_label:"",status:!0});this._initForm();this._initPopup();this.popup.show();"undefined"!==typeof this.currentSequenceType&&this.setFocusedElement()},setFocusedElement:function(){$("form.activity-linktemplate-form :input:enabled:visible:not([readonly]):first").focus()},getValues:function(){var b,c,d,e,g,k;d=[];var l={};e=this.formContent.get(0).elements;g=/^(.+)\[(\d+)\]$/;l.sequence=this.currentSequenceType.data("type");l.type_id=this.options.form.type_id||null;for(k=0;k<e.length;k++)"checkbox"==
e[k].type?b=e[k].checked:"radio"==e[k].type?e[k].checked&&(b=$(e[k]).val()):b=$(e[k]).val(),b==h(11917)&&(b=""),g.test(e[k].name)?(d=g.exec(e[k].name),c=d[1],d=d[2],l[c]||(l[c]={}),l[c][d]=b):l[e[k].name]=b;return l},setErrorMessages:function(b){var c,d,e,g=[],k;if(this.errorLabels.length){for(c=0;c<this.errorLabels.length;c++)this.errorLabels[c].removeClass("formError");this.popup.removeErrors();this.errorLabels=[]}for(c in b)if("object"==typeof b[c])for(d in b[c])e=$(".label_"+c+"_"+d,this.formContent),
k={id:c+"["+d+"]",message:b[c][d]},g.push(k),e.addClass("formError"),this.errorLabels.push(e);else e=$(".label_"+c,this.formContent),k={id:c,message:b[c]},g.push(k),e.addClass("formError"),this.errorLabels.push(e);this.popup.setErrors(g)},setTitle:function(b){this.titlePopup=b},destroy:function(){this.options={};this.popup&&(this.popup.destroy(),this.popup=null)},getMinimumInterval:function(){var b;b='<select aria-labelledby="minimum_interval" name="min_interval"><% for(var i = 0; i < minDelayList.length; i++) {%><option value="<%-minDelayList[i].value%>" <% if (minDelayList[i].value == minDelay) { %>selected="selected"<%}%>><%-minDelayList[i].name%></option><% } %></select>';
b=""+d.glossary({id:19535}).replace("{SELECT}",b).replace("{INPUT}",'<input aria-labelledby="minimum_interval min_interval_minutes" name="min_interval_value" class="min" value="<%-minDelayValue%>" type="text" maxlength="5"/><label style="display: none" id="min_interval_minutes"><%-h(11897)%></label>').replace("{TOKEN}",d.glossary({id:11897}));b=(new d.Template(b)).compile();return b=b.apply({minDelayList:[{value:"adjustable",name:h(11906)},{value:"non_adjustable",name:h(11907)}],minDelay:this.options.form.min_interval||
"adjustable",minDelayValue:this.options.form.min_interval_value||0})},getMaximumInterval:function(){var b;b='<select aria-labelledby="maximum_interval" name="max_interval"><% for(var i = 0; i < maxDelayList.length; i++) {%><option value="<%-maxDelayList[i].value%>" <% if (maxDelayList[i].value == maxDelay ) { %>selected="selected"<%}%>><%-maxDelayList[i].name%></option><% } %></select>';b=""+d.glossary({id:19535}).replace("{SELECT}",b).replace("{INPUT}",'<div class="max_interval_value_input"><input aria-labelledby="maximum_interval max_interval_minutes" name="max_interval_value" class="min" value="<%-maxDelayValue%>" type="text" maxlength="5"/><label style="display: none" id="max_interval_minutes"><%-h(11897)%></label></div>').replace("{TOKEN}",
'<div class="max_interval_value_input"><%-h(11897)%></div>');b=(new d.Template(b)).compile();return b=b.apply({maxDelayList:[{value:"adjustable",name:h(11906)},{value:"non_adjustable",name:h(11907)},{value:"unlimited",name:h(11908)}],maxDelay:this.options.form.max_interval||"unlimited",maxDelayValue:this.options.form.max_interval_value||0})},_initPopup:function(){this.popup=new d.ui.Popup;this.popup.setButtons([{text:d.glossary({id:6351}),click:function(){this.destroy()}.bind(this)},{text:d.glossary({id:12}),
type:"submit",click:function(){this.notify("submitForm",this.getValues())}.bind(this)}]);this.popup.setContent(this.formContent);this.popup.setPositionCenter();this.popup.setTitle(this.titlePopup)},_initForm:function(){var b=this.compileSequence.apply({readonlyMode:this.options&&this.options.action&&"update"==this.options.action?"true":"false",tabIndex:this.options&&this.options.action&&"update"==this.options.action?"":'tabindex="0"',sequenceValue:this.options.form.sequence||"finish-to-start",types:["finish-to-start",
"start-to-start","simultaneous","related"],classes:this.options&&this.options.action&&"update"==this.options.action?"sequence-group__before-modify":""}),c=this.compileInterval.apply({minimumInterval:this.getMinimumInterval(),maximumInterval:this.getMaximumInterval()}),d=this.compileConstraints.apply({assignmentValue:this.options.form.assignment||"",schedulingValue:this.options.form.scheduling||"",assignmentList:[{value:"different_resources",name:h(11909)},{value:"the_same_resource",name:h(11910)}],
schedulingList:[{value:"different_days",name:h(11911)},{value:"the_same_day",name:h(11912)}]}),e=this.compileGeneral.apply({language:this.options.language,regularName:this.options.form.regular_name||[],regularLabel:this.options.form.regular_label||"",reverseName:this.options.form.reverse_name||[],reverseLabel:this.options.form.reverse_label||""}),g=this.compileStatus.apply({status:this.options.form.status});this.formContent=$(this.compileForm.apply({sequence:b,interval:c,constraints:d,general:e,status:g}));
this.formSequence=$(".sequence-group",this.formContent);this.formInterval=$(".interval",this.formContent);this.formConstraints=$(".constraints",this.formContent);this.formGeneral=$(".general",this.formContent);this.formStatus=$(".status",this.formContent);this._initSequence();this._initIntervals();this._initConstraints();this._initGenerals();this.formContent.on("submit",function(b){b.stopPropagation();return!1})},_initSequence:function(){this.currentSequenceType=$(".selected",this.formSequence);this.formContent.addClass("type-"+
this.currentSequenceType.data("type"));this.formContent.on("click",".sequence-group .sequence-type",function(b){this.selectSequenceType(b)}.bind(this));this.formContent.on("keydown",".sequence-group .sequence-type",function(b){if(13===b.keyCode||32==b.keyCode)this.selectSequenceType(b),b.preventDefault()}.bind(this))},selectSequenceType:function(b){b=$(b.currentTarget);b.addClass("selected");b.attr("aria-pressed","true");this.sequence_type=b.data("type");this.sequence_type!==this.currentSequenceType.data("type")&&
(this.formContent.removeClass("type-"+this.currentSequenceType.data("type")),this.formContent.addClass("type-"+b.data("type")),this.currentSequenceType.removeClass("selected"),this.currentSequenceType.attr("aria-pressed","false"),this.currentSequenceType=b,this.setErrorMessages([]),$(".error_list",this.formContent).remove());this.popup.recalculateHeight()},_initIntervals:function(){"unlimited"===$(":input[name=max_interval]",this.formInterval).get(0).value&&$(".max_interval_value_input",this.formInterval).hide();
$(":input[name=max_interval]",this.formInterval).on("change",function(b){var c=$(".max_interval_value_input",this.formInterval);"unlimited"===b.currentTarget.value?c.hide():c.show()}.bind(this))},_initConstraints:function(){var b=$(".assignment",this.formConstraints),c=$(".scheduling",this.formConstraints);b.on("change",function(b){var c=$(".assignmentType",this.formConstraints);b.currentTarget.checked?c.removeClass("hidden"):c.addClass("hidden");this.popup.recalculateHeight()}.bind(this));c.on("change",
function(b){var c=$(".schedulingType",this.formConstraints);b.currentTarget.checked?c.removeClass("hidden"):c.addClass("hidden");this.popup.recalculateHeight()}.bind(this))},_initGenerals:function(){var b,c,d;this.reverseLabelEdited=this.regularLabelEdited=!1;this.regularNameLangEdited={};this.reverseNameLangEdited={};this.regularName=$(':input[name="regular_name[1]"]',this.formGeneral);this.regularNameLang=$(".regular-link-block .lang_row input",this.formGeneral);this.regularLabel=$(':input[name="regular_label"]',
this.formGeneral);this.reverseName=$(':input[name="reverse_name[1]"]',this.formGeneral);this.reverseNameLang=$(".reverse-link-block .lang_row input",this.formGeneral);this.reverseLabel=$(':input[name="reverse_label"]',this.formGeneral);this._nameToValue(this.regularName.val())!==this.regularLabel.val()&&this.regularLabel.val()!==h(11917)&&(this.regularLabelEdited=!0,this.regularLabel.removeClass("placeholderInput"));this._nameToValue(this.reverseName.val())!==this.reverseLabel.val()&&this.reverseLabel.val()!==
h(11918)&&(this.reverseLabelEdited=!0,this.reverseLabel.removeClass("placeholderInput"));this.regularName.val()!==h(11917)&&this.regularName.removeClass("placeholderInput");this.reverseName.val()!==h(11918)&&this.reverseName.removeClass("placeholderInput");this.regularName.on("keyup",function(){if("update"!==this.options.action)for(this.regularLabelEdited||(this.regularLabel.val(this._nameToValue(this.regularName.val())),this.regularLabel.removeClass("placeholderInput")),b=0;b<this.regularNameLang.length;b++)c=
$(this.regularNameLang[b]),d=c.attr("name"),d!==this.regularName.attr("name")&&!0!==this.regularNameLangEdited[d]&&this.regularName.val()!==h(11917)&&c.val(this.regularName.val())}.bind(this));this.regularNameLang.on("change",function(b){this.regularNameLangEdited[b.currentTarget.name]=!0}.bind(this));this.regularLabel.on("change",function(b){this.regularLabel.val()!==h(11917)&&""!==this.regularLabel.val()&&(this.regularLabelEdited=!0)}.bind(this));this.reverseName.on("keyup",function(){if("update"!==
this.options.action)for(this.reverseLabelEdited||(this.reverseLabel.val(this._nameToValue(this.reverseName.val())),this.reverseLabel.removeClass("placeholderInput")),b=0;b<this.reverseNameLang.length;b++)c=$(this.reverseNameLang[b]),d=c.attr("name"),d!==this.reverseName.attr("name")&&!0!==this.reverseNameLangEdited[d]&&this.reverseName.val()!==h(11918)&&c.val(this.reverseName.val())}.bind(this));this.regularName.on("focus",this.onInputFocusRegular);this.regularName.on("blur",this.onInputBlurRegular);
this.reverseName.on("focus",this.onInputFocusReverse);this.reverseName.on("blur",this.onInputBlurReverse);this.reverseNameLang.on("change",function(b){this.reverseNameLangEdited[b.currentTarget.name]=!0}.bind(this));this.reverseLabel.on("change",function(b){this.reverseLabel.val()!==h(11918)&&""!==this.reverseLabel.val()&&(this.reverseLabelEdited=!0)}.bind(this));this.regularLabel.on("focus",this.onInputFocusRegular);this.regularLabel.on("blur",this.onInputBlurRegular);this.reverseLabel.on("focus",
this.onInputFocusReverse);this.reverseLabel.on("blur",this.onInputBlurReverse)},onInputFocusRegular:function(b){b=$(b.currentTarget);b.val()===h(11917)&&(b.removeClass("placeholderInput"),b.val(""))},onInputBlurRegular:function(b){b=$(b.currentTarget);""===b.val()&&(b.addClass("placeholderInput"),b.val(h(11917)))},onInputFocusReverse:function(b){b=$(b.currentTarget);b.val()===h(11918)&&(b.removeClass("placeholderInput"),b.val(""))},onInputBlurReverse:function(b){b=$(b.currentTarget);""===b.val()&&
(b.addClass("placeholderInput"),b.val(h(11918)))},_nameToValue:function(b){return b.replace(/^\s+|\s+$/g,"").toLowerCase().replace(/\s/g,"_")}});d.mixin(d.view.ActivityLinkTemplateForm.prototype,d.mixins.EventEmitter)})(toa);(function(d){var c=d.Controller,b='<div class="toa-panel-content-alta">;      <div class="sub_content">;          <div id="content_caption_alta"></div>;          <div id="activity-links-types" class="jet-css-only"></div>;      </div>;      <div id="footer" class="footer"><%=footer%></div>;</div>'.split(";");d.controllers.ActivityLinkTemplates=d.define(c,function(){this.compileLayout=(new d.Template(b)).compile();delete b;this.allowModify=!1;this.hideInactiveStatus=1;this._create.apply(this,arguments)},
{sequence_type:"finish-to-start",listeners:{},toString:function(){return"Activity Link Types management"},_create:function(b){c.prototype._create.call(this,b);this.initLayout();this.resume(b.options);this.form=new d.view.ActivityLinkTemplateForm;this.form.addListener("submitForm",function(b,c){c.status=c.status?"active":"inactive";null==c.type_id?this.addActivityLinkTemplate(c):this.editActivityLinkTemplate(c);return!0}.bind(this));this.sandbox.bind("global.interface.refresh",this.requestData.bind(this))},
submitForm:function(b,c){c.status=c.status?"active":"inactive";null==c.type_id?this.addActivityLinkTemplate(c):this.editActivityLinkTemplate(c);return!0},addActivityLinkTemplate:function(b){this.sandbox.trigger("global.data.get",{controller:"ActivityLinkTemplates",method:"add",params:b,responseHandler:this.onActivityLinkResponse.bind(this)})},editActivityLinkTemplate:function(b){this.sandbox.trigger("global.data.get",{controller:"ActivityLinkTemplates",method:"update",params:b,responseHandler:this.onActivityLinkResponse.bind(this)})},
onActivityLinkResponse:function(b,c){"ok"==c.result?(this.form.destroy(),this.requestData()):this.form.setErrorMessages(c.errors)},initLayout:function(){this.layout=$(this.compileLayout.apply({footer:d.toHtml(this.sandbox.model("companySettings").settings.copyright)}))},initPanel:function(){this.title=d.view.control.create({xtype:"PanelTitleAlta",viewSelector:!1,resourceTreeButton:!1,calendar:!1,filter:!0,filterDesc:[{xtype:"Checkbox",id:"chkbx_hide_inactive",name:"hide_inactive",formLabel:h(13363),
value:this.hideInactiveStatus?!0:!1,listeners:{change:this.onHideInactiveChange.bind(this)}}],headerResponsive:_DATA.page_label,backButton:!0,backButtonIcon:"",backButtonLabel:_DATA.glossary.action_links.company_settings_configuration,backButtonHint:h(16257),titleText:h(11882),listeners:{filterApply:this.onFilterApply.bind(this),backButtonClick:function(){$app.navigation().redirect("company_settings_configuration")}},actions:this.allowModify?[{xtype:"Button",label:h(11883),name:"add_activity",addClass:"xtype_button_add_activity_link",
listeners:{click:function(){this.form.setTitle(h(11884));this.form.show({language:this.language,action:"add"})}.bind(this)}}]:[]});this.title.render("#content_caption_alta")},suspend:function(b){d.app.reflowManager.removeListener(this.listeners.resize);this.layout.detach();this.title.destroy(!0);this.dataTable=null;this.grid.removeListener(this.listeners.sort);this.grid.destroy();this.grid=null;c.prototype.suspend.call(this,b)},resume:function(b){c.prototype.resume.call(this,b);b.content.append(this.layout);
this.sandbox.trigger("layout.tabs.set",{tabs:0,show:0});this.requestData()},requestData:function(b){"undefined"==typeof b&&(b={hide_inactive:this.hideInactiveStatus?1:0});"string"==typeof b&&(b={});this.sandbox.trigger("global.data.get",{controller:"ActivityLinkTemplates",method:"index",params:b,responseHandler:this.showData.bind(this)})},showData:function(b,c){!this.isSuspended&&c&&(this.allowModify=c.allowModify,this.data=c,this.language=c.language,this.drawActivityLinkTemplatesList(),this.title&&
this.title.destroy(!0),this.initPanel(),app.focusToTheLastSelectedElement&&app.focusToTheLastSelectedElement())},drawActivityLinkTemplatesList:function(){this.dataTable?this.dataTable.updateData(this.data.linkTemplatesList):this.dataTable=new d.models.DataTable(this.data.linkTemplatesList);if(this.grid)this.grid.draw();else{this.grid=new d.ui.Grid("#activity-links-types",new d.ui.TemplateSimpleGrid);var b=h(11885).split("/"),b=b[0]+'/ <div class="gray-linktemplate-name">'+b[1]+"</div>",c=h(11886).split("/"),
c=c[0]+'/ <div class="gray-linktemplate-name">'+c[1]+"</div>",k=this.data.userLanguage;this.grid.setDataSource(this.dataTable);this.grid.setTitleCaption(h(11882));this.grid.setEmptyGridMessage(h(13364));this.grid.setColumns([{id:"type_id",label:h(1901),className:"center",order:"asc",sortable:!0,rowHeader:!0},{id:"reverse_name",label:c,allowHtml:!0,order:"asc",sortable:!0,cellFormatter:function(b,c){return"simultaneous"===c.get("sequence")?"&ndash;":hs(b[k])+' / <div class="gray-linktemplate-name">'+
hs(c.get("reverse_label"))+"</div>"}},{id:"regular_name",label:b,allowHtml:!0,order:"asc",sortable:!0,cellFormatter:function(b,c){return hs(b[k])+' / <div class="gray-linktemplate-name">'+hs(c.get("regular_label"))+"</div>"}},{id:"status",allowHtml:!0,label:h(11915),className:"center",sortable:!1,cellFormatter:function(b,c){return"active"==b?'<div role="img" aria-label="'+h(16922)+'" class="enable">&nbsp;</div>':'<div role="img" aria-label="'+h(16923)+'" class="disable">&nbsp;</div>'}},{id:"constraints",
label:h(11887),sortable:!1,allowHtml:!0,className:"column_constraints",cellFormatter:function(b,c){var d=[],e=c.get("min_interval_value");e&&d.push(h(14422,{"{MIN}":e}));(e=c.get("max_interval_value"))&&d.push(h(14423,{"{MAX}":e}));if(e=c.get("assignment"))switch(e){case "different_resources":d.push(h(11909));break;case "the_same_resource":d.push(h(11910))}if(e=c.get("scheduling"))switch(e){case "different_days":d.push(h(11911));break;case "the_same_day":d.push(h(11912))}0<d.length&&(d=d.join(", "));
var e="",g=hs(c.get("sequence"));switch(g){case "finish-to-start":e=h(11890);break;case "start-to-start":e=h(11891);break;case "simultaneous":e=h(11892);break;case "related":e=h(11893)}return'<div class="'+g+'" role="img" aria-label="'+e+'">&nbsp;</div>'+d}},{id:"action",label:h(11888),className:"center",allowHtml:!0,sortable:!1,cellFormatter:function(b,c){return'<a  data-id="'+c.id+'" class="span_link actions" tabindex="0">'+h(14607)+"</a>"}}]);this.grid.draw();this.listeners.sort=this.grid.addListener("sort",
this.gridSort.bind(this));this.listeners.resize=d.app.reflowManager.addListener("resize",this.resizeHendler.bind(this));$("#activity-links-types").on("click",".actions",function(b){this.clickActions(b)}.bind(this));$("#activity-links-types").on("keydown",".actions",function(b){if(13===b.keyCode||32==b.keyCode)this.clickActions(b),b.preventDefault()}.bind(this))}},resizeHendler:function(b,c){this.grid.adjustColumnsWidth()},gridSort:function(b,c){this.dataTable.comparator=function(b,d){""===c.sort&&
(c.column="type_id",c.sort="asc");var e=b.get(c.column),p=d.get(c.column);"object"===typeof e&&(e=e[1],"simultaneous"===b.get("sequence")&&(e="-"));"object"===typeof p&&(p=p[1],"simultaneous"===d.get("sequence")&&(p="-"));switch(c.sort){case "asc":if(e<p)return-1;if(e>p)return 1;break;case "desc":if(e>p)return-1;if(e<p)return 1}return 0};this.dataTable.sort();this.grid.draw()},clickActions:function(b){b=$(b.currentTarget);b=this.dataTable.get(b.data("id"));this.form.setTitle(h(11889));this.form.show({language:this.language,
form:{type_id:b.id,sequence:b.get("sequence"),min_interval:b.get("min_interval"),min_interval_value:b.get("min_interval_value"),max_interval:b.get("max_interval"),max_interval_value:b.get("max_interval_value"),assignment:b.get("assignment"),scheduling:b.get("scheduling"),regular_name:b.get("regular_name"),regular_label:b.get("regular_label"),reverse_name:b.get("reverse_name"),reverse_label:b.get("reverse_label"),status:"active"==b.get("status")?!0:!1},action:"update"})},showError:function(b){this.isSuspended||
this.layout.find("#inner_content").html('<div class="error_msg">'+d.toHtml(b)+"</div>")},onFilterApply:function(b,c){this.requestData(c.values);this.title.closeFilter()},onHideInactiveChange:function(b,c){this.hideInactiveStatus=c.value?1:0}})})(toa);toa.ns("toa.controllers.WorkSkillsCapacityCategoryList",function(d,c){var b=d.controllers.config.BaseConfigScreen;return d.define(b,function(){this._create.apply(this,arguments)},{defaultOptions:{serverControllerName:"Workskillcapacitycategory",securityModuleLabel:"company_settings_work_skill_capacity_categories",backButtonLabel:"company_settings_configuration",page:b.prototype.defaultOptions.page},_init:function(c){this.isRecalculationRequest=!1;b.prototype._init.call(this,c);this._initSkillsDialog();
this._initTimeSlote()},_createGridDiv:function(){this.generateElement("workskill-capacity-categories-content")},initTranslations:function(){this.defaultOptions||(this.defaultOptions={});this.defaultOptions.titleLabel=d.glossary({id:12415});this.defaultOptions.entityName=d.glossary({id:12416});this.defaultOptions.searchPlaceholder=d.glossary({id:6365});this.defaultOptions.addDialogTitle=h(11838);this.defaultOptions.editDialogTitle=h(11839)},onUpdate:function(c,g){"object"===typeof g.langs&&(this.langs=
g.langs);this.gridDiv.ConfigGrid("updateAttr",d.glossary({id:12415}));b.prototype.onUpdate.apply(this,arguments);this.getRecalcultationStatus(c,g)},_initSkillsDialog:function(){var b={xtype:"dialog",title:h(11835),layout:"vbox",listeners:{ok:this.onSaveSkills.bind(this)},bottomPanel:{items:[{},{value:h(6413)},{value:h(12)}]},items:[{xtype:"hidden",name:"id"},{xtype:"checkboxtable",name:"skills",validateErrorPlaceholders:11840}]};this.editSkillsDialog=d.formBuilder(b);this.editSkillsDialog.renderTo(this.gridDiv)},
_initTimeSlote:function(){var b={xtype:"dialog",title:h(3452),layout:"vbox",bottomPanel:{items:[{},{value:h(6413)},{value:h(12)}]},listeners:{ok:this.onSaveTimeSlote.bind(this)},items:[{xtype:"hidden",name:"id"},{xtype:"checkboxtableBase",name:"time_slot"}]};this.editTimeSloteDialog=d.formBuilder(b);this.editTimeSloteDialog.renderTo(this.gridDiv)},_createCaptionControls:function(){b.prototype._createCaptionControls.call(this)},getCaptionActionsDescription:function(){return 2==this.options.access?
[{title:h(1954),listeners:{click:this.addNew.bind(this)}}]:!1},getColumnsDescription:function(){return[{name:"work_skill_id",title:h(1901),colClass:"cell-center",width:"1%",sortable:!0},{name:"name",title:h(68),colClass:"cell-center",modify:2==this.options.access,sortable:!0,format:this.formatOutput.bind(this),rowHeader:!1},{name:"label",title:h(1645),colClass:"cell-center",sortable:!0,format:this.formatOutput.bind(this)},{name:"status",title:h(1204),colClass:"cell-center",sortable:!0,width:"10%",
format:"status"},{name:"skills",title:h(5243),sortable:!1,width:"40%",modify:2==this.options.access,format:this.formatSkills.bind(this),onModifyClick:this.editSkills.bind(this)},{name:"time_slot",title:h(6700),sortable:!1,width:"30%",modify:2==this.options.access,format:this.formatTimeslot.bind(this),onModifyClick:this.editTimeSlot.bind(this)}]},getKeyField:function(){return"work_skill_id"},getEditDialogFieldsDescription:function(){var b={name:"name",fieldLabel:h(68),allowBlank:!1};"object"===typeof this.langs&&
1===this.langs.count?(b.xtype="input",b.mandatory=!0,"string"===typeof this.langs.lang&&(b.lang=this.langs.lang)):(b.xtype="editlist",b.lang="lang",b.validator=function(b){if(isEmpty(b[1]))return h(11842)});return[{xtype:"hidden",name:"work_skill_id",value:0},b,{xtype:"input",name:"label",fieldLabel:h(1645),allowBlank:!1,vtype:"min3symbol",mandatory:!0,attr:{maxlength:40}},{xtype:"checkbox",name:"status",fieldLabel:h(30),value:!0}]},editSkills:function(b,c){var d=this,l=d.rowByRowNum(c.row);d.editSkillsDialog.reset();
d.editSkillsDialog.find("id").setValue(l.work_skill_id);d.editSkillsDialog.setTitle(d.editSkillsDialog.options.title+": "+l[d.options.itemNameField]);d.sandbox.trigger("global.data.get",{controller:d.options.serverControllerName,method:"loadskills",params:{work_skill_id:l.work_skill_id,company:d.sandbox.options.company},responseHandler:function(b,c){d.editSkillsDialog.find("skills").setItemsList(c.skills).setValue(l.skills);d.editSkillsDialog.open()}});d.getRecalcultationStatus(b,c)},editTimeSlot:function(b,
c){var d=this,l=d.rowByRowNum(c.row);d.editTimeSloteDialog.reset();d.editTimeSloteDialog.find("id").setValue(l.work_skill_id);d.editTimeSloteDialog.setTitle(d.editTimeSloteDialog.options.title+": "+l[d.options.itemNameField]);d.sandbox.trigger("global.data.get",{controller:d.options.serverControllerName,method:"loadtimeslote",params:{company:d.sandbox.options.company},responseHandler:function(b,c){d.editTimeSloteDialog.find("time_slot").setItemsList(c.timeslote).setValue(l.time_slot);d.editTimeSloteDialog.open()}});
d.getRecalcultationStatus(b,c)},onSaveSkills:function(){var b=this,c=b.editSkillsDialog.find("id").getValue(),d=b.editSkillsDialog.find("skills"),l=d.validate();b.editSkillsDialog.setError(l)||(d=d.getValue(),b.sandbox.trigger("global.data.get",{controller:b.options.serverControllerName,method:"saveskills",params:{id:c,skills:d,company:b.sandbox.options.company},responseHandler:function(c,d){d.success?(b.editSkillsDialog.close(),b.onChange()):b.editSkillsDialog.setError(d.error||"Internal error")}}))},
onSaveTimeSlote:function(){var b=this,c=b.editTimeSloteDialog.find("id").getValue(),d=b.editTimeSloteDialog.find("time_slot").getValue();b.sandbox.trigger("global.data.get",{controller:b.options.serverControllerName,method:"savetimeslot",params:{id:c,time_slot:d,company:b.sandbox.options.company},responseHandler:function(c,d){d.success?(b.editTimeSloteDialog.close(),b.onChange()):b.editTimeSloteDialog.setError(d.error||"Internal error")}})},formatSkills:function(b,c){var k=[],l;for(l in c.skills)c.skills[l].ratio?
k.push(c.skills[l].name+"("+c.skills[l].ratio+")"):k.push("["+c.skills[l].name+"]");k.sort(function(b,c){var d="["==b.charAt(0),e="["==c.charAt(0);return d==e?b<c?-1:1:d<e?1:-1});return d.toHtml(k.join(", "))},formatTimeslot:function(b,c){var k,l=[],n=c.time_slot;for(k in n)l.push(n[k]);return d.toHtml(l.join("; "))},formatOutput:function(b,c){var k=d.toHtml(c[b.name]);this.searchKey&&(k=k.replace(RegExp(d.escapeRegExp(d.toHtml(this.searchKey)),"gi"),function(b){return'<span class="srch_mngmt">'+
b+"</span>"}));return k},getRecalcultationStatus:function(b,d){var k=this;this.isSuspended||(c("td:contains('"+k.editSkillsDialog.find("id").getValue()+"')").parent().find('input[type="checkbox"]').focus(),app.focusToTheLastSelectedElement&&app.focusToTheLastSelectedElement(),"undefined"!==typeof d.work_skill_capacity_category_update_failed&&!0===d.work_skill_capacity_category_update_failed?this.isRecalculationRequest=!1:("undefined"!==typeof d.work_skill_capacity_category_recalculation_applied&&
this.gridDiv.ConfigGrid("clearMessages"),!1===d.work_skill_capacity_category_recalculation_applied&&(this.gridDiv.ConfigGrid("setGroupActionMessage",h(10530),"success",!0),this.isRecalculationRequest||(this.isRecalculationRequest=!0,setTimeout(function(){this.isSuspended||k.sandbox.trigger("global.data.get",{controller:k.options.serverControllerName,method:"getRecalculationStatus",responseHandler:function(b,c){k.isRecalculationRequest=!1;k.getRecalcultationStatus(b,c)}})},5E3)))))},suspend:function(c){this.editTimeSloteDialog&&
(this.editTimeSloteDialog.destroy(),this.editTimeSloteDialog=null);this.editSkillsDialog&&(this.editSkillsDialog.destroy(),this.editSkillsDialog=null);this.isSuspended=1;this.isRecalculationRequest=!1;b.prototype.suspend.call(this,c)},resume:function(c){this.isSuspended=0;b.prototype.resume.call(this,c)},updateForm:function(b){var c=this;b||(b={});c.editDialog.reset();c.editDialog.forAll("reset");c.sandbox.trigger("global.data.get",{controller:c.options.serverControllerName,method:"editform",params:{work_skill_id:b.work_skill_id||
"",company:c.sandbox.options.company},responseHandler:function(d,l){c.editDialog.setValues({work_skill_id:b.work_skill_id||0,label:b.label||"",status:"undefined"==typeof b.status||"active"==b.status});if(1===Object.keys(l.form.name).length){for(var n in l.form.name)var p=l.form.name[n].value;c.editDialog.setValues({name:p})}else c.editDialog.setValues(l.form);c.editDialog.open()}})}},{})}(toa,$));toa.ns("toa.controllers.WorkSkillsList",function(d,c){var b=d.controllers.config.BaseConfigScreen;return d.define(b,function(){this._create.apply(this,arguments)},{defaultOptions:{serverControllerName:"Workskill",securityModuleLabel:"company_settings_work_skills_list",backButtonLabel:"company_settings_configuration",page:b.prototype.defaultOptions.page},_createGridDiv:function(){this.generateElement("work-skills-list")},initTranslations:function(){this.defaultOptions.titleLabel=d.glossary({id:12421});
this.defaultOptions.entityName=d.glossary({id:12421});this.defaultOptions.searchPlaceholder=d.glossary({id:6366});this.defaultOptions.addDialogTitle=h(5376);this.defaultOptions.editDialogTitle=h(11835)},onUpdate:function(c,d){"object"===typeof d.langs&&(this.langs=d.langs);this.gridDiv.ConfigGrid("updateAttr",h(12421));b.prototype.onUpdate.apply(this,arguments)},modifyEditDialogDescription:function(b){b.width=450},_createCaptionControls:function(){b.prototype._createCaptionControls.call(this)},navigateToScreenAlternative:function(b,
c,k){d.app.trigger("layout.menu.click",{label:b,url:"",name:c+" - "+k,params:{}})},getCaptionActionsDescription:function(){var b=[{title:d.glossary({id:12419}),listeners:{click:this.navigateToScreenAlternative.bind(this,"company_settings_work_skill_groups",d.glossary({id:12419}),d.glossary({id:12421}))}},{title:d.glossary({id:12417}),listeners:{click:this.navigateToScreenAlternative.bind(this,"company_settings_work_skill_conditions",d.glossary({id:12417}),d.glossary({id:12421}))}}];2===this.options.access&&
b.push({title:h(1954),listeners:{click:this.addNew.bind(this)}});return b},getKeyField:function(){return"work_skill_id"},getGroupActionsDescription:function(){return 2==this.options.access?[{name:"delete",title:h(1201)},{name:"activate",title:h(10513)},{name:"deactivate",title:h(10514)}]:!1},getColumnsDescription:function(){var b=[{name:"work_skill_id",title:h(1901),colClass:"cell-center",width:"1%",sortable:!0},{name:"name",title:h(68),colClass:"cell-center",sortable:!0,format:this.formatOutput.bind(this)},
{name:"label",title:h(1645),colClass:"cell-center",sortable:!0,format:this.formatOutput.bind(this)},{name:"status",title:h(1204),colClass:"cell-center",sortable:!0,width:"10%",format:"status"}];2===this.options.access&&b.push({name:"actions",title:h(3514),sortable:!1,width:"7%",format:function(b,c){return'<span class="auto-hide"></span><span data-work_skill_id="'+c.work_skill_id+'" role="link" tabindex="0" class="span_link workskill-modify-link">'+h(14607)+"</span>"}});return b},onModifyClick:function(b,
c){if(2>this.options.access)return!1;var d=this.gridDiv.ConfigGrid("option","cols")[c.col].name;d!=this.options.itemNameField&&"actions"!=d||this.edit(c.row)},formatOutput:function(b,c){var k=d.toHtml(c[b.name]);this.searchKey&&(k=k.replace(RegExp(d.escapeRegExp(d.toHtml(this.searchKey)),"gi"),function(b){return'<span class="srch_mngmt">'+b+"</span>"}));return k},getEditDialogFieldsDescription:function(){var b={name:"name",fieldLabel:h(68),allowBlank:!1};"object"===typeof this.langs&&1===this.langs.count?
(b.xtype="input",b.mandatory=!0):(b.xtype="editlist",b.validator=function(b){if(isEmpty(b[1]))return h(11842)});return[{xtype:"hidden",name:"work_skill_id",value:0},b,{xtype:"input",name:"label",fieldLabel:h(1645),allowBlank:!1,vtype:"min3symbol",mandatory:!0,attr:{maxlength:40}},{xtype:"select",name:"sharing",fieldLabel:h(12627),items:[]},{xtype:"checkbox",name:"status",fieldLabel:h(30),value:!0}]},updateForm:function(b){var c=this;b||(b={});c.editDialog.reset();c.editDialog.forAll("reset");c.sandbox.trigger("global.data.get",
{controller:c.options.serverControllerName,method:"editform",params:{work_skill_id:b.work_skill_id||"",company:c.sandbox.options.company},responseHandler:function(d,l){var n=[],p;for(p in l.sharing)n.push({xtype:"option",value:p,text:l.sharing[p]});c.editDialog.find("sharing").clear();c.editDialog.find("sharing").addOptions(n);c.editDialog.setValues({work_skill_id:b.work_skill_id||0,label:b.label||"",status:"undefined"==typeof b.status||"active"==b.status,sharing:b.sharing,to_resource:parseInt(b.to_resource,
10)||0});if(1===Object.keys(l.form.name).length){for(var s in l.form.name)var t=l.form.name[s].value;c.editDialog.setValues({name:t})}else c.editDialog.setValues(l.form);c.editDialog.open()}})},onSave:function(b){var c=this;b=c.editDialog.forAll("validate");c.editDialog.setErrors(b)||(b=c.editDialog.forAll("getValue"),b.company=c.sandbox.options.company,c.sandbox.trigger("global.data.get",{controller:c.options.serverControllerName,method:"save",params:b,responseHandler:function(b,e){if(e.success)c.editDialog.close(),
c.onChange();else{var n=d.toHtml(e.error)||"Internal error";c.editDialog.setError(n)}}}))},resume:function(c){b.prototype.resume.call(this,c)},suspend:function(c){b.prototype.suspend.call(this,c)}},{})}(toa,$));toa.ns("toa.controllers.WorkSkillsGroupList",function(d,c){var b=d.controllers.config.BaseConfigScreen;return d.define(b,function(){this._create.apply(this,arguments)},{defaultOptions:{itemNameField:"name",itemIdField:"work_skill_id",serverControllerName:"Workskillgroup",securityModuleLabel:"company_settings_work_skill_groups",backButtonLabel:"company_settings_work_skills_list",page:b.prototype.defaultOptions.page},getKeyField:function(){return"work_skill_id"},_createCaptionControls:function(){b.prototype._createCaptionControls.call(this)},
_createGridDiv:function(){this.generateElement("workskill-group-content")},initTranslations:function(){this.defaultOptions.titleLabel=d.glossary({id:12419});this.defaultOptions.entityName=d.glossary({id:12420});this.defaultOptions.searchPlaceholder=d.glossary({id:6364});this.defaultOptions.addDialogTitle=h(6837);this.defaultOptions.editDialogTitle=h(11836)},_init:function(){b.prototype._init.apply(this,arguments);this._initSkillsDialog()},onUpdate:function(d,g){"object"===typeof g.langs&&(this.langs=
g.langs);this.gridDiv.ConfigGrid("updateAttr",this.defaultOptions.titleLabel);b.prototype.onUpdate.apply(this,arguments);c("td:contains('"+this.editSkillsDialog.find("id").getValue()+"')").parent().find('input[type="checkbox"]').focus();app.focusToTheLastSelectedElement&&app.focusToTheLastSelectedElement()},getGroupActionsDescription:function(){return 2==this.options.access?[{name:"delete",title:h(1201),attr:{tabindex:0}},{name:"activate",title:h(10513),attr:{tabindex:0}},{name:"deactivate",title:h(10514),
attr:{tabindex:0}}]:!1},getColumnsDescription:function(){return[{name:"work_skill_id",title:h(1901),colClass:"cell-center",width:"1%",sortable:!0},{name:"name",title:h(68),colClass:"cell-center",modify:2==this.options.access,sortable:!0,format:this.formatOutput.bind(this)},{name:"label",title:h(1645),colClass:"cell-center",sortable:!0,format:this.formatOutput.bind(this)},{name:"status",title:h(1204),colClass:"cell-center",sortable:!0,width:"10%",format:"status"},{name:"skills",title:h(5243),sortable:!1,
width:"50%",modify:2==this.options.access,onModifyClick:this.editSkills.bind(this),format:function(b,c){var k=[],l=c[b.name],n;for(n in l)k.push(l[n].name+"("+l[n].ratio+")");return d.toHtml(k.join("; "))}}]},formatOutput:function(b,c){var k=d.toHtml(c[b.name]);this.searchKey&&(k=k.replace(RegExp(d.escapeRegExp(d.toHtml(this.searchKey)),"gi"),function(b){return'<span class="srch_mngmt">'+b+"</span>"}));return k},getEditDialogFieldsDescription:function(){var b={name:"name",fieldLabel:h(68),allowBlank:!1};
"object"===typeof this.langs&&1===this.langs.count?(b.xtype="input",b.mandatory=!0):(b.xtype="editlist",b.validator=function(b){if(isEmpty(b[1]))return h(11842)});return[{xtype:"hidden",name:"work_skill_id",value:0},b,{xtype:"input",name:"label",fieldLabel:h(1645),allowBlank:!1,vtype:"min3symbol",attr:{maxlength:40}},{xtype:"checkbox",name:"status",fieldLabel:h(30),value:!0},{xtype:"checkbox",name:"to_resource",fieldLabel:h(11827),value:!1},{xtype:"checkbox",name:"to_capacity",fieldLabel:h(11828),
value:!1}]},updateForm:function(b){var c=this;b||(b={});c.editDialog.reset();c.editDialog.forAll("reset");c.sandbox.trigger("global.data.get",{controller:c.options.serverControllerName,method:"editform",params:{work_skill_id:b.work_skill_id||"",company:c.sandbox.options.company},responseHandler:function(d,l){c.editDialog.setValues({work_skill_id:b.work_skill_id||0,label:b.label||"",status:"undefined"==typeof b.status||"active"==b.status,to_resource:parseInt(b.to_resource,10)||0,to_capacity:parseInt(b.to_capacity,
10)||0});if(1===Object.keys(l.form.name).length){for(var n in l.form.name)var p=l.form.name[n].value;c.editDialog.setValues({name:p})}else c.editDialog.setValues(l.form);c.editDialog.open()}})},_initSkillsDialog:function(){var b={xtype:"dialog",title:"Edit skills",layout:"vbox",bottomPanel:{items:[{},{value:h(6413)},{value:h(12)}]},listeners:{ok:this.onSaveSkills.bind(this)},items:[{xtype:"hidden",name:"id"},{xtype:"checkboxtableextended",name:"skills",validateErrorPlaceholders:11840}],attr:{class:"workskills-dialog"}};
this.editSkillsDialog=d.formBuilder(b);this.editSkillsDialog.renderTo(this.gridDiv)},editSkills:function(b,d){var k=this,l=k.rowByRowNum(d.row);k.editSkillsDialog.reset();k.editSkillsDialog.setTitle(h(11835)+": "+l[k.options.itemNameField]);k.editSkillsDialog.find("id").setValue(l.work_skill_id);k.sandbox.trigger("global.data.get",{controller:k.options.serverControllerName,method:"loadskills",params:{work_skill_id:l.work_skill_id,company:k.sandbox.options.company},responseHandler:function(b,d){var e=
[];c.each(d.skills,function(b,c){e[b]={text:c}}.bind(this));k.editSkillsDialog.find("skills").setItemsList(e).setValue(l.skills);k.editSkillsDialog.open()}})},onSaveSkills:function(){var b=this,c=b.editSkillsDialog.find("id").getValue(),d=b.editSkillsDialog.find("skills"),l=d.validate();b.editSkillsDialog.setError(l)||(d=d.getValue(),b.sandbox.trigger("global.data.get",{controller:b.options.serverControllerName,method:"saveskills",params:{id:c,skills:d,company:b.sandbox.options.company},responseHandler:function(c,
d){d.success?(b.editSkillsDialog.close(),b.onChange()):b.editSkillsDialog.setError(d.error||"Internal error")}}))},suspend:function(c){this.editDialog.destroy();b.prototype.suspend.call(this,c)}},{})}(toa,$));toa.ns("toa.controllers.WorkSkillsAssignmentList",function(d,c){var b=d.controllers.config.BaseConfigScreen;return d.define(b,function(){this._create.apply(this,arguments);c("#workskill-conditions-content").find("table.toa-confgrid").attr("aria-label",this.defaultOptions.titleLabel)},{maxCell:5,conditionPanel:null,regexpGetIndex:/.+\[(.+)\]/,assignment_id:null,propertyList:[],propertyValue:[],conditionsType:[],dependencyType:[],index:-1,loadConditionDelay:null,isRecalculationRequest:!1,defaultOptions:{serverControllerName:"Workskillassignment",
securityModuleLabel:"company_settings_work_skill_conditions",backButtonLabel:"company_settings_work_skills_list",page:b.prototype.defaultOptions.page},isClicked:!1,getKeyField:function(){return"assignment_id"},_createCaptionControls:function(){b.prototype._createCaptionControls.call(this)},_createGridDiv:function(){this.generateElement("workskill-conditions-content")},initTranslations:function(){this.defaultOptions.titleLabel=d.glossary({id:12417});this.defaultOptions.entityName=d.glossary({id:12418});
this.defaultOptions.searchPlaceholder=d.glossary({id:6363});this.defaultOptions.addDialogTitle=h(5263);this.defaultOptions.editDialogTitle=h(11837)},_initEditDialog:function(){var b={xtype:"dialog",title:"Edit",layout:"vbox",width:650,listeners:{ok:this.onSave.bind(this)},bottomPanel:{items:[{},{value:h(6413)},{value:h(12)}]},items:[{xtype:"form",name:"editform",layout:"vbox",items:[{xtype:"panel",name:"panelform",layout:"fieldset",items:this.getEditDialogFieldsDescription()},{xtype:"panel",name:"conditionPanel",
layout:"htail",css:{maxHeight:"252px","overflow-y":"auto","padding-right":"20px"},layoutDesc:{maxCell:this.maxCell}},{xtype:"button",value:h(11826),name:"add_condition",addClass:"btn-add-condition",attr:{type:"button"},listeners:{click:this.clickAddCondition.bind(this)}}]}],attr:{class:"workskills-condition-dialog"}};this.editDialog=d.formBuilder(b);this.editDialog.renderTo(this.gridDiv);this.conditionPanel=this.editDialog.find("conditionPanel")},getGroupActionsDescription:function(){return 2==this.options.access?
[{name:"delete",title:h(1201),attr:{tabindex:0}}]:!1},getCaptionActionsDescription:function(){return 2==this.options.access?[{title:h(1954),listeners:{click:this.addNew.bind(this)}}]:!1},getColumnsDescription:function(){var b=[{name:"assignment_id",title:h(1901),width:"1%",sortable:!0,format:this.formatAssignmentId.bind(this)},{name:"name",title:h(11821),colClass:"cell-center",sortable:!0,format:this.formatName.bind(this),rowHeader:!0},{name:"status",title:h(1204),colClass:"cell-center",sortable:!0,
width:"10%",format:"status"},{name:"conditions",colClass:"cell-left",title:h(11823),sortable:!1,width:"50%",format:this.formatConditions.bind(this)}];2===this.options.access&&b.push({name:"actions",title:h(3514),sortable:!1,width:"7%",format:function(b,c){return'<span class="auto-hide" tabindex="-1"></span><span data-work_skill_id="'+c.work_skill_id+'" role="link" class="span_link workskill-modify-link" tabindex="0">'+h(14607)+"</span>"}});return b},onModifyClick:function(b,c){if(2>this.options.access)return!1;
var d=this.gridDiv.ConfigGrid("option","cols")[c.col].name;d!=this.options.itemNameField&&"actions"!=d||this.edit(c.row)},edit:function(b){this.editDialog.setTitle(this.options.editDialogTitle+': "'+d.utils.string.safeDecodeHtmlEntities(this.rowByRowNum(b)[this.options.itemNameField])+'"');this.updateForm(this.rowByRowNum(b))},getEditDialogFieldsDescription:function(){return[{xtype:"hidden",name:"assignment_id",value:0},{xtype:"select",name:"work_skill_id",options:{},fieldLabel:h(5245),allowBlank:!1,
attr:{required:""}},{xtype:"input",name:"required_level",fieldLabel:h(11824),allowBlank:!1,validator:function(b){if(!TypeValidator.isIntUnsigned(b)||100<b||0>b)return h(11840,{"{FIELD_NAME}":this.options.fieldLabel,"{MIN}":0,"{MAX}":100})},attr:{size:5,required:""},vtype:"percent"},{xtype:"input",name:"preferable_level",fieldLabel:h(11825),allowBlank:!1,attr:{size:5,required:""},validator:function(b){if(!TypeValidator.isIntUnsigned(b)||100<b||1>b)return h(11840,{"{FIELD_NAME}":this.options.fieldLabel,
"{MIN}":1,"{MAX}":100})},vtype:"percent"}]},updateForm:function(b){var c=this;b||(b={});c.index=-1;c.assignment_id=b.assignment_id||"";c.editDialog.reset();c.conditionPanel.clear();c.editDialog.forAll("reset");c.isClicked||(c.isClicked=!0,c.sandbox.trigger("global.data.get",{controller:c.options.serverControllerName,method:"editform",params:{assignment_id:c.assignment_id||"",company:c.sandbox.options.company},responseHandler:function(d,l){c.editDialog.find("work_skill_id").clear();c.editDialog.find("work_skill_id").addOptions(c._getOptionItems(l.form.work_skill_id,
!0));c.propertyList=c._getOptionItems(l.form.property);c._getEditDialogFieldsConditions(l.form.conditions);l.form.dependencies&&c._getEditDialogFieldsDependencies(l.form.dependencies);c.conditionPanel.renderChildren(c.conditionPanel.input);c.editDialog.setValues({assignment_id:b.assignment_id||"",work_skill_id:b.work_skill_id||0,required_level:l.form.required_level||0,preferable_level:l.form.preferable_level||1});c.editDialog.open();c.isClicked=!1}}))},onUpdate:function(c,d){d.page&&(this.conditionsType=
d.page.conditionsType,this.dependencyType=d.page.dependencyType,this.conditionsLevels=d.page.conditionsLevels);b.prototype.onUpdate.apply(this,arguments);this.getRecalcultationStatus(c,d)},onSave:function(b,c){var d=this,l,n,p,s,t=c.forAll("getValue"),u=/(.+)\[(.+)\]/,v={};p=c.forAll("validate");n="";for(l in p)n+=p[l]+"<br/>";if(""!==n)d.editDialog.setError(n);else{for(l in t)if(n=l.match(u),null!==n){p=n[1];n=n[2];if("field_desc"==p&&"undefined"!=typeof d.propertyValue[n]&&d.propertyValue[n].id!=
t[l])return;"undefined"===typeof v[p]&&(v[p]=[]);if("value_desc"==p&&"object"===typeof t[l]){n=[];for(s in t[l])!0===t[l][s]&&n.push(s);v[p].push(n.join(","))}else v[p].push(t[l])}else v[l]=t[l];d.sandbox.trigger("global.data.get",{controller:d.options.serverControllerName,method:"save",params:{data:v,company:d.sandbox.options.company},responseHandler:function(b,c){c.success?(d.editDialog.close(),d.onChange()):d.editDialog.setError(c.error||"Internal error")}})}},getRecalcultationStatus:function(b,
c){var d=this;this.isSuspended||("undefined"!==typeof c.work_skill_conditions_recalculation_applied&&this.gridDiv.ConfigGrid("clearMessages"),!1===c.work_skill_conditions_recalculation_applied&&(this.gridDiv.ConfigGrid("setGroupActionMessage",h(10530),"success",!0),this.isRecalculationRequest||(this.isRecalculationRequest=!0,setTimeout(function(){this.isSuspended||d.sandbox.trigger("global.data.get",{controller:d.options.serverControllerName,method:"getRecalculationStatus",responseHandler:function(b,
c){d.isRecalculationRequest=!1;d.getRecalcultationStatus(b,c)}})},5E3))))},_getEditDialogFieldsConditions:function(b){for(var c in b)this.conditionPanel.addItems(this._getItemsCondition(b[c])),this.propertyValue[this.index]=b[c].property},_getEditDialogFieldsDependencies:function(b){var c,d,l;b.property.values=this._getOptionItems(b.property.values);for(c in b)if("property"!=c)for(d in b[c])this._filterInactiveConditions(b.property.values,b[c]),l={condition:c,field:b.property.id,type:b.property.type,
gui:b.property.gui,value:d,property_id:b.property.id,values:b.property.values,property:b.property},this.conditionPanel.addItems(this._getItemsCondition(l)),this.propertyValue[this.index]=l.property},_filterInactiveConditions:function(b,c){for(i in c)var d=i;for(i in b)b[i].id!=d&&"undefined"!=typeof b[i].inactive&&delete b[i]},_filterInactiveDependencies:function(b){for(i in b)"undefined"!=typeof b[i].inactive&&delete b[i]},_getItemsCondition:function(b){var c=this,d;c.index++;b&&(d="property"==b.field?
b.property_id:b.field);return[{xtype:"hidden",name:"condition_id["+c.index+"]",value:b?b.condition_id:0,cell:{addClass:"toa-hidden"}},{xtype:"select",name:"field_desc["+c.index+"]",css:{width:"300px"},attr:{"aria-label":h(22353)},items:c.propertyList,value:d,listeners:{change:c.changeProperty.bind(c),keypress:function(b){clearTimeout(c.loadConditionDelay);c.loadConditionDelay=setTimeout(function(){c.changeProperty(b)},500)}}},{xtype:"select",name:"condition["+c.index+"]",value:b?b.condition:null,
css:{width:"100px"},attr:{"aria-label":h(22354)},items:c._getConditionList(b?b.property:null,b?b.field:null),listeners:{change:function(b){c.changeValueDesc(b.target.name.match(c.regexpGetIndex)[1],null,b.target.value)}}},c._getTypeValue(b?b.property:null,b?b.value:null,c.index,b?b.condition:null),{xtype:"button",name:"delete["+c.index+"]",value:"x",addClass:"btn-delete-condition",attr:{"aria-label":h(17904),type:"button",tabindex:0},listeners:{click:c.clickDeleteCondition.bind(c)}}]},clickAddCondition:function(b){var d=
this.conditionPanel.items.length,k=this._getItemsCondition(null,this.assignment_id);this.propertyValue[this.index]={id:this.propertyList[0].value};this.conditionPanel.addItems(k);for(var l=d;l<d+k.length;l++)this.conditionPanel.renderChild(l,this.conditionPanel.input);this.conditionPanel.input.scrollTop(this.conditionPanel.input.prop("scrollHeight"));c("[name='field_desc["+this.index+"]'").change();b&&b.preventDefault&&b.preventDefault();return!1},clickDeleteCondition:function(b){var d;d=b.target.name.match(this.regexpGetIndex)[1];
b=this.editDialog.find("delete["+d+"]");delete this.propertyValue[d];var k=c.inArray(b,b.parent.items),l=b.parent.items[k].input.parent().parent();for(d=k;d>k-this.maxCell;d--)b.parent.items[d].destroy(!0);l.remove();return!1},changeProperty:function(b){var c=this,d,l=b.target,n=l.name.match(c.regexpGetIndex)[1];d=c.editDialog.find("condition["+n+"]");c.sandbox.trigger("global.data.get",{controller:c.options.serverControllerName,method:"getProperty",params:{id_property:l.value||"",assignment_id:c.assignment_id||
"",company:c.sandbox.options.company},responseHandler:function(b,e){d.clear();"activity_work_skill"==e.property.id&&(e.property.values=c._getOptionItems(e.property.values),this._filterInactiveDependencies(e.property.values));d.addOptions(c._getConditionList(e.property,l.value));c.propertyValue[n]=e.property;c.changeValueDesc(n,null,d.getValue(),!0)}.bind(this)})},changeValueDesc:function(b,c,d,l){var n=null;l=l||!1;var p=this.editDialog.find("value_desc["+b+"]"),n=this._getTypeValue(this.propertyValue[b],
c,b,d);(p.options.xtype!=n.xtype||l)&&this.editDialog.replace("value_desc["+b+"]",n)},_getTypeValue:function(b,c,d,l){var n;b&&("enum"==b.type?n=this._getTypeValueEnum(b,c,d,l):"field"==b.type&&(n=this._getTypeValueField(b,c,d,l)));if("is_null"==l||"is_not_null"==l)n={xtype:"span",name:"value_desc["+d+"]",cell:{addClass:"value_td"},css:{display:"block",width:"149px"}};n||(n={xtype:"input",name:"value_desc["+d+"]",cell:{addClass:"value_td"},css:{width:"149px"},attr:{"aria-label":h(19525)},allowBlank:!1,
value:c});return n},_getTypeValueEnum:function(b,d,k,l){var n=this,p=[],s="",t;if("in"==l||"not_in"==l){d&&(s=d.split(","));for(t in b.values){d=b.values[t];l=""!=s&&0<=c.inArray(""+d.id,s);var u="undefined"===typeof d.inactive||"undefined"!==typeof d.inactive&&!d.inactive;(u||l)&&p.push({id:d.id,label:u?d.text:r(13387,{"{VALUE}":d.text}),value:l})}b={xtype:"multiselect_labeled",name:"value_desc["+k+"]",cell:{addClass:"value_td"},css:{width:"148px"},items:[],validator:function(b){for(t in b)if(!0===
b[t])return!0;return""+(n.options.fieldLabel||"Field")+" can not be empty"},itemsList:p}}else if("contains"==l||"dcontain"==l||"starts_with"==l||"dstart_with"==l)b={xtype:"input",name:"value_desc["+k+"]",cell:{addClass:"value_td"},css:{width:"149px"},allowBlank:!1,value:d};else{for(t in b.values)p.push({xtype:"option",value:b.values[t].id,text:b.values[t].id+". "+b.values[t].text});b={xtype:"select",name:"value_desc["+k+"]",cell:{addClass:"value_td"},css:{width:"149px"},attr:{"aria-label":h(19525)},
value:d,items:p}}return b},_getTypeValueField:function(b,c,d,l){var n;"combobox"==b.gui&&(n=this._getTypeValueEnum(b,c,d,l));return n},_getConditionsLabel:function(b){var d,k,l="";if(0==b.length)return"";for(d in b){l="";if(""!==b[d].value_desc&&"undefined"!=typeof b[d].value_desc[0]&&c.isArray(b[d].value_desc)){for(k in b[d].value_desc)l+=", ",l="undefined"!==typeof b[d].value_desc[k].inactive&&b[d].value_desc[k].inactive?l+h(13387,{"{VALUE}":b[d].value_desc[k].text}):l+b[d].value_desc[k].text;l=
l.substr(2,l.length)}else l=b[d].value;b[d]=this.setBoldText(b[d].field_desc)+" "+this.searchHighlight(this.conditionsType[b[d].condition])+" "+this.wrapDependencies(this.searchHighlight(l))}return b.join("<br/>")+"<br/>"},_getDependenciesLabel:function(b){var c,k,l,n;if(0==b.length)return"";k=[];var p=0;for(c in b){l=[];for(n in b[c]){var s=" "+n+". "+d.utils.string.safeDecodeHtmlEntities(b[c][n])+" ("+d.utils.string.safeDecodeHtmlEntities(this.conditionsLevels[n].required_level)+"/"+d.utils.string.safeDecodeHtmlEntities(this.conditionsLevels[n].preferable_level)+
") ";l.push(s)}l=l.join(", ");s=this.dependencyType[c]+": ";k[p]=this.setBoldText(h(13852))+" "+this.searchHighlight(s)+this.wrapDependencies(this.searchHighlight(l));p++}return k.join("<br/>")},wrapDependencies:function(b){return'<span class="workskill-condition-list">'+b+"</span>"},searchHighlight:function(b){b=d.toHtml(b);return this.searchKey?b.replace(RegExp(d.escapeRegExp(d.toHtml(this.searchKey)),"gi"),function(b){return'<span class="srch_mngmt">'+b+"</span>"}):b},setBoldText:function(b){return'<span class="fb-label">'+
b+"</span>"},_getConditionList:function(b,c){var d=null;if("activity_work_skill"==c)return this._getOptionItems(this.dependencyType);b&&("enum"==b.type||"field"==b.type?d={"in":this.conditionsType["in"],not_in:this.conditionsType.not_in,is_null:this.conditionsType.is_null,is_not_null:this.conditionsType.is_not_null}:"checkbox"==b.gui&&(d={is_null:this.conditionsType.is_null,is_not_null:this.conditionsType.is_not_null}));return this._getOptionItems(d||this.conditionsType)},formatName:function(b,c){var k=
c.name;this.searchKey&&(k=k.replace(RegExp(d.escapeRegExp(d.toHtml(this.searchKey)),"gi"),function(b){return'<span class="srch_mngmt">'+b+"</span>"}));return k},formatConditions:function(b,c){var d=this._getConditionsLabel(c.conditions);return d+=this._getDependenciesLabel(c.dependencies)},formatAssignmentId:function(b,c){var k=c.assignment_id.toString();this.searchKey&&(k=k.replace(RegExp(d.toHtml(this.searchKey),"gi"),function(b){return'<span class="srch_mngmt">'+b+"</span>"}));return k},resume:function(c){this.isSuspended=
0;b.prototype.resume.call(this,c)},_getOptionItems:function(b,c){var d=[];c&&(d=[{text:"",xtype:"option",value:"",label:""}]);for(id in b)if("object"==typeof b[id]){var l={id:b[id].id,text:b[id].text};"undefined"!=typeof b[id].inactive&&(l.inactive=b[id].inactive);d.push(l)}else d.push({xtype:"option",value:id,text:b[id]});return d=d.sort(function(b,c){return b.text.localeCompare(c.text)})},suspend:function(c){this.isSuspended=1;this.editDialog.destroy();b.prototype.suspend.call(this,c)}},{})}(toa,
$));toa.ns("toa.controllers.InventoryTypesList",function(d,c,b){var e=d.controllers.config.BaseConfigScreen;return d.define(e,function(){this._create.apply(this,arguments)},{defaultOptions:{serverControllerName:"Inventorytype",pageLabel:"company_settings_inventory_types_list",securityModuleLabel:"company_settings_inventory_types_list",backButtonLabel:"company_settings_configuration",page:e.prototype.defaultOptions.page},_init:function(){this.modelPropertyError={text:r(7353,{"{TITLE}":h(12672)}),code:"1"};
e.prototype._init.apply(this,arguments)},_createGridDiv:function(){this.generateElement("company_settings_inventory_types_list")},initTranslations:function(){this.defaultOptions.titleLabel=d.glossary({id:14809,type:"raw"});this.defaultOptions.entityName="inventory type";this.defaultOptions.searchPlaceholder=d.glossary({id:6362});this.defaultOptions.addDialogTitle=h(13412);this.defaultOptions.editDialogTitle=h(12683)},getColumnsDescription:function(){return[{name:"type_id",title:h(1901),colClass:"cell-center",
width:"1%",sortable:!0},{name:"name",title:h(68),colClass:"cell-center",modify:2==this.options.access,format:this.formatOutput.bind(this),sortable:!0},{name:"label",title:h(1645),colClass:"cell-center",format:this.formatOutput.bind(this),sortable:!0},{name:"unit",title:h(12668),colClass:"cell-center",sortable:!0,format:this.formatColumn},{name:"model_property_name",title:h(12694),colClass:"cell-center",sortable:!0,format:this.formatColumnModelProperty},{name:"status",title:h(1204),colClass:"cell-center",
sortable:!0,width:"10%",format:"status"},{name:"features",title:h(12693),colClass:"cell-center",sortable:!0,width:"10%",format:function(b,c){if(c.features&2)return'<span role="img" tabindex="0" aria-label="'+h(30)+'" style="display:inline-block" class="green">&nbsp;</span>'}}]},getGroupActionsDescription:function(){return 2==this.options.access?[{name:"activate",title:h(10513)},{name:"deactivate",title:h(10514)}]:!1},getEditDialogFieldsDescription:function(){var c=this,d={name:"name",fieldLabel:h(68),
allowBlank:!1};"object"===typeof c.langs&&1===c.langs.count?(d.xtype="input",d.mandatory=!0,"string"===typeof c.langs.lang&&(d.lang=c.langs.lang)):(d.xtype="editlist",d.validator=function(b){if(isEmpty(b[1]))return h(11842)},d.lang="lang");return[{xtype:"panel",layout:"fieldset",items:[{name:"type_id",xtype:"hidden",value:0},{name:"label",xtype:"input",fieldLabel:h(1645),allowBlank:!1,mandatory:!0},{xtype:"checkbox",name:"status",fieldLabel:h(30)},{xtype:"checkbox",name:"feature_non_serialized",fieldLabel:h(12669),
listeners:{change:this.processNSIfield.bind(this)}},{name:"fractional_quantity",xtype:"checkbox",fieldLabel:h(22408),listeners:{change:this.processFractionalQuantity.bind(this)}},{name:"quantity_precision",xtype:"input",fieldLabel:h(22409),validator:function(d){var e=c.editDialog.find("feature_non_serialized").getElement();if(!b(e).prop("checked"))return!0;e=!0;"string"!==typeof d&&(e=!1);d.length&&""+parseInt(d,10)!==""+d&&(e=!1);if(1>d||5<d)e=!1;if(!e)return h(22410)},attr:{type:"number",min:1,
max:5},listeners:{blur:function(c){c=b(c.target);c.val().length||c.val("1")}}},{xtype:"select",name:"model_property_id",fieldLabel:h(12672),items:[],listeners:{change:function(b){if(""!=b.target.value){b=c.editDialog.find("model_property_error_code");var d=c.editDialog.find("model_property_error_msg");b.setValue(0);d.setValue("")}}}},{xtype:"span",name:"model_property_error_msg",addClass:"fb-invalid"},{xtype:"hidden",name:"model_property_error_code"}]},{xtype:"panel",layout:"hbox",items:[{xtype:"panel",
layout:"fieldset",name:"inv-name",items:[d]},{xtype:"panel",layout:"fieldset",name:"unit-of-measurement",addClass:"unit-of-measurement",items:[{name:"unit",xtype:"editlist",validator:function(c){var d=this.editDialog.find("feature_non_serialized").getElement();if(b(d).is(":checked")&&""===c[1])return h(17023)}.bind(this),fieldLabel:h(12673)}]}]}]},onSave:function(b,c){var d="";c.forAll("getValue").model_property_error_code===this.modelPropertyError.code&&(d+=this.modelPropertyError.text+"<br />");
""!==d?this.editDialog.setError(d):e.prototype.onSave.apply(this,arguments)},onModifyClick:function(c,d){this.selectedInventoryType=b('tr[data-row="'+d.row+'"]').find('td[data-col="0"]').text();e.prototype.onModifyClick.apply(this,arguments)},formatOutput:function(b,c){var e=d.toHtml(c[b.name]);this.searchKey&&(e=e.replace(RegExp(d.escapeRegExp(d.toHtml(this.searchKey)),"gi"),function(b){return'<span class="srch_mngmt">'+b+"</span>"}));return e},formatColumn:function(b,c){return d.toHtml(c[b.name])},
formatColumnModelProperty:function(b,c){return!0===c.model_property_error?'<span class="hide-mass-action fb-invalid">'+r(7353,{"{TITLE}":h(12672)})+"</span>":d.toHtml(c[b.name])},modifyEditDialogDescription:function(b){b.width=800},resetForm:function(){this.editDialog.reset();this.editDialog.forAll("reset")},updateForm:function(b){var c=this;b||(b={});c.resetForm();c.sandbox.trigger("global.data.get",{controller:c.options.serverControllerName,method:"editform",params:{type_id:b.type_id||""},responseHandler:function(d,
e){c.resetForm();var p=c.editDialog.find("model_property_id");p&&(p.clear(),p.addOptions(c.propertyListToSelectOptions(e.lookup_model_property_id)));c.editDialog.setValues({type_id:b.type_id||0,label:b.label||""});if(1===Object.keys(e.form.name).length){for(var s in e.form.name)var t=e.form.name[s].value;e.form.name=t}c.editDialog.setValues(e.form);b.type_id?p.disable():p.enable();b.type_id&&null!==e.form.model_property_id&&null===e.form.model_property_label&&(s=c.editDialog.find("model_property_error_msg"),
t=c.editDialog.find("model_property_error_code"),s.setValue(c.modelPropertyError.text),t.setValue(c.modelPropertyError.code),p.enable());c.editDialog.open();c.processNSIfield()}})},processFractionalQuantity:function(){var c=this.editDialog.find("feature_non_serialized").getElement(),d=this.editDialog.find("fractional_quantity").getElement(),e=this.editDialog.find("quantity_precision").getElement(),c=b(c).prop("checked"),n=b(d).prop("checked");c?(b(d).closest(".fb-tr").show(),n?b(e).closest(".fb-tr").show():
b(e).closest(".fb-tr").hide()):(b(d).closest(".fb-tr").hide(),b(e).closest(".fb-tr").hide())},processNSIfield:function(){var c=this.editDialog.find("feature_non_serialized").getElement(),d=this.editDialog.find("unit-of-measurement").getElement();d&&(b(c).prop("checked")?(b(d).show(),1==this.langs.count?this.editDialog.find("inv-name").getElement().addClass("inv-name"):this.editDialog.find("inv-name").getElement().removeClass("inv-name")):b(d).hide());this.processFractionalQuantity()},propertyListToSelectOptions:function(b){var c=
[];c.push({xtype:"option",value:null,text:""});for(var d in b)b.hasOwnProperty(d)&&c.push({xtype:"option",value:d,text:b[d]});c.sort(function(b,c){return b.text.localeCompare(c.text)});return c},toString:function(){return"InventoryTypesList"},getKeyField:function(){return"type_id"},onUpdate:function(c,k){var l=this;"object"===typeof k.langs&&(this.langs=k.langs);this.gridDiv.ConfigGrid("updateAttr",d.glossary({id:14809,type:"raw"}));e.prototype.onUpdate.apply(this,arguments);b("td:contains('"+l.selectedInventoryType+
"')").filter(function(b,c){return c.textContent===l.selectedInventoryType}).parent().find('input[type="checkbox"]').focus();app.focusToTheLastSelectedElement&&app.focusToTheLastSelectedElement()}},{})}(toa,toa.view.control,$));(function(d){d.ns("toa.controllers.Themes",d.define(d.Controller,function(){this._create.apply(this,arguments);this.menus={}},{screenTpl:['<div class="toa-themes-screen" id="toa-themes-screen" data-ofsc-role="entity-list" data-ofsc-entity="ofsc-theme-list"></div>'],access:1,redwoodThemeColors:{bgColor:"#34302E",bgPage:"#FCFBFA",bgSubmit:"#588757"},toString:function(){return"Themes"},_create:function(c){this.sandbox=c;this.options=this.sandbox.options;this.container=$((new d.Template(this.screenTpl)).apply({}));
this.grid=new d.ui.Grid(this.container,new d.ui.TemplateSimpleGrid,{grid:"theme-grid",table:"theme-table",content:"theme-content",row:"theme-item",cell:"theme-cell"});this.grid.setTemplate("container",(new d.Template(['<div class="theme-grid"><div class="theme-table"><%=contentHtml%></div></div>'])).compile());this.grid.setTemplate("content",(new d.Template(['<div class="theme-section-title">'+h(24262)+'</div><div class="theme-content"><%=contentHtml%></div>'])).compile());this.grid.setTemplate("cell",
(new d.Template(['<div class="theme-cell"><%=value%></div>'])).compile());this.grid.setTemplate("row",(new d.Template(['<div class="theme-item" data-id="<%-id%>" data-ofsc-role="list-item" data-ofsc-entity="ofsc-theme" data-ofsc-entity-id="<%-id%>"><%=cells%></div>'])).compile());this.themeImport=new d.themes.themeImport;this.themeImport.addListener("submitForm",this.submitThemeImport.bind(this));this.triggerFunction=c.trigger.bind(c);var b=document.head,e=document.createElement("link");e.rel="stylesheet";
e.id="jet-alta-style3";e.href="https://www.oracle.com/webfolder/technetwork/jet/css/samples/cookbook/demo.css";b.insertBefore(e,b.firstElementChild);e=document.createElement("link");e.rel="stylesheet";e.id="jet-alta-style2";e.href="https://www.oracle.com/webfolder/technetwork/jet/css/samples/site/demo-alta-site-min.css";b.insertBefore(e,b.firstElementChild);this.resume(c.options)},resume:function(){this.options.content.append('<div class="themes-header"></div><div class="themes-screen"></div>');this.content=
$(this.options.content.find(".themes-screen").get(0));this.triggerFunction("layout.menu.changeTitle",{label:"company_settings_themes",url:"",name:_DATA.glossary.action_links.company_settings_themes,params:{}});this.content.append(this.container);this.sandbox.trigger("global.data.get",{controller:"themes",method:"get",params:{},responseHandler:function(c,b){this.access=b.access;this._createContent(b.grid);this._createCaption()}.bind(this)});this.sandbox.trigger("layout.tabs.set",{tabs:0,show:0});this.initWmtModels()},
initRedwoodThemeColors:function(){this.redwoodThemeColors={bgColor:this.redwoodThemeColors.bgColor,bgPage:this.redwoodThemeColors.bgPage,bgSubmit:this.redwoodThemeColors.bgSubmit}},initWmtModels:function(){this.serverConnector=new d.wmtTheme.ServerConnector(this.triggerFunction,"wmttheme");this.wmtThemeScreenMapper=new d.wmtTheme.dataMappers.WmtThemeScreenDataMapper(this.serverConnector);this.wmtThemeScreenModel=this.wmtThemeScreenMapper.create();this.wmtThemeListMapper=new d.wmtTheme.dataMappers.WmtThemeListDataMapper(this.serverConnector);
this.wmtThemeListCollection=this.wmtThemeListMapper.create();this.wmtThemeMapper=new d.wmtTheme.dataMappers.WmtThemeDataMapper(this.serverConnector);$.when(this.loadScreen(),this.loadWmtThemeList()).done(function(){this.initWmtViews();this.wmtThemeScreenModel.get("isWmtThemesFeatureAvailable")&&(this.showInitialViews(),this.showWmtThemeList())}.bind(this)).fail(function(c){this.sandbox.error(c);this.showError(h(24257))}.bind(this))},initWmtViews:function(){this.wmtContainerView=new d.views.themes.WmtThemesContainer;
this.wmtContainerView.addListener("wmtTheme:add",this.onWmtThemeAdd.bind(this));this.wmtThemeListView=new d.views.themes.WmtThemesList({readOnlyMode:1===this.access,collection:this.wmtThemeListCollection,newItemView:2===this.access?d.views.themes.WmtThemeListNewItem:null});this.wmtThemeListView.addListener("wmtTheme:add",this.onWmtThemeAdd.bind(this));this.wmtThemeListView.addListener("wmtTheme:selected",this.onWmtThemeSelected.bind(this));this.wmtThemeListView.addListener("wmtTheme:set_default",
this.onWmtThemeSetDefault.bind(this));this.wmtThemeListView.addListener("wmtTheme:remove",this.onWmtThemeDelete.bind(this))},loadScreen:function(){return this.wmtThemeScreenMapper.load(this.wmtThemeScreenModel)},loadWmtThemeList:function(){return this.wmtThemeListMapper.load(this.wmtThemeListCollection)},showInitialViews:function(){this.wmtThemesScreen=$('<div class="wmt-themes-screen" data-ofsc-role="entity-list" data-ofsc-entity="wmt-theme-list"></div>');this.content.append(this.wmtThemesScreen);
this.wmtContainerView.render(this.wmtThemesScreen)},showWmtThemeList:function(){this.wmtContainerView.showRegion("themesList",this.wmtThemeListView)},_toggleExportButtonDependOnCustomThemeExists:function(){$("#theme_export").toggleClass("hidden",!this.customThemeExists())},suspend:function(){this.destroy()},destroy:function(){this.wmtThemesScreen&&this.wmtThemesScreen.empty();this.grid.destroy();this.panel.getElement().detach();this.container.detach()},showError:function(c,b){c=c||h(20637);b=b||h(5651);
return this.showPopup(b,c)},customThemeExists:function(){return this.dataTable.getRows().some(function(c){return c.get("custom")})},isRollerBorderNeeded:function(c){return d.views.themes.WmtThemeListItem.prototype.isRollerBorderNeeded(c)},_createContent:function(c){var b=[];this.menus=[];this.dataTable=new d.models.DataTable(c);b.push({id:"name",label:"",rowHeader:!0,allowHtml:!0,cellFormatter:function(b,c){return parseInt(c.get("custom"))&&parseInt(c.get("custom"))?'<div class="theme-name theme-name--clickable">'+
b+"</div>":'<div class="theme-name ">'+b+"</div>"}});2===this.access&&b.push({id:"actions",label:h(11925),allowHtml:!0,headClassName:"actionsHead",cellFormatter:function(b,c){this.menus[c.id]=[];parseInt(c.get("custom"))&&parseInt(c.get("custom"))&&this.menus[c.id].push("modify");!1===c.get("default")&&this.menus[c.id].push("set-default");parseInt(c.get("active"))?!1===c.get("default")&&this.menus[c.id].push("set-disable"):this.menus[c.id].push("set-enable");parseInt(c.get("custom"))&&(this.menus[c.id].push("link--export"),
!1===c.get("default")&&this.menus[c.id].push("delete"));return this.menus[c.id].length?'<div class="theme-menu-button" data-id="'+c.id+'"></div>':""}.bind(this)});b.push({id:"color",label:"",rowHeader:!0,allowHtml:!0,cellFormatter:function(b){return b&&this.isRollerBorderNeeded(b)?'<div class="theme-color theme-color--with-border" style="background-color: '+b+';"></div>':'<div class="theme-color" style="background-color: '+b+';"></div>'}.bind(this)});b.push({id:"default",label:h(11923),allowHtml:!0,
cellFormatter:function(b){if(!0===b)return'<div class="theme-is-default">'+h(11923)+"</div>"}});b.push({id:"active",label:h(11924),allowHtml:!0,cellFormatter:function(b){if(0===b)return'<div class="theme-is-inactive">'+h(24263)+"</div>"}});this.grid.setDataSource(this.dataTable);this.grid.setColumns(b);this.grid.draw();this._renderMenus();this._renderAddNewItem();this.initRedwoodThemeColors()},_renderMenus:function(){var c=1===this.access;Object.keys(this.menus).forEach(function(b){var e=[];this.menus[b].length&&
(this.menus[b].forEach(function(b){switch(b){case "delete":if(c)break;e.push({name:"delete",addClass:"toa-dropdown-item theme-link theme-link--"+b,attr:{"aria-label":h(11963),"aria-labelledby":h(11963),tabindex:0},text:h(11963)});break;case "modify":if(c)break;e.push({name:"modify",addClass:"toa-dropdown-item theme-link theme-link--"+b,attr:{"aria-label":h(13221),"aria-labelledby":h(13221),tabindex:0},text:h(13221)});break;case "set-default":if(c)break;e.push({name:"set-default",addClass:"toa-dropdown-item theme-link theme-link--"+
b,attr:{"aria-label":h(11919),"aria-labelledby":h(11919),tabindex:0},text:h(11919)});break;case "set-disable":if(c)break;e.push({name:"set-disable",addClass:"toa-dropdown-item theme-link theme-link--"+b,attr:{"aria-label":h(11920),"aria-labelledby":h(11920),tabindex:0},text:h(11920)});break;case "set-enable":if(c)break;e.push({name:"set-enable",addClass:"toa-dropdown-item theme-link theme-link--"+b,attr:{"aria-label":h(11921),"aria-labelledby":h(11921),tabindex:0},text:h(11921)});break;case "export":e.push({name:"export",
addClass:"toa-dropdown-item theme-link theme-link--"+b,attr:{"aria-label":h(14622),"aria-labelledby":h(14622),tabindex:0},text:h(14622)})}}),this.menuButton=d.view.control.create({xtype:"button.Menu",name:"formMenuButton",text:"formMenuButton",addClass:"toa-item-menu-button",attr:{"aria-haspopup":"true","aria-label":"formMenuButton","aria-labelledby":"formMenuButton"},icon:"toa-item-menu-icon",menuItems:e,listeners:{menuItemClick:this.clickAction.bind(this,b)}}),this.menuButton.render($(document).find(".theme-menu-button[data-id="+
b+"]")))}.bind(this));$(".toa-themes-screen .theme-item .theme-name--clickable").on("click",this.clickEdit.bind(this))},_renderAddNewItem:function(){2===this.access&&(this.themeNewItemView=new d.views.themes.ThemeListNewItem,this.themeNewItemView.addListener("theme:add",this.onClickCreateNewTheme.bind(this)),this.themeNewItemView.render(this.grid.content,!0))},_createCaption:function(){var c;c=[];this.customThemeExists()&&c.push({xtype:"Button",label:h(11956),id:"theme_export",name:"theme_export",
listeners:{click:function(){this.sandbox.trigger("global.data.get",{controller:"themes",method:"get",responseHandler:function(b,c){this.access=c.access;2===this.access||1===this.access?exportRequest({controller:"themes",method:"exportThemes"}):d.ui.Alert({text:h(5516)})}.bind(this)})}.bind(this)}});2===this.access&&c.push({xtype:"Button",label:h(11955),id:"theme_import",name:"theme_import",listeners:{click:function(){this.themeImport.render()}.bind(this)}});c={xtype:"PanelTitleAlta",addClass:"jet-css-only toa-panel-title jet-screen-title panel-title-themes",
name:"title",titleText:h(11934),resourceTreeButton:!1,backButton:!0,backButtonIcon:"",headerResponsive:_DATA.page_label,backButtonLabel:_DATA.glossary.action_links.company_settings_configuration,backButtonHint:h(16257),filter:!1,calendar:!1,listeners:{backButtonClick:function(){$app.navigation().redirect("company_settings_configuration")}},actions:c};c=d.view.control.create(c);c.render(this.options.content.find(".themes-header").get(0));this.panel=c},_reloadGrid:function(c){this.dataTable.updateData(c);
this.grid.draw();this._renderMenus();this._renderAddNewItem();this._toggleExportButtonDependOnCustomThemeExists()},responseImportTheme:function(c,b){b.errorForm?this.themeImport.setErrorMessages(b.errorForm):(this.themeImport.closeForm(),this._reloadGrid(b.grid))},setContent:function(c){this.currentContent&&this.currentContent.detach();this.options.content.append(c);this.currentContent=c},clickEdit:function(c){c=$(c.target).parents(".theme-item").data("id");this.onEditTheme(c)},onEditTheme:function(c){c=
this.dataTable.getRow(c);d.app.trigger("layout.menu.click",{label:"company_settings_theme_editor",url:"",name:h(11934)+" - "+h(11933),params:{themeData:{id:c.getId(),name:c.get("name"),bgColor:c.get("color"),bgPage:c.get("bg_page"),bgSubmit:c.get("bg_submit"),copyright:c.get("copyright"),bigLogo:c.get("big_logo")},dataTable:this.dataTable,isReadOnly:1===this.access}})},clickAction:function(c,b,e){if(e.name)switch(e.rowId=c,e.name){case "modify":this.onEditTheme(e.rowId);break;case "set-default":var g=
this;this.popUp=new d.ui.Popup({title:d.glossary({id:13294}),autoOpen:!1,html:d.glossary({id:15307}),modal:!0,onClose:function(){this.destroy()},buttons:[{text:d.glossary({id:14621}),click:function(){this.destroy()}},{type:"submit",text:d.glossary({id:15309}),click:function(){g.popUpOnClick(e,1)}},{type:"submit",text:d.glossary({id:15310}),click:function(){g.popUpOnClick(e,0)}}]});this.popUp.show();break;case "set-enable":this.sandbox.trigger("global.data.get",{controller:"themes",method:"enable",
params:{theme_id:e.rowId},responseHandler:function(b,c){this._reloadGrid(c.grid)}.bind(this)});break;case "set-disable":this.sandbox.trigger("global.data.get",{controller:"themes",method:"disable",params:{theme_id:e.rowId},responseHandler:function(b,c){this._reloadGrid(c.grid)}.bind(this)});break;case "export":post({params:{theme_id:e.rowId},controller:"themes",method:"export"});break;case "delete":this.openPopUpDelete(e)}},popUpOnClick:function(c,b){var e=this.dataTable.getRow(c.rowId),g=this.dataTable.getRows().length-
1;this.sandbox.trigger("global.data.get",{controller:"themes",method:"setDefault",params:{theme_id:c.rowId,apply_to_all:b},responseHandler:function(c,l){this._reloadGrid(l.grid);this.popUp.destroy();1===d.currentInterface?1===b&&$.each(this.dataTable.getRows(),function(b,c){var k=$("body");k.removeClass(c.attributes.label);b===g&&(k.addClass(e.attributes.label),d.view.Header.mainMenu.resetMainMenuThemeParams(),d.view.Header.mainMenu.controlLogoDisplay(),d.view.Header._initUserAvatar("#header .toa-header-usermenu"),
d.view.Header._initVerticalMainMenu("body"),d.view.Header.userMenu.destroy(),d.view.Header.userMenu.render())}):3===d.currentInterface&&d.app.trigger("configuration.theme.changed")}.bind(this),errorHandler:function(){this.popUp.destroy()}.bind(this)})},openPopUpDelete:function(c){var b=this;this.popUpDelete=new d.ui.Popup({title:d.glossary({id:13294}),autoOpen:!1,html:d.glossary({id:16504}),modal:!0,onClose:function(){this.destroy()},buttons:[{text:d.glossary({id:14621}),click:function(){this.destroy()}},
{type:"submit",text:d.glossary({id:11963}),click:function(){b.sandbox.trigger("global.data.get",{controller:"themes",method:"delete",params:{theme_id:c.rowId},responseHandler:function(c,d){b._reloadGrid(d.grid);b.popUpDelete.destroy()}.bind(b)})}}]});this.popUpDelete.show()},submitThemeImport:function(c,b){this.sandbox.trigger("global.data.get",{controller:"themes",method:"import",params:{importTheme:b},responseHandler:this.responseImportTheme.bind(this)})},onClickCreateNewTheme:function(){d.app.trigger("layout.menu.click",
{label:"company_settings_theme_editor",url:"",name:h(11934)+" - "+h(11932),params:{themeData:{},dataTable:this.dataTable}})},onWmtThemeAdd:function(){if(this.wmtThemeScreenModel.get("isWmtThemesFeatureLimitAvailable")){var c=this.wmtThemeMapper.create({label:"",description:"",template_label:d.views.wmtTheme.ServiceManifests.availableThemes[0],content:d.views.wmtTheme.ServiceManifests.initialThemesData[d.views.wmtTheme.ServiceManifests.availableThemes[0]].content}),b=d.create("toa.views.themes.WmtAddForm",
{model:c});b.addListener("wmtAddform:submitted",this.onClickAddWmtButton.bind(this,b,c));var e=new d.ui.Popup({title:h(24258),autoOpen:!0,view:b,modal:!0,buttons:[{text:h(290),position:"left",click:function(){e.destroy()}},{id:"addButton",text:"Add",position:"right",type:"submit",click:this.onClickAddWmtButton.bind(this,b,c)}]})}else this.showPopup(h(24258),h(24062))},onWmtThemeDelete:function(c,b,e){var g,k=this.wmtThemeMapper.create({label:e});g=new d.ui.Popup({title:h(13294),autoOpen:!0,html:h(16504),
modal:!0,buttons:[{text:h(290),position:"left",click:function(){g.destroy()}},{id:"deleteButton",text:h(445),type:"submit",position:"right",click:function(){g.disableButton("deleteButton");this.wmtThemeMapper.remove(k).done(function(){g.destroy();this.loadWmtThemeList().then(function(){this.showWmtThemeList()}.bind(this))}.bind(this)).fail(function(b){this.sandbox.error(b);g.destroy();switch(b){case 94:b=h(20556);break;default:b=h(24261)}this.showError(b).always(function(){this.loadWmtThemeList().then(function(){this.showWmtThemeList()}.bind(this))}.bind(this))}.bind(this))}.bind(this)}]})},
onWmtThemeSetDefault:function(c,b,e){var g,k=this.wmtThemeMapper.create({label:e});g=new d.ui.Popup({title:h(13294),autoOpen:!0,html:h(24283),modal:!0,buttons:[{id:"setDefaultButton",text:h(445),type:"submit",position:"right",click:function(){g.disableButton("setDefaultButton");this.wmtThemeMapper.setDefault(k).done(function(){g.destroy();this.loadWmtThemeList().then(function(){this.showWmtThemeList()}.bind(this))}.bind(this)).fail(function(b){this.sandbox.error(b);g.destroy();switch(b){case 94:b=
h(20556);break;default:b=h(24281)}this.showError(b).always(function(){this.loadWmtThemeList().then(function(){this.showWmtThemeList()}.bind(this))}.bind(this))}.bind(this))}.bind(this)}]})},onWmtThemeSelected:function(c,b,d){this.openWmtThemeDetails(d)},openWmtThemeDetails:function(c){d.app.trigger("layout.menu.click",{label:"company_settings_wmt_theme",url:"",name:"",params:{readOnlyMode:1===this.access,themeLabel:c,onClose:function(){d.app.trigger("layout.menu.click",{label:"company_settings_themes",
url:"",name:""})}}})},onClickAddWmtButton:function(c,b,d){var g=d.popup;if(!c.validate())return!1;g.disableButton("addButton");this.wmtThemeMapper.save(b).done(function(){g.destroy();this.openWmtThemeDetails(b.get("label"))}.bind(this)).fail(function(b){switch(b){case 94:b=h(20556);g.destroy();this.showError(b);return;case 79:b=h(24268);break;case 111:b=h(24062);break;default:b=h(24269)}g.setErrors([{id:"errorWhileSaving",message:b}]);g.enableButton("addButton")}.bind(this))}}))})(toa);(function(d){var c=d.Controller,b={MIN_WIDTH:20,MAX_WIDTH:200,MIN_HEIGHT:20,MAX_HEIGHT:80},e={MIN_WIDTH:20,MAX_WIDTH:320,MIN_HEIGHT:20,MAX_HEIGHT:110},g=function(b){return{validate:function(c,d){var e=new Image;e.onload=function(){var c=this.width,e=this.height;d(c>=b.MIN_WIDTH&&c<=b.MAX_WIDTH&&e>=b.MIN_HEIGHT&&e<=b.MAX_HEIGHT)};c?e.src=c:d(!1)}}};d.ns("toa.controllers.ThemeEditor",d.define(c,function(b){this.sandbox=b;this.pageLabel=this.sandbox.name;this.content=b.options.content;this.triggerFunction=
b.trigger.bind(b);this.resume(b.options)},{resume:function(b){this.themeData=b.params.themeData;this.isReadOnly=b.params.isReadOnly;this.dataTable=b.params.dataTable;this.triggerFunction("layout.tabs.set",{tabs:0,show:0});this.createPanelTitle();this.initViews();this.showInitialViews()},initViews:function(){this.themeEditorView=new d.views.themes.ThemeEditor(this.themeData,this.isReadOnly);this.themeEditorView.addListener("submitForm",this.submitForm.bind(this));this.themeEditorView.addListener("dismiss",
this.goToThemesScreen.bind(this))},showInitialViews:function(){this.screen=$('<div id="toa-theme-editor-screen" class="jet-css-only"></div>');this.content.addClass("contains-theme-editor").append(this.screen);this.themeEditorView.render(this.screen)},goToThemesScreen:function(){d.app.trigger("layout.menu.click",{label:"company_settings_themes",url:"",name:_DATA.glossary.action_links.company_settings_themes,params:{}})},createPanelTitle:function(){this.panel=d.view.control.create({xtype:"PanelTitleAlta",
addClass:"jet-css-only toa-panel-title jet-screen-title panel-title-theme-editor-settings",name:"titleCaption",titleText:this.themeData.id?h(11933):h(11932),resourceTreeButton:!1,backButton:!0,backButtonIcon:"",headerResponsive:_DATA.page_label,backButtonLabel:_DATA.glossary.action_links.company_settings_themes,backButtonHint:h(16257),filter:!1,calendar:!1,listeners:{backButtonClick:this.goToThemesScreen.bind(this)}});this.panel.render(this.content)},submitForm:function(b,c){this.validateForm(c,this.onSuccessValidation.bind(this))},
onSuccessValidation:function(b){b.custom=1;this.sandbox.trigger("global.data.get",{controller:"themes",method:0<parseInt(b.theme_id)?"update":"insert",params:{form:b},responseHandler:this.responseUploadForm.bind(this)})},validateForm:function(c,d){var n=[],p=this,s=g(b),t=g(e);s.validate(c.bigLogo,function(b){t.validate(c.loginLogo,function(e){""===c.name?n.push({message:h(11936,{"{THEME_NAME}":h(226021)}),inputElement:p.themeEditorView.name}):c.name.match(/^[a-z0-9\s]+$/i)?p.themeExists(c)&&n.push({message:h(11960),
inputElement:p.themeEditorView.name}):n.push({message:h(11937,{"{THEME_NAME}":h(226021)}),inputElement:p.themeEditorView.name});""===c.copyright?n.push({message:h(11941,{"{THEME_COPYRIGHT}":h(11928)}),inputElement:p.themeEditorView.copyright}):c.copyright.match(/{YEAR}/)||n.push({message:h(11942,{"{THEME_COPYRIGHT}":h(11928)}),inputElement:p.themeEditorView.copyright});c.bigLogo?("data:image/png"!==c.bigLogo.substring(0,14)&&n.push({message:h(11961,{"{LOGO_TYPE}":h(226022)}),inputElement:p.themeEditorView.bigFile}),
51200<p.themeEditorView.bigFile.getFileSize()?n.push({message:h(11964,{"{LOGO_TYPE}":h(226022),"{SIZE}":50+h(16289)}),inputElement:p.themeEditorView.bigFile}):b||n.push({message:h(11959,{"{LOGO_TYPE}":h(226022)}),inputElement:p.themeEditorView.bigFile})):c.theme_id||n.push({message:h(11944,{"{LOGO_TYPE}":h(226022)}),inputElement:p.themeEditorView.bigFile});c.loginLogo?("data:image/png"!==c.loginLogo.substring(0,14)&&n.push({message:h(11961,{"{LOGO_TYPE}":h(226024)}),inputElement:p.themeEditorView.loginFile}),
51200<p.themeEditorView.loginFile.getFileSize()?n.push({message:h(11964,{"{LOGO_TYPE}":h(226024),"{SIZE}":50+h(16289)}),inputElement:p.themeEditorView.loginFile}):e||n.push({message:h(11959,{"{LOGO_TYPE}":h(226024)}),inputElement:p.themeEditorView.loginFile})):c.theme_id||n.push({message:h(11944,{"{LOGO_TYPE}":h(226024)}),inputElement:p.themeEditorView.loginFile});""===c.bgColor?n.push({message:h(226015),inputElement:p.themeEditorView.bgColor}):c.bgColor.match(/^#[a-f0-9]{6}$/i)||n.push({message:h(226016),
inputElement:p.themeEditorView.bgColor});""===c.bgSubmit?n.push({message:h(226018),inputElement:p.themeEditorView.bgSubmit}):c.bgSubmit.match(/^#[a-f0-9]{6}$/i)||n.push({message:h(226016),inputElement:p.themeEditorView.bgSubmit});""===c.bgPage?n.push({message:h(226017),inputElement:p.themeEditorView.bgPage}):c.bgPage.match(/^#[a-f0-9]{6}$/i)||n.push({message:h(226016),inputElement:p.themeEditorView.bgPage});0===n.length?d(c):p.themeEditorView.showErrors(n)})})},responseUploadForm:function(b,c){c.errorForm&&
this.themeEditorView.setErrorMessages(c.errorForm);c.grid&&this.goToThemesScreen()},themeExists:function(b){return this.dataTable.getRows().some(function(c){return c.get("name")===b.name&&b.theme_id!==c.getId()})},suspend:function(b){this.content.removeClass("contains-theme-editor");this.themeEditorView.destroy();c.prototype.suspend.call(this,b)}}))})(toa);toa.ns("toa.controllers.ConfigGlossaryList",function(d,c){var b=d.controllers.config.BaseConfigScreen;return d.define(b,function(){this._create.apply(this,arguments)},{defaultOptions:{serverControllerName:"CompanySettingsGlossary",pageLabel:"company_settings_glossary_list",securityModuleLabel:"company_settings_glossary_list",backButtonLabel:"company_settings_configuration",page:b.prototype.defaultOptions.page},_createGridDiv:function(){this.wholeData=[];this.langOfEmptyRecords="";this.generateElement("company_settings_glossary_list");
var b=c("<form/>").attr({class:"jet-css-only",id:"company_settings_glossary_list_form",method:"post",onsubmit:"return false",action:"?controller=CompanySettingsGlossary&method=list",autocomplete:"off"});this.gridDiv.append(b);this.gridDiv=this.gridDiv.find("form")},initTranslations:function(){this.defaultOptions.titleLabel=d.glossary({id:19407,type:"raw"});this.defaultOptions.entityName="glossary list";this.defaultOptions.searchPlaceholder=""},getColumnSwapList:function(){var b=[];if(!this.wholeData||
0==this.wholeData.length)return null;for(var c=0;c<this.activeLanguages.length;c++){var d={},l=this.activeLanguages[c]._id;d.id=l;d.name=this.allLanguages[l];-1!=this.languageIds.indexOf(parseInt(l))?d.inactive=!0:d.inactive=!1;b.push(d)}return b},getGroupActionsDescription:function(){return!1},getColumnsDescription:function(){var b=this,g=[{name:"category",title:h(207),colClass:"cell-left category-name",headClass:"cell-left",format:b.formatSearchOutput.bind(b),width:"3%",sorting:!1,rowHeader:!1},
{name:"label",title:h(19448),colClass:"cell-left row-Header-No-Style",headClass:"cell-left",format:b.formatSearchOutput.bind(b),width:"3%",sorting:!1,rowHeader:!0}],k=[];if(0!==b.wholeData.length&&b.languageIds)for(var l=b.languageIds,n=b.wholeData.page.missingEntries,p=0;p<l.length;p++){var s={},t="";0!==n[l[p]]&&(t=d.glossary({id:19913}).replace("{ITEMS}",'<span class="dasboard-number">'+n[l[p]]+"</span>"));s.name="custom_"+l[p];s.title=d.toHtmlSafe(b.allLanguages[l[p]]);s.width="5%";s.format=b.formatOutput.bind(b);
s.sorting=!1;s.swapColumn=2<b.activeLanguages.length?!0:!1;s.id=l[p];s.headClass="cell-left";s.colClass="cell-left";s.items=[{html:'<div class="dashboardData" role="button">'+t+"</div>",events:{click:function(d){d.stopPropagation();if(c(d.target).hasClass("dashboard-number-completed"))return!1;var g=b.gridDiv.ConfigGrid("getPageState");g.empty_lid=c(d.target).closest("th").attr("data-id");b.langOfEmptyRecords=g.empty_lid;b.onChange({},g)}.bind(b)}}];k.push(s)}return g.concat(k)},formatSearchOutput:function(b,
c){var k=d.toHtml(c[b.name]);return this.getSearchFormatStr(k)},getSearchFormatStr:function(b){re=/(\(.*\))/i;b.match(re)&&(b=b.replace(re,'<span class="multi-label-grey">$1</span>'));this.searchKey&&(b=b.replace(RegExp(d.escapeRegExp(d.toHtml(this.searchKey)),"gi"),function(b){return'<span class="srch_mngmt">'+b+"</span>"}));return b},formatOutput:function(b,g){var k=this,l=c.trim(g[b.name.replace("custom","original")])||"",n=c.trim(g[b.name])||l,p=b.name.replace("custom_","");if(2!=k.options.access)return g.context_item&&
(n=this.getCustomText(g,b,p)),n=k.getSearchFormatStr(d.toHtmlSafe(n)),n=c("<span>"+n+"</span>"),n.attr("data-original",l),n.on("mousemove",function(b){var e=d.toHtmlSafe(c(this).attr("data-original"));e&&show_hint({event:b,html:'<div class="normal_">'+k.getSearchFormatStr(d.glossary({id:19912}).replace("{ORIGINAL_TEXT}",e))+"</div>"})}),n;if(g.context_item){if(!c.isEmptyObject(g.uts_custom)){var s=g.uts_custom[p],t=[];n&&t.push(n);for(var u in s)Object.keys(s[u]).map(function(b){t.push(s[u][b])});
n=t.filter(function(b,c,d){return d.indexOf(b)===c}).join(", ")}var l=n=this.getCustomText(g,b,p)||n,v=c('<a class="modify-icon" data-lang="'+p+'" data-item-code="'+g.item_code+'" alt="'+h(14607)+'"></a>');v.on("click",function(){k.initMultiselect(c(this))})}var w="";k.allLanguagesLabels&&(w=k.allLanguagesLabels[p]?k.allLanguagesLabels[p]:"");p=c('<input type="text" maxlength="255" name="'+g.item_code+"_"+p+'">').attr({value:n,placeholder:l,lang:w,"aria-label":h(22358)});l||n||(p=p.addClass("highlighter"));
p.on("blur",function(){k.addHighlighter(this);""==c(this).val()&&""!==c(this).attr("placeholder")&&c(this).val(c(this).attr("placeholder"))});p.on("mousemove",function(b){var e=d.toHtmlSafe(c(this).attr("placeholder"));e&&show_hint({event:b,html:'<div class="normal_">'+k.getSearchFormatStr(d.glossary({id:19912}).replace("{ORIGINAL_TEXT}",e))+"</div>"})});p.on("change keyup",function(){k.isPageEdited=!0});v&&(p=c("<div>").addClass("inputContainer").append(p,v));return p},getCustomText:function(b,d,
k){var l;if(!c.isEmptyObject(b.uts_custom)){var n=b.uts_custom[k],p=[];l&&p.push(l);for(var s in n)Object.keys(n[s]).map(function(b){p.push(n[s][b])});l=p.filter(function(b,c,d){return d.indexOf(b)===c}).join(", ")}return l},addHighlighter:function(b){var d=c(b).attr("placeholder");""==c(b).val()&&""==d?c(b).addClass("highlighter"):c(b).removeClass("highlighter")},getCaptionActionsDescription:function(){var b=[{title:d.glossary({id:14622}),attributes:{"data-id":"glossaryExport"},listeners:{click:this.exportHandler.bind(this)}}],
c=[{title:d.glossary({id:13295}),attributes:{"data-id":"glossaryImport"},listeners:{click:this.importHandler.bind(this)}},{title:d.glossary({id:2213}),attributes:{"data-id":"glossaryLanguages"},listeners:{click:this.openLanguageMultiselect.bind(this)}}];if(!this.isTableDataEmpty)return 2!=this.options.access?b:b.concat(c);if(2==this.options.access)return c},exportHandler:function(b,g){var k=this,l=1<k.activeLanguages.length,n=(!k.categoryKey||"all"===k.categoryKey)&&(!k.searchKey||""===k.searchKey)||
c.isEmptyObject(k.wholeData.page.rows);!l&&n?k._export("all","",[k.languageIds[0]]):(k.popUp=new d.ui.Popup({title:h(14622),autoOpen:!1,html:k._getExportOptionsHTML(l,n),modal:!0,onClose:function(){k.popUp.destroy()},buttons:[{text:h(14621),position:"left",click:function(){k.popUp.destroy()}},{text:h(14622),type:"submit",position:"right",click:function(b){b=k.startExport();!0===b?k.popUp.destroy():k.popUp.setErrors([{id:"export",message:b}])}.bind(this)}]}),k.popUp.show())},_getExportOptionsHTML:function(b,
c){var k=["<div>",'<form id="glossary-export-form" onsubmit="return false;">','<div class="glossary-export-options-container">',"<% if(multipleLanguages) { %>",'<h2 class="glossary-export-options-header">',h(20756),"</h2>",'<div class="glossary-export-options-row">',"<% for(var i = 1; i <= selectedLanguages.length; i++) { %>","<% var languageId = selectedLanguages[i-1]._id; %>","<% if(!allLanguages.hasOwnProperty(languageId)) { %>","<% continue; %>","<% } %>",'<div class="glossary-export-options-item">',
'<input type = "checkbox" value="<%=languageId%>" class="glossary-export-languages-checkbox" name = "glossary-export-language-<%=languageId%>" id = "glossary-export-<%=languageId%>"',"<% if(currentLanguages.indexOf(languageId) > -1) { %>",' checked="checked" ',"<% } %>",">",'<label for="glossary-export-<%=languageId%>"><%-allLanguages[languageId]%></label>',"</div>","<% if(i % 3 == 0) { %>","</div>",'<div class="glossary-export-options-row">',"<% } %>","<% } %>","</div>","<% } %>","</div>",'<div class="glossary-export-options-container">',
"<% if(!exportAll) { %>",'<h2 class="glossary-export-options-header">',h(20757),"</h2>",'<div class="glossary-export-options-row">','<div class="glossary-export-options-item">','<input type="radio" value="0" name="glossary-export-filtered" id="export-all">','<label for="export-all" ><%=h(13862)%></label>',"</div>",'<div class="glossary-export-options-item">','<input type="radio" value="1" name="glossary-export-filtered" id="export-filtered" checked="checked">','<label for="export-filtered"><%=h(13863)%></label>',
"</div>","</div>","<% } %>","</div>","</form>","</div>"];return(new d.Template(k)).compile().apply({multipleLanguages:b,exportAll:c,allLanguages:this.allLanguages,selectedLanguages:this.activeLanguages,currentLanguages:this.languageIds})},startExport:function(){var b=[this.languageIds[0]],d=0,k="all",l="";if(1<this.activeLanguages.length){d=c(".glossary-export-languages-checkbox:checked",this.popUp.getDomContent());if(0==d.length)return h(20758);b=[];d.each(function(){b.push(this.value)})}d=c("input[name='glossary-export-filtered']:checked",
this.popUp.getDomContent()).val()||0;1==d&&(k=this.categoryKey||"all",l=this.searchKey||"");this._export(k,l,b);return!0},_export:function(b,c,d){exportRequest((!0==_DATA.is_mobility_app?["m=CompanySettingsGlossary","a=export","itype=manage","category="+b,"find="+c,"languages="+d,"lid_to_complete="+this.langOfEmptyRecords||""]:["controller=CompanySettingsGlossary","method=export","category="+b,"find="+c,"languages="+d,"lid_to_complete="+this.langOfEmptyRecords||""]).join("&"))},importHandler:function(b,
g){var k=this,l=c(k._getImportHTML());this.importFile=new d.view.uploadFile(l.find(".formField"));this.importFile.render("importFile",null,"glossary-import-label glossary-import-required");k.popUp=new d.ui.Popup({title:h(13866),autoOpen:!1,html:l,modal:!0,onClose:function(){k.popUp.destroy()},buttons:[{text:h(14621),position:"left",click:function(){k.popUp.destroy()}},{text:h(13866),type:"submit",position:"right",click:function(b){if(k.isPageEdited)return d.ui.Confirm({text:h(20762),acceptButtonHandler:function(){k.isPageEdited=
!1;k.startImport();this.destroy(this)}.bind(this),dismissButtonText:h(6266)}),!1;k.startImport()}.bind(this)}]});k.popUp.show();c("input[type='file']",k.popUp.getDomContent()).on("change",function(){""!=this.value&&(k.importFileName=this.value);k.popUp.removeError("file_error")});c('input:not([type="file"])',k.popUp.getDomContent()).on("keypress",function(b){"Enter"!==b.key&&"Space"!==b.key||c(k.popUp.getDomContent()).find('[type="file"]').trigger("click")})},startImport:function(b,c){var d=this.validateImport();
!0!=d&&this.popUp.setErrors([{id:"file_error",message:d}])},_getImportHTML:function(){var b=['<form id="glossary-import-form" action="?controller=CompanySettingsGlossary&method=import">','<div class="toa-formrow">','<div class="formLabel">','<i><abbr id="glossary-import-required" class="ofsc-abbr-mandatory" title="',h(22351),'">*</abbr></i>','<label id="glossary-import-label">',h(7507),"</label>","</div>",'<div class="formField">',"</div>","</div>","</form>"];return(new d.Template(b)).compile().apply()},
validateImport:function(){this.popUp.removeError("file_error");if(!window.FileReader)return h(20760);if(0===this.importFile.getFileSize())return h(12255);if(null===this.importFileName.match(/\.csv$/))return h(20759);var b={import_file:this.importFile.getFile()};this._import(b);return!0},_import:function(b){var c=this;_DATA.shouldSetFocus=!0;c.sandbox.trigger("global.data.get",{controller:"CompanySettingsGlossary",method:"import",params:b,responseHandler:c.onImportSuccess.bind(c),errorHandler:c.onImportError.bind(c),
completeHandler:function(){c.popUp.isOpen()&&c.popUp.getDomBase().focus()}})},onImportSuccess:function(b,c){!0==c.result?(this.onChange(),this.popUp.destroy()):this.popUp.setErrors([{id:"file_error",message:h(20761)}])},onImportError:function(){this.popUp.setErrors([{id:"file_error",message:h(5555)}])},openLanguageMultiselect:function(){var b=this;if(!b.wholeData||0==b.wholeData.length||2!=b.options.access)return null;this.disableLanguageButton(!0);var c=new d.widgets.MultiselectOptionDialog({title:d.glossary({id:2213}),
width:400,height:500,nonEmpty:{validationText:h(2212)},editOptions:{sortable:!0,sortField:"order"},data:{all:b.allLanguages,selected:b.activeLanguages,label:b.allLanguages},onClose:function(){c.destroy();this.disableLanguageButton(!1)}.bind(b),buttons:[{text:h(14621),position:"left",click:function(){c.destroy();this.disableLanguageButton(!1)}.bind(b),id:"multiselectCancelBtn"},{text:h(12252),type:"submit",position:"right",click:function(k){if(c.validate())return!1;var l=c.getSelectedObject();if(this.isPageEdited)return d.ui.Confirm({text:h(17909),
acceptButtonHandler:function(){this.isPageEdited=!1;this.onLanguageChange({},l);c.destroy(this)}.bind(this),dismissButtonText:h(6266)}),!1;this.onLanguageChange(k,l);c.destroy(b)}.bind(b),id:"multiselectSubmitBtn"}]})},suspend:function(){this.languageIds=this.allLanguagesLabels=this.allLanguages=this.activeLanguages=this.cachedCategories=this.wholeData=null;b.prototype.suspend.apply(this,arguments)},onChangeError:function(b,c){this.disableSearch(!1);this.cachedCategories&&this.createSearchAndButtons(this.cachedCategories)},
onUpdate:function(b,g){this.wholeData=g;this.isPageEdited=!1;g.page&&(this.activeLanguages=g.page.languages?g.page.languages:[],this.allLanguages=g.page.allLanguages?g.page.allLanguages:{},this.allLanguagesLabels=g.page.allLanguagesLabels?g.page.allLanguagesLabels:{},this.languageIds=g.page.cols?g.page.cols:[]);g.page.access&&(this.options.access=g.page.access);this._initGrid();g.categories?this.cachedCategories=g.categories:g.categories=this.cachedCategories;this.isTableDataEmpty=!1;if(g.page.long_running||
c.isEmptyObject(g.page.rows))this.isTableDataEmpty=!0;g.categories&&(this._createCaptionControls(),this.createSearchAndButtons(),this.isTableDataEmpty||this._createEditOptions());this.removeNoDataMessage();this._initGridPageState();this.gridDiv.ConfigGrid("setPage",g.page);this.gridDiv.ConfigGrid("updateAttr",d.glossary({id:19407,type:"raw"}));g.page.long_running?this.setNoDataMessage(h(225958)):c.isEmptyObject(g.page.rows)&&this.setNoDataMessage();this.showDetailedCategoryInfo();this.sandbox.options.content.scrollTop(0);
this.disableLanguageButton(!1);this.disableSearch(!1);c("#manage-container").find(".company_settings_glossary_list-menu").removeAttr("disabled")},showDetailedCategoryInfo:function(){c("td.category-name").on("mousemove",function(b){this.offsetWidth<this.scrollWidth&&show_hint({event:b,html:'<div class="normal_">'+c(this).text()+"</div>"})})},_createCaption:function(){this.capt=c("<div/>",{id:"content-caption-alta",class:"glossary-caption"}).prependTo(this.headerDiv);d.view.control.create({xtype:"PanelTitleAlta",
resourceTreeButton:!1,calendar:!1,filter:!1,backButton:!0,backButtonIcon:"",headerResponsive:_DATA.page_label,backButtonLabel:_DATA.glossary.action_links[this.options.backButtonLabel],backButtonHint:h(16257),titleText:this.options.titleLabel,listeners:{backButtonClick:this.navigateToScreen.bind(this,this.options.backButtonLabel)}}).render(this.parentDiv.find("#content-caption-alta"));this.createSearchAndButtons()},createSearchAndButtons:function(b){var g=this,k=null,k=b?b:g.wholeData.categories;g.categorySelect=
d.view.control.create({xtype:"Select",name:"glossary-menu-filter",value:"all",attr:{"aria-label":h(207)},optionItems:[{label:h(1458),value:"all",disabled:!1,selected:!0},{label:h(207),items:k}],listeners:{change:function(b,c){g.updateSelectWidth()}}});g.searchBox=d.view.control.create({xtype:"SearchBox",name:"glossary-search",placeholder:g.options.searchPlaceholder||"",items:[{xtype:"Input",name:"searchInput",attr:{maxlength:255,"data-id":"glossary-find-input","aria-label":h(269)+" "+h(22606)},cell:{css:{paddingLeft:5,
paddingRight:5}}},{xtype:"Icon",name:"searchIcon",image:"toa-icon-magnifier",cell:{addClass:"glossary-find"},attr:{role:"button","aria-label":h(269)}},{xtype:"Icon",name:"searchClear",image:"toa-icon-search-clear",hidden:!0,cell:{width:0,height:0,display:"none"},attr:{role:"button","aria-label":h(7717)}}]});b=c("<div/>").addClass("menu-filter");d.currentInterface===INTERFACE.MANAGE?(k=c("#content-caption-alta div.toa-view-control-panel-toolbar"),k.children(".menu-filter").remove(),k.append(b),g.categorySelect.render(c("#content-caption-alta .menu-filter")),
g.searchBox.render(c("#content-caption-alta .menu-filter")),c("#content-caption-alta div.menu-filter").removeClass("toa-hidden")):(c("#content-caption-alta").parent().find(".menu-filter").remove(),c("#content-caption-alta").after(b),b=c("#content-caption-alta").parent().find(".menu-filter"),g.categorySelect.render(b),g.searchBox.render(b),b.removeClass("toa-hidden"));g.bindUnhandledEvents();g.categoryKey&&g.categorySelect.setOption(g.categoryKey);g.searchKey&&g.searchBox.applyOptionValue("value",
g.searchKey);g.updateSelectWidth();g.isPageEdited=!1},bindUnhandledEvents:function(){var b=this;c("#content-caption-alta .glossary-find").click(function(c){b.startSearch()});c('#content-caption-alta input[data-id="glossary-find-input"]').keypress(function(c){13==(c.keyCode?c.keyCode:c.which)&&(c.preventDefault(),b.startSearch())});c(".menu-filter .glossary-find").click(function(c){b.startSearch()});c('.menu-filter input[data-id="glossary-find-input"]').keypress(function(c){13==(c.keyCode?c.keyCode:
c.which)&&(c.preventDefault(),b.startSearch())});b.categorySelect.setOption=function(b){this.getElement().val(b)};b.categorySelect.adjustWidth=function(){var b=this.getOptionValue(),b=this.getElement().find('option[value="'+b+'"]').text(),b=c("<div/>").text(b).addClass("lengthFinder");c("#company_settings_glossary_list").append(b);b=c(".lengthFinder").width()+47;c(".lengthFinder").remove();this.getElement().css("width",b)};c("input:reset").click(function(){this.form.reset();b.isPageEdited=!1;c(this.form).find("input[type=text]").each(function(){b.addHighlighter(this)});
return!1})},startSearch:function(){this.searchDisabled||(this.searchHandler(),this.langOfEmptyRecords="",this.onChange("external.search"))},updateSelectWidth:function(){this.categorySelect.adjustWidth()},onChange:function(b,g){var k=this;if(k.isPageEdited)return d.ui.Confirm({text:h(17909),acceptButtonHandler:function(){k.isPageEdited=!1;k.onChange({},g)}.bind(k),dismissButtonText:h(6266)}),!1;b&&k.clearSaveStatusMessage();g=k.requestParamFilter(g&&"from"in g?g:"");g.company=k.sandbox.options.company;
c("#manage-container").find(".company_settings_glossary_list-menu").attr("disabled",!0);k._searchKeyChanged=!1;this.requestHolder=!0;k.sandbox.trigger("global.data.get",{controller:"CompanySettingsGlossary",method:"list",params:g,keep_in_history:!0,requestHolder:function(b){this.requestHolder=b}.bind(this),responseHandler:k.onUpdate.bind(k),errorHandler:k.onChangeError.bind(k),completeHandler:function(){_DATA.shouldSetFocus&&app.focusToTheLastSelectedElement&&app.focusToTheLastSelectedElement()}})},
onLanguageChange:function(b,c){var d=this.requestParamFilter(),l=Object.assign({},this.allLanguages);d.company=this.sandbox.options.company;d.languages=c;for(var n=c.length-1;0<=n;n--)delete l[c[n]._id];d.removedLanguage=l;this._searchKeyChanged=!1;this.sandbox.trigger("global.data.get",{controller:"CompanySettingsGlossary",method:"language",params:d,keep_in_history:!0,responseHandler:this.onUpdate.bind(this)})},requestParamFilter:function(b){this.disableSearch(!0);var c=this.categorySelect&&(this._searchKeyChanged||
b)?!1:"fetch";b||(b=this.gridDiv.ConfigGrid("getPageState"));gridParams={};gridParams.select_from=b.from;gridParams.select_count=b.size||20;gridParams.find=this.searchKey||"";gridParams.category=this.categoryKey||"all";gridParams.languages=this.languageIds||[];if(b.empty_lid||this.langOfEmptyRecords)gridParams.lid_to_complete=b.empty_lid||this.langOfEmptyRecords;if(b.swapFrom&&b.swapTo){var d=gridParams.languages.indexOf(parseInt(b.swapFrom));gridParams.languages.splice(d,1,parseInt(b.swapTo))}if(this._searchKeyChanged&&
0!==b.from||b.empty_lid)gridParams.select_from=0;b={};b.gridParams=gridParams;b.categories=c;"fetch"==c&&this.loadCategoriesSeparately(b);return b},loadCategoriesSeparately:function(b){this.disableSearch(!0);this.sandbox.trigger("global.data.get",{controller:"CompanySettingsGlossary",method:"fetchCategories",params:b,keep_in_history:!0,responseHandler:this.onCategoriesAvailable.bind(this)})},onCategoriesAvailable:function(b,c){c.categories&&(this.options.access=c.access,this.cachedCategories=c.categories)},
searchHandler:function(){this.searchKey=c.trim(this.searchBox.getOptionValue());this.categoryKey=this.categorySelect.getOptionValue();this._searchKeyChanged=!0},_createEditOptions:function(){var b=this;if(2!=b.options.access)c(".editOptions").remove();else if(0==c(".editOptions").length){var d=c("<section/>").addClass("editOptions"),k=c("<input/>").attr({name:"resetBtn",type:"reset",class:"toa-button toa-button-shadow-blue",value:h(21)});d.append(k);k=c("<input/>").attr({name:"save",type:"submit",
class:"toa-button toa-button-shadow-blue toa-button-active save",value:h(12)});k.on("click",function(){b.saveEdits(this.form)});d.append(k);b.gridDiv.append(d)}},saveEdits:function(b){c(b).find("input[type=text]").each(function(){this.placeholder==this.value&&(this.value="")});this.sandbox.trigger("global.data.get",{keep_in_history:!0,form:b,responseHandler:this.onEditsSaved.bind(this)})},onEditsSaved:function(b,c){this.disableSearch(!1);this.isPageEdited=!1;this.clearSaveStatusMessage();this.gridDiv.prepend(c.saveStatus);
this.reloadDataGlossaryObj(c.glossaryChangedData);this.onChange()},reloadDataGlossaryObj:function(b){var c="APPT_HINT APPT_WARNING move_failure_reason kernel_error appt_move_log_result_code action_links".split(" ");"undefined"!==typeof _DATA.glossary&&"undefined"!==typeof b&&Object.keys(b).forEach(function(d){if(-1!==c.indexOf(d))for(var l in b[d])_DATA.glossary[d][l]=b[d][l];else _DATA.glossary[d]=b[d]})},clearSaveStatusMessage:function(){c("ul.info").remove()},initMultiselect:function(b){var c=
b.attr("data-item-code");b=b.attr("data-lang");this.fetchInfoForMultiSelect(this.wholeData.page.rows[c],b)},fetchInfoForMultiSelect:function(b,c){var d={};d._lang=c;var l={},n=Object.keys(b.display_profiles),p;for(p in n){var s=this.wholeData.page.display_profile_user_type[n[p]];if("undefined"!==typeof s&&"object"===typeof s.user_type&&0!=Object.keys(s.user_type).length){var t="",s=s.user_type,u;for(u in s){var v=s[u];"context_manage.categ"===b.tlabel?-1!==v.permissions.indexOf(1)&&(t+=this.wholeData.page.userTypeData[u]+
", "):"context_mobility.categ"===b.tlabel?-1!==v.permissions.indexOf(3)&&(t+=this.wholeData.page.userTypeData[u]+", "):t+=this.wholeData.page.userTypeData[u]+", "}""!==t&&(t=t.replace(/,\s*$/,""),l[n[p]]=t)}}d._utsInCurrentDisplayProfile=l;var l=[],n=b.uts_custom[c],w;for(w in n)p={},p._id=w,s=Object.keys(n[w])[0],p.cstext=n[w][s],p.itemId=s,l.push(p);d._selectedFields=l;d._title=b.label;d._tlabelFlag=b.tlabelFlag;d._originalName=b["original_"+c];d._itemCode=b.item_code;this.showUserTypeMultiselect(d)},
showUserTypeMultiselect:function(b){var g=this,k=new d.widgets.MultiselectOptionDialog({title:b._title,width:420,height:500,itemCode:b._itemCode,language:b._lang,tlabelFlag:b._tlabelFlag,editOptions:{sortable:!1,inlineStructure:!0,editable:{props:["cstext"],propsToValidate:["cstext"],fields:{cstext:{type:"textbox",value:"cstext",width:150,maxlength:150}}}},data:{all:b._utsInCurrentDisplayProfile,selected:b._selectedFields,itemInfo:b._originalName},buttons:[{text:h(14621),position:"left",click:function(){k.destroy()},
id:"multiselectCancelBtn"},{text:h(12252),type:"submit",position:"right",click:function(b){if(k.validate())return!1;c(b.target).removeClass("toa-button-active").addClass("toa-button-disable");_selectedFields=k.getSelectedObject();g.saveContextCustomTexts(_selectedFields,k.options);k.destroy(g)}.bind(g),id:"multiselectSubmitBtn"}]})},saveContextCustomTexts:function(b,c){var d=this.requestParamFilter(),l=this.wholeData.page.rows,n=Object.keys(l[c.itemCode].uts_custom[c.language]),p=[],s;for(s in b)p.push(b[s]._id);
var t=[],n=n.filter(function(b){return-1==p.indexOf(b)});for(s in n){var u={};u.itemId=Object.keys(l[c.itemCode].uts_custom[c.language][n[s]])[0];u._id=n[s];t.push(u)}var n=l[c.itemCode].uts_custom[c.language],u=[],v=[];for(s in b)n[b[s]._id]||0===n[b[s]._id]?n[b[s]._id][b[s].itemId]!==b[s].cstext&&u.push(b[s]):(b[s].itemId=l[c.itemCode].display_profiles[b[s]._id],v.push(b[s]));if(0!==t.length||0!==u.length||0!==v.length)d.edits={"delete":t,update:u,insert:v,editedLanguage:c.language,tlabelFlag:c.tlabelFlag},
this.sandbox.trigger("global.data.get",{controller:"CompanySettingsGlossary",method:"saveContextItems",params:d,keep_in_history:!0,responseHandler:this.onEditsSaved.bind(this)})},setNoDataMessage:function(b){b=b?b:h(6353);this.gridDiv.children("table").children("tbody").html('<tr class="noDataMessage"><td colspan=4>'+b+"</td></tr>")},removeNoDataMessage:function(){this.gridDiv.children("table").children("tbody").empty()},disableLanguageButton:function(b){c('button[data-id="glossaryLanguages"]').prop("disabled",
b)},disableSearch:function(b){this.searchDisabled=b;c('.menu-filter input[data-id="glossary-find-input"]').prop("disabled",b)}},{})}(toa,$));(function(d){d.ns("toa.controllers.Applications",d.define(d.Controller,function(c){this.sandbox=c;this.resume(c.options)},{access:1,toString:function(){return"Applications screen controller"},getApplicationForm:function(){this.applicationForm||(this.applicationForm=new d.views.applications.ApplicationForm);return this.applicationForm},getApplications:function(){this.applications||(this.applications=new d.views.applications.Applications,this.onChangeApplicationUID=this.applications.addListener("changeApplication",
this.onChangeApplication.bind(this)));return this.applications},getControlPanel:function(){this.controlPanel||(this.controlPanel=new d.views.applications.ControlPanel,this.onRemoveApplicationUID=this.controlPanel.addListener("remove",this.onRemoveApplication.bind(this)));return this.controlPanel},getApplicationCollection:function(){this.applicationCollection||(this.applicationCollection=new d.models.applications.applications,this.onLoadApplicationUID=this.applicationCollection.addListener("load",
this.onLoadApplication.bind(this)));return this.applicationCollection},enableReadOnlyMode:function(){this.layout.enableReadOnlyMode();this.getControlPanel().enableReadOnlyMode();this.getApplicationForm().enableReadOnlyMode()},disableReadOnlyMode:function(){this.layout.disableReadOnlyMode();this.getControlPanel().disableReadOnlyMode();this.getApplicationForm().disableReadOnlyMode()},onRemoveApplication:function(c){null!==this.applications.getSelectApplication()&&d.ui.Confirm({text:h(21043),acceptButtonHandler:function(){this.getApplications().getSelectApplication().model.remove().done(function(){this.getApplicationForm().getElement().hide();
this.getApplications().render(this.applicationCollection)}.bind(this))}.bind(this),dismissButtonText:h(6266)})},onLoadApplication:function(c){this.disableReadOnlyMode();this.applicationCollection.isReadOnly()&&this.enableReadOnlyMode();this.getApplications().render(this.applicationCollection)},_createLayout:function(){this.layout=new d.views.applications.Layout;this.layout.getContent().append(this.getApplicationForm().getElement());this.screen.append(this.layout.getElement())},createPanelTitle:function(){this.panel=
d.view.control.create({xtype:"PanelTitleAlta",name:"title",titleText:this.params.name,resourceTreeButton:!1,backButton:!0,headerResponsive:_DATA.page_label,backButtonLabel:_DATA.glossary.action_links.company_settings_outbound_channels,backButtonIcon:"",backButtonHint:h(16257),filter:!1,viewSelector:!1,calendar:!1,addClass:"jet-css-only toa-panel-title jet-screen-title toa-application-title-panel",listeners:{backButtonClick:function(){d.app.trigger("layout.menu.click",{label:"company_settings_outbound_channels",
url:"",name:_DATA.glossary.action_links.company_settings_outbound_channels,params:{}})}}});this.panel.render(this.screen)},onChangeApplication:function(c,b){this.checkConfirmSave().done(function(){this.selectApplication(b)}.bind(this))},checkConfirmSave:function(){var c=$.Deferred(),b=this.getApplicationForm().getModel(),e=this.getApplicationForm().getOriginData();if(b&&b.isModify)var g=new d.ui.Popup({title:h(13294),html:h(15046),autoOpen:!0,buttons:[{text:h(6266),click:function(){this.destroy()}},
{text:h(11947),click:function(){b.set(e);b.isModify=!1;c.resolve();this.destroy()}},{text:h(21013),type:"submit",click:function(){this.getApplicationForm().saveApplication().done(function(){c.resolve();g.destroy()}.bind(this)).fail(function(){c.reject();g.destroy()})}.bind(this)}]});else c.resolve();return c.promise()},selectApplication:function(c){this.getApplicationForm().setModel(c);this.onSaveApplicationForm=this.getApplicationForm().getModel().addListener("afterSave",function(b){this.params.name=
this.getApplicationForm().getModel().attributes.name}.bind(this));this.getApplications().selectApplication(c);this.getApplicationForm().draw()},getTreeRequestParameters:function(){var c=this.applicationForm.sectionAuthorization.resourcesTreeState,c=d.app.model("resourceTreeManager").retreiveTreeRequestParams(c),b={};b[c.tree_identifier]=c;return b},resume:function(c){this.options=this.sandbox.options;this.options.params=0===Object.keys(c.params).length?this.sandbox.options.params:c.params;this.screen=
this.sandbox.options.content;$.isEmptyObject(c.params)||(this.params=c.params);this.sandbox.trigger("layout.menu.changeTitle",{label:"company_settings_applications",url:"",name:h("15032"),params:{}});this.createPanelTitle();this._createLayout();this.sandbox.trigger("layout.tabs.set",{tabs:0,show:0});c=this.getTreeRequestParameters();c={applicationId:this.sandbox.options.params.appId,trees:c};this.getApplicationCollection().load(c).done(function(){var b=this.applicationCollection.get(this.options.params.selectedApplication);
b&&this.selectApplication(b)}.bind(this))},suspend:function(c){c=this.getApplications().getSelectApplication();delete this.sandbox.options.params.selectedApplication;c&&(this.sandbox.options.params.selectedApplication=c.model.getId());this.destroy()},destroy:function(){this.getApplicationForm().getModel().removeListener(this.onSaveApplicationForm);this.getApplications().removeListener(this.onChangeApplicationUID);this.getApplicationCollection().removeListener(this.onLoadApplicationUID);this.getControlPanel().removeListener(this.onRemoveApplicationUID);
this.getApplicationCollection().clear();this.panel.destroy();this.getApplications().destroy();this.getApplicationForm().destroy();this.getControlPanel().destroy();this.popupApplication=this.applicationCollection=this.controlPanel=this.applicationForm=this.applications=null;this.screen.empty()}}))})(toa);(function(d){var c=d.glossary;d.ns("toa.views.organization.OrganizationForm",d.define(null,function(b){var e={},g={},k=!1;e.content=(new d.Template(['<div id="toa-organization-form"></div>'])).compile();e.form=(new d.Template('    <div class="toa-formrow label">;        <div class="formLabel">;           <% if (isMandatory) { %><abbr id=<%-req_id%> class="ofsc-abbr-mandatory" title="<%-required%>">*</abbr><% } %>;           <label id="<%-lab_id%>"><%-label%></label>;        </div>;        <div class="formField">;           <input type="text" name="label" <% if (isMandatory) { %>required <% } %>aria-labelledby="<% if (isMandatory){ %><%-req_id+" "%><% } %><%-lab_id%>" maxlength="255" />;        </div>;    </div>;    <div class="toa-formrow type">;        <div class="formLabel">;           <label id="<%-type_lab_id%>"><%-type%></label>;        </div>;        <div class="formField">;           <select aria-labelledby="<%-type_lab_id%>" name="type">;               <option value="inhouse" id="org_inhouse"><%-inhouse%></option>;               <option value="contractor" id="org_contractor"><%-contractor%></option>;           </select>;        </div>;    </div>'.split(";"))).compile();
e.langs=(new d.Template('    <div class="toa-formrow lang">;        <div class="formLabel" data-lang="Lang">;           <% if (isMandatory) { %><abbr id=<%-req_id%> class="ofsc-abbr-mandatory" title="<%-required%>">*</abbr><% } %>;            <label id="<%-lab_id%>"><%-lang%></label></div>;        <div class="formField">;            <input aria-labelledby="<% if (isMandatory) { %><%-req_id+" "%><% } %><%-lab_id%>" <% if (isMandatory) { %>required <% } %>type="text" name="lang[<%-index%>]" />;        </div>;    </div>'.split(";"))).compile();
e.glossary={contractor:c({id:15465}),inhouse:c({id:15466}),label:c({id:15462}),type:c({id:15463}),required:c({id:22351})};e.showOrganizationFormHandler=function(l,n){b.trigger("company.settings.support.of.organizations.read."+(n.access.company_settings_support_of_organizations>=READ_WRITE?"write":"only")+".mode",n);e.data=n;var p=$(e.content.apply()),s=[];$.each(e.data.langs,function(b,c){var d="",d=e.data.userLang==b?e.langs.apply({req_id:generate_id(),lab_id:generate_id(),lang:c,index:b,isMandatory:!0,
required:e.glossary.required}):e.langs.apply({lab_id:generate_id(),lang:c,index:b,isMandatory:!1});s.push(d)});var t=e.form.apply({req_id:generate_id(),lab_id:"org_label",type_lab_id:"org_type",label:e.glossary.label,type:e.glossary.type,inhouse:e.glossary.inhouse,contractor:e.glossary.contractor,isMandatory:!0,required:e.glossary.required});s.push(t);p.html(s.join("\n"));e.id&&e.setFormValue(p);g=new d.ui.Popup({onClose:e.closeForm});g.setContent(p);e.data.access.company_settings_support_of_organizations<
READ_WRITE?(g.setTitle(c({id:15325})),g.setButtons([])):(e.id?g.setTitle(c({id:15467})):g.setTitle(c({id:15468})),g.setButtons([{text:c({id:11947}),position:"right",click:e.closeForm},{text:c({id:11948}),type:"submit",position:"right",click:e.submitFormButton}]),$(window).on("keydown",function(b){13===b.keyCode&&e.submitFormButton()}));g.show();g.setPositionCenter();k=!1};e.errorOrganizationFormHandler=function(c){set_indicator(0);if(c.kernel_error)e.closeForm();else{var d=JSON.parse(c.responseText);
b.trigger("company.settings.support.of.organizations.read."+(d.access.company_settings_support_of_organizations>=READ_WRITE?"write":"only")+".mode",d);409!=c.status&&404!=c.status||"undefined"===typeof g.setErrors?e.showAlert(d):e.setErrorMessages([d.organizations_exception.message])}k=!1};e.submitFormButton=function(){var c=e.getFormValue();e.validateForm(c)&&!k&&(b.trigger("global.data.get",{controller:"organizations",method:e.id?"update":"insert",params:{form:c,id:e.id},suppressErrors:/409/,responseHandler:function(c,
d){b.trigger("company.settings.support.of.organizations.read."+(d.access.company_settings_support_of_organizations>=READ_WRITE?"write":"only")+".mode",d);k=!1;e.closeForm();e.notify(0===e.id)},errorHandler:e.errorOrganizationFormHandler}),k=!0)};e.getFormValue=function(){var b=$('#toa-organization-form input[name="label"]').val(),c=$('#toa-organization-form select[name="type"] option:selected').val(),d={};$("#toa-organization-form input[name^=lang]").each(function(){var b=$(this).attr("name").replace(/[^\d]+/gi,
"");d[b]=$(this).val()});return{label:$.trim(b),type:$.trim(c),langs:d}};e.setFormValue=function(b){var c=e.data.organization.label,d=e.data.organization.type;e.data.access.company_settings_support_of_organizations<READ_WRITE?b.find("input,select").attr("disabled","disabled"):e.id?b.find('input[name="label"]').attr("disabled","disabled"):b.find('input[name="label"]').removeAttr("disabled");b.find('input[name="label"]').val(c);b.find('select[name="type"]').val(d);$.each(e.data.organization.translations,
function(c,d){b.find('input[name="lang['+c+']"]').val(d)})};e.validateForm=function(b){var d=[];$.each(b.langs,function(b){if(e.data.userLang==b)return b=$('#toa-organization-form input[name="lang['+b+']"]').val(),""==$.trim(b)&&d.push(c({id:15471})),!1});""==b.label&&d.push(c({id:15472}));255<b.label.length&&d.push(c({id:15473}));d.length&&e.setErrorMessages(d);return 0==d.length};e.setErrorMessages=function(b){var c,d=[];for(c=0;c<b.length;c++)d.push({id:c+1,message:b[c]});g.setErrors(d)};e.closeForm=
function(){g.destroy()};e.destroy=function(){$(window).off("keydown");g.destroy()};e.showAlert=function(b){this.notify("show-alert",b)}.bind(this);e.notify=function(b){this.notify("grid-refresh-required",b)}.bind(this);this.showOrganizationForm=function(c){e.id=c||0;k||(b.trigger("global.data.get",{controller:"organizations",method:"get",params:{id:e.id},responseHandler:e.showOrganizationFormHandler,errorHandler:e.errorOrganizationFormHandler}),k=!0)}},$.extend({},d.mixins.EventEmitter,{})))})(toa);(function(d){var c=d.glossary;d.ns("toa.views.OrganizationsConfig.OrganizationList",d.define(null,function(){var b=this,d={};d.glossary={contractor:c({id:19644}),inhouse:"",resources:c({id:19645}),vehicle:c({id:19646}),tools:c({id:19647}),org_unit:c({id:19648}),buckets:c({id:19649}),remove:c({id:19650}),actions:c({id:3514}),caption:c({id:13219})};d.container=$(['<div id="toa-organizations-list">','<table class="oj-table" style="width:100%" aria-label="'+d.glossary.caption+'"></table>',"</div>"].join(""));
d.tableRowTemplate=['<tr><th scope="row"><div class="data-name" tabindex="0" role="link"></div><div class="data-type"></div><div class="data-info"></div></th><td class="resources"><div></div>',"<div>"+d.glossary.resources+"</div>",'</td><td align="left" class="vehicle"><div></div>',"<div>"+d.glossary.vehicle+"</div>",'</td><td align="left" class="tools"><div></div>',"<div>"+d.glossary.tools+"</div>","</td></tr>"].join("");d.actionCeilTemplate=""+('<td><div class="data-field-settings" aria-haspopup="true" tabindex="0" aria-label="'+
d.glossary.actions+'" role="link"></div></td>');d.remapData=function(b){var c={info:"",resources:0,vehicle:0,tools:0,groups:0,bucket:0};b.members&&(b=b.members,c.info+=d.glossary.org_unit+": ",b.organization_unit?(c.info+=b.organization_unit,c.groups=b.organization_unit):c.info+=0,c.info+=" | "+d.glossary.buckets+": ",b.bucket?(c.info+=b.bucket,c.bucket=b.bucket):c.info+=0,b.field_resource&&(c.resources=b.field_resource),b.vehicle&&(c.vehicle=b.vehicle),b.tool&&(c.tools=b.tool));return c};d.setValOrZero=
function(b,c,d){b=$("."+c,b);0===d?(b.html("&nbsp;"),b.removeClass(c)):$(":first-child",b).text(d)};d.render=function(b){d.container.hide();var k=$("table",d.container),l;k.empty();var n=d.data.slice(0);n.sort(function(b,c){return b.organization_id-c.organization_id});k.append('<tr><th scope="row" colspan="5" style="font-size:0px;">'+d.glossary.caption+"</th></tr>");n.forEach(function(b){l=$(d.tableRowTemplate);$(".data-name",l).text(b.name||c({id:13227})).attr("data-id",b.organization_id);var g=
d.remapData(b);$(".data-info",l).text(g.info);d.setValOrZero(l,"resources",g.resources);d.setValOrZero(l,"vehicle",g.vehicle);d.setValOrZero(l,"tools",g.tools);$(".data-type",l).text(d.glossary[b.type]);d.mode>=READ_WRITE&&(l.append($(d.actionCeilTemplate)),0!==g.resources||0!==g.vehicle||0!==g.tools||0!==g.groups||0!==g.bucket?($(".data-field-settings",l).addClass("data-field-settings-disabled"),$(".data-field-settings",l).attr("data-id",0)):($(".data-field-settings",l).attr("data-id",b.organization_id),
$(".data-field-settings",l).attr("data-name",b.name)));k.append(l)});d.container.show();b&&l.get(0).scrollIntoView()};d.menu=$(['<div><div class="organizations_actions" data-action="remove">','<a name="organizations_remove_action" role="link" tabindex="0">'+d.glossary.remove+"</a>","</div></div>"].join(""));d.menu.Tip({minWidth:100,minHeight:40,zIndex:2020,callout:!1,onHide:function(){$(".data-field-settings-selected",b.container).removeClass("data-field-settings-selected")}});d.menu.delegate(".organizations_actions",
"click",function(c){var k=d.menu;k.Tip("hide");c=$(c.currentTarget).attr("data-action");var l=k.attr("data-id"),k=k.attr("data-name");b.notify(c,{id:l,name:k})});d.menu.delegate(".organizations_actions","keydown",function(b){"undefined"!==typeof b.keyCode&&13===b.keyCode&&(b.stopPropagation(),$(b.target).click())});d.showItemMenu=function(b){if("keypress"!==b.type||13===b.keyCode){var c=$(b.target),l=1*c.attr("data-id");if(0===l)return!1;c.addClass("data-field-settings-selected");d.menu.attr("data-id",
l);d.menu.attr("data-name",c.attr("data-name"));d.menu.Tip("show",b.target,"bottom","right")}};d.container.delegate(".data-field-settings","click",d.showItemMenu);d.container.delegate(".data-field-settings","keypress",d.showItemMenu);this.getContent=function(){return d.container};d.container.delegate(".data-name","click",function(c){c=$(c.target).attr("data-id");b.notify("modify",c)});d.container.delegate(".data-name","keydown",function(b){"undefined"!==typeof b.keyCode&&13===b.keyCode&&(b.stopPropagation(),
$(b.target).click())});this.set=function(b,c,l){d.data=b.organizations;d.mode=c;d.render(!!l)}},$.extend({},d.mixins.EventEmitter,{})))})(toa);(function(d){var c=d.glossary;d.ns("toa.controllers.OrganizationsConfig",d.define(d.Controller,function(){this._create.apply(this,arguments);this._errorsFlag=!1;this.sandbox.bind("company.settings.support.of.organizations.read.only.mode",function(b,c){this._access=c.access.company_settings_support_of_organizations;this.panel.setOption("actions")}.bind(this));this.sandbox.bind("company.settings.support.of.organizations.read.write.mode",function(b,c){this._access=c.access.company_settings_support_of_organizations;
this.panel.setOption("actions",this.actionPanelList)}.bind(this));this.sandbox.trigger("layout.tabs.set",{tabs:0,show:0})},{screenTpl:['<div id="toa-org-conf-screen" class="jet-css-only-data-extract"></div>'],_create:function(b){this._access=1;this.sandbox=b;this.options=this.sandbox.options;this.container=$((new d.Template(this.screenTpl)).apply({}));this.initTranslations();this.createPanelTitle();this.initOrganizationList();this.initOrganizationForm();this.container.append(this.OrganizationList.getContent());
this.options.content.append(this.container);this._getDataAndRenderGrid()},initOrganizationList:function(){this.OrganizationList=new d.views.OrganizationsConfig.OrganizationList;this.OrganizationList.addListener("modify",this.modifyAction,this);this.OrganizationList.addListener("remove",this.removeAction,this)},initOrganizationForm:function(){this.organizationForm=new d.views.organization.OrganizationForm(this.sandbox);this.organizationForm.addListener("grid-refresh-required",this._getDataAndRenderGrid,
this);this.organizationForm.addListener("show-alert",this.showAlert.bind(this))},initTranslations:function(b){var d=this.translations?JSON.stringify(this.translations):"";this.translations={};this.translations.apLabel=c({id:13222});this.translations.organization=c({id:13219});this.translations.backButton=_DATA.glossary.action_links.company_settings_configuration;this.translations.backButtonLabel=_DATA.glossary.action_links.company_settings_configuration;this.translations.back=h(16257);b&&d!==JSON.stringify(this.translations)&&
this._create(this.sandbox)},createPanelTitle:function(){this.actionPanelList=[{xtype:"Button",label:this.translations.apLabel,name:"add_organization",listeners:{click:function(){this.organizationForm.showOrganizationForm()}.bind(this)}}];this.panel=d.view.control.create({xtype:"PanelTitleAlta",name:"title",titleText:this.translations.organization,resourceTreeButton:!1,backButton:!0,backButtonIcon:"",headerResponsive:_DATA.page_label,backButtonLabel:this.translations.backButton,backButtonHint:this.translations.back,
filter:!1,calendar:!1,listeners:{backButtonClick:this.returnToConfigScreen.bind(this)}});this.panel.setOption("backButtonIcon","");this.panel.setOption("backButtonLabel",this.translations.backButtonLabel);this.panel.eventHandlers.backButtonClick=[this.returnToConfigScreen.bind(this)];this.panel.render(this.container)},returnToConfigScreen:function(){$app.navigation().redirect("company_settings_configuration")},showAlert:function(b,e){set_indicator(0);e.operation_is_not_permitted&&!this._errorsFlag&&
(d.ui.Alert({text:c({id:5516}),clickButtonHandler:function(){this._errorsFlag=!1}.bind(this),onCloseHandler:function(){this._errorsFlag=!1}.bind(this)}),this._errorsFlag=!0);e.organizations_exception&&!this._errorsFlag&&(d.ui.Alert({text:e.organizations_exception.message,clickButtonHandler:function(){this._errorsFlag=!1}.bind(this),onCloseHandler:function(){this._errorsFlag=!1}.bind(this)}),this._errorsFlag=!0)},suspend:function(){this.container.detach()},_getDataAndRenderGrid:function(b,c){this.sandbox.trigger("global.data.get",
{controller:"organizations",method:"getList",responseHandler:function(b,d){this.sandbox.trigger("company.settings.support.of.organizations.read."+(2<=d.access.company_settings_support_of_organizations?"write":"only")+".mode",d);this.OrganizationList.set(d,d.access.company_settings_support_of_organizations,c)}.bind(this)})},resume:function(){this.initTranslations(!0);this.options.content.append(this.container);this._getDataAndRenderGrid()},modifyAction:function(b,c){this.organizationForm.showOrganizationForm(c)},
removeAction:function(b,e){var g=this;d.ui.Confirm({text:c({id:19651,type:"raw"}).replace("{ORGANIZATION_NAME}",e.name),acceptButtonHandler:function(){g.sandbox.trigger("global.data.get",{controller:"organizations",method:"delete",params:{id:e.id},responseHandler:function(){g._getDataAndRenderGrid()}})}})}}))})(toa);(function(d){var c='<div id="toa-themes-import">;<div class="uploadForm">;<div class="toa-formrow themeImport mandatory">;<div class="formLabel" id="lbl_zipfile"><%-h(11957/*Zip file*/)%>:</div>;<div class="formField"></div>;</div>;</div>;</div>'.split(";"),b=function(){this.compileThemeImport=(new d.Template(c)).compile();delete c};b.prototype=$.extend({},d.mixins.EventEmitter,{render:function(){this.themeImport=$(this.compileThemeImport.apply());this.themeImportFile=new d.view.uploadFile(this.themeImport.find(".themeImport .formField"));
this.themeImportFile.render("themeImport",!1,"lbl_zipfile");this.popup=new d.ui.Popup;this.popup.setContent(this.themeImport);this.popup.setTitle(h(11958));this.popup.setButtons([{text:h(11947),position:"right",click:function(){this.closeForm()}.bind(this)},{text:h(11948),type:"submit",position:"right",click:function(){this.submitFormButton()}.bind(this)}]);this.popup.show()},getFormValue:function(){return{file:this.themeImportFile.getFile()}},submitFormButton:function(){var b=this.getFormValue();
this.validateForm(b)&&this.notify("submitForm",b)},validateForm:function(b){var c=[];"data:application/zip"!=b.file.substring(0,20)&&"data:application/x-zip-compressed"!=b.file.substring(0,33)&&c.push(h(11962));this.setErrorMessages(c);return 0===c.length},setErrorMessages:function(b){var c=[],d;for(d=0;d<b.length;d++)c.push({id:d+1,message:b[d]});this.popup.setErrors(c)},closeForm:function(){this.popup.hide();this.popup.destroy()}});d.ns("toa.themes.themeImport",b)})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.views.themes.ThemeListNewItem",d.define(c,function(){c.apply(this,arguments)},{events:{"click .openThemeEditorButton":"onThemeEditorOpen"},template:'<div class="theme-item theme-item--add openThemeEditorButton" role="button" tabindex="0"><div class="theme-item-add-text"><%= h(11935/*Add new*/) %></div></div>',onThemeEditorOpen:function(){this.notify("theme:add")}}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.views.themes.WmtThemesContainer",d.define(c,function(){c.apply(this,arguments)},{template:'<div class="theme-grid themeListPanel"><div class="theme-section-title"><%= h(24256/*Where Is My Technician*/) %></div><div class="wmtThemesContainer"></div></div>',regions:{themesList:".wmtThemesContainer"},events:{}}))})(toa);(function(d){var c=d.views.BaseForm;d.ns("toa.views.themes.WmtAddForm",d.define(c,function(b){c.apply(this,arguments)},{template:'<form class="toa-form-horizontal add-user-type" id="wmtThemeAddForm"><div class="form-group"><div class="control-group"><label class="control-label"><span class="asterisk">&#42;</span><%- h(24266/*Label*/) %></label><div class="controls"><input type="text" value="<%= label %>" id="wmtThemeLabel" aria-required="true" class="require" required autofocus><p id="label-error" class="oj-text-sm input-hint input-error"><%- h(24260/*Length should be less then 256 symbols*/) %></p></div></div></div><div class="form-group"><div class="control-group"><label class="control-label"><%- h(24267/*Description*/) %></label><div class="controls"><input type="text" id="wmtThemeDescription" value="<%= description %>" autofocus><p id="description-error" class="oj-text-sm input-hint input-error"><%- h(24260/*Length should be less then 256 symbols*/) %></p></div></div></div></form>',
events:{"input #wmtThemeDescription":"changeDescription","input #wmtThemeLabel":"changeLabel","keydown #wmtThemeAddForm":"onKeyDown"},validators:[{selector:".require",rules:["mandatory"]}],changeLabel:function(b){b=$(b.target).val();this.model.set({label:b});this.validate()},changeDescription:function(b){b=$(b.target).val();this.model.set({description:b});this.validate()},onKeyDown:function(b){13===b.keyCode&&(this.notify("wmtAddform:submitted"),b.preventDefault())},validate:function(){var b=!0;256<
this.model.get("label").length?(this._$el.find("#label-error").addClass("active-error"),b=!1):this._$el.find("#label-error").removeClass("active-error");256<this.model.get("description").length?(this._$el.find("#description-error").addClass("active-error"),b=!1):this._$el.find("#description-error").removeClass("active-error");return b}}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.views.themes.WmtThemeListItem",d.define(c,function(b){c.apply(this,arguments)},{events:{"click .themeName":"onWmtThemeEdit"},template:'<div class="theme-item theme-item--wmt" data-ofsc-role="list-item" data-ofsc-entity="wmt-theme" data-ofsc-entity-id="<%- label %>"><div class="theme-name theme-name--clickable themeName"><%- label %></div><% if (rollerBorderNeeded) {%><div class="theme-color theme-color--wmt theme-color--with-border" style="background-color: <%- color %>;"></div><% } else {%><div class="theme-color theme-color--wmt" style="background-color: <%- color %>;"></div><%}%><% if (description) {%><div class="theme-description"><%- description == "null" ? "" : description %></div><%}%><% if (is_default === "1") {%><div class="theme-wmt-is-default">'+
h(11923)+'</div><%}%><div class="theme-update-date">'+h(24264)+': <%- formattedUpdateDate %></div><div class="theme-menu-button"></div></div>',render:function(b,d){c.prototype.render.apply(this,arguments);this.showMenu();return this},onWmtThemeEdit:function(){this.notify("wmtTheme:selected",this.model.get("label"))},getData:function(){var b="",e=this.model.get("update_date");e&&(b=d.date.formatDate(d.date.format.iso_long,d.date.currentDate()),b=d.date.formatAdaptive(e,b));var g=this.model.get("template_label"),
e=g;(g=d.views.wmtTheme.ServiceManifests.themeManifests[g])&&g.title&&g.title["en-US"]&&(e=g.title["en-US"]);return d.mixin(c.prototype.getData.apply(this,arguments),{formattedUpdateDate:b,templateName:e,rollerBorderNeeded:this.isRollerBorderNeeded(this.model.get("color",""))})},showMenu:function(){if(!this.readOnlyMode){var b=[];b.push({name:"actionWmtEdit",addClass:"toa-dropdown-item",attr:{"aria-label":h(13221),"aria-labelledby":h(13221),tabindex:0},text:h(13221)});"0"===this.model.get("is_default")&&
(b.push({name:"actionWmtRemove",addClass:"toa-dropdown-item",attr:{"aria-label":h(11963),"aria-labelledby":h(11963),tabindex:0},text:h(11963)}),b.push({name:"actionWmtSetDefault",addClass:"toa-dropdown-item",attr:{"aria-label":h(11919),"aria-labelledby":h(11919),tabindex:0},text:h(11919)}));this.menuButton=d.view.control.create({xtype:"button.Menu",name:"formMenuButton",text:"",addClass:"toa-item-menu-button",attr:{"aria-haspopup":"true","aria-label":"formMenuButton","aria-labelledby":"formMenuButton"},
icon:"toa-item-menu-icon",menuItems:b,listeners:{menuItemClick:this.actionMenuItemClick.bind(this)}});this.menuButton.render(this._$el.find(".theme-menu-button"))}},isRollerBorderNeeded:function(b){try{return 0.9<$.Color(b).lightness()}catch(c){return!0}},actionMenuItemClick:function(b,c){switch(c.name){case "actionWmtEdit":this.notify("wmtTheme:selected",this.model.get("label"));break;case "actionWmtRemove":this.notify("wmtTheme:remove",this.model.get("label"));break;case "actionWmtSetDefault":this.notify("wmtTheme:set_default",
this.model.get("label"))}}}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.views.themes.WmtThemeListNewItem",d.define(c,function(){c.apply(this,arguments)},{events:{"click .openAddThemePopupButton":"onWmtThemeAddPopupOpen"},template:'<div class="theme-item theme-item--wmt theme-item--add-wmt openAddThemePopupButton" role="button" tabindex="0"><div class="theme-item-add-text theme-item-add-text--wmt"><%= h(24265/*Add new*/) %></div></div>',onWmtThemeAddPopupOpen:function(){this.notify("wmtTheme:add")}}))})(toa);(function(d){var c=d.views.BaseCollectionView;d.ns("toa.views.themes.WmtThemesList",d.define(c,function(b){c.apply(this,arguments);this._newItemView=b.newItemView},{template:'<div class="theme-content wmtThemesList"></div>',_newItemView:null,childView:d.views.themes.WmtThemeListItem,childRegion:".wmtThemesList",newItemRegion:".wmtThemesList",_renderNewItem:function(b){if(this._newItemView){var c=new this._newItemView({readOnlyMode:this.readOnlyMode});this._subscribeChildView(c);this._childViews.push(c);
c.render(b,!0)}},_renderCollection:function(b){c.prototype._renderCollection.apply(this,arguments);this._renderNewItem(b)}}))})(toa);(function(d){var c=d.views.BaseView,b,e,g,k=function(b){try{return d.utils.color.isDark(b)?"white":"black"}catch(c){return"white"}};"object"===typeof _DATA&&!0===_DATA.is_mobility_app?(b="lib/oracle_jet/js/modules/",e="text!lib/oracle_jet/templates/"):(b="modules/",e="text!../templates/");d.ns("toa.views.themes.ThemeEditor",d.define(c,function(b,d){var e=document.head,g=e.getAttribute("data-resource"),k=document.createElement("link");k.rel="stylesheet";k.id="jet-alta-style";k.href=g+"/vendor/css/oj/v11.0.5/alta/oj-alta-min.css";
e.insertBefore(k,e.firstElementChild);c.apply(this,arguments);this.isReadOnly=d;this.setFormValue(b)},{template:new d.Template('<div id="toa-theme-editor-container" class="<%-isReadOnly ? \'themeEditorDisabled\' : \'\'%>">;<div id="toa-theme-editor">;<div id="theme-preview-container"></div>;<div id="themeTabsContainer" class="oj-divider-top oj-flex">;<div class="theme-tab-selector">;<oj-tab-bar class="oj-divider-end" selection="{{selectedItem}}" on-selection-changed="[[selectionChange]]">;<ul>;<li id="<%-GENERAL_TAB_KEY%>" tabindex="0">;<a href="#"><%-h(10465)%></a>;</li>;<li id="<%-LOGO_TAB_KEY%>" tabindex="1">;<a href="#"><%-h(226022)%></a>;</li>;<li id="<%-COLOR_TAB_KEY%>" tabindex="2">;<a href="#"><%-h(9004)%></a>;</li>;</ul>;</oj-tab-bar>;</div>;<div id="theme-form-container" class="oj-flex-item oj-label">;<div id="<%-GENERAL_TAB_KEY + TAB_ID_POSTFIX%>" class="mainForm theme-tab">;<div class="toa-formrow mandatory">;<div class="formLabel" id="lbl_theme_name"><%-h(226021)%><abbr class="ofsc-abbr-mandatory" title="<%-h(22351)%>">*</abbr>:</div>;<div class="formField"><input required aria-labelledby="lbl_theme_name" type="text" value="" name="theme_name"/></div>;</div>;<div class="toa-formrow mandatory">;<div class="formLabel" id="lbl_copyright"><%-h(11928)%><abbr class="ofsc-abbr-mandatory" title="<%-h(22351)%>">*</abbr>:</div>;<div class="formField">;<textarea required aria-labelledby="lbl_copyright" type="text" name="copyright"></textarea>;<div class="formNote">;<%=h(11953)%><br/>;<%=h(19801)%><br/>;<%=h(19802)%><br/>;</div>;</div>;</div>;</div>;<div id="<%-LOGO_TAB_KEY + TAB_ID_POSTFIX%>" class="mainForm theme-tab hidden">;<div class="uploadForm">;<div class="toa-formrow bigLogo mandatory">;<div class="formLabel" id="lbl_big_logo"><%-h(226022)%><abbr class="ofsc-abbr-mandatory" title="<%-h(22351)%>">*</abbr>:</div>;<div class="formField"></div>;</div>;<div class="toa-formrow loginLogo mandatory">;<div class="formLabel" id="lbl_login_logo"><%-h(226024)%><abbr class="ofsc-abbr-mandatory" title="<%-h(22351)%>">*</abbr>:</div>;<div class="formField"></div>;</div>;</div>;</div>;<div id="<%-COLOR_TAB_KEY + TAB_ID_POSTFIX%>" class="mainForm theme-tab hidden">;<div class="toa-formrow mandatory">;<div class="formLabel" id="lbl_bg_color"><%-h(226025)%><abbr class="ofsc-abbr-mandatory" title="<%-h(226013)%>">*</abbr>:</div>;<div class="formField"><input class="toa-colorpicker-input" required aria-labelledby="lbl_bg_color" type="text" value="" name="bg_color"/></div>;</div>;<div class="toa-formrow mandatory">;<div class="formLabel" id="lbl_bg_page"><%-h(226013)%><abbr class="ofsc-abbr-mandatory" title="<%-h(226012)%>">*</abbr>:</div>;<div class="formField"><input class="toa-colorpicker-input" required aria-labelledby="lbl_bg_page" type="text" value="" name="bg_page"/></div>;</div>;<div class="toa-formrow mandatory">;<div class="formLabel" id="lbl_bg_submit"><%-h(226026)%><abbr class="ofsc-abbr-mandatory" title="<%-h(11465)%>">*</abbr>:</div>;<div class="formField"><input class="toa-colorpicker-input" required aria-labelledby="lbl_bg_submit" type="text" value="" name="bg_submit"/></div>;</div>;<div class="toa-formrow mandatory">;<div class="formLabel"></div>;<div class="formField text-right">;<div class="button_wrapper">;<span id="reset-colors" class="span_link"><%-h(11919)%></span>;</div>;</div>;</div>;</div>;</div>;</div>;</div>;<div class="footerBar">;<div class="actionButtons">;<div class="buttons">;<button id="theme-dismiss"><%-h(14621 /* Cancel */)%></button>;<button id="theme-submit" class="toa-button-active"><%-h(21013 /* Save */)%></button>;</div>;</div>;</div>;<div class="oracle-jet jet-css-only screen-container" id="color-picker-container" style="display:none" dir="ltr" data-bind="ojModule: {name: \'colorpickerV2\'}"></div>;</div>'.split(";")),
render:function(b){this.element=$(this.template.apply({GENERAL_TAB_KEY:"theme-general",LOGO_TAB_KEY:"theme-logo",COLOR_TAB_KEY:"theme-color",TAB_ID_POSTFIX:"-content",isReadOnly:this.isReadOnly}));b.append(this.element);this.initFileUploaders();this.setupColorPickers();this.initEventListeners();this.setupValues();this.initThemePreviewer();this.toggleReadOnlyMode();return this.element},setupColorPickers:function(){this.initOracleJet();this.bgColor=this.element.find('[name="bg_color"]');this.bgSubmit=
this.element.find('[name="bg_submit"]');this.bgPage=this.element.find('[name="bg_page"]');this.colorPicker=new jetcolor.color(this.bgColor.get(0));this.colorPickerBtn=new jetcolor.color(this.bgSubmit.get(0));this.colorPickerPage=new jetcolor.color(this.bgPage.get(0));this.element.on("mousedown touchstart","#color-palette-container",function(b){b.stopPropagation()});this.refreshColorPickers();this.updateColorPickersFontColors()},updateColorPickersFontColors:function(){this.bgColor.css("color",k($.trim(this.bgColor.val())));
this.bgSubmit.css("color",k($.trim(this.bgSubmit.val())));this.bgPage.css("color",k($.trim(this.bgPage.val())))},initOracleJet:function(){var c=this.element.find("#themeTabsContainer"),d=this;require(["ojs/ojcore","knockout","ojs/ojknockout","ojs/ojmodule","ojs/ojnavigationlist"],function(g,k){d.tabsViewModel=new function(){this.selectedItem=k.observable("theme-general");this.selectionChange=function(b){c.find(".theme-tab").addClass("hidden");c.find("#"+b.detail.value+"-content").toggleClass("hidden")}.bind(this)};
g.ModuleBinding.defaults.modelPath=b;g.ModuleBinding.defaults.viewPath=e;g.ModuleBinding.defaults.viewSuffix=".tmpl.html";k.applyBindings(null,document.getElementById("color-picker-container"));k.applyBindings(d.tabsViewModel,document.getElementById("themeTabsContainer"))})},initEventListeners:function(){this.element.find("#theme-submit").on("click",this.submitFormButton.bind(this));this.element.find("#theme-dismiss").on("click",this.dismissFormButton.bind(this));this.element.find("#reset-colors").on("click",
this.resetColorsButton.bind(this));this.element.find("input, textarea").on("input",this.onChangeFormData.bind(this));this.bigFile.addListener("change",this.onChangeFormData.bind(this));g=this.onChangeColor.bind(this);window.addEventListener("color-changed",g)},initThemePreviewer:function(){this.themePreviewerContainer=$("#theme-preview-container");this.themePreviewer=new d.views.themes.ThemePreviewer;this.themePreviewer.render(this.themePreviewerContainer);this.themePreviewer.update(this.getFormValue())},
setupValues:function(){this.name=this.element.find('[name="theme_name"]');this.name.val(this.themeName);this.copyright=this.element.find('[name="copyright"]');this.copyright.val(this.themeCopyright)},initFileUploaders:function(){this.bigFile=new d.view.uploadFile(this.element.find(".bigLogo .formField"));this.bigFile.render("big_logo",!1,"lbl_big_logo");this.element.find(".bigLogo .formField").append($("<div/>",{text:h(11950),class:"formNote"}));this.loginFile=new d.view.uploadFile(this.element.find(".loginLogo .formField"));
this.loginFile.render("login_logo",!1,"lbl_login_logo");this.element.find(".loginLogo .formField").append($("<div/>",{text:h(11952),class:"formNote"}))},toggleReadOnlyMode:function(){this.isReadOnly&&this.element.find("input, textarea, button:not(#theme-dismiss)").attr("tabindex","-1")},getFormValue:function(){return{theme_id:this.themeId,name:$.trim(this.name.val()),bgColor:$.trim(this.bgColor.val()),bgSubmit:$.trim(this.bgSubmit.val()),bgPage:$.trim(this.bgPage.val()),copyright:$.trim(this.copyright.val()),
bigLogo:this.bigFile.getFile()||this.bigLogo,loginLogo:this.loginFile.getFile()}},setFormValue:function(b){var c=d.controllers.Themes.prototype.redwoodThemeColors;this.themeId=null;0<parseInt(b.id)&&(this.themeId=b.id);this.themeName=b.name||null;this.themeCopyright=b.copyright||null;this.themeColor=b.bgColor||c.bgColor;this.themeBtnColor=b.bgSubmit||c.bgSubmit;this.themePageBg=b.bgPage||c.bgPage;this.bigLogo=b.bigLogo?"data:image/png;base64, "+b.bigLogo:null},submitFormButton:function(){this.name.val($.trim(this.name.val()));
this.copyright.val($.trim(this.copyright.val()));this.clearErrors();this.notify("submitForm",this.getFormValue())},dismissFormButton:function(){this.notify("dismiss")},onChangeColor:function(){this.updateColorPickersFontColors();this.onChangeFormData()},onChangeFormData:function(){this.themePreviewer.update(this.getFormValue())},resetColorsButton:function(){this.resetColors();this.refreshColorPickers();this.onChangeFormData()},resetColors:function(){var b=d.controllers.Themes.prototype.redwoodThemeColors;
this.themeColor=b.bgColor;this.themeBtnColor=b.bgSubmit;this.themePageBg=b.bgPage},refreshColorPickers:function(){this.themeColor&&this.colorPicker.setColor(this.themeColor);this.themeBtnColor&&this.colorPickerBtn.setColor(this.themeBtnColor);this.themePageBg&&this.colorPickerPage.setColor(this.themePageBg)},clearErrors:function(){this.element.first().find(".formFieldError .jbf-form-row-error-wrapper").remove();this.element.first().find(".formFieldError").removeClass("formFieldError")},showErrors:function(b){b.forEach(function(b){var c=
b.inputElement.fileForm||b.inputElement,d=$('<div class="cl-err-msg jbf-form-row-error-wrapper">    <div class="jbf-form-row-error">        <div class="ico ico-error"></div>        <div class="form-field-error"></div>    </div></div>');d.find(".form-field-error").text(b.message);c.closest(".formField").addClass("formFieldError").find("> :nth-child(1)").after(d);c.closest(".formField").on("click",function(){$(this).removeClass("formFieldError").find(".jbf-form-row-error-wrapper").remove()})});0<b.length&&
this.showTabWithError(b[0])},showTabWithError:function(b){b=(b.inputElement.fileForm||b.inputElement).closest(".theme-tab").attr("id").replace("-content","");this.tabsViewModel.selectedItem(b)},destroy:function(){window.removeEventListener("color-changed",g);c.prototype.destroy.apply(this,arguments)}}))})(toa);(function(d){var c=d.views.BaseView,b=function(b){try{return 0.6>d.utils.color.getLuminance(b)}catch(c){return!0}};d.ns("toa.views.themes.ThemePreviewer",d.define(c,function(){c.apply(this,arguments)},{template:new d.Template('<div id="themePreviewer" class="oj-flex">,<div class="desktop-preview-container oj-sm-only-margin-6x-bottom oj-flex-item">,<div class="desktop-preview">,<div class="previewHeader oj-sm-12 oj-flex-item">,<div class="previewAppHeader header-part">,<div class="hamburger-button item tool-icon"></div>,<div class="logo">,<img src="" role="presentation"/>,</div>,<div class="spacer"></div>,<div class="tools item">,<div class="search-button item tool-icon"></div>,<div class="message-button item tool-icon"></div>,<div class="avatar item tool-icon"></div>,</div>,</div>,<div class="previewTitleCaption header-part">,<span class="page-name">Page Name</span>,<div class="spacer"></div>,<div class="item">,<button class="toa-button button menu-button" tabindex="-1" role="presentation">,<span>Actions</span>,<div class="toa-view-control-icon toa-button-image icon-arrow-down">&nbsp;</div>,</button>,</div>,</div>,</div>,<div class="previewBody oj-sm-12 oj-flex-item">,<div class="oj-flex body-container">,<div class="oj-sm-12 header">,<b>Header</b>,</div>,<div class="oj-sm-12 content">,<div class="oj-flex">,<p class="oj-sm-4 oj-flex-item label">Work order</p>,<div class="oj-sm-7 oj-flex-item text-content-preview">,<input type="text" tabindex="-1" role="presentation"/>,</div>,</div>,<div class="oj-flex">,<p class="oj-sm-4 oj-flex-item label">Activity type</p>,<div class="oj-sm-7 oj-flex-item text-content-preview">,<input type="text" tabindex="-1" role="presentation"/>,</div>,</div>,<div class="oj-flex">,<p class="oj-sm-4 oj-flex-item label">Comments</p>,<div class="oj-sm-7 oj-flex-item text-content-preview">,<textarea type="text" tabindex="-1" role="presentation"></textarea>,</div>,</div>,</div>,<div class="actionButtons oj-sm-12">,<div class="buttons">,<button class="toa-button" tabindex="-1" role="presentation">Dismiss</button>,<button class="toa-button toa-button-shadow-blue toa-button-active main-button" tabindex="-1" role="presentation">Submit</button>,</div>,</div>,</div>,</div>,<div class="previewFooter oj-sm-12 oj-flex-item">,<div class="oj-flex">,<div class="oj-sm-12 copyright">,<p></p>,</div>,</div>,</div>,</div>,</div>,<div class="oj-flex-item">,<div class="mobile-preview">,<div class="previewHeader oj-sm-12 oj-flex-item">,<div class="previewAppHeader header-part">,<div class="hamburger-button item tool-icon"></div>,<div class="spacer"></div>,<div class="tools item">,<div class="search-button item tool-icon"></div>,<div class="message-button item tool-icon"></div>,</div>,</div>,<div class="previewTitleCaption header-part">,<span class="page-name">Page Name</span>,<div class="spacer"></div>,<div class="options-button item tool-icon"></div>,</div>,</div>,<div class="previewBody oj-sm-12 oj-flex-item">,<div class="oj-flex body-container">,<div class="oj-sm-12 header">,<b>Header</b>,</div>,<div class="oj-sm-12 content">,<div class="oj-flex">,<p class="oj-sm-12 oj-flex-item label">Work order</p>,<div class="oj-sm-12 oj-flex-item text-content-preview">,<input type="text" tabindex="-1" role="presentation"/>,</div>,</div>,<div class="oj-flex">,<p class="oj-sm-12 oj-flex-item label">Activity type</p>,<div class="oj-sm-12 oj-flex-item text-content-preview">,<input type="text" tabindex="-1" role="presentation"/>,</div>,</div>,<div class="oj-flex">,<p class="oj-sm-12 oj-flex-item label">Comments</p>,<div class="oj-sm-12 oj-flex-item text-content-preview">,<textarea type="text" tabindex="-1" role="presentation"></textarea>,</div>,</div>,</div>,<div class="actionButtons oj-sm-12">,<div class="buttons">,<button class="toa-button" tabindex="-1" role="presentation">Dismiss</button>,<button class="toa-button toa-button-shadow-blue toa-button-active main-button" tabindex="-1" role="presentation">Submit</button>,</div>,</div>,</div>,</div>,<div class="previewFooter oj-sm-12 oj-flex-item">,<div class="oj-flex">,<div class="oj-sm-12 copyright">,<p></p>,</div>,</div>,</div>,</div>,</div>,</div>'.split(",")),
render:function(b){this.element=$(this.template.apply());this.previews=this.element.find(".desktop-preview, .mobile-preview");this.headers=this.previews.find(".previewHeader");this.submitButtons=this.previews.find("button.main-button");b.append(this.element)},update:function(c){this.previews.css("background-color",c.bgPage);this.headers.css("background-color",c.bgColor);this.submitButtons.css("background-color",c.bgSubmit);this.element.find(".logo img").attr("src",c.bigLogo||_DATA.resource_folder+
"/mobile/images/themeredwood/oracle_logo_r_dark.svg");this.element.find(".copyright p").text(c.copyright);this.headers.toggleClass("dark-mode",b(c.bgColor));this.previews.find(".buttons").toggleClass("dark-mode",b(c.bgSubmit))}}))})(toa);(function(d){d.ns("toa.CompanySettings.VisualFormEditor.classes.factory",{itemSetting:null,builder:null,collectionSidebarItems:null,layoutStructure:null,collectionConditionField:null,collectionAvailableFields:null,collectionConfiguredItems:null,collectionLanguages:null,collectionMainLayoutItems:null,collectionErrors:null,collectionItemLabels:null,collectionAvailableForms:null,collectionAvailableScreens:null,collectionAvailablePlugins:null,collectionAvailableParameters:null,collectionEntites:null,
objectDND:null,objectUndo:null,objectExpression:null,isFormContext:!1,isSectionCanBeChanged:!0,collectionFormContentItem:null,formElementService:null,availableEntities:null,objectSectionCollapse:null,readOnlyFieldsOverride:null,notAllowScanningFieldsMapper:null,dnd:function(){this.objectDND||(this.objectDND=new d.CompanySettings.VisualFormEditor.classes.DndManager);return this.objectDND},createModel:function(c){return new {field:d.CompanySettings.VisualFormEditor.models.Field,property:d.CompanySettings.VisualFormEditor.models.Field,
form_element:d.CompanySettings.VisualFormEditor.models.Field,tab:d.CompanySettings.VisualFormEditor.models.Section,section:d.CompanySettings.VisualFormEditor.models.Section,predefined_tab:d.CompanySettings.VisualFormEditor.models.Section,action:d.CompanySettings.VisualFormEditor.models.Button,form:d.CompanySettings.VisualFormEditor.models.Button,button:d.CompanySettings.VisualFormEditor.models.Button,text:d.CompanySettings.VisualFormEditor.models.Text,marker:d.CompanySettings.VisualFormEditor.models.Marker,
menu_item:d.CompanySettings.VisualFormEditor.models.Text,dictionary:d.CompanySettings.VisualFormEditor.models.Dictionary,error:d.CompanySettings.VisualFormEditor.models.BaseModel}[c.type]},getUndoManager:function(){this.objectUndo||(this.objectUndo=new d.CompanySettings.VisualFormEditor.classes.UndoManager);return this.objectUndo},getExpressionManager:function(){this.objectExpression||(this.objectExpression=new d.CompanySettings.VisualFormEditor.classes.ExpressionManager);return this.objectExpression},
getSectionCollapseManager:function(){this.objectSectionCollapse||(this.objectSectionCollapse=new d.CompanySettings.VisualFormEditor.classes.SectionCollapseManager);return this.objectSectionCollapse},getAvailableFieldCollection:function(){this.collectionAvailableFields||(this.collectionAvailableFields=new d.CompanySettings.VisualFormEditor.models.collection.AvailableFields);return this.collectionAvailableFields},getConfiguredItemsCollection:function(){this.collectionConfiguredItems||(this.collectionConfiguredItems=
new d.CompanySettings.VisualFormEditor.models.collection.ConfiguredItems);return this.collectionConfiguredItems},getLanguagesCollection:function(){this.collectionLanguages||(this.collectionLanguages=new d.CompanySettings.VisualFormEditor.models.collection.Languages);return this.collectionLanguages},getSidebarItemsCollection:function(){this.collectionSidebarItems||(this.collectionSidebarItems=new d.CompanySettings.VisualFormEditor.models.collection.Controls);return this.collectionSidebarItems},getMainLayoutItemsCollection:function(){if(!this.collectionMainLayoutItems){var c=
this.getLayoutStructure();this.collectionMainLayoutItems=new d.CompanySettings.VisualFormEditor.models.collection.structure.MainLayoutItems(c)}return this.collectionMainLayoutItems},getLayoutStructure:function(){this.layoutStructure||(this.layoutStructure=new d.CompanySettings.VisualFormEditor.models.LayoutStructure);return this.layoutStructure},getDictionary:function(){this.dictionary||(this.dictionary=new d.CompanySettings.VisualFormEditor.models.Dictionary);return this.dictionary},getErrorCollection:function(){this.collectionErrors||
(this.collectionErrors=new d.models.ObservableCollection);return this.collectionErrors},getItemLabels:function(){this.collectionItemLabels||(this.collectionItemLabels=new d.models.ObservableCollection);return this.collectionItemLabels},getAvailableFormsCollection:function(){this.collectionAvailableForms||(this.collectionAvailableForms=new d.models.ObservableCollection);return this.collectionAvailableForms},getAvailableScreensCollection:function(){this.collectionAvailableScreens||(this.collectionAvailableScreens=
new d.models.ObservableCollection);return this.collectionAvailableScreens},getAvailablePluginsCollection:function(){this.collectionAvailablePlugins||(this.collectionAvailablePlugins=new d.models.ObservableCollection);return this.collectionAvailablePlugins},getAvailableParametersCollection:function(){this.collectionAvailableParameters||(this.collectionAvailableParameters=new d.CompanySettings.VisualFormEditor.models.collection.AvailableFields);return this.collectionAvailableParameters},getEntitesCollection:function(){this.collectionEntites||
(this.collectionEntites=new d.models.ObservableCollection);return this.collectionEntites},setFormContext:function(c){this.isFormContext=c||!1},getFormContext:function(){return this.isFormContext},setSectionTypeChangeable:function(c){this.isSectionCanBeChanged=c},isSectionTypeChangeable:function(){return this.isSectionCanBeChanged},getFormElementService:function(){this.formElementService||(this.formElementService=new d.CompanySettings.VisualFormEditor.services.FormElement(this.getAvailableFieldCollection(),
this.getDictionary()));return this.formElementService},getFormContentItemCollection:function(){if(!this.collectionFormContentItem){var c=this.getContextLayout();this.collectionFormContentItem=new d.CompanySettings.VisualFormEditor.models.collection.structure.MainLayoutItems(c)}return this.collectionFormContentItem},filterFieldsList:function(c){c=c||null;var b=null,d=null,g=[];c&&c.entity&&(b=parseInt(c.entity,10));c&&c.gui&&(d={input:["text","phone","email","url"],text:["text","phone","email","url"],
phone:["text","phone","email","url"],email:["text","phone","email","url"],url:["text","phone","email","url"],checkbox:["checkbox"],combobox:["combobox","radiogroup"],radiogroup:["combobox","radiogroup"],file:["file"],signature:["signature"],geolocation:["geolocation"],image:["capture_image","image"],captureimage:["capture_image","image"],datepicker:["datetime"],timepicker:["datetime"],datetimepicker:["datetime"]}[c.gui]);c=this.getAvailableFieldCollection().models;for(var k in c){var l=c[k];!l.isAllowed()||
b&&l.getEntity()!==b||d&&-1===$.inArray(l.getGuiType(),d)||g.push({label:l.getLabel(),name:l.getName()||"",type:l.getType(),guiType:l.getGuiType()})}return g},setAvailableEntities:function(){var c=this.getAvailableFieldCollection();this.availableEntities=[];c.each(function(b){var c=b.getEntity()||null;b.isAllowed()&&c&&-1===$.inArray(c,this.availableEntities)&&this.availableEntities.push(c)},this)},getAvailableEntities:function(){this.availableEntities||this.setAvailableEntities();return this.availableEntities},
localFieldEntity:11,getReadOnlyFieldsHelper:function(){this.readOnlyFieldsOverride||(this.readOnlyFieldsOverride=new d.CompanySettings.VisualFormEditor.classes.readOnlyFields);return this.readOnlyFieldsOverride},getNotAllowScanningFieldsHelper:function(){this.notAllowScanningFieldsMapper||(this.notAllowScanningFieldsMapper=new d.CompanySettings.VisualFormEditor.classes.NotAllowScanningFields);return this.notAllowScanningFieldsMapper}})})(toa);(function(d){d.ns("toa.CompanySettings.VisualFormEditor.classes.DndManager",d.define(null,function(){this.marker=$('<div class="marker"></div>');this.dropped=!1;this.cursor={};this.state=this.state_default={is_first_in_action_bar:!1,is_first_in_column:!1,is_last_in_column:null}},{saveState:function(c,b){this.state[c]=b},dragStart:function(c,b){this.clear();this.dragModel=c;this.dropped=!1;this.cursor=this.getPosition(b)},dragStop:function(){$("div.marker").removeClass("markerFirst");this.state=this.state_default;
this.clear()},drag:function(c,b,d){},dropAccept:function(c,b){var d=this.getPosition(b),g=Math.abs(this.cursor.posX-d.posX),d=Math.abs(this.cursor.posY-d.posY);return 25>Math.max(g,d)?!1:!!(this.isDragLayoutItem()&&this.isDropToMainLayout(c)||this.isDragButton()&&this.isDropToMainLayout(c)||this.isDragButton()&&this.isDropToActionPanel(c))},getPosition:function(c){var b,d;"undefined"!==typeof window.event?(b=window.event.clientX,d=window.event.clientY):"undefined"!==typeof c&&(b="undefined"!==typeof c.offsetX?
c.clientX:c.offset.left,d="undefined"!==typeof c.offsetY?c.clientY:c.offset.top);return{posX:b,posY:d}},isDragLayoutItem:function(){return this.dragModel instanceof d.CompanySettings.VisualFormEditor.models.BaseLayoutItem},isDragButton:function(){return this.dragModel instanceof d.CompanySettings.VisualFormEditor.models.Button},isDropToMainLayout:function(c){return!(c.collection instanceof d.CompanySettings.VisualFormEditor.models.collection.structure.ActionPanelButtons)&&(c instanceof d.CompanySettings.VisualFormEditor.models.Marker||
c instanceof d.CompanySettings.VisualFormEditor.models.collection.Sections||c instanceof d.CompanySettings.VisualFormEditor.models.BaseLayoutItem||c instanceof d.CompanySettings.VisualFormEditor.models.collection.structure.MainLayoutItems)},isDropToActionPanel:function(c){return c instanceof d.CompanySettings.VisualFormEditor.models.collection.structure.ActionPanelButtons||c instanceof d.CompanySettings.VisualFormEditor.models.Button},dropOver:function(c,b,d,g){this.timeoutOver&&clearTimeout(this.timeoutOver);
this.timeoutOver=setTimeout(function(){this.timeoutOver=null;c.notify("appendMarker",{marker:this.marker,ui:d},g)}.bind(this),80)},dropOut:function(){this.marker.detach()},isDropped:function(){return this.dropped},drop:function(c,b,e,g){b=0;var k=!1;clearTimeout(this.timeoutOver);0<$(this.marker).parent().length&&(b=$(this.marker).parent().children().eq(1).attr("data-id"),k=$(this.marker).parent().hasClass("column_content"));this.marker.detach();this.dragModel instanceof d.CompanySettings.VisualFormEditor.models.Field&&
this.dragModel.isLocal()&&this.dragModel.prepareNew();this.dragModel.set({highlightItem:!0});if(k||!0!=this.state.is_first_in_action_bar)if(k&&!0==this.state.is_first_in_column){if("undefined"!==typeof c.appendBefore){var l=k=g=null;g=c.get(b);"undefined"!==typeof c.collection&&(k=c.collection._byId[b]||null,l=c.collection._byUid[b]||null);c.appendBefore(this.dragModel,g||k||l||null)}}else g?"undefined"!==typeof columnOffsetTop&&columnOffsetTop==markerOffsetTop?c.appendBefore(this.dragModel,g):c.appendAfter(this.dragModel,
g):null!==this.state.is_last_in_column?(g=b=null,"undefined"!==typeof c.collection&&(b=c.collection._byId[this.state.is_last_in_column]||null,g=c.collection._byUid[this.state.is_last_in_column]||null),"undefined"!==typeof c.appendAfter&&(b||g)?c.appendAfter(this.dragModel,b||g):c.append(this.dragModel)):c.append(this.dragModel);else"undefined"!==typeof c.appendBefore&&c.appendBefore(this.dragModel,c.get(b)||null);$(e.helper).remove();this.dropped=!0;this.state=this.state_default},clear:function(){this.dragModel=
null;this.state=this.state_default}}))})(toa);(function(d){d.ns("toa.CompanySettings.VisualFormEditor.classes.UndoManager",d.define(null,function(){this.collections={};this.undo=[];this.changesCount=0},$.extend({},d.mixins.EventEmitter,{addCollection:function(c,b){this.collections[c]=b},prepareOptions:function(c,b,d,g){var k=c||{};g=g||"";var l=["field","property","form_element","form","action"];if("undefined"!==typeof b.attributes.type&&"undefined"!==typeof d.attributes.type){if("marker"===b.attributes.type||"marker"===d.attributes.type)k.withMarker=
!0;"marker"!==b.attributes.type&&(k.elmType=b.attributes.type);"section"===b.attributes.type&&"section"===d.attributes.type&&(k.sectionAfterSection=!0);l.includes(b.attributes.type)&&l.includes(d.attributes.type)&&(k.simpleType=!0)}c.debug=g;return k},addStep:function(c){var b,d={},g=this.getLastIndex();for(b in this.collections)d[b]=this.collections[b].clone();g&&g.LastStep&&delete g.LastStep;d=Object.assign(c,d);d.LastStep=!0;this.undo.push(d);this.changesCount++;4==this.undo.length&&this.undo.shift();
this.notify("add")},getLastIndex:function(){return 0<this.undo.length?this.undo[this.undo.length-1]:null},getLastStep:function(){return this.undo.pop()},clear:function(){this.changesCount=0;this.removeSteps()},hasChanges:function(){return 0<this.changesCount},removeSteps:function(c){this.undo=[];this.notify("removeAll")},getUndoArray:function(){return this.undo},runUndo:function(){var c,b;if(0!=this.undo.length&&(!this.getLastIndex()||this.getLastIndex().LastStep)){c=this.getLastStep();"undefined"!==
typeof c&&"undefined"===typeof c.withMarker&&(this.changesCount--,b=Object.assign({},c),c=this.getLastStep());var d=null;if(!b||"undefined"===typeof b.simpleType){do{if("undefined"===typeof c||"undefined"===typeof c.withMarker&&"undefined"===typeof c.sectionAfterSection)break;if("undefined"!==typeof c.elmType&&"section"==c.elmType){if(!0===d)break;d=!0}this.changesCount--;b=Object.assign({},c);c=this.getLastStep()}while("undefined"!==typeof c)}null!==b&&this.__rewriteCollections(b);this.notify("undoStep");
this.removeSteps()}},__rewriteCollections:function(c){for(i in this.collections)this.collections[i].clear(),c[i].each(function(b){this.collections[i].add(b)}.bind(this))},destroy:function(){this.collections={};this.undo=[];this.changesCount=0}})))})(toa);(function(d){d.ns("toa.CompanySettings.VisualFormEditor.classes.ExpressionManager",d.define(null,function(){},{idMap:{},propertyMap:{},enumPropertiesMap:{},entityMap:{1:"activity",2:"inventory",3:"resource",5:"request",9:"user",11:""},lookupFields:["aworktype","invtype","srtype","ptype","user_type_id"],numberRegEx:RegExp(/^(([1-9]\d*)|0)((\.\d*[1-9])|)$/),initLookups:function(c){c.each(function(b){var c=b.get("entity",""),d=b.get("property_id",""),k=b.get("label","");c&&d&&k&&("undefined"===typeof this.propertyMap[c]&&
(this.propertyMap[c]={}),this.propertyMap[c][d]=k,-1!==$.inArray(k,this.lookupFields)&&"undefined"!==b.get("lookups")&&(this.idMap[k]={},$.each(b.get("lookups",[]),function(b,c){var d=c.id+"";this.idMap[k][d]=c.label||d}.bind(this))),"undefined"!==typeof b.get("lookups")&&""!==b.get("lookups")&&(this.enumPropertiesMap[k]=1))}.bind(this))},expressionToConditions:function(c){if(null===c)return[];throw Error("Not implemented yet");},conditionsToExpression:function(c){c=c.map(function(b){var c=b.entity||
null,d=b.field?b.field+"":"",k=b.condition,l=b.value;if(!this.entityMap.hasOwnProperty(c)&&null!==c)throw Error("Entity "+c+" is not recognized");var n="";"property"===d?(n=b.property_id||"",n=this.propertyMap[c]&&this.propertyMap[c][n]||n):n=this.propertyMap[c]&&this.propertyMap[c][d]||d;"user_type_id"===n&&(n="type");var c=null!==c&&this.entityMap[c]&&""!=this.entityMap[c]?this.entityMap[c]+".":"",c=c+("`"+n+"`"),p=null;switch(k){default:throw Error("Unknown condition type: "+b);case "in":case "not_in":p=
c+" IN ("+this._toArguments(d,l)+")";break;case "contains":case "dcontain":p=this._makeContainsSection("type"===n?d:n,c,l);break;case "is_null":case "is_not_null":p="empty("+c+")"}"aworktype"===d&&(p="("+p+" OR "+p.replace(RegExp(d,"g"),d+"_group")+")");switch(k){case "not_in":case "dcontain":case "is_not_null":p="NOT "+p}return p}.bind(this));return 0<c.length?"("+c.join(")\nAND\n(")+")":null},_makeContainsSection:function(c,b,d){var g="";if(this._isEnumProperty(c)){g=[];d=d.split(",");for(var k in d)g.push(b+
" CONTAINS "+this._toStringLiteral(-1!==this.lookupFields.indexOf(c)?c:b,d[k]));g="(\n"+g.join(" OR \n")+"\n)"}else g=b+" CONTAINS "+this._toStringLiteral(b,d);return g},_toStringLiteral:function(c,b){b=b?(b+"").trim():"";if(this.idMap.hasOwnProperty(c)){var d=this.idMap[c];d.hasOwnProperty(b)&&(b=d[b]+"")}return this.numberRegEx.test(b)?b:this._putInQuotesAndEscape(b)},_toArguments:function(c,b){return(b?b+"":"").split(",").map(this._toStringLiteral.bind(this,c)).join(", ")},_isEnumProperty:function(c){return"undefined"!==
typeof this.enumPropertiesMap[c]},_escapeQuotes:function(c){return c.replace(/'/g,"\\'")},_putInQuotesAndEscape:function(c){return"'"+this._escapeQuotes(c)+"'"},destroy:function(){this.idMap={};this.propertyMap={}}}))})(toa);(function(d){d.ns("toa.CompanySettings.VisualFormEditor.classes.SectionCollapseManager",d.define(null,function(){this.collapsedSections=[]},{getCollapsedSections:function(){return this.collapsedSections||[]},addToCollapsed:function(c){this.isSectionCollapsed(c)||this.collapsedSections.push(c)},removeFromCollapsed:function(c){this.isSectionCollapsed(c)&&(this.collapsedSections=this.collapsedSections.filter(function(b){return b!==c}))},isSectionCollapsed:function(c){return-1!==$.inArray(c,this.collapsedSections)},
clearCollapsed:function(){this.collapsedSections=[]},updateSectionIds:function(c){if((c=c||{})&&!$.isEmptyObject(c)){var b=this.getCollapsedSections();$.each(b,function(b,d){if(c[d]){var k=""+c[d];this.removeFromCollapsed(d);this.addToCollapsed(k)}}.bind(this))}}}))})(toa);toa.ns("toa.CompanySettings.VisualFormEditor.classes.readOnlyFields",toa.define(null,function(){this.contextList=["mobile_activity_details"];this.additionalReadOnlyRules={activity_workskills:["mobile_end_activity","mobile_notdone_activity","mobile_cancel_activity","mobile_start_activity","mobile_suspend_activity"],activity_flow:["mobile_end_activity","mobile_notdone_activity","mobile_cancel_activity","mobile_suspend_activity","mobile_reopen_activity"]};this.formsReadOnlyFields={1:[],3:["pid"]};this.contextReadOnlyFields=
{1:"activity_capacity_categories activity_workskills auto_routed_to_provider_name first_manual_operation_user_login first_manual_operation_user_name ETA acoord_status acoord_x acoord_y travel activity_compliance acoord_accuracy uid aid astatus atravelarea atype auto_routed_to_date auto_routed_to_provider_id aworkzone date delivery_window end_time eta_end_time first_manual_operation first_manual_operation_interface first_manual_operation_user_id service_window time_delivered atime_of_assignment atime_of_booking pid travel_estimation_method access_hours activity_flow".split(" ")};
this.formsReadOnlyFields["1"]=this.contextReadOnlyFields["1"].slice(0);this.formsReadOnlyFields["1"].push("position_in_route")},{isReadOnlyField:function(d,c){if(1==c||3==c){if(this.contextIsForm())return-1!==$.inArray(d,this.formsReadOnlyFields[c.toString()]);if(this.fieldHasAdditionalReadOnlyRules(d))return!0;if(this.contextSupportsReadOnlyOverrides())return-1!==$.inArray(d,this.contextReadOnlyFields[c.toString()])}return!1},fieldHasAdditionalReadOnlyRules:function(d){if("undefined"!==typeof this.additionalReadOnlyRules[d]){var c=
toa.CompanySettings.VisualFormEditor.classes.factory.getLayoutStructure().get("context_label");if(-1!==$.inArray(c,this.additionalReadOnlyRules[d]))return!0}return!1},contextSupportsReadOnlyOverrides:function(){var d=toa.CompanySettings.VisualFormEditor.classes.factory.getLayoutStructure().get("context_label");return-1!==$.inArray(d,this.contextList)},contextIsForm:function(){if(toa.CompanySettings.VisualFormEditor.classes.factory.getFormContext())return!0}}));toa.ns("toa.CompanySettings.VisualFormEditor.classes.NotAllowScanningFields",toa.define(null,function(){this.notAllowScanningFieldsMapper={1:"access_schedule access_hours activity_compliance activity_alerts sla_window_end sla_window_start travel pid time_slot apoints acoord_x acoord_y length cname appt_number ccell cemail cphone customer_number cstate czip ccity caddress first_manual_operation first_manual_operation_interface first_manual_operation_user_id first_manual_operation_user_login first_manual_operation_user_name auto_routed_to_date auto_routed_to_provider_id auto_routed_to_provider_name atime_of_assignment atime_of_booking activity_capacity_categories acoord_status date eta_end_time delivery_window end_time time_delivered aworkzone aid astatus ETA service_window travel_estimation_method atype activity_workskills acoord_accuracy activity_flow".split(" "),
2:"inv_change_invid inv_pid inv_aid invid invpool quantity".split(" "),3:"pid skip_days_for_stats reactivated oncall_calendar resource_workzones resource_effective_workskills resource_time_slots resource_capacity_categories resource_workskills calendar queue_status total pending alerts pname external_id email pphone".split(" "),5:"srcreated appt_ident srid sr_uid sr_pid sr_aid sr_invid srdate uname sr_body".split(" "),9:"uid sucreated login_attempts login_blocked_to last_login last_password_change suupdated refresh_rate uname mobile_provider_count mobile_activity_count mobile_inventory_count collab_assigned_user_group collab_operator_helpdesk ulogin password uphone main_resource_id".split(" ")}},
{isAllowScanning:function(d,c){if(!c)return!1;"string"!==typeof c&&c.toString&&(c=c.toString());return c&&this.notAllowScanningFieldsMapper.hasOwnProperty(c)?-1===$.inArray(d,this.notAllowScanningFieldsMapper[c]):!0}}));(function(d){d.ns("toa.CompanySettings.VisualFormEditor.services.FormElement",d.define(null,function(c,b){this._defaultLabel="form_element";this._defaultEntity=11;this.fieldCollection=c;this.dictionary=b},{tryTosetDictionaryDataToFields:function(){for(var c=this.dictionary.getDictionaryConditions(),b=0;b<c.length;b++){var d=this.createInstanceOfConditionDictionary(c[b]);if("undefined"!==typeof d.property_id&&d.property_id&&"0"!=d.property_id)this.fieldCollection.get(d.property_id)||this.fieldCollection.add(this.__createFakeField(d));
else{var g=this.fieldCollection.getByLabelEntity(d.field,d.entity);g?d.property_id=g.getId():(d.property_id=this.__getUid(),this.fieldCollection.add(this.__createFakeField(d)));c[b][4]=d.property_id}}},__getUid:function(){return(new Date).getTime().toString(36)+"_"+(Math.random().toString(16)+"000000000").substr(2,8)},updateElement:function(c){if(c.getId()){var b=this.fieldCollection.get(c.getId());if(b){var d=b.getLabel(),g=c.getLabel();d&&g&&d!==g&&(d=b.clone(),d.id=d.uid,d=this.__createField(d),
this.fieldCollection.add(d),this.__updateDictionary(d.getId(),b.getId()));c=this.__createField(c);this.fieldCollection.remove(b);this.fieldCollection.add(c)}else this.__tryFindByLabel(c)}},setToFieldCollection:function(c){c.getId()&&(this.__tryFindByLabel(c),this.fieldCollection.get(c.getId())||this.fieldCollection.add(this.__createField(c)))},__tryFindByLabel:function(c){var b=this.fieldCollection.getByLabel(c.get("label"));b&&b.isFormElement()&&(this.__updateDictionary(c.getId(),b.getId()),this.fieldCollection.remove(b),
this.fieldCollection.add(this.__createField(c)))},__updateDictionary:function(c,b){this.dictionary.updateConditionsPropertyId(c,b)},removeInFieldCollection:function(c){},__createField:function(c){var b=c.get("translations"),b={item_id:c.getId(),label:c.get("label"),property_id:c.getId(),field:c.get("label"),translations:b&&b.toJSON?b.toJSON():[],gui:c.get("gui"),type:c.get("type"),entity:c.get("entity",this._defaultEntity),canBeUsedInCondition:!1,condition:!0,allowed:!1};c.isEnumeration()&&(b.lookups=
this.__prepareValues(c.get("values",[])));return this.createInstanceOfField(b)},__createFakeField:function(c){return this.createInstanceOfField({item_id:c.property_id,label:c.field,property_id:c.property_id,translations:[],type:"form_element",entity:"undefined"!==typeof c.entity?c.entity:this._defaultEntity,canBeUsedInCondition:!1,condition:!0,allowed:!1})},getValueName:function(c){return c[_DATA.ulanguage||this.DEFAULT_LANG_ID||1]},__prepareValues:function(c){for(var b=[],d=0;d<c.length;d++)b.push({id:c[d].label,
label:c[d].label,text:this.getValueName(c[d].translations)});return b},createInstanceOfConditionDictionary:function(c){return{field:c[0],condition:c[1],value:c[2],entity:c[3],property_id:c[4]}},clearCollectionFieldsFormElems:function(){for(var c=this.fieldCollection,b=0;b<c.getCount();b++){var d=c.models[b];"undefined"!==typeof d&&d.isFormElement()&&(c.remove(d),b--)}},createInstanceOfField:function(c){return new d.CompanySettings.VisualFormEditor.models.AvailableField(c)},getNewLabel:function(){var c=
this.getFormElementNextIndex();return this._defaultLabel+"#"+c},getFormElementNextIndex:function(){for(var c=1,b=d.CompanySettings.VisualFormEditor.classes.factory.getItemLabels().formElementIndexes||[];-1!==$.inArray(c,b);)c++;b.push(c);return c}}))})(toa);(function(d){d.ns("toa.CompanySettings.VisualFormEditor.validators.PluginParameterValidator",d.define(null,function(c){this._params=c;this._errors=[]},{LINK_PARAMETER_MAX_NAME_LENGTH:248,LINK_PARAMETER_MAX_VALUE_LENGTH:4E3,LINK_PARAMETER_MAX_TOTAL_LENGTH:5E3,validate:function(c,b){this._errors=[];c.length>this.LINK_PARAMETER_MAX_NAME_LENGTH&&this._errors.push(r(16917,{"{FIELD}":r(19974),"{LENGTH}":this.LINK_PARAMETER_MAX_NAME_LENGTH}));b.length>this.LINK_PARAMETER_MAX_VALUE_LENGTH&&this._errors.push(r(16917,
{"{FIELD}":r(19975),"{LENGTH}":this.LINK_PARAMETER_MAX_VALUE_LENGTH}));this._validateTotalLength(c,b);return 0===this._errors.length},getErrors:function(){return this._errors},_validateTotalLength:function(c,b){for(var d=0,g=0;g<this._params.length;g++)c!==this._params[g].field&&(d+=this._params[g].field.length,d+=this._params[g].value.length);d+=c.length;d+=b.length;d>this.LINK_PARAMETER_MAX_TOTAL_LENGTH&&this._errors.push(r(23674,{"{MAX_TOTAL_LENGTH}":this.LINK_PARAMETER_MAX_TOTAL_LENGTH}))}}))})(toa);(function(d){d.ns("toa.CompanySettings.VisualFormEditor.views.BaseView",d.define(null,function(c){this.model=c},$.extend({},d.mixins.EventEmitter,{views:[],iTranslations:[],iLanguages:[],destroyOnce:!1,render:function(){},getElement:function(){return this.element},getContainer:function(){return this.element},append:function(c){c&&this.getContainer().append(c.getElement())},createItems:function(c){(c=this.__tryTocreateView(c))&&c instanceof d.CompanySettings.VisualFormEditor.views.SelectableItem&&
c.render();this.views.push(c);return c},__tryTocreateView:function(c){var b=null;c instanceof d.CompanySettings.VisualFormEditor.models.Section?b=new d.CompanySettings.VisualFormEditor.views.Section(c):c instanceof d.CompanySettings.VisualFormEditor.models.Field?b=c.isHidden()?new d.CompanySettings.VisualFormEditor.views.Hidden(c):new d.CompanySettings.VisualFormEditor.views.Field(c):c instanceof d.CompanySettings.VisualFormEditor.models.Button?b=new d.CompanySettings.VisualFormEditor.views.Button(c):
c instanceof d.CompanySettings.VisualFormEditor.models.Text&&(b=new d.CompanySettings.VisualFormEditor.views.Text(c));return b},initEvent:function(){this.model.addListener("changeName",this.changeName.bind(this))},changeName:function(c,b){""===b.trim()&&(b=this.model.getName()||"");this.setUpdatedName(b)},fetchNamesOrLabels:function(c,b){if(!(b instanceof d.CompanySettings.VisualFormEditor.models.AvailableField))throw"Second parameter should be instance of toa.CompanySettings.VisualFormEditor.models.AvailableField";
var e,g=[],k;if(("string"===typeof c||c instanceof String)&&""!==c){e=c.split(",");if(!b.hasLookups()&&!b.isEnumeration())return e;for(var l=b.getLookups(),n=0;n<e.length;n++){k=!1;if(l)for(var p in l)l[p].id==e[n]&&(g.push(l[p].text),k=!0);k||g.push("["+e[n]+"]")}}return g},setUpdatedName:function(c){},showPopup:function(c,b){var e=[{text:h(14621),position:"left",click:function(){g.destroy();b.destroy()}.bind(this)},{text:h(12),type:"submit",position:"right",click:function(){b.notify("action:save");
g.destroy()}.bind(this)}],g=new d.ui.Popup({title:c,autoOpen:!0,view:b,modal:!0,onClose:function(){g.destroy()},buttons:e})},initDraggable:function(c){c=c||{};this.getElement().draggable($.extend({},{handle:".caption, .caption input",addClasses:!1,helper:"clone",scroll:!1,cancel:"input",refreshPositions:!0,cursorAt:{top:-5,left:-5},start:this.onDragStart.bind(this),stop:this.onDragStop.bind(this),drag:this.onDrag.bind(this)},c))},initDroppable:function(c){c=c||{};this.getElement().droppable($.extend({},
{greedy:!0,over:this.onDropOver.bind(this),out:this.onDropOut.bind(this),drop:this.onDrop.bind(this),accept:this.onDropAccept.bind(this),tolerance:"pointer"},c))},dragAndDrop:function(){return d.CompanySettings.VisualFormEditor.classes.factory.dnd()},onDragStart:function(c,b){d.CompanySettings.VisualFormEditor.classes.factory.dnd().dragStart(this.model,c,b)},onDragStop:function(c,b){d.CompanySettings.VisualFormEditor.classes.factory.dnd().dragStop(this.model,c,b)},onDrag:function(c,b){d.CompanySettings.VisualFormEditor.classes.factory.dnd().drag(this.model,
c,b)},onDropOver:function(c,b){d.CompanySettings.VisualFormEditor.classes.factory.dnd().dropOver(this.model,c,b)},onDropOut:function(c,b){d.CompanySettings.VisualFormEditor.classes.factory.dnd().dropOut(this.model,c,b)},onDropAccept:function(c,b){return d.CompanySettings.VisualFormEditor.classes.factory.dnd().dropAccept(this.model,c,b)},onDrop:function(c,b){if(d.CompanySettings.VisualFormEditor.classes.factory.dnd().isDropped())return!1;d.CompanySettings.VisualFormEditor.classes.factory.dnd().drop(this.model,
c,b)},empty:function(){this.getElement().empty()},_isOneLanguage:function(){return 1==d.CompanySettings.VisualFormEditor.classes.factory.getLanguagesCollection().getCount()},getLanguageElem:function(){var c,b,e,g;c=this.model.get("names");e=this.model.get("translations");g=d.CompanySettings.VisualFormEditor.classes.factory.getLanguagesCollection().models[0];b=e.get(g.getId());c=c.get(g.getId());b||(b=new d.CompanySettings.VisualFormEditor.models.Translation({id:g.getId()}),this.iTranslations.push(b),
e.add(b));b=new d.CompanySettings.VisualFormEditor.views.itemSetting.Language(b);b.render(c);b.addListener("changeName",this.onChangeName.bind(this));b.addListener("vfe-item-before-update",function(){this.notify("vfe-item-before-update",this)}.bind(this));this.iLanguages.push(b);return b.getElement()},renderLanguage:function(){var c=this.element.find(".sectionContent"),c=0==c.length?this.element.closest(".sectionContent"):c;c.append(this.getLanguageElem())},onChangeName:function(c,b){this.model.notify("changeName",
b)},destroy:function(c){if(this.element){try{this.element.draggable("destroy")}catch(b){}this.element.remove()}if(this.model)try{this.model.reset()}catch(d){}if(this.items&&0<this.items.length)for(var g in this.items)this.items[g].destroy(),delete this.items[g];var k=!1;if(this.childSections)for(g in this.childSections)if(k=this.childSections[g],k.container.remove(),k.container=null,k.collapseControl&&(k.collapseControl.remove(),k.collapseControl=null),k._events_uids)for(var l in k._events_uids)k.removeListener(parseInt(l));
k=!1;if(!$.isEmptyObject(this.attributes))for(var n in this.attributes){if((k=this.attributes[n])&&"object"===typeof k)for(g in $.isEmptyObject(k.models)||($.each(k.models,function(b,c){c.destroy.apply(c)}.bind(this)),k.models=[]),k._events_uids)k.removeListener(parseInt(g));k=null;delete this.attributes[n]}if(!$.isEmptyObject(this.changes))for(var p in this.changes){if((k=this.changes[p])&&"object"===typeof k)for(g in $.isEmptyObject(k.models)||($.each(k.models,function(b,c){c.destroy.apply(c)}.bind(this)),
k.models=[]),k._events_uids)k.removeListener(parseInt(g));k=null;delete this.changes[p]}if(c&&"boolean"===typeof c&&!this.destroyOnce&&(this.destroyOnce=!0,0<this.views.length))for(g in this.views){try{this.views[g].destroy()}catch(s){}delete this.views[g]}this.template&&this.template.destroy(!0)}})))})(toa);(function(d){d.ns("toa.CompanySettings.VisualFormEditor.views.Layout",d.define(d.CompanySettings.VisualFormEditor.views.BaseView,function(){var c="";d.CompanySettings.VisualFormEditor.classes.factory.getFormContext()||(c='<div class="wysiwyg-action-content"></div>');this.template=new d.Template(['<div id="toa-wysiwyg">','<div class="sidebar"></div>','<div class="wysiwyg-content">',c,'<div class="wysiwyg-layout"></div>','<div class="wysiwyg-footer"></div>',"</div>","</div>"])},{attachOracleJet:function(){var c=
window.setTimeout(function(){if(!document.querySelector("#jet-alta-style")){var b=document.head,d=document.createElement("link");d.rel="stylesheet";d.id="jet-alta-style";d.href=b.getAttribute("data-resource")+"/vendor/css/oj/v11.0.5/alta/oj-alta-min.css";b.insertBefore(d,b.firstElementChild);window.clearTimeout(c)}},200)},render:function(){this.attachOracleJet();this.element=$(this.template.apply());return this}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.visibility.ConditionRow",d.define(c,function(){c.apply(this,arguments);this.initValueList();this.conditionTranslations={"in":d.glossary({id:11456}),not_in:d.glossary({id:11457}),contains:d.glossary({id:11458}),dcontain:d.glossary({id:11459}),is_null:d.glossary({id:11460}),is_not_null:d.glossary({id:11461})};this.exceptedFieldsArr="resource_workskills resource_effective_workskills resource_workzones queue_status reactivated total pending alerts calendar oncall_calendar resource_capacity_categories resource_time_slots date time_slot service_window activity_flow".split(" ")},
$.extend({},d.mixins.EventEmitter,{template:new d.Template(['<div class="wysiwyg-visibility-condition" data-id="<%-label%>" data-index=<%-index%>>','<div class="wysiwyg-visibility-condition-content"></div>','<div class="delete-condition" role="button" tabindex="0" />',"</div>"]),templateProperty:new d.Template('<div class="wysiwyg-properties-list-wrapper">,<select class="wysiwyg-properties-list">,<%  for(var i = 0; i < propertiesList.length; i++) { %>,<option  <%=propertiesList[i].selected%> ,<%-propertiesList[i].disabled%> ,value="<%=propertiesList[i].id%>">,<%=propertiesList[i].text%> [<%=propertiesList[i].label%>],</option>,<% } %>,</select>,</div>'.split(",")),
templateCondition:new d.Template('<div class="wysiwyg-conditions-list-wrapper">;<select class="wysiwyg-conditions-list">;<% for(var condition in condititions) { %>;<option value="<%-condition%>"><%=condititions[condition]%></option>;<% } %>;</select>;</div>'.split(";")),templateFormInput:new d.Template(['<div class="wysiwyg-condition-value-wrapper">','<input type="text" class="wysiwyg-condition-value" />',"</div>",'<div class="clear"></div>']),templateFormSelect:new d.Template('<div class="wysiwyg-condition-value-wrapper">;<button class="toa-button">;<%-h(15029)/*Select value*/%><span class="arrow"></span>;</button>;</div>;<div class="clear"></div>;<div class="wysiwyg-add-enum-result"></div>'.split(";")),
templateError:new d.Template(['<div class="wysiwyg-condition-error fieldError">','<div class="errorText"><%- errorText %></div>',"</div>"]),render:function(b){var c;this.element=$(this.template.apply({index:this.model.getId(),label:this.getConditionLabel()}));this.property=$(this.templateProperty.apply({propertiesList:this.getConditionField()}));this.condition=$(this.templateCondition.apply({condititions:this.conditionTranslations}));this.input=$(this.templateFormInput.apply({}));this.select=$(this.templateFormSelect.apply({}));
c=this.element.find(".wysiwyg-visibility-condition-content");this.property.appendTo(c);this.condition.appendTo(c);this.initEvent();this.setValuesForm();this.setConditionError(b||!1);return!0},getConditionField:function(){var b=[],c,g,k,l,n=this;g=d.CompanySettings.VisualFormEditor.classes.factory.getAvailableFieldCollection();k=d.CompanySettings.VisualFormEditor.classes.factory.getLayoutStructure();g.defineUnusedFormElements(k);property="property"==this.model.get("field")?g.get(this.model.get("property_id")):
g.getByLabel(this.model.get("field"));c=this.model.get("property_id");property&&(c=property.get("property_id"));g.each(function(d){!d.get("condition",0)||d.getId()!=c&&-1!==n.exceptedFieldsArr.indexOf(d.get("label"))||(l=d.isDisabledCondition(),b.push({id:d.getId(),label:d.get("label"),text:d.getName(),selected:l||d.getId()!=c?"":'selected="selected"',disabled:l?"disabled":""}))});return b},getConditionLabel:function(){var b=this.getConditionField(),c="";Object.keys(b).forEach(function(d){""!=b[d].selected&&
(c=b[d].id+"_"+b[d].label)});return c},initValueList:function(){this.valueList=new d.CompanySettings.VisualFormEditor.views.visibility.ValueList(this.model)},initEvent:function(){this.element.find(".delete-condition").on("click",this.onDelete.bind(this));this.property.find("select").on("change",this.onChangeProperty.bind(this));this.condition.find("select").on("change",this.onChangeCondition.bind(this));this.valueList.addListener("selected",this.onChangeValueList.bind(this));this.select.find("button").on("click",
this.onClickValueList.bind(this));this.input.find(".wysiwyg-condition-value").on("input",this.onChangeValue.bind(this))},onClickValueList:function(){var b;b=d.CompanySettings.VisualFormEditor.classes.factory.getAvailableFieldCollection().get(this.property.find("select").val());this.valueList.render(this.select.find(".toa-button"),b)},onChangeProperty:function(){var b;b=d.CompanySettings.VisualFormEditor.classes.factory.getAvailableFieldCollection().get(this.property.find("select").val());this.model.set({entity:b.get("entity"),
field:-1<["field","form_element"].indexOf(b.get("type"))?b.get("label"):"property",property_id:"field"==b.get("type")?0:b.getId(),value:"",condition:"in"});this.setValuesForm()},onChangeCondition:function(){this.model.set({condition:this.condition.find("select").val()})},onChangeValue:function(b){b=this.input.find("input").val();this.model.set({value:b})},onChangeValueList:function(b,c){this.model.set({value:c.join(",")});this.setValuesForm()},onDelete:function(){this.element.remove();this.model.remove()},
showPropertyValue:function(){var b;b=this.element.find(".wysiwyg-visibility-condition-content");this.input.detach();this.select.detach();this.select.find(".wysiwyg-add-enum-result").empty();d.CompanySettings.VisualFormEditor.classes.factory.getAvailableFieldCollection().get(this.property.find("select :selected").val()).get("lookups")?this.select.appendTo(b):this.input.appendTo(b)},setValuesForm:function(){var b;b=[];b=d.CompanySettings.VisualFormEditor.classes.factory.getAvailableFieldCollection();
if(b="property"==this.model.get("field")||this.model.get("property_id",null)?b.get(this.model.get("property_id")):b.getByLabelEntity(this.model.get("field"),this.model.get("entity")))this.property.find("select").val(b.get("property_id")),this.condition.find("select").val(this.model.get("condition")),this.showPropertyValue(),b=this.fetchNamesOrLabels(this.model.get("value",""),b),0!==this.element.find(".wysiwyg-add-enum-result").length&&this.element.find(".wysiwyg-add-enum-result").empty().append(b.join(", ")),
0!==this.element.find(".wysiwyg-condition-value").length&&this.element.find(".wysiwyg-condition-value").val(this.model.get("value"))},setConditionError:function(b){(b=b||!1)&&this.element.append($(this.templateError.apply({errorText:b})))}})))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.visibility.BaseForm",d.define(c,function(b,d){c.apply(this,arguments);this.expressionError=d||null;this.cloneModel();this.initConditionForm()},{expressionError:null,skipConditionValidation:!1,setOptions:function(b){this.options=b},hasExpression:function(){var b=this.cloneModel.get("expression",null);return null!==b&&""!==b},initConditionForm:function(){this.hasExpression()?this.initExpressionForm():
this.initConditionsConstructor()},initExpressionForm:function(b,c){b=b||this.cloneModel.get("expression","");this.conditionForm=new d.CompanySettings.VisualFormEditor.views.visibility.Expression(b,c||!1,this.expressionError);this.conditionForm.addListener("show_constructor",this.onShowConstructor.bind(this))},initConditionsConstructor:function(){this.conditionForm=new d.CompanySettings.VisualFormEditor.views.visibility.ConditionDictionary(this.cloneModel.get("conditions"));this.conditionForm.addListener("show_expression",
this.onShowExpression.bind(this));this.conditionForm.setConditionErrors(this.cloneModel.get("conditionErrors",{}))},onShowExpression:function(b){this.skipConditionValidation=!0;b=this.generateExpression();this.initExpressionForm(b,!0);this.renderConditionsForm()},onShowConstructor:function(b){this.skipConditionValidation=!1;this.initConditionsConstructor();this.renderConditionsForm()},renderConditionsForm:function(){this.conditionForm.render();this.element.find(".wysiwyg-visibility-settings").empty().append(this.conditionForm.getElement())},
generateExpression:function(){var b=this.cloneModel.get("conditions").toJSON();for(i in b)null===b[i].condition&&b.splice(i,1);return d.CompanySettings.VisualFormEditor.classes.factory.getExpressionManager().conditionsToExpression(b)},initEvent:function(){this.addListener("action:save",this.onSave.bind(this))},cloneModel:function(){this.cloneModel=this.model.clone();var b=this.createTmpConditionsDictionaryCollection();this.cloneModel.set({conditions:b})},createTmpConditionsDictionaryCollection:function(){var b=
this.cloneModel.get("conditions"),c=new d.CompanySettings.VisualFormEditor.models.collection.TmpConditionsDictionary;"undefined"!==typeof b&&c.load(b.models);return c},onValidateCondition:function(b,c){if(!this.skipConditionValidation){var d=document.querySelector('[data-index="'+b+'"]').querySelector(".wysiwyg-condition-value");d&&(d="INPUT"==d.tagName?d:d.querySelector(".toa-button"),c?d.classList.add("wysiwyg-form-invalid"):d.classList.remove("wysiwyg-form-invalid"))}},onSave:function(b){b=this.conditionForm.getExpressionValue();
var c=this.cloneModel.get("conditions"),d=[],k=[],l=null;this.notify("vfe-item-before-update",this);if(!1!==b)this.setExpression(b);else{c.each(function(b){""===b.get("value","")&&("in"==b.get("condition")&&b.set({condition:"is_null"}),"not_in"==b.get("condition")&&b.set({condition:"is_not_null"}));if("contains"==b.get("condition")||"dcontain"==b.get("condition"))""===b.get("value","")?(l="changed",d.push(b.id||b.uid)):l=null,this.onValidateCondition(b.id||b.uid,l);k.push(b.getData())}.bind(this));
if(0<d.length)return;this.setConditions(k)}this.notify("save");this.destroy()},setExpression:function(b){this.model.set({expression:b})},setConditions:function(b){var c=new d.CompanySettings.VisualFormEditor.models.collection.ConditionsDictionary;c.load(b);this.model.set({conditions:c,expression:""})},destroy:function(){this.conditionForm.destroy();c.prototype.destroy.apply(this)}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.visibility.BaseForm;d.ns("toa.CompanySettings.VisualFormEditor.views.visibility.VisibilityForm",d.define(c,function(){c.apply(this,arguments)},{template:new d.Template('<div class="wysiwyg-visibility-form">;<div class="wysiwyg-content">;<div class="wysiwyg-section-name"><%-h(15024) /*Access*/%></div>;<div class="wysiwyg-visibility-access">;<% if (ro) { %>;<label <% if (ro && !rw && !m){ %>class="ro_label"<% } %>>;<input name="visibility-access" type="<% if (rw || m){ %>radio<% } else { %>hidden<% } %>" aria-label="<%= h(15020) /* Read Only */ %>" value="ReadOnly" <% if (defaultVisibility == "RO") { %>checked="checked"<% } %> />;<%= h(15020) /* Read Only */ %>;</label>;<% } %>;<% if (rw) { %>;<label>;<input name="visibility-access"  type="radio" aria-label="<%= h(15021) /*Read / Write*/ %>" value="ReadWrite" <% if (defaultVisibility == "RW") { %>checked="checked"<% } %> />;<%= h(15021) /*Read / Write*/ %>;</label>;<% } %>;<% if (m) { %>;<label>;<input name="visibility-access" type="radio" aria-label="<%= h(15022) /*Mandatory*/ %>" value="Mandatory" <% if (defaultVisibility == "M") { %>checked="checked"<% } %> />;<%= h(15022) /*Mandatory*/ %>;</label>;<% } %>;</div>;</div>;<div class="wysiwyg-visibility-settings"></div>;</div>'.split(";")),
render:function(b){var c={};this.options&&this.options.access&&(c=this.options.access);this.element=$(this.template.apply({ro:c.RO,rw:c.RW,m:c.M,defaultVisibility:c.defaultVisibility}));b.append(this.element);this.abilityConditions()&&this.renderConditionsForm();this.element.find("input[name=visibility-access][value="+this.model.get("visibility")+"]").attr("checked","checked");this.initEvent();return this},initEvent:function(){c.prototype.initEvent.apply(this);this.element.find('input[name="visibility-access"]').on("change",
this.onSelectVisibility.bind(this))},abilityConditions:function(){return 0<d.CompanySettings.VisualFormEditor.classes.factory.getAvailableFieldCollection().getConditionFields().length},onSelectVisibility:function(b){b=$(b.currentTarget);this.cloneModel.set({visibility:b.val()})},setExpression:function(b){c.prototype.setExpression.apply(this,arguments);this.setVisibility()},setConditions:function(b){c.prototype.setConditions.apply(this,arguments);this.setVisibility()},setVisibility:function(){this.model.set({visibility:this.cloneModel.get("visibility")})},
destroy:function(){this.element&&this.element.find('input[name="visibility-access"]').off("change");c.prototype.destroy.apply(this)}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.visibility.ParameterForm",d.define(c,function(){c.apply(this,arguments);this.submitBtn=null},{submitBtn:null,template:new d.Template(['<div class="wysiwyg-parameter-form">','<div class="wysiwyg-content">','<div class="wysiwyg-visibility-condition">','<div class="wysiwyg-visibility-condition-content">','<div class="wysiwyg-condition-value-wrapper parameter-field-name">','<label class="parameter-label"><b>'+
d.glossary({id:18161})+"</b></label>",'<select class="wysiwyg-properties-list entites parameter"  <%=checkDisabled%>>',"<%  for(var i = 0; i < entites.length; i++) { %>","<option  <%=entites[i].selected%> ","<%-entites[i].disabled%> ",'value="<%=entites[i].id%>">',"<%=entites[i].name%>","</option>","<% } %>","</select>","</div>","</div>","</div>","</div>","</div>"]),templateFormSelect:new d.Template(['<div class="wysiwyg-condition-value-wrapper parameter-field-name">','<label class="parameter-label"><b>'+
d.glossary({id:18162})+"</b></label>",'<select class="wysiwyg-properties-list parameter"  <%=checkDisabled%>>',"<%  for(var i = 0; i < propertiesList.length; i++) { %>","<option  <%=propertiesList[i].selected%> ","<%-propertiesList[i].disabled%> ",'value="<%=propertiesList[i].id%>">',"<%=propertiesList[i].text%>&nbsp;","</option>","<% } %>","</select>","</div>"]),templateFormInput:new d.Template(['<div class="wysiwyg-condition-value-wrapper">','<label class="parameter-label"><b>'+d.glossary({id:18163})+
"</b></label>",'<input type="text" class="wysiwyg-condition-value parameter-value" value="<%=value%>"  />',"</div>",'<div class="clear"></div>']),templateFormSelectValue:new d.Template(['<div class="wysiwyg-condition-value-wrapper">','<label class="parameter-label"><b>'+d.glossary({id:18163})+"</b></label>",'<select class="wysiwyg-properties-list parameter-value">',"<%  for(var i = 0; i < propertiesList.length; i++) { %>","<option  <%=propertiesList[i].selected%> ","<%-propertiesList[i].disabled%> ",
'value="<%=propertiesList[i].id%>">',"<%=propertiesList[i].text%>","</option>","<% } %>","</select>","</div>"]),checkSelectedEntity:function(){var b=this.getParameters();if(0<b.length&&"undefined"!==typeof this.model.get("field"))for(var c=0,d=b.length;c<d;c++)if(this.model.get("field")==b[c].label)return b[c].entity;return!1},render:function(b){(this.submitBtn=$(b).parent().find("button.popup-button-submit:first"))&&$(this.submitBtn).attr("disabled",!0);this.paramsByEntity={};for(var c=this.getParameters(),
d=0,k=c.length;d<k;d++){var l=c[d].entity;this.paramsByEntity.hasOwnProperty(l)||(this.paramsByEntity[l]=[]);this.paramsByEntity[l].push(c[d])}c=this.model.get("entites");this.selectedEntity="undefined"!==typeof c[0]?c[0].id:"";this.entites=[];if(0<c.length)for(var n=this.checkSelectedEntity(),d=0,k=c.length;d<k;d++)if(l=c[d],n||this.paramsByEntity.hasOwnProperty(l.id))l.id==n&&(l.selected="selected",this.selectedEntity=l.id),this.entites.push(l);d=this.paramsByEntity[this.selectedEntity]||[];this.element=
$(this.template.apply({entites:this.entites,checkDisabled:"undefined"!==typeof this.model.get("value")?"disabled":""}));this.property=$(this.templateFormSelect.apply({propertiesList:d,value:"undefined"!==typeof this.model.get("value")?this.model.get("value"):"",checkDisabled:"undefined"!==typeof this.model.get("value")?"disabled":""}));b.append(this.element);this.element.find(".wysiwyg-visibility-condition-content").append(this.property);this.initEvent();this.showPropertyValue();return this},initEvent:function(){c.prototype.initEvent.apply(this);
$(".entites").on("change",this.showProperty.bind(this));this.property.find(".delete-condition").on("click",this.onDelete.bind(this));this.property.find("select").on("change",this.showPropertyValue.bind(this))},showProperty:function(){var b=$(".wysiwyg-visibility-condition-content");"undefined"!==typeof this.input&&this.input.detach();"undefined"!==typeof this.property&&this.property.detach();"undefined"!==typeof this.select&&this.select.detach();for(var c=$(".entites :selected").val(),c=this.paramsByEntity[c]||
[],d=[],k="",l=0,n=c.length;l<n;l++)c[l].hasOwnProperty("disabled")&&(k="disabled"),this.model.get("field","")===c[l].label&&(c[l].selected="selected"),d.push(c[l]);"undefined"===typeof this.model.get("field")&&(k="");this.property=$(this.templateFormSelect.apply({propertiesList:d,checkDisabled:k}));this.property.appendTo(b);this.showPropertyValue();this.property.find("select").on("change",this.showPropertyValue.bind(this))},showPropertyValue:function(){var b=this.element.find(".wysiwyg-visibility-condition-content");
this.submitBtn&&$(this.submitBtn).attr("disabled",!0);this.input&&this.input.detach();"undefined"!==typeof this.select&&this.select.detach();var c=d.CompanySettings.VisualFormEditor.classes.factory.getAvailableParametersCollection().getByLabelEntity(this.property.find("select :selected").val(),$(".entites :selected").val());if(null!=c&&c.get("lookups")){var c=c.get("lookups"),g;for(g in c)"undefined"!==typeof this.model.get("value")&&c[g].text==this.model.get("value")&&(c[g].selected="selected");
this.select=$(this.templateFormSelectValue.apply({propertiesList:c}));this.select.appendTo(b);this.submitBtn&&$(this.submitBtn).attr("disabled",!1)}else g="undefined"!==typeof this.model.get("value")?this.model.get("value"):"",this.input=$(this.templateFormInput.apply({value:g})),$(this.input).find("input").on("keyup",function(b){var c=!0;""!==$(b.target).val()&&(c=!1);this.submitBtn&&$(this.submitBtn).attr("disabled",c)}.bind(this)),this.input.appendTo(b)},isCustomParamExists:function(b){var c=this.model.get("customParams"),
d="";if("undefined"!==typeof c&&0<c.length)for(var k=0;k<c.length;k++)if(c[k].field==b){d="disabled";break}return d},getParameters:function(){return"edit"==this.model.get("action")?this.processExistedParametersList(this.model.get("customParams")):this.processAvailableParams()},processAvailableParams:function(){var b=[],c=[];"undefined"!==typeof this.model.get("parameters")&&(c=this.model.get("parameters"));for(var d=0;d<c.length;d++)b.push({id:c[d].label,label:c[d].label,text:c[d].text,type:c[d].type,
entity:c[d].entity,selected:this.model.get("field")==c[d].label?"selected":"",disabled:this.isCustomParamExists(c[d].label)});return b},processExistedParametersList:function(b){var c=[],g=d.CompanySettings.VisualFormEditor.classes.factory.getAvailableParametersCollection().toJSON();"undefined"!==typeof this.model.get("parameters")&&(g=this.model.get("parameters"));for(var k in b){for(var l=!1,n=0;n<g.length;n++)if(b[k].field==g[n].label||b[k].field==g[n].id)c.push({id:g[n].label,label:g[n].label,
text:g[n].text,type:g[n].type,entity:g[n].entity,selected:this.model.get("field")==g[n].label?"selected":"",disabled:this.isCustomParamExists(g[n].label)}),l=!0;l||c.push({id:b[k].field,label:b[k].field,text:"undefined"!==typeof b[k].text&&null!==b[k].text?b[k].text:"",type:"undefined"!==typeof b[k].type&&null!==b[k].type?b[k].type:"",entity:b[k].entity,selected:this.model.get("field")==b[k].field?"selected":"",disabled:this.isCustomParamExists(b[k].field)})}return c},onDelete:function(b){$(b.target.parentElement).remove()},
destroy:function(){"undefined"!==typeof this.select&&this.select.find(".delete-condition").off("click",this.onDelete.bind(this));c.prototype.destroy.apply(this)}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.visibility.BaseForm;d.ns("toa.CompanySettings.VisualFormEditor.views.visibility.ValueForm",d.define(c,function(){c.apply(this,arguments);this.initValueList()},{template:new d.Template('<div class="wysiwyg-visibility-form">;<div class="wysiwyg-content value-form">;<div class="wysiwyg-section-name"><%= h(15027/*Values*/) %></div>;<div class="wysiwyg-visibility-values">;<div class="select-value-list">;<%= h(15028/* Select values */) %> <span class="arrow"></span>;</div>;<div class="selected-value"></div>;<div class="clear"></div>;</div>;</div>;<div class="wysiwyg-visibility-settings"></div>;</div>'.split(";")),
templateValueItem:new d.Template(["<span><%-valueItem%></span>"]),render:function(b){var c,g,k,l,n=[];this.element=$(this.template.apply({}));b.append(this.element);this.renderConditionsForm();(b=d.CompanySettings.VisualFormEditor.classes.factory.getAvailableFieldCollection().get(this.model.get("property_id")))&&(g=b.get("lookups"));b=this.model.get("values");l="*";var p=[];for(k in b)if(b.hasOwnProperty(k)&&g&&-1===p.indexOf(b[k].val))for(c in p.push(b[k].val),g)if(g[c].id==b[k].val){n.push(this.templateValueItem.apply({valueItem:g[c].text}));
break}this.model.get("values")&&(l=n.join("; "));this.element.find(".selected-value").empty().append(l);this.initEvent();return this},initEvent:function(){c.prototype.initEvent.apply(this);this.element.on("click",".select-value-list",this.onSelectValue.bind(this))},initValueList:function(){this.valueList=new d.CompanySettings.VisualFormEditor.views.visibility.ValueList(this.cloneModel);this.valueList.addListener("selected",this.onChangeFieldValue.bind(this))},onChangeFieldValue:function(b,c){for(var g=
[],k=0;k<c.length;k++)g[k]={val:c[k]};var k,l,n=[];this.cloneModel.set({values:g});g=d.CompanySettings.VisualFormEditor.classes.factory.getAvailableFieldCollection().get(this.model.get("property_id")).get("lookups");for(k=0;k<c.length;k++)for(l in g)if(g[l].id==c[k]){n.push(this.templateValueItem.apply({valueItem:g[l].text}));break}this.element.find(".selected-value").empty().append(n.join("; "))},onSelectValue:function(){var b;b=d.CompanySettings.VisualFormEditor.classes.factory.getAvailableFieldCollection().get(this.cloneModel.get("property_id"));
this.valueList.render(this.element.find(".select-value-list"),b)},setExpression:function(b){c.prototype.setExpression.apply(this,arguments);this.setValues()},setConditions:function(b){c.prototype.setConditions.apply(this,arguments);this.setValues()},setValues:function(){this.model.set({values:this.cloneModel.get("values")||[]})},destroy:function(){this.element.off("click",".select-value-list");c.prototype.destroy.apply(this)}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.visibility.ValueList",d.define(c,function(){c.apply(this,arguments);this.initFliper()},{template:new d.Template(['<ul id="wysiwyg-enum-options-list"></ul>']),itemTemplate:new d.Template('<li>;<label>;<input type="checkbox" value="<%- value %>" <%=checked%> />;<%- name %>;</label>;</li>'.split(";")),render:function(b,c){var d,k,l;this.element=$(this.template.apply({}));this.element.appendTo(_DATA.popup_container);
l=c.get("lookups");l.sort&&l.sort(function(b,c){var d,e;d=b.text;e=c.text;return d<e?-1:d>e?1:0});k=this.model.get("values")||this.model.get("value")||[];var n=[];if("string"===typeof k)n=k.split(",");else for(d=0;d<k.length;d++)n[d]=k[d].val;for(d=0;d<l.length;d++)k=$(this.itemTemplate.apply({value:l[d].id,checked:0<=$.inArray(""+l[d].id,n)?"checked":"",name:l[d].text})),this.element.append(k);this.anchor=b;this.setPositionElement();this.initEvent();return this},initFliper:function(){this.fliper=
new d.Fliper({getRectAnchor:this._getRectAnchor.bind(this),getRectElement:this._getRectElement.bind(this),mapPosition:this.mapPosition,mapOverlayPosition:this.mapOverlayPosition})},initEvent:function(){this.element.find("input").on("change",this.onSelectValue.bind(this));$(_DATA.popup_container).on("mousedown",this.onMouseDown.bind(this));this.scrollableContainer=this.anchor.closest(".wysiwyg-visibility-condition").parent();this.scrollableContainer.on("scroll",this.destroy.bind(this))},setPositionElement:function(){var b;
b=this.fliper.getOptimalPosition();this.element.css(b.point)},onSelectValue:function(){var b,c=this.element.find("input"),d=[];for(b=0;b<c.length;b++)c[b].checked&&d.push(c[b].value);this.notify("selected",d)},onMouseDown:function(b){$(b.target).closest(this.element).length||this.destroy()},destroy:function(){this.scrollableContainer&&this.scrollableContainer.off("scroll",this.destroy);$(_DATA.popup_container).off("mousedown",this.onMouseDown);c.prototype.destroy.apply(this)},_getRectAnchor:function(){var b=
{};this.anchor&&(b={width:this.anchor.outerWidth(),height:this.anchor.outerHeight(),top:this.anchor.offset().top,left:this.anchor.offset().left});return b},_getRectElement:function(){var b={};this.element&&(b={width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.offset().top,left:this.element.offset().left});return b}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.visibility.ConditionDictionary",d.define(c,function(){c.apply(this,arguments);this.conditionErrors={}},$.extend({},d.mixins.EventEmitter,{template:new d.Template('<div class="visibility-conditions-content">;<div class="wysiwyg-section-name">;<%-h(15025 /*Conditions*/)%> <span class="iconAddCondition" role="button" tabindex="0"></span>;</div>;<div class="wysiwyg-visibilily-conditions"></div>;<div class="wysiwyg-formula-link wysiwyg-link">;<span role="link" tabindex="0"><%= h(21087 /* Show conditions as formula */) %></span>;</div>;</div>'.split(";")),
render:function(){this.element=$(this.template.apply());this.model.each(this.renderCondition.bind(this));this.initEvent();return!0},setConditionErrors:function(b){this.conditionErrors=b=b||{}},getConditionError:function(b){var c="";b=b.getDictionaryIndex();!1!==b&&"undefined"!==typeof this.conditionErrors[b]&&(c=this.conditionErrors[b]);return c},renderCondition:function(b){if(b.get("condition")){var c;c=new d.CompanySettings.VisualFormEditor.views.visibility.ConditionRow(b);c.render(this.getConditionError(b));
this.element.find(".wysiwyg-visibilily-conditions").append(c.getElement())}},initEvent:function(){this.element.find(".iconAddCondition").on("click",this.onCreateCondition.bind(this));this.element.find(".wysiwyg-formula-link span").on("click",this.onShowFormulaExpression.bind(this))},onCreateCondition:function(b){var c;c=d.CompanySettings.VisualFormEditor.classes.factory.getAvailableFieldCollection().getFirstWithCondition(!0);c=new d.CompanySettings.VisualFormEditor.models.TmpConditionDictionary({entity:c.get("entity"),
field:-1<["field","form_element"].indexOf(c.get("type"))?c.get("label"):"property",property_id:c.getId(),condition:"in",value:""});this.model.add(c);this.renderCondition(c);b.stopPropagation();b.preventDefault()},onShowFormulaExpression:function(b){this.notify("show_expression",this)},getExpressionValue:function(){return!1}})))})(toa);(function(d){d.ns("toa.CompanySettings.VisualFormEditor.views.visibility.Expression",d.define(d.CompanySettings.VisualFormEditor.views.BaseView,function(c,b,d){this.isAutoGenerated=b||!1;this.expression=c||"";this.errorText=d||"";b&&(this.autogeneratedValue=this.expression)},$.extend({},d.mixins.EventEmitter,{isAutoGenerated:!1,autogeneratedValue:"",isChanged:!1,isConstructorAccessible:!1,template:new d.Template('<div class="visibility-conditions-content">,<div class="wysiwyg-section-name">,<%-h(15025 /*Conditions*/)%>,</div>,<div class="wysiwyg-visibilily-expression">,<textarea class="wysiwyg-expression-value" rows="15"><%- expression %></textarea>,</div>,<div class="wysiwyg-constructor-link wysiwyg-link" style="display: none;">,<span><%= h(21088 /* Return to conditions constructor */) %></span>,</div>,</div>'.split(",")),
render:function(){this.element=$(this.template.apply({expression:this.expression}));this.isAutoGenerated&&(this.element.find(".wysiwyg-constructor-link").show(),this.isConstructorAccessible=!0);this.initEvent();this.errorText&&this.element.find(".wysiwyg-visibilily-expression").append('<div class="fieldError">'+this.errorText+"</div>");return!0},initEvent:function(){this.element.find(".wysiwyg-constructor-link span").on("click",this.onShowConditionsConstructor.bind(this));this.element.find(".wysiwyg-expression-value").on("input",
this.onChangeExpression.bind(this))},onShowConditionsConstructor:function(c){this.isConstructorAccessible&&!this.element.find(".wysiwyg-constructor-link").hasClass("disabled")&&this.notify("show_constructor",this)},isNotChanged:function(c){return this.autogeneratedValue===c},onChangeExpression:function(c){c=$(c.currentTarget).val();""===c||this.isNotChanged(c)?(this.isConstructorAccessible=!0,this.isChanged=!1):(this.isChanged=!0,this.isConstructorAccessible=!1);this.checkConstructorLink()},checkConstructorLink:function(){this.isConstructorAccessible?
this.element.find(".wysiwyg-constructor-link").removeClass("disabled").show():this.element.find(".wysiwyg-constructor-link").addClass("disabled")},getExpressionValue:function(){var c=this.element.find(".wysiwyg-expression-value").val();return this.isAutoGenerated&&this.isNotChanged(c)?!1:c}})))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.itemSetting.BaseRow",d.define(c,function(b,e){c.apply(this,arguments);this.conditionTranslations={"in":d.glossary({id:11456}),not_in:d.glossary({id:11457}),contains:d.glossary({id:11458}),dcontain:d.glossary({id:11459}),is_null:d.glossary({id:11460}),is_not_null:d.glossary({id:11461})}},{expressionError:null,conditionErrors:{},templateCondition:new d.Template(['<div class="item_row">',
'<div data-id="<%-id%>" class="fieldName"><%-fieldName%></div>','<div class="fieldValue" data-dictlink="<%- dictLink %>">','<span data-id="value-short-<%-id%>" class="condition-value condition-value-short">','<span class="visibility-condition"><%-condition%></span>&nbsp;','<%- null === valueNameShort ? "" : valueNameShort %>',"<% if (valueCountShort > 0) { %>",'&nbsp; <span class="show-more"><%=r(17401 /* and {NUM} more */, { "{NUM}": valueCountShort })%></span>',"<% } %>","</span>",'<span data-id="value-full-<%-id%>" class="condition-value condition-value-full toa-hidden">',
'<span class="visibility-condition"><%-condition%></span>&nbsp;',"<%-valueName%>",'&nbsp; <span class="show-less"><%=h(17402)%></span>',"</span>","</div>","</div>"]),templateExpression:new d.Template(['<div class="item_row">','<div class="fieldValue expressionPreview">',"<%- expression %>","</div>","</div>"]),templateError:new d.Template(['<div class="fieldError <%- errorTypeClass %>">','<div class="warningIcon"><div></div></div>','<div class="errorPreview"><%- errorText %></div>',"</div>"]),SHOW_VALUES_LIMIT:10,
setExpressionError:function(b){var c=$(this.templateError.apply({errorText:b,errorTypeClass:"expressionError"}));this.element.find(".fieldValue").after(c);this.expressionError=b},setConditionError:function(b,c){var d=$(this.templateError.apply({errorText:c,errorTypeClass:"conditionError"}));this.element.find('.fieldValue[data-dictlink="'+b+'"]').after(d);d=this.model.get("conditionErrors",{});"undefined"===typeof d[b]&&(d[b]=c);this.model.set({conditionErrors:d},{silent:!0})},renderExpression:function(b){b=
$(this.templateExpression.apply({expression:d.multilineEllipsis(b,5)}));this.element.find(".rows").empty().append(b)},getConditionValuesList:function(b,c){var d,k,l=b.get("value",""),n=0,p={};k=this.fetchNamesOrLabels(l,c);d=l=k.join(", ");var s=this.SHOW_VALUES_LIMIT,t=k.length;s+2<t&&(d=k.slice(0,s).join(", ")+"...",n=t-s);p.valueName=l;p.valueNameShort=d;p.valueCountShort=n;return p},renderCondition:function(b){var c,g,k;c=d.CompanySettings.VisualFormEditor.classes.factory.getAvailableFieldCollection();
if(g="property"==b.get("field")||b.get("property_id",null)?c.get(b.get("property_id")):c.getByLabelEntity(b.get("field"),b.get("entity"))){var l=this.getConditionValuesList(b,g);c=b.getId();parseInt(c)||(c+=Math.random(1,2E3));k=""!=g.getName()?g.getName():"";k=""===k&&"property"!==g.get("label")?"["+g.get("label")+"]":k;g=b.get("condition")?this.conditionTranslations[b.get("condition")]:"";b=$(this.templateCondition.apply({id:c,dictLink:b.attributes._dictLink,fieldName:k,condition:g,valueName:l.valueName,
valueNameShort:l.valueNameShort,valueCountShort:l.valueCountShort}));this.element.find(".rows").append(b);$(this.element).find('[data-id="value-short-'+c+'"] .show-more').on("click",this.onShowMoreValues.bind(this));$(this.element).find('[data-id="value-full-'+c+'"] .show-less').on("click",this.onShowLessValues.bind(this))}},onChangedRow:function(){var b,c;this.element.find(".rows").empty();b=this.model.get("conditions");(c=this.model.get("expression",null))?this.renderExpression(c):b.each(this.renderCondition.bind(this))},
initEvent:function(){this.element.find(".visibility_item_area").on("click",this.onEditVisibility.bind(this));this.element.find(".remove").on("click",this.onRemoveVisibility.bind(this));this.changeUID&&this.model.removeListener(this.changeUID);this.changeUID=this.model.addListener("change",this.onChangedRow.bind(this))},onShowMoreValues:function(b){var c=$(b.target),c=$(c).parent().attr("data-id").split("-").slice(-1).pop();this.element.find('[data-id="value-short-'+c+'"]').addClass("toa-hidden");
this.element.find('[data-id="value-full-'+c+'"]').removeClass("toa-hidden");b.preventDefault();b.stopPropagation();this.notify("vfe-resize",this)},onShowLessValues:function(b){var c=$(b.target),c=$(c).parent().attr("data-id").split("-").slice(-1).pop();this.element.find('[data-id="value-short-'+c+'"]').removeClass("toa-hidden");this.element.find('[data-id="value-full-'+c+'"]').addClass("toa-hidden");b.preventDefault();b.stopPropagation();this.notify("vfe-resize",this)},onRemoveVisibility:function(b){this.notify("vfe-item-before-update",
this);this.element.remove();this.model.remove()},destroy:function(){this.element&&(this.element.find(".visibility_item_area").off("click"),this.element.find(".remove").off("click"));this.model.removeListener(this.changeUID);c.prototype.destroy.apply(this)}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.itemSetting.Visibility",d.define(c,function(){this.visibilityRows=[];c.apply(this,arguments)},{template:new d.Template('<div class="section">;<div class="sectionTitle">;<div role="link" tabindex="0" class="add_visibility"><%= h(21071/* Add new */) %></div>;<div class="title">;<div class="label" tabindex="0" role="button">;<span class="arrow-icon"></span>;<span class="labelText"><%= h(15010 /*Visibility*/) %></span>;<span class="labelText valueCount"></span>;</div>;</div>;</div>;<div class="sectionContent"></div>;</div>'.split(";")),
render:function(){this.element=$(this.template.apply());this.list=this.element.find(".sectionContent");this.visibility=this.model.get("visibility");this.renderDefaultVisibility();this.visibility.each(this.renderVisibilityRow.bind(this));this.setValueCount();this.initEvent();return this},reRender:function(){for(var b=0;b<this.visibilityRows.length;b++)this.visibilityRows[b].destroy();this.visibilityRows=[];this.renderDefaultVisibility();this.visibility.each(this.renderVisibilityRow.bind(this));this.resizeContainer()},
renderDefaultVisibility:function(){this.model.get("visibility",null);var b=this.model.get("default_visibility",null);null!=b&&(this.defaultVisibility=new d.CompanySettings.VisualFormEditor.models.Visibility({visibility_id:"default",visibility:b}),this.changeDefaultVisibilityUID&&this.defaultVisibility.removeListener(this.changeDefaultVisibilityUID),this.changeDefaultVisibilityUID=this.defaultVisibility.addListener("change",this.onSaveVisibility.bind(this,this.defaultVisibility)),this.defaultVisibility.addListener("remove",
function(){this.model.set({default_visibility:null});this.defaultVisibility=null}.bind(this)),this.renderVisibilityRow(this.defaultVisibility))},renderVisibilityRow:function(b){var c;c=0;var g=this.model.get("visibility",null);null!=this.model.get("default_visibility",null)&&(c=1);g&&(c+=g.getCount());b.set({conditionErrors:{}},{silent:!0});c=new d.CompanySettings.VisualFormEditor.views.itemSetting.VisibilityRow(b,c);c.render(this.getAccessItem());c.addListener("vfe-resize",this.resizeContainer.bind(this));
c.addListener("vfe-item-before-update",function(){this.notify("vfe-item-before-update",this)}.bind(this));this.checkValidationErrors(b,c);this.visibilityRows.push(c);this.list.append(c.getElement());b.addListener("change",function(c){0!=b.get("conditions").getCount()||b.get("expression")||(c=b.clone(),this.model.set({default_visibility:c.get("visibility")}),"default"!=b.getId()&&b.remove(),this.reRender())}.bind(this))},checkValidationErrors:function(b,c){if(this.model.hasValidationErrors()){var d=
[];b.get("expression")?(d=this.findVisibilityErrors(b,"visibility_expression"))&&d.length&&"undefined"!==typeof d[0]&&c.setExpressionError(d[0].get("error_text")):b.get("conditions").getCount()&&(d=this.findVisibilityErrors(b,"visibility_condition"),$.each(d,function(b,d){c.setConditionError(d.get("dict_link",null),d.get("error_text"))}))}},findVisibilityErrors:function(b,c){var g=[],k=d.CompanySettings.VisualFormEditor.classes.factory.getErrorCollection(),l=b.getId();$.each(this.model.get("errors",
[]),function(b,d){var s=k.getByUid(d);!s||s.get("error_type")!==c||s.get("visibility_id")!=l&&""!=s.get("visibility_id")||"visibility_condition"===s.get("error_type")&&""===s.get("dict_link","")||g.push(s)});return g},resizeContainer:function(){this.notify("vfe-reset-position",this)},initEvent:function(){this.element.find(".label").on("click",this.onExpandSection.bind(this));this.element.find(".add_visibility").on("click",this.onAddVisibility.bind(this));this.changeUID=this.model.addListener("change",
this.reRender.bind(this));this.changeVisibilityUID=this.visibility.addListener("remove",function(){this.reRender()}.bind(this))},setValueCount:function(){var b=r(21052,{"{VALUE_COUNT}":this.element.find(".visibility_item").length});this.element.find(".valueCount").text(b)},onExpandSection:function(){this.setValueCount();this.element.toggleClass("collapsed");this.resizeContainer()},getAccessItem:function(){if(this.model instanceof d.CompanySettings.VisualFormEditor.models.Button&&this.model.isFooterButton())return{RO:!0,
RW:!0,M:!1,defaultVisibility:"RW"};if(this.model instanceof d.CompanySettings.VisualFormEditor.models.Text||this.model instanceof d.CompanySettings.VisualFormEditor.models.Button)return{RO:!0,RW:!1,M:!1,defaultVisibility:"RO"};if("tab"===this.model.get("type")||"section"===this.model.get("type"))return{RO:!1,RW:!0,M:!1,defaultVisibility:"RW"};var b={RO:!0,RW:!0,M:!0,defaultVisibility:"RW"};-1!==$.inArray(this.model.get("label"),"acoord_x acoord_y travel pid uid access_hours travel_estimation_method acoord_accuracy".split(" "))&&
(b={RO:!0,RW:!1,M:!1,defaultVisibility:"RO"});var c=["activity_compliance","acoord_accuracy","travel_estimation_method"];"mobile_activity_details"==d.CompanySettings.VisualFormEditor.classes.factory.getLayoutStructure().get("context_label")&&-1!==$.inArray(this.model.get("label"),c)&&(b={RO:!0,RW:!1,M:!1,defaultVisibility:"RO"});d.CompanySettings.VisualFormEditor.classes.factory.getReadOnlyFieldsHelper().isReadOnlyField(this.model.get("label"),this.model.get("entity"))&&(b={RO:!0,RW:!1,M:!1,defaultVisibility:"RO"});
return b},onAddVisibility:function(b){b=new d.CompanySettings.VisualFormEditor.models.Visibility;this.visibilityForm&&this.visibilityForm.destroy();this.visibilityForm=new d.CompanySettings.VisualFormEditor.views.visibility.VisibilityForm(b);this.visibilityForm.setOptions({access:this.getAccessItem()});this.visibilityForm.addListener("save",this.onSaveVisibility.bind(this,b));this.showPopup(h(15023),this.visibilityForm)},onSaveVisibility:function(b,c){this.notify("vfe-item-before-update",this);var d;
"section"!==this.model.get("type")&&"tab"!==this.model.get("type")||b.set({visibility:"ReadWrite"},{silent:!0});"travel"===this.model.get("field")&&b.set({visibility:"ReadOnly"},{silent:!0});0!=b.get("conditions").getCount()||b.get("expression")?"default"==b.getId()?(d=b.clone(),this.model.set({default_visibility:null}),this.visibility.get("default")&&this.visibility.get("default").remove(),this.visibility.add(d),this.defaultVisibility=null):this.visibility.add(b):this.model.set({default_visibility:b.get("visibility")});
this.reRender()},destroy:function(){var b;this.visibilityForm&&this.visibilityForm.destroy();for(b=0;b<this.visibilityRows.length;b++)this.visibilityRows[b].destroy();this.visibilityRows=[];this.element&&(this.element.find(".add_visibility").off("click"),this.element.find(".label").off("click"));this.changeUID&&this.model.removeListener(this.changeUID);this.changeVisibilityUID&&this.visibility.removeListener(this.changeVisibilityUID);this.defaultVisibility&&this.changeDefaultVisibilityUID&&this.defaultVisibility.removeListener(this.changeDefaultVisibilityUID);
c.prototype.destroy.apply(this)}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.itemSetting.BaseRow;d.ns("toa.CompanySettings.VisualFormEditor.views.itemSetting.VisibilityRow",d.define(c,function(b,d){this.countVisibility=d;c.apply(this,arguments)},{template:new d.Template('<div class="visibility_item">;<div class="visibility_item_area" role="link" tabindex="0" data-id="<%-id%>">;<div class="visibility"><div><%-visibility%></div></div>;<div class="rows"></div>;<div class="remove_area">;<% if (countVisibility <= 1) {%>;<div class="noremove"></div>;<% } else { %>;<div data-id="<%-id%>" class="remove"></div>;<% } %>;</div>;</div>;</div>'.split(";")),
templateDefault:new d.Template(['<div class="item_row">','<div class="defaultValue"><i><%= h(21053/* By default for all values */) %></i></div>',"</div>"]),render:function(b){this.visibilityTypeMap={RW:h(226556),RO:h(226557),M:h(226526)};var c;this.access=b;this.element=this.renderRow();b=this.model.get("conditions");c=this.model.get("expression",null);0!=b.getCount()||c?c?("object"===typeof c&&(c=c[0]),""!==c&&this.renderExpression(c)):b.each(this.renderCondition.bind(this)):(b=$(this.templateDefault.apply({})),
this.element.find(".rows").append(b));this.initEvent();return this},renderRow:function(){return $(this.template.apply({id:this.model.getId(),visibility:this.visibilityTypeMap[this.getVisibility()],countVisibility:this.countVisibility}))},getVisibility:function(){var b,c;b=this.model.get("visibility");c={ReadOnly:"RO",ReadWrite:"RW",Mandatory:"M"};return!1==this.access[c[b]]?this.access.defaultVisibility:c[b]||this.access.defaultVisibility},onChangedRow:function(){this.element.find(".visibility div").html(this.visibilityTypeMap[this.getVisibility()]);
c.prototype.onChangedRow.apply(this,arguments)},onEditVisibility:function(b){this.visibilityForm=new d.CompanySettings.VisualFormEditor.views.visibility.VisibilityForm(this.model,this.expressionError);this.visibilityForm.setOptions({access:this.access});this.visibilityForm.addListener("vfe-item-before-update",function(){this.notify("vfe-item-before-update",this)}.bind(this));this.showPopup(h(15023),this.visibilityForm)}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.itemSetting.VisibilityValue",d.define(c,function(){c.apply(this,arguments)},{template:new d.Template('<div class="section collapsed">;<div class="sectionTitle">;<div class="add_visibility_value"><%= h(21071/* Add new */) %></div>;<div class="title">;<div class="label" role="button" tabindex="0" >;<span class="arrow-icon"></span>;<span class="labelText"><%= h(22653 /*Value visibility*/) %></span>;<span class="labelText valueCount"></span>;</div>;</div>;</div>;<div class="sectionContent"></div>;</div>'.split(";")),
visibilityValueRows:[],render:function(){this.visibilityValue=this.model.get("groupedValues");this.element=$(this.template.apply());this.list=this.element.find(".sectionContent");this.visibilityValue.each(this.renderVisibilityValueRow.bind(this));this.visibilityValue.each(this.setOnChangeEventVisibilityValueRow.bind(this));this.setValueCount();this.initEvent();return this},renderVisibilityValueRow:function(b){var c;b.set({conditionErrors:{}},{silent:!0});c=new d.CompanySettings.VisualFormEditor.views.itemSetting.VisibilityValueRow(b);
c.render();c.addListener("vfe-resize",this.resizeContainer.bind(this));c.addListener("create_visibility_value",this.onCreateVisibilityValue.bind(this));c.addListener("vfe-item-before-update",function(){this.notify("vfe-item-before-update",this)}.bind(this));this.checkValidationErrors(b,c);this.visibilityValueRows.push(c);this.list.append(c.getElement())},checkValidationErrors:function(b,c){if(this.model.hasValidationErrors()){var d=[];b.get("expression")?(d=this.findValueVisibilityErrors(b,"value_expression"))&&
d.length&&"undefined"!==typeof d[0]&&c.setExpressionError(d[0].get("error_text")):b.get("conditions").getCount()&&(d=this.findValueVisibilityErrors(b,"value_condition"),$.each(d,function(b,d){c.setConditionError(d.get("dict_link",null),d.get("error_text"))}))}},findValueVisibilityErrors:function(b,c){var g=[],k=b.get("group_id",!1),l=b.get("values",[]),n=[];$.each(l,function(b,c){"undefined"!==typeof c._id&&""!==c._id&&n.push(""+c._id)});n.sort();!l.length||n.length||k||(b.set({group_id:b.getId()},
{silent:!0}),k=b.get("group_id",!1));var p=d.CompanySettings.VisualFormEditor.classes.factory.getErrorCollection();$.each(this.model.get("errors",[]),function(b,d){var l=p.getByUid(d);if(l&&l.get("error_type")===c)if(n.length){var v=l.get("value_ids",[]).sort();JSON.stringify(n)===JSON.stringify(v)&&g.push(l)}else l.get("group_id",!1)===k&&g.push(l)});return g},setOnChangeEventVisibilityValueRow:function(b){b.addListener("change",function(){this.reRender()}.bind(this))},initEvent:function(){this.element.find(".label").on("click",
this.onExpandSection.bind(this));this.element.find(".add_visibility_value").on("click",this.onAddVisibilityValue.bind(this));this.changeUID=this.model.addListener("change",this.reRender.bind(this));this.changeVisibilityValueUID=this.visibilityValue.addListener("remove",function(){this.reRender()}.bind(this))},resizeContainer:function(){this.notify("vfe-reset-position",this)},setValueCount:function(){var b=r(21052,{"{VALUE_COUNT}":this.visibilityValue.getCount()});this.element.find(".valueCount").text(b)},
onExpandSection:function(){this.setValueCount();this.element.toggleClass("collapsed");this.resizeContainer()},onCreateVisibilityValue:function(b,c){this.resizeContainer()},onAddVisibilityValue:function(){this.newVisibility=new d.CompanySettings.VisualFormEditor.models.GroupedVisibilityValue;var b=this.model.get("property_id");"form_element"==this.model.get("type")&&(b=this.model.getId());this.newVisibility.set({property_id:b,item_id:this.model.getId()});this.visibilityForm&&this.visibilityForm.destroy();
this.visibilityForm=new d.CompanySettings.VisualFormEditor.views.visibility.ValueForm(this.newVisibility);this.visibilityForm.addListener("save",this.onSaveVisibility.bind(this));this.visibilityForm.addListener("vfe-item-before-update",function(){this.notify("vfe-item-before-update",this)}.bind(this));this.showPopup(h(15026),this.visibilityForm)},onSaveVisibility:function(){var b,c;b=this.newVisibility.get("values");c=new d.CompanySettings.VisualFormEditor.models.GroupedVisibilityValue;var g=this.model.get("property_id");
"form_element"==this.model.get("type")&&(g=this.model.getId());c.set({property_id:g,conditions:this.newVisibility.get("conditions"),expression:this.newVisibility.get("expression"),values:b});this.visibilityValue.add(c);this.reRender()},reRender:function(){for(var b=0;b<this.visibilityValueRows.length;b++)this.visibilityValueRows[b].destroy();this.visibilityValueRows=[];this.visibilityValue.each(this.renderVisibilityValueRow.bind(this));this.resizeContainer()},destroy:function(){var b;this.element&&
(this.element.find(".add_visibility_value").off("click"),this.element.find(".label").off("click"));for(b=0;b<this.visibilityValueRows.length;b++)this.visibilityValueRows[b].destroy();this.visibilityForm&&this.visibilityForm.destroy();this.visibilityValueRows=[];this.changeUID&&this.model.removeListener(this.changeUID);this.changeVisibilityValueUID&&this.visibilityValue.removeListener(this.changeVisibilityValueUID);c.prototype.destroy.apply(this)}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.itemSetting.BaseRow;d.ns("toa.CompanySettings.VisualFormEditor.views.itemSetting.VisibilityValueRow",d.define(c,function(){c.apply(this,arguments)},{template:new d.Template('<div class="visibility_value_item">;<div class="visibility_item_area" role="link" tabindex="0">;<div class="visibility">;<div class="valueItems">;<% if ("" === valueTranslation) { %>;<div class="asterisk">*</div>;<% } else { %>;<%= valueTranslation %>;<% } %>;</div>;</div>;<div class="rows"></div>;<div class="remove_area">;<div class="remove"></div>;</div>;</div>;</div>'.split(";")),
templateValueItem:new d.Template(["<span><%-valueItem%></span>"]),templateShowMore:new d.Template(['...&nbsp;<span class="show-more"><%=r(17401 /* and {NUM} more */, { "{NUM}": valueCountShort })%></span>']),render:function(){var b,c;this.element=this.renderRow();b=this.model.get("conditions");(c=this.model.get("expression",null))?this.renderExpression(c):b&&b.each(this.renderCondition.bind(this));this.initEvent();return this},renderRow:function(){return $(this.template.apply({valueTranslation:this.renderValues()}))},
renderValues:function(){var b=this.getUniqueRowValue(),c=[],d=b.length,k=b.length;10<d&&(b=b.slice(0,8),d-=8);for(var l=0;l<b.length;l++)c.push(this.templateValueItem.apply({valueItem:b[l]}));d<k&&c.push(this.templateShowMore.apply({valueCountShort:d}));return c.join("; ")},getRowValue:function(){var b,c,g,k,l=[];c=d.CompanySettings.VisualFormEditor.classes.factory.getAvailableFieldCollection().get(this.model.get("property_id"),!1);c=!1===c?[]:c.get("lookups",[]);k=this.model.get("values");for(g in k)if(k.hasOwnProperty(g))for(b in c)if(c[b].id==
k[g].val){l.push(c[b].text);break}return l},getUniqueRowValue:function(){var b,c,g,k,l=[];c=d.CompanySettings.VisualFormEditor.classes.factory.getAvailableFieldCollection().get(this.model.get("property_id"),!1);c=!1===c?[]:c.get("lookups",[]);k=this.model.get("values");var n=[];for(g in k)if(k.hasOwnProperty(g)&&-1===n.indexOf(k[g].val))for(b in n.push(k[g].val),c)if(c[b].id==k[g].val){l.push(c[b].text);break}return l},onChangedRow:function(){this.element.find(".visibility div").empty().append(this.renderValues());
c.prototype.onChangedRow.apply(this,arguments)},onEditVisibility:function(b){this.visibilityForm=new d.CompanySettings.VisualFormEditor.views.visibility.ValueForm(this.model,this.expressionError);this.visibilityForm.addListener("save",this.onSaveVisibility.bind(this));this.visibilityForm.addListener("vfe-item-before-update",function(){this.notify("vfe-item-before-update",this)}.bind(this));this.showPopup(h(15026),this.visibilityForm)},onSaveVisibility:function(b){b=this.model.get("values");this.model.set({values:b});
this.notify("create_visibility_value",b,this.model.get("conditions"))}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.itemSetting.Translations",d.define(c,function(){c.apply(this,arguments)},{iTranslations:[],iLanguages:[],template:new d.Template('<div class="translationsSection section collapsed">;<div class="sectionTitle">;<div class="title">;<div class="label" tabindex="0" role="button">;<span class="arrow-icon"></span>;<span class="labelText"><%= h(21054/*Translations*/) %></span>;</div>;</div>;</div>;<div class="sectionContent"></div>;</div>'.split(";")),
render:function(){this.element=$(this.template.apply());this.list=this.element.find(".sectionContent");this.renderLanguages();this.initEvent();return this},rerender:function(){this.list.empty();this.renderLanguages();return this},renderLanguages:function(){var b,c,g,k,l;b=this.model.get("names");k=this.model.get("translations");var n=this;d.CompanySettings.VisualFormEditor.classes.factory.getLanguagesCollection().each(function(p){g=k.get(p.getId());c=b.get(p.getId());g||(g=new d.CompanySettings.VisualFormEditor.models.Translation({id:p.getId()}),
n.iTranslations.push(g),k.add(g));l=new d.CompanySettings.VisualFormEditor.views.itemSetting.Language(g);l.render(c);l.addListener("changeName",this.onChangeName.bind(this));l.addListener("vfe-item-before-update",function(){this.notify("vfe-item-before-update",this)}.bind(this));n.iLanguages.push(l);this.list.append(l.getElement())}.bind(this))},onChangeName:function(b,c){this.model.notify("changeName",c)},initEvent:function(){this.element.find(".label").on("click",this.onExpandSection.bind(this))},
onExpandSection:function(){"undefined"===typeof this.element||this.element.hasClass("disable-collapse")||this.element.toggleClass("collapsed");this.notify("vfe-reset-position",this)},hideSectionTitle:function(){this.element.removeClass("collapsed");this.element.addClass("disable-collapse");this.element.find(".sectionTitle").addClass("hidden")},destroy:function(){this.element&&this.element.find(".label").off("click");if(0<this.iTranslations.length)for(var b in this.iTranslations){try{this.iTranslations[b].destroy()}catch(d){}delete this.iTranslations[b]}if(0<
this.iLanguages.length)for(b in this.iLanguages){try{this.iLanguages[b].destroy()}catch(g){}delete this.iLanguages[b]}c.prototype.destroy.apply(this)}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.itemSetting.Parameters",d.define(c,function(){this.parameterRows=[];this.clickCounter=0;c.apply(this,arguments)},{template:new d.Template('<div class="section parameterSection">;<div class="sectionTitle">;<div role="link" tabindex="0" class="add_parameter"><%= h(21071/* Add new */) %></div>;<div class="title">;<div class="label" role="button" tabindex="0">;<span class="arrow-icon"></span>;<span class="labelText"><%= h(18145 /*Parameters*/) %></span>;<span class="labelText valueCount"></span>;</div>;</div>;</div>;<div class="sectionContent"></div>;</div>'.split(";")),
render:function(){this.element=$(this.template.apply());this.list=this.element.find(".sectionContent");this.renderRows();this.initEvent();return this},renderRows:function(){this.parameterRows=this.model.get("customParams");if("undefined"!==typeof this.parameterRows)for(var b=0;b<this.parameterRows.length;b++)this.renderParameterRow(this.parameterRows[b])},initEvent:function(){this.element.find(".label").on("click",this.onExpandSection.bind(this));this.element.find(".add_parameter").on("click",this.onAddParameter.bind(this));
this.element.find(".parameter_text").on("click",this.onEditParameter.bind(this));this.changeUID=this.model.addListener("change",this.reRender.bind(this))},renderParameterRow:function(b){b=new d.CompanySettings.VisualFormEditor.views.itemSetting.ParameterRow(this.model,b);b.render();b.addListener("vfe-resize",this.resizeContainer.bind(this));b.addListener("vfe-item-before-update",function(){this.notify("vfe-item-before-update",this)}.bind(this));this.list.append(b.getElement())},resizeContainer:function(){this.notify("vfe-reset-position",
this)},reRender:function(){this.list.empty();this.renderRows();this.element.find(".parameter_text").on("click",this.onEditParameter.bind(this));this.resizeContainer()},onExpandSection:function(){this.element.toggleClass("collapsed");this.notify("vfe-reset-position",this);this.resizeContainer()},onAddParameter:function(){if(1<=this.clickCounter)return!1;this.parameterForm&&this.parameterForm.destroy();var b={};"form"==this.model.get("type")&&(b.form_label=this.model.get("label"));var c=this;request({url:"?controller=wysiwyg&method=getFormParameters",
data:b,responseHandler:function(b){b=c.processAvailableParameters(b.availableParameters);c.renderParamPopup({parameters:b,action:"add"})}});this.clickCounter++},processAvailableParameters:function(b){var c=this.model.get("customParams"),g={},k;for(k in b){var l=b[k],n=[l.entity,l.label].join(".");g.hasOwnProperty(n)||(g[n]=l)}for(var p in c)n=[c[p].entity,c[p].field].join("."),g.hasOwnProperty(n)||(k={id:c[p].parameter_id,label:c[p].field,text:c[p].text,type:"string",entity:c[p].entity},g[n]=k,b.push(k));
d.CompanySettings.VisualFormEditor.classes.factory.getAvailableParametersCollection().clear();d.CompanySettings.VisualFormEditor.classes.factory.getAvailableParametersCollection().load(b);return b},renderParamPopup:function(b){var c=new d.CompanySettings.VisualFormEditor.models.Parameter,g=this.model.getEntitesList();"action"==this.model.get("type")&&(g=g.filter(function(b){return 11!=b.id}));this.valueLengthLimit="form"===this.model.get("type")?4E3:255;g={parameters:b.parameters,item_id:this.model.getId(),
customParams:this.model.get("customParams"),entites:g,action:b.action};"undefined"!==typeof b.field&&(g.field=b.field);"undefined"!==typeof b.value&&(g.value=b.value);c.set(g);this.parameterForm=new d.CompanySettings.VisualFormEditor.views.visibility.ParameterForm(c);this.parameterForm.addListener("action:save",this.onSaveParameters.bind(this));this.parameterForm.addListener("vfe-item-before-update",function(){this.notify("vfe-item-before-update",this)}.bind(this));this.showPopup(h(18146),this.parameterForm)},
showPopup:function(b,c){var g=this;this.paramPopup=new d.ui.Popup({title:b,autoOpen:!0,view:c,modal:!0,onClose:function(){c.destroy();this.paramPopup.destroy();g.clickCounter=0}.bind(this),buttons:[{text:h(14621),position:"left",click:function(){c.destroy();this.paramPopup.destroy();g.clickCounter=0}.bind(this)},{text:h(12),type:"submit",position:"right",click:function(b){c.notify("action:save");g.clickCounter=0}.bind(this)}]});this.clickCounter++},onEditParameter:function(b){if(!(1<=this.clickCounter)){this.parameterForm&&
this.parameterForm.destroy();if(!0===this.model.get("is_plugin"))return!1;var c={field:$(b.target.parentElement.parentElement).data("id"),value:$(b.target.parentElement.parentElement).find(".defaultValue").text(),action:"edit"};b={};"form"==this.model.get("type")&&(b.form_label=this.model.get("label"));var d=this;request({url:"?controller=wysiwyg&method=getFormParameters",data:b,responseHandler:function(b){b=d.processAvailableParameters(b.availableParameters);c.parameters=b;d.renderParamPopup(c)}});
this.clickCounter++}},onSaveParameters:function(){this.notify("vfe-item-before-update",this);"undefined"===typeof this.parameterRows&&(this.parameterRows=[]);var b=this,c=!1;$(".wysiwyg-visibility-condition").each(function(){var d=$(this).find("select:eq(1) :selected").val(),k=b.parameterRows.map(function(b){return b.field}).indexOf(d),l="undefined"!==typeof $(this).find("input").val()?$(this).find("input").val():$(this).find("select.parameter-value :selected").val();if(l.length>b.valueLengthLimit)return c=
!0,!1;-1==k?(k={},k.entity=$(this).find("select.entites :selected").val(),k.field=d,k.value=l,k.text=$(this).find("select:eq(1).parameter :selected").text(),b.parameterRows.push(k)):(b.parameterRows[k].entity=$(this).find("select.entites :selected").val(),b.parameterRows[k].value=l,b.parameterRows[k].text=$(this).find("select:eq(1).parameter :selected").text())});if(c)return this.paramPopup.setErrors([{id:1,message:h(16917,{"{FIELD}":d.glossary({id:18163}),"{LENGTH}":b.valueLengthLimit})}]),!1;this.paramPopup.destroy();
this.model.set({customParams:b.parameterRows});this.reRender()},destroy:function(){this.parameterForm&&this.parameterForm.destroy();this.parameterRows=[];this.clickCounter=0;this.element&&(this.element.find(".add_parameter").off("click"),this.element.find(".parameter_text").off("click"),this.element.find(".label").off("click"));this.changeUID&&this.model.removeListener(this.changeUID);c.prototype.destroy.apply(this)}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.itemSetting.PluginParameters",d.define(c,function(){this.params=[];c.apply(this,arguments)},{template:new d.Template('<div class="section pluginParametersSection">;<div class="sectionTitle">;<div role="link" tabindex="0" class="add_parameter"><%- h(21071/* Add new */) %></div>;<div class="title">;<div class="label" role="button" tabindex="0">;<span class="arrow-icon"></span>;<span class="labelText"><%- h(18145 /*Parameters*/) %></span>;<span class="labelText valueCount"></span>;</div>;</div>;</div>;<div class="sectionContent"></div>;</div>'.split(";")),
render:function(){this.element=$(this.template.apply());this.list=this.element.find(".sectionContent");this.renderRows();this.initEvent();return this},renderRows:function(){this.params=this.model.get("customParams",[]);this.params.forEach(this.renderRow.bind(this))},renderRow:function(b){b=new d.CompanySettings.VisualFormEditor.views.itemSetting.PluginParameterRow(b);b.render();b.addListener("edit",this.onEditParameter.bind(this));b.addListener("delete",this.onDeleteParameter.bind(this));this.list.append(b.getElement())},
show:function(){this.element.show()},hide:function(){this.element.hide()},initEvent:function(){this.element.find(".label").on("click",this.onExpandSection.bind(this));this.element.find(".add_parameter").on("click",this.onAddParameter.bind(this));this.changeUID=this.model.addListener("change",this.reRender.bind(this))},resizeContainer:function(){this.notify("vfe-reset-position",this)},reRender:function(){this.list.empty();this.renderRows();this.resizeContainer()},onExpandSection:function(){this.element.toggleClass("collapsed");
this.notify("vfe-reset-position",this);this.resizeContainer()},onAddParameter:function(){this.openEditor()},onEditParameter:function(b,c){for(var d,k=0;k<this.params.length;k++)if(c===this.params[k].field){d=this.params[k];break}this.openEditor(d)},openEditor:function(b){var c=new d.CompanySettings.VisualFormEditor.validators.PluginParameterValidator(this.params);this.pluginParameterForm=new d.CompanySettings.VisualFormEditor.views.itemSetting.PluginParameterForm(this.model,b,c);this.pluginParameterForm.addListener("onSave",
this.onSaveParameter.bind(this));this.showPopup(b?h(23675):h(18146),this.pluginParameterForm)},showPopup:function(b,c){var g=[{text:h(14621),position:"left",click:function(){k.destroy();c.destroy()}.bind(this)},{text:h(12),type:"submit",position:"right",click:function(){c.onSave()&&(k.destroy(),c.destroy())}.bind(this)}],k=new d.ui.Popup({title:b,autoOpen:!0,view:c,modal:!0,onClose:function(){k.destroy()},buttons:g})},onDeleteParameter:function(b,c){this.notify("vfe-item-before-update",this);this.model.set({customParams:this.params.filter(function(b){return b.field!=
c})});this.reRender()},onSaveParameter:function(b,c,d){this.notify("vfe-item-before-update",this);b=!1;for(var k=0;k<this.params.length;k++)if(c===this.params[k].field){this.params[k].value=d;b=!0;break}!1===b&&this.params.push({field:c,value:d});this.reRender()},destroy:function(){this.parameterForm&&this.parameterForm.destroy();this.params=[];this.element&&(this.element.find(".add_parameter").off("click"),this.element.find(".label").off("click"));this.changeUID&&this.model.removeListener(this.changeUID);
c.prototype.destroy.apply(this)}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.itemSetting.BaseRow;d.ns("toa.CompanySettings.VisualFormEditor.views.itemSetting.ParameterRow",d.define(c,function(b,d){this.model=b;this.parameters=d;c.apply(this,arguments)},{template:new d.Template('<div class="parameter_item">;<div class="parameter_item_area" data-id="<%-field%>">;<div class="parameter"><div class="parameter_text"><%-text%></div><div class="parameter_field">[ <%-field%> ]</div></div>;<div class="rows"></div>;<div class="remove_area">;<div data-id="" class="remove"></div>;</div>;</div>;</div>'.split(";")),
templateDefault:new d.Template(['<div class="item_row">','<div class="defaultValue" data-id="<%-field%>"><i><%-value%></i></div>',"</div>"]),render:function(){this.element=this.renderRow();var b=d.CompanySettings.VisualFormEditor.classes.factory.getAvailableFieldCollection().getByLabel(this.parameters.field),c=this.parameters.value;if(null!=b&&b.get("lookups")&&"field"!==b.get("type")){var b=b.get("lookups"),g;for(g in b)"undefined"!==typeof this.parameters.value&&b[g].id==this.parameters.value&&
(c=b[g].text)}c=$(this.templateDefault.apply({field:this.parameters.field,value:c}));this.element.find(".rows").append(c);this.initEvent();return this},initEvent:function(){this.element.find(".remove").on("click",this.onDeletedRow.bind(this))},renderRow:function(){var b=this.parameters.text.split(" [")[0];return $(this.template.apply({field:this.parameters.field,text:b}))},onDeletedRow:function(){var b=this.element.find(".parameter_item_area").data("id");this.element.remove();for(var c=this.model.get("customParams"),
g=[],k=0;k<c.length;k++)c[k].field!=b&&g.push(c[k]);d.CompanySettings.VisualFormEditor.classes.factory.getUndoManager().addStep({debug:"ParameterRow:onDeletedRow"});this.model.set({customParams:g})},onChangedRow:function(){c.prototype.onChangedRow.apply(this,arguments)}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.itemSetting.PluginParameterRow",d.define(c,function(b){this.parameter=b;c.apply(this,arguments)},{template:new d.Template('<div class="parameter_item" data-name = "<%-name%>">;<div class="parameter_item_area">;<div class="parameter">;<div class="parameter_text"><%-name%></div>;</div>;<div class="rows">;<div class="item_row">;<div class="defaultValue"><i><%-value%></i></div>;</div>;</div>;<div class="remove_area">;<div class="remove"></div>;</div>;</div>;</div>'.split(";")),
render:function(){this.element=$(this.template.apply({name:this.parameter.field,value:this.parameter.value}));this.initEvent();return this},initEvent:function(){this.element.find(".parameter").on("click",this.onEdit.bind(this));this.element.find(".remove").on("click",this.onDelete.bind(this))},onDelete:function(){this.element.remove();this.notify("delete",this.element.data("name")+"")},onEdit:function(){this.notify("edit",this.element.data("name")+"")}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.itemSetting.PluginParameterForm",d.define(c,function(b,d,g){this.parameter=void 0!==d?d:{field:"",value:""};this.validator=g;c.prototype.constructor.apply(this,arguments)},{template:new d.Template('<div class="wysiwyg-parameter-form">;<div class="wysiwyg-parameter-form-container">;<div class="row"><label><span class="parameter-label"><%-h(19974 /*Name*/)%></span><input class="name parameter <%=disabled%>" <%-disabled%> type="text" name="name" value="<%-name%>" ></label></div>;<div class="row"><label><span class="parameter-label"><%-h(19975 /*Value*/)%></span><textarea rows="3" class="value parameter" name="value"><%-value%></textarea></label></div>;<div class="errors"></div>;</div>;</div>'.split(";")),
errorsTemplate:new d.Template('<% if (errors.length) { %>,<ul>,<% errors.forEach(function(error) { %>,<li class="error"><%-error%></li>,<% }); %>,</ul>,<% } %>'.split(",")),render:function(b){this.element=$(this.template.apply({disabled:this.parameter.field.length?"disabled":"",name:this.parameter.field,value:this.parameter.value}));b.append(this.element);this.initEvent();return this},renderErrors:function(){this.element.find(".errors").html($(this.errorsTemplate.apply({errors:this.validator.getErrors()})))},
onSave:function(){var b=this.element.find(".name").val().trim(),c=this.element.find(".value").val().trim(),d=this.validator.validate(b,c);d?this.notify("onSave",b,c):this.renderErrors();return d}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.itemSetting.Language",d.define(c,function(){c.apply(this,arguments)},{template:new d.Template('<div class="translation-item">;<div class="item-wrapper">;<div class="language">;<label for="<%- uniq_language_id %>_<%- languageLabel %>"><%- languageName %></label>;</div>;<div class="translation">;<textarea lang="<%- languageLabel %>" id="<%- uniq_language_id %>_<%- languageLabel %>" rows="1" cols="5" placeholder="<%- originValue %>" class="hide-placeholder">;<%- value %>;</textarea>;</div>;<div class="clear"></div>;</div>;</div>'.split(";")),
render:function(b){var c=d.CompanySettings.VisualFormEditor.classes.factory.getLanguagesCollection(),g=this.model.get("name","");this.originValue=b?b.get("name"):"";this.isOriginalSet=""===g||this.originValue===g;b=c.get(this.model.getId()).get("name");1==c.getCount()&&(b=h(68));this.element=$(this.template.apply({languageLabel:c.get(this.model.getId()).get("label"),languageName:b,uniq_language_id:generate_id(),originValue:this.originValue,value:this.isOriginalSet?"":g,title:this.originValue&&!this.isOriginalSet?
r(21055,{"{ORIGINAL_TEXT}":this.originValue}):""}));this.initEvent();return this},initEvent:function(){var b=this.element.find("textarea");b.off();b.on("input",this.onInputTranslation.bind(this));b.on("change",this.onTranslateValue.bind(this));b.on("focus",this.onShowPlaceholder.bind(this));b.on("blur",this.onHidePlaceholder.bind(this));b.on("remove",this.saveChangedTranslation.bind(this))},onInputTranslation:function(b){this.customUpdate=""!==b.target.value&&this.originValue!==b.target.value?"changed":
""===b.target.value||this.originValue===b.target.value?"empty":"none";this.notify("vfe-item-before-update",this)},saveChangedTranslation:function(b){this.onTranslateValue(b);this.element&&this.element.find("textarea").off()},onShowPlaceholder:function(b){if(!this.isOriginalSet)return!1;$(b.currentTarget).removeClass("hide-placeholder")},onHidePlaceholder:function(b){if(!this.isOriginalSet)return!1;$(b.currentTarget).addClass("hide-placeholder")},onTranslateValue:function(b){if("undefined"===typeof this.customUpdate||
this.customUpdate&&"changed"!==this.customUpdate)"empty"===this.customUpdate&&(this.model.set({name:""}),this.model.isUserLanguage()&&this.notify("changeName",this.originValue));else{b=$(b.currentTarget);var c=b.val();""===c||c===this.originValue?(c=this.originValue,b.val(""),this.isOriginalSet=!0,b.attr("title","")):this.isOriginalSet&&(b.attr("title",r(21055,{"{ORIGINAL_TEXT}":this.originValue})),this.isOriginalSet=!1);this.model.set({name:c});this.model.isUserLanguage()&&this.notify("changeName",
c)}},destroy:function(){if(this.element){var b=this.element.find("textarea");b.off("input");b.off("change");b.off("focus");b.off("blur")}c.prototype.destroy.apply(this)}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.itemSetting.Evaluation",d.define(c,function(){this.updateValidationMessagesUID=null;c.apply(this,arguments)},{template:new d.Template('<div class="section collapsed">,<div class="sectionTitle">,<div class="title">,<div class="label" role="button" tabindex="0">,<span class="arrow-icon"></span>,<span class="labelText"><%= h(21083/*Default value and validation*/) %></span>,</div>,</div>,</div>,<div class="sectionContent"><div class="fieldRow">,<div class="item-wrapper default_expression">,<div class="fieldLabel">,<label for="<%- defaultValue.label %>" ><%= h(21084/*Default value*/) %></label>,</div>,<div class="fieldValue">,<textarea id="<%- defaultValue.label %>" rows="2" cols="5" style="height: 34px;" maxlength="2048" modelField="<%- defaultValue.label %>">,<%- defaultValue.value %>,</textarea>,</div>,<div class="clear"></div>,</div>,</div><div class="fieldRow">,<div class="item-wrapper validation_expression">,<div class="fieldLabel">,<label for="<%- validationRule.label %>" ><%= h(21085/*Validation*/) %></label>,</div>,<div class="fieldValue">,<textarea id="<%- validationRule.label %>" rows="2" cols="5" style="height: 34px;" maxlength="2048" modelField="<%- validationRule.label %>">,<%- validationRule.value %>,</textarea>,</div>,<div class="clear"></div>,</div>,</div><div class="fieldRow" id="validation_messages">,</div>,</div>,</div>'.split(",")),
errorTemplate:new d.Template(['<div class="fieldError">','<div class="warningIcon"><div></div></div>','<div class="errorText">',"<%- error_text %>","</div>"]),render:function(){this.initValidationMessages();this.evaluation=this.model.get("evaluation",{});this.element=$(this.template.apply({defaultValue:{label:"default_expression",value:this.evaluation.default_expression||""},validationRule:{label:"validation_expression",value:this.evaluation.validation_expression||""}}));this.checkErrors();this.validationMessages.render();
this.element.find("#validation_messages").append(this.validationMessages.getElement());this.initEvent();return this},checkErrors:function(){if(this.model.hasValidationErrors()){var b=d.CompanySettings.VisualFormEditor.classes.factory.getErrorCollection();$.each(this.model.get("errors",[]),function(c,d){var k=b.getByUid(d);if(k){var l=k.get("error_type");-1!==$.inArray(l,["default_expression","validation_expression"])&&(l=this.element.find(".item-wrapper."+l),k=$(this.errorTemplate.apply({error_text:k.get("error_text")})),
l.find(".fieldValue").append(k))}}.bind(this))}},initValidationMessages:function(){this.validationMessages=new d.CompanySettings.VisualFormEditor.views.itemSetting.ValidationMessages(this.model);this.updateValidationMessagesUID=this.validationMessages.addListener("vfe-item-before-update",function(){this.notify("vfe-item-before-update",this)}.bind(this))},initEvent:function(){this.element.find(".label").on("click",this.onExpandSection.bind(this));this.element.find("textarea").on("input",this.onChangeValue.bind(this))},
onExpandSection:function(){this.element.toggleClass("collapsed");this.notify("vfe-reset-position",this)},onChangeValue:function(b){var c=$(b.currentTarget);if(b=c.attr("modelField")||!1)this.notify("vfe-item-before-update",this),c=c.val(),"undefined"===typeof this.evaluation.evaluation_id&&(this.evaluation.evaluation_id=d.models.ObservableModel.prototype._makeUid.apply()),this.evaluation[b]=c,this.model.set({evaluation:this.evaluation})},destroy:function(){this.element&&(this.element.find(".label").off("click"),
this.element.find("textarea").off("input"));this.validationMessages&&(this.updateValidationMessagesUID&&this.validationMessages.removeListener(this.updateValidationMessagesUID),this.validationMessages.destroy());c.prototype.destroy.apply(this)}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.itemSetting.ValidationMessages",d.define(c,function(){c.apply(this,arguments)},{template:new d.Template('<div class="section">;<div class="sectionTitle" style="border-bottom:0px">;<div class="title">;<div class="label_2">;<span class="labelText"><%= h(21086/*Validation error message*/) %></span>;</div>;</div>;</div>;<div class="sectionContent"></div>;</div>'.split(";")),render:function(){var b,
c,g;this.element=$(this.template.apply());this.list=this.element.find(".sectionContent");c=this.model.get("validation_messages");d.CompanySettings.VisualFormEditor.classes.factory.getLanguagesCollection().each(function(k){b=c.get(k.getId());b||(b=new d.models.ObservableModel({id:k.getId()}),c.add(b));g=new d.CompanySettings.VisualFormEditor.views.itemSetting.ValidationMessage(b);g.render();g.addListener("vfe-item-before-update",function(){this.notify("vfe-item-before-update",this)}.bind(this));this.list.append(g.getElement())}.bind(this));
return this},destroy:function(){c.prototype.destroy.apply(this)}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.itemSetting.ValidationMessage",d.define(c,function(){c.apply(this,arguments)},{template:new d.Template('<div class="translation-item">;<div class="item-wrapper">;<div class="language">;<label for="<%- uniq_language_id %>_<%- languageLabel %>"><%- languageName %></label>;</div>;<div class="translation">;<textarea lang="<%- languageLabel %>" id="<%- uniq_language_id %>_<%- languageLabel %>" rows="1" cols="5" maxlength="255">;<%- value %>;</textarea>;</div>;<div class="clear"></div>;</div>;</div>'.split(";")),
render:function(){var b=d.CompanySettings.VisualFormEditor.classes.factory.getLanguagesCollection();this.element=$(this.template.apply({languageLabel:b.get(this.model.getId()).get("label"),languageName:b.get(this.model.getId()).get("name"),languageLabel:b.get(this.model.getId()).get("label"),uniq_language_id:generate_id(),value:this.model.get("text","")}));this.initEvent();return this},initEvent:function(){var b=this.element.find("textarea");b.off();b.on("change",this.onTranslateValue.bind(this));
b.on("input",this.onInputText.bind(this));b.on("remove",this.saveChangedText.bind(this))},onInputText:function(b){this.notify("vfe-item-before-update",this)},saveChangedText:function(b){this.onTranslateValue(b);this.element&&this.element.find("textarea").off()},onTranslateValue:function(b){b=$(b.currentTarget).val();this.model.set({text:b})},destroy:function(){this.element&&(this.element.find("textarea").off("change"),this.element.find("textarea").off("input"));c.prototype.destroy.apply(this)}}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.enumerationValueEditor.Item",d.define(c,function(){c.apply(this,arguments)},{events:{"click .valueName":"actionModify"},template:'<tr><td class="valueItemCell valueInfo"><div class="valueName"><%- name %></div><div class="valueLabel"><%- label %></div></td><td class="valueItemCell valueActions"></td></tr>',render:function(b,d){c.prototype.render.apply(this,arguments);this.showValueMenu();return this},showValueMenu:function(){var b=
[];this.readOnlyMode?b.push({name:"actionView",text:h(8047)}):b=[{name:"actionModify",text:h(19136)},{name:"actionDelete",text:h(19137)}];this.menuButton=d.view.control.create({xtype:"button.Menu",name:"itemMenuButton",text:"",attr:{"aria-haspopup":"true"},addClass:"toa-item-menu-button",icon:"toa-item-menu-icon",menuItems:b,listeners:{menuItemClick:this.menuItemClick.bind(this)}});this.menuButton.render(this._$el.find(".valueItemCell.valueActions"))},menuItemClick:function(b,c){var d=Array.prototype.slice.call(arguments);
d[0]=b;this[c.name].apply(this,d)},actionView:function(b){this.notify("valueaction:view",b,this)},actionModify:function(b){this.notify("valueaction:"+(this.readOnlyMode?"view":"modify"),b,this)},actionDelete:function(b){if(this.readOnlyMode)return!1;this.notify("valueaction:delete",b,this)}}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.enumerationValueEditor.NoItems",d.define(c,function(){c.apply(this,arguments)},{template:'<tr><td class="emptySection noValues"><%= h(22637)/* No values */ %></td></tr>'}))})(toa);(function(d){var c=d.views.BaseCollectionView;d.ns("toa.CompanySettings.VisualFormEditor.views.enumerationValueEditor.List",d.define(c,function(){c.apply(this,arguments)},{events:{"click .addValue":"actionAdd"},template:'<h1 class="settingsSection listActions"><span>&nbsp;</span><div tabindex="0" class="sectionsAddButton addValue"><%= h(19127) /* Add new */ %></div></h1><div class="listWrapper"><table class="listContainer"></table></div>',childView:d.CompanySettings.VisualFormEditor.views.enumerationValueEditor.Item,
childRegion:".listContainer",noItemsView:d.CompanySettings.VisualFormEditor.views.enumerationValueEditor.NoItems,actionAdd:function(){this.notify("addEnumerationValue")}}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.enumerationValueEditor.Form",d.define(c,function(b){c.apply(this,arguments);this.languageCollection=d.CompanySettings.VisualFormEditor.classes.factory.getLanguagesCollection()},{_mandatoryLanguageId:1,_validationErrors:[],events:{"change input.valueLabel":"onChangeLabel"},render:function(b,d){c.prototype.render.apply(this,arguments);this.afterRender();return this},afterRender:function(){var b=this.getElement().find(".languageContainer"),
c=this.model.get("translations",{});this.languageCollection.each(function(g){var k=g.get("id"),l=c[k]||"";g={isMandatory:this.isMandatoryLanguage(k),languageId:k,languageName:g.get("name"),languageLabel:g.get("label"),valueName:l};k=new d.Template(this.templateLanguage);g=$(k.apply(g));b.append(g)}.bind(this));this.getElement().find("input.valueName").change(this.onChangeName.bind(this))},isMandatoryLanguage:function(b){return this._mandatoryLanguageId===b},onChangeLabel:function(b){b=$(b.target).val().trim();
this.model.set({label:b})},onChangeName:function(b){var c=$(b.target).val().trim();b=parseInt($(b.target).parent(".controls").parent(".control-group").data("language"),10);var d=this.model.get("translations",{});d[b]=c;this.model.set({translations:d});b===this.model.getUserLanguage()&&this.model.set({name:c})},validate:function(){var b=[],c=this.model.get("translations",{});c[this._mandatoryLanguageId]&&""!==c[this._mandatoryLanguageId]||b.push(h(22633));""===this.model.get("label","")&&b.push(h(22634));
-1!==$.inArray(this.model.get("label",""),this.options.labels)&&b.push(h(22646));this._validationErrors=b;return!b.length},getValidationErrors:function(){return this._validationErrors},template:'<form class="toa-form-horizontal add-form"><div class="form-group"><div class="languageContainer"></div><div class="control-group"><label class="control-label"><span class="asterisk">&#42;</span><%= h(19107)/* Label */ %></label><div class="controls"><input type="text" name="valueLabel" class="valueLabel" autofocus value="<%= label %>" maxlength="40" /></div></div></div></form>',
templateLanguage:'<div class="control-group" data-language="<%- languageId %>" data-language-label="<%- languageLabel %>"> <label class="control-label"><% if (true === isMandatory) { %><span class="asterisk">&#42;</span><% } %><%- languageName %></label><div class="controls"><input type="text" name="valueName_<%- languageId %>" value="<%- valueName %>" class="valueName<%- (isMandatory ? " required" : "") %>" maxlength="255" /></div></div>'}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.enumerationValueEditor.Container",d.define(c,function(b){c.apply(this,arguments)},{listView:null,formView:null,valueModel:null,regions:{list:".enumerationValuesList",form:".enumerationValueForm"},template:'<div class="enumerationValuesList"></div><div class="enumerationValueForm"></div>',showList:function(){this.listView&&this.listView.destroy();this.listView=new d.CompanySettings.VisualFormEditor.views.enumerationValueEditor.List({collection:this.collectionModel});
this.listView.addListener("addEnumerationValue",this.onAddValue.bind(this));this.listView.addListener("valueaction:view",this.onViewValue.bind(this));this.listView.addListener("valueaction:modify",this.onEditValue.bind(this));this.listView.addListener("valueaction:delete",this.onDeleteValue.bind(this));this.hideRegion("form",this.formView);this.showRegion("list",this.listView)},onAddValue:function(){this.notify("showform","add");this.showForm()},onEditValue:function(b,c){this.notify("showform","edit");
this.showForm(c.model.toJSON())},onViewValue:function(b,c){this.notify("showform","view");this.showForm(c.model.toJSON())},onDeleteValue:function(b,c){this.notify("deletevalue",c.model);this.showRegion("list",this.listView)},hideRegion:function(b,c){this._container.find(this.regions[b]).first().empty();c&&c instanceof d.views.BaseView&&c.destroy()},showForm:function(b){b||(b={label:"",translations:{}});this.formView&&this.formView.destroy();this.valueModel?this.valueModel.reset(b):this.valueModel=
new d.CompanySettings.VisualFormEditor.models.BaseModel(b);this.formView=new d.CompanySettings.VisualFormEditor.views.enumerationValueEditor.Form({model:this.valueModel,labels:this.getLabelsList(this.valueModel.get("label",""))});this.hideRegion("list",this.listView);this.showRegion("form",this.formView)},getLabelsList:function(b){b=b||"";var c=this.collectionModel.pluck("label");if(!b)return c;b=$.inArray(b,c);-1!==b&&c.splice(b,1);return c},applyForm:function(){this.formView.validate()?this.notify("applyvalue",
this.formView.model):this.notify("showerrors",this.formView.getValidationErrors())}}))})(toa);(function(d){d.ns("toa.CompanySettings.VisualFormEditor.views.ValueEditorWidget",d.define(null,function(c){this.options=c;this._listTitle=h(22640);this._addValueTitle=h(22641);this._editValueTitle=h(22642);this._init()},{_values:null,_valuesCollection:null,_editorPopup:null,_init:function(){this._values=this.options.values||[];this._initValuesCollection();this.containerView=new d.CompanySettings.VisualFormEditor.views.enumerationValueEditor.Container({model:null,collectionModel:this._valuesCollection});
this.containerView.addListener("showform",this.showForm.bind(this));this.containerView.addListener("showerrors",this.showErrors.bind(this));this.containerView.addListener("deletevalue",this.deleteValue.bind(this));this.containerView.addListener("applyvalue",this.applyValue.bind(this))},_initValuesCollection:function(){this._valuesCollection||(this._valuesCollection=new d.models.ObservableCollection);this._valuesCollection.clear();$.each(this._values,function(c,b){this._valuesCollection.add(this._prepareValue(b),
{silent:!0})}.bind(this))},_prepareValue:function(c){c instanceof d.CompanySettings.VisualFormEditor.models.BaseModel&&(c=c.toJSON());c.id=c.label;c=Object.assign({},c);c.translations=Object.assign({},c.translations);return c},render:function(){var c=$.Deferred();this._editorPopup=new d.ui.Popup({title:this._listTitle,autoOpen:!0,view:this.containerView,modal:!0,onClose:function(){this.destroy()},buttons:[{text:h(14621),id:"cancel",position:"left",click:function(){this.destroy()}},{text:h(22645),
id:"discard",position:"left",click:this.showList.bind(this)},{text:h(12),position:"right",id:"save",type:"submit",click:function(){c.resolve(this._valuesCollection.toJSON());this._editorPopup.destroy()}.bind(this)},{text:h(22643),id:"add_edit",position:"right",type:"submit",click:this.onAddEditClick.bind(this)}]});this._editorPopup._dom.base.id="toa-wysiwyg-values-editor-popup";this.showList();return c},onAddEditClick:function(){this.containerView.applyForm()},clearErrors:function(){this._editorPopup.setErrors([])},
showErrors:function(c,b){var d=[];$.each(b,function(b,c){d.push({id:"error_"+b,message:c})});this._editorPopup.setErrors(d)},showList:function(){this.clearErrors();this._editorPopup.setTitle(this._listTitle);this._editorPopup.displayNoneButton("add_edit");this._editorPopup.displayNoneButton("discard");this._editorPopup.displayInlineButton("cancel");this._editorPopup.displayInlineButton("save");this.containerView.showList();this._editorPopup.setPositionCenter()},showForm:function(c,b){b=b||"add";this._editorPopup.setTitle("add"===
b?this._addValueTitle:this._editValueTitle);this._editorPopup.displayNoneButton("cancel");this._editorPopup.displayNoneButton("save");this._editorPopup.displayInlineButton("discard");$(this._editorPopup._dom.buttons.add_edit).text("add"===b?h(22643):h(22644));this._editorPopup.displayInlineButton("add_edit");this._editorPopup.setPositionCenter()},deleteValue:function(c,b){this._valuesCollection.remove(b)},applyValue:function(c,b){var d=b.get("id",!1),g=this._prepareValue(b),k=!1;!1!==d&&(k=this._valuesCollection.get(d));
!1===k?this._valuesCollection.add(g):d===g.id?k.reset(g):this._valuesCollection.replace(k,g);this.showList()},destroy:function(){this.containerView&&this.containerView.destroy()}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.BaseView,b={template:new d.Template('<div class="section">,<div class="sectionContent">,<div class="fieldRow elementField dataBindingFieldRow">,<div class="item-wrapper elementLabel">,<div class="fieldLabel">,<label for="dataBindingCombobox" id="bindingTypeName"><%- bindingTypeName %></label>,</div>,<div class="fieldValue">,<div id="dataBindingForm" style="display:none;">,<oj-combobox-one id="dataBindingCombobox", options="[[entityProperties]]", option-renderer="[[optionRenderer]]", on-value-changed="[[valueChanged]]", on-raw-value-changed="[[rawValueChanged]]", value="[[selectedValue]]", validators="[[valueValidators]]", class="dataBindingCombobox", style="max-width:300px;">,</oj-combobox-one>,<div role="button" tabindex="0" class="data-binding-field-selector ui-button multiselect-tip-button ui-button-icon-only" aria-describedby="Edit">,<span class="ui-icon ui-button-icon-primary ui-icon-modify">Edit</span>,</div>,</div>,<div class="clear"></div>,</div>,<div class="clear"></div>,</div>,</div>,</div>,</div>'.split(",")),
guiSelectorTemplate:new d.Template('<div class="fieldRow elementField" id="guiSelector">,<div class="item-wrapper elementGuiType">,<div class="fieldLabel">,<span title="<%= h(22605/*Type*/) %>"><%= h(22605/*Type*/) %></span>,</div>,<div class="fieldValue">,<select class="guiTypeSelect" style="height: 22px;"<% if (readOnly) { %> disabled<% } %> aria-label="<%= h(22605/*Type*/) %>">,<option value="radiogroup" <% if ("radiogroup" == gui) { %>selected="selected"<% } %>><%= h(22608/*Radio group*/) %></option>,<option value="combobox" <% if ("combobox" == gui) { %>selected="selected"<% } %>><%= h(22609/*Combobox*/) %></option>,</select>,<div class="enumerationValues"></div>,</div>,<div class="clear"></div>,</div>,</div>'.split(",")),
inputTypeCheckboxTemplate:new d.Template('<div class="fieldRow elementField" id="barcodeSelector">;<div class="item-wrapper inputTypeFilterRow barcodeSelector">;<div class="fieldLabel">;<span id="bindingTypeName"><%= h(20657/*Barcode scanner*/) %></span>;</div>;<div class="fieldValue" >;<input type="checkbox" id="fieldScanner" <% if (barcode) { %> checked<% } %>><label id="fieldScannerLabel" for="fieldScanner"></label>;</div>;</div>;</div>'.split(";")),datetimeTypeSelectorTemplate:new d.Template('<div class="fieldRow elementField" id="dateTimeSelector">,<div class="item-wrapper elementGuiType">,<div class="fieldLabel">,<span title="<%= h(22605/*Type*/) %>"><%= h(22605/*Type*/) %></span>,</div>,<div class="fieldValue">,<select class="dateTimeTypeFilter" style="height: 22px;"<% if (readOnly) { %> disabled<% } %>>,<option value="datetimepicker" <% if ("datetimepicker" == gui) { %>selected="selected"<% } %>><%= h(20662/*Date and Time picker*/) %></option>,<option value="datepicker" <% if ("datepicker" == gui) { %>selected="selected"<% } %>><%= h(20660/*Date picker*/) %></option>,<option value="timepicker" <% if ("timepicker" == gui) { %>selected="selected"<% } %>><%= h(20661/*Time picker*/) %></option>,</select>,</div>,<div class="clear"></div>,</div>,</div>'.split(",")),
enumValuesTemplate:new d.Template('<div class="enumValuesContainer">;<% if (0 === valueCount) { %>;<%= h(22637/*No items*/) %>;<% } else { %>;<%= r(22636/*{VALUE_COUNT} items*/, {"{VALUE_COUNT}": valueCount}) %>;<% } %>;</div>;<div class="enumValuesEdit"><%= h(22638/*Edit*/) %></div>'.split(";")),dataBindingFilterFormTemplate:new d.Template('<div class="vfeGeneralDataBindingFilterForm">,<div class="item-wrapper elementLabel bindingTypeFilterRow <% if (isDateTimePicker) { %>hidden<% } %>" >,<div class="fieldLabel">&nbsp;</div>,<div class="fieldValue">,<% var entityFilterDisabled = \'\'; %>,<% if (entities.length <= 1) { entityFilterDisabled =\'disabled\'; } %>,<select id="bindingTypeFilter" <%- entityFilterDisabled %>>,<option value="" disabled selected><%= h(23429 /*Filter by type:*/) %></option>,<% if (isFormLayout) { %>,<option value="local"><%= h(23420 /*Form field*/) %></option>,<% } %>,<% for (var i in entities) { %>,<% var entityValue = entities[i].value; %>,<% var filterName = entities[i].filterName; %>,<option value="<%- entityValue %>"><%- filterName %></option>,<% } %>,</select>,</div>,</div>,<div class="item-wrapper elementLabel" id="fieldSelectorFilterSearch">,<div class="fieldLabel">&nbsp;</div>,<div class="fieldValue" >,<input type="text" value="" placeholder="<%= h(23430 /*Filter by name or label*/) %>" aria-label="<%= h(23430 /*Filter by name or label*/) %>" />,</div>,</div>,<div class="item-wrapper elementLabel dataBindingElementSelector" >,<div class="fieldLabel">,<span title="Select field"><%= h(23431 /*Data field*/) %></span>,</div>,<div class="fieldValue">,<input  type="text" id="localFormFieldLabelInput"  value="<%- label %>" maxlength="80" />,<select             id="fieldSelector"             size="10"></select>,</div>,</div>,<div class="item-wrapper elementLabel fieldGuiTypeFiterRow">,<div class="fieldLabel">&nbsp;</div>,<div class="fieldValue" >,<input type="checkbox" id="fieldGuiTypeFiter" checked/><label id="fieldGuiTypeFiterLabel" for="fieldGuiTypeFiter"></label>,</div>,</div>,<div id="noteAboutGuiTypeChange"></div>,</div>'.split(",")),
errorTemplate:new d.Template(['<div class="fieldError">','<div class="warningIcon"><div></div></div>','<div class="errorText">',"<%- error_text %>","</div>"]),getEntityFilterName:function(b){if("local"===b)return h("23420");switch(parseInt(b)){case 1:return h("23423");case 2:return h("23424");case 3:return h("23425");case 5:return h("23426");case 9:return h("23427");case 10:return h("23428");case 11:return h("23420")}return""},_entityProperties:null,filterEntities:function(){if(!this._entityProperties){var b=
[],c=d.CompanySettings.VisualFormEditor.classes.factory.getAvailableEntities();$.each(this.model.getEntityMap(),function(d,l){var n=parseInt(d,10);-1!==$.inArray(n,c)&&b.push({value:n,filterName:this.getEntityFilterName(n),items:this.getFieldsList(d)})}.bind(this));this._entityProperties=b}return this._entityProperties},render:function(){this.barcodeSelector=this.guiSelector=null;this.bindingTypeFilter=this.bindingType=this.model.isLocal()?"local":parseInt(this.model.getEntity(),10);var b="local"===
this.bindingType?""+this.model.getLabel():[this.bindingType,this.model.getLabel()].join("."),b=this.model.getLabel()?b:"";this.element=$(this.template.apply({selectedValue:b,label:this.model.getLabel(),bindingTypeName:this.getEntityFilterName(this.bindingType),entities:this.filterEntities()}));this.checkErrors();this.renderGuiChange();this.renderScannerChange();this._isForm()&&this.renderDateTimeDropdown();this.initEvent();this.initOracleJetCombobox(b)},initOracleJetFieldsList:function(){var b=this.filterEntities(),
c={},d={},l;for(l in b){var n=b[l];if(n.hasOwnProperty("items")&&n.items.length)for(var p in n.items){var s=n.items[p],t=s.guiType,u=n.value;d[u]=n.filterName;t=this.guiMap[t];c.hasOwnProperty(t)||(c[t]=[]);"undefined"===typeof c[t][u]&&(c[t][u]=[]);c[t][u].push({value:[n.value,s.label].join("."),label:s.name+" ["+s.label+"]",text:s.name,field:s.label,gui:t})}}n={label:h("23420"),children:[{value:"11.",label:"",text:"",field:"",gui:""}]};b={};for(l in this.guiMap)t=this.guiMap[l],b.hasOwnProperty(t)||
(b[t]=[],this._isForm()&&b[t].push(n));for(t in c)if(b.hasOwnProperty(t))for(u in l=c[t],l)if(n=l[u],n.length){s={label:d[u],children:[]};for(p in n)s.children.push(n[p]);b[t].push(s)}return b},initOracleJetCombobox:function(b){var c=this,d=this._isForm()?"form":"context",l=this,n=this.model,p=this.guiMap,s=this.initOracleJetFieldsList(),t=this.updateSelectedField.bind(this);require("ojs/ojcore knockout jquery ojs/ojknockout ojs/ojselectcombobox ojs/ojvalidation-base".split(" "),function(u,v,w){w(function(){var u=
new function(b){var d=this;d.updateDropDownFormFieldLabel=function(b){d.isForm()&&d.entityProperties.replace(d.entityProperties()[0],{label:h("23420"),children:[{value:"11."+b,label:b,text:"",field:b,gui:d.currentGui}]})};d.isForm=function(){return"form"===d.context};c.iniJetInstanse=d;d.onGuiChange=function(b,c){var e=c.model.get("gui");d.currentGui!==e&&(d.currentGui=e,e=d.comboboxOptions[d.guiMap[e]],d.optionsMap=d.prepareOptionsMapFrom(e),d.entityProperties(e))};l.addListener("changeGuiType",
d.onGuiChange.bind(d));d.onLabelChange=function(b,c){var e=[c.model.get("entity"),c.model.get("label")].join(".");d.currentValue!==e&&(d.currentValue=e,d.updateDropDownFormFieldLabel(c.model.get("label")),d.selectedValue(e))};l.addListener("changeLabel",d.onLabelChange.bind(d));d.prepareOptionsMapFrom=function(b){var c={},d;for(d in b){var e=b[d],g;for(g in e.children){var k=e.children[g];c.hasOwnProperty(k.value)||(c[k.value]=k.field)}}return c};d.valueChanged=function(b){var c=b.detail.previousValue||
"";b=b.detail.value||"";var e=!1;!b.length&&c.length&&(e=!0);d.isForm()||"undefined"!==typeof d.optionsMap[b]||(e=!0);e&&(b=c,d.selectedValue(c));var e=d.isForm()?"11":d.dataModel.get("entity"),g=-1===c.indexOf(".")?[e,c]:c.split("."),c=g.shift();g.join(".");e=-1===b.indexOf(".")?[e,b]:b.split(".");b=e.shift();e=e.join(".");selectedEntity=e.length?b:c;selectedLabel=e;t(selectedEntity,selectedLabel)};d.rawValueChanged=function(b){if(d.isForm()){var c=b.detail.value;b.detail.originalEvent&&b.detail.originalEvent.type&&
"input"===b.detail.originalEvent.type||!d.optionsMap.hasOwnProperty(d.selectedValue())||(c=d.optionsMap[d.selectedValue()]);d.updateDropDownFormFieldLabel(c)}};d.optionRenderer=function(b){if(!b.leaf){var c=document.createElement("span");c.style.fontSize="12px";c.style.fontWeight="bold";c.textContent=b.data.label;var d=document.createElement("div");d.style.fontWeight="normal";d.style.marginTop="-20px";d.appendChild(c);return{insert:d}}d=document.createElement("div");d.style.fontWeight="normal";d.style.lineHeight=
"normal";d.style.marginTop="-20px";b.data.text&&(c=document.createElement("span"),c.style.fontSize="12px",c.style.display="block",c.style.lineHeight="normal",c.textContent=b.data.text,d.appendChild(c));b.data.field&&(c=document.createElement("span"),c.style.fontSize="11px",c.style.lineHeight="normal",c.textContent="["+b.data.field+"]",d.appendChild(c));return{insert:d}};d.dataModel=b.model;d.context=b.context;d.guiMap=b.guiMap;d.comboboxOptions=b.fields;var e=d.dataModel.get("gui",""),k=d.comboboxOptions[d.guiMap[e]];
d.optionsMap=d.prepareOptionsMapFrom(k);d.entityProperties=v.observableArray(k);d.currentGui=e;d.selectedValue=v.observable(b.defaultValue);d.currentValue=b.defaultValue;d.valueValidators=[{type:"length",options:{min:1,max:d.isForm()?80:40}}]}({model:n,context:d,guiMap:p,defaultValue:b,fields:s}),y=document.getElementById("dataBindingForm");v.applyBindings(u,y);w("#dataBindingForm").css("display","block")})})},setGuiTypesList:function(b){this.guiTypesList=b},getGuiTypeName:function(b){"undefined"===
typeof b&&(b=this.model.getGuiType());var c="";this.guiTypesList.each(function(d){if("form_element"===d.getType()||"field"===d.getType())if(d.getGuiType()===b||"input"===d.getGuiType()&&("text"===b||"phone"===b||"email"===b||"url"===b)||"combobox"===d.getGuiType()&&"radiogroup"===b)return c=d.get("defaultName"),!1}.bind(this));return""===c?b:c},_showFieldFilterPopUp:function(b){if($(this).hasClass("disableBundlingEdit"))return!1;b=$(this.dataBindingFilterFormTemplate.apply({isFormLayout:d.CompanySettings.VisualFormEditor.classes.factory.getFormContext(),
label:this.model.get("label"),gui:this.model.getGuiType(),binding:this.bindingType,entities:this.filterEntities(),isDateTimePicker:this._isForm()&&this.model.isDateTime()}));this.fieldFilterPopUp=new d.ui.Popup({title:h(23432),autoOpen:!0,modal:!0,html:b,onClose:function(){this.destroy()},buttons:[{text:h(14621),position:"left",click:function(){this.destroy()}},{id:"fieldFilterSubmitBtn",text:h(445),type:"submit",position:"right",click:function(){this.onChangeFieldFilter();this.fieldFilterPopUp.destroy()}.bind(this)}]});
this.dataBindingFilterForm=$(this.fieldFilterPopUp.getDomContent());this.dataBindingFilterForm.find("#bindingTypeFilter").on("change",this.onChangeBindingTypeFilter.bind(this));this.dataBindingFilterForm.find("#fieldSelectorFilterSearch input").on("input",this.onSearchByNameFilter.bind(this));this.dataBindingFilterForm.find("#localFormFieldLabelInput").on("input",this.onChangeFieldInFilter.bind(this));this.dataBindingFilterForm.find("#fieldSelector").on("change",this.onChangeFieldInFilter.bind(this));
this.dataBindingFilterForm.find("#fieldGuiTypeFiter").on("change",this.renderDataBindingFilter.bind(this));this.bindingTypeFilter=this.bindingType;this.renderDataBindingFilter()},_isForm:function(){return d.CompanySettings.VisualFormEditor.classes.factory.getFormContext()},renderDataBindingFilter:function(){this.fieldFilterPopUp.enableButton("fieldFilterSubmitBtn");this.dataBindingFilterForm.find("#bindingTypeFilter").val(this.bindingTypeFilter);if("local"===this.bindingTypeFilter)this.dataBindingFilterForm.find(".vfeGeneralDataBindingFilterForm").removeClass("propertySelectorForm").addClass("formFieldInputForm"),
""===this.dataBindingFilterForm.find("#localFormFieldLabelInput").val().trim()&&this.fieldFilterPopUp.disableButton("fieldFilterSubmitBtn");else{this.dataBindingFilterForm.find(".vfeGeneralDataBindingFilterForm").removeClass("formFieldInputForm").addClass("propertySelectorForm");var b=this.getFieldsList(),c="",k=d.CompanySettings.VisualFormEditor.classes.factory.getLayoutStructure(),l;for(l in b){var n="";if("pid"!=b[l].label||"mobile_activity_details"==k.get("context_label")||"web_set_activity"==
k.get("context_label"))b[l].label===this.model.get("label","")&&(n="selected"),c+='<option  data-field-type="'+b[l].type+'" data-gui-type="'+b[l].guiType+'" value="'+b[l].label+'" '+n+">"+b[l].name+" ["+b[l].label+"]</option>"}this.dataBindingFilterForm.find("#fieldSelector").empty();this.dataBindingFilterForm.find("#fieldSelector").append(c);0===this.dataBindingFilterForm.find("#fieldSelector option:selected").length&&this.fieldFilterPopUp.disableButton("fieldFilterSubmitBtn");this.dataBindingFilterForm.find("#fieldGuiTypeFiterLabel").text(h(23434,
{"{ELEMENT_GUI_TYPE_NAME}":this.getGuiTypeName()}));this.showGuiTypeChangeMessage();this.onSearchByNameFilter()}},getFieldsList:function(b){b={entity:b||this.bindingTypeFilter};this.dataBindingFilterForm&&this.dataBindingFilterForm.find("#fieldGuiTypeFiter").is(":checked")&&(b.gui=this.model.getGuiType());return d.CompanySettings.VisualFormEditor.classes.factory.filterFieldsList(b)},renderGuiChange:function(){this.guiSelector&&(this.element.find("#guiSelector").remove(),this.guiSelector=null);this.model.isEnumeration()&&
(this.guiSelector=$(this.guiSelectorTemplate.apply({gui:this.model.getGuiType(),readOnly:!1===this.model.isLocal()})),this.element.find(".sectionContent").append(this.guiSelector),this.guiSelector.find("select.guiTypeSelect").on("change",this.onChangeGui.bind(this)),this.model.isLocal()&&this.renderEnumValues())},renderScannerChange:function(){this.barcodeSelector&&(this.element.find("#barcodeSelector").remove(),this.barcodeSelector=null);this.model.isBarcode()&&(this.barcodeCheckbox=$(this.inputTypeCheckboxTemplate.apply({barcode:this.model.getBarcodeFlag(),
readOnly:!1})),this.element.find(".sectionContent").append(this.barcodeCheckbox),this.barcodeSelector=this.barcodeCheckbox.find("#fieldScanner").on("change",this.onChangeBarcodeFlag.bind(this)))},renderDateTimeDropdown:function(){if(this.model.isDateTime()){var b=$(this.datetimeTypeSelectorTemplate.apply({gui:this.model.getGuiType(),readOnly:!1}));this.element.find(".sectionContent").append(b);b.find("select.dateTimeTypeFilter").on("change",this.onChangeGui.bind(this))}},renderEnumValues:function(){var b=
$(this.enumValuesTemplate.apply({valueCount:this.model.getEnumerationValues().length}));this.element.find(".enumerationValues").empty().append(b);this.element.find(".enumValuesEdit").on("click",this.onEditEnumerationValues.bind(this))},checkErrors:function(){if(this.model.hasValidationErrors()){var b=d.CompanySettings.VisualFormEditor.classes.factory.getErrorCollection();$.each(this.model.get("errors",[]),function(c,d){var l=b.getByUid(d);if(l&&"wrong_content"===l.get("error_type","")){var n=this.element.find(".elementLabel.item-wrapper"),
p=l.get("error_text","");""!==l.get("item_label","")&&(p=r(22651,{"{LABEL}":this.model.get("label","")}));l=$(this.errorTemplate.apply({error_text:p}));n.find(".fieldValue").append(l)}}.bind(this))}},initEvent:function(){this.element.find(".label").on("click",this.onExpandSection.bind(this));this.element.find(".data-binding-field-selector").on("click",this._showFieldFilterPopUp.bind(this))},onEditEnumerationValues:function(){var b=this.model.getEnumerationValues();this.valueEditor=new d.CompanySettings.VisualFormEditor.views.ValueEditorWidget({values:b});
this.valueEditor.render().done(this.saveEnumerationValues.bind(this))},saveEnumerationValues:function(b){this.notify("vfe-item-before-update",this);this.model.setEnumerationValues(b);this.renderEnumValues();this.notify("vfe-update-enum-values","")},onExpandSection:function(){this.element.toggleClass("collapsed");this.notify("vfe-reset-position",this)},onChangeBarcodeFlag:function(b){b=$(b.currentTarget).is(":checked");this.notify("vfe-item-before-update",this);this.model.set({scanner:b?1:0});this.model.notify("changeBarcodeFlag",
this);this.notify("vfe-reset-position",this)},onChangeGui:function(b){b=$(b.currentTarget).val();this.notify("vfe-item-before-update",this);this.model.set({gui:b});this.model.notify("changeGuiType",this);this.notify("changeGuiType",this);this.notify("vfe-reset-position",this)},onChangeBindingTypeFilter:function(b){this.dataBindingFilterForm.find("#fieldSelector").val("");this.bindingTypeFilter=$(b.currentTarget).val();this.renderDataBindingFilter()},showGuiTypeChangeMessage:function(b){b=this.getGuiTypeName();
var c=this.getGuiTypeName(this.dataBindingFilterForm.find("#fieldSelector option:selected").data("gui-type"));b!==c?(this.dataBindingFilterForm.find("#noteAboutGuiTypeChange").text(h(23435,{"{ELEMENT_GUI_TYPE_NAME_FROM}":b,"{ELEMENT_GUI_TYPE_NAME_TO}":c})),this.dataBindingFilterForm.find("#noteAboutGuiTypeChange").show()):this.dataBindingFilterForm.find("#noteAboutGuiTypeChange").hide()},onChangeFieldInFilter:function(b){this.showGuiTypeChangeMessage();""!==$(b.currentTarget).val().trim()?this.fieldFilterPopUp.enableButton("fieldFilterSubmitBtn"):
this.fieldFilterPopUp.disableButton("fieldFilterSubmitBtn")},onSearchByNameFilter:function(b){var c=this.dataBindingFilterForm.find("#fieldSelectorFilterSearch input").val();b=this.dataBindingFilterForm.find("select#fieldSelector");var d=this.dataBindingFilterForm.find("select#fieldSelector option");""!==c&&(b.val(""),isMSIE11||isEdge?$.each(d,function(b,d){$(d).parent().is("div")||$(d).wrap("<div></div>").hide();-1!==$(d).text().toLowerCase().indexOf(c.toLowerCase())&&$(d).parent().is("div")&&$(d).unwrap().show()}.bind(this)):
(d.show(),$.each(d,function(b,d){-1===$(d).text().toLowerCase().indexOf(c.toLowerCase())&&$(d).hide()}.bind(this))),1===b.find("option:visible").length?(b.val(b.find("option:visible").val()),this.fieldFilterPopUp.enableButton("fieldFilterSubmitBtn")):this.fieldFilterPopUp.disableButton("fieldFilterSubmitBtn"));this.showGuiTypeChangeMessage()},updateSelectedField:function(b,c){this.bindingType="11"===b?"local":b;var k=this.model.isLocal(),l="local"===this.bindingType;if(c!==this.model.getLabel()||
!(!k&&!l||k&&l)){this.element.find("#bindingTypeName").text(this.getEntityFilterName(this.bindingType));this.notify("vfe-item-before-update",this);var n=!1;k&&l&&c.length?(this.model.set({label:c}),this.model.notify("changeLabel",this),this.notify("changeLabel",this)):(l?!k&&l&&(this.assignLocalField(c),this.model.notify("changeName","")):(n=d.CompanySettings.VisualFormEditor.classes.factory.getAvailableFieldCollection(),n=(k=n.getByLabelEntity(c,this.bindingType))&&k.hasLookups(),k&&this.assignEntityField(k),
k=k?k.getName():"",this.model.notify("changeName",k),this.model.notify("changeGuiType",this),this.notify("changeGuiType",this)),this.renderGuiChange(),this.renderScannerChange(),this.model.set({label:c}),this.model.notify("changeLabel",this),this.notify("changeLabel",this),n=this.model.isLocal()&&this.model.isEnumeration()||n,this.notify("showValueVisibility",n),this.notify("showEvaluation",this.model.isEvaluationAllowed()),this.notify("rerenderTranslation",this),this.notify("vfe-reset-position",
this))}},onChangeFieldFilter:function(){this.bindingType=this.dataBindingFilterForm.find("#bindingTypeFilter").val();var b="local"===this.bindingType,c=this.dataBindingFilterForm.find("select#fieldSelector").find(":selected"),b=b?this.dataBindingFilterForm.find("#localFormFieldLabelInput").val().trim():c.val();this.updateSelectedField(this.bindingType,b)},assignEntityField:function(b){var c=b&&b.hasLookups(),d={type:b.getType(),property_id:b.getPropertyId(),label:b.getLabel(),entity:b.getEntity(),
gui:b.getGuiType()};this.model.setToEntityField(d);this.model.clearVisibilityValue();this.model.clearEvaluation();this.model.clearEnumerationValues();this.model.clearNames();this.model.clearTranslations();this.model.setReadWriteDefaultVisibility(this.model.getEnumerationValues());b=b.get("names");this.model.setNames(b.toJSON());c&&this.model.setVisibilityValue();this.model.isEvaluationAllowed()&&this.model.setValidationMessages()},assignLocalField:function(b){this.model.set({label:b});this.model.setToLocalField();
this.model.set({entity:"11"});this.model.clearVisibilityValue();this.model.clearEvaluation();this.model.clearNames();this.model.clearTranslations();b={text:"input",email:"input",url:"input",phone:"input",input:"input"};var c=this.model.get("gui","input");b.hasOwnProperty(c)&&(this.model.set({gui:b[c]}),this.model.notify("changeGuiType",this),this.notify("changeGuiType",this));this.model.isEnumeration()&&this.model.setVisibilityValue();this.model.isEvaluationAllowed()&&this.model.setValidationMessages()},
destroy:function(){this.iniJetInstanse&&(this.iniJetInstanse=null);this.element&&(this.element.find(".label").off("click"),this.element.find("select").off("change"),this.element.find("input").off("input"),this.element.find(".enumValuesEdit").off("click"));this.dataBindingFilterForm&&(this.dataBindingFilterForm.find("select").off("change"),this.dataBindingFilterForm.find("input").off("input"));this.valueEditor&&this.valueEditor.destroy();c.prototype.destroy.apply(this)}};d.ns("toa.CompanySettings.VisualFormEditor.views.itemSetting.General",
d.define(c,function(){c.apply(this,arguments);this.guiMap={input:"input",text:"input",url:"input",phone:"input",email:"input",checkbox:"checkbox",combobox:"list",radiogroup:"list",file:"file",image:"image",signature:"signature",capture_image:"image",geolocation:"geolocation",datepicker:"datetime",timepicker:"datetime",datetimepicker:"datetime"}},b))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.itemSetting.ButtonSettings",d.define(c,function(){c.apply(this,arguments)},{template:new d.Template('<div class="sectionContent">;<div class="fieldRow elementField actionBindingFieldRow">;<div class="item-wrapper elementLabel">;<div class="fieldLabel">;<span id="bindingTypeName"><%- screenTypeName %></span>;</div>;<div class="fieldValue">;<input class="elementLabelInput" aria-label="<%- screenTypeName %>" value="<%- label %>" maxlength="80" readonly/>;<div role="button" tabindex="0" class="data-binding-field-selector ui-button multiselect-tip-button ui-button-icon-only"><span class="ui-icon ui-button-icon-primary ui-icon-modify">Edit</span></div>;<div class="clear"></div></div>;<div class="clear"></div>;</div>;</div>;</div>'.split(";")),
actionBindingFilterFormTemplate:new d.Template('<div class="vfeButtonActionBindingFilterForm">,<div class="fieldRow formActionField screenTypeRow">,<div class="item-wrapper">,<div class="fieldLabel">,<span title="<%= h(18140/*Screen type*/) %>">&nbsp;</span>,</div>,<div class="fieldValue">,<select class="screenType">,<option value="" disabled><%= h(18140/*Screen type*/) %></option>,<option value="standard_action_screen"  <% if (currentScreenType === "standard_action_screen"){ %>selected<% }%> ><%= h(18141/*Standard action screen*/) %></option>,<% if (availableForms.length > 0) { %>,<option value="custom_forms"            <% if (currentScreenType === "custom_forms"          ){ %>selected<% }%> ><%= h(18142/*Custom forms*/          ) %></option>,<% } %>,<% if (availablePlugins.length > 0) { %>,<option value="plugins"                 <% if (currentScreenType === "plugins"               ){ %>selected<% }%> ><%= h(18143/*Plug-ins*/              ) %></option>,<% } %>,</select>,</div>,<div class="clear"></div>,</div>,</div>,<div class="item-wrapper elementLabel" id="fieldSelectorFilterSearch">,<div class="fieldLabel">&nbsp;</div>,<div class="fieldValue" >,<input type="text" placeholder="<%= h(23430 /*Filter by name or label*/) %>" maxlength="80" />,</div>,</div>,<div class="fieldRow formActionField formName buttonSuboption" style="display: none;">,<div class="item-wrapper">,<div class="fieldLabel">,<span title="<%= h(18144/*Screen*/) %>"><%= h(18144/*Screen*/) %></span>,</div>,<div class="fieldValue">,<select class="formSelect" size="10">,<% for (var i in availableForms) { %>,<% var formItem = availableForms[i]; %>,<option data-form-id="<%- formItem.form_id %>" value="<%- formItem.label %>" <% if (formItem.label === formLabel) { %>selected<% } %>><%- formItem.name %> [<%- formItem.label %>]</option>,<% } %>,</select>,</div>,<div class="clear"></div>,</div>,</div>,<div class="fieldRow formActionField screenName buttonSuboption" style="display: none;">,<div class="item-wrapper">,<div class="fieldLabel">,<span title="<%= h(18144/*Screen*/) %>"><%= h(18144/*Screen*/) %></span>,</div>,<div class="fieldValue">,<select class="screenSelect" size="10">,<% for (var i in availableScreens) { %>,<% var formItem = availableScreens[i]; %>,<option data-action-link-id="<%- formItem.action_link_id %>" value="<%- formItem.label %>" <% if (formItem.action_link_id == actionLinkId || baseLabel == formItem.label) { %>selected<% } %> ><%- formItem.name %> [<%- formItem.label %>]</option>,<% } %>,</select>,</div>,<div class="clear"></div>,</div>,</div>,<div class="fieldRow formActionField pluginName buttonSuboption" style="display: none;">,<div class="item-wrapper">,<div class="fieldLabel">,<span title="<%= h(18144/*Screen*/) %>"><%= h(18144/*Screen*/) %></span>,</div>,<div class="fieldValue">,<select name="action_link_id" class="screenSelect" size="10">,<% for (var i in availablePlugins) { %>,<% var formItem = availablePlugins[i]; %>,<option data-action-link-id="<%- formItem.action_link_id %>" value="<%- formItem.label %>" <% if (formItem.action_link_id == actionLinkId || baseLabel == formItem.label) { %>selected<% } %> ><%- formItem.name %> [<%- formItem.label %>]</option>,<% } %>,</select>,</div>,<div class="clear"></div>,</div>,</div>,</div>'.split(",")),
render:function(){var b="form"===this.model.get("type")?this.model.getFormId():"",c=this.extractLabel();this.element=$(this.template.apply({formId:b,label:c,formLabel:this.model.get("label",""),actionLinkId:this.model.get("action_link_id",""),isPlugin:this.model.get("is_plugin",""),baseLabel:this.model.get("base_label",""),availableForms:this.model.getFormsList(),availableScreens:this.model.getScreensList(),availablePlugins:this.getPluginList(),availableParameters:this.model.getParametersList(),entites:this.model.getEntitesList(),
screenTypeName:this.getCurrentScreenTypeName()}));this.getElement().find("input.elementLabelInput").val(c);this.getElement().find("#bindingTypeName").text(this.getCurrentScreenTypeName());this.initEvent();return this},extractLabel:function(){return!0==this.model.get("is_plugin",!1)?this.model.get("label",""):""!=this.model.get("base_label","")?this.model.get("base_label"):this.model.get("label","")},getPluginList:function(){return this.model.getPluginsList()},initEvent:function(){this.getElement().find(".data-binding-field-selector").on("click",
this._showFieldFilterPopUp.bind(this))},getCurrentScreenTypeName:function(){switch(this.getCurrentScreenType()){case "standard_action_screen":return h(18141);case "custom_forms":return h(18142);case "plugins":return h(18143);default:return""}},getCurrentScreenType:function(){return"form"===this.model.get("type")&&this.model.getFormId()?"custom_forms":!1==this.model.get("is_plugin",!1)&&null!=this.model.get("action_link_id","")?"standard_action_screen":!0==this.model.get("is_plugin",!1)?"plugins":
"standard_action_screen"},getCurrentLanguageItemName:function(b){b=b||[];if(!(b instanceof d.CompanySettings.VisualFormEditor.models.collection.Translations)){var c=b;b=new d.CompanySettings.VisualFormEditor.models.collection.Translations;b.load(c)}return(b=b.get(this.model.getUserLanguage()))?b.get("name",""):""},initScreensSelectors:function(b){var c=this.actionBindingFilterForm.find("select.screenType option:selected"),d=!1,k=!1,l=this.actionBindingFilterForm.find(".formName   select.formSelect, .screenName select.screenSelect,.pluginName select.screenSelect");
l.find("option").show();"undefined"!==typeof b&&!0===b&&l.val("");this.actionBindingFilterForm.find(".buttonSuboption").hide();switch(c.val()){case "custom_forms":this.actionBindingFilterForm.find(".formName").show();d=k=!0;break;case "standard_action_screen":this.actionBindingFilterForm.find(".screenName").show();d=!0;k=!1;break;case "plugins":this.actionBindingFilterForm.find(".pluginName").show(),k=d=!1}this.actionBindingFilterFormResult.showParameters=d;this.actionBindingFilterFormResult.showModifyFormContent=
k;this.model.isForm()&&!this.model.getFormId()||this.setInitialSelectionResult()},setInitialSelectionResult:function(){this.model.isForm()?this.actionBindingFilterFormResult.transl=this.model.getFormTranslation(this.model.getFormId()):this.actionBindingFilterFormResult.transl=this.model.getActionTranslation(this.model.get("action_link_id",""));this.actionBindingFilterFormResult.changeName=this.getCurrentLanguageItemName(this.actionBindingFilterFormResult.transl);this.actionBindingFilterFormResult.label=
this.model.get("label","")},onChangeScreenTypeFilter:function(){this.resetActionBindingFilterFormResult();this.initScreensSelectors();this.actionBindingFilterFormResult.screenTypeName=this.actionBindingFilterForm.find("select.screenType option:selected").text();this.isFilterCanBeApplied()},onScreenSelectFilter:function(b){b=$(b.currentTarget).find(":selected");var c="undefined"!==typeof b.data("action-link-id")?parseInt(b.data("action-link-id"),10):null,d="plugins"==this.actionBindingFilterForm.find("select.screenType option:selected").val(),
k=d?this.getPluginList().some(function(b){return b.action_link_id==c&&"addon"==b.plugin_type}.bind(this)):!1;this.model.isForm()?this.actionBindingFilterFormResult.modelNewState={group:"main",type:"action",field:null,action_link_id:c,label:b.attr("value"),action_link_label:b.attr("value"),is_plugin:d,is_addon:k}:this.actionBindingFilterFormResult.modelNewState={action_link_id:c,action_link_label:b.attr("value"),label:b.attr("value"),is_plugin:d,is_addon:k};this.actionBindingFilterFormResult.transl=
this.model.getActionTranslation(c);this.actionBindingFilterFormResult.changeName=this.getCurrentLanguageItemName(this.actionBindingFilterFormResult.transl);this.actionBindingFilterFormResult.label=b.val();this.isFilterCanBeApplied()},onChangeFormFilter:function(b){b=$(b.currentTarget).find(":selected");if("undefined"!==typeof b.data("property-id"))this.model.set({property_id:parseInt(b.data("property-id"),10)});else{var c="undefined"!==typeof b.data("form-id")?parseInt(b.data("form-id"),10):null;
this.model.isAction()?this.actionBindingFilterFormResult.modelNewState={group:"main",type:"form",field:"form",action_link_id:null,form_id:c,label:b.val()}:this.model.isForm()&&(this.actionBindingFilterFormResult.assignFormId=c);this.actionBindingFilterFormResult.transl=this.model.getFormTranslation(c);this.actionBindingFilterFormResult.changeName=this.getCurrentLanguageItemName(this.actionBindingFilterFormResult.transl);this.actionBindingFilterFormResult.label=b.val();this.isFilterCanBeApplied()}},
popupFilterApply:function(){var b=this.actionBindingFilterForm.find(".formName:visible   select.formSelect  , .screenName:visible select.screenSelect, .pluginName:visible select.screenSelect");null!==$(b[0]).val()&&""!==$(b[0]).val()&&$(b[0]).trigger("change");this.notify("vfe-item-before-update",this);this.actionBindingFilterFormResult.modelNewState&&!$.isEmptyObject(this.actionBindingFilterFormResult.modelNewState)&&(this.actionBindingFilterFormResult.modelNewState.is_addon!==this.model.isAddon()&&
(this.actionBindingFilterFormResult.modelNewState.customParams=[]),this.model.set(this.actionBindingFilterFormResult.modelNewState));this.actionBindingFilterFormResult.assignFormId?this.model.assignForm(this.actionBindingFilterFormResult.assignFormId):this.model.setNames(this.actionBindingFilterFormResult.transl);this.model.setTranslations(this.actionBindingFilterFormResult.transl);"bt_change_password"!==this.actionBindingFilterFormResult.modelNewState.label&&this.notify("rerenderParameters");this.notify("showModifyFormContent",
this.actionBindingFilterFormResult.showModifyFormContent);this.notify("changeLabel",this);this.notify("rerenderTranslation",this);this.model.notify("changeName",this.actionBindingFilterFormResult.changeName);this.notify("vfe-reset-position",this);this.getElement().find("input.elementLabelInput").val(this.actionBindingFilterFormResult.label);this.getElement().find("#bindingTypeName").text(this.actionBindingFilterFormResult.screenTypeName)},_showFieldFilterPopUp:function(){if($(this).hasClass("disableBundlingEdit"))return!1;
var b="form"===this.model.get("type")?this.model.getFormId():"",c=d.CompanySettings.VisualFormEditor.classes.factory.getLayoutStructure();this.fieldFilterPopUp=new d.ui.Popup({title:h(23433),autoOpen:!0,modal:!0,html:$(this.actionBindingFilterFormTemplate.apply({currentScreenType:this.getCurrentScreenType(),formId:b,formLabel:this.model.get("label",""),actionLinkId:this.model.get("action_link_id",""),baseLabel:this.model.get("base_label"),availableForms:this.model.getFormsList(),availableScreens:this.model.getScreensList(),
availablePlugins:this.getPluginList(),availableParameters:this.model.getParametersList(),entites:this.model.getEntitesList(),contextLabel:c.get("context_label")})),onClose:function(){this.destroy()},buttons:[{text:h(14621),position:"left",click:function(){this.destroy()}},{id:"fieldFilterSubmitBtn",text:h(445),type:"submit",position:"right",click:function(){this.popupFilterApply();this.fieldFilterPopUp.destroy()}.bind(this)}]});this.actionBindingFilterForm=$(this.fieldFilterPopUp.getDomContent());
this.actionBindingFilterForm.find("#fieldSelectorFilterSearch input").on("input",this.onSearchByNameFilter.bind(this));this.actionBindingFilterForm.find("select.screenType").on("change",this.onChangeScreenTypeFilter.bind(this));this.actionBindingFilterForm.find("select.formSelect").on("change",this.onChangeFormFilter.bind(this));this.actionBindingFilterForm.find("select.screenSelect").on("change",this.onScreenSelectFilter.bind(this));this.resetActionBindingFilterFormResult();this.renderActionBindingFilter()},
resetActionBindingFilterFormResult:function(){this.actionBindingFilterFormResult={transl:!1,showParameters:!1,showModifyFormContent:!0,changeName:!1,label:"",screenTypeName:this.getCurrentScreenTypeName(),modelNewState:{},assignFormId:!1}},renderActionBindingFilter:function(){this.actionBindingFilterForm.find("#fieldSelectorFilterSearch input").val("");this.model.isForm()&&"undefined"!==typeof this.model.getFormId()&&null!=this.model.getFormId()?this.actionBindingFilterForm.find(".formName").show():
this.model.isAction()&&(this.model.isPlugin()?this.actionBindingFilterForm.find(".pluginName").show():this.actionBindingFilterForm.find(".screenName").show());this.resetActionBindingFilterFormResult();this.initScreensSelectors();this.isFilterCanBeApplied()},isFilterCanBeApplied:function(){var b=this.actionBindingFilterForm.find(".formName:visible   select.formSelect  , .screenName:visible select.screenSelect, .pluginName:visible select.screenSelect");null===$(b[0]).val()||""===$(b[0]).val()?this.fieldFilterPopUp.disableButton("fieldFilterSubmitBtn"):
this.fieldFilterPopUp.enableButton("fieldFilterSubmitBtn")},onSearchByNameFilter:function(b){var c=$(b.currentTarget).val();b=this.actionBindingFilterForm.find(".formName:visible   select.formSelect, .screenName:visible select.screenSelect,.pluginName:visible select.screenSelect");var d=b.find("option");b.val("");isMSIE11||isEdge?$.each(d,function(b,d){$(d).parent().is("div")||$(d).wrap("<div></div>").hide();-1!==$(d).text().toLowerCase().indexOf(c.toLowerCase())&&$(d).parent().is("div")&&$(d).unwrap().show()}.bind(this)):
(d.hide(),$.each(d,function(b,d){-1!==$(d).text().toLowerCase().indexOf(c.toLowerCase())&&$(d).show()}.bind(this)));1===b.find("option:visible").length?(b.val(b.find("option:visible").val()).trigger("change"),this.fieldFilterPopUp.enableButton("fieldFilterSubmitBtn")):this.fieldFilterPopUp.disableButton("fieldFilterSubmitBtn")},destroy:function(){this.actionBindingFilterForm&&(this.actionBindingFilterForm.find("select").off("change"),this.actionBindingFilterForm.find("input").off("input"));c.prototype.destroy.apply(this)}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.itemSetting.HiddenSettings",d.define(c,function(){c.apply(this,arguments)},{template:new d.Template('<div class="sectionContent">,<div class="fieldRow elementField" id="formElementLabelSelector">,<div class="item-wrapper elementLabel">,<div class="fieldLabel">,<span title="<%= h(22604/*Label*/) %>"><%= h(22604/*Label*/) %></span>,</div>,<div class="fieldValue">,<input class="elementLabelInput" value="<%- label %>" maxlength="80" />,</div>,<div class="clear"></div>,</div>,</div>,<div class="fieldRow">,<div class="item-wrapper default_expression">,<div class="fieldLabel">,<label for="default_expression" ><%= h(21084/*Default value*/) %></label>,</div>,<div class="fieldValue">,<textarea id="default_expression" rows="2" cols="5" style="height: 34px;" maxlength="2048">,<%- expression %>,</textarea>,</div>,<div class="clear"></div>,</div>,</div></div>'.split(",")),
errorTemplate:new d.Template(['<div class="fieldError">','<div class="warningIcon"><div></div></div>','<div class="errorText">',"<%- error_text %>","</div>"]),onChangeLabel:function(b){b=$(b.currentTarget).val().trim();this.model.set({label:b});this.notify("changeLabel",this)},onInputLabel:function(b){this.notify("vfe-item-before-update",this)},saveChangedLabel:function(b){this.onChangeLabel(b);this.element&&this.element.find("input.elementLabelInput").off()},onChangeExpression:function(b){b=$(b.currentTarget).val();
"undefined"===typeof this.evaluation.evaluation_id&&(this.evaluation.evaluation_id=d.models.ObservableModel.prototype._makeUid.apply());this.evaluation.default_expression=b;this.model.set({evaluation:this.evaluation})},onInputExpression:function(b){this.notify("vfe-item-before-update",this)},saveChangedExpression:function(b){this.onChangeExpression(b);this.element&&this.element.find("textarea").off()},initEvent:function(){var b=this.element.find("input.elementLabelInput"),c=this.element.find("textarea");
b.off();b.on("change",this.onChangeLabel.bind(this));b.on("input",this.onInputLabel.bind(this));b.on("remove",this.saveChangedLabel.bind(this));c.off();c.on("change",this.onChangeExpression.bind(this));c.on("input",this.onInputExpression.bind(this));c.on("remove",this.saveChangedExpression.bind(this))},render:function(){this.evaluation=this.model.get("evaluation",{});this.element=$(this.template.apply({label:this.model.get("label"),expression:this.evaluation.default_expression||""}));this.checkErrors();
this.initEvent();return this},checkErrors:function(){if(this.model.hasValidationErrors()){var b=d.CompanySettings.VisualFormEditor.classes.factory.getErrorCollection();$.each(this.model.get("errors",[]),function(c,d){var k=b.getByUid(d);if(k){var l=k.get("error_text",""),n;"wrong_content"===k.get("error_type","")&&(n=this.element.find(".elementLabel.item-wrapper"),""!==k.get("item_label","")&&(l=r(22651,{"{LABEL}":this.model.get("label","")})));"default_expression"===k.get("error_type","")&&(n=this.element.find(".item-wrapper.default_expression"));
k=$(this.errorTemplate.apply({error_text:l}));n&&n.find(".fieldValue").append(k)}}.bind(this))}},destroy:function(){if(this.element){var b=this.element.find("input"),d=this.element.find("textarea");b.off("change");b.off("input");d.off("change");d.off("input")}c.prototype.destroy.apply(this)}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.Sidebar",d.define(c,function(){c.apply(this,arguments)},{childSections:{},sectionSelectedEvent:"sidebarSectionSelected",template:new d.Template(['<div class="sidebarContent"></div>']),initEvent:function(){$.each(this.getElement().find(".sidebarSection"),function(b,c){c.addEventListener("click",this.onSectionClick.bind(this,c))}.bind(this))},onSectionClick:function(b,c){b===this.sectionSelectedEvent&&
this.collapseSection(c)},collapseSection:function(b){for(var c in this.childSections)this.childSections.hasOwnProperty(c)&&(c===b?this.childSections[c].toggleSection():this.childSections[c].slideUpSection())},render:function(){this.element=$(this.template.apply());return this},appendChild:function(b){if(!(b instanceof d.CompanySettings.VisualFormEditor.views.SidebarSection))throw Error("Sidebar child should implement toa.CompanySettings.VisualFormEditor.views.SidebarSection");this.childSections[b.getSectionId()]=
b;b.addListener("sidebarSectionSelected",this.onSectionClick,this);this.getElement().append(b.getElement())}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.ActionPanel",d.define(c,function(){c.apply(this,arguments)},{template:new d.Template(['<div class="actions toa-button-panel"></div>']),views:{},actionViews:[],render:function(){this.element=$(this.template.apply());this.initEvent();this.initDroppable();return this},initEvent:function(){this.model.addListener("add",this.onUpdate.bind(this));this.model.addListener("load",this.onUpdate.bind(this));
this.model.addListener("reset",this.onUpdate.bind(this));this.model.addListener("remove",this.onUpdate.bind(this));this.model.addListener("appendMarker",this.onAppendMarker.bind(this))},getViewForModel:function(b){return b instanceof d.models.ObservableModel&&this.views[b.getId()]?this.views[b.getId()]:!1},onAppendMarker:function(b,c){c.marker.removeClass();c.marker.addClass("marker");0==this.model.models.length&&this.getContainer().append(c.marker)},onUpdate:function(){var b;this.getContainer().empty();
this.clearActionViews();this.model.each(function(c){b=new d.CompanySettings.VisualFormEditor.views.Button(c);b.render();this.actionViews.push(b);this.getContainer().append(b.getElement())}.bind(this))},clearActionViews:function(){for(var b in this.actionViews)this.actionViews[b].destroy(),delete this.actionViews[b];this.actionViews=[]},destroy:function(){this.clearActionViews();c.prototype.destroy.apply(this)}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.Footer",d.define(c,function(){c.apply(this,arguments)},{template:new d.Template(['<div class="button-panel"></div>']),actionViews:[],render:function(){this.element=$(this.template.apply());this.initEvent();return this},initEvent:function(){this.model.addListener("load",this.onUpdate.bind(this));this.model.addListener("add",this.onUpdate.bind(this));this.model.addListener("reset",this.onUpdate.bind(this));
this.model.addListener("remove",this.onUpdate.bind(this))},onUpdate:function(){var b;this.getContainer().empty();this.getContainer().append('<button class="wysiwyg-button toa-button dismiss" role="button" tabindex="0">'+h(16226)+"</button>");this.model.each(function(c){b=new d.CompanySettings.VisualFormEditor.views.Button(c);b.render();this.actionViews.push(b);this.getContainer().append(b.getElement())}.bind(this))},clearActionViews:function(){for(var b in this.actionViews)this.actionViews[b].destroy(),
delete this.actionViews[b];this.actionViews=[]},destroy:function(){this.clearActionViews();c.prototype.destroy.apply(this)}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.SelectableItem",d.define(c,function(){this.validationUID=this.appendMarkerUID=this.removeUID=null;this.dnd=d.CompanySettings.VisualFormEditor.classes.factory.dnd();c.apply(this,arguments);this.initItemSetting()},{initItemSetting:function(){this.itemSetting=new d.CompanySettings.VisualFormEditor.views.SettingsPopup(this.model)},initBaseClassEvent:function(){c.prototype.initEvent.apply(this)},
initEvent:function(){this.initBaseClassEvent();this.element.on("click",this.onClick.bind(this));this.element.on("keypress",this.onClick.bind(this));this.removeUID=this.model.addListener("remove",this.destroy.bind(this));this.appendMarkerUID=this.model.addListener("appendMarker",this.onAppendMarker.bind(this));this.itemSetting.addListener("itemaction:unselect",this.unselectItem,this);$("#manage-content, #header").on("mousedown.vfe",this.onMouseDown.bind(this));this.validationUID=d.CompanySettings.VisualFormEditor.classes.factory.getErrorCollection().addListener("changed",
this.checkErrors.bind(this))},render:function(){c.prototype.render.apply(this,arguments);this.checkErrors();return this},checkErrors:function(){this.getElement().removeClass(Object.keys(this.constructor.ERRORS_MAP).map(function(b){return this.constructor.ERRORS_MAP[b]}.bind(this)).join(" "));var b=[];d.CompanySettings.VisualFormEditor.classes.factory.getErrorCollection().each(function(c){this.model.getId()+""!==c.get("item_id")+""||c.get("hide_error")||(b.push(c.getId()),this.getElement().addClass(this.constructor.ERRORS_MAP[c.get("error_type")]||
this.constructor.DEFAULT_ERROR))}.bind(this));this.model.set({errors:b})},selectItem:function(){this.element.addClass("overlayItem");this.selectItemOnTheLeftPanel()},selectItemOnTheLeftPanel:function(){var b=$(".sidebarSection .collapsed").next();0<b.find(".configuredItem").length&&(b.find(".configuredItem").removeClass("active"),b=this.element.attr("data-id"),b=document.querySelector('.configuredItem[data-id="'+b+'"]'))&&(b.scrollIntoView({behavior:"smooth"}),b.classList.add("active"))},unselectItem:function(){this.element&&
this.element.removeClass("overlayItem")},onAppendMarker:function(b,c){var d,k;c.marker.removeClass();c.marker.addClass("marker");d=$(this.getElement()[0]).attr("data-id");k=$("button.wysiwyg-button[data-id="+d+"]");if(k.length)return this.proccessingForButtons({draggable_object:$(c.ui.helper),bottom_object:$(k),marker:c.marker,cursor:c.ui.offset});k=$("div.ui-droppable[data-id="+d+"]");if(k.length)return this.proccessingForItems({draggable_object:$(c.ui.helper),bottom_object:$(k),marker:c.marker,
cursor:c.ui.offset});this.dnd.saveState("is_first_in_action_bar",!1);this.dnd.saveState("is_first_in_column",!1);c.marker.insertAfter(this.getElement())},proccessingForButtons:function(b){var c=Math.ceil(b.draggable_object.offset().left);Math.ceil(b.draggable_object.offset().top);Math.ceil(b.draggable_object.outerHeight()/2);var d=Math.ceil(b.bottom_object.outerWidth()/2),k=Math.ceil(b.bottom_object.outerHeight()/2),l=Math.ceil(b.bottom_object.offset().left),n=Math.ceil(b.bottom_object.offset().top),
p=Math.ceil(b.bottom_object.parent().offset().left),p=Math.ceil(b.bottom_object.parent().offset().top);if(!1==b.bottom_object.parent().hasClass("column_content")){if(p=Math.ceil(b.bottom_object.parent().parent().offset().left),Math.ceil(b.bottom_object.parent().parent().offset().top),this.isFirstLeftPositionInActionBar(c,l,p,d)){this.dnd.saveState("is_first_in_action_bar",!0);this.dnd.saveState("is_first_in_column",!1);b.marker.insertBefore(this.getElement());return}}else if(this.isFirstTopPositionInColumn(b.cursor.top,
n,p,k,25,20)){this.dnd.saveState("is_first_in_column",!0);this.dnd.saveState("is_first_in_action_bar",!1);b.marker.insertBefore(this.getElement());return}this.dnd.saveState("is_first_in_action_bar",!1);this.dnd.saveState("is_first_in_column",!1);b.marker.insertAfter(this.getElement())},proccessingForItems:function(b){var c=Math.ceil(b.bottom_object.offset().top);element_half_height=20;var d=Math.ceil(b.bottom_object.parent().offset().top);if(this.isFirstTopPositionInColumn(b.cursor.top,c,d,element_half_height,
21,12))this.dnd.saveState("is_first_in_column",!0),this.dnd.saveState("is_first_in_action_bar",!1),b.marker.insertBefore(this.getElement());else{this.dnd.saveState("is_first_in_action_bar",!1);this.dnd.saveState("is_first_in_column",!1);if(this.getElement().is(".section:not(.ui-droppable-hover)"))if(1==this.getElement().children().eq(0).children().length)b.marker.addClass("marker_for_section");else{c=this.getElement().children().eq(0).children();0<c.last().children().length&&(c=c.last().children(),
0<c.eq(0).children().length&&(c=c.eq(0).children().last(),b.marker.insertAfter(c)));return}b.marker.insertAfter(this.getElement())}},isFirstTopPositionInColumn:function(b,c,d,k,l,n){return c-d<=l&&b>=c-n&&b<c+k?!0:!1},isFirstLeftPositionInActionBar:function(b,c,d,k){return b>d-50&&b<c+k&&10>c-d?!0:!1},onClick:function(b){if("keypress"!==b.type||13===b.keyCode)this.selectItem(),this.itemSetting.render(this.element),b.stopPropagation(),b.preventDefault()},onMouseDown:function(b){$(b.target).closest(this.element).length||
this.unselectItem()},destroy:function(b){this.itemSetting.destroy(b);this.element.off("click");$("#manage-content, #header").off("mousedown.vfe");this.model.removeListener(this.removeUID);this.removeUID&&this.model.removeListener(this.removeUID);this.appendMarkerUID&&this.model.removeListener(this.appendMarkerUID);this.validationUID&&d.CompanySettings.VisualFormEditor.classes.factory.getErrorCollection().removeListener(this.validationUID);this.dnd=null;c.prototype.destroy.apply(this)},initDefaultDraggable:function(){this.getElement().draggable({addClasses:!1,
helper:"clone",scroll:!0,refreshPositions:!0,cursorAt:{top:-5,left:-5},start:this.onDragStart.bind(this),stop:this.onDragStop.bind(this),drag:this.onDrag.bind(this)})},onDragStart:function(b,d){var g=this.model.get("item_id");$(".ui-draggable-handle[data-id ="+g+" ]").not(".ui-draggable-dragging").addClass("ui-draggable-invisible").removeClass("ui-droppable");c.prototype.onDragStart.apply(this,arguments)},onDragStop:function(b,d){var g=this.model.get("item_id");$(".ui-draggable-handle[data-id ="+
g+" ]").removeClass("ui-draggable-invisible").addClass("ui-droppable");c.prototype.onDragStop.apply(this,arguments)}},{DEFAULT_ERROR:"expression_error",ERRORS_MAP:{default_expression:"expression_error",cyclic_dependency:"cyclic_error",wrong_content:"content_error",no_form_link:"content_error"}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.Column",d.define(c,function(b){this.removeUID=this.appendMarkerUID=null;this.dnd=d.CompanySettings.VisualFormEditor.classes.factory.dnd();c.apply(this,arguments)},{template:new d.Template(['<div data-id="<%-id%>" class="column">','<div class="column_content"></div>',"</div>"]),render:function(){this.element=$(this.template.apply({id:this.model.getId()}));this.container=this.element.find(".column_content");
this.initDroppable();this.appendMarkerUID=this.model.addListener("appendMarker",this.onAppendMarker.bind(this));this.removeUID=this.model.addListener("remove",this.onRemove.bind(this));return this},initDroppableContainer:function(){this.getContainer().droppable({greedy:!1,accept:function(){return!1},tolerance:"pointer"})},getContainer:function(){return this.container},onAppendMarker:function(b,c){c.marker.removeClass();c.marker.addClass("marker merkerColumn");var d=$(this.getElement()[0]).attr("data-id"),
k=$("div.column[data-id="+d+"]");if("undefined"!=typeof k.offset){var l=Math.ceil(k.outerHeight()/2);175<l&&(l=175);80>l&&(l=80);var d=Math.ceil(k.offset().left)+Math.ceil(k.outerWidth()/2),k=Math.ceil(k.offset().top)+l,l=Math.ceil($(c.ui.helper).offset().left)+Math.ceil($(c.ui.helper).outerWidth()/2),n=Math.ceil($(c.ui.helper).offset().top)+Math.ceil($(c.ui.helper).outerHeight()/2);l>d&&n<k?(0==this.getElement().children().eq(0).children().length?c.marker.removeClass("merkerColumn"):this.dnd.saveState("is_last_in_column",
null),c.marker.insertAfter(this.getElement())):this.getElement().is(".column")&&(d=this.getElement().find(".ui-droppable-hover"),1==d.length?(c.marker.removeClass("merkerColumn"),c.marker.insertAfter(d)):0<this.getElement().children().length&&0<this.getElement().children().eq(0).children().length&&(d=this.getElement().children().eq(0).children().last(),this.dnd.saveState("is_last_in_column",d.attr("data-id")),c.marker.removeClass("merkerColumn"),c.marker.insertAfter(d)))}},onRemove:function(){this.destroy()},
destroy:function(){try{this.element.droppable("destroy")}catch(b){}this.appendMarkerUID&&this.model.removeListener(this.appendMarkerUID);this.removeUID&&this.model.removeListener(this.removeUID);this.dnd=null;c.prototype.destroy.apply(this)}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.SelectableItem;d.ns("toa.CompanySettings.VisualFormEditor.views.Section",d.define(c,function(){this.itemDeleteUID=this.itemResetUID=this.itemAddUID=this.changeUID=null;c.apply(this,arguments)},{template:new d.Template('<div data-id="<%-id%>" class="section<% if (collapsed) { %> collapsed<% } %> <% if (true === highlightItem) { %>overlayItem<% } %>" tabindex="0" role="link" aria-grabbed="true">;<div data-id="<%-id%>" class="section_content">;<div class="caption">;<span class="icon_section"></span>;<span class="arrow-icon"></span>;<span class="form<% if ("" === label) { %> placeholderInput<% } %>"><%- (label || placeholder) %></span>;</div>;</div>;</div>'.split(";")),
render:function(){this.element=$(this.template.apply({id:this.model.getId(),placeholder:this.getPlaceholderText(),label:this.model.getName(),highlightItem:this.model.get("highlightItem",!1),collapsed:this.model.isCollapsed()}));this.container=this.element.find(".section_content");this.iconType=this.element.find("span.icon_section");this.collapseControl=this.element.find("span.arrow-icon").first();this.setTypeIcon();this.initEvent();this.initDraggable();this.initDroppable();this.initDroppableContainer();
this.buildItems();c.prototype.render.apply(this,arguments);this.model.set({highlightItem:!1});return this},getContainer:function(){return this.container},getPlaceholderText:function(){return this.model.isSection()?h(15008):h(15030)},buildItems:function(){var b,c,g,k,l=[];this.getContainer().find(".column").detach();this.model.getItems().each(function(k){c=this.createItems(k);if(k instanceof d.CompanySettings.VisualFormEditor.models.Marker){g=new d.CompanySettings.VisualFormEditor.views.Column(k);
g.render();this.append(g);if(l.length)for(b=0;b<l.length;b++)g.append(l[b]);l=[]}else l.push(c)}.bind(this));if(l.length)for(k=new d.CompanySettings.VisualFormEditor.models.Marker({order:this.model.getItems().getMaxOrder()+1}),k.collection=this.model.getItems(),g=new d.CompanySettings.VisualFormEditor.views.Column(k),g.render(),this.append(g),b=0;b<l.length;b++)g.append(l[b])},initEvent:function(){c.prototype.initEvent.apply(this);var b;this.changeUID=this.model.addListener("change",this.onChangeModel.bind(this));
b=this.model.getItems();this.itemAddUID=b.addListener("add",this.buildItems.bind(this));this.itemResetUID=b.addListener("reset",this.buildItems.bind(this));this.itemDeleteUID=b.addListener("remove",this.buildItems.bind(this));this.collapseControl.on("click",this.collapse.bind(this))},collapse:function(b){b.stopPropagation();b.preventDefault();this.model.changeCollapsing();this.element.toggleClass("collapsed")},setUpdatedName:function(b){var c=this.element.find(".caption span.form").first();""===b?
(c.addClass("placeholderInput"),c.text(this.getPlaceholderText())):(c.removeClass("placeholderInput"),c.text(b))},setTypeIcon:function(){this.iconType.removeClass();this.model.isSection()?this.iconType.addClass("icon_section"):this.iconType.addClass("icon_tab")},initDroppableContainer:function(){this.getContainer().droppable({greedy:!0,over:this.onOverContainer.bind(this),out:this.onDropOut.bind(this),drop:this.onDropContainer.bind(this),accept:this.onDropAccept.bind(this),tolerance:"pointer"})},
destroy:function(b){var d;this.changeUID&&this.model.removeListener(this.changeUID);d=this.model.getItems();this.itemAddUID&&d.removeListener(this.itemAddUID);this.itemResetUID&&d.removeListener(this.itemResetUID);this.itemDeleteUID&&d.removeListener(this.itemDeleteUID);this.collapseControl.off("click");c.prototype.destroy.apply(this,[b])},onOverContainer:function(b,c){d.CompanySettings.VisualFormEditor.classes.factory.dnd().dropOver(this.model,b,c)},onDropContainer:function(b,c){d.CompanySettings.VisualFormEditor.classes.factory.dnd().drop(this.model,
b,c)},onDrop:function(b,c){d.CompanySettings.VisualFormEditor.classes.factory.dnd().drop(this.model.collection,b,c,this.model);this.model.collection.removeMarkers()},onChangeModel:function(){this.setTypeIcon()},onClick:function(b){b.originalEvent.clientY<$(this.element).offset().top+34&&c.prototype.onClick.apply(this,arguments)}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.SelectableItem;d.ns("toa.CompanySettings.VisualFormEditor.views.Field",d.define(c,function(b){c.apply(this,arguments)},{emptyName:"",template:new d.Template(['<div data-id="<%- id %>" data-property-id="<%-property_id%>" class="item <% if (true === highlightItem) { %>overlayItem<% } %>" role="link" tabindex="0" aria-grabbed="true">','<div class="label<% if ("" === name) { %> placeholderInput<% } %>"><%- name || emptyName %>:</div>',"</div>"]),
render:function(){this.emptyName="["+h(22602)+"]";this.element=$(this.template.apply({id:this.model.getId(),name:this.model.getName(),highlightItem:this.model.get("highlightItem",!1),emptyName:this.emptyName,property_id:this.model.get("property_id")}));this.renderGuiElement();this.initEvent();this.initDefaultDraggable();this.initDroppable();c.prototype.render.apply(this,arguments);this.model.set({highlightItem:!1});return this},renderGuiElement:function(){var b;switch(this.model.getGuiType()){case "checkbox":b=
'<div class="form checkbox">&nbsp;</div>';break;case "combobox":b='<div class="form dropdown">&nbsp;<div class="arrow"></div></div>';break;case "radiogroup":b='<div class="form radio">&nbsp;</div>';break;case "image":b='<div class="form icon-element"><div class="form-icon image"></div><div class="form-icon-caption">'+h(21061)+"</div></div>";break;case "file":b='<div class="form icon-element"><div class="form-icon file"></div><div class="form-icon-caption">'+h(21062)+"</div></div>";break;case "signature":b=
'<div class="form icon-element"><div class="form-icon signature"></div><div class="form-icon-caption">'+h(21059)+"</div></div>";break;case "geolocation":b='<div class="form icon-element"><div class="form-icon geolocation"></div><div class="form-icon-caption">'+h(21058)+"</div></div>";break;case "url":b='<div class="form input">'+h(21063)+"</div>";break;case "phone":b='<div class="form input">'+h(21064)+"</div>";break;case "email":b='<div class="form input">'+h(21065)+"</div>";break;default:b='<div class="form input">&nbsp;</div>'}this.element.find("div.form").remove();
this.element.find("div.label").after(b)},setUpdatedName:function(b){var c=this.element.find(".label");c.hasClass("placeholderInput")&&c.removeClass("placeholderInput");""===b&&(b=this.emptyName,c.addClass("placeholderInput"));c.text(b+":")},initEvent:function(){c.prototype.initEvent.apply(this,arguments);this.changeUID=this.model.addListener("changeGuiType",this.renderGuiElement.bind(this))},destroy:function(){this.changeUID&&this.model.removeListener(this.changeUID);c.prototype.destroy.apply(this)}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.SelectableItem;d.ns("toa.CompanySettings.VisualFormEditor.views.Button",d.define(c,function(){c.apply(this,arguments);this.emptyName="";this.model instanceof d.CompanySettings.VisualFormEditor.models.Button&&this.model.isForm()&&(this.emptyName=h(22610),this.model.assignForm(this.model.getFormId()))},{template:new d.Template(['<button data-id="<%-id%>" role="button" tabindex="0" <% if (name) { %>aria-label="<%- name %>"<% } %> data-label="<%-label%>" class="wysiwyg-button toa-button <% if (true === highlightItem) { %>overlayItem<% } %>">',
"<% if (name) { %><%- name %><% } else { %>&nbsp;<% } %>","</button>"]),render:function(){this.element=$(this.template.apply({id:this.model.getId(),name:this.model.getName()||this.emptyName,highlightItem:this.model.get("highlightItem",!1),label:this.model.get("label")}));this.initEvent();this.model.isFooterButton()||(this.initDraggable(),this.initDroppable());c.prototype.render.apply(this,arguments);this.model.set({highlightItem:!1});return this},initDraggable:function(){this.getElement().draggable({addClasses:!1,
helper:"clone",scroll:!0,refreshPositions:!0,cancel:!1,cursorAt:{top:-5,left:-5},start:this.onDragStart.bind(this),stop:this.onDragStop.bind(this),drag:this.onDrag.bind(this)})},setUpdatedName:function(b){b=b||this.emptyName;""!==b?this.element.text(b):this.element.html("&nbsp;")}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.SelectableItem;d.ns("toa.CompanySettings.VisualFormEditor.views.Text",d.define(c,function(){c.apply(this,arguments)},{template:new d.Template(['<div  data-id="<%-id%>" class="text <% if (true === highlightItem) { %>overlayItem<% } %>">','<span data-type="text" class="form<% if ("" === name) { %> placeholderInput<% } %>"><%- (name || placeholder) %></span>',"</div>"]),render:function(){this.element=$(this.template.apply({id:this.model.getId(),
placeholder:h(15009),highlightItem:this.model.get("highlightItem",!1),name:this.model.getName()}));this.initEvent();this.initDefaultDraggable();this.initDroppable();c.prototype.render.apply(this,arguments);this.model.set({highlightItem:!1});return this},setUpdatedName:function(b){var c=this.element.find("span");""===b?(c.addClass("placeholderInput"),c.text(h(15009))):(c.removeClass("placeholderInput"),c.text(b))}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.SelectableItem;d.ns("toa.CompanySettings.VisualFormEditor.views.Hidden",d.define(c,function(b){c.apply(this,arguments)},{template:new d.Template(['<div  data-id="<%-id%>" class="text">','<span data-type="text" class="form placeholderInput"><%- placeholder %></span>',"</div>"]),render:function(){this.element=$(this.template.apply({id:this.model.getId(),placeholder:"["+h(23122)+"]"}));this.initEvent();this.initDefaultDraggable();this.initDroppable();
c.prototype.render.apply(this,arguments);return this},setUpdatedName:function(b){}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.MainLayout",d.define(c,function(){c.apply(this,arguments)},{views:{},sections:[],template:new d.Template(['<div class="context-content"></div>']),render:function(){this.element=$(this.template.apply());this.initEvent();this.initDroppable();return this},initEvent:function(){this.addUID=this.model.addListener("add",this.onUpdate.bind(this));this.resetUID=this.model.addListener("reset",
this.onUpdate.bind(this));this.removeUID=this.model.addListener("remove",this.onUpdate.bind(this));this.loadUID=this.model.addListener("load",this.onUpdate.bind(this))},buildItems:function(){var b,c,g,k=this;g=[];this.model.each(function(b){var c;if(b instanceof d.CompanySettings.VisualFormEditor.models.Marker){b=new d.CompanySettings.VisualFormEditor.views.Column(b);b.render();for(c=0;c<g.length;c++)b.append(g[c]);g=[];this.append(b)}else b instanceof d.CompanySettings.VisualFormEditor.models.Section&&
(b=new d.CompanySettings.VisualFormEditor.views.Section(b),b.render(),k.sections.push(b),g.push(b))}.bind(this));b=new d.CompanySettings.VisualFormEditor.models.Marker({order:this.model.getMaxOrder()+1});b.collection=this.model;c=new d.CompanySettings.VisualFormEditor.views.Column(b);c.render();for(b=0;b<g.length;b++)c.append(g[b]);g=[];this.append(c);this.notify("loaded")},onUpdate:function(){this.empty();this.buildItems();this.resizeFirstColumn()},resizeFirstColumn:function(){var b=this.getElement().parent().height()-
10;this.getElement().find(".column.ui-droppable:first").css({"min-height":b+"px"})},destroy:function(){this.loadUID&&this.model.removeListener(this.loadUID);this.resetUID&&this.model.removeListener(this.resetUID);this.addUID&&this.model.removeListener(this.addUID);this.removeUID&&this.model.removeListener(this.removeUID);if(0<this.sections.length){for(var b in this.sections)this.sections[b].destroy(!0),delete this.sections[b];this.sections=[]}c.prototype.destroy.apply(this,[!0])}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.SettingsPopup",d.define(c,function(){this.updateHiddenUID=this.updateEvaluationUID=this.updateVisValUID=this.updateTranslationsUID=this.updateParametersUID=this.updateVisibilityUID=this.updateGeneralUID=null;this.isBeforeChanged=!1;c.apply(this,arguments);this.initFliper();this.translations=this.parameters=this.evaluation=this.visibilityValue=this.visibility=this.general=this.hiddenSettings=
this.buttonSettings=null;this.popupContainer=3===d.currentInterface?"#toa-wysiwyg, .wysiwyg-panel, .header-wrapper":"#manage-content, #header"},{mapPosition:[["right","top"],["right","bottom"],["right","center"],["right","auto"],["left","top"],["left","bottom"],["left","center"],["left","auto"]],template:new d.Template('<div class="vfe_settings_popup">;<div class="popupPointer"></div>;<div class="settingsTitle">;<div class="textSide <%- "button" !== type ? "short" : "" %>">;<span class="titleText label"><%- label %></span>;</div>;<% if ("button" !== type) { %>;<div class="actionSide actionSideTruncated" title="<%= h(21056 /*Remove*/) %>">;<span role="link" tabindex="0" class="titleAction remove"><%= h(21056 /*Remove*/) %></span>;</div>;<% } %>;<div class="actionSide actionSideTruncated" title="<%= h(18190 /*Modify form content */) %>">;<span role="link" tabindex="0" class="titleAction openForm"><%= h(18190 /*Modify form content */) %></span>;</div>;</div>;<div class="settingsContent">;<div class="sectionSettingsContainer"></div>;<div class="hiddenSettingsSectionContainer"></div>;<div class="buttonSettingsSectionContainer"></div>;<div class="generalSectionContainer"></div>;<div class="translationsSectionContainer"></div>;<div class="visibilitySectionContainer"></div>;<div class="valuesSectionsContainer"></div>;<div class="parametersSectionContainer"></div>;<div class="evaluationSectionContainer"></div>;</div>;</div>'.split(";")),
sectionSettingsTemplate:new d.Template('<div class="section_type">;<div class="label_value"><input type="radio" id="common_section" value="section" name="section_type" /></div>;<label class="label_name" for="common_section"><%= h(15014 /*Section*/) %></label>;<div class="label_value"><input type="radio" id="common_tab" value="tab" name="section_type" /></div>;<label class="label_name" for="common_tab"><%= h(15015 /*Tab*/) %></label>;</div>'.split(";")),errorTemplate:new d.Template(['<div class="fieldError">',
'<div class="warningIcon"><div></div></div>','<div class="errorText">',"<%= hs(error_text) %>","</div>"]),render:function(b){this.anchor=b;this.element=$(this.template.apply({type:this.model.get("type",""),label:this.getHintLabel()}));3===d.currentInterface?$(_DATA.popup_container).find("#content-manage-container").append(this.element):$(_DATA.popup_container).append(this.element);this.hasSectionSettings()&&(this.getContainer("sectionSettingsContainer").html(this.sectionSettingsTemplate.apply({})),
this.element.find('.section_type input[value="'+this.model.get("type")+'"]').prop("checked",!0),this.element.on("change",".section_type input",this.onChangeSectionType.bind(this)));this.renderSections();this.checkContentErrors();b=$("#toa-wysiwyg").innerHeight();var c=this.element.find(".settingsTitle").outerHeight();this.getContainer().css({"max-height":b-c-20});this.isFooterButton()&&(this.getContainer().find(".translationsSection")[0].style.display="none",b=this.element.offset().top+50,this.element.css({top:b+
"px"}),b=this.element.height()-25,this.element.find(".rightArrow").css({top:b+"px"}));this.initEvent();if(this.model.isSpecialElement()&&!this.model.isButton()&&0<this.model.getName().length)this.translations.onExpandSection();this.resetPosition();return this},renderSections:function(){this.hasHiddenSettings()&&this.renderHiddenSettings();this.hasButtonSettings()&&this.renderButtonSettings();this.hasGeneralSection()&&this.renderGeneralSection();this.hasVisibilitySection()&&this.renderVisibilitySection();
this.hasValuesSection()&&this.renderValueVisibilitySection();this.hasParametersSection()&&this.renderParametersSection();this.hasTranslationsSection()&&this.renderTranslationsSection();this.hasEvaluationSection()&&this.renderEvaluationSection()},hasSectionSettings:function(){var b=d.CompanySettings.VisualFormEditor.classes.factory.getFormContext(),c=d.CompanySettings.VisualFormEditor.classes.factory.isSectionTypeChangeable();return!b&&this.isSection()&&c},hasHiddenSettings:function(){return this.isHiddenValue()},
hasButtonSettings:function(){return this.isButton()&&!1===this.model.isFooterButton()},hasGeneralSection:function(){return this.isField()&&!this.isHiddenValue()},hasVisibilitySection:function(){return!this.isHiddenValue()},hasValuesSection:function(){return this.isHiddenValue()?!1:this.hasLookups()&&this.model.isEnumeration()&&this.model.supportsValueVisibility()?!0:this.isFormElement()&&this.model.isEnumeration()},hasEvaluationSection:function(){return this.isField()&&!this.isHiddenValue()&&this.model.isEvaluationAllowed()},
hasParametersSection:function(){return this.isButton()&&this.model.isButtonBound()&&"bt_change_password"!==this.model.get("label","")},hasTranslationsSection:function(){return!this.isHiddenValue()},initHiddenSettings:function(){this.hiddenSettings=new d.CompanySettings.VisualFormEditor.views.itemSetting.HiddenSettings(this.model);this.updateHiddenUID=this.addBeforeUpdateListener("hiddenSettings");this.addResetPositionListener("hiddenSettings");this.hiddenSettings.addListener("changeLabel",this.updateItemLabel.bind(this))},
initButtonSettings:function(){this.buttonSettings=new d.CompanySettings.VisualFormEditor.views.itemSetting.ButtonSettings(this.model);this.addResetPositionListener("buttonSettings");this.buttonSettings.addListener("changeLabel",this.updateItemLabel.bind(this));this.buttonSettings.addListener("rerenderParameters",this.onRerenderParameters.bind(this));this.buttonSettings.addListener("showModifyFormContent",this.onShowModifyFormContent.bind(this));this.buttonSettings.addListener("rerenderTranslation",
this.onRerenderTranslations.bind(this));this.buttonSettings.addListener("vfe-item-before-update",function(){this.onBeforeChangeModel()}.bind(this))},initGeneral:function(){this.general=new d.CompanySettings.VisualFormEditor.views.itemSetting.General(this.model);this.general.setGuiTypesList(d.CompanySettings.VisualFormEditor.classes.factory.getSidebarItemsCollection());this.updateGeneralUID=this.addBeforeUpdateListener("general");this.addResetPositionListener("general");this.general.addListener("changeLabel",
this.updateItemLabel.bind(this));this.general.addListener("showValueVisibility",this.onShowValueVisibility.bind(this));this.general.addListener("showEvaluation",this.onShowEvaluationSection.bind(this));this.general.addListener("rerenderTranslation",this.onRerenderTranslations.bind(this));this.general.addListener("vfe-update-enum-values",this.onRerenderConditions.bind(this))},initVisibility:function(){this.visibility=new d.CompanySettings.VisualFormEditor.views.itemSetting.Visibility(this.model);this.updateVisibilityUID=
this.addBeforeUpdateListener("visibility");this.addResetPositionListener("visibility")},initVisibilityValue:function(){this.visibilityValue=new d.CompanySettings.VisualFormEditor.views.itemSetting.VisibilityValue(this.model);this.updateVisValUID=this.addBeforeUpdateListener("visibilityValue");this.addResetPositionListener("visibilityValue")},initTranslations:function(){this.translations=new d.CompanySettings.VisualFormEditor.views.itemSetting.Translations(this.model);this.updateTranslationsUID=this.addBeforeUpdateListener("translations");
this.addResetPositionListener("translations")},initParameters:function(){this.updateParametersUID&&this.parameters&&this.parameters.removeListener(this.updateParametersUID);this.parameters&&(this.parameters.destroy(),this.parameters=null);if(!this.model.isPlugin()||this.model.isAddon())this.parameters=this.model.isAddon()?new d.CompanySettings.VisualFormEditor.views.itemSetting.PluginParameters(this.model):new d.CompanySettings.VisualFormEditor.views.itemSetting.Parameters(this.model),this.updateParametersUID=
this.addBeforeUpdateListener("parameters"),this.addResetPositionListener("parameters")},initEvaluation:function(){this.evaluation=new d.CompanySettings.VisualFormEditor.views.itemSetting.Evaluation(this.model);this.updateEvaluationUID=this.addBeforeUpdateListener("evaluation");this.addResetPositionListener("evaluation")},renderSection:function(b){!this[b]||!this[b]instanceof d.CompanySettings.VisualFormEditor.views.BaseView||(this[b].render(),this.getContainer(b+"SectionContainer").html(this[b].getElement()))},
destroySection:function(b){this[b]&&(this[b].destroy(),this[b]=null)},addResetPositionListener:function(b){return this[b].addListener("vfe-reset-position",this.resetPosition.bind(this))},addBeforeUpdateListener:function(b){return this[b].addListener("vfe-item-before-update",this.onBeforeChangeModel.bind(this))},renderHiddenSettings:function(){this.hiddenSettings||this.initHiddenSettings();this.renderSection("hiddenSettings")},renderButtonSettings:function(){this.buttonSettings||this.initButtonSettings();
this.element.find(".titleAction.openForm").hide();"function"===typeof this.model.isForm&&this.model.isForm()&&!1!==this.model.getAssignedForm()&&this.element.find(".titleAction.openForm").show();this.renderSection("buttonSettings")},renderGeneralSection:function(){this.general||this.initGeneral();this.renderSection("general")},renderVisibilitySection:function(){this.visibility||this.initVisibility();this.renderSection("visibility")},renderEvaluationSection:function(){this.evaluation||this.initEvaluation();
this.evaluation.render();this._isOneLanguage()?this.evaluation.getElement().insertBefore(this.visibility.getElement()):this.evaluation.getElement().insertAfter(this.translations.getElement())},renderValueVisibilitySection:function(){this.visibilityValue||this.initVisibilityValue();this.visibilityValue.render();this.visibilityValue.getElement().insertAfter(this.visibility.getElement())},renderParametersSection:function(){this.parameters||this.initParameters();this.renderSection("parameters")},renderTranslationsSection:function(){this.translations||
this.initTranslations();this.renderSection("translations");this._isOneLanguage()&&this.translations.hideSectionTitle()},destroyValueVisibilitySection:function(){this.visibilityValue&&this.visibilityValue.destroy()},destroyEvaluationSection:function(){this.evaluation&&this.evaluation.destroy()},checkContentErrors:function(){if(this.model.hasValidationErrors()){var b=d.CompanySettings.VisualFormEditor.classes.factory.getErrorCollection();$.each(this.model.get("errors",[]),function(c,d){var k=b.getByUid(d);
if(k){var l=k.get("error_type");this.isButton()&&-1!==$.inArray(l,["no_form_link"])&&this.element.find(".item-wrapper.formName").find(".fieldValue").append($(this.errorTemplate.apply({error_text:k.get("error_text")})))}}.bind(this))}},isLabeledItem:function(){return-1!==$.inArray(this.model.get("type",""),["property","field","form_element","form"])},getHintLabel:function(){var b=this.model.get("label",""),c=this.model.get("action_link_label",""),d=this.model.get("base_label",""),k=this.model.get("is_plugin",
!1);if(this.isLabeledItem()&&b&&""!==b)return b;switch(this.model.get("type")){case "section":b=h(15014);break;case "tab":case "predefined_tab":b=h(15015);break;case "text":b=h(21066);break;case "button":b=h(21067);break;case "action":k||(b=""!==c?c:d&&""!==d&&null!=d?d:h(21068));break;case "property":b=h(21069);break;case "field":b=h(21070);break;case "form_element":b=h(22601);break;case "form":b=h(22610);break;default:b=""}return b},isButton:function(){return this.model instanceof d.CompanySettings.VisualFormEditor.models.Button},
isEntityField:function(){return this.isField()&&(this.model.isField()||this.model.isProperty())},isFormElement:function(){return this.isField()&&this.model.isLocal()},isField:function(){return this.model instanceof d.CompanySettings.VisualFormEditor.models.Field},isText:function(){return this.model instanceof d.CompanySettings.VisualFormEditor.models.Text},isHiddenValue:function(){return this.isFormElement()&&this.model.isHidden()},isSection:function(){return this.model instanceof d.CompanySettings.VisualFormEditor.models.Section},
isFooterButton:function(){return this.model instanceof d.CompanySettings.VisualFormEditor.models.Button&&this.model.isFooterButton()},isTranslationsSectionShow:function(){return 1!=d.CompanySettings.VisualFormEditor.classes.factory.getLanguagesCollection().getCount()},getHeaderHeight:function(){var b=$(".header-wrapper");return 0===b.length?$("#header").outerHeight():b.outerHeight()},setPositionElement:function(b){var c=this.getHeaderHeight(),g=$("#header").outerHeight()+$(".toa-panel-title.wysiwyg-panel").outerHeight();
3===d.currentInterface&&(g=$(".toa-panel-title.wysiwyg-panel").outerHeight());b.point.top<g?b.point.top=g:3===d.currentInterface&&"undefined"!==typeof b.point.top&&(b.point.top-=c);this.element.css(b.point);this.setPointer(b)},getPositionElement:function(){return this.fliper.getOptimalPosition()},resetPosition:function(){var b=this.getPositionElement();this.setPositionElement(b)},setPointer:function(b){var c=this.element.find(".popupPointer");if(!1===b)c.hide();else{var g={},k=0,k={left:"right",right:"left"}[b.position.appear],
l=this.fliper._getRectAnchor(),n=0,n=this.getHeaderHeight();g[k]="-8px";c.removeClass("leftArrow").removeClass("rightArrow").addClass(k+"Arrow");k=this.isSection()?8:this.isFooterButton()||this.isButton()?6:14;n=3===d.currentInterface?l.top-n<b.point.top?0:l.top-n-b.point.top:l.top<b.point.top?0:l.top-b.point.top;g.top=n+k+"px";c.css(g);c.show()}},hasLookups:function(){var b=d.CompanySettings.VisualFormEditor.classes.factory.getAvailableFieldCollection().get(this.model.get("property_id",this.model.get("field")));
return b&&b.get("lookups")},initFliper:function(){this.fliper=new d.Fliper({getRectAnchor:this._getRectAnchor.bind(this),getRectElement:this._getRectElement.bind(this),mapPosition:this.mapPosition})},getContainer:function(b){return this.element.find(".settingsContent"+(void 0!==b?" ."+b:""))},initEvent:function(){c.prototype.initEvent.apply(this);this.mouseDownId=Math.floor(1E5*Math.random());$(this.popupContainer).on("mousedown.vfe."+this.mouseDownId,this.onMouseDown.bind(this));this.scrollId=Math.floor(1E5*
Math.random());$("#toa-wysiwyg .wysiwyg-content").on("scroll.vfe."+this.scrollId,this.destroy.bind(this));this.element.find(".titleAction.remove").on("click",this.onRemoveClick.bind(this));this.element.find(".titleAction.openForm").on("click",this.checkSaveButton.bind(this))},updateItemLabel:function(){this.element.find(".titleText.label").text(this.getHintLabel())},onBeforeChangeModel:function(){this.isBeforeChanged||d.CompanySettings.VisualFormEditor.classes.factory.getUndoManager().addStep({debug:"SettingsPopup:onBeforeChangeModel"});
this.isBeforeChanged=!0},onChangeSectionType:function(b){b=$(b.currentTarget);this.onBeforeChangeModel();this.model.set({type:b.val()});this.updateItemLabel()},onShowValueVisibility:function(b,c){this.destroyValueVisibilitySection();c&&this.renderValueVisibilitySection()},onRerenderParameters:function(){this.initParameters();this.renderParametersSection()},onShowModifyFormContent:function(b,c){c?this.element.find(".titleAction.openForm").show():this.element.find(".titleAction.openForm").hide()},onShowEvaluationSection:function(b,
c){this.destroyEvaluationSection();c&&this.renderEvaluationSection()},onRerenderTranslations:function(){this.translations.rerender()},onRerenderConditions:function(){this.visibility.reRender();this.visibilityValue.reRender()},onRemoveClick:function(){var b=new d.ui.Popup({title:h(13294),autoOpen:!0,html:h(21057),modal:!0,buttons:[{text:h(14621),position:"left",click:function(){b.destroy()}},{text:h(12252),type:"submit",position:"right",click:function(){d.CompanySettings.VisualFormEditor.classes.factory.getUndoManager().addStep({debug:"SettingsPopup:onRemoveClick"});
this.model.remove();b.destroy()}.bind(this)}]})},checkSaveButton:function(){$(".buttonSave").hasClass("toa-button-disable")?this.triggerUndo():this.showChangeConfirmation()},triggerUndo:function(){$(".buttonUndo").trigger("click",{isForm:!0,label:this.model.get("label")});this.destroy()},showChangeConfirmation:function(){var b=h(14603),c=h(19153),d=this,k=[{text:h(22645),position:"left",click:function(b){b.reject()}},{text:h(13246),position:"right",type:"submit",click:function(b){$(".buttonSave").trigger("click",
{isForm:!0,label:d.model.get("label")});b.reject();d.destroy()}}];return this.showPopup(b,c,k)},showPopup:function(b,c,g){b=b||"";c=c||"";var k=$.Deferred();g&&$.isArray(g)&&g.length?$.each(g,function(b,c){if("function"===typeof c.click){var d=c.click;c.click=function(){var b=Array.prototype.slice.call(arguments);b.unshift(k);d.apply(this,b)}}}.bind(this)):g=[{text:h(445),position:"right",tpl:'<button class="popup-button toa-button"></button>',click:function(){k.reject()}}];k.always(function(){l.destroy()});
var l=new d.ui.Popup({title:b,autoOpen:!0,html:c,modal:!0,onClose:function(){l.destroy();k.reject()},buttons:g});l._dom.base.id="toa-openform-popup";return k},onMouseDown:function(b){$(b.target).closest(this.element).length||this.destroy()},destroy:function(b){$(this.popupContainer).off("mousedown.vfe."+this.mouseDownId);$("#toa-wysiwyg .wysiwyg-content").off("scroll.vfe."+this.scrollId);b&&"boolean"===typeof b&&(this.fliper&&this.fliper.destroy(),this.fliper=null);this.updateVisibilityUID&&this.visibility&&
this.visibility.removeListener(this.updateVisibilityUID);this.updateVisValUID&&this.visibilityValue&&this.visibilityValue.removeListener(this.updateVisValUID);this.updateTranslationsUID&&this.translations&&this.translations.removeListener(this.updateTranslationsUID);this.updateEvaluationUID&&this.evaluation&&this.evaluation.removeListener(this.updateEvaluationUID);this.updateParametersUID&&this.parameters&&this.parameters.removeListener(this.updateParametersUID);this.updateGeneralUID&&this.general&&
this.general.removeListener(this.updateGeneralUID);this.updateHiddenUID&&this.hiddenSettings&&this.hiddenSettings.removeListener(this.updateHiddenUID);this.destroySection("hiddenSettings");this.destroySection("buttonSettings");this.destroySection("general");this.destroySection("visibility");this.destroySection("visibilityValue");this.destroySection("evaluation");this.destroySection("parameters");this.destroySection("translations");this.element&&(this.element.off("change",".section_type input"),this.element.off("change",
"select.formSelect"),this.element.off("change","select.screenType"),this.element.off("change","select.screenSelect"));this.notify("itemaction:unselect",this);c.prototype.destroy.apply(this,[b])},_getRectAnchor:function(){var b={};this.anchor&&(b={width:this.anchor.outerWidth(),height:this.anchor.outerHeight(),top:this.anchor.offset().top,left:this.anchor.offset().left});return b},_getRectElement:function(){var b={};this.element&&(b={width:this.element.outerWidth(),height:this.element.outerHeight(),
top:this.element.offset().top,left:this.element.offset().left});return b}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.SidebarSection",d.define(c,function(){c.apply(this,arguments)},{filter:"",isCollapsed:!1,template:new d.Template('<div class="sidebarSection" id="section_<%- sectionId %>" role="tab">;<div class="sectionBox">;<span class="arrow-icon"></span>;<label class="search-icon" for="searchControl" aria-label="<%- h(7746) %>" role="button" tabindex="0"></label>;<input id="searchControl_<%- sectionId %>" class="searchControl" tabindex="0" name="search" type="radio" />;<input class="search-text" name="searchText" type="text" />;<label class="sectionBoxName">;<%- sectionName %>;</label>;</div>;<div class="list"></div>;</div>'.split(";")),
render:function(){this.element=$(this.template.apply(this.getTemplateData()));this.container=this.element.find(".list");this.collapseControl=this.element.find(".sectionBox");this.initEvent()},initEvent:function(){this.loadUID=this.model.addListener("load",this.onUpdate.bind(this));this.element.find(".search-text").on("keydown",function(b){b.stopPropagation()});this.element.find(".search-text").on("input",d.utils.func.debounce(this.onSetFilter.bind(this),100));this.element.find(".search-icon").on("click",
this.onClickSearch.bind(this));this.element.find(".search-text").on("blur",this.onInputBlur.bind(this));this.element.find(".arrow-icon").on("click",this.onClickPanel.bind(this))},getSectionId:function(){throw Error("getSectionId should be implemented in child");},getContainer:function(){return this.container},onUpdate:function(){this.getContainer().empty();this.model.each(this.filterItem.bind(this))},filterItem:function(b){var c=b.get("defaultName",""),d=RegExp(this.filter,"i");(""===this.filter||
-1<c.search(d))&&this.renderItem(b)},renderItem:function(b){b=new this.itemView(b);b.render();this.getContainer().append(b.getElement())},destroy:function(){this.model.removeListener(this.loadUID);c.prototype.destroy.apply(this)},onSetFilter:function(b){this.filter=$(b.currentTarget).val();this.onUpdate()},onClickSearch:function(){var b=this.element.find(".search-text");b.show();b.focus();this.element.find(".sectionBoxName").hide()},onInputBlur:function(b){""===$(b.currentTarget).val()&&(this.element.find(".search-text").hide(),
this.element.find(".sectionBoxName").show())},onClickPanel:function(){this.notify("sidebarSectionSelected",this.getSectionId())},toggleSection:function(){this.isCollapsed?this.slideUpSection():this.slideDownSection()},slideUpSection:function(){this.container.slideUp(0);this.resetFilter();this.hideSearch();this.isCollapsed=!1;this.collapseControl.removeClass("collapsed")},resetFilter:function(){this.filter&&this.filter.length&&(this.filter="",this.element.find(".search-text").val(this.filter),this.onUpdate())},
slideDownSection:function(){this.container.slideDown(0);this.showSearch();this.isCollapsed=!0;this.collapseControl.addClass("collapsed")},hideSearch:function(){this.element.find(".search-icon").hide();this.hideSearchInput();this.isCollapsed=!0},showSearch:function(){this.element.find(".search-icon").show()},hideSearchInput:function(){this.element.find(".search-text").hide();this.element.find(".sectionBoxName").show()},getTemplateData:function(){return{sectionName:"",sectionId:""}}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.SidebarControlItem",d.define(c,function(b){c.apply(this,arguments)},{template:new d.Template(['<div  data-type="<%- type %>" class="wysiwygDrag itemControl" tabindex="0" role="link" aria-grabbed="true">','<div class="add_control"></div>',"<span class=\"icons icon_<%-gui%><% if(gui == 'text'){ %>_elem<% } %>\"></span>",'<div class="controlName"><%- name %></div>',"</div>"]),render:function(){this.element=
$(this.template.apply(this.getTemplateData()));this.initDraggable();return this},getTemplateData:function(){return{type:this.model.get("type"),gui:this.model.get("gui",this.model.get("type")),name:this.model.get("defaultName",this.model.getName())}},destroy:function(){c.prototype.destroy.apply(this)},initDraggable:function(){this.getElement().draggable({addClasses:!1,helper:"clone",scroll:!0,refreshPositions:!0,cursorAt:{top:-5,left:-5},start:this.onDragStart.bind(this),stop:this.onDragStop.bind(this),
drag:this.onDrag.bind(this)})},onDragStart:function(b,c){var g=this.model.clone(!0);g instanceof d.CompanySettings.VisualFormEditor.models.Field&&g.set({isNewElement:!0},{silent:!0});d.CompanySettings.VisualFormEditor.classes.factory.dnd().dragStart(g,c)}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.SidebarSection;d.ns("toa.CompanySettings.VisualFormEditor.views.SidebarControls",d.define(c,function(){c.apply(this,arguments)},{itemView:d.CompanySettings.VisualFormEditor.views.SidebarControlItem,filter:"",getSectionId:function(){return"controls"},getTemplateData:function(){return{sectionName:h(22652),sectionId:"newElement"}}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.SidebarControls;d.ns("toa.CompanySettings.VisualFormEditor.views.ConfiguredItem",d.define(c,function(){this.emptyName=null;c.apply(this,arguments)},{template:new d.Template('<div data-id="<%-id%>" data-type="field" class="wysiwygDrag itemControl configuredItem">;<div class="add_control"></div>;<span class="icons icon_<%-gui%>"></span>;<div class="info_desc<% if (amount > 1) { %>_small<% } %>">;<div class="name"><%-name%></div>;<div class="label"><%-label%></div>;</div>;<% if (amount > 1) { %><div class="wrapper_counter"><div class="info_counter"><span class="counter"><%-item_number%></span> / <%-amount%></div></div><% } %>'.split(";")),
render:function(){this.emptyName="["+h(22602)+"]";this.element=$(this.template.apply(this.getTemplateData()));this.element.on("click",function(b){$(".itemControl").removeClass("active");$(b.target).closest(".configuredItem").addClass("active");b=$(b.target).closest(".configuredItem").attr("data-id");var c=document.querySelector(".wysiwyg-layout div[data-id='"+b+"']");if(c){$(c).parents().each(function(b,c){$(c).hasClass("section")&&$(c).removeClass("collapsed")});c.scrollIntoView();var d=window.setTimeout(function(){c.classList.add("overlayItem");
window.clearTimeout(d);d=null},200)}});return this},getTemplateData:function(){var b=this.model.getName();return{type:this.model.get("type"),name:b||this.emptyName,id:this.model.get("item_id"),label:this.model.get("label"),gui:this.model.get("gui"),item_number:this.model.get("item_number"),amount:this.model.get("amount")}},destroy:function(){c.prototype.destroy.apply(this)}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.SidebarSection;d.ns("toa.CompanySettings.VisualFormEditor.views.ConfiguredItems",d.define(c,function(){c.apply(this,arguments)},{itemView:d.CompanySettings.VisualFormEditor.views.ConfiguredItem,sectionClass:"sidebar-fields",sectionSearch:"searchField",isAllContextItems:null,getSectionId:function(){return"configuredItems"},filterItem:function(b){var c=b.get("label",""),d=b.getName()||"",k=RegExp(this.filter,"i");(""===this.filter||-1<(-1<
c.search(k)||d.search(k)))&&this.renderItem(b)},getSectionName:function(){return h(18193)},showAllContextItems:function(b){this.isAllContextItems=b},isFieldAllowed:function(b){return this.isAllContextItems||b.get("allowed",0)},getTemplateData:function(){return{sectionName:this.getSectionName(),sectionId:this.getSectionId()}}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.SidebarControls;d.ns("toa.CompanySettings.VisualFormEditor.views.AvailableField",d.define(c,function(){c.apply(this,arguments)},{template:new d.Template('<div data-id="<%-id%>" data-type="field" class="wysiwygDrag itemControl" tabindex="0" role="link" aria-grabbed="true">;<div class="add_control"></div>;<span class="icons icon_<%-gui%>"></span>;<div class="name"><%-name%></div>;<div class="label"><%-label%></div>;</div>'.split(";")),render:function(){this.element=
$(this.template.apply(this.getTemplateData()));this.initDraggable();return this},getTemplateData:function(){return{type:this.model.get("type"),gui:this.model.get("gui",this.model.get("type")),name:this.model.get("defaultName",this.model.getName()),id:this.model.getId(),label:this.model.get("label"),property_id:this.model.get("property_id"),entity:this.model.get("entity")}},destroy:function(){c.prototype.destroy.apply(this)},initDraggable:function(){this.getElement().draggable({addClasses:!1,helper:"clone",
scroll:!0,refreshPositions:!0,cursorAt:{top:-5,left:-5},start:this.onDragStart.bind(this),stop:this.onDragStop.bind(this),drag:this.onDrag.bind(this)})},onDragStart:function(b,c){var g=this.model.attributes;delete g[this.model.idField];g=new d.CompanySettings.VisualFormEditor.models.Field(g);g.set({isNewElement:!0},{silent:!0});g.setTranslations(this.model.get("names"));g.setValidationMessages();d.CompanySettings.VisualFormEditor.classes.factory.dnd().dragStart(g,c)}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.views.SidebarSection;d.ns("toa.CompanySettings.VisualFormEditor.views.AvailableFields",d.define(c,function(){c.apply(this,arguments)},{itemView:d.CompanySettings.VisualFormEditor.views.AvailableField,sectionClass:"sidebar-fields",sectionSearch:"searchField",isAllContextItems:null,getSectionId:function(){return"fields"},filterItem:function(b){if(b.isAllowed()&&!(b.get("entity",null)>=d.CompanySettings.VisualFormEditor.classes.factory.localFieldEntity)){var c=
b.get("label",""),g=b.getName()||"",k=RegExp(this.filter,"i");(""===this.filter||-1<(-1<c.search(k)||g.search(k)))&&this.renderItem(b)}},getSectionName:function(){return h(18198)},showAllContextItems:function(b){this.isAllContextItems=b},isFieldAllowed:function(b){return this.isAllContextItems||b.get("allowed",0)},getTemplateData:function(){return{sectionName:this.getSectionName(),sectionId:this.getSectionId()}}}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.VisualFormEditor.views.ValidationErrorItem",d.define(c,function(){c.apply(this,arguments)},{template:'<div class="errorItem"><div class="errorInfo"><div class="itemType"><% if ("cyclic_dependency" === error_type) { %><%= h(19016/*Warning!*/)%><% } else if ("section" === item_type || "tab" === item_type) { %><%= h(21095/*Section element*/) %><% } else if ("text" === item_type) { %><%= h(21096/*Text element*/) %><% } else if ("button" === item_type) { %><%= h(21067/*Button*/) %><% } else if ("form" === item_type) { %><%= h(22610/*New button*/) %><% } else { %><%= h(21094/*Label:*/) %> <%- item_label %><% } %></div><div class="description"><%- error_desc %></div></div><div class="errorText"><%- error_text %><% if (fields_in_cycle) { %><div class="fields-in-cycle"><table><% fields_in_cycle.forEach(function (item) { %><tr><td><%- item[0] %></td><td></td><td><%- item[1] %></td></tr><% }) %></table></div><% } %></div></div>',
getData:function(){var b={cyclic_dependency:h(19017),wrong_content:h(19019),default_expression:h(21097),validation_expression:h(21098),visibility_expression:h(21099),value_expression:h(21100),visibility_condition:h(22647),value_condition:h(22648),no_form_link:h(19019)},c=this.model&&this.model.toJSON()||{};c.error_type=this.model.get("error_type");c.error_desc=b[this.model.get("error_type")];c.item_label=this._formatLabel(this.model);c.fields_in_cycle=this._formatFieldsInCycle(this.model);return c},
_formatLabel:function(b){return(b.get("data",null)||{}).fieldLabel||""||b.get("item_label",null)||""},_formatFieldsInCycle:function(b){b=(b.get("data",null)||{}).fields_in_cycle||[];for(var c=[],d=0,k=b.length;d<k;d++)c.push([b[d],b[d+1<k?d+1:0]]);return c}}))})(toa);(function(d){var c=d.views.BaseCollectionView;d.ns("toa.CompanySettings.VisualFormEditor.views.ValidationResult",d.define(c,function(){c.apply(this,arguments);this.noItemsView=null;this.collection=this.collection.filter(function(b){return!Boolean(b.get("hide_in_list"))})},{events:{"click .label":"expandSection"},template:'<div class="vfe_validation_popup"><div class="validationResultInfo"><div class="validationResultRow"><div class="validationResultTitle"><%= h(21090/*Expressions validated:*/) %></div><div class="validationResultValue totalCount"></div></div><div class="validationResultRow"><div class="validationResultTitle"><%= h(21091/*Successfully:*/) %></div><div class="validationResultValue successCount"></div></div><div class="validationResultRow errorsRow"><div class="validationResultTitle"><%= h(21092/*Found errors:*/) %></div><div class="validationResultValue errorCount"></div></div></div><div class="validationDetailsContainer section hidden"><div class="sectionTitle"><div class="title"><div class="label" role="button" tabindex="0"><span class="labelText"><%= h(21093/*Details*/) %></span></div></div></div><div class="errorsListContainer sectionContent"></div></div></div>',
childView:d.CompanySettings.VisualFormEditor.views.ValidationErrorItem,childRegion:".errorsListContainer",render:function(b,d){c.prototype.render.apply(this,arguments);this.setValidationResult();return this},setValidationResult:function(){this.getElement().find(".totalCount").text(this.options.totalCount);this.getElement().find(".successCount").text(this.options.successCount);this.getElement().find(".errorCount").text(this.collection.getCount());this.collection.getCount()&&(this.getElement().find(".errorsRow").addClass("error"),
this.getContainer().find(".validationDetailsContainer").removeClass("hidden"))},expandSection:function(b){}}))})(toa);(function(d){d.ns("toa.CompanySettings.VisualFormEditor.controllers.BaseEditorController",d.define(d.Controller,function(c){_DATA.ulanguage=d.app.model("companySettings").getUser().ulanguage||1;this.sandbox=c;this.screen=c.options.content;this.triggerFunction=c.trigger.bind(c);this.params={};this.setParams(c.options);this.readOnlyMode=!!this.params.isReadOnlyMode;this.isClicked=0;this.initModels();this.resume(c.options)},{_serverController:"",_serverGetMethod:"",_serverSetMethod:"",_serverValidateMethod:"",
_responseLayoutStructureField:"",factory:d.CompanySettings.VisualFormEditor.classes.factory,panelTitleButtonsList:[],loaderIndicatorId:"forms-loading-indicator",loaderIndicatorTextId:"form-loader-text",toString:function(){return"Visual form editor screen controller"},initModels:function(){this.collectionSidebarItems=this.factory.getSidebarItemsCollection();this.layoutStructure=this.factory.getLayoutStructure();this.collectionConfiguredItems=this.factory.getConfiguredItemsCollection();this.collectionConfiguredItems.addListener("load",
function(){this.factory.getFormElementService().tryTosetDictionaryDataToFields()}.bind(this));this.collectionAvailableFields=this.factory.getAvailableFieldCollection();this.collectionAvailableFields.addListener("load",function(){this.factory.getFormElementService().tryTosetDictionaryDataToFields()}.bind(this));this.collectionLanguages=this.factory.getLanguagesCollection();this.collectionUserTypes=d.create("toa.models.userTypes.SortableCollection");this.dictionary=this.factory.getDictionary();this.expressionManager=
this.factory.getExpressionManager();this.undoManager=this.factory.getUndoManager();this.validationErrors=this.factory.getErrorCollection();this.mainLayoutItems=this.factory.getMainLayoutItemsCollection();this.undoManager.addCollection("layoutItems",this.mainLayoutItems);this.footerButtons=new d.CompanySettings.VisualFormEditor.models.collection.structure.FooterButtons;this.undoManager.addCollection("footerButtons",this.footerButtons);this.sectionCollapseManager=this.factory.getSectionCollapseManager()},
initViews:function(){this.layout=new d.CompanySettings.VisualFormEditor.views.Layout;this.sidebar=new d.CompanySettings.VisualFormEditor.views.Sidebar;this.sidebarControls=new d.CompanySettings.VisualFormEditor.views.SidebarControls(this.collectionSidebarItems);this.sidebarFields=new d.CompanySettings.VisualFormEditor.views.AvailableFields(this.collectionAvailableFields);this.sidebarConfiguredItems=new d.CompanySettings.VisualFormEditor.views.ConfiguredItems(this.collectionConfiguredItems);this.mainLayout=
new d.CompanySettings.VisualFormEditor.views.MainLayout(this.mainLayoutItems);this.footer=new d.CompanySettings.VisualFormEditor.views.Footer(this.footerButtons)},showInitialViews:function(){this.layout.render();this.layout.getElement().addClass("wysiwyg-hidden");this.mainLayout.render();this.footer.render();this.screen.append(this.layout.getElement());this.layout.getElement().find(".wysiwyg-layout").prepend(this.mainLayout.getElement());this.layout.getElement().find(".wysiwyg-footer").append(this.footer.getElement());
this.sidebar.render();this.sidebarControls.render();this.sidebarFields.render();this.sidebarConfiguredItems.render();this.layout.getElement().find(".sidebar").append(this.sidebar.getElement());this.sidebar.appendChild(this.sidebarControls);this.sidebar.appendChild(this.sidebarFields);this.sidebar.appendChild(this.sidebarConfiguredItems);this.sidebar.collapseSection(this.sidebarControls.getSectionId());this.updateLayoutHeight();"undefined"!==typeof this.params.select&&"undefined"!==typeof this.params.select.context_layout_item_id&&
(this.loadedListener=this.mainLayout.addListener("loaded",this.scrollToAndHighlightButton.bind(this)))},scrollToAndHighlightButton:function(){this.mainLayout.removeListener(this.loadedListener);var c=$('button[data-id="'+this.params.select.context_layout_item_id+'"]');c.length&&$("div.wysiwyg-content").delay(300).animate({scrollTop:c.offset().top-160},600,"swing",function(){c.delay(300).addClass("overlayItem").delay(200).fadeTo(200,0.4).delay(100).fadeTo(200,1).fadeTo(200,0.4).delay(100).fadeTo(200,
1)})},isFormLayout:function(){return!1},isContextLayout:function(){return!1},baseRequestParams:function(){return{}},sendRequest:function(c){this.triggerFunction("global.data.get",c)},initEvents:function(){this.initUndoEvents();this.resizeUid=d.app.reflowManager.addListener("resize",this.updateLayoutHeight.bind(this))},initUndoEvents:function(){this.undoStepUid=this.undoManager.addListener("undoStep",function(){this.undoButton.addClass("toa-button-disable");this.checkAbilitySave()}.bind(this));this.addUid=
this.undoManager.addListener("add",function(){window.MSInputMethodContext&&document.documentMode&&"input"===event.type||(this.undoButton.removeClass("toa-button-disable"),this.checkAbilitySave())}.bind(this));this.removeAllUid=this.undoManager.addListener("removeAll",function(){this.undoButton.addClass("toa-button-disable");this.checkAbilitySave()}.bind(this))},updateLayoutHeight:function(c){if(this.layout){var b=this.layout.getElement().find(".wysiwyg-content").height()||0,d=this.layout.getElement().find(".wysiwyg-action-content").outerHeight()||
0,g=this.layout.getElement().find(".wysiwyg-footer").outerHeight()||0,b=b-d-g;this.layout.getElement().find(".wysiwyg-layout").css({"min-height":b+"px"});c&&"resize"===c&&this.mainLayout.resizeFirstColumn()}},resume:function(c){this.triggerFunction("layout.tabs.set",{tabs:0,show:0});this.factory.setFormContext(this.isFormLayout());this.setParams(c);this.createPanelTitle();this.sectionCollapseManager.clearCollapsed();this.initViews();this.showInitialViews();this.createLoader(h(226552));this.sendRequest({controller:this._serverController,
method:this._serverGetMethod,params:this.baseRequestParams(),responseHandler:this.loadData.bind(this),errorHandler:function(){this.removeLoader()}.bind(this)});this.initEvents();d.view.Header.setDisable()},setParams:function(c){$.isEmptyObject(c.params)||(this.params=c.params)},unique:function(c,b){var d=[],g=[],k;for(k in c){var l=c[k],n=l[b];-1<d.indexOf(n)||(d.push(n),g.push(l))}return g},loadData:function(c,b){this.setAccessMode(b);this.dictionary.set(b.dictionary);this.collectionAvailableFields.load(this.unique(b.fields,
"property_id"));this.collectionConfiguredItems.load(this.unique(b.configuredItems,"item_id"));this.factory.getFormElementService();this.factory.setAvailableEntities();this.loadStructure(b);this.collectionLanguages.load(b.languages);this.collectionSidebarItems.load(b.special);this.factory.setSectionTypeChangeable(this.collectionSidebarItems.isSectionTypeChangeable());this.layout.getElement().removeClass("wysiwyg-hidden");this.updatePanelTitle(b);this.expressionManager.initLookups(this.collectionAvailableFields);
this.initItemLabelsCollection(b);this.updateLoaderText(h(226551));try{this.validateStructure(function(b,c){this.setValidationErrors(c);this.validationErrors.notify("changed");this.isClicked=0;this.removeLoader()}.bind(this))}catch(d){console.log(d),this.removeLoader()}},loadStructure:function(c){this.mainLayoutItems.load(c[this._responseLayoutStructureField].items);this.footerButtons.load(this.setSubmitOptions(c[this._responseLayoutStructureField].buttons));c[this._responseLayoutStructureField].items=
this.mainLayoutItems;c[this._responseLayoutStructureField].buttons=this.footerButtons;this.mainLayoutItems.setParent(this.layoutStructure);this.footerButtons.setParent(this.layoutStructure);this.layoutStructure.load(c[this._responseLayoutStructureField])},setSubmitOptions:function(c){return c},setAccessMode:function(c){this.readOnlyMode="undefined"!==typeof c.allow_modify&&null!==c.allow_modify?!c.allow_modify:!1},initItemLabelsCollection:function(c){this.collectionItemLabels=this.factory.getItemLabels();
this.collectionItemLabels.clear();this.collectionItemLabels.formElementIndexes=[];!1!==!!(c&&c.itemLabels&&c.itemLabels.length)&&$.each(c.itemLabels,function(b,c){var d=c.match(/form_element#([1-9]{1,1}[0-9]{0,})$/i);d&&1<d.length&&this.collectionItemLabels.formElementIndexes.push(parseInt(d[1],10));this.collectionItemLabels.add({label:c})}.bind(this))},setValidationErrors:function(c){this.validationErrors.clear();var b=!!(c&&c.errors&&c.errors.length);b&&$.each(c.errors,function(b,c){this.validationErrors.add(c,
{silent:!0})}.bind(this));this.validateButton.getElement().toggleClass("button-icon-warning",b)},getLayoutName:function(){return""},getPanelTitleText:function(c){var b=[h(15001)];"undefined"!==typeof this.params.panelTitleText&&(b=[this.params.panelTitleText]);"undefined"!==typeof c.typeName&&null!==c.typeName&&b.push(d.toHtmlSafe(c.typeName));c=this.getLayoutName(c);b.push(d.toHtmlSafe(c));this.triggerFunction("layout.menu.changeTitle",{label:"company_settings",url:"",name:b.reverse().join(" - "),
params:{}});return b.reverse().join(" > ")},updatePanelTitle:function(c){c=this.getPanelTitleText(c);this.panel.setOption("titleText",c);this.readOnlyMode?(this.clearButton.element.hide(),this.saveButton.element.hide()):(this.clearButton.element.show(),this.saveButton.element.show(),this.checkAbilitySave());this.panelTitleButtonsContainer.show()},createPanelTitle:function(){this.panel=d.view.control.create({xtype:"PanelTitle",addClass:"jet-css-only toa-view-control-paneltitle toa-panel-title wysiwyg-panel",
name:"title",titleText:h(15001),resourceTreeButton:!1,backButton:!0,backButtonLabel:"",backButtonIcon:"icon-close",backButtonHint:h(15003),filter:!1,viewSelector:!0,calendar:!1,listeners:{backButtonClick:this.onClose.bind(this)}});this.panel.render(this.screen);this.renderPanelTitleButtons()},createClearButton:function(){this.clearButton=d.view.control.create({xtype:"Button",name:"clearButton",label:h(7717),layoutCellWidth:1,addClass:"buttonClear",listeners:{click:this.onClear.bind(this)}});this.panelTitleButtonsList.push(this.clearButton)},
createUndoButton:function(){this.undoButton=d.view.control.create({xtype:"Button",name:"undoButton",label:h(15004),layoutCellWidth:1,addClass:"buttonUndo toa-button-disable",listeners:{click:this.undo.bind(this)}});this.panelTitleButtonsList.push(this.undoButton)},createValidateButton:function(){this.validateButton=d.view.control.create({xtype:"Button",name:"validateButton",label:h(12099),layoutCellWidth:1,addClass:"buttonValidate",listeners:{click:this.validateStructure.bind(this)}});this.panelTitleButtonsList.push(this.validateButton)},
createSaveButton:function(){this.saveButton=d.view.control.create({xtype:"Button",name:"saveButton",label:h(15002),layoutCellWidth:1,addClass:"buttonSave toa-button-active",listeners:{click:this.onSaveStructureClick.bind(this)}});this.panelTitleButtonsList.push(this.saveButton)},createPanelTitleButtons:function(){this.createClearButton();this.createUndoButton();this.createValidateButton();this.createSaveButton()},renderPanelTitleButtons:function(){var c=this.panel.findChild("clone").element,b=this.panel.findChild("viewsPanel").element.empty();
this.panelTitleButtonsContainer=$('<span class="toa-button-panel" style="display: none;" />').appendTo(b);c.addClass("toa-close-button");this.panelTitleButtonsList=[];this.createPanelTitleButtons();$.each(this.panelTitleButtonsList,function(b,c){c.render(this.panelTitleButtonsContainer)}.bind(this));this.panelTitleButtonsList=[];this.checkAbilitySave()},undo:function(){this.undoManager.runUndo();this.checkAbilitySave()},validateStructure:function(c){if(0<this.isClicked)return!1;"function"!==typeof c&&
(c=this.onValidateResponseHandler);this.createLoader(h(226551));var b=this.layoutStructure.toJSON(),e=JSON.stringify(this.dictionary.getDictionaryConditions());this.sendRequest({controller:this._serverController,method:this._serverValidateMethod,params:{structure:d.utils.json.encode(b),dictionary:e},responseHandler:c.bind(this),errorHandler:function(){this.removeLoader()}.bind(this)});var g=this;g.isClicked=1;window.setTimeout(function(){g.isClicked=0},2E3)},onValidateResponseHandler:function(c,b){this.removeLoader();
this.setValidationErrors(b);this.validationErrors.notify("changed");this.showValidationPopup(b)},showValidationPopup:function(c){this.validationResultView&&this.validationResultView.destroy();this.validationResultView=new d.CompanySettings.VisualFormEditor.views.ValidationResult({collection:this.validationErrors,totalCount:c.totalCount,errorCount:c.errorCount,successCount:c.successCount});this.validationPopup=new d.ui.Popup({title:h(21089),autoOpen:!0,view:this.validationResultView,modal:!0,onClose:this.closeValidationPopup.bind(this),
buttons:[{id:"closeBtn",text:h(15003),type:"submit",position:"right",click:this.closeValidationPopup.bind(this)}]});$(this.validationPopup._dom.buttons.closeBtn).removeClass("toa-button-active")},closeValidationPopup:function(){this.isClicked=0;this.validationResultView.destroy();this.validationPopup.destroy()},onSaveStructureClick:function(){this.saveStructure()},saveStructure:function(){if(this.undoManager.hasChanges()){var c=this.layoutStructure.toJSON(),b=JSON.stringify(this.dictionary.getDictionaryConditions()),
c={structure:d.utils.json.encode(c),dictionary:b};$.extend(c,this.baseRequestParams());this.createLoader(h(226550));this.sendRequest({controller:this._serverController,method:this._serverSetMethod,params:c,responseHandler:this.saveStructureResponse.bind(this),errorHandler:function(){this.removeLoader()}.bind(this)})}},createLoader:function(c){var b=this;0===$("#"+this.loaderIndicatorId).length?require(["ojs/ojcore","knockout","ojs/ojbootstrap","jbf/components/visuals/inline-loading-indicator/inline-loading-indicator-view-model"],
function(d,g,k,l){d=document.createElement("visuals:inline-loading-indicator");d.className="loading-indicator";d.id=b.loaderIndicatorId;d.setAttribute("params","invertedColor: true, size: 'big'");$("#content-manage-container").prepend(d);var n=new l({});k.whenDocumentReady().then(function(){var d=document.getElementById(b.loaderIndicatorId);g.applyBindings(n,d);$(d).append('<div id="'+b.loaderIndicatorTextId+'"/>');c&&b.updateLoaderText(c)})}):c&&this.updateLoaderText(c)},updateLoaderText:function(c){$("#"+
this.loaderIndicatorTextId).text(c)},removeLoader:function(){$("#"+this.loaderIndicatorId).remove()},saveStructureResponse:function(c,b){if("undefined"===typeof b[this._responseLayoutStructureField])this.removeLoader();else{this.updateLoaderText(h(226552));try{this.sendRequest({controller:this._serverController,method:this._serverGetMethod,params:this.baseRequestParams(),responseHandler:function(b,c){this.clearCollections();this.loadData(b,c);this.checkAbilitySave()}.bind(this),errorHandler:function(){this.removeLoader()}.bind(this)})}catch(d){console.log(d),
this.removeLoader()}}},checkAbilitySave:function(){this.undoManager.hasChanges()?this.saveButton.removeClass("toa-button-disable").addClass("toa-button-active"):this.saveButton.removeClass("toa-button-active").addClass("toa-button-disable")},onClear:function(){d.ui.Confirm({text:this.getClearConfirmationText(),acceptButtonHandler:this.onClearHandler.bind(this),dismissButtonText:h(6266)})},onClearHandler:function(){this.factory.getUndoManager().addStep({debug:"BaseEditorController:onClear"});this.clearLayout()},
getClearConfirmationText:function(){return h(18180)},clearLayout:function(){this.mainLayoutItems.clear();this.factory.getFormElementService().clearCollectionFieldsFormElems();this.checkAbilitySave()},onClose:function(){this.params.onClose&&"function"===typeof this.params.onClose&&this.params.onClose.apply(this,arguments)},clearCollections:function(){this.collectionAvailableFields.clear();this.collectionConfiguredItems.clear();this.collectionSidebarItems.clear();this.mainLayoutItems.clear();this.collectionUserTypes.clear();
this.footerButtons.clear();this.collectionLanguages.clear();this.undoManager.clear()},suspend:function(){this.undoManager.removeListener(this.undoStepUid);this.undoManager.removeListener(this.removeAllUid);this.undoManager.removeListener(this.addUid);this.layout&&(this.destroy(),d.view.Header.setEnable())},destroy:function(){this.clearCollections();this.sectionCollapseManager.clearCollapsed();this.clearButton&&this.clearButton.destroy();this.clearButton=null;this.undoButton&&this.undoButton.destroy();
this.undoButton=null;this.validateButton&&this.validateButton.destroy();this.validateButton=null;this.saveButton&&this.saveButton.destroy();this.saveButton=null;this.copyToButton&&this.copyToButton.destroy();this.copyToButton=null;this.layout&&this.layout.destroy();this.layout=null;this.sidebar&&this.sidebar.destroy();this.sidebar=null;this.sidebarControls&&this.sidebarControls.destroy();this.sidebarControls=null;this.sidebarFields&&this.sidebarFields.destroy();this.sidebarFields=null;this.sidebarConfiguredItems&&
this.sidebarConfiguredItems.destroy();this.sidebarConfiguredItems=null;this.mainLayout&&this.mainLayout.destroy();this.mainLayout=null;this.footer&&this.footer.destroy();this.footer=null;this.panelTitleButtonsContainer&&this.panelTitleButtonsContainer.remove();this.panelTitleButtonsContainer=null;this.layoutStructure&&this.layoutStructure.destroy();this.dictionary&&this.dictionary.destroy();this.temporarySuspend||(this.params=null)}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.controllers.BaseEditorController;d.ns("toa.CompanySettings.VisualFormEditor.controllers.ContextContent",d.define(c,function(b){c.apply(this,arguments)},{_serverController:"wysiwyg",_serverGetMethod:"get",_serverSetMethod:"set",_serverValidateMethod:"validate",_responseLayoutStructureField:"contextLayout",toString:function(){return"Wysiwyg screen controller"},initModels:function(){c.prototype.initModels.apply(this,arguments);this.actionPanelButtons=
new d.CompanySettings.VisualFormEditor.models.collection.structure.ActionPanelButtons;this.undoManager.addCollection("actionPanelButtons",this.actionPanelButtons)},initViews:function(){c.prototype.initViews.apply(this,arguments);this.actionPanel=new d.CompanySettings.VisualFormEditor.views.ActionPanel(this.actionPanelButtons);this.actionPanel.addListener("add",this.updateLayoutHeight.bind(this));this.actionPanel.addListener("load",this.updateLayoutHeight.bind(this));this.actionPanel.addListener("remove",
this.updateLayoutHeight.bind(this));d.app.bind("layout.menu.click",this.destroy.bind(this),this);$app&&$app.addListenerOnce("screen.navigated",this.destroy.bind(this))},showInitialViews:function(){c.prototype.showInitialViews.apply(this,arguments);this.actionPanel.render();this.layout.getElement().find(".wysiwyg-action-content").append(this.actionPanel.getElement());this.updateLayoutHeight()},isContextLayout:function(){return!0},baseRequestParams:function(){return{typeid:this.params.typeid,layout_id:this.params.layout_id,
profile_id:this.params.profile_id}},initCopyTo:function(){var b=this.copyToButton.getPopup(),c=d.create("toa.views.userTypes.FilterableList",{filterable:!1,collection:this.collectionUserTypes});b.clearChildren();b.addChildren([{xtype:"View",label:d.glossary({id:16040}),addClass:"filterable-control",view:c},{xtype:"Button",Label:h(99),addClass:"toa-submit",name:"applyButton",listeners:{click:function(){this.onCopyTo();this.copyToButton.close()}.bind(this)}}]);b.renderChildren()},loadData:function(b,
d){this.sectionCollapseManager.updateSectionIds(d.sectionIdMapper||{});this.sharedWith=d.shared_with||{};this.initAvailableFormsCollection(d);this.initAvailableScreensCollection(d);this.initAvailablePluginsCollection(d);this.initEntitesCollection(d);this.loadUserTypes(d.userTypes);c.prototype.loadData.apply(this,arguments);this.initCopyTo()},loadStructure:function(b){this.actionPanelButtons.load(b[this._responseLayoutStructureField].actions);b[this._responseLayoutStructureField].actions=this.actionPanelButtons;
this.actionPanelButtons.setParent(this.layoutStructure);c.prototype.loadStructure.apply(this,arguments)},initAvailableFormsCollection:function(b){this.collectionAvailableForms=this.factory.getAvailableFormsCollection();this.collectionAvailableForms.clear();!1!==!!(b&&b.availableForms&&b.availableForms.length)&&$.each(b.availableForms,function(b,c){c.id=c.form_id;this.collectionAvailableForms.add(c)}.bind(this))},initAvailableScreensCollection:function(b){this.collectionAvailableScreens=this.factory.getAvailableScreensCollection();
this.collectionAvailableScreens.clear();!1!==!!(b&&b.availableScreens&&b.availableScreens.length)&&$.each(b.availableScreens,function(b,c){this.collectionAvailableScreens.add(c)}.bind(this))},initAvailablePluginsCollection:function(b){this.collectionAvailablePlugins=this.factory.getAvailablePluginsCollection();this.collectionAvailablePlugins.clear();!1!==!!(b&&b.availablePlugins&&b.availablePlugins.length)&&$.each(b.availablePlugins,function(b,c){this.collectionAvailablePlugins.add(c)}.bind(this))},
initAvailableParametersCollection:function(b){this.collectionAvailableParameters=this.factory.getAvailableParametersCollection();this.collectionAvailableParameters.clear();!1!==!!(b&&b.availableParameters&&b.availableParameters.length)&&$.each(b.availableParameters,function(b,c){this.collectionAvailableParameters.add(c)}.bind(this))},initEntitesCollection:function(b){this.collectionEntites=this.factory.getEntitesCollection();this.collectionEntites.clear();!1!==!!(b&&b.entites&&b.entites.length)&&
$.each(b.entites,function(b,c){this.collectionEntites.add(c)}.bind(this))},loadUserTypes:function(b){this.collectionUserTypes.clear();for(var c=0,d=b.length;c<d;c++){var k=b[c];this.collectionUserTypes.add({id:k.id,label:k.label,translation:k.name,profileId:k.display_profile_id,status:k.status,assigned:!1},{silent:!0})}},createPanelTitleButtons:function(){c.prototype.createPanelTitleButtons.apply(this,arguments);this.createCopyToButton()},createCopyToButton:function(){this.copyToButton=d.view.control.create({xtype:"button.Filter",
name:"filterButton",label:h(16037),layoutCellWidth:1,addClass:"buttonCopyTo",popupOptions:{appear:"bottom",align:"right",constraitPosition:!1}});this.panelTitleButtonsList.splice(1,0,this.copyToButton)},getLayoutName:function(b){return b.contextName},onCopyTo:function(){var b=[];this.collectionUserTypes.each(function(c){c.get("assigned")&&b.push(c.get("id"))});if(!b.length)return!1;var c={user_types:b};$.extend(c,this.baseRequestParams());this.sendRequest({controller:this._serverController,method:"copyLayout",
params:c})},getClearConfirmationText:function(){var b="",c=$.map(this.sharedWith,function(b){return b});c.length&&(b=h(16407,{"{UserTypes}":c.join(", ")}));return h(16406,{"{UserTypes}":b})},setSubmitOptions:function(b){"undefined"===typeof b&&(b=[{group:"buttons",type:"button",field:"submit",default_visibility:"ReadWrite",name:h(13601)}]);return b},clearLayout:function(){this.footerButtons.clear();this.footerButtons.load(this.setSubmitOptions());this.actionPanelButtons.clear();c.prototype.clearLayout.apply(this,
arguments)},onSaveStructureClick:function(b,c){this.dataParams="undefined"!==typeof c.ui?c.ui:null;this.draftFields=[];this.checkDraftFields(this.layoutStructure);if(this.draftFields.length)var g=new d.ui.Popup({title:h(13294),autoOpen:!0,html:h(23121),modal:!0,buttons:[{text:h(14621),position:"left",click:function(){g.destroy()}},{text:h(12252),type:"submit",position:"right",click:function(){this.removeDraftFields();this.saveStructure();g.destroy()}.bind(this)}]});else this.saveStructure()},checkDraftFields:function(b){b.get("items").each(function(b){b.get("items")?
this.checkDraftFields(b):"field"===b.get("type")&&b.isDraft()&&this.draftFields.push(b)}.bind(this))},removeDraftFields:function(){$.each(this.draftFields,function(b,c){c.remove()});this.draftFields=[]},clearCollections:function(){this.actionPanelButtons.clear();c.prototype.clearCollections.apply(this,arguments)},destroy:function(b,e){!this.layout||b&&"layout.menu.click"===b&&e&&e.label&&"company_settings_wysiwyg"===e.label||(c.prototype.destroy.apply(this,arguments),this.collectionAvailableForms.clear(),
this.collectionAvailablePlugins.clear(),this.collectionAvailableScreens.clear(),this.collectionEntites.clear(),this.collectionItemLabels.clear(),this.actionPanel.destroy(),this.panel.destroy(),d.app.unbind("layout.menu.click",this.destroy.bind(this),this))},saveStructureResponse:function(b,e){"ERR"===e.status?this.popupWindow=(new d.ui.Popup({title:h(5651),autoOpen:!0,html:h(e.error_code),modal:!0,buttons:[{text:h(445),position:"right",tpl:'<button class="popup-button toa-button"></button>',click:function(){this.destroy()}}],
onClose:function(){this.destroy()}})).show():null!==this.dataParams&&this.dataParams.isForm?this.openForm(this.dataParams.label):c.prototype.saveStructureResponse.apply(this,arguments)},undo:function(b,d){c.prototype.undo.apply(this,arguments);"undefined"!==typeof d.ui&&d.ui.isForm&&this.openForm(d.ui.label)},openForm:function(b){this.temporarySuspend=!0;d.app.trigger("layout.menu.click",{label:"company_settings_forms_and_plugins_content",url:"",name:h(15001),params:{isForm:!0,formId:b,formLabel:b,
layout_id:this.params.layout_id,typeid:this.params.typeid,panelTitleText:this.panel.options.titleText,onClose:function(){d.app.trigger("layout.menu.click",{label:"company_settings_wysiwyg",url:"",name:h(15001),params:{layout_id:this.params.layout_id,typeid:this.params.typeid,onClose:this.params.onClose.bind(this)}})}.bind(this)}})}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.controllers.BaseEditorController;d.ns("toa.CompanySettings.VisualFormEditor.controllers.FormContent",d.define(c,function(){c.apply(this,arguments)},{_serverController:"formsconfiguration",_serverGetMethod:"getFormContent",_serverSetMethod:"setContent",_serverValidateMethod:"validateForm",_responseLayoutStructureField:"formContent",baseRequestParams:function(){return{form_id:this.params.formId,form_label:this.params.formLabel}},isFormLayout:function(){return!0},
saveStructureResponse:function(b,e){"ERR"===e.status?this.popupWindow=(new d.ui.Popup({title:h(5651),autoOpen:!0,html:h(e.error_code),modal:!0,buttons:[{text:h(445),position:"right",tpl:'<button class="popup-button toa-button"></button>',click:function(){this.destroy()}}],onClose:function(){this.destroy()}})).show():c.prototype.saveStructureResponse.apply(this,arguments)},setSubmitOptions:function(b){"undefined"===typeof b&&(b=[{group:"buttons",type:"button",field:"submit",default_visibility:"ReadWrite"}]);
b[0].name=h(13601);return b},clearLayout:function(){this.footerButtons.clear();this.footerButtons.load(this.setSubmitOptions());c.prototype.clearLayout.apply(this,arguments)},getLayoutName:function(b){return b.formName}}))})(toa);(function(d){var c=d.models.ObservableModel;d.ns("toa.CompanySettings.VisualFormEditor.models.BaseModel",d.define(c,function(){c.apply(this,arguments)},{skippedToJSONAttributes:["errors","names"],DEFAULT_LANG_ID:1,getUserLanguage:function(){return _DATA.ulanguage||this.DEFAULT_LANG_ID},toJSON:function(){var b={},c,g=this.skippedToJSONAttributes||[];b[this.idField]=this.getId();for(c in this.attributes)-1===g.indexOf(c)&&(b[c]=this.attributes[c]instanceof d.models.ObservableCollection||this.attributes[c]instanceof
d.models.ObservableModel?this.attributes[c].toJSON():this.attributes[c]);return b}}))})(toa);(function(d){var c=d.models.ObservableCollection;d.ns("toa.CompanySettings.VisualFormEditor.models.BaseCollection",d.define(c,function(){c.apply(this,arguments)},{modelConstructor:{},toString:function(){return"Base collection"},comparator:function(b,c){var d,k;d=b.getName();k=c.getName();return d<k?-1:d>k?1:0},_castToModel:function(b){var c;if(this._checkInstance(b))c=b;else{if(c||b!==Object(b))throw Error("Cannot cast unknown type to model. Use plain Object or instance of this.modelConstructor");
c=new this.modelConstructor[b.type](b)}return c},_checkInstance:function(b){for(var c in this.modelConstructor)if(b instanceof this.modelConstructor[c])return!0;return!1},remove:function(b,c){c=c||{};if(!this._checkInstance(b))throw Error("Model must be an instance of this.modelConstructor");b=this.getByUid(b.uid)||this.get(b.id);if(!b)return!1;var d=this.indexOf(b);if(-1===d)return!1;delete this._byUid[b.uid];delete this._byId[b.id];this.models.splice(d,1);this._free(b);c.silent||this.notify("remove",
b);return!0}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.models.BaseCollection;d.ns("toa.CompanySettings.VisualFormEditor.models.BaseStructureItems",d.define(c,function(){c.apply(this,arguments)},{modelConstructor:{},load:function(b){var c,d=0;for(c in b)"undefined"!=typeof this.modelConstructor[b[c].type]&&(b[c].order=d,this.add(b[c],{silent:!0,doNotAutoSort:!0}),d++);this.sort({silent:!0});this.notify("load")},setParent:function(b){this.parent=b},getMaxOrder:function(){var b,c=0;this.each(function(d){b=
d.get("order",0);b>c&&(c=b)});return c},removeMarkers:function(){var b=!1,c=[],g=null;do this.models[0]instanceof d.CompanySettings.VisualFormEditor.models.Marker?(this.models[0].remove(),b=!0):b=!1;while(b);do this.models[this.getCount()-1]instanceof d.CompanySettings.VisualFormEditor.models.Marker?(this.models[this.getCount()-1].remove(),b=!0):b=!1;while(b);this.each(function(b){null!=g&&g instanceof d.CompanySettings.VisualFormEditor.models.Marker&&b instanceof d.CompanySettings.VisualFormEditor.models.Marker&&
c.push(b);g=b}.bind(this));for(b=0;b<c.length;b++)c[b].remove()},append:function(b,c){var g=c||{};g.debug="BaseStructureItems:append";d.CompanySettings.VisualFormEditor.classes.factory.getUndoManager().addStep(g);b=this.checkModel(b);b=this.wrapItem(b);b=this.get(b.getId())||b;b.set({order:this.getMaxOrder()+1});this.get(b.getId())?this.sort():(this.parent?b.set({parent:this.parent.getId()}):b.set({parent:0}),this.add(b,c));return b},appendAfter:function(b,c,g){var k,l,n=g||{},n=d.CompanySettings.VisualFormEditor.classes.factory.getUndoManager().prepareOptions(n,
b,c,"BaseStructureItems:appendAfter");d.CompanySettings.VisualFormEditor.classes.factory.getUndoManager().addStep(n);b=this.checkModel(b);b=this.wrapItem(b);k=c.get("order",0);this.each(function(b){l=b.get("order");l>k&&b.set({order:l+1},{silent:!0})}.bind(this));b.set({order:k+1});this.sort();this.parent?b.set({parent:this.parent.getId()}):b.set({parent:0});-1==this.indexOf(b)&&this.add(b,g);return b},appendBefore:function(b,c,g){var k,l,n=g||{};n.debug="BaseStructureItems:appendBefore";if("undefined"==
typeof c||null==c)return this.append(b,g);d.CompanySettings.VisualFormEditor.classes.factory.getUndoManager().addStep(n);b=this.checkModel(b);b=this.wrapItem(b);k=c.get("order",0);this.each(function(b){l=b.get("order");l>=k&&b.set({order:l+1},{silent:!0})}.bind(this));b.set({order:k});this.get(b.getId())?this.sort():(this.parent?b.set({parent:this.parent.getId()}):b.set({parent:0}),-1==this.indexOf(b)&&this.add(b,g));return b},get:function(b){return b?this._byId[b]||this._byUid[b]||!1:!1},wrapItem:function(b){return b},
checkModel:function(b){var c;c=b.collection;b instanceof d.CompanySettings.VisualFormEditor.models.Section&&b.get("items").setParent(b);if(c===this)return b;c instanceof d.CompanySettings.VisualFormEditor.models.collection.Controls?b=b.clone():b.remove(!0);return b},comparator:function(b,c){var d,k;d=parseInt(b.get("order",0));k=parseInt(c.get("order",0));return d<k?-1:d>k?1:0}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.models.BaseModel;d.ns("toa.CompanySettings.VisualFormEditor.models.BaseLayoutItem",d.define(c,function(b){c.apply(this,arguments);this.setNames();this.setTranslations()},{_defaultType:"",getType:function(){return this.get("type",this._defaultType)},getLabel:function(){return this.get("label","")},getEntity:function(){return this.get("entity","")},setDefaultVisibility:function(b,c){0===this.get("visibility").getCount()&&null==b.default_visibility&&
this.set({default_visibility:c})},setReadOnlyDefaultVisibility:function(b){this.setDefaultVisibility(b,"ReadOnly")},setReadWriteDefaultVisibility:function(b){d.CompanySettings.VisualFormEditor.classes.factory.getReadOnlyFieldsHelper().isReadOnlyField(this.getLabel(),this.getEntity())?this.setDefaultVisibility(b,"ReadOnly"):this.setDefaultVisibility(b,"ReadWrite")},setNames:function(b){var c;b=b||this.get("names",[]);b instanceof d.CompanySettings.VisualFormEditor.models.collection.Translations||(c=
new d.CompanySettings.VisualFormEditor.models.collection.Translations,c.load(b),this.set({names:c},{silent:!0}))},clearNames:function(){var b=this.get("names");b instanceof d.CompanySettings.VisualFormEditor.models.collection.Translations&&b.clear()},clearTranslations:function(){var b=this.get("translations");b instanceof d.CompanySettings.VisualFormEditor.models.collection.Translations&&b.clear()},getName:function(){var b,c,g,k;g=this.getUserLanguage();(b=this.get("translations"))&&b instanceof d.models.ObservableCollection&&
b.getCount()&&(c=b.get(g));c&&(k=c.get("name",""));k||(b=this.get("names"),(g=b.get(g))&&(k=g.get("name")));k||(k=this.get("name"));return k||""},setTranslations:function(b){var c;b=b||this.get("translations",[]);b instanceof d.CompanySettings.VisualFormEditor.models.collection.Translations||(c=new d.CompanySettings.VisualFormEditor.models.collection.Translations,c.load(b),this.set({translations:c},{silent:!0}))},setItems:function(b){var c;b=b||this.get("items");b instanceof d.CompanySettings.VisualFormEditor.models.collection.Sections||
(c=new d.CompanySettings.VisualFormEditor.models.collection.Sections,c.setParent(this),c.load(b),this.set({items:c},{silent:!0}))},setVisibility:function(b){b=b||this.get("visibility");b instanceof d.CompanySettings.VisualFormEditor.models.collection.Visibilities||(b=new d.CompanySettings.VisualFormEditor.models.collection.Visibilities,b.load(this.get("visibility")),this.set({visibility:b},{silent:!0}))},isSpecialElement:function(){return!1},isButton:function(){return!1},isEvaluationAllowed:function(){return!1},
hasValidationErrors:function(){var b=this.get("errors",[]);return b&&$.isArray(b)&&b.length},append:function(b,c){this.collection.appendAfter(b,this,c)},appendBefore:function(b){this.collection.appendBefore(b,this)}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.models.BaseLayoutItem;d.ns("toa.CompanySettings.VisualFormEditor.models.BaseField",d.define(c,function(b){c.apply(this,arguments);this.predefineGui()},{idField:"item_id",_defaultType:"field",_defaultEntity:1,_guiTypes:"combobox radiogroup input checkbox image file signature geolocation".split(" "),_defaultGuiType:"input",_enumerationGuiTypes:["combobox","radiogroup"],_inputGuiTypes:["input","text","url","phone","email"],_datetimeGuiTypes:["datepicker",
"timepicker","datetimepicker"],_defaultEnumerationGuiType:"combobox",predefineGui:function(){var b=!1;"list"===this.getGuiType()&&(b=this._defaultEnumerationGuiType);"capture_image"===this.getGuiType()&&(b="image");b&&this.set({gui:b},{silent:!0})},getGuiType:function(){return this.get("gui",this._defaultGuiType)},getEntity:function(){return parseInt(this.get("entity",this._defaultEntity),10)},getBarcodeFlag:function(){var b=this.get("scanner",0);return 1===b||"1"===b},supportsValueVisibility:function(){return"user_type_id"===
this.get("label")?!1:this.isEnumeration()},isField:function(){return"field"===this.getType()},isProperty:function(){return"property"===this.getType()},isFormElement:function(){return"form_element"===this.getType()},getPropertyId:function(){return this.get("property_id",!1)},isEnumeration:function(b){b=b||this.getGuiType();return-1!==$.inArray(b,this._enumerationGuiTypes)},isBarcode:function(b){if("form_element"!==this.get("type")&&(d.CompanySettings.VisualFormEditor.classes.factory.getReadOnlyFieldsHelper().isReadOnlyField(this.get("label"),
this.get("entity"))||!d.CompanySettings.VisualFormEditor.classes.factory.getNotAllowScanningFieldsHelper().isAllowScanning(this.get("label"),this.get("entity"))))return!1;b=b||this.getGuiType();return-1!==$.inArray(b,this._inputGuiTypes)},isDateTime:function(b){b=b||this.getGuiType();return-1!==$.inArray(b,this._datetimeGuiTypes)},toJSON:function(){var b=c.prototype.toJSON.apply(this,arguments);this.isBarcode()||delete b.scanner;"lookups"in this.attributes&&delete b.lookups;return b}}))})(toa);(function(d){var c=d.models.ObservableModel;d.ns("toa.CompanySettings.VisualFormEditor.models.Parameter",d.define(c,function(b){c.apply(this,arguments)},{idField:"parameter_id",setParameters:function(b){this.params=b}}))})(toa);(function(d){var c=d.models.ObservableModel;d.ns("toa.CompanySettings.VisualFormEditor.models.LayoutStructure",d.define(c,function(b){this.items=[];c.apply(this)},{idField:"layout_id",toString:function(){return"Context layout collection"},load:function(b){this.set(b);this.notify("load")},find:function(b){return this.findByAttribute("items","item_id",b).shift()||!1},findByAttribute:function(b,c,d,k){"undefined"===typeof k&&(k=!1);var l=function(b,c,d,e){var g,k,w,x=[];if(!b)return!1;k=b.getCount();
for(g=0;g<k;g++)!1!==e&&b.models[g].get(c)==d&&b.models[g].get("type")===e||!1===e&&b.models[g].get(c)==d?x=x.concat(b.models[g]):(w=l(b.models[g].get("items"),c,d,e),!1!=w&&(x=x.concat(w)));return x};return(b=this.get(b))?l(b,c,d,k):!1},findByUid:function(b,c){var d,k=function(b,c){var d,e,g,u=[];if(!b)return!1;e=b.getCount();for(d=0;d<e;d++)b.models[d].uid==c?u=u.concat(b.models[d]):(g=k(b.models[d].get("items"),c),!1!=g&&(u=u.concat(g)));return u};return(d=this.get(b))?k(d,c):!1},append:function(b){var c,
g;c=this.get("items");g=new d.CompanySettings.VisualFormEditor.models.Marker;c.append(g,{silent:!0});g=new d.CompanySettings.VisualFormEditor.models.Section;g.append(b);c.append(g)}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.models.BaseField;d.ns("toa.CompanySettings.VisualFormEditor.models.Field",d.define(c,function(b){b.group||(b.group="main");c.apply(this,arguments);this.predefineEntity();this.isHidden()||(this.setVisibility(),this.setVisibilityValue(),this.setValidationMessages(),this.setReadWriteDefaultVisibility(b));"undefined"===typeof this.attributes[this.idField]&&(this.attributes[this.idField]=this.uid)},{_defaultType:"form_element",evaluationGuis:"text checkbox combobox radiogroup email phone url input".split(" "),
evaluationFields:"cname caddress ccity czip cstate customer_number cphone cemail email ccell aworktype time_slot appt_number length apoints invsn invtype quantity srtype planguage pdate_fid ptime_fid time_zone sulong_date_fid".split(" "),entityMap:{1:"activity",2:"inventory",3:"resource",5:"service_request",9:"user",10:"required_inventory"},prepareNew:function(){!0===this.get("isNewElement",!1)&&(this.set({label:d.CompanySettings.VisualFormEditor.classes.factory.getFormElementService().getNewLabel()}),
this.clearNames(),this.set({isNewElement:!1},{silent:!0}))},predefineEntity:function(){if(!this.isLocal()&&!this.get("entity",!1)){var b=d.CompanySettings.VisualFormEditor.classes.factory.getAvailableEntities();b.length&&this.set({entity:parseInt(b[0])},{silent:!0})}},getEntity:function(){return this.isLocal()?!1:c.prototype.getEntity.apply(this,arguments)},isDraft:function(){return(this.isProperty()||this.isField())&&!this.get("property_id",!1)},isLocal:function(){return"form_element"===this.getType()},
isHidden:function(){return this.isLocal()&&"hidden"===this.getGuiType()},getEntityMap:function(){return this.entityMap},hasEnumerationValues:function(){return 0<this.getEnumerationValues().length},getEnumerationValues:function(){var b=this.get("values",[]);$.each(b,function(c,d){b[c].name=this.getValueName(d)}.bind(this));return b},getValueName:function(b){var c="",d=this.getUserLanguage();b.translations&&(c=b.translations[d]||"");return c},setEnumerationValues:function(b){var c=[];$.each(b,function(b,
d){c.push({label:d.label,translations:d.translations})});this.set({values:c})},clearEnumerationValues:function(){this.hasEnumerationValues()&&this.set({values:[]})},getEnumerationValuesNames:function(){var b=[],c=this.getEnumerationValues();$.each(c,function(c,d){b.push(d.name)});return b},isEvaluationAllowed:function(){if(this.isField()){var b=this.getLabel();return-1!==$.inArray(b,this.evaluationFields)}b=this.get("gui",!1);return!1!==b&&-1!==$.inArray(b,this.evaluationGuis)},append:function(b){this.collection.appendAfter(b,
this);this.collection.removeMarkers()},appendBefore:function(b){this.collection.appendBefore(b,this);this.collection.removeMarkers()},clone:function(b){!0===b&&delete this.attributes[this.idField];return c.prototype.clone.apply(this,arguments)},_setOneField:function(b,e){c.prototype._setOneField.apply(this,arguments);this.isLocal()&&this.attributes[b]&&!0===this.isChanged&&-1===$.inArray(b,["type","entity","property_id"])&&(d.CompanySettings.VisualFormEditor.classes.factory.getFormElementService().updateElement(this),
this.isChanged=!1)},setTranslations:function(b){c.prototype.setTranslations.apply(this,arguments);this.isLocal()&&d.CompanySettings.VisualFormEditor.classes.factory.getFormElementService().updateElement(this)},setVisibilityValue:function(b){var c;b=b||this.get("groupedValues");b instanceof d.CompanySettings.VisualFormEditor.models.collection.GroupedVisibilitiesValue||(c=new d.CompanySettings.VisualFormEditor.models.collection.GroupedVisibilitiesValue,c.load(b),this.set({groupedValues:c},{silent:!0}))},
clearVisibilityValue:function(){var b=this.get("groupedValues");b instanceof d.CompanySettings.VisualFormEditor.models.collection.GroupedVisibilitiesValue&&b.clear()},setValidationMessages:function(b){if(!this.isEvaluationAllowed())return!1;var c;b=b||this.get("validation_messages");b instanceof d.CompanySettings.VisualFormEditor.models.collection.ValidationMessages||(c=new d.CompanySettings.VisualFormEditor.models.collection.ValidationMessages,c.load(b),this.set({validation_messages:c},{silent:!0}))},
clearEvaluation:function(){this.set({evaluation:{}});var b=this.get("validation_messages");b instanceof d.CompanySettings.VisualFormEditor.models.collection.ValidationMessages&&b.clear()},setToLocalField:function(){this.set({type:"form_element",property_id:!1,entity:!1,field:!1})},setToEntityField:function(b){this.set({type:b.type,property_id:b.property_id,label:b.label,entity:b.entity,gui:b.gui,field:"field"===b.type?b.label:!1})}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.models.BaseLayoutItem;d.ns("toa.CompanySettings.VisualFormEditor.models.Button",d.define(c,function(b){b=b||{};b.type||(b.type="action");b.group||(b.group="main");c.apply(this,arguments);this.setVisibility();"button"!==b.type&&this.setReadOnlyDefaultVisibility(b)},{idField:"item_id",_defaultFormNames:[],getAvailableForms:function(){return d.CompanySettings.VisualFormEditor.classes.factory.getAvailableFormsCollection()},getFormId:function(){return this.get("form_id",
null)},getFormsList:function(){var b=[];this.getAvailableForms().each(function(c){b.push({form_id:c.getId(),label:c.get("label",""),name:c.get("name",""),names:c.get("names","")})});return b},getScreensList:function(){var b=[];d.CompanySettings.VisualFormEditor.classes.factory.getAvailableScreensCollection().each(function(c){b.push({action_link_id:c.get("screen_id",""),label:c.get("label",""),name:c.get("name",""),names:c.get("names","")})});return b},getPluginsList:function(){var b=[];d.CompanySettings.VisualFormEditor.classes.factory.getAvailablePluginsCollection().each(function(c){b.push({action_link_id:c.get("screen_id",
""),label:c.get("label",""),name:c.get("name",""),names:c.get("names",""),plugin_type:c.get("plugin_type",""),plugin_hosted_id:c.get("plugin_hosted_id","")})});return b},getParametersList:function(){var b=[];d.CompanySettings.VisualFormEditor.classes.factory.getAvailableParametersCollection().each(function(c){b.push({id:c.get("label"),label:c.get("label"),text:c.get("text"),type:c.get("type"),entity:c.get("entity"),selected:"",disabled:""})});return b},getEntitesList:function(){var b=[];d.CompanySettings.VisualFormEditor.classes.factory.getEntitesCollection().each(function(c){b.push({id:c.get("id"),
name:c.get("name"),selected:"",disabled:""})});return b},assignForm:function(b){b=b||null;var c=this.findForm(b);c?this.set({form_id:b,label:c.get("label",""),names:c.get("names",[])}):this.setEmptyForm();this.setNames()},setEmptyForm:function(){this.set({form_id:null,label:null,names:this._defaultFormNames})},findForm:function(b){return b?this.getAvailableForms().get(b):!1},getAssignedForm:function(){return this.findForm(this.getFormId())},getScreenTranslation:function(b){return this.findTranslation(this.getScreensList(),
"action_link_id",b)},getFormTranslation:function(b){return this.findTranslation(this.getFormsList(),"form_id",b)},getPluginTranslation:function(b){return this.findTranslation(this.getPluginsList(),"action_link_id",b)},getActionTranslation:function(b){return this.getScreenTranslation(b)||this.getPluginTranslation(b)},findTranslation:function(b,c,d){for(var k=0;k<b.length;k++)if(b[k][c]==d)return b[k].names},isSpecialElement:function(){return!0},isButton:function(){return!0},isPlugin:function(){return this.isAction()&&
this.get("is_plugin",!1)},isAddon:function(){return this.isPlugin()&&this.get("is_addon",!1)},isAction:function(){return"action"===this.get("type")},isFooterButton:function(){return"button"===this.get("type")},isForm:function(){return"form"===this.get("type")},isButtonBound:function(){return"undefined"!==typeof this.get("label")&&null!==this.get("label")},getBaseActionNames:function(b){var c=null;$.each(this.getScreensList(),function(d,k){k.label===b&&(c=k.names)}.bind(this));return c}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.models.BaseLayoutItem;d.ns("toa.CompanySettings.VisualFormEditor.models.Text",d.define(c,function(b){b=b||{};c.apply(this,arguments);this.setVisibility();this.setReadOnlyDefaultVisibility(b)},{idField:"item_id",isSpecialElement:function(){return!0}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.models.BaseLayoutItem;d.ns("toa.CompanySettings.VisualFormEditor.models.Section",d.define(c,function(b){b=b||{};b.type||(b.type="section");b.group||(b.group="main");c.apply(this,arguments);this.setVisibility();this.setItems();this.setReadWriteDefaultVisibility(b);this.collapseManager=d.CompanySettings.VisualFormEditor.classes.factory.getSectionCollapseManager()},{idField:"item_id",getItems:function(){return this.get("items",null)},initEvent:function(){var b;
(b=this.getItems())&&b.addListener("remove",function(){0===b.getCount()&&this.remove()}.bind(this))},remove:function(b){if(!b)for(var d=this.getItems().models||[],g=0;g<d.length;g++)d[g].remove(b);d=this.collection;c.prototype.remove.apply(this,arguments);d&&d.removeMarkers()},append:function(b){var c;c=this.getItems();c.append(b);c.removeMarkers()},appendBefore:function(b,c){var d;d=this.getItems();d.appendBefore(b,c);d.removeMarkers()},isSpecialElement:function(){return!0},isCollapsed:function(){var b=
this.collapseManager.isSectionCollapsed(this.getIdString());return this.get("collapsed",b)},isSection:function(){return"section"===this.getType()},isTab:function(){return"tab"===this.getType()},isPredefinedTab:function(){return"predefined_tab"===this.getType()},changeCollapsing:function(){var b=this.isCollapsed();this.set({collapsed:!b},{silent:!0});b?this.collapseManager.removeFromCollapsed(this.getIdString()):this.collapseManager.addToCollapsed(this.getIdString())},getIdString:function(){return""+
this.getId()}}))})(toa);(function(d){var c=d.models.ObservableModel;d.ns("toa.CompanySettings.VisualFormEditor.models.Marker",d.define(c,function(b){c.apply(this,arguments);this.parent=null},{idField:"item_id",defaults:{type:"marker",field:"NC",group:"main"},remove:function(b){c.prototype.remove.apply(this,arguments)},append:function(b){var c;c=new d.CompanySettings.VisualFormEditor.models.Marker;-1==this.collection.indexOf(this)?(this.collection.appendAfter(c,this,{silent:!0}),this.collection.appendAfter(b,c,{})):(this.collection.appendAfter(c,
this,{silent:!0}),this.collection.appendAfter(b,this,{}));this.collection.removeMarkers()},appendAfter:function(b,c){this.collection.appendAfter(b,c);this.collection.removeMarkers()}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.models.BaseField;d.ns("toa.CompanySettings.VisualFormEditor.models.AvailableField",d.define(c,function(b){c.apply(this,arguments)},{isAllowed:function(){return d.CompanySettings.VisualFormEditor.classes.factory.getFormContext()||this.get("allowed",0)},hasLookups:function(){return 0<this.getLookups().length},getLookups:function(){return this.get("lookups",[])},isDisabledCondition:function(){return this.isFormElement()&&!0!==this.get("canBeUsedInCondition")}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.models.BaseField;d.ns("toa.CompanySettings.VisualFormEditor.models.ConfiguredItem",d.define(c,function(b){c.apply(this,arguments)},{isAllowed:function(){return d.CompanySettings.VisualFormEditor.classes.factory.getFormContext()||this.get("allowed",0)},hasLookups:function(){return 0<this.getLookups().length},getLookups:function(){return this.get("lookups",[])},isDisabledCondition:function(){return this.isFormElement()&&!0!==this.get("canBeUsedInCondition")}}))})(toa);(function(d){var c=d.models.ObservableModel;d.ns("toa.CompanySettings.VisualFormEditor.models.ConditionDictionary",d.define(c,function(b){c.apply(this,arguments)},{idField:"_dictLink",systemIdField:"_id",predefineDataField:"predefData",get:function(b,c){var d=this.__getDictionaryValue();return d&&d.hasOwnProperty(b)?d[b]:c},_setOneField:function(b,c,d){d=0<Object.keys(d).length?d:{};switch(b){case "value":d.value=c;break;case "condition":d.condition=c;break;case "property_id":d.property_id=c;break;
case "field":d.field=c;break;case "entity":d.entity=c}return d},__getValue:function(){return this.attributes.hasOwnProperty(this.idField)?this.attributes[this.idField]:null},__getDictionaryValue:function(){var b=d.CompanySettings.VisualFormEditor.classes.factory.getDictionary().getCondition(this.__getValue());return b?this.__createConditionElement(b):null},__findInDictionaryOrCreate:function(){var b=d.CompanySettings.VisualFormEditor.classes.factory.getDictionary().getCondition(this.__getValue());
return b?this.__createConditionElement(b):null},__createConditionElement:function(b){var c={field:b[0],condition:b[1],value:b[2],entity:b[3]};"property"===b[0]&&(c.property_id=b[4]);return c},__createConditionDictionaryElement:function(b){var c=[b.field,b.condition,b.value,b.entity];b.property_id&&c.push(b.property_id);return c},__setDictionaryValue:function(b){return d.CompanySettings.VisualFormEditor.classes.factory.getDictionary().setCondition(b)},set:function(b,c){var d,k;c=c||{};var l={};this.__getDictionaryValue()&&
(l=this.__getDictionaryValue());for(d in b)if(b.hasOwnProperty(d)){k=b[d];if(d===this.idField){this.attributes[this.idField]=k;b.hasOwnProperty(this.systemIdField)&&(this.attributes[this.systemIdField]=b[this.systemIdField]);return}l=this._setOneField(d,k,l)}c.silent||!0!==this.isChanged||this.triggerChange();l=this.__createConditionDictionaryElement(l);this.attributes[this.idField]=this.__setDictionaryValue(l)},getData:function(){return this.__getDictionaryValue()}}))})(toa);(function(d){var c=d.models.ObservableModel;d.ns("toa.CompanySettings.VisualFormEditor.models.TmpConditionDictionary",d.define(c,function(b){c.apply(this,arguments)},{idField:"",getData:function(){return this.attributes},setDictionaryIndex:function(b){this.set({dictionaryIndex:b},{silent:!0})},getDictionaryIndex:function(){return this.get("dictionaryIndex",!1)}}))})(toa);(function(d){var c=d.models.ObservableModel;d.ns("toa.CompanySettings.VisualFormEditor.models.Dictionary",d.define(c,function(b){c.apply(this,arguments)},{dictionaryConditionIdentifier:"conditionDictionary",idField:"",getCondition:function(b){return this.attributes[this.dictionaryConditionIdentifier].hasOwnProperty(b)?this.attributes[this.dictionaryConditionIdentifier][b]:null},getDictionaryConditions:function(){return this.attributes[this.dictionaryConditionIdentifier]},setCondition:function(b){var c=
this.searchCondition(b);-1===c&&(c=this.attributes[this.dictionaryConditionIdentifier].push(b)-1);return c},searchCondition:function(b){return this.attributes[this.dictionaryConditionIdentifier].indexOf(b)},updateConditionsPropertyId:function(b,c){for(var d=this.getDictionaryConditions(),k=0;k<d.length;k++)d[k][4]&&d[k][4]===c&&(d[k][4]=b)}}))})(toa);(function(d){var c=d.models.ObservableModel;d.ns("toa.CompanySettings.VisualFormEditor.models.Visibility",d.define(c,function(b){var e;c.apply(this,arguments);null==this.get("visibility",null)&&this.set({visibility:"ReadOnly"});this.get("conditions")instanceof d.CompanySettings.VisualFormEditor.models.collection.ConditionsDictionary||(e=new d.CompanySettings.VisualFormEditor.models.collection.ConditionsDictionary,e.load(this.get("conditions"),{}),this.set({conditions:e}))},{idField:"visibility_id"}))})(toa);(function(d){var c=d.models.ObservableModel;d.ns("toa.CompanySettings.VisualFormEditor.models.Language",d.define(c,function(){c.apply(this,arguments)}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.models.BaseModel;d.ns("toa.CompanySettings.VisualFormEditor.models.Translation",d.define(c,function(){c.apply(this,arguments)},{clone:function(){return c.prototype.clone.apply(this,arguments)},isUserLanguage:function(){return this.getUserLanguage()===this.getId()},toJSON:function(){if(this.get("name")){var b={},c;b[this.idField]=this.getId();for(c in this.attributes)b[c]=this.attributes[c]instanceof d.models.ObservableCollection||this.attributes[c]instanceof
d.models.ObservableModel?his.attributes[c].toJSON():this.attributes[c];return b}}}))})(toa);(function(d){var c=d.models.ObservableModel;d.ns("toa.CompanySettings.VisualFormEditor.models.GroupedVisibilityValue",d.define(c,function(b){var e;c.apply(this,arguments);b&&b.conditions instanceof d.CompanySettings.VisualFormEditor.models.collection.ConditionsDictionary||(e=new d.CompanySettings.VisualFormEditor.models.collection.ConditionsDictionary,b&&b.conditions&&e.load(b.conditions||{}),this.set({conditions:e}))},{idField:""}))})(toa);(function(d){var c=d.models.ObservableCollection;d.ns("toa.CompanySettings.VisualFormEditor.models.collection.AvailableFields",d.define(c,function(){c.apply(this,arguments)},{modelConstructor:d.CompanySettings.VisualFormEditor.models.AvailableField,toString:function(){return"Available Fields collection"},getFirst:function(){var b,c=this.getCount();for(b=0;b<c;b++)if(this.isCanBeUsedInCondition(this.models[b]))return this.models[b];return null},isCanBeUsedInCondition:function(b){return"form_element"===
b.get("type")&&b.get("canBeUsedInCondition")||"form_element"!==b.get("type")?!0:!1},getFirstWithCondition:function(b){b=b||!1;var c=!1,d=this.getCount()||0,k,l=0;if(d){do k=this.models[l],k instanceof this.modelConstructor&&k.get("condition",0)&&(!b||!k.isDisabledCondition())&&(c=k),l+=1;while(!c&&l<d)}return c},getByLabel:function(b){var c,d=this.getCount();for(c=0;c<d;c++)if(this.models[c].get("label")==b)return this.models[c];return null},getByLabelEntity:function(b,c){var d,k=this.getCount();
for(d=0;d<k;d++)if(this.models[d].get("label")==b&&this.models[d].get("entity")==c)return this.models[d];return null},getPropertyByLabel:function(b){var c,d=this.getCount();for(c=0;c<d;c++)if((this.models[c].isField()||this.models[c].isProperty())&&this.models[c].getLabel()===b)return this.models[c];return null},getConditionFields:function(){var b,c=[],d=this.getCount();for(b=0;b<d;b++)this.models[b].get("condition",0)&&c.push(this.models[b]);return c},comparator:function(b,c){var d,k;d=b.getName();
k=c.getName();return d<k?-1:d>k?1:0},load:function(b){var c,d=b.length;for(c=0;c<d;c++)-1===this.indexOf(b[c])&&this.add(b[c],{silent:!0,doNotAutoSort:!0});this.sort({silent:!0});this.notify("load")},defineUnusedFormElements:function(b){b.get("items")&&b.get("items").each(function(b){b.get("items")?this.defineUnusedFormElements(b):"form_element"===b.get("type")&&null!==this.getByLabel(b.get("label"))&&this.getByLabel(b.get("label")).set({canBeUsedInCondition:!0})}.bind(this))}}))})(toa);(function(d){var c=d.models.ObservableCollection;d.ns("toa.CompanySettings.VisualFormEditor.models.collection.ConfiguredItems",d.define(c,function(){c.apply(this,arguments)},{modelConstructor:d.CompanySettings.VisualFormEditor.models.ConfiguredItem,toString:function(){return"Configured Items collection"},getByLabel:function(b){var c,d=this.getCount();for(c=0;c<d;c++)if(this.models[c].get("label")==b)return this.models[c];return null},getByLabelEntity:function(b,c){var d,k=this.getCount();for(d=0;d<
k;d++)if(this.models[d].get("label")==b&&this.models[d].get("entity")==c)return this.models[d];return null},getPropertyByLabel:function(b){var c,d=this.getCount();for(c=0;c<d;c++)if((this.models[c].isField()||this.models[c].isProperty()||this.models[c].isForm()||this.models[c].isAction())&&this.models[c].getLabel()===b)return this.models[c];return null},load:function(b){var c,d=b.length;for(c=0;c<d;c++)-1===this.indexOf(b[c])&&this.add(b[c],{silent:!1,doNotAutoSort:!0});this.notify("load")}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.models.BaseCollection;d.ns("toa.CompanySettings.VisualFormEditor.models.collection.Controls",d.define(c,function(){c.apply(this,arguments)},{sectionTypeCanBeChanged:!0,modelConstructor:{section:d.CompanySettings.VisualFormEditor.models.Section,tab:d.CompanySettings.VisualFormEditor.models.Section,text:d.CompanySettings.VisualFormEditor.models.Text,button:d.CompanySettings.VisualFormEditor.models.Button,action:d.CompanySettings.VisualFormEditor.models.Button,
form:d.CompanySettings.VisualFormEditor.models.Button,form_element:d.CompanySettings.VisualFormEditor.models.Field,field:d.CompanySettings.VisualFormEditor.models.Field,property:d.CompanySettings.VisualFormEditor.models.Field},toString:function(){return"Sidebar Controls collection"},load:function(b){var c,d=b.length,k=0;for(c=0;c<d;c++)"marker"!==b[c].type&&-1==this.indexOf(b[c])&&("section"!==b[c].type&&"tab"!==b[c].type||k++,this.add(b[c],{silent:!0,doNotAutoSort:!0}));this.sectionTypeCanBeChanged=
1>=k?!1:!0;this.sort({silent:!0});this.notify("load")},isSectionTypeChangeable:function(){return this.sectionTypeCanBeChanged}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.models.BaseStructureItems;d.ns("toa.CompanySettings.VisualFormEditor.models.collection.Sections",d.define(c,function(){c.apply(this,arguments)},{modelConstructor:{section:d.CompanySettings.VisualFormEditor.models.Section,tab:d.CompanySettings.VisualFormEditor.models.Section,text:d.CompanySettings.VisualFormEditor.models.Text,button:d.CompanySettings.VisualFormEditor.models.Button,action:d.CompanySettings.VisualFormEditor.models.Button,form:d.CompanySettings.VisualFormEditor.models.Button,
field:d.CompanySettings.VisualFormEditor.models.Field,property:d.CompanySettings.VisualFormEditor.models.Field,form_element:d.CompanySettings.VisualFormEditor.models.Field,marker:d.CompanySettings.VisualFormEditor.models.Marker},checkModel:function(b){var e,g,k,l,n;b=c.prototype.checkModel.apply(this,arguments);if(!this.parent||b instanceof d.CompanySettings.VisualFormEditor.models.Button&&b.isAction())return b;l=d.CompanySettings.VisualFormEditor.classes.factory.getLayoutStructure();n=l.findByAttribute("items",
"property_id",b.getId(),b.get("type"));if(0<n.length)for(e=0;e<n.length;e++)if(k=l.findByAttribute("items","item_id",n[e].get("parent")),0==k.length&&(k=l.findByUid("items",n[e].get("parent"))),k.length&&(g=k.shift()),g&&"section"===g.get("type")&&"tab"!==this.parent.get("type")&&!this.checkParentTab(n[e])&&!this.checkParentTab(this.parent)||this.parent.getId()==n[e].get("parent")){b=n[e];n[e].remove();break}return b},checkParentTab:function(b){var c,g;g=d.CompanySettings.VisualFormEditor.classes.factory.getLayoutStructure();
if(!b.get("parent"))return!1;c=g.findByAttribute("items","item_id",b.get("parent"));0===c.length&&(c=g.findByUid("items",b.get("parent")));if(0===c.length)return!1;b=c.shift();return"tab"===b.get("type")?!0:this.checkParentTab(b)},append:function(b){c.prototype.append.apply(this,arguments);b instanceof d.CompanySettings.VisualFormEditor.models.Field&&b.isLocal()&&d.CompanySettings.VisualFormEditor.classes.factory.getFormElementService().setToFieldCollection(b)},appendAfter:function(b){c.prototype.appendAfter.apply(this,
arguments);b instanceof d.CompanySettings.VisualFormEditor.models.Field&&b.isLocal()&&d.CompanySettings.VisualFormEditor.classes.factory.getFormElementService().setToFieldCollection(b)},appendBefore:function(b){c.prototype.appendBefore.apply(this,arguments);b instanceof d.CompanySettings.VisualFormEditor.models.Field&&b.isLocal()&&d.CompanySettings.VisualFormEditor.classes.factory.getFormElementService().setToFieldCollection(b)},remove:function(b){c.prototype.remove.apply(this,arguments);b instanceof
d.CompanySettings.VisualFormEditor.models.Field&&b.isLocal()&&d.CompanySettings.VisualFormEditor.classes.factory.getFormElementService().removeInFieldCollection(b)},toString:function(){return"Section collection"}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.models.BaseStructureItems;d.ns("toa.CompanySettings.VisualFormEditor.models.collection.structure.MainLayoutItems",d.define(c,function(){c.apply(this,arguments)},{modelConstructor:{tab:d.CompanySettings.VisualFormEditor.models.Section,section:d.CompanySettings.VisualFormEditor.models.Section,marker:d.CompanySettings.VisualFormEditor.models.Marker},load:function(b){var c,d,k=[],l=0;for(d in b)c=b[d].type,this.modelConstructor[c]?(k.length&&(c=new this.modelConstructor.section({order:l,
items:k}),this.add(c,{silent:!0,doNotAutoSort:!0}),l++),k=[],b[d].order=l,this.add(b[d],{silent:!0}),l++):k.push(b[d]);k.length&&(c=new this.modelConstructor.section({order:l,items:k}),this.add(c,{silent:!0,doNotAutoSort:!0}));this.sort({silent:!0});this.notify("load")},wrapItem:function(b){var c;(b instanceof d.CompanySettings.VisualFormEditor.models.Text||b instanceof d.CompanySettings.VisualFormEditor.models.Section)&&b.get("names").each(function(b){b.set({name:""})});return b instanceof d.CompanySettings.VisualFormEditor.models.Field||
b instanceof d.CompanySettings.VisualFormEditor.models.Button||b instanceof d.CompanySettings.VisualFormEditor.models.Text?(c=new d.CompanySettings.VisualFormEditor.models.Section({}),c.append(b,{silent:!0}),c):b},toString:function(){return"Context layout item collection"}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.models.BaseStructureItems;d.ns("toa.CompanySettings.VisualFormEditor.models.collection.structure.ActionPanelButtons",d.define(c,function(){c.apply(this,arguments)},{modelConstructor:{button:d.CompanySettings.VisualFormEditor.models.Button,form:d.CompanySettings.VisualFormEditor.models.Button,action:d.CompanySettings.VisualFormEditor.models.Button},checkModel:function(b){b=c.prototype.checkModel.apply(this,arguments);this.isAllowed()&&this.isNewButton()&&
(b=b.clone());return b},isAllowed:function(b){return b instanceof d.CompanySettings.VisualFormEditor.models.Button&&!b.isFooterButton()},isNewButton:function(b){return!(b.collection instanceof this.constructor)},toString:function(){return"Context layout action collection"}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.models.BaseStructureItems;d.ns("toa.CompanySettings.VisualFormEditor.models.collection.structure.FooterButtons",d.define(c,function(){c.apply(this,arguments)},{modelConstructor:{button:d.CompanySettings.VisualFormEditor.models.Button},toString:function(){return"Context layout footer button collection"}}))})(toa);(function(d){var c=d.models.ObservableCollection;d.ns("toa.CompanySettings.VisualFormEditor.models.collection.ConditionsDictionary",d.define(c,function(){c.apply(this,arguments)},{modelConstructor:d.CompanySettings.VisualFormEditor.models.ConditionDictionary,collectionConditionFields:null,toString:function(){return"ConditionsDictionary model"},load:function(b,c){var d;if(b){for(d in b)-1==this.indexOf(b[d])&&this.add(b[d],{silent:!0,doNotAutoSort:!0});this.notify("load")}}}))})(toa);(function(d){var c=d.models.ObservableCollection;d.ns("toa.CompanySettings.VisualFormEditor.models.collection.TmpConditionsDictionary",d.define(c,function(){c.apply(this,arguments)},{modelConstructor:d.CompanySettings.VisualFormEditor.models.TmpConditionDictionary,collectionConditionFields:null,toString:function(){return"ConditionsDictionary model"},load:function(b){var c;if(b){for(c in b)if(-1==this.indexOf(b[c])){var d=new this.modelConstructor(b[c].getData());"undefined"!==typeof b[c].attributes._dictLink&&
d.setDictionaryIndex(b[c].attributes._dictLink);this.add(d,{silent:!0,doNotAutoSort:!0})}this.notify("load")}}}))})(toa);(function(d){var c=d.models.ObservableCollection;d.ns("toa.CompanySettings.VisualFormEditor.models.collection.Visibilities",d.define(c,function(){c.apply(this,arguments)},{modelConstructor:d.CompanySettings.VisualFormEditor.models.Visibility,collectionConditionFields:null,toString:function(){return"Condition model"},load:function(b){var c;if(b){for(c in b)-1==this.indexOf(b[c])&&this.add(b[c],{silent:!0,doNotAutoSort:!0});this.sort({silent:!0});this.notify("load")}}}))})(toa);(function(d){var c=d.models.ObservableCollection;d.ns("toa.CompanySettings.VisualFormEditor.models.collection.Languages",d.define(c,function(){c.apply(this,arguments)},{modelConstructor:d.CompanySettings.VisualFormEditor.models.Language,toString:function(){return"Fields model"},load:function(b){var c,d=b.length;for(c=0;c<d;c++)-1==this.indexOf(b[c])&&this.add(b[c],{silent:!0,doNotAutoSort:!0});this.sort({silent:!0});this.notify("load")}}))})(toa);(function(d){var c=d.models.ObservableCollection;d.ns("toa.CompanySettings.VisualFormEditor.models.collection.Translations",d.define(c,function(){c.apply(this,arguments)},{modelConstructor:d.CompanySettings.VisualFormEditor.models.Translation,toString:function(){return"Fields model"},load:function(b){for(var c in b)this.add(b[c],{silent:!0,doNotAutoSort:!0});this.sort({silent:!0});this.notify("load")},toJSON:function(){var b=[];this.each(function(c){(c=c.toJSON())&&b.push(c)});return b}}))})(toa);(function(d){var c=d.CompanySettings.VisualFormEditor.models.collection.Translations;d.ns("toa.CompanySettings.VisualFormEditor.models.collection.ValidationMessages",d.define(c,function(){c.apply(this,arguments)},{modelConstructor:d.models.ObservableModel,toString:function(){return"Validation messages collection"}}))})(toa);(function(d){var c=d.models.ObservableCollection;d.ns("toa.CompanySettings.VisualFormEditor.models.collection.GroupedVisibilitiesValue",d.define(c,function(){c.apply(this,arguments)},{modelConstructor:d.CompanySettings.VisualFormEditor.models.GroupedVisibilityValue,collectionConditionFields:null,toString:function(){return"GroupedVisibilitiesValue model"},load:function(b){var c;if(b){for(c in b)-1==this.indexOf(b)&&this.add(b[c],{silent:!0,doNotAutoSort:!0});this.notify("load")}}}))})(toa);(function(d){d.ns("toa.controllers.Dwh",d.define(d.Controller,function(){this._create.apply(this,arguments)},{SERVER_CONTROLLER:"dwh",screenTpl:['<div id="toa-dwh-screen" class="jet-css-only jet-css-only-data-extract"></div>'],metaData:[],newPropertyId:0,invalidSchemaNamePattern:/['"~`\/\\,.\|<>&!@#\$%^\(\)\*\+\=\-\{\}\[\]:;\? ]/g,toString:function(){return"Dwh screen controller"},_create:function(c){this.sandbox=c;this.options=this.sandbox.options;this.setParams(this.options.params);this.isReadWrite=
this.dataParams.isReadWrite;this.currentfile=null;this.container=$((new d.Template(this.screenTpl)).apply({}));this.initModels();this.initViews();this.resume(c.options)},_getTopButtons:function(){var c={xtype:"Button",label:h(11967),name:"dwh_export",id:"dwhExportButton",listeners:{click:function(){download_file("?"+(_DATA.is_mobility_app?["m=dwh","a=export","channel_id="+this.dataParams.channel_id,"itype=manage"]:["controller=dwh","method=export","channel_id="+this.dataParams.channel_id]).join("&"))}.bind(this)}};
return this.isReadWrite?[{xtype:"Button",label:h(11965),name:"add_new",listeners:{click:this.formFile.render.bind(this.formFile,{})}},c,{xtype:"Button",label:h(11966),name:"dwh_import",listeners:{click:this.importForm.render.bind(this.importForm,{})}}]:[c]},createPanelTitle:function(c){this.responseData=c;null!=this.panel&&this.panel.destroy();this.panel=d.view.control.create({xtype:"PanelTitleAlta",name:"title",titleText:h(11968),resourceTreeButton:!1,backButton:!0,backButtonIcon:"",headerResponsive:_DATA.page_label,
backButtonLabel:_DATA.glossary.action_links.company_settings_outbound_channels,backButtonHint:h(16257),filter:!1,calendar:!1,listeners:{backButtonClick:function(){d.app.trigger("layout.menu.click",{label:"company_settings_outbound_channels",url:"",name:_DATA.glossary.action_links.company_settings_outbound_channels,params:{}})}},actions:this._getTopButtons()})},initViews:function(){this.fileList=new d.views.dwh.FileList(this.isReadWrite);this.fileList.setCollection(this.collection);this.fileList.addListener("delete",
this.deleteFileListAction.bind(this));this.fileList.addListener("modify",this.modifyFileListAction.bind(this));this.fileList.addListener("property",this.propertyFileListAction.bind(this));this.formFile=new d.views.dwh.FileForm;this.formFile.addListener("submit",this.submitFileForm.bind(this));this.importForm=new d.views.dwh.ImportForm;this.importForm.addListener("validate",this.validateImportFile.bind(this));this.importForm.addListener("import",this.submitImportFile.bind(this))},initModels:function(){this.collection=
new d.models.ObservableCollection},suspend:function(c){"function"===typeof this.panel.getElement().parent&&this.panel.getElement().parent().children(".header-stripe").remove();this.panel.getElement().detach();this.collection.clear();this.fileList.destroy();this.observer.disconnect()},request:function(c,b){var d=$.Deferred();b=$.extend(b,{channel_id:this.dataParams.channel_id});this.sandbox.trigger("global.data.get",{controller:this.SERVER_CONTROLLER,method:c,params:b||{},responseHandler:function(b,
c){c.status&&"OK"===c.status?d.resolve(c):d.reject(c)}.bind(this)});return d.promise()},_renderViews:function(c){this.fileList.setIsReadWrite(this.isReadWrite);this.panel.setOption("titleText",this.dataParams.name);this.fileList.setType(this.dataParams.type);this.formFile.setType(this.dataParams.type);this.panel.render(this.container);this.fileList.render(this.container,!0);c.content.append(this.container);this.sandbox.trigger("layout.tabs.set",{tabs:0,show:0})},resume:function(c){this.setParams(c.params);
this.isReadWrite=this.dataParams.isReadWrite;this.request("getScreenInfo").then(this.createPanelTitle.bind(this)).then(this._renderViews.bind(this,c)).then(this.responseResume.bind(this));this.checkCollaborationOpened()},setParams:function(c){this.dataParams={channel_id:0,name:h(11968),type:this.constructor.CONFIG_TYPE.DWH,isReadWrite:!1};for(var b in this.dataParams)c&&void 0!==c[b]&&(this.dataParams[b]=c[b])},responseResume:function(){this.metaData=this.responseData.meta;this.formFile.setEntityList(this.metaData.lookups.entities);
this.updateList(this.responseData)},deleteFileListAction:function(c,b){d.ui.Confirm({text:h(11988),acceptButtonHandler:function(){this.request("deleteFile",{file:b}).then(this.updateList.bind(this))}.bind(this)})},modifyFileListAction:function(c,b){this.formFile.render($.extend(b.toJSON(),{type:this.dataParams.type}))},propertyFileListAction:function(c,b){var e=this,g=this.collection.get(b),k=g.get("entity"),l=this.metaData.lookups.entity_fields[k],n={type:"textbox",value:"name",width:150,ariaLabel:h(11977),
generator:function(b){return this.metaData.lookups.entity_fields[k][b]||b}.bind(this)},p=this._getSelectedFields(g);this.isSchemaBased()&&(n.validator=this.validateProperty.bind(this),n.generator=function(b){return this.generateSchemaName(this.metaData.lookups.entity_fields[k][b]||b)}.bind(this),n.observer=function(b){for(var c="dbaas"===e.dataParams.type?29:30,d=b.target.value,g=e._getByteLength(d);g>c;)d=d.substr(0,d.length-1),g=e._getByteLength(d);b.target.value=d});var s=new d.views.dwh.PropertyMultiSelect({title:h(11985),
width:550,height:500,editOptions:{sortable:!0,sortField:"order",editable:{props:["name"],propsToValidate:["name"],fields:{label:{type:"label",value:h(11977)},name:n}}},data:{all:l,selected:p},buttons:[{text:h(14621),position:"left",click:function(){s.destroy();s=null},id:"multiselectCancelBtn"},{text:h(12252),type:"submit",position:"right",click:function(b){if(s.validate()){b=s.getSelectedObject();if(this.isSchemaBased()){var c=this._checkForValidationErrors(b,k);if(c)return s.setError(c),!1}this.submitPropertyForm(b,
g,s)}}.bind(this),id:"multiselectSubmitBtn"}]})},_checkForValidationErrors:function(c,b){var d=[],d=[];if(0<(d=this.checkForDuplicates(c)).length)return r(20786,{"{COMMA_SEPARATED_COLUMN_NAMES}":d.join(", ")});if(0<(d=this.mandatoryCheck(c,b)).length){var g=this.metaData.lookups.entity_fields[b];return r(20787,{"{COMMA_SEPARATED_COLUMN_NAMES}":d.map(function(b){return g[b]}).join(", ")})}return 1E3<c.length?h(21131):!1},checkForDuplicates:function(c){var b={};return c.reduce(function(c,d){b[d.name]&&
c.push(d.name);b[d.name]=!0;return c},[])},mandatoryCheck:function(c,b){var d;this.metaData.lookups.mandatory_fields&&(d=(d=this.metaData.lookups.mandatory_fields[b]||!1)&&c.reduce(function(b,c){var d;-1!=(d=b.indexOf(c._id))&&b.splice(d,1);return b},d.slice(0)));return d||[]},submitPropertyForm:function(c,b,e){if(JSON.stringify(b.get("property"))===JSON.stringify(c))return e.destroy(this),!1;for(var g in c)c[g].label=c[g].label||c[g]._id,delete c[g].file_id,delete c[g].original_name,delete c[g]._id;
c=d.utils.json.encode(c);this.request("setProperty",{property:c,file_id:b.get("id")}).then(function(b){this.updateList(b);e.destroy(this)}.bind(this)).fail(function(b){b.errorForm&&e.setError(b.errorForm)}.bind(this))},submitFileForm:function(c,b){var d=[];this.collection.each(function(c){b.id!==c.get("id")&&c.get("name")==b.name&&d.push(h(11841))});d.length?this.formFile.setErrorMessages(d):this.request(0<parseInt(b.id)?"updateFile":"insertFile",{form:b}).then(function(b){this.updateList(b);this.formFile.closeForm();
b.newFileId&&this.propertyFileListAction("",b.newFileId)}.bind(this)).fail(function(b){b.errorForm&&this.formFile.setErrorMessages(b.errorForm)}.bind(this))},validateProperty:function(c){var b=!1;if(!c)b=h(19722);else if(!this._validateSchemaName(c)||30<this._getByteLength(c.length))b=h(19723);return{status:!b,message:b}},_validateSchemaName:function(c){return!c.match(this.invalidSchemaNamePattern)},_getSelectedFields:function(c){var b=c.get("property")||[];if(0==b.length&&this.metaData.lookups.mandatory_fields){var d=
this.metaData.lookups.mandatory_fields[c.get("entity")]||[];c=this.metaData.lookups.entity_fields[c.get("entity")];for(var g in d)b.push({label:d[g],name:this.generateSchemaName(c[d[g]]||d[g])})}b.forEach(function(b){b._id=b.label});return b},generateSchemaName:function(c){var b="dbaas"===this.dataParams.type?29:30;c=c.trim().replace(/[\s|\.]+/g,"_").replace(this.invalidSchemaNamePattern,"").toUpperCase();for(var d=this._getByteLength(c);d>b;)c=c.substr(0,c.length-1),d=this._getByteLength(c);return c},
isSchemaBased:function(){return this.dataParams.type!==this.constructor.CONFIG_TYPE.DWH},_getByteLength:function(c){var b=encodeURIComponent(c).match(/%[89ABab]/g);return c.length+(b?b.length:0)},updateList:function(c){c=c.fileList||[];0!=c.length?$("#dwhExportButton").show():($("#dwhExportButton").hide(),this.isReadWrite||$(".company_settings_dwh-menu").hide());this.collection.clear();for(var b in c){b=c[b];var d=this.metaData.lookups.entities[b.entity];b.entity_name=d?d.text:b.entity;this.collection.add(b)}},
validateImportFile:function(c,b){b.channel_id=this.dataParams.channel_id;this.request("validateFile",b).then(function(b){b.importForm.validationLogs&&this.importForm.setValidationLogs(b.importForm.validationLogs,this.dataParams.type)}.bind(this))},submitImportFile:function(c,b){b.channel_id=this.dataParams.channel_id;this.request("importFile",b).then(function(b){this.importForm.showImportSuccess();this.updateList(b)}.bind(this)).fail(function(b){b.importForm.validationLogs&&this.importForm.setValidationLogs(b.importForm.validationLogs,
this.dataParams.type)}.bind(this))},checkCollaborationOpened:function(){var c=document.getElementById("content-manage-container");this.observer=new MutationObserver(this.checkContainerWidth.bind(this));this.observer.observe(c,{attributes:!0})},checkContainerWidth:function(c){if("attributes"===c[0].type){var b=$("#toa-dwh-screen");app.ui.collaborationScreenResizeHelper.adjustOutboundContainerWidth(b,c)}}},{CONFIG_TYPE:{DWH:"dwh",BICS:"bics",DBAAS:"dbaas"},READ_ONLY:1}))})(toa);(function(d){d.ns("toa.views.dwh.FileForm",d.define(null,function(){var c='<div id="toa-dwh-form-file">;<div class="toa-formrow">;<div class="formLabel">;<label id="<%=getDomId("entityLabId")%>"><%-h(11970)%>:</label>;</div>;<div class="formField">;<% if (entity == "") { %>;<select aria-labelledby="<%-getDomId("entityLabId")%>" name="entity">;<% for(ett in entityList) {%>;<option value="<%-ett%>"><%-entityList[ett].text %></option>;<% } %>;</select>;<% } else {%>;<%-entityList[entity].text%>;<% }%>;</div>;</div>;<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%=getDomId("nameReqId")%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>">*</abbr>;<label id="<%=getDomId("nameLabId")%>"><%-h(19711)%></label>;</div>;<div class="formField">;<input aria-labelledby="<%=getDomId("nameReqId")+" "+getDomId("nameLabId")%>" aria-required="true" required type="text" value="<%-name%>" name="name"/>;</div>;</div>;<% if ( id && type !== "dwh") { %>;<div class="toa-formrow">;<div class="formNote">;<% if (type === "dbaas") { %>;<%- h(21120)%>;<%} else if (type === "bics") { %>;<%- h(22913)%>;<% }%>;</div>;</div>;<% }%>;<% if (type !== "dwh") { %>;<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%=getDomId("synReqId")%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>">*</abbr>;<label id="<%=getDomId("syncLabId")%>"><%-h(20790 /* Data transfer */)%></label>;</div>;<div class="formField" id="sync-mode">;</div>;</div>;<div class="toa-formrow">;<div id="preloadRequiredMessage" class="formNote hidden">;</div>;</div>;<% }%>;</div>'.split(";");
this.compileSyncTpl=(new d.Template('<% if (Object.keys(params).length >1) { %>;<select aria-labelledby="<%=getDomId("synReqId")+" "+getDomId("syncLabId")%>" name="realtime_enabled">;<% for(key in params) {%>;<option value="<%-key%>" <%- key==value ? "selected" :"" %>><%-params[key] %></option>;<% } %>;</select>;<% } else {%>;<input type="hidden" name="realtime_enabled" value="<%- Object.keys(params)[0]%>"/> ;<%-params[Object.keys(params)[0]]%>;<% }%>'.split(";"))).compile();this.compileForm=(new d.Template(c)).compile();
this._domId={};delete c},$.extend({},d.mixins.EventEmitter,{SYNC_MODE:{DAILY_ONCE:1,REALTIME:2},invalidSchemaNamePattern:/['"~`\/\\,.\|<>&!@#\$%^\(\)\*\+\=\-\{\}\[\]:;\? ]/g,_fields:["id","entity","name","realtime_enabled"],_prepareData:function(c){for(var b=[],d=0;d<this._fields.length;d++){var g=this._fields[d];b[g]=c&&void 0!==c[g]?c[g]:""}return b},getDomId:function(c){void 0===this._domId[c]&&(this._domId[c]=generate_id());return this._domId[c]},setEntityList:function(c){this.entityList=c},setType:function(c){this.type=
c},isSchemaBased:function(){return"dwh"!==this.type},initEvents:function(){var c=this;this.form.find('[name="entity"]').off().on("change",function(){c.isSchemaBased()&&c._updateSyncTpl.call(c,this.value);var b=this.value.toUpperCase().substring(0,30);c.form.find('[name="name"]').val(b)});this.isSchemaBased()&&this.form.find('[name="name"]').on("input",this.validateTableNameByteSize.bind(this))},render:function(c){this.isSubmissionInProgress=!1;if(!this.form){this.data=this._prepareData(c);this.form=
$(this.compileForm.apply($.extend(this._prepareData(c),{entityList:this.entityList,syncModeList:this._syncModeList,type:this.type,getDomId:this.getDomId.bind(this)})));this.initEvents();var b=this.data.entity||this.form.find('[name="entity"]').val(),e=this.form.find('[name="name"]').val(),g=b.toUpperCase().substring(0,30);this.form.find('[name="name"]').val(e||g);this.isSchemaBased()&&this._updateSyncTpl(b);this.popup=new d.ui.Popup({onClose:this.closeForm.bind(this)});this.popup.setContent(this.form);
this.popup.setButtons([{text:h(11947),position:"right",click:this.closeForm.bind(this)},{text:h(11948),type:"submit",position:"right",click:function(){this.submitFormButton()}.bind(this)}]);this.popup.show();this.popup.setPositionCenter();$(window).on("keydown",function(b){13==b.keyCode&&this.submitFormButton()}.bind(this))}c&&c.id?(this.id=c.id,this.popup.setTitle(h(11986))):this.popup.setTitle(h(11987));return this.form},_isFormChanged:function(c){if(!this.data.id)return!0;var b=this.data;return this._fields.reduce(function(d,
g){return d||c[g]!=b[g]},!1)},getFormValue:function(){for(var c={},b=0;b<this._fields.length;b++){var d=this._fields[b],g=$.trim(this.form.find('[name="'+d+'"]').val());g||void 0===this.data[d]||(g=this.data[d]);c[d]=g}return c},submitFormButton:function(){if(this.isSubmissionInProgress)return!1;var c=this.getFormValue();this.validateForm(c)&&(this._isFormChanged(c)?(this.isSubmissionInProgress=!0,this.notify("submit",c)):this.closeForm())},validateTableNameByteSize:function(c){for(var b=c.target.value,
d=this._getByteLength(b);30<d;)b=b.substr(0,b.length-1),d=this._getByteLength(b);b!=c.target.value&&(c.target.value=b)},_getByteLength:function(c){var b=encodeURIComponent(c).match(/%[89ABab]/g);return c.length+(b?b.length:0)},_validateTableName:function(c){return!c.match(this.invalidSchemaNamePattern)},_updateSyncTpl:function(c){var b={},d=this.entityList[c].mode;c=this.entityList[c].preload_required&&!this.data.realtime_enabled;d&this.SYNC_MODE.DAILY_ONCE&&(b[0]=h(20791));d&this.SYNC_MODE.REALTIME&&
(b[1]=h(20792));this.form.find("#sync-mode").html(this.compileSyncTpl.apply({params:b,value:0!=this.data.realtime_enabled?1:0,getDomId:this.getDomId.bind(this)}));preloadMessageText=c?h(20793):"";this.form.find("#preloadRequiredMessage").text(preloadMessageText);this.form.find('[name="realtime_enabled"]').on("change",function(b){this.form.find("#preloadRequiredMessage").toggleClass("hidden","0"===b.currentTarget.value)}.bind(this))},validateForm:function(c){var b=[];""==c.name?b.push(h(11993)):!this.isSchemaBased()&&
0<c.name.indexOf("/")&&b.push(h(11877));this.isSchemaBased()&&!this._validateTableName(c.name)&&b.push(h(19746));this.setErrorMessages(b);return 0==b.length},setErrorMessages:function(c){var b,d=[];for(b=0;b<c.length;b++)d.push({id:b+1,message:c[b]});this.isSubmissionInProgress=!1;this.popup.setErrors(d)},closeForm:function(){this.destroy()},destroy:function(){this.popup.destroy();this.form=null;$(window).off("keydown")}})))})(toa);(function(d){d.ns("toa.views.dwh.FileList",d.define(null,function(c){this.isReadWrite=c;c=['<div id="toa-dwh-filelist"></div>'];this.compileFileList=(new d.Template(c)).compile();delete c;this.content=$(this.compileFileList.apply())},$.extend({},d.mixins.EventEmitter,{_mainTpl:['<div class="data-extract-container">','<div class="container" id="data-row-body"></div>',"</div>"],_rowTpl:'<div class="data-extract-row data-<%-type%>">;<div class="data-extract-column data-col-first">;<div class="data-col-half data-image data-<%-type%>-icon"></div>;<div class="data-col-half data-col-title">;<% if(isReadWriteAccess){ %>;<label role="link" class="data-link-label data-title" id="<%= rowId %>" tabindex="0"><%- entity_name%></label>;<% } else { %>;<label class="data-title" id="<%= rowId %>" tabindex="0"><%- entity_name%></label>;<% } %>;<section class="data-labels-each">;<label class="data-field-label"><%- h(15006 /* Fields */ )%>:</label>;<label class="data-field-val"><%= property ?  property.length : 0%></label>;</section>;</div>;</div>;<div  class="data-extract-column data-stats-list">;<%= renderStats("name", name) %>;<%= renderStats("realtime_enabled", realtime_enabled) %>;<%= renderStats("status", last_run_status.status) %>;<%= renderStats("last_time", last_run_status.last_run) %>;<% if(realtime_enabled == 2) { %>;<div class = "infoMessage"><%= h(20793 /* Real time data transfer will be available the next day */) %></div>;<% } %>;</div>;<div class="data-extract-column data-stats data-content-justify">;<% if(last_run_status.rows_updated) { %>;<div class="stat-text  stats-positive"><%- last_run_status.rows_updated %></div>;<div class="stat-label"><%= h(20794 /* Rows updated */) %></div>;<div class="stat-label"><%= realtime_enabled ? h(20795 /* Last 24 Hours */):""%></div>;<% } %>;</div>;<% if(supportRealTime){ %>;<div class="data-extract-column data-stats data-content-justify">;<% if(last_run_status.rows_skipped) { %>;<div class="stat-text"><%- last_run_status.rows_skipped %></div>;<div class="stat-label"><%= h(20796 /* Rows Skipped */)%></div>;<div class="stat-label"><%= realtime_enabled ? h(20795 /* Last 24 Hours */):""%></div>;<% } %>;</div>;<% } %>;<div class="data-extract-column data-stats">;<% if( (parseInt(last_run_status.rows_skipped) > 0) && (realtime_enabled == 1) && (last_run_status.status.toLowerCase() !== "failed")) { %>;<div class="stat-text data-warn-icon"></div>;<div class="stat-label"><%= h(20797 /* Retry in progress */)%></div>;<% } else if( (last_run_status.status.toLowerCase() === "completed") && (realtime_enabled != 1) ) { %>;<div class="stat-icon data-positive-icon"></div>;<div class="stat-label"><%= h(20798 /* Completed Successfully */)%></div>;<% }  else if(last_run_status.status.toLowerCase() === "failed") { %>;<div class="stat-icon data-error-icon"></div>;<div class="stat-label"><%= h(13136 /* Failed */)%></div>;<% }%>;</div>;<% if(isReadWriteAccess){ %>;<div class="data-extract-column data-col-menu">;<div role="button" aria-haspopup="true" aria-labelledby="<%= rowId %>" tabindex=0 class="data-field-settings" data-file-id="<%=id%>"></div>;</div>;<% } %>;</div>'.split(";"),
_statsTpl:'<section class="data-labels-each">;<label class="data-field-label"><%- title %>:</label>;<label class="data-field-val" name="<%- label%>" title="<%- value %>">;<%- value  %>;</label>;</section>'.split(";"),_settingTpl:'<div class="data-settings-menu" tabindex="-1">;<div role="link" tabindex="0" class="data-settings-row" data-action="property">;<%- h(15006)%>;</div>;<div role="link" tabindex="0" class="data-settings-row" data-action="delete">;<%- h(13071)%>;</div>;</div>'.split(";"),_initView:function(){var c=
$((new d.Template(this._mainTpl)).compile().apply());this.content.append(c);c=c.find("#data-row-body");this.collection.addListener("add",$.proxy(this._add,this,c));this.collection.addListener("reset",$.proxy(this._reset,this,c));this.row=(new d.Template(this._rowTpl)).compile();this.stats=(new d.Template(this._statsTpl)).compile();this.settingsTpl=(new d.Template(this._settingTpl)).compile()},_add:function(c,b,d){b=$(this.row.apply($.extend(d.toJSON(),{renderStats:this.renderStats.bind(this),supportRealTime:"dwh"!=
this.type,type:this.type,rowId:generate_id(),isReadWriteAccess:this.isReadWrite})));c.append(b);var g=b.find(".data-field-settings");c=this._openSettings.bind(this,d.get("id"));this._triggerActionOnEnterKey(g,c);g.on("click",c);g.on("keypress",c);c=$.proxy(this.notify,this,"modify",d);d=b.find(".data-title");this.isReadWrite&&(this._triggerActionOnEnterKey(d,c),d.on("click",c))},_reset:function(c){c.empty()},_triggerActionOnEnterKey:function(c,b){c.on("keydown",function(c){if(13==c.which)return b.call(this,
c),!1})},setCollection:function(c){this.collection=c;this._initView()},setType:function(c){this.type=c},setIsReadWrite:function(c){this.isReadWrite=c},render:function(c,b){b||c.empty();c.append(this.content)},renderStats:function(c,b){if(void 0!==b){var e={title:c,value:b,label:c};switch(c){case "name":e.title="dwh"==this.type?h(19714):h(19711);break;case "realtime_enabled":if("dwh"==this.type)return"";e.title=h(20790);e.value=e.value?h(20792):h(20791);break;case "status":e.title=h(19715);e.value=
this._getStatusText(b);break;case "last_time":if("0"==b)return"";e.title=h(19713);var g=d.app.model("companySettings").getUser().dateFormats.date_time;e.value=d.date.formatDate(g,new Date(1E3*b))}return this.stats.apply(e)}return""},_getStatusText:function(c){switch(c.toLowerCase()){case "new":return h(19741);case "in progress":return h(19742);case "completed":return h(19743);case "failed":return h(19744)}return""},_openSettings:function(c,b){if("keypress"!==b.type||13===b.keyCode){this.settingsList||
this._initTip();var d=$(b.target);this.settingsList.data("id",c);this.settingsList.Tip("showAt",b.target,"left");this.settingsList.focus();this.settingsList.Tip("option","onHide",function(){d.focus()})}},_initTip:function(){this.settingsList=$(this.settingsTpl.apply());this.settingsList.Tip({minWidth:160,minHeight:80,height:80,width:160,zIndex:2020});var c=function(b){b=$(b.currentTarget).data("action");void 0!==b&&b&&(this.settingsList.Tip("hide"),this.notify(b,this.settingsList.data("id")))}.bind(this);
this._triggerActionOnEnterKey(this.settingsList.find(".data-settings-row"),c);this.settingsList.on("click",".data-settings-row",c);this.settingsList.Tip("option","callout",{side:"right",position:10})},destroy:function(){this.settingsList&&(this.settingsList.Tip("destroy"),this.settingsList.empty(),this.settingsList=null)}})))})(toa);(function(d){d.ns("toa.views.dwh.PropertyList",d.define(null,function(){var c='<div id="toa-dwh-property">;<div class="propertyList">;<div class="propertyListHeader">;<h2 class="pwt__title"><%-h(11975)%></h2>;</div>;<div class="content"></div>;<button class="button"><%-h(11976)%></button>;</div>;<div class="propertyName"></div>;<div class="propertyFooter">;<button class="toa-button discard"><%-h(11947)%></button>;<button class="toa-button toa-button-active submit"><%-h(11948)%></button>;</div>;</div>'.split(";"),
b='<div>;<% if(error) { %>;<div class="toa-formrow">;<div class="error"><%-error%></div>;</div>;<% } %>;<% if(dwhEnabled) { %>;<div class="toa-formrow">;<% if(!readonly) { %>;<div class="formLabel"><label id="<%-pnId%>"><%-h(11977)%>:</label></div>;<div class="formField"><input aria-labelledby="<%-pnId%>" value="<%-propertyName%>" type="input" name="propertyName" /></div>;<% } %>;</div>;<% } %>;<% if(columnNameEnabled) { %>;<div class="toa-formrow">;<% if(!readonly) { %>;<div class="formLabel"><label id="label_<%-bcId%>"><%-h(19730)%>:</label></div>;<div class="formField"><input aria-labelledby="label_<%-bcId%>" <% if(field_id > 0) { %>aria-describedby="desc_<%-bcId%>"<% } %> value="<%-bicsColumn%>" maxlength=30 type="input" name="bicsColumn" /> <%-h(21121)%></div>;<% if(field_id > 0) { %>;<div class="formNote" id="desc_<%-bcId%>"><%- h(19731)%></div>;<% } %>;<% } %>;</div>;<% } %>;<div class="toa-formrow">;<div class="formLabel"><%-h(11978)%>:</div>;<div class="formField"><%-originalName%></div>;</div>;<div class="toa-formrow">;<div class="formLabel"><%-h(11979)%>:</div>;<div class="formField"><%-source%></div>;</div>;</div>'.split(";"),
e=["<div>","<div class=\"property_name <%= error ? 'error' : '' %>\"><%-name%></div>",'<span role="link" class="actionLink add_property"><%-h(11980)%></span>','<span role="link" class="actionLink delete_property"><%-h(972)%></span>',"</div>"],g=['<div class="error">','<%-r(19745,{"{COUNT}" : count})%>',"</div>"];this.compileProperty=(new d.Template(c)).compile();this.compilePropertyItem=(new d.Template(e)).compile();this.compilePropertyName=(new d.Template(b)).compile();this.compilePropertyError=
(new d.Template(g)).compile();delete c;delete e;delete b;delete g},$.extend({},d.mixins.EventEmitter,{readonlyProperty:{},render:function(){var c;this.content=$(this.compileProperty.apply());this.propertyNameList=this.content.find(".propertyName");this.propertyNameList.on("input","input",function(b){var d=this.selectedRow.field_id;for(c=0;c<this.property.length;c++)if(this.property[c].field_id==d){var g=$(b.target);if("propertyName"===g[0].name){this.property[c].name=g.val();break}else if("bicsColumn"===
g[0].name){this.property[c].bics_column=g.val();break}}}.bind(this));this.content.find(".discard").on("click",function(){this.propertyNameList.empty();this.notify("discard")}.bind(this));this.content.find(".submit").on("click",function(){this.propertyNameList.empty();this.notify("submit",this.property)}.bind(this));this.content.find(".propertyList .button").on("click",function(){this.notify("append")}.bind(this));this.initPropertyList();this.removeForm()},getContent:function(){return this.content},
initPropertyList:function(){this.fieldsList=d.view.control.create({xtype:"SortableList",name:"property-list",rows:[],disabled:!1,sortableOptions:{},listeners:{rowClick:function(c,b){this.propertyNameList.empty();this.selectedRow&&(this.selectedRow.selected=!1);this.selectedRow=b.row;var d=$(b.originalEvent.target),g=d.closest("li");this.selectedItem=g;b.source.element.find("li").removeClass("selected");g.addClass("selected");b.row.selected=!0;d.hasClass("add_property")&&this.notify("append",{position:parseInt(b.position)+
1,property:this.property});d.hasClass("add_empty")&&this.notify("empty",{position:parseInt(b.position)+1});d.hasClass("delete_property")?this.notify("delete",{position:b.position,property:this.property}):(d=0,"undefined"!=typeof this.readonlyProperty&&"undefined"!=typeof this.readonlyProperty[b.row.label]&&(d=1),this.propertyNameList.append(this.compilePropertyName.apply({propertyName:b.row.name,bicsColumn:b.row.bics_column||"",originalName:b.row.original_name,source:b.row.label,readonly:d,field_id:b.row.field_id,
dwhEnabled:this.dwhEnabled,columnNameEnabled:this.bicsEnabled||this.dbaasEnabled,error:b.row.error||!1,pnId:generate_id(),bcId:generate_id()})),this.content.find('input[name="bicsColumn"]').on("input",this.validateColumnNameByteSize.bind(this)))}.bind(this),formatHelper:function(c,b){var d=b.originalElement.clone();d.addClass("toa-dwh-property-drag-helper");d.appendTo(b.originalElement.parent());return d},formatRow:function(c,b){var d,g=b.row.field_id;for(d=0;d<this.property.length;d++)if(this.property[d].field_id==
g){this.property[d].order=b.index;break}return this.compilePropertyItem.apply({name:b.row.original_name,error:b.row.error||!1})}.bind(this),renderItem:function(c,b){if(!0==b.row.selected){b.item.addClass("selected");var d=0;"undefined"!=typeof this.readonlyProperty&&"undefined"!=typeof this.readonlyProperty[b.row.label]&&(d=1);this.propertyNameList.empty().append(this.compilePropertyName.apply({propertyName:b.row.name,bicsColumn:b.row.bics_column||"",originalName:b.row.original_name,source:b.row.label,
field_id:b.row.field_id,readonly:d,dwhEnabled:this.dwhEnabled,columnNameEnabled:this.bicsEnabled||this.dbaasEnabled,error:b.row.error||!1,pnId:generate_id(),bcId:generate_id()}));this.selectedItem=b.item;this.selectedRow=b.row;b.row.selected=!1;this.content.find('input[name="bicsColumn"]').on("input",this.validateColumnNameByteSize.bind(this))}}.bind(this),reorder:function(c,b){b.row.selected=!0}}})},validateColumnNameByteSize:function(c){for(var b=c.target.value,d=this._getByteLength(b);30<d;)b=
b.substr(0,b.length-1),d=this._getByteLength(b);b!=c.target.value&&(c.target.value=b)},_getByteLength:function(c){var b=encodeURIComponent(c).match(/%[89ABab]/g);return c.length+(b?b.length:0)},drawPropertyList:function(c){this.property=c;this.fieldsList.setOption("rows",this.property);this.fieldsList.render("#toa-dwh-property .content")},showErrorMessage:function(c){this.propertyNameList.empty().append(this.compilePropertyError.apply({count:c}))},setReadonlyProperty:function(c){this.readonlyProperty=
c},setBicsEnabled:function(c){this.bicsEnabled=c},setDbaasEnabled:function(c){this.dbaasEnabled=c},setDwhEnabled:function(c){this.dwhEnabled=c},removeForm:function(){this.propertyNameList.empty()},getProperty:function(){return this.property},destroy:function(){this.compilePropertyName=this.compilePropertyItem=this.compileProperty=null;this.propertyNameList.off("input","input");this.content=this.propertyNameList=null;this.content.find(".discard").off("click");this.content.find(".submit").off("click");
this.content.find(".propertyList .button").off("click");this.fieldsList.destroy()}})))})(toa);(function(d){d.ns("toa.views.dwh.PropertyForm",d.define(null,function(){var c='<form name="property-select" id="toa-dwh-property-file">;<div class="toa-formrow">;<div class="formField"><input aria-label="<%-h(13745)%>" type="text" value="" name="file_name"/></div>;</div>;<p><%-h(11983)%>:</p>;<div class="property-unselect"></div>;<p><%-h(11984)%>:</p>;<div class="property-select">;<ul class="property-list"></ul>;</div>;</form>'.split(";"),b='<ul class="property-list">;<% for(property in propertyList) { %>;<li>;<label>;<input type="checkbox" name="property[]" value="<%-property%>" />;<div>;<b><%-propertyList[property] %></b>;<br/>;<%-property%>;</div>;</label>;</li>;<% } %>;</ul>'.split(";");
this.compileForm=(new d.Template(c)).compile();this.compilePropertyUnselect=(new d.Template(b)).compile();delete c;delete b},$.extend({},d.mixins.EventEmitter,{propertyList:[],render:function(){if(!this.form){this.form=$(this.compileForm.apply());var c=this.form.find("input");this.propertyUnselect=$(this.compilePropertyUnselect.apply({propertyList:this.getPropertyList(c.val())}));this.containerPropertyUnSelect=this.form.find(".property-unselect");this.containerPropertyUnSelect.append(this.propertyUnselect);
this.selectList=this.form.find(".property-select .property-list");this.unselectList=this.form.find(".property-unselect .property-list");c.on("input",function(b){b=$(b.currentTarget);for(var c=this.selectList.find("input"),d={},k=0;k<c.length;k++)d[c[k].value]=1;b=$(this.compilePropertyUnselect.apply({propertyList:this.getPropertyList(b.val(),d)}));this.containerPropertyUnSelect.empty().append(b)}.bind(this));c.on("keydown",function(b){return 13==b.keyCode?(b.stopPropagation(),!1):!0});this.form.on("click",
"input",function(b){var c=$(b.currentTarget).closest("li");b.currentTarget.checked?this.selectList.append(c):this.unselectList.append(c);this.popup.setPositionCenter()}.bind(this));$(window).on("keydown",function(b){if(13==b.keyCode){var c=this.getFormValue();this.notify("submit",c);b.stopPropagation();return!1}return!0}.bind(this));this._initPopup()}},_initPopup:function(){this.popup=new d.ui.Popup({onClose:this.closeForm.bind(this)});this.popup.setContent(this.form);this.popup.setTitle(h(11985));
this.popup.setButtons([{text:h(11947),position:"right",click:function(){this.closeForm()}.bind(this)},{text:h(11948),type:"submit",position:"right",click:function(){var c=this.getFormValue();this.notify("submit",c)}.bind(this)}]);this.popup.show();this.popup.setPositionCenter()},getFormValue:function(){var c=[],b,d;d=this.form.get(0).elements;for(b=0;b<d.length;b++)d[b].checked&&c.push($(d[b]).val());return c},setPropertyList:function(c){this.propertyList=c},getPropertyList:function(c,b){var d={},
g;if(!c&&!b)return this.propertyList;var k=RegExp(c,"i");for(g in this.propertyList)b[g]||c&&!(this.propertyList[g]&&-1<this.propertyList[g].search(k)||-1<g.search(k))||(d[g]=this.propertyList[g]);return d},closeForm:function(){this.destroy()},destroy:function(){this.popup.destroy();$(window).off("keydown");this.form=null}})))})(toa);(function(d){d.ns("toa.views.dwh.ImportForm",d.define(null,function(){var c='<div id="toa-dwh-import-file">;<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%=generate_id()%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>">*</abbr>;<label id="<%=generate_id()%>"><%-h(11982)%>:</label></div>;<div class="formField"></div>;</div>;</div>'.split(";"),b='<table class="import_log_table">,<% for(var entity in log) { %>,<% if (entity !== "XML") { %>,<tr class="iLog_section">,<th class="iLog_title import_entity_name" colspan="4">,<%= entity %>,</th>,</tr>,<% } %>,<% for(var i in log[entity]) { %>,<% var file = log[entity][i]; %>,<tr class="iLog_section">,<th class="iLog_title iLog_invalid" colspan="4" tabindex="0"><%= file.name %>,<span class="iLog_status" tabindex="0">,<% if(!file.isImportable){ %>,<% if(entity !== "XML") { %> <%= notImportedMessage %>,<% } else { %>,<%= h(22909 /*Data will not be Imported*/) %><% } %>,<% } %>,</span>,</th>,</tr>,<% for(var j in file.log) { %>,<% var logItem = file.log[j]; %>,<tr class="iLog_msg">,<td class="status_icon_<%=logItem.type.toLowerCase()%>"></td>,<td class="iLog_msg_content" tabindex="0"><%= logItem.message %></td>,<td class="iLog_line_title" tabindex="0"><%= logItem.lineNumber ? h(18907)/* Line */ : "" %></td>,<td class="iLog_line" tabindex="0"><%= logItem.lineNumber ? logItem.lineNumber : "" %></td>,</tr>,<% } %>,<% } %>,<% } %>,</table>'.split(",");
this.importForm=(new d.Template(c)).compile();this.validationStatus=new d.Template('<div class="import_popup import_user_types">,<div class="title_row">,<div class="import_count import_title">,<span class = "wrap_content_for_progress">,<%= h(13295)/*Import*/ %>,</span>,<span class="progress_box"></span>,</div>,<div class="validation_count validation_title">,<span class = "wrap_content_for_progress">,<%= h(13296)/*Validation*/ %>,</span>,<span class="progress_box"></span>,</div>,<div class="item_title"><%= h(18905)/*Results*/ %></div>,</div>,<div class="content">,<div class="success_row" tabindex="0">,<div class="import_count"><span>&nbsp;</span></div>,<div class="validation_count"><span><%= successCount %></span></div>,<div class="item_title"><%= h(13297)/*Successfully imported*/ %></div>,</div>,<div class="warnings_row" tabindex="0">,<div class="import_count"><span>&nbsp;</span></div>,<div class="validation_count"><span><%= warningCount %></span></div>,<div class="item_title"><%= h(13298)/*Imported with warnings*/ %></div>,</div>,<div class="not_imported_row" tabindex="0">,<div class="import_count"><span>&nbsp;</span></div>,<div class="validation_count"><span><%= errorCount %></span></div>,<div class="item_title"><%= h(13299)/*Not imported*/ %></div>,</div>,<div class="import_log_section">,<div class="import_log_header"><a class="import_log_toggle"><%= h(18906)/*Validation Details*/ %></a></div>,<div class="import_log_container">,<div class="import_log"></div>,</div>,</div>,</div>,</div>'.split(","));
this.validationLog=new d.Template(b);delete c;delete importStatusTemplate;delete b},$.extend({},d.mixins.EventEmitter,{entityList:[],render:function(){if(this.content)return this.content;this.content=$(this.importForm.apply());this.currentAction="validate";this.importFile=new d.view.uploadFile(this.content.find(".formField"));this.importFile.render("configurate");this.popup=new d.ui.Popup({onClose:this.closeForm.bind(this)});this.popup.setContent(this.content);this.popup.setTitle(h(11966));this.popup.setButtons([{text:h(13305),
position:"right",click:this.closeForm.bind(this)},{id:"validate_btn",text:h(12099),type:"submit",position:"right",click:this.submitFormButton.bind(this)},{id:"import_btn",text:h(13295),type:"submit",position:"right",display:!1,click:this.startImport.bind(this)}]);this.popup.show();this.popup.setPositionCenter();$(window).on("keydown",function(c){13==c.keyCode&&("validate"===this.currentAction&&this.submitFormButton(),"import"===this.currentAction&&this.startImport(),$(this.importFile.fileForm[0]).blur())}.bind(this));
return this.content},getFormValue:function(){return{file:this.importFile.getFile()}},submitFormButton:function(){var c=this.getFormValue();this.validateForm(c)&&this.notify("validate",c)},startImport:function(){values=this.getFormValue();this.notify("import",values)},validateForm:function(c){c=[];window.FileReader||c.push("File API is not supported on your browser.");"text/xml"!=this.importFile.getFileType()&&c.push(h(11994));this.setErrorMessages(c);return 0==c.length},setErrorMessages:function(c){for(var b=
[],d=0;d<c.length;d++)b.push({id:d+1,message:c[d]});this.popup.setErrors(b)},setValidationLogs:function(c,b){var d=c.XML;d.name=this._getFileName();c.XML=[d];var g="dwh"===b?h(22910):h(22911);this._switchButtons(d.isImportable);this._showValidationStatus(c,g)},showImportSuccess:function(){this.content.find(".warnings_row .import_count").addClass("status_icon_success");this.content.find(".success_row .import_count").addClass("status_icon_success");this.content.addClass("import_popup_imported");this.popup.displayNoneButton("import_btn")},
_switchButtons:function(c){this.popup.displayNoneButton("validate_btn");!0==c&&this.popup.displayInlineButton("import_btn");this.currentAction=c?"import":""},_getFileName:function(){filePath=$('input[type="text"]',this.content).val();return fileName=filePath.split("\\").pop()},_showValidationStatus:function(c,b){var d=c.XML[0].filesWithErrors,g=c.XML[0].isImportable;this.content=$(this.validationStatus.apply({errorCount:d,warningCount:c.XML[0].filesImportableWithWarnings,successCount:c.XML[0].filesImportable}));
this.popup.setContent(this.content);this.popup.setPositionCenter();this._showValidationLogs(c,b);this.content.find(".not_imported_row").toggleClass("red_warning",0<d);this.content.toggleClass(".import_popup_validated ",g)},_showValidationLogs:function(c,b){this.validationLogContainer=this.content.find(".import_log");this.validationLogContainer.empty().html(this.validationLog.apply({log:c,notImportedMessage:b}));this.validationLogContainer.closest(".import_log_section").addClass("opened");$(".import_log_toggle",
this.content).on("click",this._toggleValidationLog.bind(this))},_toggleValidationLog:function(c){$(c.target).closest(".import_log_section").toggleClass("opened")},closeForm:function(){this.destroy()},destroy:function(){this.popup.destroy();$(window).off("keydown");this.content=null}})))})(toa);(function(d){var c=d.widgets.MultiselectOptionDialog;d.ns("toa.views.dwh.PropertyMultiSelect",d.define(c,function(b){this.errorTpl=(new d.Template(this._errorTpl)).compile();delete this._errorTpl;this._addEventListner(b);c.apply(this,arguments)},{_errorTpl:'<div class="inline-error"><%- error%></div>',_addEventListner:function(b){b=b.editOptions.editable.fields;for(var c in b){var d=b[c].observer;d&&"function"===typeof d&&(this.events["keyup .prop-"+c]=d)}},_updateItems:function(b){var d=this.itemsChosen,
g=this._options.editOptions.editable.fields;c.prototype._updateItems.apply(this,arguments);if("add"==b)for(var k=0;k<d.length;k++){var l=d[k]._id,n=this.collection.selectedIds.indexOf(l);if(-1!=n)for(var p in g){var s=g[p].value,t=g[p].generator;t&&"function"==typeof t&&(this.collection.selected[n][s]=this.collection.selected[n][s]||t(l))}}},validate:function(){var b=0;if(this._options.editOptions.editable)for(var c=this._options.editOptions.editable.propsToValidate,d=this._options.editOptions.editable.fields,
k=0;k<this.collection.selected.length;k++)for(var l=$(this.dialog._dom.base).find(".multiselectRow")[k],n=0;n<c.length;n++){var p=c[n],s=$(l).find(".prop-"+p).val();(p=d[p].validator)&&"function"===typeof p&&(s=p(s),$(l).find(".multiselectTemplate .inline-error").remove(),!0!==s.status&&(b++,$(l).find(".multiselectTemplate").append(this.errorTpl.apply({error:s.message}))))}this.setError("");return 0===b},_getFilterContent:function(b){return(new d.Template('<div class="multiselectSearch" role="search"><i class="searchIcon"></i><input aria-label="<%= h(7746/* Search */) %>" class="multiselectSearchInput" ><a class="clearSearchButton hidden"></a></div><div class="multiselectListSection"><div class="multiselectFilterCont multiselectRowContainer"><%for(var item in items) {%><div class="multiselectRow propertyItem"><input id="cbFilterable-<%- item %>" class="multiselectFilterable" type="checkbox" <% if (selectedIds.length > 0 && selectedIds.indexOf(item) != -1) {%>checked="checked"<% } %>><label for="cbFilterable-<%- item %>"><div class="multiselectLabel"><b><%- items[item] %></b><br/><%- item %></div></label></div><% } %></div></div>')).compile().apply({items:b.collection,
selectedIds:this.collection.selectedIds||[]})},setError:function(b){$(this.dialog._dom.base).find(".multiselectAddContainer .multiErrorMessage").addClass("propertyErrorMessage").html(b);$(this.dialog._dom.base).find(".popup-content").scrollTop(0)}}))})(toa);(function(d){var c=d.views.BaseForm;d.ns("toa.views.dwh.SchedulerForm",d.define(c,function(b){c.apply(this,arguments);this.isReadWrite=b},$.extend({},d.mixins.EventEmitter,{popup:null,timePicker:null,events:{'change [name="isAutomatic"]':"isAutoToggleListener"},_fields:["isAutomatic","start_time","time_zone"],validators:[{selector:'[name="time_zone"]',rules:["mandatory"]},{selector:"#dwhStartTime",rules:["mandatoryTimePicker"]}],template:['<div id="toa-dwh-start-time-form">','<div class="toa-formrow">',
'<div class="formLabel">','<abbr id="requiredIsAutomatic" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>"><i>*</i></abbr>','<label id="lblIsAutomatic"><%-h(21140)%></label>',"</div>",'<div class="formField">','<input aria-labelledby="requiredIsAutomatic lblIsAutomatic" aria-required="true" required type="checkbox" <%= is_automatic ? checked="checked" : ""%>  name="isAutomatic"/>',"</div>","</div>",'<div class="toa-formrow">','<div class="formLabel">','<abbr id="requiredStartTime" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>"><i>*</i></abbr>',
'<label id="lblStartTime"><%-h(21141)%> </label>',"</div>",'<div class="formField" id="dwhStartTime">',"</div>","</div>",'<div class="toa-formrow">','<div class="formLabel">','<abbr id="requiredTimeZone" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>"><i>*</i></abbr>','<label id="lblTimeZone"><%-h(21142)%></label>',"</div>",'<div class="formField">','<select aria-labelledby="requiredTimeZone lblTimeZone" name="time_zone">',"<% for(var tzId in available_timezone) {%>",'<option value="<%-tzId%>" <% if (tzId == time_zone) {%> selected="selected"  <% } %>>',
"<%-available_timezone[tzId] %>","</option>","<% } %>","<select>","</div>","</div>",'<div class="toa-formrow">','<div class="formNote">',"*<%-h(21145)%>",,"</div>",'<div class="formNote">',"**<%-h(21143)%>","</div>","</div>","</div>"],isAutoToggleListener:function(b){this._toggleAutomaticMode(b.target.checked)},_toggleAutomaticMode:function(b){var c=this._$el.find('[name="time_zone"]');b?(this.timePicker.disable(),c.prop("disabled",!0)):(this.timePicker.enable(),c.prop("disabled",!1))},_disableFields:function(){var b=
this._$el.find('[name="time_zone"]');this._$el.find('[name="isAutomatic"]').prop("disabled",!0);this.timePicker.disable();b.prop("disabled",!0)},setDataModel:function(b){this.model=b},mandatoryTimePickerFieldValidate:function(){var b=[this.timePicker.getHours(),this.timePicker.getMinutes()].join(":"),c="";""===$.trim(b)&&(c=h(15905));return c},render:function(){this.isSubmissionInProgress=!1;this._createPopup();this.form||(c.prototype.render.call(this,$(this.popup.getDomContent())),this._renderTimePicker(this.model.get("start_time"),
this.getElement().find("#dwhStartTime")));this._toggleAutomaticMode(this.model.get("is_automatic"));this.isReadWrite||this._disableFields();this.popup.show();this.popup.setPositionCenter()},_renderTimePicker:function(b,c){this.timePicker=new d.formBuilder({xtype:"timePicker",attr:{"aria-labelledby":"requiredStartTime lblStartTime"},items:[{xtype:"select",attr:{"aria-labelledby":"requiredStartTime lblStartTime"}},{xtype:"select",attr:{"aria-labelledby":"requiredStartTime lblStartTime"}}]});this.timePicker.renderTo(c);
this.timePicker.setValue(b);this.timePicker.enable()},_createPopup:function(){this.popup=new d.ui.Popup({onClose:this.closeForm.bind(this)});this.popup.setTitle(h(21144));this.popup.setContent(this.form);this.isReadWrite&&this.popup.setButtons([{text:h(11947),position:"right",click:this.closeForm.bind(this)},{text:h(11948),type:"submit",position:"right",click:this.submitFormButton.bind(this)}])},_isFormChanged:function(b){var c=this.model.toJSON();return this._fields.reduce(function(d,k){return d||
b[k]!==c[k]},!1)},submitFormButton:function(){if(this.isSubmissionInProgress)return!1;var b=this._getFormValue();this._validateForm(b)&&(this._isFormChanged(b)?(this.isSubmissionInProgress=!0,this.notify("submit",b)):this.closeForm())},_validateForm:function(b){return b.is_automatic?!0:this.validate()},_getFormValue:function(){var b=this._$el.find('[name="isAutomatic"]').is(":checked");return{is_automatic:b,start_time:b?0:[this.timePicker.getHours(),this.timePicker.getMinutes()].join(":"),time_zone:b?
0:this._$el.find('[name="time_zone"]').val()}},setErrorMessages:function(b){var c,d=[];for(c=0;c<b.length;c++)d.push({id:c+1,message:b[c]});this.isSubmissionInProgress=!1;this.popup.setErrors(d)},closeForm:function(){this.destroy()},destroy:function(){this.isSubmissionInProgress=!1;this.clear();this.popup.destroy();this.timePicker&&this.timePicker.destroy();this.form=null;$(window).off("keydown")}})))})(toa);(function(d){d.ns("toa.controllers.OutboundChannels",d.define(d.Controller,function(){this._create.apply(this,arguments)},{SERVER_CONTROLLER:"outboundchannel",toString:function(){return"Outbound Channel screen controller"},_create:function(c){this.sandbox=c;this.content=c.options.content;this.screen=$((new d.Template('<div id="toa-outbound-channel-screen" class="jet-css-only"></div>')).apply({}));this._initModels();this.resume(c.options)},_getTopButtons:function(){var c={xtype:"Button",label:h(21141),
name:"dwh_start_time",listeners:{click:function(){this.startTimeSchedulerForm.render()}.bind(this)}};return this.isReadWrite?[c,{xtype:"Button",label:h(22901),name:"new_outbound_config",listeners:{click:function(){this.channelConfigForm.render()}.bind(this)}}]:[c]},_createPanelTitle:function(){this.panel=d.view.control.create({xtype:"PanelTitleAlta",name:"title",titleText:_DATA.glossary.action_links.company_settings_outbound_channels,resourceTreeButton:!1,backButton:!0,backButtonIcon:"",headerResponsive:_DATA.page_label,
backButtonLabel:_DATA.glossary.action_links.company_settings_configuration,backButtonHint:h(16257),filter:!1,calendar:!1,listeners:{backButtonClick:function(){$app.navigation().redirect("company_settings_configuration")}},actions:this._getTopButtons()})},_renderViews:function(){this.panel.render(this.screen);this.cardView.render(this.screen,!0)},_initModels:function(){this.channelsCollection=new d.models.outboundChannels.collection;this.startTimeSchedulerModel=new d.models.ObservableModel},_setConfigData:function(c){this.isReadWrite=
c.access>this.constructor.READ_ONLY;this.configData=c;this.channels=c.channels;this.isStartTimeSchedulePresent="start_time_schedule"in c;this.startTimeSchedule=c.start_time_schedule;this.availableTimeZone=c.available_time_zone;this.applicationModels=[]},_initViews:function(){this.channelConfigForm=new d.views.outboundChannels.configForm(this.channels);this.channelConfigForm.addListener("channel:test",this.testChannel.bind(this));this.channelConfigForm.addListener("channel:save",this.saveChannel.bind(this));
this.cardView=new d.views.outboundChannels.cardView({model:this.channelsCollection,isReadWriteAccess:this.isReadWrite});this.cardView.addListener("channel:click",this.drillView.bind(this));this.cardView.addListener("channel:delete",this.deleteChannel.bind(this));this.cardView.addListener("channel:modify",function(c,b){this.channelConfigForm.render(b.get("access"))}.bind(this));this.cardView.addListener("channel:retry",this.retryChannel.bind(this));this.startTimeSchedulerForm=new d.views.dwh.SchedulerForm(this.isReadWrite);
this.startTimeSchedulerForm.addListener("submit",this.submitStartTimeForm.bind(this))},drillView:function(c,b){var d=b.get("type"),g=b.get("id"),k="application"!==b.get("type")?"company_settings_dwh":"company_settings_applications";"ocx"===d?(this.suspend(),$app.navigation().redirect("apps-connector/"+g)):"knowledge"===d?(this.suspend(),$app.navigation().redirect("outbound-knowledge/"+g+"/"+b.get("name"))):this.sandbox.trigger("layout.menu.click",{label:k,url:"",name:b.get("name"),params:{channel_id:g,
name:b.get("name"),type:d,isReadWrite:this.isReadWrite,appId:b.attributes.access.client_id}})},deleteChannel:function(c,b){self=this;var e=b.get("type"),g=h(22924);if(-1!==["bics","dbaas","oac"].indexOf(e)){var k=b.get("stats");0<parseInt(k.config_count||0)&&(g=h(22922,{"{COUNT}":k.config_count}))}if("ics"===e&&0<b.get("access").fusion_integration_count)return new d.ui.Popup({title:h(5332),autoOpen:!0,html:h(23023),modal:!0,buttons:[{text:h(12252),type:"submit",position:"right",click:function(){this.destroy()}}]});
d.ui.Confirm({text:g,acceptButtonHandler:function(){self.request("deleteChannel",{channel:b.get("access")}).done(function(b){self.updateScreen(b)})}.bind(this)})},retryChannel:function(c,b){self=this;d.ui.Confirm({text:h(23024),acceptButtonHandler:function(){self.request("reActivateChannel",{channel:b.get("access")}).done(function(b){self.updateScreen(b)})}.bind(this)})},createModel:function(c,b){return new ({dwh:d.models.outboundChannels.DwhModel,bics:d.models.outboundChannels.BicsModel,oac:d.models.outboundChannels.OacModel,
dbaas:d.models.outboundChannels.DbaasModel,ics:d.models.outboundChannels.IcsModel,ocx:d.models.outboundChannels.OcxModel,application:d.models.outboundChannels.ApplicationsModel,knowledge:d.models.outboundChannels.KnowledgeModel}[c]||d.models.outboundChannels.baseModel)(b)},request:function(c,b){var d=$.Deferred();this.sandbox.trigger("global.data.get",{controller:this.SERVER_CONTROLLER,method:c,params:b||{},responseHandler:function(b,c){c.status&&"OK"===c.status?d.resolve(c):d.reject(c)}.bind(this)});
return d.promise()},updateScreen:function(c){this.channelsCollection.clear();c.channels.forEach(function(b){var c=this.createModel(b.type,b);this.channelsCollection.add(c,b.id)}.bind(this));"start_time_schedule"in c&&this.updateStartTimeSchedulerModel(c);this.channelConfigForm.updateChannelCollection(c.channels)},updateStartTimeSchedulerModel:function(c){this.startTimeSchedulerModel.set($.extend(c.start_time_schedule,{available_timezone:c.available_time_zone},{}));this.startTimeSchedulerForm.setDataModel(this.startTimeSchedulerModel)},
saveChannel:function(c,b){var d=[],g=this;if(!g.isValidChannel(b,d))return g.channelConfigForm.setErrorMessages(d),!1;g.request(0<b.id?"modifyChannel":"createChannel",{channel:b}).done(function(b){g.channelConfigForm.destroy();g.updateScreen(b)}).fail(function(b){b.errorMessages&&g.channelConfigForm.setErrorMessages(b.errorMessages)})},testChannel:function(c,b){var d=this;d.request("testChannel",b).done(function(b){d.channelConfigForm.setTestMessage(b.success,b.message)}).fail(function(b){b.errorMessages&&
d.channelConfigForm.setErrorMessages(b.errorMessages)})},isValidChannel:function(c,b){var d=0==c.id;this.channelsCollection.each(function(g){!d&&g.get("id")==c.id||c.name.toLowerCase()!=g.get("name").toLowerCase()||b.push(h(20781));"application"===c.type&&g.attributes.access&&c.appId===g.attributes.access.client_id&&b.push(h(20397))});return 0==b.length},submitStartTimeForm:function(c,b){this.request("updateStartTimeSchedule",{form:b}).then(function(b){this.updateScreen(b);this.startTimeSchedulerForm.closeForm()}.bind(this)).fail(function(b){this.startTimeSchedulerForm.setErrorMessages(b.errorForm||
[])}.bind(this))},suspend:function(c){this.channelsCollection.clear();this.panel.getElement().detach();this.screen.empty();this.observer.disconnect()},resume:function(c){this.request("load").done(this._setConfigData.bind(this)).done(this._initViews.bind(this)).done(this.updateScreen.bind(this),this.configData).done(this._createPanelTitle.bind(this)).done(this._renderViews.bind(this));this.content.empty().append(this.screen);this.sandbox.trigger("layout.tabs.set",{tabs:0,show:0});this.checkCollaborationOpened()},
checkCollaborationOpened:function(){var c=document.getElementById("content-manage-container");this.observer=new MutationObserver(this.checkContainerWidth.bind(this));this.observer.observe(c,{attributes:!0})},checkContainerWidth:function(c){if("attributes"===c[0].type){var b=$("#toa-outbound-channel-screen");app.ui.collaborationScreenResizeHelper.adjustOutboundContainerWidth(b,c)}},destroy:function(){this.suspend()}},{READ_ONLY:1}))})(toa);(function(d){var c=d.models.ObservableModel;d.ns("toa.models.outboundChannels.baseModel",d.define(c,function(b){c.apply(this,arguments)},{_availableActions:{edit:{action:"edit",labelId:19136},delete:{action:"delete",labelId:19137},retry:{action:"retry",labelId:21137}},enabledActions:[],hasDrillDown:!0,description:function(){return""},getChannelInfo:function(){return{title:this.get("name"),type:this.get("type"),status:this.getStatus(),description:this.description(),stats:this.calculateStats(),channel:this.get("access"),
hasData:this.hasData(),hasDrillDown:this.hasDrillDown,actions:this.getActions(),exceedsRetryLimit:this.checkExceedRetryLimit()}},checkExceedRetryLimit:function(){var b=this.get("stats");return b&&!0===b.exceeds_max_retry},getStatus:function(){var b=this.get("stats"),c=h(20782),d=!0;b&&(d=""===b.status,c=!1===d?b.status:0<parseInt(b.config_count)&&!b.last_updated?h(20784):this.dateToTimeSince(1E3*parseInt(b.last_updated)));return{active:d,text:c}},calculateStats:function(){return this.get("stats")},
dateToTimeSince:function(b){b=Math.floor(((new Date).getTime()-b)/1E3);var c=h(13113),d=Math.floor(b/60);1<=d&&(b=d,c=h(18828));d=Math.floor(d/60);1<=d&&(b=d,c=h(18827));return r(20785,{"{TIME_QUANTITY}":b,"{TIME_UNIT}":c})},hasData:function(){var b=this.get("stats");return b&&!(0<parseInt(b.config_count)&&!b.last_updated&&""===b.status)},getActions:function(){var b=[],c=this,d=this.get("stats");d&&!0===d.exceeds_max_retry&&b.push(c._availableActions.retry);c.enabledActions.forEach(function(d){d=
c._availableActions[d];void 0!==d&&b.push(d)});return b}}))})(toa);(function(d){var c=d.models.outboundChannels.baseModel;d.ns("toa.models.outboundChannels.BicsModel",d.define(c,function(b){c.apply(this,arguments)},{enabledActions:["edit","delete"],description:function(){return h(19701)},calculateStats:function(){var b=this.get("stats");if(!b||null===b.last_updated||""!==b.status)return!1;var c=parseInt(b.total_rows||0),b=parseInt(b.skipped_rows||0);if(isNaN(c)||isNaN(b))return!1;c=0!==c+b?Math.floor(c/(c+b)*100):0;b=[];b[h(20788)]=h(22912,{"{VALUE}":c});return b}}))})(toa);(function(d){var c=d.models.outboundChannels.baseModel;d.ns("toa.models.outboundChannels.IcsModel",d.define(c,function(b){c.apply(this,arguments)},{enabledActions:["edit","delete"],hasDrillDown:!1,description:function(){return h(22917)},calculateStats:function(){var b=this.get("stats");if(!b)return!1;var c=parseInt(b.total_events_read||0),b=parseInt(b.total_events_sent||0);if(isNaN(c)||isNaN(b)||0===c)return!1;c=0!==c?Math.floor(b/c*100):0;b=[];b[h(20788)]=h(22912,{"{VALUE}":c});return b},getStatus:function(){var b=
this.get("stats"),c="";b&&(c=0===parseInt(b.total_events_read||0)?h(20784):this.dateToTimeSince(1E3*parseInt(b.last_updated)));return{active:!0,text:c}},hasData:function(){var b=this.get("stats");return 0!==parseInt(b.total_events_read||0)}}))})(toa);(function(d){var c=d.models.outboundChannels.baseModel;d.ns("toa.models.outboundChannels.DwhModel",d.define(c,function(b){c.apply(this,arguments)},{getStatus:function(){var b=this.get("stats"),c={active:!0,text:h(22915)};if(b&&0<parseInt(b.config_count)&&!b.last_updated)c.text=h(20784);else if(b)return!1;return c},calculateStats:function(){var b=this.get("stats");if(!b||!b.last_updated)return!1;var c=d.app.model("companySettings").getUser().dateFormats.date_time,c=d.date.formatDate(c,new Date(1E3*
b.last_updated)),g=[];g[h(19713)]=c;g[h(21627)]=b.total_rows;g[h(19715)]=h(13135);return g}}))})(toa);(function(d){var c=d.models.outboundChannels.baseModel;d.ns("toa.models.outboundChannels.DbaasModel",d.define(c,function(b){c.apply(this,arguments)},{enabledActions:["edit","delete"],description:function(){return h(21122)},getChannelInfo:function(){var b=c.prototype.getChannelInfo.apply(this);this.get("access")&&d.views.outboundChannels.DbaasConfigForm.CONNECTION_TYPE.DIRECT===this.get("access").connectUsing&&(b.warning=h(21128));return b},calculateStats:function(){var b=this.get("stats");if(!b||
null===b.last_updated||""!==b.status)return!1;var c=parseInt(b.total_rows||0),b=parseInt(b.skipped_rows||0);if(isNaN(c)||isNaN(b))return!1;c=0!==c+b?Math.floor(c/(c+b)*100):0;b=[];b[h(20788)]=h(22912,{"{VALUE}":c});return b}}))})(toa);(function(d){var c=d.models.outboundChannels.baseModel;d.ns("toa.models.outboundChannels.OcxModel",d.define(c,function(b){c.apply(this,arguments)},{enabledActions:["edit","delete","retry"],description:function(){return h(20153)},getStatus:function(){var b="",c="";this.hasDrillDown=this.get("access")&&!1!==this.get("access").integrationValidated&&!1!==this.get("status");!1!==this.get("status")||this.get("integrationValidated")?!1===this.get("status")&&this.get("integrationValidated")?(c=!1,b=h(19542)):
"running"===this.get("status")?(c=!0,b=h(19548)):"failed"===this.get("status")&&(c=!1,b=h(21149)):(c=!1,b=h(20575));return{active:c,text:b}},calculateStats:function(){if("completed"===this.get("status")){var b={};b[h(19715)]=h(15076);var c=d.app.model("companySettings").getUser().dateFormats.date_time,g=new Date(parseInt(this.get("stats").lastUpdated));b[h(13135)]=d.date.formatDate(c,g);b.displayStatsAsList=!0;return b}}}))})(toa);(function(d){var c=d.models.outboundChannels.BicsModel;d.ns("toa.models.outboundChannels.OacModel",d.define(c,function(b){c.apply(this,arguments)},{description:function(){return h(19749)}}))})(toa);(function(d){var c=d.models.outboundChannels.baseModel;d.ns("toa.models.outboundChannels.ApplicationsModel",d.define(c,function(b){c.apply(this,arguments)},{enabledActions:["delete"],hasDrillDown:!0,calculateStats:function(){var b={};b[h(21003)]=this.get("access").client_id;b[h(19715)]="active"===this.get("access").status?h(15076):h(11493);b.displayStatsAsList=!0;return b},getStatus:function(){return{active:this.attributes.access.stats,text:this.attributes.access.statsMsg?h(this.attributes.access.statsMsg):
""}},hasData:function(){return!1}}))})(toa);(function(d){var c=d.models.outboundChannels.baseModel;d.ns("toa.models.outboundChannels.KnowledgeModel",d.define(c,function(b){c.apply(this,arguments)},{enabledActions:["edit","delete"],hasDrillDown:!0,description:function(){return h(21150)},calculateStats:function(){var b={};b[h(19715)]=this.get("stats").status?this.get("stats").status:"";b.displayStatsAsList=!0;return b},getStatus:function(){this.get("stats")}}))})(toa);(function(d){var c=d.models.ObservableCollection;d.ns("toa.models.outboundChannels.collection",d.define(c,function(){c.apply(this,arguments)},{update:function(b){},getTitles:function(){}}))})(toa);(function(d){d.ns("toa.views.outboundChannels.cardItem",d.define(null,function(c,b){this.isReadWriteAccess=b;this.model=c;this._mainTemplate=(new d.Template(this.template)).compile();this._statsTemplate=(new d.Template(this.statsTemplate)).compile();this._statsListTemplate=(new d.Template(this.statsListTemplate)).compile();this.settingsTpl=(new d.Template(this.settingsTemplate)).compile();this.settingsRowTpl=(new d.Template(this.settingsRow)).compile()},$.extend({},d.mixins.EventEmitter,{template:'<div class="card-item <% if(!hasDrillDown) { %> disable-click<% }%>" role="gridcell">;<div class="card-item-header">;<div id="<%- cardId %>" class="card-title" role="link" tabindex="0">;<%- title %>;</div>;<div class="card-description">;<%- description %>;</div>;</div>;<% if (exceedsRetryLimit) { %>;<div class="card-message">;<div class="message-header">;<div class="error-image"></div>;<div class="error-message"><%- h( 21135 /* Error */) %></div>;</div>;<div class="message-content">;<%- h(21136 /* Host unreachable. Please check your credentials and then try again*/ ) %>;</div>;<div class="message-action">;<% for (var index in actions) { %>;<div class="message-action-link" role="link" tabindex="0" data-action="<%- actions[index].action %>">;<%- h(actions[index].labelId) %>;</div>;<% } %>;</div>;</div>;<% } else { %>;<div class="card-details">;<% if(stats) { %>;<div class="card-logo">;<div class="data-<%- type %>-icon"></div>;</div>;<div class="card-stats  data-<%- type %>-text" tabindex="0">;<%= renderStatsFn(stats) %>;</div>;<% } else if(!hasData) { %>;<div class="card-logo no-data">;<div class="data-<%- type %>-icon"></div>;</div>;<% } else { %>;<div class="card-logo inactive">;<div class="data-<%- type %>-icon"></div>;</div>;<% } %>;</div>;<div class="card-item-status">;<div class="status-text">;<% if (status) { %>;<div  role="status" class="<%- status.active ? "":"error" %>"><%- status.text %></div>;<% }%>;<% if (typeof warning !== "undefined" && warning) { %>;<div class="error" role="status"><%- warning %></div>;<% }%>;</div>;<% if (isReadWriteAccess) { %>;<div class="menu">;<% if(actions.length !== 0) { %>;<button role="menuitem" class="settings" aria-labelledby="<%- cardId %>" aria-haspopup="true"></button>;<% }%>;</div>;<% }%>;</div>;</div>;<% }%>'.split(";"),
statsTemplate:['<div class="card-stats-column <%- statsClass %>">','<div class="stat-text"><%- value%></div>','<div class="stat-label"><%- label%></div>',"</div>"],statsListTemplate:['<div class="card-stats-row">','<div class="stat-label"><%- label%></div>','<div class="stat-text"><%- value%></div>',"</div>"],settingsTemplate:['<div class="data-settings-menu" role="menu" tabindex="-1">',"<%= getSettings() %>","</div>"],settingsRow:['<div role="menuitem" tabindex="0" class="data-settings-row settings-row-<%-action%>" data-action="<%- action %>">',
"<%- h(labelId) %>","</div>"],getStatsClass:function(c){return c?(c=parseInt(c.substring(0,c.length-1)),100<=c?"card-stat-ok":50>c?"card-stat-error":"card-stat-warn"):""},getContnent:function(){this.content||(this.content=$(this._mainTemplate.apply($.extend(this.model.getChannelInfo(),{renderStatsFn:this.renderStats.bind(this),cardId:generate_id(),isReadWriteAccess:this.isReadWriteAccess}))),this.model.hasDrillDown&&this._bindClickAndEnter(this.content,$.proxy(this.notify,this,"next")),this._bindClickAndEnter(this.content.find(".settings"),
this._openSettings.bind(this,this.model.get("id"))),this._bindClickAndEnter(this.content.find(".message-action-link"),this._triggerAction.bind(this,this.model.get("id"))));return this.content},renderStats:function(c){var b="",d=2<Object.keys(c).length;c.displayStatsAsList&&(d=!0,delete c.displayStatsAsList);for(var g in c){var k={label:g,value:c[g]};d?b+=this._statsListTemplate.apply(k):(k.statsClass=this.getStatsClass(c[g]),b+=this._statsTemplate.apply(k))}return b},_bindClickAndEnter:function(c,
b){c.click(b);c.on("keydown",function(c){if(13==c.which)return b.call(this,c),!1})},_triggerAction:function(c,b){var d=$(b.currentTarget).data("action");(d=void 0!==d&&d)&&this.notify(d,c);b.stopPropagation();return d},_openSettings:function(c,b){this.settingsList||this._initTip();this.settingsList.data("id",c);this.settingsList.Tip("showAt",b.target,"left");$(".data-settings-menu").focus();b.stopPropagation()},_initTip:function(){this.settingsList=$(this.settingsTpl.apply({getSettings:this.getSettings.bind(this)}));
var c=40*this.model.getActions().length;this.settingsList.Tip({minWidth:160,minHeight:45,height:c,width:160,zIndex:2020});this.settingsList.on("click",".data-settings-row",function(b,c,d){this._triggerAction(this.settingsList.data("id"),b)&&this.settingsList.Tip("hide")}.bind(this));this.settingsList.on("keypress",".data-settings-row",function(b,c,d){("keypress"!==b.type||13===b.keyCode)&&this._triggerAction(this.settingsList.data("id"),b)&&this.settingsList.Tip("hide")}.bind(this));this.settingsList.Tip("option",
"callout",{side:"right",position:10})},getSettings:function(){for(var c="",b=this.model.getActions(),d=0;d<b.length;d++)c+=this.settingsRowTpl.apply(b[d]);return c},destroy:function(){this.settingsList&&(this.settingsList.Tip("destroy"),this.settingsList.empty(),this.settingsList=null);this.content=null}})))})(toa);(function(d){d.ns("toa.views.outboundChannels.cardView",d.define(null,function(c){var b='<div id="toa-channel-cardView">;<div class="card-section">;        <div class="card-type-header applications-header header-hidden"><%-h(20263)%></div>;        <div class="card-list applications-card-list">;        </div>;        <div class="card-type-header rest-applications-header header-hidden"><%-h(20277)%></div>;        <div class="card-list rest-applications-card-list">;        </div>;</div>;</div>'.split(";");
this.content=$((new d.Template(b)).compile().apply());delete b;this.isReadWrite=c.isReadWriteAccess;c.model&&this.setModel(c.model)},$.extend({},d.mixins.EventEmitter,{_childItems:[],_initModel:function(){this.model.addListener("add",this._addCard.bind(this));this.model.addListener("reset",this.destroy.bind(this))},_addCard:function(c,b){var e=new d.views.outboundChannels.cardItem(b,this.isReadWrite);e.addListener("edit",$.proxy(this.notify,this,"channel:modify",b));e.addListener("next",$.proxy(this.notify,
this,"channel:click",b));e.addListener("delete",$.proxy(this.notify,this,"channel:delete",b));e.addListener("retry",$.proxy(this.notify,this,"channel:retry",b));this._childItems[b.get("id")]=e;"application"===b.get("type")?(this.content.find(".rest-applications-header").removeClass("header-hidden"),this.content.find(".rest-applications-card-list").append(e.getContnent())):(this.content.find(".applications-header").removeClass("header-hidden"),this.content.find(".applications-card-list").append(e.getContnent()))},
setModel:function(c){if(!c instanceof d.models.ObservableCollection)throw Error("Model should be instance of ObservableCollection"+c);this.model=c;this._initModel()},render:function(c,b){b||c.empty();c.append(this.content)},destroy:function(){this._childItems.length=0;this.content.find(".card-list").html("");this.content.find(".card-type-header").addClass("header-hidden")}})))})(toa);(function(d){d.ns("toa.views.outboundChannels.configForm",d.define(null,function(c){this._channelsCollection=c;this._create.apply(this,arguments)},$.extend({},d.mixins.EventEmitter,{_views:{},_create:function(c){c='<div id="toa-channel-config-form">;<div class="toa-formrow">;<div class="formLabel">;<label id="<%=getDomId("channelTypeLabId")%>"><%- h(22914 /*Channel Type*/) %></label>;</div>;<div class="formField">;<% if (ChannelType == "") { %>;<select aria-labelledby="<%=getDomId("channelTypeLabId")%>" name="channels">;<% for(channel in channelList) {%>;<option value="<%-channel%>"><%-channelList[channel].title %></option>;<% } %>;<% } else {%>;<%-channelList[ChannelType].title%>;<% }%>;</select>;</div>;</div>;<div class="toa-formrow">;<div class="formNote">;<label id="description"></label>;</div>;</div>;<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%=getDomId("nameReqId")%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>">*</abbr>;<label id="<%=getDomId("nameLabId")%>"><%- h(21038 /*Application Name*/)  %></label>;</div>;<div class="formField">;<input aria-labelledby="<%=getDomId("nameReqId")%> <%=getDomId("nameLabId")%>" required type="text" value="<%-name%>"  name="name"/>;</div>;</div>;<div id="channelForm"></div>;<div class="toa-formrow">;<div id="testAck" role="status"></div>;</div>;</div>'.split(";");
this._initAllChildViews();this.compileForm=(new d.Template(c)).compile();this._domId={};delete c},_initAllChildViews:function(){this._childViews={ics:{title:h(22917),class:d.views.outboundChannels.IcsConfigForm,hasTestConnection:!1,description:h(20826)},oac:{title:h(19749),class:d.views.outboundChannels.OacConfigForm,hasTestConnection:!0,description:h(20809)},dbaas:{title:h(21122),class:d.views.outboundChannels.DbaasConfigForm,hasTestConnection:!0,description:h(20819)},bics:{title:h(19701),class:d.views.outboundChannels.BicsConfigForm,
hasTestConnection:!0,description:""},application:{title:h(19506),class:d.views.outboundChannels.ApplicationConfigForm,hasTestConnection:!1,description:h(20199)},ocx:{title:h(20153),class:d.views.outboundChannels.OCXConfigForm,hasTestConnection:!0,description:h(20165)},knowledge:{title:h(21150),class:d.views.outboundChannels.KnowledgeConfigForm,hasTestConnection:!1,description:h(19750)}}},_createChildView:function(c){if(!this._views[c]){var b=this._childViews[c]["class"];if("ocx"===c){var d=this._channelsCollection.filter(function(b){return"ics"===
b.type}),g=this._channelsCollection.find(function(b){return"ocx"===b.type});this._views[c]=new b(d,g)}else"knowledge"===c?(d=this._channelsCollection.find(function(b){return"knowledge"===b.type}),this._views[c]=new b(d)):this._views[c]=new b}return this._views[c]},render:function(c){var b=this;b.model=c;b.isSubmissionInProgress=!1;b._activeType=c&&c.type;b.form=$(b.compileForm.apply({channelList:this._childViews,name:c&&void 0!==c.name?c.name:"",ChannelType:b._activeType||"",getDomId:this.getDomId.bind(this)}));
b.popup=new d.ui.Popup({width:"480px",onClose:b.closeForm.bind(b)});b.popup.setContent(b.form);c=c&&0<c.id?h(22935):h(22901);b.popup.setTitle(c);b.popup.setButtons([{text:h(19707),position:"right",click:b.closeForm.bind(b)},{id:"testConnectionButton",text:h(19708),position:"right",click:function(){b.testConnection()}.bind(b)},{text:h(19709),type:"submit",position:"right",click:b.submitFormButton.bind(b)}]);b.popup.show();c=b.form.find("[name=channels]");var e=b.form.find("#channelForm");this._switchView(b._activeType||
c.val(),e);c.on("change",function(){b._switchView($(this).val(),e)})},getDomId:function(c){void 0===this._domId[c]&&(this._domId[c]=generate_id());return this._domId[c]},_switchView:function(c,b){this._activeType=c;this._setTestConnectionButton(this._childViews[c].hasTestConnection);this._setChannelDescription(this._childViews[c].description);this.addListenersToView();b.html(this._createChildView(this._activeType).render(this.model));this._clearTestMessage();this.popup.removeErrors();this.popup.setPositionCenter()},
_clearTestMessage:function(){this.setTestMessage(!0,"")},_setTestConnectionButton:function(c){c?this.popup.displayInlineButton("testConnectionButton"):this.popup.displayNoneButton("testConnectionButton");this.popup.setPositionCenter()},_setChannelDescription:function(c){this.form.find("#description").html(c)},getFormValue:function(){var c={};$.extend(c,this._createChildView(this._activeType).getFormValue());c.id=this.model&&this.model.id||0;c.name=$.trim(this.form.find('[name="name"]').val());c.type=
this._activeType||$.trim(this.form.find('[name="channels"]').val());return c},validateForm:function(c){var b=[];""==c.name&&b.push(h(22902));b=b.concat(this._createChildView(this._activeType).validateForm(c));this.setErrorMessages(b);return 0==b.length},isFormChanged:function(c){if(!this.model||!this.model.id)return!0;var b=this,d=!1,g=["id","type","cpword"];$.each(c,function(c,l){if(-1!==g.indexOf(c))return!0;if(l!==(b.model[c]||"").toString())return d=!0,!1});return d},addListenersToView:function(){var c=
this;"dbaas"===this._activeType&&this._createChildView("dbaas").addListener("configForm:TestButtonToggle",function(b,d){c._setTestConnectionButton(d)})},submitFormButton:function(){if(this.isSubmissionInProgress)return!1;var c=this.getFormValue();this._clearTestMessage();if(this.validateForm(c)){if(!this.isFormChanged(c))return this.closeForm(),!1;this.isSubmissionInProgress=!0;this.notify("channel:save",c)}},setErrorMessages:function(c){var b,d=[];for(b=0;b<c.length;b++)d.push({id:b+1,message:c[b]});
this.isSubmissionInProgress=!1;this.popup.setErrors(d)},closeForm:function(){this.destroy()},destroy:function(){this.popup&&this.popup.destroy();this._views={};$(window).off("keydown")},testConnection:function(){var c=this.getFormValue();if(!this.validateForm(c))return!1;this.notify("channel:test",{type:this._activeType,access:c})},setTestMessage:function(c,b){var d=this.form.find("#testAck");d.toggleClass("msg-invalid",!c);d.text(b)},updateChannelCollection:function(c){this._channelsCollection=c}})))})(toa);(function(d){d.ns("toa.views.outboundChannels.BicsConfigForm",d.define(null,function(){var c='<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%=getDomId("urlReqId")%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>">*</abbr>;<label id="<%=getDomId("urlLabId")%>"><%- h(19702 /*URL*/) %></label>;</div>;<div class="formField">;<input aria-labelledby="<%=getDomId("urlReqId")%> <%=getDomId("urlLabId")%>" required type="text" value="<%-host%>"  name="host"/>;</div>;</div>;<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%=getDomId("identityReqId")%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>">*</abbr>;<label id="<%=getDomId("identityLabId")%>"><%-h(19703 /*Identity Domain*/)%></label>;</div>;<div class="formField">;<input aria-labelledby="<%=getDomId("identityReqId")%> <%=getDomId("identityLabId")%>" required type="text" value="<%-identityDom%>"  name="identityDom"/>;</div>;</div>;<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%=getDomId("unameReqId")%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>">*</abbr>;<label id="<%=getDomId("unameLabId")%>"><%-h(19704 /*User Name*/)%></label>;</div>;<div class="formField">;<input aria-labelledby="<%=getDomId("unameReqId")%> <%=getDomId("unameLabId")%>" required type="text" value="<%-uname%>"  name="uname"/>;</div>;</div>;<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%=getDomId("pwordReqId")%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>"><% if(!id) { %>*<% } %></abbr>;<label id="<%=getDomId("pwordLabId")%>"><%-h(19705 /*Password*/)%></label>;</div>;<div class="formField">;<input aria-labelledby="<%=getDomId("pwordReqId")%> <%=getDomId("pwordLabId")%>" required type="password" value="<%-pword%>" <% if(id) { %> placeholder="********" <% } %>  name="pword"/>;</div>;</div>;<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%=getDomId("cpwordReqId")%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>"><% if(!id) { %>*<% } %></abbr>;<label id="<%=getDomId("cpwordLabId")%>"><%-h(19706 /*Confirm Password*/)%></label>;</div>;<div class="formField">;<input aria-labelledby="<%=getDomId("cpwordReqId")%> <%=getDomId("cpwordLabId")%>" required type="password" value="<%-pword%>"  <% if(id) { %> placeholder="********" <% } %>  name="cpword"/>;</div>;</div>'.split(";");
this.compileForm=(new d.Template(c)).compile();this._domId={};delete c},$.extend({},d.mixins.EventEmitter,{_fields:"host uname identityDom pword cpword id".split(" "),_prepareData:function(c){for(var b=[],d=0;d<this._fields.length;d++){var g=this._fields[d];b[g]=c&&void 0!==c[g]?c[g]:""}return b},render:function(c){this._id=c?c.id:!1;this.form||(this.form=$(this.compileForm.apply($.extend(this._prepareData(c),{getDomId:this.getDomId.bind(this)}))));return this.form},getDomId:function(c){void 0===
this._domId[c]&&(this._domId[c]=generate_id());return this._domId[c]},getFormValue:function(){for(var c={},b=0;b<this._fields.length;b++){var d=this._fields[b];c[d]=$.trim(this.form.find('[name="'+d+'"]').val())}return c},isValidHostName:function(c){var b=/^https:\/\/(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(:\d{1,5})?$/gm,d=/^https:\/\/127\.0\.0\.1(:\d{1,5})?$/;return(!1!==/^https:\/\/([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z0-9]{2,6}(:\d{1,5})?$/.test(c)||
!1!==b.test(c))&&!1===d.test(c)},validateForm:function(c){var b=[];""==c.host&&b.push(h(19725));this.isValidHostName(c.host)||b.push(h(20799));""==c.identityDom&&b.push(h(19726));""==c.uname&&b.push(h(19727));this._id||""!=c.pword||b.push(h(19728));""!=c.pword&&(c.pword||c.cpword)&&c.pword!==c.cpword&&b.push(h(19729));return b}})))})(toa);(function(d){d.ns("toa.views.outboundChannels.OacConfigForm",d.define(null,function(){this.compileForm=(new d.Template('<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%=getDomId("urlReqId")%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>">*</abbr>;<label id="<%=getDomId("urlLabId")%>"><%- h(19702 /*URL*/) %></label>;</div>;<div class="formField">;<input aria-labelledby="<%=getDomId("urlReqId")%> <%=getDomId("urlLabId")%>" required type="text" value="<%-host%>"  name="host"/>;</div>;</div>;<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%=getDomId("connectionReqId")%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>">*</abbr>;<label id="<%=getDomId("connectionName")%>"><%- h(19747 /*Connection Name*/) %> </label>;</div>;<div class="formField">;<input aria-labelledby="<%=getDomId("connectionReqId")%> <%=getDomId("connectionName")%>" required type="text" value="<%-connectionName%>"  name="connectionName"/>;</div>;</div>;<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%=getDomId("unameReqId")%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>">*</abbr>;<label id="<%=getDomId("unameLabId")%>"><%-h(19704 /*User Name*/)%></label>;</div>;<div class="formField">;<input aria-labelledby="<%=getDomId("unameReqId")%> <%=getDomId("unameLabId")%>" required type="text" value="<%-uname%>"  name="uname"/>;</div>;</div>;<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%=getDomId("pwordReqId")%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>"><% if(!id) { %>*<% } %></abbr>;<label id="<%=getDomId("pwordLabId")%>"><%-h(19705 /*Password*/)%></label>;</div>;<div class="formField">;<input aria-labelledby="<%=getDomId("pwordReqId")%> <%=getDomId("pwordLabId")%>" required type="password" value="<%-pword%>" <% if(id) { %> placeholder="********" <% } %>  name="pword"/>;</div>;</div>;<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%=getDomId("cpwordReqId")%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>"><% if(!id) { %>*<% } %></abbr>;<label id="<%=getDomId("cpwordLabId")%>"><%-h(19706 /*Confirm Password*/)%></label>;</div>;<div class="formField">;<input aria-labelledby="<%=getDomId("cpwordReqId")%> <%=getDomId("cpwordLabId")%>" required type="password" value="<%-pword%>"  <% if(id) { %> placeholder="********" <% } %>   name="cpword"/>;</div>;</div>'.split(";"))).compile();
this._domId={}},$.extend({},d.mixins.EventEmitter,{_fields:"host uname connectionName pword cpword id".split(" "),_prepareData:function(c){for(var b=[],d=0;d<this._fields.length;d++){var g=this._fields[d];b[g]=c&&void 0!==c[g]?c[g]:""}return b},render:function(c){this._id=c?c.id:!1;this.form||(this.form=$(this.compileForm.apply($.extend(this._prepareData(c),{getDomId:this.getDomId.bind(this)}))));return this.form},getDomId:function(c){void 0===this._domId[c]&&(this._domId[c]=generate_id());return this._domId[c]},
getFormValue:function(){for(var c={},b=0;b<this._fields.length;b++){var d=this._fields[b];c[d]=$.trim(this.form.find('[name="'+d+'"]').val())}return c},isValidHostName:function(c){var b=/^https:\/\/(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(:\d{1,5})?$/gm,d=/^https:\/\/127\.0\.0\.1(:\d{1,5})?$/;return(!1!==/^https:\/\/([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z0-9]{2,6}(:\d{1,5})?$/.test(c)||!1!==b.test(c))&&!1===d.test(c)},
validateForm:function(c){var b=[];""==c.host&&b.push(h(19725));this.isValidHostName(c.host)||b.push(h(20799));""==c.connectionName&&b.push(h(19748));""==c.uname&&b.push(h(19727));this._id||""!=c.pword||b.push(h(19728));""!=c.pword&&(c.pword||c.cpword)&&c.pword!==c.cpword&&b.push(h(19729));return b}})))})(toa);(function(d){d.ns("toa.views.outboundChannels.DbaasConfigForm",d.define(null,function(){this._initConnectionTypes();this._childforms={};this.compileForm=(new d.Template('<div id="toa-dbaas-channel-config-form">;<div class="toa-formrow">;<div class="formLabel">;<abbr id="abbr_dbaas_type" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>">*</abbr>;<label id="label_dbaas_type"><%- h(21125 /*Connect Using*/) %></label>;</div>;<div class="formField">;<select aria-labelledby="label_dbaas_type" name="connectUsing">;<% for(type in connectionTypes) {%>;<option value="<%-type%>" <%= (type===connectUsing) ? "selected":"" %>><%-connectionTypes[type].name %></option>;<% } %>;</select>;</div>;<div class="toa-formrow" id="warning">;<div class="error">;<%- h(21129 /* Please update your connection to Oracle REST Data Services */) %>;</div>;</div>;</div>;<div id="connectionTypeForm"></div>;</div>'.split(";"))).compile()},
$.extend({},d.mixins.EventEmitter,{_initConnectionTypes:function(){this._connectionTypes={direct:{name:h("21126"),className:d.views.outboundChannels.DirectDbConfigForm},ords:{name:h("21127"),className:d.views.outboundChannels.OrdsConfigForm}}},_initEventListeners:function(){var c=this;this.form.find('[name="connectUsing"]').on("change",function(){c._switchConnectionTypeForm($(this).val())})},_switchConnectionTypeForm:function(c){this.activeConnectionType=c;this.form.find("#warning").toggle(c!==this.constructor.CONNECTION_TYPE.ORDS);
var b=c===this.constructor.CONNECTION_TYPE.ORDS?this._convertToOrds(this.dataModel):this.dataModel,b=this._getConnectionTypeForm(c).render(b);this.connectionTypeForm.html(b);this.notify("configForm:TestButtonToggle",c===this.constructor.CONNECTION_TYPE.ORDS)},_convertToOrds:function(c){var b={};null!==c&&"object"===typeof c&&c.host&&c.uname&&(b.host=c.host,void 0!==c.host&&"https://"!==c.host.trim().substr(0,8)&&(b.host="https://"+c.host),b.uname=c.uname,b.id=c.id);return b},_getConnectionTypeForm:function(c){this._childforms[c]||
(this._childforms[c]=new this._connectionTypes[c].className);return this._childforms[c]},render:function(c){this.activeConnectionType=(this.dataModel=c)&&c.connectUsing||this.constructor.CONNECTION_TYPE.ORDS;return this.dataModel&&this.activeConnectionType===this.constructor.CONNECTION_TYPE.DIRECT?this.renderWithTypeSwitch(this.dataModel):this._getConnectionTypeForm(this.activeConnectionType).render(this.dataModel)},renderWithTypeSwitch:function(c){this.form||(this.form=$(this.compileForm.apply({connectionTypes:this._connectionTypes,
connectUsing:this.activeConnectionType})));this._initEventListeners();this.connectionTypeForm=this.form.find("#connectionTypeForm");this._switchConnectionTypeForm(this.activeConnectionType);return this.form},getFormValue:function(){var c={};$.extend(c,this._getConnectionTypeForm(this.activeConnectionType).getFormValue());c.connectUsing=this.activeConnectionType;return c},validateForm:function(c){return this._getConnectionTypeForm(this.activeConnectionType).validateForm(c)}}),{CONNECTION_TYPE:{ORDS:"ords",
DIRECT:"direct"}}))})(toa);(function(d){d.ns("toa.views.outboundChannels.IcsConfigForm",d.define(null,function(){var c='<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%-hostReqId%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>">*</abbr>;<label id="<%-hostLabId%>"><%-h(21108)%></label>;</div>;<div class="formField">;<input aria-labelledby="<%-hostReqId%> <%-hostLabId%>" required type="text" value="<%-host%>"  name="host" <% if(id) { %> disabled <% } %> />;</div>;</div>;<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%-unameReqId%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>">*</abbr>;<label  id="<%-unameLabId%>"><%-h(21114 /*User Name*/)%></div>;<div class="formField">;<input aria-labelledby="<%-unameReqId%> <%-unameLabId%>" required type="text" value="<%-uname%>"  name="uname"/>;</div>;</div>;<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%-passReqId%>" class="<% if(!id) { %>ofsc-abbr-mandatory<% } %>" title="<%- h(22351/* Required */) %>"><% if(!id) { %>*<% } %></abbr>;<label  id="<%-passLabId%>"><%-h(21115 /*Password*/)%></label>;</div>;<div class="formField">;<input aria-labelledby="<%-passReqId%> <%-passLabId%>" required type="password" value="<%-pword%>" <% if(id) { %> placeholder="********" <% } %>  name="pword"/>;</div>;</div>;<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%-cpassReqId%>" class="<% if(!id) { %>ofsc-abbr-mandatory<% } %>" title="<%- h(22351/* Required */) %>"><% if(!id) { %>*<% } %></abbr>;<label  id="<%-cpassLabId%>"><%-h(21116 /*Confirm Password*/)%></label>;</div>;<div class="formField">;<input aria-labelledby="<%-cpassReqId%> <%-cpassLabId%>" required type="password" value="<%-pword%>"  name="cpword" <% if(id) { %> placeholder="********" <% } %>/>;</div>;</div>'.split(";");
this.compileForm=(new d.Template(c)).compile();this._domId={};delete c},$.extend({},d.mixins.EventEmitter,{_fields:["host","uname","pword","cpword","id"],_prepareData:function(c){for(var b=[],d=0;d<this._fields.length;d++){var g=this._fields[d];b[g]=c&&void 0!==c[g]?c[g]:""}return b},render:function(c){this._id=c?c.id:!1;this.form||(this.form=$(this.compileForm.apply($.extend(this._prepareData(c),{hostReqId:generate_id(),hostLabId:generate_id(),unameReqId:generate_id(),unameLabId:generate_id(),passReqId:generate_id(),
passLabId:generate_id(),cpassReqId:generate_id(),cpassLabId:generate_id()}))));return this.form},getDomId:function(c){void 0===this._domId[c]&&(this._domId[c]=generate_id());return this._domId[c]},getFormValue:function(){for(var c={},b=0;b<this._fields.length;b++){var d=this._fields[b];c[d]=$.trim(this.form.find('[name="'+d+'"]').val())}return c},isValidHostName:function(c){var b=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(:\d{1,5})?$/gm,
d=/^127\.0\.0\.1(:\d{1,5})?$/;return(!1!==/^([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z0-9]{2,6}(:\d{1,5})?$/.test(c)||!1!==b.test(c))&&!1===d.test(c)},validateForm:function(c){var b=[];""==c.host&&b.push(h(21117));this.isValidHostName(c.host)||b.push(h(22916));""==c.uname&&b.push(h(19727));this._id||""!=c.pword||b.push(h(19728));""!=c.pword&&(c.pword||c.cpword)&&c.pword!==c.cpword&&b.push(h(19729));return b}})))})(toa);(function(d){d.ns("toa.views.outboundChannels.OrdsConfigForm",d.define(null,function(){this.compileForm=(new d.Template('<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%=getDomId("urlReqId")%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>">*</abbr>;<label id="<%=getDomId("urlLabId")%>"><%- h(19702 /*URL*/) %></label>;</div>;<div class="formField">;<input aria-labelledby="<%=getDomId("urlReqId")%> <%=getDomId("urlLabId")%>" required type="text" value="<%-host%>"  name="host"/>;</div>;</div>;<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%=getDomId("schemaAliasReqId")%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>">*</abbr>;<label  id="<%=getDomId("schemAliasLabId")%>"><%-h(21123 /*Schema Alias*/)%>;</div>;<div class="formField">;<input aria-labelledby="<%=getDomId("schemaAliasReqId")%> <%=getDomId("schemAliasLabId")%>" required type="text" value="<%-schemaAlias%>"  name="schemaAlias"/>;</div>;</div>;<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%=getDomId("unameReqId")%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>">*</abbr>;<label  id="<%=getDomId("unameLabId")%>"><%-h(21114 /*User Name*/)%>;</div>;<div class="formField">;<input aria-labelledby="<%=getDomId("unameReqId")%> <%=getDomId("unameLabId")%>" required type="text" value="<%-uname%>"  name="uname"/>;</div>;</div>;<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%=getDomId("passReqId")%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>"><% if(!id) { %>*<% } %></abbr>;<label  id="<%=getDomId("passLabId")%>"><%-h(21115 /*Password*/)%></label>;</div>;<div class="formField">;<input aria-labelledby="<%=getDomId("passReqId")%> <%=getDomId("passLabId")%>" required type="password" value="<%-pword%>" <% if(id) { %> placeholder="********" <% } %>  name="pword"/>;</div>;</div>;<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%=getDomId("cpassReqId")%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>"><% if(!id) { %>*<% } %></abbr>;<label  id="<%=getDomId("cpassLabId")%>"><%-h(21116 /*Confirm Password*/)%></label>;</div>;<div class="formField">;<input aria-labelledby="<%=getDomId("cpassReqId")%> <%=getDomId("cpassLabId")%>" required type="password" value="<%-pword%>"  <% if(id) { %> placeholder="********" <% } %>   name="cpword"/>;</div>;</div>'.split(";"))).compile();
this._domId={}},$.extend({},d.mixins.EventEmitter,{_fields:"host schemaAlias uname pword cpword id".split(" "),_prepareData:function(c){var b=[],d;for(d in this._fields)d=this._fields[d],b[d]=c&&void 0!==c[d]?c[d]:"";return b},render:function(c){this._id=c?c.id:!1;this.form||(this.form=$(this.compileForm.apply($.extend(this._prepareData(c),{getDomId:this.getDomId.bind(this)}))));return this.form},getDomId:function(c){void 0===this._domId[c]&&(this._domId[c]=generate_id());return this._domId[c]},getFormValue:function(){var c=
{},b;for(b in this._fields)b=this._fields[b],c[b]=$.trim(this.form.find('[name="'+b+'"]').val());return c},isValidHostName:function(c){var b=/^https:\/\/(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(:\d{1,5})?$/gm,d=/^https:\/\/127\.0\.0\.1(:\d{1,5})?$/;return(!1!==/^https:\/\/([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z0-9]{2,6}(:\d{1,5})?$/.test(c)||!1!==b.test(c))&&!1===d.test(c)},validateForm:function(c){var b=[];""===c.host?
b.push(h(21117)):this.isValidHostName(c.host)||b.push(h(22916));""===c.schemaAlias&&b.push(h(21124));""===c.uname&&b.push(h(19727));this._id||""!==c.pword||b.push(h(19728));""!==c.pword&&(c.pword||c.cpword)&&c.pword!==c.cpword&&b.push(h(19729));return b}})))})(toa);(function(d){d.ns("toa.views.outboundChannels.DirectDbConfigForm",d.define(null,function(){var c='<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%=getDomId("hostReqId")%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>">*</abbr>;<label id="<%=getDomId("hostLabId")%>"><%-h(21108)%></label>;</div>;<div class="formField">;<input aria-labelledby="<%=getDomId("hostReqId")%> <%=getDomId("hostLabId")%>" required type="text" value="<%-host%>"  name="host"/>;</div>;</div>;<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%=getDomId("portReqId")%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>">*</abbr>;<label id="<%=getDomId("portLabId")%>"><%-h(21109)%></label>;</div>;<div class="formField">;<input aria-labelledby="<%=getDomId("portReqId")%> <%=getDomId("portLabId")%>" required type="text" value="<%-port%>"  name="port"/>;</div>;</div>;<div class="toa-formrow">;<input type="radio" name="connectionType" id="sid" value="sid" <% if(connectionType === "sid") { %>checked <% } %>>;<label for="sid"><%-h(21110)%></label>;<input type="radio" name="connectionType" id="sname" <% if(connectionType != "sid") { %>checked <% } %> value="sname">;<label for="sname"><%-h(21111)%></label>;</div>;<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%=getDomId("conReqId")%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>">*</abbr>;<label  id="connectionType"><% if(connectionType === "sid") { %><%-h(21112)%><% } else {%><%-h(21113)%><% } %></label>;</div>;<div class="formField">;<input aria-labelledby="<%=getDomId("conReqId")%> connectionType" required type="text" value="<%-connectionValue%>"  name="connectionValue"/>;</div>;</div>;<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%=getDomId("unameReqId")%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>">*</abbr>;<label  id="<%=getDomId("unameLabId")%>"><%-h(21114 /*User Name*/)%></div>;<div class="formField">;<input aria-labelledby="<%=getDomId("unameReqId")%> <%=getDomId("unameLabId")%>" required type="text" value="<%-uname%>"  name="uname"/>;</div>;</div>;<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%=getDomId("passReqId")%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>"><% if(!id) { %>*<% } %></abbr>;<label  id="<%=getDomId("passLabId")%>"><%-h(21115 /*Password*/)%></label>;</div>;<div class="formField">;<input aria-labelledby="<%=getDomId("passReqId")%> <%=getDomId("passLabId")%>" required type="password" value="<%-pword%>" <% if(id) { %> placeholder="********" <% } %>  name="pword"/>;</div>;</div>;<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%=getDomId("cpassReqId")%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>"><% if(!id) { %>*<% } %></abbr>;<label  id="<%=getDomId("cpassLabId")%>"><%-h(21116 /*Confirm Password*/)%></label>;</div>;<div class="formField">;<input aria-labelledby="<%=getDomId("cpassReqId")%> <%=getDomId("cpassLabId")%>" required type="password" value="<%-pword%>"  <% if(id) { %> placeholder="********" <% } %>   name="cpword"/>;</div>;</div>'.split(";");
this.compileForm=(new d.Template(c)).compile();this._domId={};delete c},$.extend({},d.mixins.EventEmitter,{_fields:"host port uname connectionType connectionValue pword cpword id".split(" "),_prepareData:function(c){var b=[],d;for(d in this._fields)d=this._fields[d],b[d]=c&&void 0!==c[d]?c[d]:"";b.port=b.port||"1521";return b},render:function(c){var b=this;this._id=c?c.id:!1;if(!this.form){this.form=$(this.compileForm.apply($.extend(this._prepareData(c),{getDomId:this.getDomId.bind(this)})));c=$(this.form).find("[name=connectionType]");
var d=$(this.form).find("#connectionType");$(this.form).find("[name=connectionValue]");c.on("change",function(){$type=b.getConnectionTypeString(this.value);d.text($type)})}return this.form},getDomId:function(c){void 0===this._domId[c]&&(this._domId[c]=generate_id());return this._domId[c]},getFormValue:function(){var c={},b;for(b in this._fields)b=this._fields[b],c[b]=$.trim(this.form.find('[name="'+b+'"]').val());c.connectionType=$.trim(this.form.find('[name="connectionType"]:checked').val());return c},
isValidHostName:function(c){var b=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/gm,d=/^127\.0\.0\.1$/;return(!1!==/^([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z0-9]{2,6}$/.test(c)||!1!==b.test(c))&&!1===d.test(c)},validateForm:function(c){var b=[];""==c.host&&b.push(h(21117));this.isValidHostName(c.host)||b.push(h(22916));""==c.port&&b.push(h(21118));null===c.port.match(/^[\d]+$/)&&b.push(h(20800));""==c.connectionValue&&($type=
this.getConnectionTypeString(c.connectionType),b.push(r(21119,{"{CONNECT}":$type})));""==c.uname&&b.push(h(19727));this._id||""!=c.pword||b.push(h(19728));""!=c.pword&&(c.pword||c.cpword)&&c.pword!==c.cpword&&b.push(h(19729));return b},getConnectionTypeString:function(c){switch(c){case this.constructor.CONNECTION_TYPE.SID:return h(21112);case this.constructor.CONNECTION_TYPE.SNAME:return h(21113)}}}),{CONNECTION_TYPE:{SID:"sid",SNAME:"sname"}}))})(toa);(function(d){d.ns("toa.views.outboundChannels.OCXConfigForm",d.define(null,function(c,b){var e='<div class="toa-formrow">;<div class="formHeadings">;<label id="<%=getDomId("pwordLabId")%>"><%-h(20196 /*Oracle CX Service Endpoints*/)%></label>;</div>;</div>;<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%=getDomId("hostUrlReqId")%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>">*</abbr>;<label id="<%=getDomId("urlLabId")%>"><%- h(19702 /*URL*/) %></label>;</div>;<div class="formField">;<input aria-labelledby="<%=getDomId("hostUrlReqId")%> <%=getDomId("host")%>" required type="text" value="<%-host%>"  name="host"/>;</div>;</div>;<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%=getDomId("unameReqId")%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>">*</abbr>;<label id="<%=getDomId("unameLabId")%>"><%-h(19704 /*User Name*/)%></label>;</div>;<div class="formField">;<input aria-labelledby="<%=getDomId("unameReqId")%> <%=getDomId("unameLabId")%>" required type="text" value="<%-uname%>"  name="uname"/>;</div>;</div>;<div class="toa-formrow">;<div class="formNote">;<label><%-h(20182 /*IT_SECURITY_MANAGER user with privileges for Setup & Maintain Applications, Setup Service and Service Work Order*/)%></label>;</div>;</div>;<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%=getDomId("pwordReqId")%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>"><% if(!id) { %>*<% } %></abbr>;<label id="<%=getDomId("pwordLabId")%>"><%-h(19705 /*Password*/)%></label>;</div>;<div class="formField">;<input aria-labelledby="<%=getDomId("pwordReqId")%> <%=getDomId("pwordLabId")%>" required type="password" value="<%-pword%>" <% if(id) { %> placeholder="********" <% } %>  name="pword"/>;</div>;</div>;<div class="toa-formrow">;<div class="formHeadings">;<label id="<%=getDomId("pwordLabId")%>"><%- h(20204 /*Oracle Integration*/) %></label>;</div>;</div>;<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%=getDomId("channelReqId")%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>">*</abbr>;<label id="<%=getDomId("channelLabId")%>"><%- h(20213 /*Integration Channel*/) %></label>;</div>;<div class="formField">;<select aria-labelledby="<%=getDomId("channelReqId")%>" name="integ_channel">;<% for(const integChannel of icsChannelList) {%>;<option value="<%-integChannel.id%>" <% if(integChannel.id==selectedChannel){%>selected<%}%> ><%-integChannel.name %></option>;<% } %>;</select>;</div>;</div>'.split(";");
this.icsChannelsCollection=c;this.duplicateOcxChannel=b;this.compileForm=(new d.Template(e)).compile();this._domId={};delete e},$.extend({},d.mixins.EventEmitter,{_fields:["integ_channel","host","uname","pword","id"],_prepareData:function(c){for(var b=[],d=0;d<this._fields.length;d++){var g=this._fields[d];b[g]=c&&void 0!==c[g]?c[g]:""}return b},render:function(c){this._id=c?c.id:!1;this.form||(this.form=$(this.compileForm.apply($.extend(this._prepareData(c),{selectedChannel:c?c.integ_channel:null,
icsChannelList:this.icsChannelsCollection,getDomId:this.getDomId.bind(this)}))));return this.form},getDomId:function(c){void 0===this._domId[c]&&(this._domId[c]=generate_id());return this._domId[c]},getFormValue:function(){for(var c={},b=0;b<this._fields.length;b++){var d=this._fields[b];c[d]=$.trim(this.form.find('[name="'+d+'"]').val())}return c},isValidHostName:function(c){var b=/^https:\/\/(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(:\d{1,5})?$/gm,
d=/^https:\/\/127\.0\.0\.1(:\d{1,5})?$/;return(!1!==/^https:\/\/([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z0-9]{2,6}(:\d{1,5})?$/.test(c)||!1!==b.test(c))&&!1===d.test(c)},validateForm:function(c){var b=[];this.duplicateOcxChannel&&this.duplicateOcxChannel.id!==c.id&&b.push(h(20576));""==c.host&&b.push(h(19725));this.isValidHostName(c.host)||b.push(h(20799));""==c.integ_channel&&b.push(h(20180));""==c.uname&&b.push(h(19727));this._id||""!=c.pword||b.push(h(19728));return b}})))})(toa);(function(d){d.ns("toa.views.outboundChannels.ApplicationConfigForm",d.define(null,function(){var c='<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%=getDomId("appIdReqId")%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>">*</abbr>;<label id="<%=getDomId("appIdLabId")%>"><%-h(21175 /*Application Id*/)%></label>;</div>;<div class="formField">;<input aria-labelledby="<%=getDomId("appIdReqId")%> <%=getDomId("appIdLabId")%>" required type="text" value="<%-appId%>"  name="appId" maxlength="1020"/>;</div>;</div>'.split(";");
this.compileForm=(new d.Template(c)).compile();this._domId={};delete c},$.extend({},d.mixins.EventEmitter,{_fields:["appId"],_prepareData:function(c){for(var b=[],d=0;d<this._fields.length;d++){var g=this._fields[d];b[g]=c&&void 0!==c[g]?c[g]:""}return b},render:function(c){this._id=c?c.id:!1;this.form||(this.form=$(this.compileForm.apply($.extend(this._prepareData(c),{getDomId:this.getDomId.bind(this)}))));return this.form},getDomId:function(c){void 0===this._domId[c]&&(this._domId[c]=generate_id());
return this._domId[c]},getFormValue:function(){for(var c={},b=0;b<this._fields.length;b++){var d=this._fields[b];c[d]=$.trim(this.form.find('[name="'+d+'"]').val())}return c},validateForm:function(c){var b=[];""==c.appId&&b.push(h(15905));null===c.appId.match(/^[a-z][a-z0-9_]*$/)&&b.push(h(20396));return b}})))})(toa);(function(d){d.ns("toa.views.outboundChannels.KnowledgeConfigForm",d.define(null,function(c){var b='<div class="toa-formrow">;<div class="formLabel">;<abbr id="<%=getDomId("appLabelReqId")%>" class="ofsc-abbr-mandatory" title="<%- h(22351/* Required */) %>">*</abbr>;<label id="<%=getDomId("appLabel")%>"><%-h(22723 /*Application Label*/)%></label>;</div>;<div class="formField">;<input aria-labelledby="<%=getDomId("appLabelReqId")%> <%=getDomId("appLabel")%>" required type="text" value="<%-appLabel%>"  name="appLabel" maxlength="1020"/>;</div>;</div>'.split(";");
this.duplicateKnowledgeChannel=c;this.compileForm=(new d.Template(b)).compile();this._domId={};delete b},$.extend({},d.mixins.EventEmitter,{_fields:["appLabel","id"],_prepareData:function(c){for(var b=[],d=0;d<this._fields.length;d++){var g=this._fields[d];b[g]=c&&void 0!==c[g]?c[g]:""}return b},render:function(c){this._id=c?c.id:!1;return this.form=$(this.compileForm.apply($.extend(this._prepareData(c),{getDomId:this.getDomId.bind(this)})))},getDomId:function(c){void 0===this._domId[c]&&(this._domId[c]=
generate_id());return this._domId[c]},getFormValue:function(){for(var c={},b=0;b<this._fields.length;b++){var d=this._fields[b];c[d]=$.trim(this.form.find('[name="'+d+'"]').val())}return c},validateForm:function(c){var b=[];this.duplicateKnowledgeChannel&&this.duplicateKnowledgeChannel.id!==c.id&&b.push(h(227704));""==c.appLabel&&b.push(h(22711));return b}})))})(toa);(function(d){var c=d.models.ObservableModel;d.ns("toa.models.messageScenarios.BaseModel",d.define(c,function(b){c.apply(this,arguments);this._lookups={};this._scenarioMethod=""},{subscribeOnChild:function(b){b.addListener("all",function(){this.notify.apply(this,arguments)},this)},toJSON:function(){var b=c.prototype.toJSON.apply(this,arguments);this.idField in this.attributes||delete b[this.idField];return b},getDefault:function(b){var c="";this.getLookup(b)&&this.getLookup(b).length&&(c=this.getLookup(b)[0].label);
return c},setLookups:function(b){this._lookups=b},getLookups:function(){return this._lookups},setScenarioMethod:function(b){this._scenarioMethod=b},getScenarioMethod:function(){return this._scenarioMethod},getLookup:function(b){b=b||!1;var c=this.getLookups();return b?c[b]||null:c},getModelField:function(b,c){c=c||!1;var d=this.get(b,"");return c?this.translate(this.getLookup(b),d):d},translate:function(b,c){for(var d=c,k=0;k<b.length;k++)if(c===b[k].label){d=b[k].text;break}return d}}))})(toa);(function(d){var c=d.models.ObservableCollection;d.ns("toa.models.messageScenarios.BaseCollection",d.define(c,function(){c.apply(this,arguments)},{modelConstructor:d.models.messageScenarios.BaseModel,where:function(b,c){var d=[];this.each(function(k,l){k.get(b)===c&&d.push(k)},this);return d},first:function(){return this.models[0]||null},find:function(b,c,d){return this.findBy(function(d){return d.get(b)==c},null,d)},findBy:function(b,c,d){b=this.findIndexBy(b,c,d);return-1<b?this.models[b]:null},
findIndexBy:function(b,c,d){var k=this.models;d=d||0;for(var l=k.length;d<l;d++)if(b.call(c||this,k[d]))return d;return-1},compact:function(){for(var b=this.compactData.apply(this,arguments),c=new this.constructor,d=0,k=b.length;d<k;d++)c.add(b[d],{silent:!0});return c},compactData:function(){var b=[],c=Array.prototype.slice.call(arguments,0);this.each(function(d){d=d.pick(c);b.push(d)});return b},getAutoIncrement:function(b){var c=0;b=this.pluck(b);b.length&&(c=+Math.max.apply(null,b));c++;return c}}))})(toa);(function(d){var c=d.models.messageScenarios.BaseCollection;d.ns("toa.models.messageScenarios.SortableCollection",d.define(c,function(){c.apply(this,arguments)},{comparator:function(b,c){var d,k;"MessageScenario"==b.constructor.name?(d=+b.id,k=+c.id,b.get("translation")&&c.get("translation")?(d=b.get("translation"),k=c.get("translation")):b.get("label")&&c.get("label")&&(d=b.get("label"),k=c.get("label"))):(d=b.attributes.name,k=c.attributes.name);if(d==k)return 0;if(!d)return-1;if(!k)return 1;d=
d.toLowerCase();k=k.toLowerCase();return d<k?-1:1}}))})(toa);(function(d){var c=d.models.messageScenarios.BaseModel;d.ns("toa.models.messageScenarios.MessageScenario",d.define(c,function(){c.apply(this,arguments)},{idField:"scenario_id",isRemovable:function(){return!0}}))})(toa);(function(d){var c=d.models.messageScenarios.BaseModel;d.ns("toa.models.messageScenarios.Notification",d.define(c,function(){c.apply(this,arguments)},{idField:"label",isRemovable:function(){return!0}}))})(toa);(function(d){var c=d.models.messageScenarios.BaseModel;d.ns("toa.models.messageScenarios.NotificationItem",d.define(c,function(){c.apply(this,arguments)},{idField:"label",isRemovable:function(){return!0}}))})(toa);(function(d){var c=d.models.messageScenarios.BaseModel;d.ns("toa.models.messageScenarios.ScenarioStep",d.define(c,function(){c.apply(this,arguments)},{idField:"step_id",setMaxMessages:function(b){this.set({maxMessages:b},{silent:!0})},getMaxMessages:function(){return+this.get("maxMessages",0)},getStatisticsParam:function(b){return+this.get("statistics",{})[b]||0}}))})(toa);(function(d){var c=d.models.ObservableModel;d.ns("toa.models.messageScenarios.MessageScenarioStep",d.define(c,function(){c.apply(this,arguments)},{idField:"step_id",_defaultState:{msname:"",mstype:"start",msmethod:"email",mssubmethod:"",mssend_at:"day_of_event",mssend_day_shift:0,mssend_from_h:"08",mssend_from_m:"00",msfaultretries:1,mssentretries:1,msfaultinterval:"",mssentinterval:"",msdelay:0,msrecipient:"customer",mstime_in_msg:"",msaddress:"cemail",msstaticaddress:"",msreplyto:"",msskip_weekdays:0,
msskip_holidays:0,msmax_days_to_shift:0,mssend_within:0,mssend_within_h:"",mssend_within_m:"",mssurvey:0,msfeature:0,helpdesk_option:0,generateMessageOnCreation:0,msaddress_selected:{"1P":"cphone","3P":"pphone","1E":"cphone","3E":"email"},mscollaboration_selected_receivers:{users:[],groups:[],helpdesks:[]},mscollaboration_receivers:{users:[],groups:[],helpdesks:[]},patterns:{},blockingConditions:[],nextSteps:[]},_emptyPattern:{subject:"",body:""},setLookups:function(b){this.set({lookups:b})},getLookups:function(){return this.get("lookups",
[])},getLookup:function(b){return this.getLookups()[b]||null},setData:function(b){if(!b||$.isEmptyObject(b))this.setDefault();else{var c=this.getDefaultData();$.isArray(b.patterns)&&(b.patterns={});$.extend(c,b);this.set(c)}},setHelpdeskOption:function(b){this.set("helpdesk_option",b)},setDefault:function(){this.set(this._defaultState)},getDefaultData:function(){return this._defaultState},getMethod:function(){return this.get("msmethod","")},getSelectedReceivers:function(){return this.get("mscollaboration_selected_receivers")},
getReceivers:function(){return this.get("mscollaboration_receivers")},addReceiver:function(b,c){var d=this.getReceivers();d[b].push(c);this.set({mscollaboration_receivers:d})},deleteReceiver:function(b,c){var d=this.getReceivers();d[b].splice(c,1);this.set({mscollaboration_receivers:d});this.set("helpdesk_option",0)},getPatterns:function(){return this.get("patterns",{})},getPattern:function(b){return this.getPatterns()[b]||this._emptyPattern},setPattern:function(b,c){var d=this.getPatterns();d[b]=
c;this.set({patterns:d})},setEmptyPattern:function(b){this.setPattern(b,this._emptyPattern)},isEmptyPattern:function(b){b=this.getPattern(b);return""===b.subject&&""===b.body},getBlockingConditions:function(){return this.get("blockingConditions",[])},getNextSteps:function(){return this.get("nextSteps",[])},getDisabledMethods:function(){var b={};$.each(this.getLookup("stepStatus"),function(c,d){d.disabled_method&&(b[d.label]=d.disabled_method)});return b},getConditionsLookups:function(b){b=b||!1;var c=
{field:this.getLookup("field"),condition:this.getLookup("condition"),status:this.getLookup("status"),checkOn:[{label:"1",text:h(20373)},{label:"2",text:h(20374)},{label:"3",text:h(20375)}]};!b&&this.getLookup("fieldGroups")&&(c.fieldGroups=this.getLookup("fieldGroups"));return c},getNextStepLookups:function(){return{step:this.getLookup("stepsList"),status:this.getLookup("stepStatus")}},setBlockingConditions:function(b){this.set({blockingConditions:b})},setNextSteps:function(b){this.set({nextSteps:b})},
spliceData:function(b){b=b||[];var c={};$.each(b,function(b,d){c[d]=this.get(d,this._defaultState[d]||"")}.bind(this));return c},getPreparedData:function(){return this.spliceData("msname mstype msmethod mssend_at mssend_day_shift mssend_from_h mssend_from_m msfaultretries mssentretries msfaultinterval mssentinterval msdelay msrecipient mstime_in_msg msaddress msstaticaddress msstatic_zid msstatic_lid msreplyto mssurvey msskip_weekdays msskip_holidays msmax_days_to_shift mssend_within_h mssend_within_m msfeature generateMessageOnCreation mscollaboration_receivers helpdesk_option patterns blockingConditions nextSteps".split(" "))}}))})(toa);(function(d){d.ns("toa.views.messageScenarios.BaseView",d.define(null,function(c){this.options=c||{};this.model=this.options.model;this.collectionModel=this.options.collectionModel;this._tpl=new d.Template(this.template);this.readOnlyMode=!1},$.extend({},d.mixins.EventEmitter,{template:"",regions:{},events:{},tag:"",setReadOnlyMode:function(c){this.readOnlyMode=c},render:function(c,b){b||c.empty();var d=$(this.getHtml());this._container=c;this._$el=0<d.length?d:c;c.append(d);this.initEvents();return this},
getElement:function(){return this._$el},getContainer:function(){return this._container},getData:function(){var c=this.model&&this.model.toJSON()||{};c.readOnlyMode=this.readOnlyMode;return c},getHtml:function(){return this._tpl.apply(this.getData())},initEvents:function(){$.each(this.events,function(c,b){var d=this._$el,g=c.split(" ");if(1!==g.length&&2!==g.length||!g[0].length)throw Error("Incorrect description of event selector ("+c+")");var k=b;"string"===typeof b&&(k=this[b]);if(!k||"function"!==
typeof k)throw Error('Incorrect event handler for selector "'+c+'"');2===g.length&&(d=g[1],d=this._$el.find(d).addBack().filter(d));d.on(g[0],k.bind(this))}.bind(this))},showRegion:function(c,b){var d=this._container.find(this.regions[c]).first();b.render(d)},hide:function(){this._$el.hide()},show:function(){this._$el.show()},_notifyOnChild:function(c,b){var d=Array.prototype.slice.call(arguments);d[0]=b;d[1]=c;this.notify.apply(this,d)},_subscribeChildView:function(c){c.addListener("all",$.proxy(this._notifyOnChild,
this,c))},clear:function(){this.getContainer()&&this.getContainer().empty()},destroy:function(){$.isEmptyObject(this._childViews)||($.each(this._childViews,function(c,b){b.destroy.apply(b)}.bind(this)),this._childViews=[]);this.notify("destroy",this)}})))})(toa);(function(d){var c=d.views.messageScenarios.BaseView;d.ns("toa.views.messageScenarios.BaseForm",d.define(c,function(b){c.apply(this,arguments)},{validate:function(){this.hideErrors();var b=!1;$.each(this.validators,function(c,d){var k=this._container.find(d.selector);$.each(k,function(c,e){var k=this.validateField(e,d.rules);k&&k.length&&(this.showError(e,k),b=!0)}.bind(this))}.bind(this));return!b},validateField:function(b,c){var d="";$.each(c,function(c,e){var n=this[e+"FieldValidate"];if(n)return d=
n.apply(this,[b])}.bind(this));return d},mandatoryFieldValidate:function(b){b=$(b).val();var c="";""===$.trim(b)&&(c=h(15905));return c},showError:function(b,c){var d=$("<div>").addClass("infoError").text(c);$(b).after(d);$(b).parent().parent().addClass("invalid")},hideErrors:function(){this._container.find(".infoError").remove();this._container.find(".invalid").removeClass("invalid")},hideError:function(b){b=b.target;$(b).nextAll(".infoError").remove();$(b).parent().parent().removeClass("invalid")}}))})(toa);(function(d){var c=d.views.messageScenarios.BaseView;d.ns("toa.views.messageScenarios.BaseCollectionView",d.define(c,function(b){c.apply(this,arguments);this.collection=this.options.collection;this.model=this.options.model},{_childViews:[],template:"",childRegion:"",childView:{},childSeparator:"",noItemsView:{},render:function(b,d){d||b.empty();this._childViews=[];c.prototype.render.apply(this,arguments);var g=this.getRegionContainer();this._renderCollection(g);this._container=b;return this},getRegionContainer:function(){var b=
this.childRegion;return b?this._container.find(b).first():this._container},_renderCollection:function(b){var c=this.collection.getCount();0==c&&(new this.noItemsView).render(b,!0);this.collection.each(function(d,k){var l=new this.childView({model:d,collection:this.collection});l.setReadOnlyMode(this.readOnlyMode);this._subscribeChildView(l);this._childViews.push(l);l.render(b,!0);this.childSeparator&&k!==c-1&&b.append(this.childSeparator)},this)}}))})(toa);(function(d){var c=d.views.messageScenarios.BaseView;d.ns("toa.views.messageScenarios.Container",d.define(c,function(){c.apply(this,arguments)},{regions:{leftPanel:".leftPanel",rightPanel:".rightPanel"},template:'<div class="leftPanel"></div><div class="rightPanel jet-css-only"></div>'}))})(toa);(function(d){var c=d.views.messageScenarios.BaseForm;d.ns("toa.views.messageScenarios.MessageScenario",d.define(c,function(){c.apply(this,arguments)},{calendarTo:null,events:{"change input.scenarioLabel":"onChangeLabel","change input.scenarioName":"onChangeName","click input.to_enable":"onClickToEnable"},validators:[{selector:".required",rules:["mandatory"]},{selector:".scenarioLabel",rules:["isLabelUnique"]}],validate:function(){this.model.set({from:$("input.hide_from_date").val()});$("input.to_enable:checked").length?
this.model.set({to:$("input.hide_to_date").val()}):this.model.set({to:""});this.hideErrors();var b=!1;$(".add-message-scenario .toa-calendar-form .icon").removeAttr("style");new Date(this.model.get("to"))<new Date(this.model.get("from"))&&(this.showError($("input.show_from_date"),r(20825,{"{FROM_DATE}":r(18006),"{TO_DATE}":r(18007)})),$(".add-message-scenario .toa-calendar-form.invalid .icon").css({"margin-left":"-17px"}),b=!0);$.each(this.validators,function(c,d){var k=this._container.find(d.selector);
$.each(k,function(c,e){var k=this.validateField(e,d.rules);k&&k.length&&(this.showError(e,k),b=!0)}.bind(this))}.bind(this));return!b},render:function(b,d){c.prototype.render.apply(this,arguments);this.afterRender();return this},afterRender:function(){d.app=parent.toa.app;d.app.popupReflowManager=d.createReflowManager();d.datetime.init();var b=new d.view.calendar.Datepicker("#calendar_from .show_from_date");b._calendar.addClass("message_scenario");this.calendarTo=new d.view.calendar.Datepicker("#calendar_to .show_to_date");
this.calendarTo._calendar.addClass("message_scenario");this.calendarTo.options.showPrevMonth=!1;this.calendarTo.options.showNextMonth=!1;this.calendarTo.options.minDate=this.calendarTo.options.maxDate=null;b.options.minDate=b.options.maxDate=null;var c=$("#calendar_from .hide_from_date"),g=this.model.get("from");b.setDate(g);c.val(g);b.addListener("changeDate",function(b,d){c.val(d)});var b=this.model.get("to"),k=$("#calendar_to .hide_to_date");this.calendarTo.addListener("changeDate",function(b,
c){k.val(c)});void 0!=b&&"-"!=b&&""!=b?(this.calendarTo.setDate(b),k.val(b),this.calendarTo.enable()):this.calendarTo.disable()},onChangeLabel:function(b){b=$(b.target).val();this.model.set({label:b})},onClickToEnable:function(b){$("input.to_enable:checked").length?this.calendarTo.enable():(this.model.set({to:null,to_enable:null}),$("input.to_enable").removeAttr("checked"),this.calendarTo.disable())},onChangeName:function(b){b=$(b.target).val();this.model.set({name:b})},isLabelUniqueFieldValidate:function(b){$(b).val();
return""},template:'<form class="toa-form-horizontal add-message-scenario"><div class="form-group"><div class="control-group"><label for="mfname" class="control-label"><abbr class="ofsc-abbr-mandatory" title="<%=h(22351)/*required*/%>">*</abbr><%= h(19106)/* Scenario Name */ %></label><div class="controls"><input id="mfname" required type="text" name="mfname" value="<%= name %>" class="scenarioName required" maxlength="255"></div></div><div class="control-group"><label for="mflabel" class="control-label"><%= h(19107)/* Scenario Label */ %></label><div class="controls"><input id="mflabel" type="text" name="mflabel" class="scenarioLabel" autofocus value="<%= label %>" ></div></div><div class="control-group"><label for="show_from_date" class="control-label"><abbr class="ofsc-abbr-mandatory" title="<%=h(22351)/*required*/%>">*</abbr><%= h(18006)/* Start Date */ %></label><div class="controls" id="calendar_from"><input id="show_from_date" required type="text" name="show_from_date" class="required show_from_date" maxlength="255"><input type="hidden" name="mffrom" class="hide_from_date" /></div></div><div class="control-group"><label id="to_enable" class="control-label"><%= h(18007)/* End Date */ %></label><div><input aria-labelledby="to_enable" type="checkbox" name="to_enable" class="to_enable" value="yes" <%= to_enable %> ></div></div><div class="control-group"><label for="show_to_date" class="control-label"></label><div class="controls" id="calendar_to"><input aria-labelledby="to_enable" type="text" name="show_to_date" class="show_to_date" maxlength="255"><input type="hidden" name="mfto" class="hide_to_date" /></div></div></div></form>'}))})(toa);(function(d){var c=d.views.messageScenarios.BaseView;d.ns("toa.views.messageScenarios.messageScenariosList.ListItem",d.define(c,function(){c.apply(this,arguments)},{events:{"click .scenariosListItem":"selectScenario","keypress .scenariosListItem":"selectScenario"},template:'<tr class="scenariosListItem active" tabindex="0" role="button"><td class="scenariosListItemDetails" ><div class="scenariosListItemName"><%- translation %></div><% if (0 === notifications.length) {%><div class="scenariosListItemEmptyNotifications" title="<%= h(19103)/* There is no assigned notifications */ %>"><%= h(19103)/* There is no assigned notifications */ %></div><% } else if (0 === startSteps) { %><div class="scenariosListItemEmptyNotifications" title="<%= h(19154)/* There is no start step in scenario */ %>"><%= h(19154)/* There is no start step in scenario */ %></div><% } else if(endless_warning){ %><div class="scenariosListItemEmptyNotifications" title="<%= h(17320)/* Endless loop */ %>"><%= h(17320)/* Endless loop */ %></div><% } else { %><div class="scenariosListItemNotifications"><%- notifications.join(", ") %></div><% } %></td><td class="listStepsCount"><small class="scenariosListItemStepsCount"><%- steps %></small><div><%= h(19102)/* Steps */ %></div></td></tr>',
selectScenario:function(b){"keypress"===b.type&&13!==b.keyCode||this.notify("scenario:selected",this.model.get("scenario_id"))}}))})(toa);(function(d){var c=d.views.messageScenarios.BaseView;d.ns("toa.views.messageScenarios.messageScenariosList.NoListItems",d.define(c,function(){c.apply(this,arguments)},{template:'<tr><td class="noListItems"><%= h(19120)/* No Message Scenarios */ %></td></tr>'}))})(toa);(function(d){var c=d.views.messageScenarios.BaseView;d.ns("toa.views.messageScenarios.messageScenariosList.ListControls",d.define(c,function(){c.apply(this,arguments)},{events:{"click .scenariosListButton.add":"actionAdd","click .scenariosListButton.remove":"actionDelete"},template:'<div class="scenariosListControls"><button aria-label="<%=h(13820/*Add*/)%>" class="scenariosListButton add" tabindex="0" role="button">&nbsp;</button><button aria-label="<%=h(13071/*Remove*/)%>" class="scenariosListButton remove" tabindex="0" role="button">&nbsp;</button><div>',
disableControls:function(){this._$el.find(".scenariosListButton").addClass("disabled")},enableControls:function(){this._$el.find(".scenariosListButton").removeClass("disabled")},disableControl:function(b){this._$el.find(".scenariosListButton."+b).addClass("disabled")},enableControl:function(b){this._$el.find(".scenariosListButton."+b).removeClass("disabled")},actionAdd:function(b){$(b.target).hasClass("disabled")||this.notify("scenarioaction:add",b,this)},actionDelete:function(b){$(b.target).hasClass("disabled")||
this.notify("scenarioaction:delete",b,this)}}))})(toa);(function(d){var c=d.views.messageScenarios.BaseCollectionView;d.ns("toa.views.messageScenarios.messageScenariosList.ListItems",d.define(c,function(){c.apply(this,arguments);this.selectedView=null},{idFieldName:"scenario_id",template:'<div class="scenariosListContainerInner"><div id="messageScenariosList"><table class="scenariosList" role="menu" aria-label="<%=  h(19101) /* Message Scenarios */ %>"></table></div></div>',childView:d.views.messageScenarios.messageScenariosList.ListItem,childRegion:".scenariosList",
noItemsView:d.views.messageScenarios.messageScenariosList.NoListItems,highlightSelected:function(b){this.selectedView=b;$.each(this._childViews,function(b,c){c._$el.removeClass("selected")});b._$el.addClass("selected")},getScenarioId:function(){var b=this.getActiveItem();return b?b.get(this.idFieldName):null},getSelectedIndex:function(){return this.selectedView?this.getViewIndexByModel(this.selectedView.model):-1},getViewIndexByModel:function(b){var c=this,d=-1,k=b.get(this.idFieldName);$.each(this._childViews,
function(b,n){if(n.model.get(c.idFieldName)==k)return d=b,!1});return d},getSiblingChildView:function(b){var c=this._childViews.length;if(0==c)return null;if(!b||0>b)b=0;return(b=b<=c-1?this._childViews[b]:this._childViews[c-1])&&b.model?b.model:null},getActiveItem:function(){var b=null;this.selectedView&&this.selectedView.model&&(b=this.selectedView.model);return b},setActiveItem:function(b,c,d){if(!b)return-1;b=this.getViewIndexByModel(b);-1<b&&this._childViews[b]&&(c?this.highlightSelected(this._childViews[b]):
this._childViews[b]._$el.click(),d&&this.scrollToItem(this._childViews[b]));return b},scrollToItem:function(b){var c=this._container.find(".scenariosListContainerInner"),d=c.outerHeight(),k=this.getRegionContainer();d<k.outerHeight()&&(k=k.children(":first").position().top,b=b._$el.position().top-k,b>d/2&&c.scrollTop(b-d/2))},selectFirst:function(){return 0<this._childViews.length?this.setActiveItem(this._childViews[0].model):-1}}))})(toa);(function(d){var c=d.views.messageScenarios.BaseView;d.ns("toa.views.messageScenarios.ListPanel",d.define(c,function(){c.apply(this,arguments)},{template:'<div class="scenariosListControls"></div><div class="scenariosListContainer"></div>',regions:{controls:".scenariosListControls",list:".scenariosListContainer"}}))})(toa);(function(d){var c=d.views.messageScenarios.BaseForm;d.ns("toa.views.messageScenarios.GeneralSection",d.define(c,function(b){c.apply(this,arguments)},{events:{"click .editScenario":"actionEdit","click .editScenarioName":"actionEdit"},template:'<h1 class="settingsSection"><%= h(19117)/* Scenario general info */ %><% if (!readOnlyMode) { %><button class="sectionsEditButton editScenario" tabindex="0" aria-label="<%= h(11989/* Edit */)%>"></button><% } %></h1><table class="generalInfoContainer" cellpadding="0" cellspacing="0"><% if ("" != translation) { %><tr><td class="infoMandatory">&nbsp;</td><td class="infoLabel"><%= h(19106)/* Scenario Name */ %></td><td class="infoValue"><input type="hidden" class="infoValueText require" value="<%- translation %>" id="scenarioName"><span><%- translation %></span></td></tr><% } %><% if ("" != label) { %><tr><td class="infoMandatory">&nbsp;</td><td class="infoLabel"><%= h(19107)/* Scenario Label */ %></td><td class="infoValue"><input type="hidden" class="infoValueText require" value="<%- label %>" id="scenarioLabel"><span><%- label %></span></td></tr><% } %><% if ("" != status) { %><tr><td class="infoMandatory">&nbsp;</td><td class="infoLabel"><%= h(19108)/* Status */ %></td><td class="infoValue"><span><%- status %></span></td></tr><% } %></table>',
actionEdit:function(b){this.notify("scenarioaction:edit",b,this)},getData:function(){var b=c.prototype.getData.apply(this,arguments),e=d.app.get("date")+" 00:00:00";b.from&&(this.isScenarioActive(e,b)&&(b.status=h(18010)),this.isScenarioActiveTill(e,b)&&(b.status=r(18009,{"{DATE}":this.getFormattedDate(b.to)})),this.isScenarioActiveFrom(e,b)&&(b.status=r(18008,{"{DATE}":this.getFormattedDate(b.from)})),this.isScenarioInactive(e,b)&&(b.status=h(18011)));return b},isScenarioActive:function(b,c){var g=
d.datetime.parseDate("iso_long",c.from),k=d.datetime.parseDate("iso_long",b);if(d.datetime.formatDate("iso_long",k)<d.datetime.formatDate("iso_long",g))return!1;if("undefined"===typeof c.to||""==c.to)return!0;g=d.datetime.parseDate("iso_long",c.to);return d.datetime.formatDate("iso_long",g)<d.datetime.formatDate("iso_long",g)?!1:!0},isScenarioInactive:function(b,c){var g=d.datetime.parseDate("iso_long",b);if("undefined"===typeof c.to||""==c.to)return!1;var k=d.datetime.parseDate("iso_long",c.to);
return d.datetime.formatDate("iso_long",k)<d.datetime.formatDate("iso_long",g)?!0:!1},isScenarioActiveTill:function(b,c){var g=d.datetime.parseDate("iso_long",b);if("undefined"===typeof c.to||""==c.to)return!1;var k=d.datetime.parseDate("iso_long",c.to);return d.datetime.formatDate("iso_long",g)<d.datetime.formatDate("iso_long",k)?!0:!1},isScenarioActiveFrom:function(b,c){var g=d.datetime.parseDate("iso_long",c.from),k=d.datetime.parseDate("iso_long",b);return d.datetime.formatDate("iso_long",k)<
d.datetime.formatDate("iso_long",g)?!0:!1},getFormattedDate:function(b){var c=d.app.model("companySettings").getUser().dateFormats.date;b=d.date.parseDate("iso",b);return d.date.formatDate(c,b)}}))})(toa);(function(d){var c=d.views.messageScenarios.BaseView;d.ns("toa.views.messageScenarios.assignedNotifications.Notification",d.define(c,function(){c.apply(this,arguments)},{events:{"click .notificationRemoveControl":"actionRemove","keypress .notificationRemoveControl":"actionRemove","click .notificationTitleText":"actionEdit","keypress .notificationTitleText":"actionEdit"},template:'<div data-id="<%- label %>" class="notificationItem"><div class="notificationItemTitle"><span role="button" tabindex="0" class="notificationTitleText <% if (typeof additional_constraints === "object" && additional_constraints.hide_popup) { %> notification-title-non-clickable <%}%>"><%- translation %></span><% if (!readOnlyMode && (typeof additional_constraints !== "object" || !additional_constraints.disable_remove)) { %><div class="notificationRemoveControl"><span role="button" aria-label="<%=h(13071/*Remove*/)%>" tabindex="0" class="notificationRemoveIcon"></span></div><% } %></div><div class="notificationItemContent"><div class="notificationMessagesCount">...</div><div class="notificationMessagesCaption"><div class="messagesText"><%= h(19123) /* Messages */ %></div><div class="inQueueText"><%= h(19124) /* In queue */ %></div></div></div><% if (typeof additional_constraints === "object" && additional_constraints.show_link) { %><div class="notification-item-sub-text notification-item-routing-profile-count"><%=toa.glossary({id : 20171, translations : {"{COUNT}": typeof profile_count == "undefined" ? 0 : profile_count}})%></div><% } %></div>',
render:function(b,d){c.prototype.render.apply(this,arguments);this.handleMessagesCount();this._$el.find(".notificationMessagesCount").css({"font-size":"28px",visibility:"visible"});this._$el.find(".notificationTitleText").addClass(this.model.getId());return this},renderStatistics:function(b){this._$el.find(".notificationMessagesCount").text(this.prettifyNumber(b.messages||0))},handleMessagesCount:function(){var b=this.model.get("messages",null);null===b?this._$el.find(".notificationMessagesCount").text("..."):
(b=this.prettifyNumber(b),this.model.set("messages",b),this._$el.find(".notificationMessagesCount").text(b))},prettifyNumber:function(b){return 1E3>b?String(b):1E3<=b&&1E6>b?r(18004,{"{VALUE}":Math.floor(b/1E3)}):r(18005,{"{VALUE}":Math.floor(b/1E6)})},actionRemove:function(b){if("keypress"!==b.type||13===b.keyCode){if(this.readOnlyMode)return!1;this.notify("notificationaction:remove",b,this)}},actionEdit:function(b){"keypress"===b.type&&13!==b.keyCode||this.notify("notificationaction:"+(this.readOnlyMode?
"view":"edit"),b,this)}}))})(toa);(function(d){var c=d.views.messageScenarios.BaseView;d.ns("toa.views.messageScenarios.assignedNotifications.NotificationItem",d.define(c,function(){this.priorToValues={delivery_window_start:h(803),service_window_start:h(802),ETA:h(817)};c.apply(this,arguments)},{events:{"change #select__notification_trigger":"selectNotificationTrigger","change .Notify30_60>select":"changeTriggerAdditionalParams","change .visit_notification_base>select":"changeTriggerAdditionalParams","change .param_line>input":"changeParamValue"},
template:'<div class="MessageScenario NotificationItemForm"><form name="trigger_frm"><div class="value notification_trigger"><label>'+r(19172,{"{MESSAGE_SCENARIO_SELECTOR}":'<select tabindex="0" class="pwi9 select__notification_trigger" id="select__notification_trigger"><optgroup style="display: none;"><% var previousGroup = "";     %><% var optionDisable = "";     %><% var trigger       = false;  %><% for (var notification_trigger in notification_triggers) { %><% trigger = notification_triggers[notification_trigger]; %><% if (previousGroup != trigger["group"]["translation"]) { %></optgroup><optgroup id="<%=trigger["group"]["groupLabel"]%>" label="<%= h(trigger["group"]["translation"]) %>"><% } %><% optionDisable = (scenario_id == trigger["scenario_id"] ? "disabled" : ""); %><option value="<%- notification_trigger %>" <%- optionDisable %>><%= h(trigger["text"]) %></option><% previousGroup = trigger["group"]["translation"]; %><%}%></optgroup></select>'})+
'</label></div><br /><div class="params" id="notification_params"><div id="reminder"><div class="param_line Notify30_60" id="notification_reminder">'+r(10418,{"{HTML_INPUT_INTERVAL_LIST}":'<input aria-labelledby="notification_reminder" maxlength="30" type="text" name="reminder_interval_list" class="pwi3 paramField" />',"{HTML_INPUT_SILENT_INTERVAL}":'<input aria-labelledby="notification_reminder" type="text" name="reminder_silent_interval" class="pwi3 paramField" maxlength="4" />',"{HTML_SELECT_NOTIFICATION}":'<select aria-labelledby="notification_reminder" name="Notify30_60" class="selectNotification pwi1 paramField"></select>'})+
'</div><div class="triggerNote infoNote"></div></div><% for (var i = 1; i <= 5; i++) { %><div id="today_<%- i %>"><div class="param_line Notify30_60" id="notification_changes_<%- i %>">'+r(224951,{"{HTML_INPUT_TEXT_THRESHOLD}":'<input aria-labelledby="notification_changes" type="text" name="threshold_today_<%- i %>" maxlength="4" class="pwi5 paramField" />',"{HTML_SELECT_NOTIFICATION}":'<select aria-labelledby="notification_changes" name="Notify30_60" class="selectNotification pwi1 paramField"></select>',
"{HTML_INPUT_TEXT_START}":'<input aria-labelledby="notification_changes" type="text" name="start_today_<%- i %>" maxlength="4" class="pwi5 paramField" />',"{HTML_INPUT_TEXT_END}":'<input aria-labelledby="notification_changes" type="text" name="end_today_<%- i %>"   maxlength="4" class="pwi5 paramField" />'})+'</div><div class="triggerNote infoNote"></div></div><% } %><div id="delay"><div class="param_line"><label>'+r(10448,{"{HTML_INPUT_TEXT}":'<input type="text" name="delay_threshold" maxlength="2" class="pwi7 paramField" />'})+
'</label></div></div><% for (var i = 1; i <= 2; i++) { %><div id="not_started_<%- i %>"><div class="param_line"><label>'+r(10451,{"{HTML_INPUT_TEXT}":'<input type="text" name="not_started_<%- i %>_time" maxlength="2" class="pwi7 paramField" />'})+'</label></div></div><% } %><div id="not_activated"><div class="param_line"><label>'+r(10455,{"{HTML_INPUT_TEXT}":'<input type="text" name="not_activated_time" maxlength="2" class="pwi7 paramField" />'})+'</label></div></div><div id="sw_warning"><div class="param_line"><label>'+
r(10474,{"{HTML_INPUT_TEXT}":'<input type="text" name="sw_warning_time" maxlength="2" class="pwi7 paramField" />'})+'</label></div></div><div id="sla_warning"><div class="param_line"><label>'+r(18169,{"{HTML_INPUT_TEXT}":'<input type="text" name="sla_warning_time" maxlength="2" class="pwi7 paramField" />'})+'</label></div></div><div id="visit_reminder"><div class="param_line visit_notification_base" id="notification_visit_reminder">'+r(10752,{"{HTML_INPUT_INTERVAL_LIST}":'<input aria-labelledby="notification_visit_reminder" type="text" name="visit_reminder_interval" class="pwi3 paramField" />',
"{HTML_INPUT_SILENT_INTERVAL}":'<input aria-labelledby="notification_visit_reminder" type="text" name="visit_reminder_silent_interval" class="pwi3 paramField" maxlength="4" />',"{HTML_SELECT_NOTIFICATION}":'<select aria-labelledby="notification_visit_reminder" name="visit_notification_base" class="selectNotification pwi1 paramField"></select>'})+'</div><div class="triggerNote infoNote"></div></div><% for (var i = 1; i <= 5; i++) { %><div id="visit_today_<%- i %>"><div class="param_line visit_notification_base" id="notification_visit_changes_<%- i %>">'+
r(224952,{"{HTML_INPUT_TEXT_THRESHOLD}":'<input aria-labelledby="notification_visit_changes" type="text" name="threshold_visit_today_<%- i %>" maxlength="4" class="pwi5 paramField" />',"{HTML_SELECT_NOTIFICATION}":'<select aria-labelledby="notification_visit_changes" name="visit_notification_base" class="selectNotification pwi1 paramField"></select>',"{HTML_INPUT_TEXT_START}":'<input aria-labelledby="notification_visit_changes" type="text" name="start_visit_today_<%- i %>" maxlength="4" class="pwi5 paramField" />',
"{HTML_INPUT_TEXT_END}":'<input aria-labelledby="notification_visit_changes" type="text" name="end_visit_today_<%- i %>"   maxlength="4" class="pwi5 paramField" />'})+'</div><div class="triggerNote infoNote"></div></div><% } %><div id="trigger_warning" class="infoNote"></div></div></form></div>',render:function(b,d){c.prototype.render.apply(this,arguments);var g=this._$el.find("#notification_params"),k=this.model.get("notification_trigger_param");g.find("select.selectNotification").append('<option value=""></option>');
for(var l in this.priorToValues)g.find("select.selectNotification").append('<option value="'+l+'">'+this.priorToValues[l]+"</option>");if("undefined"===typeof k)return this._$el.find("#select__notification_trigger").prepend('<option value="" selected></option>'),this;l=k.attributes.params||[];var k=k.attributes.label||"",n=g.find("#"+k),g=this._$el.find("#select__notification_trigger");$.each(l,function(b,c){n.find("input[name='"+b+"']").val(c.value);"visit_notification_base"!==b&&"Notify30_60"!==
b||n.find('[name="'+b+'"]').val(c.value)});g.val(k);g.find("option[value='"+k+"']").removeAttr("disabled");g.trigger("change");this.readOnlyMode&&($(".NotificationItemForm form input").attr({disabled:"disabled"}),$(".NotificationItemForm form select").attr({disabled:"disabled"}));return this},selectNotificationTrigger:function(b){this.cleanUpForm();var c=$(b.target).find(":selected").val();if(c){b=this.model.get("notification_triggers")[c];var d=$("#notification_params > #"+c);0<d.length&&d.css("display",
"inline-block");var k=this._$el.find("#notification_params").find("#"+c);$.each(b.params,function(b,c){"visit_notification_base"!==b&&"Notify30_60"!==b||k.find('[name="'+b+'"]').val(c.value)});0<b.scenario_id&&b.scenario_id!=this.model.get("scenario_id")&&(b=(c=this.model.get("message_scenarios").find("scenario_id",b.scenario_id))?c.attributes.translation:b.scenario_id,$("#trigger_warning").html(r(19171,{"{MESSAGE_SCENARIO_NAME}":"<b>"+b+"</b>"})+"<br />"+h(16620)),$("#notification_params > #trigger_warning").show());
$(".Notify30_60>select").trigger("change")}},changeTriggerAdditionalParams:function(b){var c=$(b.target).parent().parent().find(".triggerNote");c.html("");c.hide();var d=$(b.target).val();if(d){var k=19175;switch(c.parent().attr("id")){case "reminder":k=19176;$('#notification_params > div:hidden > div.param_line select[name="Notify30_60"]').val(d);break;case "today_1":case "today_2":case "today_3":case "today_4":case "today_5":k=19175;$('#notification_params > div:hidden > div.param_line select[name="Notify30_60"]').val(d);
break;case "visit_reminder":k=16689;$('#notification_params > div:hidden > div.param_line select[name="visit_notification_base"]').val(d);break;case "visit_today_1":case "visit_today_2":case "visit_today_3":case "visit_today_4":case "visit_today_5":k=16621,$('#notification_params > div:hidden > div.param_line select[name="visit_notification_base"]').val(d)}c.html(r(k,{"{PRIOR_TO_VALUE}":"<b>"+this.priorToValues[d]+"</b>"}));c.show();this.changeParamValue(b)}},cleanUpForm:function(){$("#notification_params > div, .popup-footer .popup-errors, .triggerNote ").hide();
this.unhilightFields()},unhilightFields:function(b){$(b||"#notification_params > div > div.param_line .paramField, div.NotificationItemForm div.notification_trigger *").removeClass("hilightError")},hilightFields:function(b){var c=[];$.each(b,function(b,d){"select__notification_trigger"===d?c.push("div.NotificationItemForm div.notification_trigger select#"+d):c.push('#notification_params > div:visible > div.param_line [name="'+d+'"]')});$(c.join(",")).addClass("hilightError")},changeParamValue:function(b){this.unhilightFields(b.target)}}))})(toa);(function(d){var c=d.views.messageScenarios.BaseView;d.ns("toa.views.messageScenarios.assignedNotifications.NoNotifications",d.define(c,function(){c.apply(this,arguments)},{template:'<div class="emptySection noNotifications"><%= h(19103)/* No assigned notifications */ %></div>'}))})(toa);(function(d){var c=d.views.messageScenarios.BaseCollectionView;d.ns("toa.views.messageScenarios.assignedNotifications.NotificationsList",d.define(c,function(){c.apply(this,arguments)},{events:{"click .addNotification":"actionAdd"},template:'<h1 class="settingsSection"><%= h(19118)/* Notifications */ %><% if (!readOnlyMode) { %><button tabindex="0" class="sectionsAddButton addNotification"><%= h(19127) /* Add new */ %></button><% } %></h1><div class="notificationsListContainer"></div>',childView:d.views.messageScenarios.assignedNotifications.Notification,
childRegion:".notificationsListContainer",noItemsView:d.views.messageScenarios.assignedNotifications.NoNotifications,actionAdd:function(b){this.notify("notificationaction:add",b,this)},renderStatistics:function(b){if(this._childViews.length)for(var c in this._childViews){var d=this._childViews[c],k=d.model.getId();d.renderStatistics({messages:b[k]||0})}}}))})(toa);(function(d){var c=d.views.messageScenarios.BaseView;d.ns("toa.views.messageScenarios.scenarioSteps.StepStatisticsChart",d.define(c,function(){c.apply(this,arguments);this.minWidth=4;this.maxCount=+this.model.get("maxCount",0);this.todayCount=+this.model.get("todayCount",0);this.sendingCount=+this.model.get("sendingCount",0)},{template:'<div class="chartSection total"><span class="chartSection today"></span><span class="chartSection sending"></span></div>',render:function(b,d){c.prototype.render.apply(this,
arguments);0<this.maxCount&&this.renderBars();return this},renderBars:function(){this._container.find(".chartSection.total").css({height:"26px","min-width":this.minWidth+"px",width:"100%","overflow-x":"visible","overflow-y":"hidden"});this.renderToday();this.renderSending()},renderToday:function(){if(0===this.todayCount)return!1;var b=this._container.find(".chartSection.total").width()-this.minWidth,c=Math.floor(this.todayCount/this.maxCount*100);b<c&&(c=b);this._container.find(".chartSection.today").css({height:"26px",
display:"block","float":"left","min-width":this.minWidth+"px",width:c+"%"})},renderSending:function(){if(0===this.sendingCount)return!1;var b=this._container.find(".chartSection.total").width()-this.minWidth,c=Math.floor(this.sendingCount/this.maxCount*100);b<c&&(c=b);this._container.find(".chartSection.sending").css({height:"26px",display:"block","float":"left","min-width":this.minWidth+"px",width:c+"%"})}}))})(toa);(function(d){var c=d.views.messageScenarios.BaseView;d.ns("toa.views.messageScenarios.scenarioSteps.StepItem",d.define(c,function(){c.apply(this,arguments)},{events:{"click span.stepName":"actionModify","keypress span.stepName":"actionModify"},template:'<tr class="stepItem"><td class="stepItemCell stepType"><div class="stepIcon <%- type %>"></div></td><th scope="row" class="stepItemCell stepGeneralInfo font-normal" aria-label="<%- name %>"><div><span role="link" tabindex="0" id="<%- stepNameId %>" class="stepName" ><%- name %></span><span class="stepViewActions" id="desc_<%- stepNameId %>"><%- h(8074)/*Click to view actions*/ %></span></div><div class="stepMethod"><%- method %></div><% if (true && error) { %><div role="status" class="stepError"><%= h(error) %></div><% } %></th><td class="stepItemCell stepParameters"><div><span><%= r(18072, {"{CAPTION}": "<b>"+h(11104)+"</b>","{TEXT}":  h(a_mssend_at)}) %> <% if (mssend_day_shift != 0) { %> <% if (mssend_day_shift > 0) { %>+<% } %><%- mssend_day_shift %> <%= h(3210 /* days */) %> <% } %><% if (mssend_at != "time_of_event") { %><%= h(5409 /* Start time */) %> <% if (mssend_from_h >= 12) { %><%- (mssend_from_h-12) %>:<%- mssend_from_m %>PM<% } else { %><% if (mssend_from_h == "00") { %>12<% } else { %><%- mssend_from_h %><% } %>:<%- mssend_from_m %>AM<% } %><% } %></span> </div><div class="msskipWeekdays"><% if (msskip_weekdays != 0) { %><b><%= h(6817 /* Block messages for specific days */) %></b>: <span class="msskip_weekdays"><%- msskip_weekdays %></span><% } %></div></td><td class="stepItemCell stepStatistics today"><div class="count">...</div></td><td class="stepItemCell stepStatistics sending"></td><td class="stepItemCell stepStatisticsChart"></td><td class="stepItemCell stepActions"></td></tr>',
templateMessages:'<div class="count"><%- statisticsTotal || 0 %></div><div class="text"><%= h(19124 /* In queue */) %></div>',templateStatsSending:'<% if (statisticsSending > 0) { %><div class="count"><%- statisticsSending || 0 %></div><div class="text"><%= h(19134) /* Sending */ %></div><% } %>',render:function(b,d){var g=generate_id();this.model.set({stepNameId:g});c.prototype.render.apply(this,arguments);this.showStepMenu(g);this.fillWeekDays();return this},renderStatistics:function(b){var c=new d.Template(this.templateMessages);
this._$el.find(".stepItemCell.stepStatistics.today").html($(c.apply({statisticsTotal:b.total})));c=new d.Template(this.templateStatsSending);this._$el.find(".stepItemCell.stepStatistics.sending").html($(c.apply({statisticsSending:b.sending})));this.drawChart(b)},fillWeekDays:function(){var b="",c=this._$el.find(".stepItemCell .msskip_weekdays").text();if(void 0!=c&&""!=c){for(var c=c.split(","),d=0;d<c.length;d++)void 0!=c[d]&&(b+=h(c[d]),b+=", ");this._$el.find(".stepItemCell .msskip_weekdays").text(b.slice(0,
-2))}},showStepMenu:function(b){var c=[];this.readOnlyMode?c.push({name:"actionView",addClass:"toa-dropdown-item msgScenarioView",text:h(8047),attr:{tabindex:0,onkeypress:"if(event.which === 13) {$(event.target).click();}"}}):c=[{name:"actionModify",addClass:"toa-dropdown-item msgScenarioEdit",text:h(19136),attr:{tabindex:0,onkeypress:"if(event.which === 13) {$(event.target).click();}"}},{name:"actionDelete",addClass:"toa-dropdown-item msgScenarioDelete",text:h(19137),attr:{tabindex:0,onkeypress:"if(event.which === 13) {$(event.target).click();}"}}];
this.menuButton=d.view.control.create({xtype:"button.Menu",name:"stepMenuButton",text:"",addClass:"toa-item-menu-button",attr:{role:"button",tabindex:"0","aria-haspopup":"true","aria-labelledby":b,"aria-describedby":"desc_"+b},icon:"toa-item-menu-icon",menuItems:c,listeners:{menuItemClick:this.actionMenuItemClick.bind(this)}});this.menuButton.render(this._$el.find(".stepItemCell.stepActions"))},drawChart:function(b){b={maxCount:b.total||this.model.getMaxMessages(),todayCount:b.new||this.model.getStatisticsParam("new"),
sendingCount:b.sending||this.model.getStatisticsParam("sending")};(new d.views.messageScenarios.scenarioSteps.StepStatisticsChart({model:new d.models.messageScenarios.BaseModel(b)})).render(this._$el.find(".stepItemCell.stepStatisticsChart"))},actionMenuItemClick:function(b,c){var d=Array.prototype.slice.call(arguments);d[0]=b;this[c.name].apply(this,d)},actionView:function(b){this.notify("stepaction:view",b,this)},actionModify:function(b){if("keypress"!==b.type||13===b.keyCode)this.notify("stepaction:"+
(this.readOnlyMode?"view":"modify"),b,this),b.preventDefault()},actionDelete:function(b){if(this.readOnlyMode)return!1;this.notify("stepaction:delete",b,this)}}))})(toa);(function(d){var c=d.views.messageScenarios.BaseView;d.ns("toa.views.messageScenarios.scenarioSteps.NoSteps",d.define(c,function(){c.apply(this,arguments)},{template:'<tr><td class="emptySection noSteps"><%= h(19135)/* No steps */ %></td></tr>'}))})(toa);(function(d){var c=d.views.messageScenarios.BaseCollectionView;d.ns("toa.views.messageScenarios.scenarioSteps.StepsList",d.define(c,function(){c.apply(this,arguments)},{idFieldName:"step_id",events:{"click .addStep":"actionAdd"},template:'<h1 class="settingsSection"><%= h(19119)/* Scenario steps */ %><% if (!readOnlyMode) { %><button tabindex="0" class="sectionsAddButton addStep"><%= h(19127) /* Add new */ %></button><span class="rwMessageTitle"><%= h(19123)/* Messages */%></span><% } else { %><span class="roMessageTitle"><%= h(19123)/* Messages */%></span><% } %></h1><div class="endlessLoopWarningMsg warning"></div><table class="stepsListContainer" aria-label="<%= h(19119)/* Scenario steps */ %>"></table>',
childView:d.views.messageScenarios.scenarioSteps.StepItem,childRegion:".stepsListContainer",noItemsView:d.views.messageScenarios.scenarioSteps.NoSteps,actionAdd:function(b){this.notify("stepaction:add",b,this)},renderStatistics:function(b){if(this._childViews.length)for(var c in this._childViews){var d=this._childViews[c],k=d.model.getId(),k=b[k]||{};d.renderStatistics({total:k.total||0,"new":k.new||0,sending:k.sending||0})}},showEndlessLoop:function(b){$(".endlessLoopWarningMsg").html("").hide();
if(b.length){var c="<ul>";Object.keys(b).forEach(function(d){c+=b[d]});c+="</ul>";c='<div class="endlessMsg">'+r(18013,{"{LOOP}":c})+"</div>";$(".endlessLoopWarningMsg").html(c).show()}}}))})(toa);(function(d){var c=d.views.messageScenarios.BaseView;d.ns("toa.views.messageScenarios.SettingsPanel",d.define(c,function(){c.apply(this,arguments)},{regions:{generalSection:".scenarioGeneralRegion",notificationsSection:".scenarioNotificationsRegion",stepsSection:".scenarioStepsRegion"},template:'<div class="settingsContainer"><div class="settingsContainerInner"><div class="settingsSections"><div class="scenarioGeneralRegion"></div><div class="scenarioNotificationsRegion"></div><div class="scenarioStepsRegion"></div></div></div></div>'}))})(toa);(function(d,c){d.ns("toa.messageScenarios.ServerConnector",d.define(null,function(b,c){this._triggerFunction=b;this._controller=c},{_triggerFunction:function(){},_controller:"",request:function(b,d){var g=c.Deferred();this._triggerFunction("global.data.get",{controller:this._controller,method:b,params:d||{},responseHandler:function(b,c){c.status&&"OK"===c.status?g.resolve(c):g.reject(c.error_code||0)}.bind(this)});return g.promise()}}))})(toa,$);(function(d,c){d.ns("toa.messageScenarios.DataMapper",d.define(null,function(b){this._serverConnector=b},{_modelConstructor:function(){},_serverGetMethod:"",_serverSaveMethod:"",_serverRemoveMethod:"",_serverGetField:"",_serverIdField:"",load:function(b,d){d=d||{};this._serverIdField&&(d[this._serverIdField]=b.id);var g=c.Deferred(),k=this._serverConnector.request(this._serverGetMethod,d);k.done(function(c){c&&c[this._serverGetField]||g.reject('Field "'+this._serverGetField+'" is not available');
try{this._fillModel(b,c[this._serverGetField]),g.resolve(b)}catch(d){g.reject("Unable to fill model with given data ("+d.message+")")}}.bind(this));k.fail(function(b){g.reject("Server error ("+b+") has occurred")});return g.promise()},create:function(b){var c=new this._modelConstructor;this._fillModel(c,b||{});return c},save:function(b){return this._serverConnector.request(this._serverSaveMethod,this.serialize(b))},remove:function(b){var c={};this._serverIdField&&(c[this._serverIdField]=b.id);return this._serverConnector.request(this._serverRemoveMethod,
c)},_fillModel:function(b,c){b.reset({},{silent:!0});b.set(c,{silent:!0})},serialize:function(b){return b.toJSON()}}))})(toa,$);(function(d,c){var b=d.messageScenarios.DataMapper;d.ns("toa.messageScenarios.ComplexDataMapper",d.define(b,function(c,d){b.apply(this,arguments);this._fieldMappers=d},{_fillModel:function(b,d){b.reset({},{silent:!0});c.each(d,function(c,d){var g={};if(this._fieldMappers&&c in this._fieldMappers){var p=this._fieldMappers[c].create(d);null!==p&&(g[c]=p,b.subscribeOnChild(p))}else g[c]=d;b.set(g,{silent:!0})}.bind(this))},serialize:function(b){var d=b.toJSON();c.each(d,function(c,l){if(this._fieldMappers&&
c in this._fieldMappers){var n=this._fieldMappers[c].serialize(b.get(c));null!==n?d[c]=n:delete d[c]}}.bind(this));return d}}))})(toa,$);(function(d,c){var b=d.messageScenarios.DataMapper;d.ns("toa.messageScenarios.CollectionDataMapper",d.define(b,function(c,d){b.apply(this,arguments);this._itemMapper=d},{_modelConstructor:d.models.messageScenarios.BaseCollection,create:function(b){var c=new this._modelConstructor;this._comparator&&"function"===typeof this._comparator&&(c.comparator=this._comparator);this._fillModel(c,b||{});return c},_fillModel:function(b,d){b.clear({silent:!0});c.each(d,function(c,d){var g=this._itemMapper.create(d);
b.add(g,{silent:!0})}.bind(this))},serialize:function(b){var c=[];b.each(function(b){c.push(this._itemMapper.serialize(b))},this);return c}}))})(toa,$);(function(d,c){d.ns("toa.messageScenarios.NullDataMapper",d.define(d.messageScenarios.DataMapper,null,{create:function(b){return null},serialize:function(b){return null}}))})(toa,$);(function(d){var c=d.messageScenarios.DataMapper;d.ns("toa.messageScenarios.dataMappers.BaseDataMapper",d.define(c,function(b){c.apply(this,arguments)},{_modelConstructor:d.models.messageScenarios.BaseModel}))})(toa);(function(d){var c=d.messageScenarios.CollectionDataMapper;d.ns("toa.messageScenarios.dataMappers.BaseCollectionDataMapper",d.define(c,function(b,d){c.apply(this,arguments);this._itemMapper=d},{_modelConstructor:d.models.messageScenarios.BaseCollection}))})(toa);(function(d){var c=d.messageScenarios.DataMapper;d.ns("toa.messageScenarios.dataMappers.MessageScenarioDataMapper",d.define(c,function(b){c.apply(this,arguments)},{_modelConstructor:d.models.messageScenarios.MessageScenario,_serverSaveMethod:"create",_serverRemoveMethod:"delete",_serverIdField:"message_scenario_id",save:function(b,d){this._serverSaveMethod="create";"undefined"!==typeof b.get("message_scenario_id")&&""!=b.get("message_scenario_id")&&(this._serverSaveMethod="modify");return c.prototype.save.apply(this,
arguments)}}))})(toa);(function(d,c){var b=d.messageScenarios.CollectionDataMapper;d.ns("toa.messageScenarios.dataMappers.ScenariosListDataMapper",d.define(b,function(c,d){b.apply(this,arguments)},{_modelConstructor:d.models.messageScenarios.SortableCollection,_serverGetMethod:"getList",_serverGetField:"message_scenarios"}))})(toa,$);(function(d){var c=d.messageScenarios.DataMapper;d.ns("toa.messageScenarios.dataMappers.InitialDataMapper",d.define(c,function(b){c.apply(this,arguments)},{_modelConstructor:d.models.messageScenarios.BaseModel,_serverGetMethod:"getInitialData",_serverGetField:"initial_data",_serverGetStatsMethod:"getStatistics",_serverStatsField:"statistics",_serverIdField:"scenario_id",loadStatistics:function(b,c){c=c||{};this._serverIdField&&(c[this._serverIdField]=b.id);var d=$.Deferred(),k=this._serverConnector.request(this._serverGetStatsMethod,
c);k.done(function(b){b&&b[this._serverStatsField]||d.reject('Field "'+this._serverStatsField+'" is not available');d.resolve(b[this._serverStatsField])}.bind(this));k.fail(function(b){d.reject("Server error ("+b+") has occurred")}.bind(this));return d.promise()}}))})(toa);(function(d,c){var b=d.messageScenarios.DataMapper;d.ns("toa.messageScenarios.dataMappers.SettingsDataMapper",d.define(b,function(c){b.apply(this,arguments)},{_modelConstructor:d.models.messageScenarios.BaseModel,_serverGetMethod:"getItem",_serverSaveMethod:"modify",_serverGetField:"message_scenario",_serverIdField:"message_scenario_id"}))})(toa,$);(function(d,c){var b=d.messageScenarios.CollectionDataMapper;d.ns("toa.messageScenarios.dataMappers.NotificationsListDataMapper",d.define(b,function(c,d){b.apply(this,arguments)},{_modelConstructor:d.models.messageScenarios.BaseCollection,_serverGetMethod:"loadAssignedNotifications",_serverGetField:"assigned_notifications"}))})(toa,$);(function(d){var c=d.messageScenarios.DataMapper;d.ns("toa.messageScenarios.dataMappers.NotificationDataMapper",d.define(c,function(b){c.apply(this,arguments)},{_modelConstructor:d.models.messageScenarios.Notification,_serverSaveMethod:"assignNotification",_serverRemoveMethod:"removeNotification",_serverIdField:"label",serialize:function(b){return{scenario_id:b.get("scenario_id"),trigger_params_values:b.get("trigger_params_values"),trigger_label:b.get("trigger_label")}}}))})(toa);(function(d,c){var b=d.messageScenarios.CollectionDataMapper;d.ns("toa.messageScenarios.dataMappers.ScenarioStepsListDataMapper",d.define(b,function(c,d){b.apply(this,arguments)},{_modelConstructor:d.models.messageScenarios.SortableCollection,_serverGetMethod:"loadScenarioSteps",_serverGetField:"scenario_steps",_fillModel:function(d,g){b.prototype._fillModel.apply(this,arguments);this.countMaxMessages(d);c.each(d.models,function(b,c){c.setMaxMessages(0)})},countMaxMessages:function(b){var d=0;c.each(b.models,
function(b,c){var e=c.getStatisticsParam("total");e>d&&(d=e)});return d}}))})(toa,$);(function(d){var c=d.messageScenarios.DataMapper;d.ns("toa.messageScenarios.dataMappers.ScenarioStepDataMapper",d.define(c,function(b){c.apply(this,arguments)},{_modelConstructor:d.models.messageScenarios.ScenarioStep,_serverRemoveMethod:"deleteScenarioStep",_serverIdField:"step_id"}))})(toa);(function(d){d.ns("toa.controllers.MessageScenarios",d.define(d.Controller,function(c){this.sandbox=c;this.pageLabel=this.sandbox.name;this.content=c.options.content;this.triggerFunction=c.trigger.bind(c);this.setDefaultState();this.sandbox.bind("toa.controllers.MessageScenarios.refreshStepList",function(b,c){this.afterChangeMessageScenario(!0)}.bind(this));this.sandbox.bind("toa.controllers.MessageScenarios.unlockStep",function(b,c){this.stepControllerLocked=!1}.bind(this));this.resume()},{messageStepController:null,
stepControllerLocked:!1,toString:function(){return"MessageScenarios config screen controller"},createPanelTitle:function(){d.datetime.formatDate("iso",d.datetime.currentDate());this.panel=d.view.control.create({xtype:"PanelTitleAlta",addClass:"jet-css-only toa-panel-title jet-screen-title panel-title-messagescenario-settings",name:"titleCaption",titleText:h(19101),resourceTreeButton:!1,backButton:!0,backButtonIcon:"",headerResponsive:_DATA.page_label,backButtonLabel:_DATA.glossary.action_links.company_settings_configuration,
backButtonHint:h(16257),filter:!1,calendar:!1,listeners:{backButtonClick:function(){$app.navigation().redirect("company_settings_configuration")}},actions:[{xtype:"Button",label:h(19164),name:"delivery_channels",listeners:{click:this.onSwitchScreenClick.bind(this,"company_settings_delivery_channels")}}]});this.panel.render(this.content)},resume:function(){this.triggerFunction("layout.tabs.set",{tabs:0,show:0});this.createPanelTitle();this.initModels();this.initViews();this.showInitialViews();this.messageStepController=
null;this.stepControllerLocked=!1;this.initialDataMapper.load(this.initialModel).done(this.setInitial.bind(this)).fail(function(c){this.sandbox.error(c);this.showError(h(15367))}.bind(this))},setInitial:function(c){this.setState("allowModify",c.get("allow_modify"));!0===c.get("channels_warning")&&this.panel.getChild("actionPanel").findChild("delivery_channels").addClass("button-icon-warning");this.scenariosListMapper.load(this.scenariosListCollection).done(this.showPanelContent.bind(this)).fail(function(b){this.sandbox.error(b);
this.showError(h(19112))}.bind(this))},initModels:function(){var c=new d.messageScenarios.ServerConnector(this.triggerFunction,"messagescenario"),b=new d.messageScenarios.dataMappers.BaseDataMapper(c);new d.messageScenarios.dataMappers.BaseCollectionDataMapper(c,b);this.messageScenarioMapper=new d.messageScenarios.dataMappers.MessageScenarioDataMapper(c);this.scenariosListMapper=new d.messageScenarios.dataMappers.ScenariosListDataMapper(c,this.messageScenarioMapper);this.scenariosListCollection=this.scenariosListMapper.create();
this.initialDataMapper=new d.messageScenarios.dataMappers.InitialDataMapper(c);this.initialModel=this.initialDataMapper.create();this.getState("currentMessageScenarioModel")||this.setState("currentMessageScenarioModel",this.messageScenarioMapper.create());this.settingsMapper=new d.messageScenarios.dataMappers.SettingsDataMapper(c);this.settingsModel=this.settingsMapper.create();this.notificationMapper=new d.messageScenarios.dataMappers.NotificationDataMapper(c);this.notificationsListMapper=new d.messageScenarios.dataMappers.NotificationsListDataMapper(c,
this.notificationMapper);this.notificationsCollection=this.notificationsListMapper.create();this.scenarioStepMapper=new d.messageScenarios.dataMappers.ScenarioStepDataMapper(c);this.scenarioStepsListMapper=new d.messageScenarios.dataMappers.ScenarioStepsListDataMapper(c,this.scenarioStepMapper);this.scenarioStepsCollection=this.scenarioStepsListMapper.create()},initViews:function(){this.containerView=new d.views.messageScenarios.Container;this.listPanelView=new d.views.messageScenarios.ListPanel;
this.listControlsView=new d.views.messageScenarios.messageScenariosList.ListControls;this.listControlsView.addListener("scenarioaction:add",this.onMessageScenarioAdd,this);this.listControlsView.addListener("scenarioaction:delete",this.onMessageScenarioDelete,this);this.listView=new d.views.messageScenarios.messageScenariosList.ListItems({collection:this.scenariosListCollection});this.listView.addListener("scenario:selected",this.onScenarioSelected,this);this.settingsPanelView=new d.views.messageScenarios.SettingsPanel;
this.generalSectionView=new d.views.messageScenarios.GeneralSection({model:this.settingsModel});this.generalSectionView.addListener("scenarioaction:edit",this.onMessageScenarioEdit,this);this.notificationsView=new d.views.messageScenarios.assignedNotifications.NotificationsList({collection:this.notificationsCollection});this.notificationsView.addListener("notificationaction:add",this.onNotificationAdd,this);this.notificationsView.addListener("notificationaction:remove",this.onNotificationRemove,this);
this.notificationsView.addListener("notificationaction:edit",this.onNotificationEdit,this);this.notificationsView.addListener("notificationaction:view",this.onNotificationView,this);this.stepsView=new d.views.messageScenarios.scenarioSteps.StepsList({collection:this.scenarioStepsCollection});this.stepsView.addListener("stepaction:add",this.onScenarioStepAdd,this);this.stepsView.addListener("stepaction:delete",this.onScenarioStepDelete,this);this.stepsView.addListener("stepaction:modify",this.onScenarioStepModify,
this);this.stepsView.addListener("stepaction:view",this.onScenarioStepModify,this)},showInitialViews:function(){this.screen=$('<div id="toa-messagescenarios-screen"></div>');this.content.append(this.screen);this.containerView.render(this.screen)},showPanelContent:function(c){var b=-1;this.containerView.showRegion("leftPanel",this.listPanelView);this.containerView.showRegion("rightPanel",this.settingsPanelView);this.listPanelView.showRegion("controls",this.listControlsView);this.listPanelView.showRegion("list",
this.listView);var d=this.scenariosListCollection.getCount();this.getState("allowModify")?0===d&&this.listControlsView.disableControl("remove"):(this.listControlsView.disableControls(),this.hideControls([this.generalSectionView,this.notificationsView,this.stepsView]));c&&(b=this.listView.setActiveItem(c,!1,!0));0>b&&this.listView.selectFirst()},hideControls:function(c){$.each(c,function(b,c){c.setReadOnlyMode(!0)})},getCurrentScenarioId:function(){return this.getState("currentMessageScenarioModel").getId()},
onScenarioSelected:function(c,b,d){this.displayMessageScenario(b.model)},displayMessageScenario:function(c){this.getState("currentMessageScenarioModel").reset(c.toJSON());this.listView.setActiveItem(c,!0);this.showSections()},showSections:function(){this.showGeneralSection();this.showNotificationsSection();this.showStepsSection();this.showStatistics()},showStatistics:function(){var c=this.settingsModel;c.set({id:this.getCurrentScenarioId()},{silent:!0});return this.initialDataMapper.loadStatistics(c).done(function(b){if(b.scenario_id==
this.getCurrentScenarioId())var c=window.setTimeout(function(){this.notificationsView.renderStatistics(b.notification_triggers||{});this.stepsView.renderStatistics(b.steps||{});window.clearTimeout(c)}.bind(this),500)}.bind(this))},showGeneralSection:function(){var c=this.settingsModel;c.set({id:this.getCurrentScenarioId()},{silent:!0});return this.settingsMapper.load(c).done(function(){this.settingsPanelView.showRegion("generalSection",this.generalSectionView)}.bind(this)).fail(function(b){this.sandbox.error(b);
this.showError(h(19121))}.bind(this))},showNotificationsSection:function(){var c=this.getCurrentScenarioId();return this.notificationsListMapper.load(this.notificationsCollection,{message_scenario_id:c}).done(function(){this.settingsPanelView.showRegion("notificationsSection",this.notificationsView)}.bind(this)).fail(function(b){this.sandbox.error(b);this.showError(h(19122))}.bind(this))},showStepsSection:function(){var c=this.getCurrentScenarioId();return this.scenarioStepsListMapper.load(this.scenarioStepsCollection,
{message_scenario_id:c}).done(function(){this.settingsPanelView.showRegion("stepsSection",this.stepsView);var b=this.settingsModel.get("endless_warning_list",[]);this.stepsView.showEndlessLoop(b)}.bind(this)).fail(function(b){this.sandbox.error(b);this.showError(h(19132))}.bind(this))},refreshScenarioList:function(){var c=this.scenariosListCollection.getCount(),b=this.listView;if(0===c)return this.listControlsView.disableControl("remove"),this.listPanelView.showRegion("list",this.listView),this.containerView.showRegion("rightPanel",
this.settingsPanelView),!1;this.getState("allowModify")&&this.listControlsView.enableControl("remove");c=b.getActiveItem();if("undefined"!==typeof c&&null!==c)var d=b.getViewIndexByModel(c);this.getState("newScenario")&&this.getCurrentScenarioId()&&(c=this.getState("currentMessageScenarioModel"),this.setState("newScenario",!1));this.listPanelView.showRegion("list",b);0>b.setActiveItem(c,!0,!0)&&(c=b.getSiblingChildView(d));b.setActiveItem(c,!1,!0)},onNotificationAdd:function(c){this.createPopupMSNotifications({action:"add"})},
onNotificationEdit:function(c,b){var d=this.initialModel.get("notification_triggers"),g=b.model;if(g&&g.id&&(g=g.id,d[g]&&d[g].additional_constraints&&d[g].additional_constraints.hide_popup))return;this.createPopupMSNotifications({notification_trigger_param:b.model,action:"edit"})},onNotificationView:function(c,b){this.createPopupMSNotifications({notification_trigger_param:b.model,action:"view"})},createPopupMSNotifications:function(c){this.NotificationItemModel=d.create("toa.models.messageScenarios.NotificationItem",
c);var b=this.initialModel.get("notification_triggers"),e={},g;for(g in b)b[g].additional_constraints&&b[g].additional_constraints.hide_popup||(e[g]=b[g]);this.NotificationItemModel.set({scenario_id:this.getCurrentScenarioId(),message_scenarios:this.scenariosListCollection,notification_triggers:e});this.NotificationItemView=d.create("toa.views.messageScenarios.assignedNotifications.NotificationItem",{model:this.NotificationItemModel});"view"===c.action&&this.NotificationItemView.setReadOnlyMode(!0);
b="";switch(c.action){case "add":b=h(19128);break;case "edit":b=r(19170,{"{LAUNCH_CONDITION_NAME}":c.notification_trigger_param.get("translation")});break;default:b=h(19118)}e=[{text:h(14621),position:"left",click:function(){k.destroy()}}];"add"!==c.action&&"edit"!==c.action||e.push({text:h(12252),type:"submit",position:"right",click:function(b){this.onNotificationTriggerSave(b,k)}.bind(this)});var k=new d.ui.Popup({title:b,autoOpen:!0,view:this.NotificationItemView,modal:!0,onClose:function(){k.destroy()},
buttons:e})},onNotificationTriggerSave:function(c,b){$(c.target).removeClass("toa-button-active").addClass("toa-button-disable");var d=$("#notification_params > div:visible > div.param_line .paramField"),g={},k=this.NotificationItemModel.get("action");$.each(d,function(b,c){g[$(c).attr("name")]=$(c).val()});this.NotificationItemModel.set({trigger_params_values:g,trigger_label:$("#select__notification_trigger").val()});this.notificationMapper.save(this.NotificationItemModel).done(function(c){c=this.NotificationItemModel.get("trigger_label");
var d=!1;!1!==this.NotificationItemModel.get("notification_trigger_param",!1)&&(d=this.NotificationItemModel.get("notification_trigger_param").get("label"));"edit"===k&&!1!==d&&d!==c?(this.NotificationItemModel.set({label:d}),this.notificationMapper.remove(this.NotificationItemModel).done(function(c){b.destroy();this.afterChangeMessageScenario(!0)}.bind(this))):(b.destroy(),this.afterChangeMessageScenario(!0))}.bind(this)).fail(function(d){var e,g,k,t,u=[],v;for(v in d)g=d[v],k=g.placeholders||!1,
t=g.param_labels||!1,e=h(g.code),k&&(19174!==g.code&&$.each(k,function(b,c){k[b]=h(c)}),e=r(g.code,k)),t&&this.NotificationItemView.hilightFields(t),u[v]={id:"errorWhileSaving"+v,message:e};b.setErrors(u);$(c.target).removeClass("toa-button-disable").addClass("toa-button-active")}.bind(this))},onNotificationRemove:function(c,b){var e=b.model;if(!e)return!1;var g=new d.ui.Popup({title:h(13294),autoOpen:!0,html:h(19125),modal:!0,buttons:[{text:h(14621),position:"left",click:function(){g.destroy()}},
{text:h(12252),type:"submit",position:"right",click:function(b){this.notificationMapper.remove(e).done(this.afterChangeMessageScenario.bind(this)).fail(function(b){this.showError(h(19126)).always(this.refreshScenarioList.bind(this))}.bind(this));g.destroy()}.bind(this)}]})},onScenarioStepAdd:function(c){this.initMessageStep()},initMessageStep:function(c){!0!==this.stepControllerLocked&&(this.stepControllerLocked=!0,c=c||!1,c={scenarioId:this.getCurrentScenarioId(),stepId:c,readOnly:!1===this.getState("allowModify")},
this.messageStepController=new d.controllers.MessageScenarioStep(c))},onScenarioStepDelete:function(c,b){var e=b.model;if(!e)return!1;var g=new d.ui.Popup({title:h(13294),autoOpen:!0,html:h(19165),modal:!0,buttons:[{text:h(14621),position:"left",click:function(){g.destroy()}},{text:h(12252),type:"submit",position:"right",click:function(b){this.scenarioStepMapper.remove(e).done(this.afterChangeMessageScenario.bind(this)).fail(function(b){this.showError(h(19166)).always(this.refreshScenarioList.bind(this))}.bind(this));
g.destroy()}.bind(this)}]})},onScenarioStepModify:function(c,b){this.initMessageStep(b.model.get("step_id"))},createPopup:function(c,b){var e=d.create("toa.models.messageScenarios.MessageScenario",c),g=d.create("toa.views.messageScenarios.MessageScenario",{model:e}),k=new d.ui.Popup({title:"add"==b?h(19104):h(19105),autoOpen:!0,view:g,modal:!0,onClose:function(){k.destroy()},buttons:[{text:h(14621),position:"left",click:function(){k.destroy()}},{text:h(12252),type:"submit",position:"right",click:function(c){e.set({from:$("input.hide_from_date").val()});
$("input.to_enable:checked").length?e.set({to:$("input.hide_to_date").val()}):e.set({to:""});if(!g.validate())return!1;$(c.target).removeClass("toa-button-active").addClass("toa-button-disable");this.messageScenarioMapper.save(e).done(function(c){"add"===b&&(c=c.message_scenario,this.getState("currentMessageScenarioModel").reset(c),this.setState("newScenario",!0));this.afterChangeMessageScenario(!0);k.destroy()}.bind(this)).fail(function(b){var d,e=[],g;for(g in b)d=b[g].msg,d=16917==d?h(d,{"{FIELD}":b[g].field,
"{LENGTH}":b[g].maxLength}):20825==d?r(20825,{"{FROM_DATE}":r(18006),"{TO_DATE}":r(18007)}):h(d),e[g]={id:"errorWhileSaving"+g,message:d};k.setErrors(e);$(c.target).removeClass("toa-button-disable").addClass("toa-button-active")}.bind(this))}.bind(this)}]})},onMessageScenarioAdd:function(c,b){this.createPopup({name:"",label:"",from:"",to:"",to_enable:""},"add")},onMessageScenarioEdit:function(c,b){this.createPopup({message_scenario_id:this.settingsModel.get("scenario_id"),name:this.settingsModel.get("translation"),
label:this.settingsModel.get("label"),from:this.settingsModel.get("from"),to:this.settingsModel.get("to",""),to_enable:""!==this.settingsModel.get("to","")?"checked":""},"edit")},onMessageScenarioDelete:function(c,b){var e=this.scenariosListCollection.find("scenario_id",this.getState("currentMessageScenarioModel").getId()),g=!0;if(this.notificationsCollection&&this.notificationsCollection.models)for(var k=this.notificationsCollection.models,l=0;l<k.length;l++){var n=k[l].get("additional_constraints");
n&&n.disable_remove&&(g=!1)}var p=e&&e.isRemovable(this.initialModel.get("notification_triggers"))&&g?new d.ui.Popup({title:h(13294),autoOpen:!0,html:h(19113),modal:!0,buttons:[{text:h(14621),position:"left",click:function(){p.destroy()}},{text:h(12252),type:"submit",position:"right",click:function(b){this.messageScenarioMapper.remove(e).done(this.afterChangeMessageScenario.bind(this)).fail(function(b){var c=19114;3===b?c=19115:this.sandbox.error(b);this.showError(h(c)).always(this.refreshScenarioList.bind(this))}.bind(this));
p.destroy()}.bind(this)}]}):new d.ui.Popup({title:h(16005),autoOpen:!0,html:h(19116),modal:!0,buttons:[{text:h(13305),type:"submit",position:"right",click:function(){p.destroy()}}]})},afterChangeMessageScenario:function(c){var b=[this.scenariosListMapper.load(this.scenariosListCollection)];c&&b.push(this.initialDataMapper.load(this.initialModel));return $.when.apply($,b).done(this.refreshScenarioList.bind(this)).fail(function(b){this.sandbox.error(b);this.showError(h(19112))}.bind(this))},onSwitchScreenClick:function(c){d.app.trigger("layout.menu.click",
{label:c,url:"",name:h(15405)+" - "+h(19101),params:{}})},suspend:function(c){this.destroy()},destroy:function(){this.screen.empty()},setState:function(c,b){d.isString(c)?this.state[c]=b:d.isObject(c)?$.extend(this.state,c):!1===c&&this.setDefaultState()},getState:function(c){return this.state[c]},setDefaultState:function(){this.state=$.extend(this.state,{currentMessageScenarioModel:null,allowModify:!1,newScenario:!1})},showError:function(c,b){c=c||h(3057);b=b||h(5651);return this.showPopup(b,c)},
showPopup:function(c,b,e){c=c||"";b=b||"";var g=$.Deferred();e&&$.isArray(e)&&e.length?$.each(e,function(b,c){if("function"===typeof c.click){var d=c.click;c.click=function(){var b=Array.prototype.slice.call(arguments);b.unshift(g);d.apply(this,b)}}}.bind(this)):e=[{text:h(445),position:"right",tpl:'<button class="popup-button toa-button"></button>',click:function(){g.reject()}}];g.always(function(){k.destroy()});var k=new d.ui.Popup({title:c,autoOpen:!0,html:b,modal:!0,onClose:function(){k.destroy();
g.reject()},buttons:e});k._dom.base.id="toa-messagescenarios-popup";return g}}))})(toa);(function(d){var c=d.models.messageScenarios.BaseModel;d.ns("toa.models.messageScenarios.BlockingCondition",d.define(c,function(){c.apply(this,arguments)},{idField:"id",setEmpty:function(){var b={id:null,field:this.getDefault("field"),condition:this.getDefault("condition"),value:"",description:"",status:this.getDefault("status"),check_on:this.getDefault("checkOn"),order:0};this.set(b)},getField:function(b){return this.getModelField("field",b)},getCondition:function(b){return this.getModelField("condition",
b)},getStatus:function(b){return this.getModelField("status",b)},getCheckOn:function(b){return this.getModelField("check_on",b)},getOrder:function(){return+this.get("order",0)},getConditionText:function(){var b=this.getField(!0)+" "+this.getCondition(!0);this.isValueDisabled()||(b+=" ("+this.get("value","")+")");return b},isValueDisabled:function(){var b=this.getCondition();return"is_null"===b||"is_not_null"===b}}))})(toa);(function(d){var c=d.models.messageScenarios.BaseCollection;d.ns("toa.models.messageScenarios.BlockingConditionsCollection",d.define(c,function(){c.apply(this,arguments)},{comparator:function(b,c){var d=b.getOrder(),k=c.getOrder();return d===k?0:d?k?d<k?-1:1:1:-1},getNextId:function(){return this.getAutoIncrement("id")},getCompactList:function(b){b=b||!1;var c=[];$.each(this.models,function(d,k){if(!1===b||k.get("id")!==b.get("id")){var l={id:k.get("id",null),text:k.getConditionText(),order:k.getOrder()};
c.push(l)}}.bind(this));return c},changeOrder:function(b,c){c=c||0===c?c:null;if(null===b)$.each(this.models,function(b,d){var g=d.getOrder();g>c&&d.set({order:g-1},{silent:!0})});else{var d=b.getOrder(),k=b.get("id");null===c?$.each(this.models,function(b,c){var e=c.getOrder();c.get("id")!==k&&e>=d&&c.set({order:e+1},{silent:!0})}):c<d?$.each(this.models,function(b,n){var p=n.getOrder();n.get("id")!==k&&p>c&&p<=d&&n.set({order:p-1},{silent:!0})}):c>d&&$.each(this.models,function(b,n){var p=n.getOrder();
n.get("id")!==k&&p<c&&p>=d&&n.set({order:p+1},{silent:!0})})}this.sort()}}))})(toa);(function(d){var c=d.views.messageScenarios.BaseView;d.ns("toa.views.messageScenarios.scenarioStepPopup.BlockingConditionsTab",d.define(c,function(b){c.apply(this,arguments)},{regions:{list:".conditionsList",form:".conditionForm"},template:'<table class="pwc1" width="100%" cellpadding="0" cellspacing="0" border="0"><tr class="bct" valign="top" style="font-weight: normal;"><td><div id="blockingConditionsContainer"><div class="tabContent conditionsList"></div><div class="tabContent conditionForm"></div></div></td></tr></table>'}))})(toa);(function(d){var c=d.views.messageScenarios.BaseView;d.ns("toa.views.messageScenarios.scenarioStepPopup.ConditionItem",d.define(c,function(){c.apply(this,arguments)},{events:{},checkOnMap:{1:h(20370),2:h(20371),3:h(20372)},template:'<tr class="conditionItem"><td class="conditionItemCell conditionIdentifier"></td><td class="conditionItemCell conditionCheckOn"><span><b><%= h(20369 /* Check on: */) %></b>&nbsp;</span><span class="conditionCheckOnValue"></span></td><td class="conditionItemCell conditionStatus"><% if ("empty" !== status) { %><span><b><%= h(20376 /* Final status: */) %></b>&nbsp;</span><span class="conditionStatusValue"></span><% } %></td><td class="conditionItemCell conditionActions"></td></tr>',
render:function(b,d){c.prototype.render.apply(this,arguments);this.renderConditionIdentifier();this.renderConditionCheckOn();this.renderConditionStatus();!0===window.initialListRender?setTimeout(this.showItemMenu.bind(this),window.listRenderTimeout):this.showItemMenu();return this},renderConditionIdentifier:function(){var b=this.model.get("value",""),c=[];c.push(this.model.getField(!0));c.push(this.model.getCondition(!0));this.model.isValueDisabled()||c.push("("+b+")");this._$el.find(".conditionIdentifier").text(c.join(" "))},
renderConditionCheckOn:function(){var b=this.checkOnMap[+this.model.getCheckOn()];this._$el.find(".conditionCheckOnValue").text(b)},renderConditionStatus:function(){if("empty"!==this.model.get("status")){var b=this.model.getStatus(!0),c=this.model.get("description",""),d=$("<span />");d.text(b);this._$el.find(".conditionStatusValue").append(d);""!==c&&(b=$("<span />"),b.text(c),this._$el.find(".conditionStatusValue").append(". ").append(b))}},showItemMenu:function(){var b=[];this.readOnlyMode?b.push({name:"actionView",
text:h(8047)}):b=[{name:"actionModify",text:h(19136),attr:{tabindex:0,onkeypress:"if(event.which === 13) {$(event.target).click();}"}},{name:"actionDelete",text:h(19137),attr:{tabindex:0,onkeypress:"if(event.which === 13) {$(event.target).click();}"}}];this.menuButton=d.view.control.create({xtype:"button.Menu",name:"itemMenuButton",tag:"div",text:"",attr:{"aria-haspopup":"true",role:"button","aria-labelledby":h(8074),tabindex:"0",onkeypress:"if(event.which === 13) {$(event.target).click();}"},addClass:"toa-item-menu-button",
icon:"toa-item-menu-icon",menuItems:b,listeners:{menuItemClick:this.menuItemClick.bind(this)}});var c=this;setTimeout(function(){c.menuButton.render(c._$el.find(".conditionItemCell.conditionActions"))},500)},menuItemClick:function(b,c){if("keypress"!==b.type||13===b.keyCode){var d=Array.prototype.slice.call(arguments);d[0]=b;this[c.name].apply(this,d)}},actionView:function(b){this.notify("conditionaction:view",b,this)},actionModify:function(b){this.notify("conditionaction:"+(this.readOnlyMode?"view":
"modify"),b,this)},actionDelete:function(b){if(this.readOnlyMode)return!1;this.notify("conditionaction:delete",b,this)}}))})(toa);(function(d){var c=d.views.messageScenarios.BaseView;d.ns("toa.views.messageScenarios.scenarioStepPopup.NoConditions",d.define(c,function(){c.apply(this,arguments)},{template:'<tr><td class="emptySection noConditions"><%= h(20381)/* No blocking conditions */ %></td></tr>'}))})(toa);(function(d){var c=d.views.messageScenarios.BaseCollectionView;d.ns("toa.views.messageScenarios.scenarioStepPopup.ConditionsList",d.define(c,function(){c.apply(this,arguments)},{events:{"click .addCondition":"actionAdd","keypress .addCondition":"actionAdd"},template:'<h1 class="settingsSection listActions"><span><%= h(20392) /* Prevent message sending on the following conditions */ %></span><% if (!readOnlyMode) { %><div role="button" tabindex="0" class="sectionsAddButton addCondition"><%= h(19127) /* Add new */ %></div><% } %></h1><div class="listWrapper"><table class="conditionsListContainer"></table></div><div class="note"><%= h(20379/* * The conditions are checked in the defined above order until the first match is found */) %></div>',
childView:d.views.messageScenarios.scenarioStepPopup.ConditionItem,childRegion:".conditionsListContainer",noItemsView:d.views.messageScenarios.scenarioStepPopup.NoConditions,render:function(b,d){c.prototype.render.apply(this,arguments);10<this.collection.getCount()&&this._$el.find(".conditionsListContainer").addClass("scrolled");return this},actionAdd:function(b){"keypress"===b.type&&13!==b.keyCode||this.notify("conditionaction:add",b,this)}}))})(toa);(function(d){var c=d.views.messageScenarios.BaseForm;d.ns("toa.views.messageScenarios.scenarioStepPopup.ConditionForm",d.define(c,function(b){c.apply(this,arguments)},{events:{"change #field":"changeField","change #condition":"changeCondition","change #status":"changeStatus","change #checkOn":"changeCheckOn","change #value":"changeValue","change #description":"changeDescription","change #afterCondition":"changeOrder","click .btnSaveForm":"onClickSave"},validators:[{selector:"#value",rules:["blockingConditionValue"]}],
template:'<div class="formSections"><div class="formSectionLeft"><h1 class="formSectionHeader"><%= h(20367) /* Condition to block message */ %></h1><div class="sectionContent"><table class="generalInfo" cellpadding="0" cellspacing="0"><tr><td class="infoMandatory"></td><td class="infoLabel"><label for="field"><%= h(3298/* Field */) %></label></td><td class="infoValue"><select class="infoValueDropdown formField" id="field" modelField="field"></select></td></tr><tr><td class="infoMandatory"></td><td class="infoLabel"><label for="condition"><%= h(3299/* Condition */) %></label></td><td class="infoValue"><select class="infoValueDropdown formField" id="condition" modelField="condition"></select></td></tr><tr><td class="infoMandatory"></td><td class="infoLabel"><label for="value"><%= h(3280/* Value */) %></label></td><td class="infoValue"><input type="text" class="infoValueText formField" value="<%- value %>" id="value" modelField="value" /></td></tr><tr><td colspan="3">&nbsp;</td></tr><tr><td class="infoMandatory"></td><td class="infoLabel"><label for="checkOn"><%= h(20369 /* Check on */) %></label></td><td class="infoValue"><select class="infoValueDropdown formField" id="checkOn" modelField="check_on"></select></td></tr><tr><td class="infoMandatory"></td><td class="infoLabel"><label for="afterCondition"><%= h(20378 /* After condition */) %></label></td><td class="infoValue"><select class="infoValueDropdown formField" id="afterCondition" modelField="after_condition"><option value="-1"><%= h(20394 /* At the beginning */) %></option></select></td></tr></table></div></div><div class="formSectionRight"><h1 class="formSectionHeader"><%= h(20368 /* Set message final status */) %></h1><div class="sectionContent"><table class="generalInfo" cellpadding="0" cellspacing="0"><tr><td class="infoMandatory"></td><td class="infoLabel"><label for="status"><%= h(20377 /* Status */) %></label></td><td class="infoValue"><select class="infoValueDropdown formField" id="status" modelField="status"></select></td></tr><tr><td class="infoMandatory"></td><td class="infoLabel"><label for="description"><%= h(1811 /* Description */) %></label></td><td class="infoValue"><input type="text" class="infoValueText formField" value="<%- description %>" id="description" modelField="description" maxlength="255" /></td></tr><tr><td colspan="3" class="note"><%= h(20380) /* *Final status will be set without message sending */ %></td></tr></table></div></div></div><% if (!readOnlyMode) { %><div class="formButtons"><div role="button" class="toa-button toa-button-active pullRight btnSaveForm"><% if (!id) { %><%= h(222) /* Add */ %><% } else { %><%= h(19136) /* Modify */ %><% } %></div></div><% } %>',
render:function(b,d){c.prototype.render.apply(this,arguments);this.afterRender();return this},afterRender:function(){this.readOnlyMode||null===this.model.getLookup("fieldGroups")?this.renderSelect("field"):this.renderSelect("field",this.model.getLookup("fieldGroups"));this.renderSelect("condition");this.renderSelect("checkOn");this.renderSelect("status");this.renderAfterCondition();this.setDependencies();this.readOnlyMode&&this._$el.find(".formField").prop("disabled",!0)},renderAfterCondition:function(){var b=
this._$el.find("#afterCondition"),c=-1;null===this.model.get("id")&&0<this.conditionsList.length?(c=+this.conditionsList[this.conditionsList.length-1].order,this.model.set({order:c+1})):c=+this.model.get("order",0)-1;$.each(this.conditionsList,function(d,k){var l=$('<option condition_id="'+k.id+'" value="'+k.order+'"'+(+k.order===c?' selected="selected"':"")+">"),n=k.text;140<n.length&&(n=n.substring(0,140)+"...");l.text(r(20395,{"{CONDITION_TEXT}":n}));b.append(l)})},renderOptionGroups:function(b,
c,d,k){$.each(c,function(c,e){var p=$('<optgroup label="'+e.label+'"></optgroup>'),s=[];$.each(d,function(b,c){e.id===c.group_id&&s.push(c)});this.renderOptions(p,s,k);b.append(p)}.bind(this))},renderOptions:function(b,c,d){$.each(c,function(c,e){var n=$("<option"+("undefined"!==typeof e.is_enum?' is_enum="'+e.is_enum+'"':"")+' value="'+e.label+'"'+(e.label===d?' selected="selected"':"")+">");n.text(e.text);b.append(n)})},renderSelect:function(b,c){c=c||!1;var d=this._$el.find("#"+b),k=d.attr("modelField"),
k=this.model.get(k),l=this.model.getLookup(b);c?this.renderOptionGroups(d,c,l,k):this.renderOptions(d,l,k)},changeField:function(b){b=$(b.target).val();this.model.set({field:b});this.checkAddPermission()},changeCondition:function(b){b=$(b.target).val();this.model.set({condition:b});this.setDependencies();this.checkAddPermission()},changeStatus:function(b){b=$(b.target).val();this.model.set({status:b});this.setDependencies()},changeCheckOn:function(b){b=$(b.target).val();this.model.set({check_on:b})},
changeValue:function(b){b=$(b.target).val();this.model.set({value:b})},blockingConditionValueFieldValidate:function(b){var c="";65535<(new Blob([$(b).val()])).size&&(c=h(23415));return c},changeDescription:function(b){b=$(b.target).val();this.model.set({description:b})},changeOrder:function(b){b=+$(b.target).val()+1;this.model.set({order:b})},setDependencies:function(){var b="empty"===this.model.get("status","");this._$el.find("#value").prop("disabled",this.model.isValueDisabled());this._$el.find("#description").prop("disabled",
b)},checkAddPermission:function(){if(!this.readOnlyMode){var b=["contains","dcontain","starts_with","dstart_with"],c=this.model.get("condition"),d=this._$el.find(".btnSaveForm");1==this._$el.find("#field").find(":selected").attr("is_enum")&&-1!==$.inArray(c,b)?d.addClass("toa-disable"):d.hasClass("toa-disable")&&d.removeClass("toa-disable")}},setModel:function(b){this.model=b},setConditionsList:function(b){this.conditionsList=b},onClickSave:function(b){if($(b.target).hasClass("toa-disable")||!this.validate())return!1;
this.notify("conditionaction:save",this)}}))})(toa);(function(d){var c=d.messageScenarios.DataMapper;d.ns("toa.messageScenarios.dataMappers.BlockingConditionDataMapper",d.define(c,function(b,d,g){c.apply(this,arguments);this._lookups=d;this._scenarioMethod=g},{_modelConstructor:d.models.messageScenarios.BlockingCondition,serialize:function(b){return{field:b.get("field"),condition:b.get("condition"),value:b.get("value"),status:b.get("status"),description:b.get("description"),check_on:b.get("check_on")}},_fillModel:function(b,d){c.prototype._fillModel.apply(this,
arguments);this._lookups&&!$.isEmptyObject(this._lookups)&&b.setLookups(this._lookups);"string"===typeof this._scenarioMethod&&b.setScenarioMethod(this._scenarioMethod)}}))})(toa);(function(d,c){var b=d.messageScenarios.CollectionDataMapper;d.ns("toa.messageScenarios.dataMappers.BlockingConditionsListDataMapper",d.define(b,function(c,d){b.apply(this,arguments)},{_modelConstructor:d.models.messageScenarios.BlockingConditionsCollection}))})(toa,$);(function(d){var c=d.models.messageScenarios.BaseModel;d.ns("toa.models.messageScenarios.NextStep",d.define(c,function(){c.apply(this,arguments)},{idField:"id",setEmpty:function(){var b={id:null,step:this.getDefault("step"),status:this.getDefault("status"),checkDescription:!1,description:""};this.set(b)},getStatus:function(b){return this.getModelField("status",b)},getStep:function(b){return this.getModelField("step",b)}}))})(toa);(function(d){var c=d.models.messageScenarios.BaseCollection;d.ns("toa.models.messageScenarios.NextStepsCollection",d.define(c,function(){c.apply(this,arguments)},{comparator:function(b,c){var d=+b.get("id"),k=+c.get("id");return d===k?0:d?k?d<k?-1:1:1:-1},getNextId:function(){return this.getAutoIncrement("id")}}))})(toa);(function(d){var c=d.views.messageScenarios.BaseView;d.ns("toa.views.messageScenarios.scenarioStepPopup.NextStepsTab",d.define(c,function(b){c.apply(this,arguments)},{regions:{list:".nextStepsList",form:".nextStepForm"},template:'<table class="pwc1" width="100%" cellpadding="0" cellspacing="0" border="0"><tr class="bct" valign="top" style="font-weight: normal;"><td><div id="nextStepsContainer"><div class="tabContent nextStepsList"></div><div class="tabContent nextStepForm"></div></div></td></tr></table>'}))})(toa);(function(d){var c=d.views.messageScenarios.BaseView;d.ns("toa.views.messageScenarios.scenarioStepPopup.NextStepItem",d.define(c,function(){c.apply(this,arguments)},{template:'<tr class="nextStepItem"><td class="nextStepItemCell nextStepText"></td><td class="nextStepItemCell nextStepCondition"><span><b><%= h(20386 /* When: */) %></b>&nbsp;</span><span class="nextStepConditionValue"></span></td><td class="nextStepItemCell nextStepActions"></td></tr>',render:function(b,d){c.prototype.render.apply(this,
arguments);this.renderNextStepText();this.renderNextStepCondition();!0===window.initialListRender?setTimeout(this.showItemMenu.bind(this),window.listRenderTimeout):this.showItemMenu();return this},renderNextStepText:function(){var b=this.model.getStep(!0);this._$el.find(".nextStepText").text(b)},renderNextStepCondition:function(){var b="",c=this.model.getStatus(!0),d=this.model.get("description",""),b=b+(h(20389)+" = "+c);this.model.get("checkDescription",!1)&&(b+=" AND "+h(1811)+" = ",b=""!==d?b+
d:b+"''");this._$el.find(".nextStepConditionValue").text(b)},showItemMenu:function(){var b=[];this.readOnlyMode?b.push({name:"actionView",text:h(8047)}):b=[{name:"actionModify",text:h(19136)},{name:"actionDelete",text:h(19137)}];this.menuButton=d.view.control.create({xtype:"button.Menu",name:"itemMenuButton",text:"",attr:{"aria-haspopup":"true",tabindex:"0"},addClass:"toa-item-menu-button",icon:"toa-item-menu-icon",menuItems:b,listeners:{menuItemClick:this.menuItemClick.bind(this)}});this.menuButton.render(this._$el.find(".nextStepItemCell.nextStepActions"))},
menuItemClick:function(b,c){var d=Array.prototype.slice.call(arguments);d[0]=b;this[c.name].apply(this,d)},actionView:function(b){this.notify("nextstepaction:view",b,this)},actionModify:function(b){this.notify("nextstepaction:"+(this.readOnlyMode?"view":"modify"),b,this)},actionDelete:function(b){if(this.readOnlyMode)return!1;this.notify("nextstepaction:delete",b,this)}}))})(toa);(function(d){var c=d.views.messageScenarios.BaseView;d.ns("toa.views.messageScenarios.scenarioStepPopup.NoNextSteps",d.define(c,function(){c.apply(this,arguments)},{template:'<tr><td class="emptySection noNextSteps"><%= h(20391)/* No next steps */ %></td></tr>'}))})(toa);(function(d){var c=d.views.messageScenarios.BaseCollectionView;d.ns("toa.views.messageScenarios.scenarioStepPopup.NextStepsList",d.define(c,function(){c.apply(this,arguments)},{events:{"click .addNextStep":"actionAdd","keypress .addNextStep":"actionAdd"},template:'<h1 class="settingsSection listActions"><span><%= h(20385)/* Based on message final status following steps can be launched */ %></span><% if (!readOnlyMode) { %><div role="button" tabindex="0" class="sectionsAddButton addNextStep"><%= h(19127) /* Add new */ %></div><% } %></h1><div class="listWrapper"><table class="nextStepsListContainer"></table></div>',
childView:d.views.messageScenarios.scenarioStepPopup.NextStepItem,childRegion:".nextStepsListContainer",noItemsView:d.views.messageScenarios.scenarioStepPopup.NoNextSteps,render:function(b,d){c.prototype.render.apply(this,arguments);10<this.collection.getCount()&&this._$el.find(".nextStepsListContainer").addClass("scrolled");return this},actionAdd:function(b){"keypress"===b.type&&13!==b.keyCode||this.notify("nextstepaction:add",b,this)}}))})(toa);(function(d){var c=d.views.messageScenarios.BaseForm;d.ns("toa.views.messageScenarios.scenarioStepPopup.NextStepForm",d.define(c,function(b){c.apply(this,arguments)},{events:{"change #step":"changeStep","change #status":"changeStatus","change #checkDescription":"changeCheckDescription","change #description":"changeDescription","click .btnSaveForm":"onClickSave"},validators:[],template:'<div class="formSections"><div class="formSectionLeft"><div class="sectionContent"><table class="generalInfo" cellpadding="0" cellspacing="0"><tr><td class="infoMandatory"></td><td class="infoLabel"><label for="step"><%= h(20387/* Next message step */) %></label></td><td class="infoValue"><select class="infoValueDropdown formField" id="step" modelField="step"></select></td></tr><tr><td class="infoMandatory"></td><td colspan="2" class="infoLabel"><label id="status_description"><%= h(20388 /* When current step has: */) %></label></td></tr><tr><td class="infoMandatory"></td><td class="infoLabel"><label id="label_status"><%= h(20389 /* Final status */) %></label></td><td class="infoValue"><select class="infoValueDropdown formField" aria-labelledby="status_description label_status" id="status" modelField="status"></select></td></tr><tr><td class="infoMandatory"></td><td class="infoLabel" colspan="2"><label id="label_allow_status_description"><%= h(20390 /* Also validate status description */) %></label>&nbsp;<input aria-labelledby="status_description label_allow_status_description" type="checkbox" class="infoValueCheckbox formField" id="checkDescription" modelField="checkDescription" <%- (checkDescription ? "checked" : "") %>></td></tr><tr class="descRow<%- (checkDescription ? \'\' : \' toa-hidden\') %>"><td class="infoMandatory"></td><td class="infoLabel"><label id="label_description"><%= h(1811 /* Description */) %></label></td><td class="infoValue"><input aria-labelledby="status_description label_description" type="text" class="infoValueText formField" value="<%- description %>" id="description" modelField="description" maxlength="255" /></td></tr></table></div></div></div><% if (!readOnlyMode) { %><div class="formButtons"><div role="button" class="toa-button toa-button-active pullRight btnSaveForm"><% if (!id) { %><%= h(222) /* Add */ %><% } else { %><%= h(19136) /* Modify */ %><% } %></div></div><% } %>',
render:function(b,d){c.prototype.render.apply(this,arguments);this.afterRender();return this},afterRender:function(){this.renderSelect("step");this.renderSelect("status");this.setDependencies();this.readOnlyMode?this._$el.find(".formField").prop("disabled",!0):this.model.getLookup("step")&&0===this.model.getLookup("step").length&&this._$el.find(".btnSaveForm").addClass("toa-disable")},renderOptions:function(b,c,d){var k=this.model.getScenarioMethod();$.each(c,function(c,e){if(e.disabled_method===
k)return!0;var p=$('<option value="'+e.label+'"'+(e.label===d?' selected="selected"':"")+">");p.text(e.text);b.append(p)})},renderSelect:function(b){var c=this._$el.find("#"+b),d=c.attr("modelField"),d=this.model.get(d);b=this.model.getLookup(b);this.renderOptions(c,b,d)},changeStep:function(b){b=$(b.target).val();this.model.set({step:+b})},changeStatus:function(b){b=$(b.target).val();this.model.set({status:b})},changeCheckDescription:function(b){this.readOnlyMode||(b=$(b.target).is(":checked"),this.model.set({checkDescription:b}),
this.setDependencies())},changeDescription:function(b){b=$(b.target).val();this.model.set({description:b})},setDependencies:function(){var b=this.model.get("checkDescription",!1),c=this._$el.find("#description"),d=this._$el.find(".descRow");b?d.removeClass("toa-hidden"):(d.addClass("toa-hidden"),c.val(""),this.model.set({description:""}))},onClickSave:function(b){if($(b.target).hasClass("toa-disable"))return!1;this.notify("nextstepaction:save",this)}}))})(toa);(function(d){var c=d.messageScenarios.DataMapper;d.ns("toa.messageScenarios.dataMappers.NextStepDataMapper",d.define(c,function(b,d,g){c.apply(this,arguments);this._lookups=d;this._scenarioMethod=g},{_modelConstructor:d.models.messageScenarios.NextStep,serialize:function(b){return{step:b.get("step"),status:b.get("status"),checkDescription:b.get("checkDescription"),description:b.get("description")}},_fillModel:function(b,d){c.prototype._fillModel.apply(this,arguments);this._lookups&&!$.isEmptyObject(this._lookups)&&
b.setLookups(this._lookups);"string"===typeof this._scenarioMethod&&b.setScenarioMethod(this._scenarioMethod)}}))})(toa);(function(d,c){var b=d.messageScenarios.CollectionDataMapper;d.ns("toa.messageScenarios.dataMappers.NextStepsListDataMapper",d.define(b,function(c,d){b.apply(this,arguments)},{_modelConstructor:d.models.messageScenarios.NextStepsCollection}))})(toa,$);(function(d){var c=d.views.messageScenarios.BaseView,b=function(b){var c=b.indexOf(".");return 0<=c?b.substr(0,c):b};d.ns("toa.views.messageScenarios.scenarioStepPopup.SettingsTab",d.define(c,function(){c.apply(this,arguments);this.stepSearchController=null},{recipient_count:1,recipientSelected:"customer",receiverTypes:["users","groups","helpdesks"],events:{"change #msname":"onChangeName","change #mstype":"onChangeType","change #msmethod":"onChangeChannel","change #msrecipient":"onChangeRecipient",
"change #msstatic_zid":"onChangeTimeZone","change #msstatic_lid":"onChangeLanguage","change #select_msaddress":"onChangeAddress","change #msstaticaddress":"onChangeStaticAddress","change #msreplyto":"onChangeReplyTo","change #mstime_in_msg":"onChangeTimeInMessage","change #mssend_at":"onChangeSendAt","change #mssend_day_sign":"onChangeSendDaySign","change #mssend_day_shift":"onChangeSendDayShift","change #mssend_from_h":"onChangeSendFromH","change #mssend_from_m":"onChangeSendFromM","change #mssend_within_h":"onChangeSendWithinH",
"change #mssend_within_m":"onChangeSendWithinM","change #mssentretries":"onChangeSentRetries","change #mssentinterval":"onChangeSentInterval","change #msfaultretries":"onChangeFaultRetries","change #msfaultinterval":"onChangeFaultInterval","change #msdelay":"onChangeDelay","change .msskip_weekday":"onChangeSkipWeekDay","change #msskip_holidays":"onChangeSkipHolidays","change .helpdesk_option":"onChangeHelpdeskOption","change #msmax_days_to_shift":"onChangeMaxDaysToShift","click #add_collab_receiver":"collabReceiverClick"},
onChangeName:function(b){b=$(b.target).val();this.model.set({msname:b})},onChangeType:function(b){b=$(b.target).val();this.model.set({mstype:b})},onChangeChannel:function(b){this.toggleCollaborationReceivers();this.clearRestoreRecipient();this.processVisibility();this.resetAddress();this.showHidePattern();b=$(b.target).val();this.model.set({msmethod:b});this.notify("update_method",b)},onChangeRecipient:function(b){this.processVisibility();this.resetAddress();this.showHidePattern();b=$(b.target).val();
this.model.set({msrecipient:b})},onChangeTimeZone:function(b){b=parseInt($(b.target).val(),10);this.model.set({msstatic_zid:b})},onChangeLanguage:function(b){b=parseInt($(b.target).val(),10);this.model.set({msstatic_lid:b});this.showHidePattern()},onChangeAddress:function(b){b=$(b.target).val();this.model.set({msaddress:b});if(this.isBlockVisible("msrecipient_tr")){var c=this.getAddressIndex(),d=this.model.get("msaddress_selected");d[c]=b;this.model.set({msaddress_selected:d})}},onChangeStaticAddress:function(b){b=
$(b.target).val();this.model.set({msstaticaddress:b})},onChangeReplyTo:function(b){b=$(b.target).val();this.model.set({msreplyto:b})},onChangeTimeInMessage:function(b){b=$(b.target).val();this.model.set({mstime_in_msg:b})},onChangeSendAt:function(b){b=$(b.target).val();this.model.set({mssend_at:b});"time_of_event"===b?this.hideBlock("mssend_from_tr"):this.showBlock("mssend_from_tr");this.notify("center_popup",this)},onChangeSendDaySign:function(b){b=parseInt($(b.target).val(),10);var c=Math.abs(parseInt(this.getValue("mssend_day_shift"),
10)||0);0===b&&(c*=-1);this.model.set({mssend_day_shift:c})},onChangeSendDayShift:function(b){b=parseInt($(b.target).val(),10)||0;b=Math.abs(b);0===parseInt(this.getValue("mssend_day_sign"),10)&&(b*=-1);this.model.set({mssend_day_shift:b})},onChangeSendFromH:function(b){b=$(b.target).val();this.model.set({mssend_from_h:b})},onChangeSendFromM:function(b){b=$(b.target).val();this.model.set({mssend_from_m:b})},onChangeSendWithinH:function(b){b=$(b.target).val();this.model.set({mssend_within_h:b})},onChangeSendWithinM:function(b){b=
$(b.target).val();this.model.set({mssend_within_m:b})},onChangeSentRetries:function(b){b=parseInt($(b.target).val());this.model.set({mssentretries:b})},onChangeSentInterval:function(b){b=parseInt($(b.target).val());this.model.set({mssentinterval:b})},onChangeFaultRetries:function(b){b=parseInt($(b.target).val(),10);this.model.set({msfaultretries:b})},onChangeFaultInterval:function(b){b=parseInt($(b.target).val(),10);this.model.set({msfaultinterval:b})},onChangeDelay:function(b){b=parseInt($(b.target).val(),
10);this.model.set({msdelay:b})},onChangeSkipWeekDay:function(b){var c=0;$(".msskip_weekday").filter(":checked").each(function(b,d){c|=parseInt($(d).data("dayid"),10)});this.model.set({msskip_weekdays:c});this.skipDayCheck()},onChangeSkipHolidays:function(b){b=$(b.target).is(":checked")?1:0;this.model.set({msskip_holidays:b});this.skipDayCheck()},onChangeHelpdeskOption:function(b){var c=0;b=$(b.target);b.is(":checked")&&(c=1==b.val()?1:0);this.model.set({helpdesk_option:c})},onChangeMaxDaysToShift:function(b){b=
parseInt($(b.target).val(),10);this.model.set({msmax_days_to_shift:b})},collabReceiverClick:function(){if(null===this.stepSearchController){var b={addItem:this.getElement().find("#add_collab_receiver"),prepareSearchHandler:this.prepareSearchHandler.bind(this)};this.getElement().find("#add_collab_receiver").off("click",this.collabReceiverClick);this.stepSearchController=new d.controllers.MessageScenarioSearch(b);this.stepSearchController.addIcon.trigger("click")}},prepareSearchHandler:function(b,c){var d=
b.uid||b.gid;b.id=d;b.name=b.uname||b.name;var l=!0;0<=this.model.getReceivers()[c].indexOf(d)&&(l=!1);l&&(this.model.addReceiver(c,d),d=$("#helpdesk_message_scenario"),"helpdesks"===c&&(d.hasClass("hidden")&&(d.removeClass("hidden"),this.model.setHelpdeskOption(0)),$(".heading_delivery").text(h(22710).replace("{HELPDESK_COUNT}",$("#mscollab_receivers_helpdesks tr").length+1))),this.resizeRecipientTable(),this.generateReceiverRow(b,c))},_addRecipientOption:function(b,c,k){c=$("<option />").val(c).text(d.utils.string.safeDecodeHtmlEntities(k)).prop("selected",
c===this.recipientSelected);b.append(c)},toggleCollaborationReceivers:function(){var c=this.getElement().find("#msrecipient"),d=b(this.getValue("msmethod")),k=this.model.get("lookups").msrecipient,l={};$.each(k,function(b,c){l[c.value]=c.text}.bind(this));c.find("option").length&&(this.recipientSelected=c.val());"collaboration"===d?(c.find("option").remove(),this._addRecipientOption(c,"provider",l.provider),this._addRecipientOption(c,"static",l["static"])):2===c.find("option").length&&(c.find("option").remove(),
$.each(k,function(b,d){this._addRecipientOption(c,d.value,d.text)}.bind(this)));this.model.set({msrecipient:c.val()})},displayCollaborationReceivers:function(){$.each(this.receiverTypes,function(b,c){var d=this.model.getSelectedReceivers();$.each(d[c],function(b,d){this.generateReceiverRow(d,c)}.bind(this))}.bind(this))},generateReceiverRow:function(b,c){var d;switch(c){case "users":d="user";break;case "groups":d="group";break;case "helpdesks":d="helpdesk"}d=$(this._receiverRowTemplate.apply({type:c,
id:b.id,className:d,name:b.name,readOnlyMode:this.readOnlyMode}));d.find(".mscollab-receiver-delete").bind("click",this.deleteReceiver.bind(this));this.getElement().find("#mscollab_receivers_"+c).append(d)},deleteReceiver:function(b){var c=$(b.currentTarget);b=c.data("type");var d=c.data("id");if(-1!==this.receiverTypes.indexOf(b)){var l=this.model.getReceivers(),c=!1,n=l[b].indexOf(d);0<=n&&(this.model.deleteReceiver(b,n),"helpdesks"===b&&(0===l[b].length&&$("#helpdesk_message_scenario").addClass("hidden"),
$(".heading_delivery").text(h(22710).replace("{HELPDESK_COUNT}",$("#mscollab_receivers_helpdesks tr").length-1))),this.resizeRecipientTable(),c=!0);(b=this.getElement().find("#"+b+"_"+d))&&c&&b.remove()}},getAddressIndex:function(){return("customer"===this.getValue("msrecipient")?"1":"3")+("voice"===b(this.getValue("msmethod"))?"P":"E")},resetAddress:function(){if(!this.isBlockHidden("msrecipient_tr")){var b=this.getAddressIndex(),c=this.getElement().find("#select_msaddress"),d=this.model.get("lookups").msaddress,
l=this.model.get("msaddress_selected"),n;c.find("option").remove();$.each(d[b],function(d,k){n=$("<option />").val(d).text(k).prop("selected",d===l[b]);c.append(n)}.bind(this));"1E"===b||"3E"===b?(this.getElement().find("#msaddress_label_phone").hide(),this.getElement().find("#msaddress_label_email").show(),c.attr("aria-labelledby","msaddress_label_email")):(this.getElement().find("#msaddress_label_phone").show(),this.getElement().find("#msaddress_label_email").hide(),c.attr("aria-labelledby","msaddress_label_phone"));
this.model.set({msaddress:c.val()});this.notify("center_popup",this)}},showHidePattern:function(){var b=!1;this.isBlockVisible("msstatic_lid_tr")&&(b=this.getValue("msstatic_lid"));this.notify("show_hide_message_pattern",b)},helpdeskMessageScenarioOption:function(){var c=b(this.getElement().find("#msmethod").val());$(".heading_delivery").text(h(22710).replace("{HELPDESK_COUNT}",$("#mscollab_receivers_helpdesks tr").length));"collaboration"===c&&"static"===this.getElement().find("#msrecipient").val()&&
0<$("#mscollab_receivers_helpdesks").children().length?this.showBlock("helpdesk_message_scenario"):this.hideBlock("helpdesk_message_scenario");this.resizeRecipientTable()},resizeRecipientTable:function(){var b=this.model.getReceivers(),c=$(".mscollab-receivers-table-outer"),b=b.groups.length+b.helpdesks.length+b.users.length;1===b?(c.removeClass("medium_recipient_list large_recipient_list"),c.addClass("small_recipient_list")):2===b?(c.removeClass("large_recipient_list small_recipient_list"),c.addClass("medium_recipient_list")):
2<b&&(c.removeClass("medium_recipient_list small_recipient_list"),c.addClass("large_recipient_list"))},hideBlock:function(b){this.showHideBlock(b,!1)},showBlock:function(b){this.showHideBlock(b,!0)},isBlockHidden:function(b){return this.getElement().find("#"+b).is(":hidden")},isBlockVisible:function(b){return!this.isBlockHidden(b)},showHideBlock:function(b,c){var d=this.getElement().find("#"+b);!0===c?d.removeClass("hidden"):d.addClass("hidden")},showBlockIf:function(b,c){c?this.showBlock(b):this.hideBlock(b)},
blockExists:function(b){return 0<this.getElement().find("#"+b).length},processVisibility:function(){var c=b(this.getElement().find("#msmethod").val());"IVR"===c?this.hideBlock("msrecipient_tr"):(this.showBlock("msrecipient_tr"),this.showBlock("mssend_from_tr"),this.showBlock("mssend_within_tr"));-1!==$.inArray(c,["collaboration","set_property","IVR"])?("collaboration"===c?this.showBlock("msfaultretries_tr"):this.hideBlock("msfaultretries_tr"),this.hideBlock("mssentretries_tr")):(this.showBlock("msfaultretries_tr"),
this.showBlock("mssentretries_tr"));this.helpdeskMessageScenarioOption();"email"===c&&this.hideBlock("mssentretries_tr");"email"===c||"nextel"===c?(this.showBlock("msreplyto_tr"),this.hideBlock("mssend_from_tr")):this.hideBlock("msreplyto_tr");var d=this.getElement().find("#msrecipient"),k=!d.prop("disabled"),d=d.val();k&&"static"===d&&-1===$.inArray(c,["collaboration","external_system","set_property"])?this.showBlock("msstaticaddress_tr"):this.hideBlock("msstaticaddress_tr");k&&"static"===d&&"collaboration"!==
c?(this.showBlock("msstatic_lid_tr"),this.showBlock("msstatic_zid_tr")):(this.hideBlock("msstatic_lid_tr"),this.hideBlock("msstatic_zid_tr"));"collaboration"===c&&"provider"!==d?this.showBlock("receivers_table"):this.hideBlock("receivers_table");!k&&"IVR"!==c||"customer"!==d||"set_property"===c?this.hideBlock("mstime_in_msg_tr"):this.showBlock("mstime_in_msg_tr");"voice"!==c&&"email"!==c||"static"===d?this.hideBlock("msaddress_tr"):this.showBlock("msaddress_tr");"collaboration"===c&&(this.hideBlock("mssentretries_tr"),
this.hideBlock("mstime_in_msg_tr"));"IVR"===c?(this.hideBlock("msdelay_tr"),this.setValue("mssend_at","time_of_event"),this.setDisabled("mssend_at"),this.setDisabled("mssend_day_sign"),this.setDisabled("mssend_day_shift")):(this.showBlock("msdelay_tr"),this.setEnabled("mssend_at"),this.setEnabled("mssend_day_sign"),this.setEnabled("mssend_day_shift"));"time_of_event"===this.getValue("mssend_at")?this.hideBlock("mssend_from_tr"):this.showBlock("mssend_from_tr")},skipDayCheck:function(){var b=!(this.getElement().find(".msskip_weekday").is(":checked")||
this.getElement().find("#msskip_holidays").is(":checked"));this.setDisabled("msmax_days_to_shift",b)},setValue:function(b,c){this.getElement().find("#"+b).val(c);this.model.attributes[b]=c},getValue:function(b){return this.getElement().find("#"+b).val()},getMethodValue:function(){return b(this.getValue("msmethod"))},setDisabled:function(b,c){if("undefined"===typeof c||!1!==c)c=!0;this.getElement().find("#"+b).prop("disabled",c)},setEnabled:function(b){this.setDisabled(b,!1)},isDisabled:function(b){return this.getElement().find("#"+
b).prop("disabled")},isEnabled:function(b){return!this.isDisabled(b)},afterRender:function(){this.clearRestoreRecipient();this.toggleCollaborationReceivers();this.processVisibility();this.skipDayCheck();this.displayCollaborationReceivers();this.readOnlyMode&&this._$el.find(".formField").prop("disabled",!0)},clearRestoreRecipient:function(){var c=b(this.getValue("msmethod")),d=this.getElement().find("#msrecipient"),k=this.model.get("lookups").msrecipient,l={};$.each(k,function(b,c){l[c.value]=c.text}.bind(this));
"IVR"===c?(d.find("option").length&&(this.recipientSelected=d.val()),d.find("option").remove(),this._addRecipientOption(d,"customer",l.customer)):2>d.find("option").length&&(d.find("option").remove(),$.each(k,function(b,c){this._addRecipientOption(d,c.value,c.text)}.bind(this)));this.model.set({msrecipient:d.val()})},render:function(){c.prototype.render.apply(this,arguments);this.afterRender();return this},_receiverRowTemplate:new d.Template('<tr id="<%- type %>_<%- id %>">;<td width="95%">;<div class="mscollab-receivers-<%- className %>-image"></div>;<div class="mscollab-receivers-<%- className %>-name"><%- name %></div>;</td>;<% if (!readOnlyMode) { %><td width="5%" align="right">;<div data-type="<%- type %>" data-id="<%- id %>" class="mscollab-receiver-delete"></div>;</td>;<% } %></tr>'.split(";")),
template:'<% var selected = function(condition) { %><% return condition ? \' selected="selected"\' : \'\'; %><% }; %><% var checked = function(condition) { %><% return condition ? \' checked="checked"\' : \'\'; %><% }; %><% var display = function(condition) { %><% return !condition ? \'display: none;\' : \'\'; %><% }; %><table role="none" class="tab-4way-layout" width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td valign="top"><table class="pwc1" role="none" cellpadding="2" cellspacing="0" border="0"><tr class="pwt"><td colspan="5"><table class="pwc" cellpadding="0" cellspacing="0" border="0"><tr class="pwt"><td class="ht"><h2 class="pwt__title"><%= h(8669/*Step info*/) %></h2></td><td></td></tr></table><table></table></td></tr><tr class="bct"><td width="1"><abbr id="req_msname" class="ofsc-abbr-mandatory" title="<%= h(22351/*required*/) %>">*</abbr></td><td width=35%  align="left"><label id="label_msname"><%= h(1488/*Name*/) %></label></td><td ><input tabindex="0" id="msname" aria-labelledby="req_msname label_msname" required type="text" name="msname" class="formField pwi1" value="<%- msname %>" maxlength="64"></td></tr><tr class="bct"><td width="1">&nbsp;</td><td  width=35% align="left"><label id="label_mstype"><%= h(1489/*Type*/) %></label></td><td><select tabindex="0" id="mstype" aria-labelledby="label_mstype" name="mstype" class="formField pwi1"><% for (var i in lookups.mstype) { %><% var item = lookups.mstype[i]; %><option value="<%- item.value %>"<%- selected(item.value === mstype) %>><%- item.text %></option><% } %></select></td></tr><tr class="bct"><td width="1"><abbr id="req_msmethod" class="ofsc-abbr-mandatory" title="<%= h(22351/*required*/) %>">*</abbr></td><td align="left"><label id="label_msmethod"><%= h(18002/*Delivery Channel*/) %></label></td><td><select id="msmethod"  tabindex="0" aria-labelledby="req_msmethod label_msmethod" required name="msmethod" class="formField pwi1"><% var methodFound = false; %><% for (var i in lookups.msmethod) { %><% if (msmethod === lookups.msmethod[i].value) { methodFound = true; } %><% } %><% if (false === methodFound) { %><option value="" selected></option><% } %><% for (var i in lookups.msmethod) { %><% var item = lookups.msmethod[i]; %><option value="<%- item.value %>"<%- selected(item.value === msmethod) %>><%- item.text %></option><% } %></select></td></tr><tr class="bct" id="msrecipient_tr"><td width="1">&nbsp;</td><td  width=35%  align="left"><label id="label_msrecipient"><%= h(1508/*Recipient*/) %></label></td><td><select id="msrecipient"  tabindex="0" name="msrecipient" aria-labelledby="label_msrecipient" class="formField pwi1"><% for (var i in lookups.msrecipient) { %><% var item = lookups.msrecipient[i]; %><option value="<%- item.value %>"<%- selected(item.value === msrecipient) %>><%- item.text %></option><% } %></select></td></tr><tr class="bct" id="mstime_in_msg_tr"><td width="1">&nbsp;</td><td width=36% align="left"><label id="label_mstime_in_msg"><%= h(2208/*Customer notification time*/) %></label></td><td><select id="mstime_in_msg" tabindex="0" aria-labelledby="label_mstime_in_msg" name="mstime_in_msg" class="formField pwi1"><option value="">&nbsp;</option><% for (var i in lookups.mstime_in_msg) { %><% var item = lookups.mstime_in_msg[i]; %><option value="<%- item.value %>"<%- selected(item.value === mstime_in_msg) %>><%- item.text %></option><% } %></select></td></tr><tr class="bct" id="msstatic_zid_tr"><td width="1">&nbsp;</td><td width=36% align="left"><%= h(1018/*Time zone*/) %></td><td><select name="msstatic_zid" tabindex="0" id="msstatic_zid" class="formField pwi1"><% for (var i in lookups.timezone) { %><% var item = lookups.timezone[i]; %><option value="<%- item.value %>"<%- selected(item.value === msstatic_zid) %>><%- item.text %></option><% } %></select></td></tr><tr class="bct"  id="msstatic_lid_tr"><td width="1">&nbsp;</td><td width=36% align="left"><%= h(1019/*Language*/) %></td><td><select name="msstatic_lid" tabindex="0" id="msstatic_lid" class="formField pwi1"><% for (var i in lookups.language) { %><% var item = lookups.language[i]; %><option value="<%- item.id %>"<%- selected(item.id === msstatic_lid) %>><%- item.text %></option><% } %></select></td></tr><tr class="bct" id="msstaticaddress_tr"><td width="1"><abbr id="req_msstaticaddress" class="ofsc-abbr-mandatory" title="<%= h(22351/*required*/) %>">*</abbr></td><td width=36% align="left"><label id="label_msstaticaddress"><%= h(1017/*Static address*/) %></label></td><td><input id="msstaticaddress" tabindex="0" type="text" aria-labelledby="label_msstaticaddress" name="msstaticaddress" class="formField pwi1" value="<%- msstaticaddress %>" maxlength="255"></td></tr><tr class="bct" id="msreplyto_tr"><td width="1"><abbr id="req_msreplyto" class="ofsc-abbr-mandatory" title="<%= h(22351/*required*/) %>">*</abbr></td><td width=36% align="left"><label id="label_msreplyto"><%= h(5053/*Reply address*/) %></label></td><td><input id="msreplyto"  tabindex="0" aria-labelledby="req_msreplyto label_msreplyto" required type="text" name="msreplyto" class="formField pwi1" value="<%- msreplyto %>" maxlength="255"></td></tr><tr class="bct" id ="msaddress_tr"><td width="1">&nbsp;</td><td align="left"><span id="msaddress_label_phone" style="<%- display(\'voice\' === msmethod) %>"><%= h(5159/*Phone number source*/) %></span><span id="msaddress_label_email" style="<%- display(\'email\' === msmethod) %>"><%= h(118/*Email address source*/) %></span></td><td><% var msaddress_labelledby = \'msaddress_label_\' + msmethod; %><% var addressIndex = (\'customer\' === msrecipient ? \'1\' : \'3\') + (\'voice\' === msmethod ? \'P\' : \'E\'); %><select aria-labelledby="<%- msaddress_labelledby %>" tabindex="0" id="select_msaddress" name="msaddress" class="formField pwi1""><% for (var key in lookups.msaddress[addressIndex]) { %><% var item = lookups.msaddress[addressIndex][key]; %><option value="<%- key %>"<%- selected(key === msaddress) %>><%- item %></option><% } %></select></td></tr></table><table role="none" class="pwc1 msreceivers-table" cellpadding="2" cellspacing="0" border="0" id="receivers_table"><tr class="pwt"><td colspan="5"><table class="pwc" cellpadding="0" cellspacing="0" border="0"><tr class="pwt"><td class="ht"><%= h(18833/*Recipients*/) %></td><% if (!readOnlyMode) { %><td class="ht"><div id="add_collab_receiver" class="sections-add-receiver-button"><%= h(19127/*Add new*/) %></div></td><% } %></tr></table><table></table></td></tr><tr class="bct mscollab-receivers-row" id="mscollab_receivers_tr"><td><div id="mscollab_receivers_table_outer" class="mscollab-receivers-table-outer"><table width="100%" id="mscollab_receivers_table"><tbody id="mscollab_receivers_users"></tbody><tbody id="mscollab_receivers_groups"></tbody><tbody id="mscollab_receivers_helpdesks"></tbody></table></div></td></tr></table><table id="helpdesk_message_scenario" role="none" cellpadding="2" cellspacing="0" border="0"><tbody><tr class="pwt"><td colspan="5"><table class="pwc" cellpadding="0" cellspacing="0" border="0"><tbody><tr class="pwt"><td class="heading_delivery_row"><h3 class="heading_delivery">'+
r(22710,{"{HELPDESK_COUNT}":this.recipient_count})+'</h3></td><td></td></tr></tbody></table><table></table></td></tr><tr class="small_header1" id="helpdesk_option_tr"><td class= "hd_delivery_option_radio"><input id="helpdesk_option_1" type="radio" name="helpdesk_option" class="formField helpdesk_option"<%- checked(helpdesk_option) %> value="1" /></td><td class= "hd_delivery_option"><label for="helpdesk_option_1"><%= h(22719/*Deliver to helpdesk*/) %>&nbsp;</label></td></tr><tr class="small_header1" id="helpdesk_option_tr"><td class= "hd_delivery_option_radio"><input id="helpdesk_option_2" type="radio" name="helpdesk_option" class="formField helpdesk_option"<%- checked(!helpdesk_option) %> value="0" /></td><td class = "hd_delivery_option"><label for="helpdesk_option_2"><%= h(22722/*Deliver to helpdesk operators*/) %>&nbsp;</label></td></tr></tbody></table></td><td valign="top" width="50%"><table role="none" class="pwc1" cellpadding="2" cellspacing="0" border="0"><tr class="pwt"><td colspan="5"><table class="pwc" cellpadding="0" cellspacing="0" border="0"><tr class="pwt"><td class="ht"><h2 class="pwt__title"><%= h(8670/*Notification time*/) %></h2></td><td></td></tr></table><table></table></td></tr><tr class="bct"><td width="1">&nbsp;</td><td align="left"><label id="label_mssend_tyme"><%= h(11104/*Sending time*/) %></label></td><td>'+
r(23104,{"{DAY_TIME_SELECT}":'<select aria-labelledby="label_mssend_tyme" tabindex="0" name="mssend_at" id="mssend_at" class="formField pwi2" style="width: 100px; margin-right: 4px;"><% for (var i in lookups.mssend_at) { %><% var item = lookups.mssend_at[i]; %><option value="<%- item.value %>"<%- selected(item.value === mssend_at) %>><%- item.text %></option><% } %></select>',"{SIGN_SELECT}":'<select id="mssend_day_sign" aria-labelledby="label_mssend_tyme" tabindex="0" name="mssend_day_sign" class="formField pwi5" style="width: 40px; margin-right: 4px;"><option value="1"<%- selected(mssend_day_shift >= 0) %>>+</option><option value="0"<%- selected(mssend_day_shift < 0) %>>-</option></select>',
"{DAY_COUNT_INPUT}":'<input class="formField pwi7" tabindex="0" id="mssend_day_shift" aria-labelledby="label_mssend_tyme" aria-describedby="label_mssend_days" type="text" size="2" name="mssend_day_shift" value="<%- Math.abs(mssend_day_shift) %>"><label id="label_mssend_days">'})+'</label></td></tr><tr class="bct" id="mssend_from_tr"><td width="1">&nbsp;</td><td width=37%  align="left"><label id="label_mssend_from_time"><%= h(5409/*Start time*/) %></label></td><td class="font-nowrap">'+r(23105,{"{HOURS_SELECT}":'<select id="mssend_from_h" name="mssend_from_h" tabindex="0" class="formField pwi3" aria-labelledby="label_mssend_from_time" aria-describedby="desc_mssend_from_time_hours"><% for (var i in lookups.mssend_from_h) { %><% var item = lookups.mssend_from_h[i]; %><option value="<%- item.value %>"<%- selected(item.value === mssend_from_h) %>><%- item.text %></option><% } %></select>',
"{MINUTES_SELECT}":'<input id="mssend_from_m" type="text" tabindex="0" aria-labelledby="label_mssend_from_time" aria-describedby="desc_mssend_from_time_minutes" name="mssend_from_m" class="formField pwi5" value="<%- mssend_from_m %>" maxlength="2" style="margin-left: 4px;" />'})+'<span id="desc_mssend_from_time_hours" class="none-core"><%= h(1220/*hours*/) %></span>\x3c!-- hidden --\x3e<span id="desc_mssend_from_time_minutes" class="none-core"><%= h(1023/*minutes*/) %></span>\x3c!-- hidden --\x3e</td></tr><tr class="bct" id="mssend_within_tr"><td width="1"><abbr id="req_label_mssend_within" class="ofsc-abbr-mandatory" title="{22351}">*</abbr></td><td  width=47%  align="left"><label id="label_mssend_within"><%= h(17533/*Sending will time out in*/) %></label></td><td>'+
r(17518,{"{HOUR}":'<input type="text" id="mssend_within_h" name="mssend_within_h" aria-labelledby="req_label_mssend_within label_mssend_within desc_mssend_within_hours" class="formField pwi5" value="<%- mssend_within_h %>" maxlength="2" /><span class="none-core" id="desc_mssend_within_hours"><%= h(1220/*hours*/) %></span>',"{MINUTE}":'<input type="text" id="mssend_within_m" name="mssend_within_m" aria-labelledby="req_label_mssend_within label_mssend_within desc_mssend_within_minutes" class="formField pwi5" value="<%- mssend_within_m %>" maxlength="2" /><span class="none-core" id="desc_mssend_within_minutes"><%= h(1023/*minutes*/) %></span>'})+
'</td></tr><tr class="bct" id="msfaultretries_tr"><td width="1">&nbsp;</td><td width=36% align="left" title="<%= h(1503/*Number of attempts that must sequentially fail to go to the next scenario step*/) %>"><label id="label_msfaultretries"><%= h(8672/*Number of attempts on \'failed\' status*/) %></label></td><td>'+r(20201,{"{INTERVAL}":'<input aria-labelledby="label_msfaultretries" aria-describedby="desc_msfaultretries_interval" type="text" id="msfaultretries" name="msfaultretries" class="formField pwi5" value="<%- msfaultretries %>" maxlength="3" /><span class="none-core" id="desc_msfaultretries_interval"><%= h(1504/*Interval*/) %></span>',
"{MINUTES}":'<input aria-labelledby="label_msfaultretries" aria-describedby="desc_msfaultretries_minutes" type="text" id="msfaultinterval" name="msfaultinterval" class="formField pwi5" value="<%- msfaultinterval %>" maxlength="3" /><span class="none-core" id="desc_msfaultretries_minutes"><%= h(1023/*minutes*/) %></span>'})+'</td></tr><tr class="bct" id="mssentretries_tr"><td width="1">&nbsp;</td><td width=36%  align="left" title="<%= h(1506/*Number of attempts that must get the status \'Sent\' to go to the next scenario step*/) %>"><label id="label_mssentretries"><%= h(8673/*Number of attempts on \'sent\' status*/) %></label></td><td>'+
r(20201,{"{INTERVAL}":'<input aria-labelledby="label_mssentretries" aria-describedby="desc_mssentinterval_interval" type="text" id="mssentretries" name="mssentretries" class="formField pwi5" value="<%- mssentretries %>" maxlength="3" /><span class="none-core" id="desc_mssentinterval_interval"><%= h(1504/*Interval*/) %></span>',"{MINUTES}":'<input aria-labelledby="label_mssentretries" aria-describedby="desc_mssentinterval_minutes" type="text" id="mssentinterval" name="mssentinterval" class="formField pwi5" value="<%- mssentinterval %>" maxlength="3" /><span class="none-core" id="desc_mssentinterval_minutes"><%= h(1023/*minutes*/) %></span>'})+
'</td></tr><tr class="bct" id="msdelay_tr"><td width="1">&nbsp;</td><td width=37% align="left"><label id="label_msdelay"><%= h(3605/*Sending delay*/) %></label></td><td>'+r(23107,{"{DELAY_INPUT}":'<input type="text" id="msdelay" name="msdelay" aria-labelledby="label_msdelay" class="formField pwi5" value="<%- msdelay %>" maxlength="3" />'})+'</td></tr><tr class="bct"><td width="1">&nbsp;</td><td align="left"><label id="labelfor_weekdays"><%= h(6817/*Block messages for specific days*/) %></td><td colspan="3"><table role="none" cellspacing="0" cellpadding="0" border="0" class="week"><tr class="bct"><% for (var i in lookups.msskip_weekdays_header) { %><td><label id="labelfor_<%- lookups.msskip_weekdays_header[i].day %>"><%- lookups.msskip_weekdays_header[i].day %></label></td><% } %></tr><tr><% for (var i in lookups.msskip_weekdays) { %><% var item = lookups.msskip_weekdays[i]; %><td><input aria-labelledby="labelfor_weekdays" aria-describedby="labelfor_<%- item.day %>" type="checkbox" class="formField msskip_weekday" name="msskip_weekdays[<%- item.day_id %>]" data-dayid="<%- item.day_id %>" value="1"<%- checked(item.day_id & msskip_weekdays) %> /></td><% } %></tr></table></td></tr><tr class="bct"><td width="1">&nbsp;</td><td align="left"><label id="label_message_for_holyday"><%= h(6818/*Block messages for holidays*/) %></label></td><td><input class="formField" type="checkbox" id="msskip_holidays" aria-labelledby="label_message_for_holyday" name="msskip_holidays" value="1"<%- checked(msskip_holidays) %> /></td></tr><tr class="bct"><td width="1">&nbsp;</td><td align="left" valign=top style="white-space:nowrap;"><label id="label_message_for_sending"><%= h(6819/*Blocked messages sending*/) %></label></td><td>'+
r(23106,{"{DAYS_SHIFT_SELECT}":'<select aria-labelledby="label_message_for_sending" tabindex="0" id="msmax_days_to_shift" name="msmax_days_to_shift" class="formField pwi5"><% for (var i = 0; i < 11; i++) { %><option value="<%- i %>"<%- selected(i === msmax_days_to_shift) %>><%- i %></option><% } %></select>',"{LINE_BREAK}":"<br />"})+"</td></tr></table></td></tr></table>"}))})(toa);(function(d){var c=d.views.messageScenarios.BaseView;d.ns("toa.views.messageScenarios.scenarioStepPopup.PatternsTab",d.define(c,function(){c.apply(this,arguments)},{events:{"change .msfeature":"onChangeFeature","change .patternSubject":"onChangePattern","change .patternBody":"onChangePattern"},onChangeFeature:function(b){var c=0;b=$(b.currentTarget);b.is(":checked")&&(c=1==b.val()?1:0);this.model.set({generateMessageOnCreation:c})},onChangePattern:function(b){var c=$(b.currentTarget);b=c.val();var d=
c.data("langid"),c=c.hasClass("patternSubject"),k=this.model.getPattern(d);this.model.setPattern(d,{subject:c?b:k.subject,body:c?k.body:b})},showAll:function(){this.getElement().find(".messagePatternItem").removeClass("hidden").show();this.setTextareaRows(2>this.model.get("lookups").language.length?15:6)},showSelected:function(b){this.getElement().find(".messagePatternItem").addClass("hidden").hide();this.getElement().find("#message_pattern_table_"+b).removeClass("hidden").show();this.setTextareaRows(15)},
setTextareaRows:function(b){this.getElement().find("textarea").each(function(c,d){$(d).attr("rows",b)})},afterRender:function(){this.readOnlyMode&&(this._$el.find(".formField").prop("disabled",!0),this._$el.find(".patternBody,.patternSubject").prop("readonly",!0))},render:function(b,d){c.prototype.render.apply(this,arguments);this.afterRender();return this},template:'<% var textareaRows = lookups.language.length < 2 ? 15 : 6; %><table class="pwc1" width="100%" cellpadding="0" cellspacing="0" border="0"><tr class="pwt"><td class="ht"><h2 class="pwt__title"><%= h(2214/*Message patterns*/) %></h2></td></tr><tr class="bct"><td valign="top"><div style="overflow:auto;height:280px"><% for (var i in lookups.language) { %><% var lang = lookups.language[i]; %><% var subject = patterns[lang.id] ? patterns[lang.id].subject : \'\'; %><% var body = patterns[lang.id] ? patterns[lang.id].body : \'\'; %><div id="message_pattern_table_<%- lang.id %>" class="messagePatternItem"><table cellspacing="0" cellpadding="0" border="0"><tr class="bc"><td id="s<%- lang.id %>">'+
r(23101,{"{LANGUAGE_NAME}":"<%- lang.text %>"})+'</td><td width="15" rowspan="2">&nbsp;</td><td id="b<%- lang.id %>">'+r(23102,{"{LANGUAGE_NAME}":"<%- lang.text %>"})+'</td></tr><tr><td><textarea aria-labelledby="s<%- lang.id %>" id="message_pattern_subject_<%- lang.id %>" name="message_pattern[<%- lang.id %>][mpsubject]" rows="<%- textareaRows %>" class="patternSubject pwi8" lang="<%- lang.label %>" data-langid="<%- lang.id %>"><%- subject %></textarea></td><td><textarea aria-labelledby="b<%- lang.id %>" id="message_pattern_body_<%- lang.id %>" name="message_pattern[<%- lang.id %>][mpbody]" rows="<%- textareaRows %>" class="patternBody pwi11" lang="<%- lang.label %>" data-langid="<%- lang.id %>"><%- body %></textarea></td></tr></table></div><% } %></div></td></tr></table><% var checked = function(condition) { %><% return condition ? \' checked="checked"\' : \'\'; %><% }; %><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr class="small_header1"><td><input id="msfeatures_1" type="radio" name="msfeatures1" class="formField msfeature"<%- checked(generateMessageOnCreation) %> value="1" /></td><td><label for="msfeatures_1">&nbsp;<%= h(116/*Generate content on message creation*/) %>&nbsp;</label></td></tr><tr class="small_header1"><td><input id="msfeatures_2" type="radio" name="msfeatures1" class="formField msfeature"<%- checked(!generateMessageOnCreation) %> value="2" /></td><td><label for="msfeatures_2">&nbsp;<%= h(117/*Generate content on message sending*/) %>&nbsp;</label></td></tr></table>'}))})(toa);(function(d){var c=d.views.messageScenarios.BaseView;d.ns("toa.views.messageScenarios.scenarioStepPopup.Container",d.define(c,function(){c.apply(this,arguments)},{events:{"click .tab":"showTab","keypress .tab":"showTab"},regions:{settings:"#tab1_div",patterns:"#tab2_div",conditions:"#tab3_div",nextSteps:"#tab4_div"},tabs:{settings:{"default":h(3295)},patterns:{"default":h(6816)},conditions:{list:h(20363),add:h(20364),modify:h(20365),view:h(20366)},nextSteps:{list:h(20382),add:h(20384),modify:h(20384),
view:h(20384)}},showTab:function(b){if("keypress"!==b.type||13===b.keyCode){var c=$(b.currentTarget).data("tabid");b=this.getElement().find("#"+c+"_td");c=this.getElement().find("#"+c+"_div");if(b.parent().hasClass("disabled"))return!1;this.getElement().find(".tab_td").removeClass("selected");this.getElement().find(".tab_div").removeClass("selector-show").addClass("selector-hide");for(var d=1;4>=d;d++){var k=4-d+1;this.getElement().find("#tab"+d+"_td").css({"z-index":k})}b.css({"z-index":10});b.addClass("selected");
c.removeClass("selector-hide").addClass("selector-show");this.notify("center_popup",this)}},getTab:function(b){return this.getElement().find("#"+this.getTabId(b))},getTabId:function(b){var c;switch(b){case "settings":c="settingsTab";break;case "patterns":c="patternsTab";break;case "conditions":c="blockingConditionsTab";break;case "nextSteps":c="nextStepsTab"}return c},isTabForm:function(b){return this.getTab(b).hasClass("viewForm")},enableTabs:function(b){b=(b=b||!1)?"#"+this.getTabId(b):"";this.getElement().find(".tabsarea td.tab"+
b).removeClass("disabled")},disableTabs:function(b){b=(b=b||!1)?"#"+this.getTabId(b):"";this.getElement().find(".tabsarea td.tab"+b).addClass("disabled")},setTabToForm:function(b,c){var d=this.getTab(b);d.addClass("viewForm");d.find(".tabCaption").text(this.tabs[b][c])},setTabToList:function(b){var c=this.getTab(b);c.removeClass("viewForm");c.find(".tabCaption").text(this.tabs[b].list)},template:'<div class="jet-css-only-popup"><div class="jet-css-only-iframe company-settings-set-message-step" id="scenarioStepContainer" style="padding: 0px"><div class="tabset"><div class="tabscontainer"><div class="tabsarea" role="tablist"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr style="vertical-align: top;"><td class="tab" id="settingsTab" data-tabid="tab1"><div id="tab1_td" tabindex="0" role="tab" class="tab_td selected" style="z-index: 10;" ><div class="tabCaption"><%= h(3295 /* Settings */) %></div></div></td><td class="tab" id="patternsTab" data-tabid="tab2"><div id="tab2_td" tabindex="0" role="tab" class="tab_td" style="z-index: 3;"><div class="tabCaption"><%= h(6816 /* Patterns */) %></div></div></td><td class="tab" id="blockingConditionsTab" data-tabid="tab3"><div id="tab3_td" tabindex="0" role="tab" class="tab_td" style="z-index: 2;"><div class="tabCaption"><%= h(20363 /* Blocking Conditions */) %></div></div></td><td class="tab" id="nextStepsTab" data-tabid="tab4"><div id="tab4_td" tabindex="0" role="tab" class="tab_td" style="z-index: 1;"><div class="tabCaption"><%= h(20382 /* Next Steps */) %></div></div></td></tr></tbody></table></div></div></div><table class="jet-css-only-tab-content" border="0" cellspacing="0" padding="0"><tr valign="top"><td colspan="2" class="tab_content"><div id="tab1_div" role="tabpanel" class="tab_div selector-show" style="min-height: 340px !important;"></div><div id="tab2_div" role="tabpanel" class="tab_div selector-hide" ></div><div id="tab3_div" role="tabpanel" class="tab_div selector-hide"></div><div id="tab4_div" role="tabpanel" class="tab_div selector-hide"></div></td></tr></table></div></div>'}))})(toa);(function(d){d.ns("toa.controllers.MessageScenarioStep",d.define(d.Controller,function(c){this.scenarioId=c.scenarioId;this.stepId=c.stepId||null;this.readOnlyMode=c.readOnly||!1;this.resume()},{backToListButton:null,errors:[],warnings:[],toString:function(){return"MessageScenarioStep popup controller"},isNewStep:function(){return null===this.stepId},isReadOnly:function(){return this.readOnlyMode||!1},getScenarioId:function(){return this.scenarioId},getStepId:function(){return this.stepId},resume:function(){this.initModels();
this.initViews();this.loadStepData()},loadStepData:function(){d.app.trigger("global.data.get",{controller:"messagescenario",method:"getScenarioStep",params:{scenarioId:this.getScenarioId(),stepId:this.getStepId()},responseHandler:this.onLoadStepResponse.bind(this),errorHandler:this.onLoadStepError.bind(this)})},onLoadStepResponse:function(c,b){b&&b.status&&"OK"===b.status&&b.step&&b.initial_data&&b.initial_data.lookups?(this.initStepPopup(),this.stepModel.setData(b.step),this.stepModel.setLookups(b.initial_data.lookups),
this.stepPopupView.showRegion("settings",this.settingsTab),this.stepPopupView.showRegion("patterns",this.patternsTab),this.settingsTab.showHidePattern(),this.settingsTab.helpdeskMessageScenarioOption(),window.initialListRender=!0,window.listRenderTimeout=10,this.initBlockingConditionsTab(),this.initNextStepsTab(),this.recenterPopup()):(this.showError(h(23108)),this.unlockStep())},onLoadStepError:function(){this.showError(h(15367));this.unlockStep()},initBlockingConditionsTab:function(){this.conditionMapper=
new d.messageScenarios.dataMappers.BlockingConditionDataMapper(null,this.stepModel.getConditionsLookups(this.isReadOnly()),this.stepModel.getMethod());this.conditionsListMapper=new d.messageScenarios.dataMappers.BlockingConditionsListDataMapper(null,this.conditionMapper);this.conditionsListCollection=this.conditionsListMapper.create(this.stepModel.getBlockingConditions());this.conditionModel=this.conditionMapper.create();this.blockingConditionsTab=new d.views.messageScenarios.scenarioStepPopup.BlockingConditionsTab;
this.conditionsListView=new d.views.messageScenarios.scenarioStepPopup.ConditionsList({collection:this.conditionsListCollection});this.conditionFormView=new d.views.messageScenarios.scenarioStepPopup.ConditionForm({model:this.conditionModel});this.isReadOnly()&&(this.conditionsListView.setReadOnlyMode(!0),this.conditionFormView.setReadOnlyMode(!0));this.conditionsListView.addListener("conditionaction:add",this.onConditionAdd.bind(this));this.conditionsListView.addListener("conditionaction:delete",
this.onConditionDelete.bind(this));this.conditionsListView.addListener("conditionaction:modify",this.onConditionModify.bind(this));this.conditionsListView.addListener("conditionaction:view",this.onConditionView.bind(this));this.conditionFormView.addListener("conditionaction:save",this.onConditionSave.bind(this));this.stepPopupView.showRegion("conditions",this.blockingConditionsTab);this.blockingConditionsTab.showRegion("list",this.conditionsListView)},initNextStepsTab:function(){this.nextStepMapper=
new d.messageScenarios.dataMappers.NextStepDataMapper(null,this.stepModel.getNextStepLookups(),this.stepModel.getMethod());this.nextStepsListMapper=new d.messageScenarios.dataMappers.NextStepsListDataMapper(null,this.nextStepMapper);this.nextStepsListCollection=this.nextStepsListMapper.create(this.stepModel.getNextSteps());this.nextStepModel=this.nextStepMapper.create();this.nextStepsTab=new d.views.messageScenarios.scenarioStepPopup.NextStepsTab;this.nextStepsListView=new d.views.messageScenarios.scenarioStepPopup.NextStepsList({collection:this.nextStepsListCollection});
this.nextStepFormView=new d.views.messageScenarios.scenarioStepPopup.NextStepForm({model:this.nextStepModel});this.isReadOnly()&&(this.nextStepsListView.setReadOnlyMode(!0),this.nextStepFormView.setReadOnlyMode(!0));this.nextStepsListView.addListener("nextstepaction:add",this.onNextStepAdd.bind(this));this.nextStepsListView.addListener("nextstepaction:delete",this.onNextStepDelete.bind(this));this.nextStepsListView.addListener("nextstepaction:modify",this.onNextStepModify.bind(this));this.nextStepsListView.addListener("nextstepaction:view",
this.onNextStepView.bind(this));this.nextStepFormView.addListener("nextstepaction:save",this.onNextStepSave.bind(this));this.stepPopupView.showRegion("nextSteps",this.nextStepsTab);this.nextStepsTab.showRegion("list",this.nextStepsListView)},initStepPopup:function(){this.stepPopup=new d.ui.Popup({title:this.getPopupTitle(),autoOpen:!0,view:this.stepPopupView,modal:!0,width:960,onClose:this.closeStepPopup.bind(this),buttons:this.getPopupButtons()});var c=parseInt($(this.stepPopup._dom.base).css("z-index"),
10)-10;$(this.stepPopup._dom.overlay).css({"z-index":c});$(this.stepPopup._dom.base).css({"z-index":++c});$(this.stepPopup._dom.contentMarginTop).height(0)},getPopupButtons:function(){var c=[];this.isReadOnly()?c.push({text:h(436),type:"submit",position:"right",id:"closeButton",click:this.closeStepPopup.bind(this)}):(c.push({text:h(22),position:"left",id:"cancelButton",click:this.closeStepPopup.bind(this)}),c.push({text:h(12),type:"submit",position:"right",id:"saveButton",click:this.saveScenarioStep.bind(this)}));
return c},getPopupTitle:function(){var c="";return c=this.isReadOnly()?h(2243):this.isNewStep()?h(2207):h(1487)},closeStepPopup:function(){this.stepPopup.destroy();this.unlockStep()},saveScenarioStep:function(){this.stepPopup.disableButton("saveButton");this.validateStep()?this.processSaveStep():this.stepPopup.enableButton("saveButton")},processSaveStep:function(){d.app.trigger("global.data.get",{controller:"messagescenario",method:"setScenarioStep",params:{scenarioId:this.getScenarioId(),stepId:this.getStepId(),
stepData:this.stepModel.getPreparedData()},responseHandler:this.onSaveStepSuccess.bind(this),errorHandler:this.onSaveStepError.bind(this)})},onSaveStepSuccess:function(c,b){this.stepPopup.enableButton("saveButton");this.stepPopup.removeErrors();if("OK"===b.status)this.closeStepPopup(),d.app.trigger("toa.controllers.MessageScenarios.refreshStepList");else if("ERR_VALIDATION"===b.status){var e=b.error_code||[];e.length&&(this.errors=[],$.each(e,function(b,c){this.errors.push({errorText:c})}.bind(this)),
this.showStepPopupErrors())}else this.showError(h(23109))},onSaveStepError:function(c){this.stepPopup.enableButton("saveButton");isError(c)||this.showError(h(15367))},showStepPopupErrors:function(){var c=$(this.stepPopup._dom.errors);c.empty().hide();$.each(this.errors,function(b,d){c.append(d.errorText+"<br />")}.bind(this));c.show();this.recenterPopup()},validateStep:function(){this.errors=[];this.warnings=[];for(var c=ignoreSpaces(this.settingsTab.getValue("msname")),b=this.settingsTab.getValue("mstype"),
d=this.settingsTab.getMethodValue(),g=ignoreSpaces(this.settingsTab.getValue("msfaultretries")),k=ignoreSpaces(this.settingsTab.getValue("msfaultinterval")),l=ignoreSpaces(this.settingsTab.getValue("mssentretries")),n=ignoreSpaces(this.settingsTab.getValue("mssentinterval")),p=ignoreSpaces(this.settingsTab.getValue("msdelay")),s=this.settingsTab.getValue("msrecipient"),t=this.settingsTab.getValue("msstaticaddress"),u=ignoreSpaces(this.settingsTab.getValue("msreplyto")),v=this.settingsTab.getValue("msstatic_zid"),
w=this.settingsTab.getValue("msstatic_lid"),x=this.settingsTab.getValue("mssend_within_h"),y=this.settingsTab.getValue("mssend_within_m"),z=this.stepModel.getDisabledMethods(),A=0;A<this.stepModel.get("desc",[]).length;A++){var B=this.stepModel.get("msstatus",[])[A];d===z[B]&&this.errors.push({errorText:h(20202)})}"collaboration"===d&&"static"===s&&(z=this.stepModel.get("mscollaboration_receivers"),z.users.length||z.groups.length||z.helpdesks.length||this.errors.push({errorText:h(20192)}));0==x&&
0==y&&this.errors.push({errorText:r(11106,{"{FIELD}":h(17533)})});isPositiveInteger(x)&&isPositiveInteger(y)||this.errors.push({errorText:r(18262,{"{FIELD}":h(17533)})});c&&!isSpecial(c)||this.errors.push({errorText:h(1470)});b||this.errors.push({errorText:h(1471)});d||this.errors.push({errorText:h(1472)});this.settingsTab.isDisabled("msfaultretries")||(isInt(g)?1<g&&(!k||"0"==k)&&this.errors.push({errorText:h(1475)}):this.errors.push({errorText:h(1474)}),k&&!isPositiveInteger(k)?this.errors.push({errorText:h(1476)}):
0<k&&1==g&&this.errors.push({errorText:h(1477)}));this.settingsTab.isDisabled("mssentretries")||(isInt(l)?1<l&&(!n||"0"==n)&&this.errors.push({errorText:h(1479)}):this.errors.push({errorText:h(1478)}),n&&!isPositiveInteger(n)?this.errors.push({errorText:h(1480)}):0<n&&1==l&&this.errors.push({errorText:h(1481)}));s||"IVR"===d?"static"===s&&"collaboration"!==d&&("set_property"!==d&&"external_system"!==d&&(t||this.errors.push({errorText:h(1833)})),v||this.errors.push({errorText:h(1834)}),w||this.errors.push({errorText:h(1835)})):
this.errors.push({errorText:h(1482)});if("email"===d||"nextel"===d)""===u?this.errors.push({errorText:h(16690)}):TypeValidator.isStringEmail(u)||this.errors.push({errorText:h(5054)});""===t||TypeValidator.isStringEmail(t)||"email"!==d&&"nextel"!==d||this.errors.push({errorText:h(23153)});""===t||TypeValidator.isStringPhoneNumber(t)||"voice"!==d||this.errors.push({errorText:h(23152)});""===p?this.errors.push({errorText:h(3606)}):isInt(p,4)||this.errors.push({errorText:h(3607)});$.each(this.stepModel.getLookup("language"),
function(b,c){var d=c.id,e=this.patternsTab.getElement().find("#message_pattern_table_"+d);if(!e.length||e.is(":hidden")&&e.hasClass("hidden"))this.stepModel.isEmptyPattern(d)||this.stepModel.setEmptyPattern(d);else{var g="",k=e.find("#message_pattern_subject_"+d).val();k&&(g=r(23101,{"{LANGUAGE_NAME}":c.text}),this._checkPatternContent(g,k));if(e=e.find("#message_pattern_body_"+d).val())g=r(23102,{"{LANGUAGE_NAME}":c.text}),this._checkPatternContent(g,e);this.stepModel.setPattern(d,{subject:k,body:e})}}.bind(this));
return this.errors.length?(this.showStepPopupErrors(),!1):this.warnings.length?(this.showStepPopupWarnings(),!1):!0},showStepPopupWarnings:function(){var c="";$.each(this.warnings,function(b,d){c+=" - "+d.warningText+"<br/>"}.bind(this));var c=c+h(2378),b=[{text:h(22),position:"left",click:function(b){b.reject()}},{text:h(445),position:"right",type:"submit",click:function(b){b.resolve();this.processSaveStep()}.bind(this)}];this.showPopup(h(14603),c,b)},_checkPatternContent:function(c,b){var d=b.match(/(\{\w+(\|.+)?\})/g);
if(d){var g,k;for(i=0;i<d.length;i++)g=d[i],g=g.substr(1,g.length-2),k=g.split("|"),g=k[0],k="undefined"!==typeof k[1]?k[1]:"","undefined"!==typeof this.stepModel.getLookup("appt_tags")[g]||/^(ex)?pr(num)?_/.test(g)||(g=r(23103,{"{PATTERN_NAME}":c,"{TAG}":"{"+g+(""!==k?"|"+k:"")+"}"}),this.warnings.push({warningText:g}))}},initModels:function(){this.stepModel=new d.models.messageScenarios.MessageScenarioStep},initViews:function(){this.stepPopupView=new d.views.messageScenarios.scenarioStepPopup.Container;
this.settingsTab=new d.views.messageScenarios.scenarioStepPopup.SettingsTab({model:this.stepModel});this.patternsTab=new d.views.messageScenarios.scenarioStepPopup.PatternsTab({model:this.stepModel});this.isReadOnly()&&(this.settingsTab.setReadOnlyMode(!0),this.patternsTab.setReadOnlyMode(!0));this.stepPopupView.addListener("center_popup",this.recenterPopup.bind(this));this.settingsTab.addListener("center_popup",this.recenterPopup.bind(this));this.settingsTab.addListener("update_method",this.updateScenarioMethod.bind(this));
this.settingsTab.addListener("show_hide_message_pattern",this.displayPatterns.bind(this))},displayPatterns:function(c,b){!1===b?this.patternsTab.showAll():this.patternsTab.showSelected(b)},recenterPopup:function(){this.stepPopup.setPositionCenter()},updateScenarioMethod:function(c,b){this.nextStepModel.setScenarioMethod(b);this.conditionModel.setScenarioMethod(b)},onConditionAdd:function(c){this.conditionModel.setEmpty();this.showConditionsTabForm(this.conditionModel,"add")},onConditionDelete:function(c,
b){var d=b.model.getOrder();this.conditionsListCollection.remove(b.model);this.conditionsListCollection.changeOrder(null,d);this.showConditionsTabList(!0);this.prepareConditions()},onConditionModify:function(c,b){this.conditionModel.set(b.model.toJSON());this.showConditionsTabForm(this.conditionModel,"modify")},onConditionView:function(c,b){this.conditionModel.set(b.model.toJSON());this.showConditionsTabForm(this.conditionModel,"view")},onConditionSave:function(c,b){var d=b.model.get("id"),g=b.model.toJSON();
if(null===d)g.id=this.conditionsListCollection.getNextId(),g=this.conditionMapper.create(g),this.conditionsListCollection.add(g),this.conditionsListCollection.changeOrder(g);else{var d=this.conditionsListCollection.get(d),k=d.getOrder();d.set(g);this.conditionsListCollection.changeOrder(d,k)}this.showConditionsTabList();this.prepareConditions()},showConditionsTabForm:function(c,b){this.conditionsListView.clear();this.conditionFormView.setConditionsList(this.conditionsListCollection.getCompactList("add"===
b?!1:c));this.blockingConditionsTab.showRegion("form",this.conditionFormView);this.togglePopupButtons("conditions");this.toggleTabs("conditions",b);this.recenterPopup()},showConditionsTabList:function(c){window.initialListRender=!1;c=c||!1;this.conditionFormView.clear();this.blockingConditionsTab.showRegion("list",this.conditionsListView);c||(this.togglePopupButtons(),this.toggleTabs("conditions"));this.recenterPopup()},onNextStepAdd:function(c){this.nextStepModel.setEmpty();this.showNextStepsTabForm(this.nextStepModel,
"add")},onNextStepDelete:function(c,b){this.nextStepsListCollection.remove(b.model);this.showNextStepsTabList(!0);this.prepareNextSteps()},onNextStepModify:function(c,b){this.nextStepModel.set(b.model.toJSON());this.showNextStepsTabForm(this.nextStepModel,"modify")},onNextStepView:function(c,b){this.nextStepModel.set(b.model.toJSON());this.showNextStepsTabForm(this.nextStepModel,"view")},onNextStepSave:function(c,b){var d=b.model.get("id"),g=b.model.toJSON();null===d?(g.id=this.nextStepsListCollection.getNextId(),
d=this.nextStepMapper.create(g),this.nextStepsListCollection.add(d)):this.nextStepsListCollection.get(d).set(g);this.showNextStepsTabList();this.prepareNextSteps()},showNextStepsTabForm:function(c,b){this.nextStepsListView.clear();this.nextStepsTab.showRegion("form",this.nextStepFormView);this.togglePopupButtons("nextSteps");this.toggleTabs("nextSteps",b);this.recenterPopup()},showNextStepsTabList:function(c){window.initialListRender=!1;c=c||!1;this.nextStepFormView.clear();this.nextStepsTab.showRegion("list",
this.nextStepsListView);c||(this.togglePopupButtons(),this.toggleTabs("nextSteps"));this.recenterPopup()},prepareNextSteps:function(){var c=this.nextStepsListMapper.serialize(this.nextStepsListCollection);this.stepModel.setNextSteps(c)},prepareConditions:function(){var c=this.conditionsListMapper.serialize(this.conditionsListCollection);this.stepModel.setBlockingConditions(c)},togglePopupButtons:function(c){c=c||!1;!c&&this.backToListButton?(this.removeBackButton(),this.isReadOnly()?this.stepPopup.displayInlineButton("closeButton"):
(this.stepPopup.displayInlineButton("cancelButton"),this.stepPopup.displayInlineButton("saveButton"))):(this.isReadOnly()?this.stepPopup.displayNoneButton("closeButton"):(this.stepPopup.displayNoneButton("cancelButton"),this.stepPopup.displayNoneButton("saveButton")),this.addBackButton(c))},addBackButton:function(c){var b="conditions"===c?h(20393):h(20383);this.backToListButton=d.view.control.create({xtype:"Button",name:"backToList",label:"< "+b,id:"backToListButton",class:"popup-button-left toa-button",
listeners:{click:function(b){"conditions"===c?this.showConditionsTabList():this.showNextStepsTabList()}.bind(this)}});this.errors.length&&$(this.stepPopup._dom.errors).is(":visible")&&$(this.stepPopup._dom.errors).hide();this.backToListButton.render($(this.stepPopup._dom.buttonsBlock))},removeBackButton:function(){this.backToListButton.destroy();this.backToListButton=null;this.errors.length&&!$(this.stepPopup._dom.errors).is(":visible")&&$(this.stepPopup._dom.errors).show()},toggleTabs:function(c,
b){b=b||!1;!b&&this.stepPopupView.isTabForm(c)?(this.stepPopupView.setTabToList(c),this.stepPopupView.enableTabs()):(this.stepPopupView.disableTabs(),this.stepPopupView.enableTabs(c),this.stepPopupView.setTabToForm(c,b))},suspend:function(c){this.destroy()},destroy:function(){this.screen.empty()},setState:function(c,b){d.isString(c)?this.state[c]=b:d.isObject(c)?$.extend(this.state,c):!1===c&&this.setDefaultState()},getState:function(c){return this.state[c]},setDefaultState:function(){this.state=
$.extend(this.state,{allowModify:!1})},unlockStep:function(){d.app.trigger("toa.controllers.MessageScenarios.unlockStep")},showError:function(c,b){c=c||h(3057);b=b||h(5651);return this.showPopup(b,c,!1)},showPopup:function(c,b,e){c=c||"";b=b||"";var g=$.Deferred(),k=[{text:h(445),position:"right",type:"submit",click:function(){g.reject()}}];e&&$.isArray(e)&&e.length&&($.each(e,function(b,c){if("function"===typeof c.click){var d=c.click;c.click=function(){var b=Array.prototype.slice.call(arguments);
b.unshift(g);d.apply(this,b)}}}.bind(this)),k=e);g.always(function(){l.destroy()});var l=new d.ui.Popup({title:c,autoOpen:!0,html:b,modal:!0,onClose:function(){l.destroy();g.reject()},buttons:k});l._dom.base.id="toa-messagescenarios-popup";return g}}))})(toa);(function(d){var c='<div>,<div class="msreceiver-search">,<div class="msreceiver-search-form">,<table>,<tr>,<td>,<div class="msreceiver-search-text">,<div class="msreceiver-search-icon">&nbsp;</div>,<input type="text" name="search_value" placeholder="<%=PLACEHOLDER_FOR_SEARCH%>" maxlength="<%=LIMIT_OF_SEARCH_STRING%>"/>,<div class="msreceiver-search-clear">&nbsp;</div>,</div>,</td>,</tr>,</table>,</div>,<div class="msreceiver-search-data" style="overflow:auto;">,<div style="clear:both;"></div>,<div class="msreceiver-search-empty">,<div class="msreceiver-search-empty-title"><%=EMPTY_TITLE%></div>,<div class="msreceiver-search-empty-msg"></div>,</div>,<div class="msreceiver-search-error">,<div class="msreceiver-search-empty-title"><%=ERROR_TITLE%></div>,<div class="msreceiver-search-empty-msg"><%=ERROR_MSG%></div>,</div>,<div class="msreceiver-search-warning">,<div class="msreceiver-search-warning-title"><%=WARNING_TITLE%></div>,<div class="msreceiver-search-warning-msg"><%=WARNING_TEXT%></div>,</div>,</div>,</div>,</div>'.split(","),
b='<div class="<%=nameBlock%>">;<div class="msreceiver-search-result-table"></div>;<div class="msreceiver-search-result-table-header">;<div class="msreceiver-search-result-table-title">;<div class="msreceiver-search-result-table-titleblock"><%=titleBlock%></div>;<div class="msreceiver-search-result-table-counter"></div>;</div>;</div>;<table class="msreceiver-search-grid"></table>;<div class="msreceiver-search-clearing"></div>;</div>;<div class="msreceiver-search-clearing"></div>'.split(";"),e={receiversGrid:{},
searchFields:{users:h(16631),groups:h(18829),helpdesks:h(16641)},searchResult:{},searchEmpty:null,searchError:null,searchIcon:null,search:null,searchText:"",oldSearchText:"",waitNextRequest:!1,debounceTimeLimit:1E3,isChangeWorking:!1,countRows:30,limitOfSearchString:100,searchHandler:!1,toString:function(){return"Message Scenario Receiver Search controller"},_create:function(b){var e=this,n=b.addItem;g.prototype._create.call(this);e.searchHandler=b.prepareSearchHandler||function(){};e.search=$((new d.Template(c)).apply({EMPTY_TITLE:h(20200),
ERROR_TITLE:h(11852),ERROR_MSG:h(11854),WARNING_TITLE:h(14603),WARNING_TEXT:h(1737),LIMIT_OF_SEARCH_STRING:e.limitOfSearchString,PLACEHOLDER_FOR_SEARCH:h(20203)}));e.handlerOnChangeErrorHandler=function(b,c){this.isChangeWorking=!1}.bind(e);e.handlerSearchItemOnClick=e.onItemClick.bind(e);e.handlerSearchItemOnDbclick=function(){this.search.Tip("hide")}.bind(e);e.handlerOnChangeResponseHandler=e.showResult.bind(e);e.handlerTouchScrollTouchstart=function(b){b=b.originalEvent.changedTouches[0];this.touch.lastX=
b.clientX;this.touch.lastY=b.clientY;this.touch.moved=!1}.bind(e);e.handlerTouchScrollTouchmove=function(b){if(!_DATA||!_DATA.ipadDrag){this.touch.moved=!0;b=b.originalEvent.changedTouches[0].clientY;var c=this.touch.lastY-b;this.touch.lastY=b;b=el.scrollTop()+c;el.scrollTop(b);return!1}}.bind(e);e.appendTip();e.receiverSearch=$(".msreceiver-search .msreceiver-search");e.searchEmpty=e.receiverSearch.find(".msreceiver-search-empty");e.searchError=e.receiverSearch.find(".msreceiver-search-error");e.searchData=
e.receiverSearch.find(".msreceiver-search-data");e.searchIcon=e.receiverSearch.find(".msreceiver-search-icon");e.searchForm=e.receiverSearch.find(".msreceiver-search-form");e.searchClear=e.receiverSearch.find(".msreceiver-search-clear");e.searchWarning=e.receiverSearch.find(".msreceiver-search-warning");e.searchInputContainer=e.searchForm.find(".msreceiver-search-text");e.searchInput=e.searchInputContainer.find("input");e.searchData.off();e.addIcon=$(n);e.addIcon.click(function(){e.search.Tip("isOpen")?
e.search.Tip("hide"):(e.search.Tip("showAt",e.addIcon,"bottom"),e.resetSearch(),e.searchInput.focus(),e.changeSizeOfSearch(),e.touchScroll(e.searchData))});e.search.Tip("option","notOutsideElements",e.addIcon);var p=null,s=!1;e.searchInput.on("keyup input",function(b){p&&clearTimeout(p);e.searchText=this.value;p=setTimeout(function(){if(e.oldSearchText!==e.searchText||13===b.keyCode)e.onChange()},e.debounceTimeLimit)});e.searchIcon.click(function(b){s||(s=!0,e.onChange(),setTimeout(function(){s=!1},
e.debounceTimeLimit))});e.searchClear.on("click",function(){e.resetSearch()});e.initTablesForResult()},showResult:function(b,c){if(this.waitNextRequest)this.isChangeWorking=!1;else{this.hideAllInnerBlocks();this.searchData.show();var e=0,g=!1;this.search.find("msreceiver-search-container").detach();if(null===c||"OK"!==c.status)g=!0;else{this.searchResult=c={users:c.users||{users:[]},groups:c.groups||{groups:[]},helpdesks:c.helpdesks||{helpdesks:[]}};for(var s in c){var t=this.formatingRecordTableResult(c[s][s],
s);if(t&&""!==t){e++;var u=this.receiversGrid[s],v=u.find("table"),w=d.glossary({id:14604,type:"htmlExceptPlaceholder",translations:{"{FOUND}":'<span class="msreceiver-search-result-visible">'+(c[s].total||0)+"</span>","{TOTAL}":c[s].found||c[s].total}});u.find(".msreceiver-search-result-table-counter").html(w);v.empty();v.append(t);u.show();this.receiversGrid[s].off();this.receiversGrid[s].on("click","tr.search-receiver-item",this.handlerSearchItemOnClick)}}}this.searchError.hide();g?this.searchError.show():
e||this.searchEmpty.show();this.isChangeWorking=!1;this.changeSizeOfSearch()}},initTablesForResult:function(){for(var c in this.searchFields)this.receiversGrid[c]=$((new d.Template(b)).apply({nameBlock:"msreceiver-search-container "+c,titleBlock:this.searchFields[c]})),this.searchData.prepend(this.receiversGrid[c])},formatingRecordTableResult:function(b,c){c=c||"";var d="";if(!(b&&c in this.searchFields))return!1;for(var e=0;e<b.length;e++)if(b[e]){var g=b[e].uid||b[e].gid;g&&(d+='<tr class="search-receiver-item"><td class="msreceiver-search-identifier" data-type="'+
c+'" data-id="'+g+'">'+(b[e].uname||b[e].name)+"</td>",b[e].gid&&(d+='<td class="msreceiver-search-count">'+b[e].users+"</td>"),d+="</tr>")}return d},appendTip:function(){this.search.Tip({className:"msreceiver-search"})},_isTooSmallForSearch:function(b){return 3<=b.length||9<=encodeURI(b).length?!1:!0},onChange:function(b,c){var e=this;e.oldSearchText=e.searchText;if(e.isChangeWorking)e.waitNextRequest&&(clearTimeout(e.waitNextRequest),e.waitNextRequest=!1),e.waitNextRequest=setTimeout(function(){e.waitNextRequest=
!1;e.onChange()},e.debounceTimeLimit);else{e.isChangeWorking=!0;e.searchText&&(e.searchText=e.searchText.substr(0,e.limitOfSearchString));for(var g in e.receiversGrid)e.receiversGrid[g].hide(),e.receiversGrid[g].find("table").empty();e.searchInputContainer.show();e.searchText?e.searchClear.css("visibility","visible"):e.searchClear.css("visibility","hidden");!e.searchText||e._isTooSmallForSearch($.trim(e.searchText))?(e.hideAllInnerBlocks(),$.trim(e.searchText).length&&(e.searchWarning.show(),e.searchData.show()),
e.changeSizeOfSearch(),e.isChangeWorking=!1):d.app.trigger("global.data.get",{controller:"messagescenarioreceiversearch",method:"search",params:{keywords:e.searchText},errorHandler:e.handlerOnChangeErrorHandler,responseHandler:e.handlerOnChangeResponseHandler})}},changeSizeOfSearch:function(){this.searchData.is(":visible")&&this.searchData.height("auto");this.search.Tip("showAt",this.addIcon,"bottom");this.calculateHeightData()},resetSearch:function(){this.oldSearchText="";this.hideAllInnerBlocks();
this.searchClear.css("visibility","hidden");this.searchInputContainer.find("input").val("");this.searchText="";this.searchData.hide();this.receiverSearch.find(".msreceiver-search-container .msreceiver-search-grid").empty();this.receiverSearch.find(".msreceiver-search-container").hide();this.search.Tip("showAt",this.addIcon,"bottom");this.calculateHeightData()},onItemClick:function(b){var c;c=$(b.target);b=c.attr("data-id");c=c.attr("data-type");if(!(b&&0!==b&&c&&0!==c&&c in this.searchFields))return!0;
var d=this.searchResult[c][c];if(!Array.isArray(d))return!0;var e;if("users"===c)for(var g=0;g<d.length;g++){if(d[g].uid==b){e={uid:d[g].uid,uname:d[g].uname,ulogin:d[g].ulogin};break}}else for(g=0;g<d.length;g++)if(d[g].gid==b){e={gid:d[g].gid,name:d[g].name,users:d[g].users};break}e&&(this.searchHandler.call(this,e,c),this.search.Tip("hide"))},calculateHeightData:function(){var b=this.search.innerHeight()-this.searchForm.innerHeight()-6;this.searchData.height(b)},hideAllInnerBlocks:function(){for(var b in this.receiversGrid)this.receiversGrid[b].hide();
this.searchEmpty.hide();this.searchWarning.hide();this.searchError.hide();this.searchData.hide()},touchScroll:function(b){this.touch={lastX:0,lastY:0,moved:!1};b.on("touchstart",this.handlerTouchScrollTouchstart);b.on("touchmove",this.handlerTouchScrollTouchmove)}},g=d.Controller;d.controllers.MessageScenarioSearch=d.define(g,function(){this._create.apply(this,arguments)},e)})(toa);(function(d){var c=d.models.ObservableModel;d.ns("toa.models.deliveryChannels.BaseModel",d.define(c,function(b){c.apply(this,arguments)},{subscribeOnChild:function(b){b.addListener("all",function(){this.notify.apply(this,arguments)},this)},toJSON:function(){var b=c.prototype.toJSON.apply(this,arguments);this.idField in this.attributes||delete b[this.idField];return b}}))})(toa);(function(d){var c=d.models.ObservableCollection;d.ns("toa.models.deliveryChannels.BaseCollection",d.define(c,function(){c.apply(this,arguments)},{modelConstructor:d.models.deliveryChannels.BaseModel,where:function(b,c){var d=[];this.each(function(k,l){k.get(b)===c&&d.push(k)},this);return d},first:function(){return this.models[0]||null},find:function(b,c,d){return this.findBy(function(d){return d.get(b)==c},null,d)},findBy:function(b,c,d){b=this.findIndexBy(b,c,d);return-1<b?this.models[b]:null},
findIndexBy:function(b,c,d){var k=this.models;d=d||0;for(var l=k.length;d<l;d++)if(b.call(c||this,k[d]))return d;return-1},compact:function(){for(var b=this.compactData.apply(this,arguments),c=new this.constructor,d=0,k=b.length;d<k;d++)c.add(b[d],{silent:!0});return c},compactData:function(){var b=[],c=Array.prototype.slice.call(arguments,0);this.each(function(d){d=d.pick(c);b.push(d)});return b}}))})(toa);(function(d){var c=d.models.deliveryChannels.BaseCollection;d.ns("toa.models.deliveryChannels.SortableCollection",d.define(c,function(){c.apply(this,arguments)},{comparator:function(b,c){var d=+b.id,k=+c.id;b.get("name")&&c.get("name")&&(d=b.get("name"),k=c.get("name"));if(d==k)return 0;if(!d)return-1;if(!k)return 1;d=d.toLowerCase();k=k.toLowerCase();return d<k?-1:1}}))})(toa);(function(d){var c=d.models.deliveryChannels.BaseModel;d.ns("toa.models.deliveryChannels.DeliveryChannel",d.define(c,function(){c.apply(this,arguments)},{idField:"id",isRemovable:function(){return!0}}))})(toa);(function(d){d.ns("toa.views.deliveryChannels.BaseView",d.define(null,function(c){this.options=c||{};this.model=this.options.model;this.collectionModel=this.options.collectionModel;this._tpl=new d.Template(this.template)},$.extend({},d.mixins.EventEmitter,{template:"",regions:{},events:{},tag:"",render:function(c,b){b||c.empty();var d=$(this.getHtml());this._container=c;this._$el=0<d.length?d:c;c.append(d);this.initEvents();return this},getData:function(){return this.model&&this.model.toJSON()||{}},
getHtml:function(){return this._tpl.apply(this.getData())},initEvents:function(){$.each(this.events,function(c,b){var d=this._$el,g=c.split(" ");if(1!==g.length&&2!==g.length||!g[0].length)throw Error("Incorrect description of event selector ("+c+")");var k=b;"string"===typeof b&&(k=this[b]);if(!k||"function"!==typeof k)throw Error('Incorrect event handler for selector "'+c+'"');2===g.length&&(d=g[1],d=this._$el.find(d).addBack().filter(d));d.on(g[0],k.bind(this))}.bind(this))},showRegion:function(c,
b){var d=this._container.find(this.regions[c]).first();b.render(d)},hide:function(){this._$el.hide()},show:function(){this._$el.show()},_notifyOnChild:function(c,b){var d=Array.prototype.slice.call(arguments);d[0]=b;d[1]=c;this.notify.apply(this,d)},_subscribeChildView:function(c){c.addListener("all",$.proxy(this._notifyOnChild,this,c))},destroy:function(){$.isEmptyObject(this._childViews)||($.each(this._childViews,function(c,b){b.destroy.apply(b)}.bind(this)),this._childViews=[]);this.notify("destroy",
this)}})))})(toa);(function(d){var c=d.views.deliveryChannels.BaseView;d.ns("toa.views.deliveryChannels.BaseForm",d.define(c,function(b){c.apply(this,arguments)},{validate:function(){this.hideErrors();var b=!1;$.each(this.validators,function(c,d){var k=this._container.find(d.selector);$.each(k,function(c,e){var k=this.validateField(e,d.rules);k&&k.length&&(this.showError(e,k),b=!0)}.bind(this))}.bind(this));return!b},validateField:function(b,c){var d="";$.each(c,function(c,e){var n=this[e+"FieldValidate"];if(n)return d=
n.apply(this,[b])}.bind(this));return d},mandatoryFieldValidate:function(b){b=$(b).val();var c="";""===$.trim(b)&&(c=h(15905));return c},showError:function(b,c){var d=$("<div>").addClass("infoError").text(c);h(15905)===c&&d.addClass("errorMandatory");$(b).parent().find(":last-child").after(d);$(b).parent().parent().addClass("invalid")},hideErrors:function(){this._container.find(".infoError").remove();this._container.find(".invalid").removeClass("invalid")},hideError:function(b){b=b.target;$(b).nextAll(".infoError").remove();
$(b).parent().parent().removeClass("invalid")}}))})(toa);(function(d){var c=d.views.deliveryChannels.BaseView;d.ns("toa.views.deliveryChannels.BaseCollectionView",d.define(c,function(b){c.apply(this,arguments);this.collection=this.options.collection;this.model=this.options.model},{template:"",childRegion:"",childView:{},childSeparator:"",noItemsView:{},render:function(b,d){d||b.empty();this._childViews=[];c.prototype.render.apply(this,arguments);var g=this.getRegionContainer();this._renderCollection(g);this._container=b;return this},getRegionContainer:function(){var b=
this.childRegion;return b?this._container.find(b).first():this._container},_renderCollection:function(b){var c=this.collection.getCount();0==c&&(new this.noItemsView).render(b,!0);this.collection.each(function(d,k){var l=new this.childView({model:d,collection:this.collection});this._subscribeChildView(l);this._childViews.push(l);l.render(b,!0);this.childSeparator&&k!==c-1&&b.append(this.childSeparator)},this)}}))})(toa);(function(d){var c=d.views.deliveryChannels.BaseView;d.ns("toa.views.deliveryChannels.Container",d.define(c,function(){c.apply(this,arguments)},{regions:{leftPanel:".leftPanel",rightPanel:".rightPanel"},template:'<div class="leftPanel"></div><div class="rightPanel jet-css-only"></div>'}))})(toa);(function(d){var c=d.views.deliveryChannels.BaseView;d.ns("toa.views.deliveryChannels.ListItem",d.define(c,function(){c.apply(this,arguments)},{events:{"click .channelsListItem":"selectChannel","keydown .channelsListItem":"selectChannel"},template:'<% var hasError = 101 == errorCode; %><% var statisticsColor = \'\'; %><% if (hasError || scenarios > 0 && !status) { %><% statisticsColor = \'warning\'; %><% } else if (scenarios == 0 && !status) { %><% statisticsColor = \'inactive\'; %><% } %><div class="channelsListItem" tabindex="0" role="button" aria-labelledby="<%- channelsListItemId %>"><div class="channelsListItemPointer"><div class="pointerArrow"></div></div><div id="<%- channelsListItemId %>" class="channelsListItemName"><%- name %></div><div class="channelsListItemStatistics"><div class="scenariosCount <%- statisticsColor %>"><%- scenarios %></div><div class="channelsListItemStatisticsCaption"><div class="scenarios"><%= h(19144) /* Message */ %></div><div class="scenarios"><%= h(19145) /* scenarios */ %></div></div></div><% if (!hasError) { %><div class="channelsListItemStatus <%- status ? \'active\' : \'inactive\' %>"><%- (status ? h(19140/*Active*/) : h(19141/*Inactive*/)) %></div><% } else { %><div class="channelsListItemStatus warning"><%= h(17315/* Credentials are missing */) %></div><% } %></div>',
selectChannel:function(b){if("undefined"!==typeof b.keyCode){if(13!==b.keyCode)return;b.stopPropagation();b.preventDefault()}this.notify("channel:selected",this.model.get("id"))},getData:function(){this.model.set({channelsListItemId:generate_id()});return this.model.toJSON()}}))})(toa);(function(d){var c=d.views.deliveryChannels.BaseView;d.ns("toa.views.deliveryChannels.NoListItems",d.define(c,function(){c.apply(this,arguments)},{template:'<div class="noListItems"><%= h(19146)/* No Delivery Channels */ %></div>'}))})(toa);(function(d){var c=d.views.deliveryChannels.BaseView;d.ns("toa.views.deliveryChannels.ListControls",d.define(c,function(){c.apply(this,arguments)},{events:{"click .channelsListButton.add":"actionAdd","click .channelsListButton.remove":"actionDelete"},template:'<div class="channelsListControls"><button role="button" aria-label="<%=h(13820/*Add*/)%>" class="channelsListButton add">&nbsp;</button><button role="button" aria-label="<%=h(13071/*Remove*/)%>" class="channelsListButton remove">&nbsp;</button><div>',
disableControls:function(){this._$el.find(".channelsListButton").addClass("disabled")},enableControls:function(){this._$el.find(".channelsListButton").removeClass("disabled")},disableControl:function(b){this._$el.find(".channelsListButton."+b).addClass("disabled")},enableControl:function(b){this._$el.find(".channelsListButton."+b).removeClass("disabled")},actionAdd:function(b){$(b.target).hasClass("disabled")||this.notify("channelaction:add",b,this)},actionDelete:function(b){$(b.target).hasClass("disabled")||
this.notify("channelaction:delete",b,this)}}))})(toa);(function(d){var c=d.views.deliveryChannels.BaseCollectionView;d.ns("toa.views.deliveryChannels.ListItems",d.define(c,function(){c.apply(this,arguments);this.selectedView=null},{idFieldName:"id",template:'<div class="channelsListContainerInner"><div id="deliveryChannelsList"></div></div>',childView:d.views.deliveryChannels.ListItem,childRegion:"#deliveryChannelsList",noItemsView:d.views.deliveryChannels.NoListItems,highlightSelected:function(b){this.selectedView=b;$.each(this._childViews,function(b,
c){c._$el.removeClass("selected")});b._$el.addClass("selected")},getChannelId:function(){var b=this.getActiveItem();return b?b.get(this.idFieldName):null},getSelectedIndex:function(){return this.selectedView?this.getViewIndexByModel(this.selectedView.model):-1},getViewIndexByModel:function(b){var c=this,d=-1,k=b.get(this.idFieldName);$.each(this._childViews,function(b,n){if(n.model.get(c.idFieldName)==k)return d=b,!1});return d},getSiblingChildView:function(b){var c=this._childViews.length;if(0==
c)return null;if(!b||0>b)b=0;return(b=b<=c-1?this._childViews[b]:this._childViews[c-1])&&b.model?b.model:null},getActiveItem:function(){var b=null;this.selectedView&&this.selectedView.model&&(b=this.selectedView.model);return b},setActiveItem:function(b,c,d){if(!b)return-1;b=this.getViewIndexByModel(b);-1<b&&this._childViews[b]&&(c?this.highlightSelected(this._childViews[b]):this._childViews[b]._$el.click(),d&&this.scrollToItem(this._childViews[b]));return b},unselectItem:function(){$.each(this._childViews,
function(b,c){c._$el.removeClass("selected")});this.selectedView=null},scrollToItem:function(b){var c=this._container.find(".channelsListContainerInner"),d=c.outerHeight(),k=this.getRegionContainer();d<k.outerHeight()&&(k=k.children(":first").position().top,b=b._$el.position().top-k,b>d/2&&c.scrollTop(b-d/2))},selectFirst:function(){return 0<this._childViews.length?this.setActiveItem(this._childViews[0].model):-1}}))})(toa);(function(d){var c=d.views.deliveryChannels.BaseView;d.ns("toa.views.deliveryChannels.ListPanel",d.define(c,function(){c.apply(this,arguments)},{template:'<div class="channelsListControls"></div><div class="channelsListContainer"></div>',regions:{controls:".channelsListControls",list:".channelsListContainer"}}))})(toa);(function(d){var c=d.views.deliveryChannels.BaseForm;d.ns("toa.views.deliveryChannels.FormSectionsReadonly",d.define(c,function(b){c.apply(this,arguments)},{events:{"click .collapsable":"toggleSectionAction"},toggleSectionAction:function(b){b=this._container.find(".collapsable");this._container.find(".advancedSection").toggleClass("hidden");b.toggleClass("expanded")},template:'<div class="formSectionLeft"><h1 class="formSectionHeader"><%= h(19167)/* Channel general info */ %></h1><div class="sectionContent"><table role="none" class="generalInfo" cellpadding="0" cellspacing="0"><tr><td class="infoMandatory">*</td><td class="infoLabel"><%= h(15353/* Name */) %></td><td class="infoValue"><span class="infoValueReadonly"><%- name %></span></td></tr><tr><td class="infoMandatory"></td><td class="infoLabel"><%= h(15402/* Status */) %></td><td class="infoValue"><span class="infoValueReadonly"><% if (status) { %><% if (muted) { %><%= h(15411/*Muted*/) %><% } else { %><%= h(15403/*Active*/) %><% } %><% } else { %><%= h(15404/*Inactive*/) %><% } %></span></td></tr><tr><td class="infoMandatory"></td><td class="infoLabel"><%= h(15355/*Bulk Size*/) %></td><td class="infoValue"><span class="infoValueReadonly"><%- bulkSize %></span></td></tr></table></div></div><div class="formSectionRight"><h1 class="formSectionHeader"><%= h(19142/*End-point info*/) %></h1><div class="sectionContent"><table role="none" class="generalInfo" cellpadding="0" cellspacing="0"><tr><td class="infoMandatory">*</td><td class="infoLabel"><%= h(15356/*Host / Port*/) %></td><td class="infoValue"><span class="infoValueReadonly"><%- host %></span> : <span class="infoValueReadonly"><%- port %></span></td></tr><% if (url) { %><tr><td class="infoMandatory"></td><td class="infoLabel"><%= h(15357/*URL Path*/) %></td><td class="infoValue"><span class="infoValueReadonly"><%- url %></span></td></tr><% } %><% if (user) { %><tr><td class="infoMandatory"></td><td class="infoLabel"><%= h(15358/*User*/) %></td><td class="infoValue"><span class="infoValueReadonly"><%- user %></span></td></tr><% } %><tr><td class="infoMandatory"></td><td class="infoLabel"><%= h(21551/*Allow basic access authentication*/) %></td><td class="infoValue"><input type="checkbox" disabled="disabled" class="infoValueCheckbox"<%- (allowHttpBasic ? "checked" : "") %>></td></tr><tr class="toa-hidden"><td class="infoMandatory"></td><td class="infoLabel"><%= h(16801/*Disable weak password hash*/) %></td><td class="infoValue"><input type="hidden" disabled="disabled" class="infoValueCheckbox" checke="checked" ></td></tr><tr><td class="infoMandatory"></td><td class="infoLabel"><%= h(15361/*Secure Connection*/) %></td><td class="infoValue"><span class="infoValueReadonly"><% if (isTLSenabled === false) { %><%= h(15348/*Not encrypted*/) %><% } else { %><% var versions = {"DEFAULT": h(15354/*Default*/), "SSL3": "SSL 3", "TLS1_0": "TLS 1.0", "TLS1_1": "TLS 1.1", "TLS1_2": "TLS 1.2"}; %><%- versions[tlsVersion] || \'\' %><% } %></span></td></tr></table></div></div><div class="clear"><div class="formSectionLeft"><h1 class="formSectionHeader collapsable"><div class="sectionArrow"></div><%= h(19143/*Advanced settings*/) %></h1><div class="sectionContent advancedSection hidden"><table role="none" class="generalInfo" cellpadding="0" cellspacing="0"><tr><td class="infoMandatory"></td><td class="infoLabel top"><%= h(15362/*x509 Trust File*/) %></td><td class="infoValue"><textarea class="infoValueTextArea" readonly><%- tlsCaFile %></textarea></td></tr><tr><td class="infoMandatory"></td><td colspan="2"><div class="notice"><%= h(15389/*x509 Trust File description*/) %></div></td></tr><tr><td class="infoMandatory"></td><td class="infoLabel top"><%= h(15363/*x509 CRL File*/) %></td><td class="infoValue"><textarea class="infoValueTextArea" readonly><%- tlsCrlFile %></textarea></td></tr><tr><td class="infoMandatory"></td><td colspan="2"><div class="notice"><%= h(15390/*x509 CRL File description*/) %></div></td></tr><tr><td class="infoMandatory"></td><td class="infoLabel top"><%= h(15364/*Client Certificate*/) %></td><td class="infoValue"><textarea class="infoValueTextArea" readonly><%- tlsCertFile %></textarea></td></tr><tr><td class="infoMandatory"></td><td colspan="2"><div class="notice"><%= h(15391/*Client Certificate description*/) %></div></td></tr><tr><td class="infoMandatory"></td><td class="infoLabel top"><%= h(15365/*Client Private Key*/) %></td><td class="infoValue"><textarea class="infoValueTextArea" readonly><%- tlsKeyFile %></textarea></td></tr><tr><td class="infoMandatory"></td><td colspan="2"><div class="notice"><%= h(15392/*Client Private Key description*/) %></div></td></tr></table></div></div></div>'}))})(toa);(function(d){var c=d.views.deliveryChannels.BaseForm;d.ns("toa.views.deliveryChannels.FormSectionsEmailVoice",d.define(c,function(b){c.apply(this,arguments)},{events:{"change #channelStatus":"changeStatus","focus input.require":"hideErrorMandatory"},validators:[{selector:".require",rules:["mandatory"]}],hideErrorMandatory:function(b){b=b.target;$(b).nextAll(".infoError.errorMandatory").remove();0==$(b).parent().find(".infoError").length&&$(b).parent().parent().removeClass("invalid")},changeStatus:function(b){b=
$(b.target).val();this.model.set({status:b})},template:'<% var selected = \'selected="selected"\'; %><% var passwordMask = \'**************\'; %><div class="formSectionLeft"><h1 class="formSectionHeader"><%= h(19167)/* Channel general info */ %></h1><div class="sectionContent"><table role="none" class="generalInfo" cellpadding="0" cellspacing="0"><tr><td class="infoMandatory"><abbr id="req_channelName" class="ofsc-abbr-mandatory" title="<%= h(22351/*Required*/) %>">*</abbr></td><td class="infoLabel"><label id="label_channelName"><%= h(15353/* Name */) %></label></td><td class="infoValue"><%- name %></td></tr><tr><td class="infoMandatory"></td><td class="infoLabel"><label id="label_status"><%= h(15402/* Status */) %></label></td><td class="infoValue"><select aria-labelledby="label_status" class="infoValueDropdown formField" id="channelStatus" modelField="status"><option <%- status ? selected : \'\' %> value="true"><% if (muted) { %><%= h(15411/*Muted*/) %><% } else { %><%= h(15403/*Active*/) %><% } %></option><option <%- !status ? selected : \'\' %> value="false"><%= h(15404/*Inactive*/) %></option></select></td></tr></table></div></div>'}))})(toa);(function(d){var c=d.views.deliveryChannels.BaseForm;d.ns("toa.views.deliveryChannels.FormSectionsEmailVoiceReadonly",d.define(c,function(b){c.apply(this,arguments)},{template:'<% var selected = \'selected="selected"\'; %><% var passwordMask = \'**************\'; %><div class="formSectionLeft"><h1 class="formSectionHeader"><%= h(19167)/* Channel general info */ %></h1><div class="sectionContent"><table role="none" class="generalInfo" cellpadding="0" cellspacing="0"><tr><td class="infoMandatory"><abbr id="req_channelName" class="ofsc-abbr-mandatory" title="<%= h(22351/*Required*/) %>">*</abbr></td><td class="infoLabel"><label id="label_channelName"><%= h(15353/* Name */) %></label></td><td class="infoValue"><%- name %></td></tr><tr><td class="infoMandatory"></td><td class="infoLabel"><%= h(15402/* Status */) %></td><td class="infoValue"><span class="infoValueReadonly"><% if (status) { %><% if (muted) { %><%= h(15411/*Muted*/) %><% } else { %><%= h(15403/*Active*/) %><% } %><% } else { %><%= h(15404/*Inactive*/) %><% } %></span></td></tr></table></div></div>'}))})(toa);(function(d){var c=d.views.deliveryChannels.BaseForm;d.ns("toa.views.deliveryChannels.FormSections",d.define(c,function(b){c.apply(this,arguments)},{nameRegExp:/[\x00-\x1F]+/,urlRegExp:/(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9])*\.[a-z\u00a1-\uffff]{2,}/g,hostRegExp:/^([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z0-9]{2,6}$/,ipRegExp:/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/gm,
events:{"change #channelName":"changeName","change #channelStatus":"changeStatus","change #channelBulkSize":"changeBulkSize","change #channelHost":"changeHost","change #channelPort":"changePort","change #channelUrl":"changeUrl","change #channelUser":"changeUser","change #channelPassword":"changePassword","change #channelConfirmPassword":"changeConfirmPassword","change #channelConnection":"changeConnection","change #channelTlsCaFile":"changeTlsCaFile","change #channelTlsCrlFile":"changeTlsCrlFile",
"change #channelTlsCertFile":"changeTlsCertFile","change #channelTlsKeyFile":"changeTlsKeyFile","change #channelDisableWeakPasswordHash":"changeDisableWeakPasswordHash","change #channelAllowHttpBasic":"changeAllowHttpBasic","keydown .digitInput":"handleDigitsInput",'keydown input[type="password"]':"passwordChanged","focus input.require":"hideErrorMandatory"},validators:[{selector:".require",rules:["mandatory"]},{selector:"#channelName",rules:["name"]},{selector:"#channelBulkSize",rules:["bulkSize"]},
{selector:"#channelHost",rules:["host"]},{selector:"#channelPort",rules:["port"]},{selector:"#channelUrl",rules:["url"]},{selector:"#channelUser",rules:["user"]},{selector:"#channelPassword",rules:["password"]},{selector:"#channelConfirmPassword",rules:["confirmPassword"]},{selector:"#channelTlsCertFile",rules:["tlsCertFile"]},{selector:"#channelTlsKeyFile",rules:["tlsKeyFile"]}],hideErrorMandatory:function(b){b=b.target;$(b).nextAll(".infoError.errorMandatory").remove();0==$(b).parent().find(".infoError").length&&
$(b).parent().parent().removeClass("invalid")},nameFieldValidate:function(b){b=$(b).val();var c="";if(this.nameRegExp.test(b)||255<b.length)c=h(15353)+" "+h(15461,{"{LABEL}":d.toHtml(b)});return c},bulkSizeFieldValidate:function(b){b=+$(b).val();var c="";if(isNaN(b)||0>=b||1E4<b)c=h(15381);return c},hostFieldValidate:function(b){var c=$.trim($(b).val());b="";var d=""!==c&&this.ipRegExp.test(c),k=""!==c&&this.hostRegExp.test(c),c=254>c.length;d||(b=h(15382),c&&k&&(b=""));return b},portFieldValidate:function(b){b=
$(b).val();var c="";if(""===$.trim(b))return c;b=+b;if(isNaN(b)||0>=b||65535<b)c=h(15383);return c},userFieldValidate:function(b){b=$(b).val();var c=$("#channelPassword").val(),g="";if(""!==b){if(this.nameRegExp.test(b)||119<b.length)g=h(15358)+" "+h(15461,{"{LABEL}":d.toHtml(b)})}else""!==c&&(g=h(19155));return g},passwordFieldValidate:function(b){var c=$("#channelUser").val();b=$(b).val();var d="";if(""!==c)if(""===b)d=h(19156);else if(this.nameRegExp.test(b)||119<b.length)d=h(15461,{"{LABEL}":r(15359)});
return d},confirmPasswordFieldValidate:function(b){var c=$("#channelUser").val(),d=$("#channelPassword").val();b=$(b).val();var k="";""!==c&&""!==d&&(""===b?k=h(19157):this.nameRegExp.test(b)||119<b.length?k=h(15461,{"{LABEL}":r(15360)}):d!==b&&(k=h(15385)));return k},tlsCertFileFieldValidate:function(b){var c=$("#channelTlsKeyFile").val(),d="";""===$(b).val()&&""!==c&&(d=h(19158));return d},tlsKeyFileFieldValidate:function(b){var c=$("#channelTlsCertFile").val();b=$(b).val();var d="";""!==c&&""===
b&&(d=h(19159));return d},changeName:function(b){b=$(b.target).val();this.model.set({name:b})},changeStatus:function(b){b=$(b.target).val();this.model.set({status:b})},changeBulkSize:function(b){b=$(b.target).val();this.model.set({bulkSize:b})},changeHost:function(b){b=$(b.target).val();this.model.set({host:b})},changePort:function(b){b=$(b.target).val();this.model.set({port:b})},changeUrl:function(b){b=$(b.target).val();this.model.set({url:b})},changeUser:function(b){b=$(b.target).val();this.model.set({user:b})},
changePassword:function(b){b=$(b.target).val();this.model.set({password:b})},changeConfirmPassword:function(b){b=$(b.target).val();this.model.set({confirmPassword:b})},changeDisableWeakPasswordHash:function(b){this.model.set({disableWeakPasswordHash:$(b.target).is(":checked")})},changeAllowHttpBasic:function(b){this.model.set({allowHttpBasic:$(b.target).is(":checked")})},changeConnection:function(b){b=$(b.target).val();var c=this._container.find("#advancedSettingsSection");""===b?(this.model.set({isTLSenabled:!1,
tlsVersion:""}),c.addClass("hide")):(this.model.set({isTLSenabled:!0,tlsVersion:b}),c.removeClass("hide"))},changeTlsCaFile:function(b){b=$(b.target).val();this.model.set({tlsCaFile:b})},changeTlsCrlFile:function(b){b=$(b.target).val();this.model.set({tlsCrlFile:b})},changeTlsCertFile:function(b){b=$(b.target).val();this.model.set({tlsCertFile:b})},changeTlsKeyFile:function(b){b=$(b.target).val();this.model.set({tlsKeyFile:b})},handleDigitsInput:function(b){if(-1!==$.inArray(b.keyCode,[46,8,9,27,
13,110])||65==b.keyCode&&!0===b.ctrlKey||35<=b.keyCode&&40>=b.keyCode)return!0;(b.shiftKey||48>b.keyCode||57<b.keyCode)&&(96>b.keyCode||105<b.keyCode)&&b.preventDefault()},passwordChanged:function(b){this._container.find("#passwordChanged").val(1);this.model.set({passwordChanged:1})},template:'<% var selected = \'selected="selected"\'; %><% var passwordMask = \'**************\'; %><div class="formSectionLeft"><h1 class="formSectionHeader"><%= h(19167)/* Channel general info */ %></h1><div class="sectionContent"><table role="none" class="generalInfo" cellpadding="0" cellspacing="0"><tr><td class="infoMandatory"><abbr id="req_channelName" class="ofsc-abbr-mandatory" title="<%= h(22351/*Required*/) %>">*</abbr></td><td class="infoLabel"><label id="label_channelName"><%= h(15353/* Name */) %></label></td><td class="infoValue"><input aria-labelledby="req_channelName label_channelName" required type="text" class="infoValueText formField require" value="<%- name %>" id="channelName" modelField="name" maxlength="255" /></td></tr><tr><td class="infoMandatory"></td><td class="infoLabel"><label id="label_status"><%= h(15402/* Status */) %></label></td><td class="infoValue"><select aria-labelledby="label_status" class="infoValueDropdown formField" id="channelStatus" modelField="status"><option <%- status ? selected : \'\' %> value="true"><% if (muted) { %><%= h(15411/*Muted*/) %><% } else { %><%= h(15403/*Active*/) %><% } %></option><option <%- !status ? selected : \'\' %> value="false"><%= h(15404/*Inactive*/) %></option></select></td></tr><tr><td class="infoMandatory"></td><td class="infoLabel"><label id="label_channelBulkSize"><%= h(15355/*Bulk Size*/) %></label></td><td class="infoValue"><input aria-labelledby="label_channelBulkSize" aria-describedby="desc_channelBulkSize" type="text" class="infoValueText formField digitInput small50" value="<%- bulkSize %>" id="channelBulkSize" modelField="bulkSize" maxlength="5" /></td></tr><tr><td class="infoMandatory"></td><td colspan="2"><div id="desc_channelBulkSize" class="notice"><%= h(15388/*bulk size description*/) %></div></td></tr></table></div></div><div class="formSectionRight"><h1 class="formSectionHeader"><%= h(19142/*End-point info*/) %></h1><div class="sectionContent"><table role="none" class="generalInfo" cellpadding="0" cellspacing="0"><tr><td class="infoMandatory"><abbr id="req_channelHostPort" class="ofsc-abbr-mandatory" title="<%= h(22351/*Required*/) %>">*</abbr></td><td class="infoLabel"><label id="label_channelHostPort"><%= h(15356/*Host / Port*/) %></label></td><td class="infoValue"><input aria-labelledby="req_channelHostPort label_channelHostPort" required aria-describedby="<%= h(21108)/*Host*/ %>" type="text" class="infoValueText formField require" value="<%- host %>" id="channelHost" modelField="host" /> : <input aria-labelledby="req_channelHostPort label_channelHostPort" required aria-describedby="<%= h(21109)/*Port*/ %>" type="text" class="infoValueText formField digitInput small50 require" value="<%- port %>" id="channelPort" modelField="port" maxlength="5" /></td></tr><tr><td class="infoMandatory"></td><td class="infoLabel"><label id="label_channelUrl"><%= h(15357/*URL Path*/) %></label></td><td class="infoValue"><input type="text" aria-labelledby="label_channelUrl" class="infoValueText formField" value="<%- url %>" id="channelUrl" modelField="url" /></td></tr><tr><td class="infoMandatory"></td><td class="infoLabel"><label id="label_channelUser"><%= h(15358/*User*/) %></label></td><td class="infoValue"><input autocomplete="false" aria-labelledby="label_channelUser" type="text" class="infoValueText formField" value="<%- user %>" id="channelUser" modelField="user" maxlength="255" /></td></tr><tr><td class="infoMandatory"></td><td class="infoLabel"><label id="label_channelPassword"><%= h(15359/*Password*/) %></label></td><td class="infoValue"><input type="text" class="hide" /><input type="password" class="hide" /><input autocomplete="false" aria-labelledby="label_channelPassword" type="password" class="infoValueText formField" value="<%- user !== \'\' ? passwordMask : \'\' %>" id="channelPassword" modelField="password" maxlength="255" /></td></tr><tr><td class="infoMandatory"></td><td class="infoLabel"><label id="label_confirmChannelPassword"><%= h(15360/*Confirm Password*/) %></label></td><td class="infoValue"><input type="password" aria-labelledby="label_confirmChannelPassword" class="infoValueText formField" value="<%- user !== \'\' ? passwordMask : \'\' %>" id="channelConfirmPassword" modelField="confirmPassword" maxlength="255" /><input type="hidden" class="formField" value="0" id="passwordChanged" modelField="passwordChanged" /></td></tr><tr><td class="infoMandatory"></td><td class="infoLabel"><label id="label_channelAllowHttpBasic"><%= h(21551/*Allow basic access authentication*/) %></label></td><td class="infoValue"><input type="checkbox" aria-labelledby="label_channelAllowHttpBasic" class="infoValueCheckbox formField" id="channelAllowHttpBasic" modelField="allowHttpBasic" <%- (allowHttpBasic ? "checked" : "") %>></td></tr><tr class="toa-hidden"><td class="infoMandatory"></td><td class="infoLabel"><label id="label_channelDisableWeakPasswordHash"><%= h(16801/*Disable weak password hash*/) %></label></td><td class="infoValue"><input type="hidden" aria-labelledby="label_channelDisableWeakPasswordHash" class="infoValueCheckbox formField" id="channelDisableWeakPasswordHash" modelField="disableWeakPasswordHash" checked="checked"></td></tr><tr><td class="infoMandatory"></td><td class="infoLabel"><label id="label_channelConnection"><%= h(15361/*Secure Connection*/) %></label></td><td class="infoValue"><% var versions = {"DEFAULT": h(15354/*Default*/), "SSL3": "SSL 3", "TLS1_0": "TLS 1.0", "TLS1_1": "TLS 1.1", "TLS1_2": "TLS 1.2"}; %><select aria-labelledby="label_channelConnection" class="infoValueDropdown formField" id="channelConnection" modelField="connection"><option value="" <%- isTLSenabled === false ? selected : \'\' %>><%= h(15348/*Not encrypted*/) %></option><% for (var key in versions) { %><option value="<%- key %>"<%- isTLSenabled == true && tlsVersion == key ? selected : \'\' %>><%- versions[key] %></option><% } %></select></td></tr></table></div></div><div id="advancedSettingsSection" class="clear<%- isTLSenabled === false ? \' hide\' : \'\' %>"><div class="formSectionLeft autoWidth"><h1 class="formSectionHeader"><div class="sectionArrow"></div><%= h(19143/*Advanced settings*/) %></h1><div class="sectionContent advancedSection"><table role="none" class="generalInfo" cellpadding="0" cellspacing="0"><tr><td class="infoMandatory"></td><td class="top"><div class="infoLabel"><label id="label_channelTlsCaFile"><%= h(15362/*x509 Trust File*/) %></label><div id="desc_channelTlsCaFile" class="notice"><%= h(15389/*x509 Trust File description*/) %></div></div><div class="infoValue"><textarea aria-labelledby="label_channelTlsCaFile" aria-describedby="desc_channelTlsCaFile" class="infoValueTextArea formField" id="channelTlsCaFile" modelField="tlsCaFile"><%- tlsCaFile %></textarea></div></td></tr><tr><td class="infoMandatory"></td><td class="top"><div class="infoLabel"><label id="label_channelTlsCrlFile"><%= h(15363/*x509 CRL File*/) %></label><div id="desc_channelTlsCrlFile" class="notice"><%= h(15390/*x509 CRL File description*/) %></div></div><div class="infoValue"><textarea aria-labelledby="label_channelTlsCrlFile" aria-describedby="desc_channelTlsCrlFile" class="infoValueTextArea formField" id="channelTlsCrlFile" modelField="tlsCrlFile"><%- tlsCrlFile %></textarea></div></td></tr><tr><td class="infoMandatory"></td><td class="top"><div class="infoLabel"><label id="label_channelTlsCertFile"><%= h(15364/*Client Certificate*/) %></label><div id="desc_channelTlsCertFile" class="notice"><%= h(15391/*Client Certificate description*/) %></div></div><div class="infoValue"><textarea aria-labelledby="label_channelTlsCertFile" aria-describedby="desc_channelTlsCertFile" class="infoValueTextArea formField" id="channelTlsCertFile" modelField="tlsCertFile"><%- tlsCertFile %></textarea></div></td></tr><tr><td class="infoMandatory"></td><td class="top"><div class="infoLabel"><label id="label_channelTlsKeyFile"><%= h(15365/*Client Private Key*/) %></label><div id="desc_channelTlsKeyFile" class="notice"><%= h(15392/*Client Private Key description*/) %></div></div><div class="infoValue"><textarea aria-labelledby="label_channelTlsKeyFile" aria-describedby="desc_channelTlsKeyFile" class="infoValueTextArea formField" id="channelTlsKeyFile" modelField="tlsKeyFile"><%- tlsKeyFile %></textarea></div></td></tr><tr><td class="infoMandatory"></td><td class="top"><div class="infoLabel"><div class="comments"><%= h(15393/*comments*/) %></div></div></td></tr></table></div></div></div>'}))})(toa);(function(d){var c=d.views.deliveryChannels.BaseView;d.ns("toa.views.deliveryChannels.FormButtons",d.define(c,function(){c.apply(this,arguments)},{events:{"click .btnSaveForm":"onClickSave"},template:'<table class="footerTable"><tr><td><div class="leftSideBar"></div></td><td width="100%"><div class="info"></div></td><td><div class="formButtons"><button type="submit" class="toa-button toa-button-active pullRight btnSaveForm"><%= h(12) /*Save*/ %></button></div></td></tr></table>',showNotification:function(b){if(!this._container)return!1;
this._container.find(".info").text(b)},clearNotification:function(){this.showNotification("")},setBtnDisabled:function(b,c){if(!this._container)return!1;this._container.find(".btn"+b+"Form").toggleClass("toa-button-disable",c)},setBtnVisible:function(b,c){if(!this._container)return!1;this._container.find(".btn"+b+"Form").toggleClass("hide",!c)},onClickSave:function(b){if($(b.target).hasClass("toa-button-disable"))return!1;this.notify("save:clicked",this)}}))})(toa);(function(d){var c=d.views.deliveryChannels.BaseView;d.ns("toa.views.deliveryChannels.FormPanel",d.define(c,function(){c.apply(this,arguments)},{regions:{sections:".formSections",statusBar:".statusBar"},template:'<div class="formContainer"><div class="formContainerInner"><div class="formContent"><div class="formSections"></div><div class="statusBar"></div></div></div></div>'}))})(toa);(function(d,c){d.ns("toa.deliveryChannels.ServerConnector",d.define(null,function(b,c){this._triggerFunction=b;this._controller=c},{_triggerFunction:function(){},_controller:"",request:function(b,d){var g=c.Deferred();this._triggerFunction("global.data.get",{controller:this._controller,method:b,params:d||{},responseHandler:function(b,c){c.status&&"OK"===c.status?g.resolve(c):g.reject(c.error_code||0)}.bind(this)});return g.promise()}}))})(toa,$);(function(d,c){d.ns("toa.deliveryChannels.DataMapper",d.define(null,function(b){this._serverConnector=b},{_modelConstructor:function(){},_serverGetMethod:"",_serverSaveMethod:"",_serverRemoveMethod:"",_serverGetField:"",_serverIdField:"",load:function(b,d){d=d||{};this._serverIdField&&(d[this._serverIdField]=b.id);var g=c.Deferred(),k=this._serverConnector.request(this._serverGetMethod,d);k.done(function(c){c&&c[this._serverGetField]||g.reject('Field "'+this._serverGetField+'" is not available');
try{this._fillModel(b,c[this._serverGetField]),g.resolve(b)}catch(d){g.reject("Unable to fill model with given data ("+d.message+")")}}.bind(this));k.fail(function(b){g.reject(b,"Server error ("+b+") has occurred")});return g.promise()},create:function(b){var c=new this._modelConstructor;this._fillModel(c,b||{});return c},save:function(b){return this._serverConnector.request(this._serverSaveMethod,this.serialize(b))},remove:function(b){var c={};this._serverIdField&&(c[this._serverIdField]=b.id);return this._serverConnector.request(this._serverRemoveMethod,
c)},_fillModel:function(b,c){b.reset({},{silent:!0});b.set(c,{silent:!0})},serialize:function(b){return b.toJSON()}}))})(toa,$);(function(d,c){var b=d.deliveryChannels.DataMapper;d.ns("toa.deliveryChannels.CollectionDataMapper",d.define(b,function(c,d){b.apply(this,arguments);this._itemMapper=d},{_modelConstructor:d.models.deliveryChannels.BaseCollection,create:function(b){var c=new this._modelConstructor;this._comparator&&"function"===typeof this._comparator&&(c.comparator=this._comparator);this._fillModel(c,b||{});return c},_fillModel:function(b,d){b.clear({silent:!0});c.each(d,function(c,d){var g=this._itemMapper.create(d);
b.add(g,{silent:!0})}.bind(this))},serialize:function(b){var c=[];b.each(function(b){c.push(this._itemMapper.serialize(b))},this);return c}}))})(toa,$);(function(d){var c=d.deliveryChannels.DataMapper;d.ns("toa.deliveryChannels.dataMappers.BaseDataMapper",d.define(c,function(b){c.apply(this,arguments)},{_modelConstructor:d.models.deliveryChannels.BaseModel}))})(toa);(function(d){var c=d.deliveryChannels.CollectionDataMapper;d.ns("toa.deliveryChannels.dataMappers.BaseCollectionDataMapper",d.define(c,function(b,d){c.apply(this,arguments);this._itemMapper=d},{_modelConstructor:d.models.deliveryChannels.BaseCollection}))})(toa);(function(d){var c=d.deliveryChannels.DataMapper;d.ns("toa.deliveryChannels.dataMappers.ListItemDataMapper",d.define(c,function(b){c.apply(this,arguments)},{_modelConstructor:d.models.deliveryChannels.DeliveryChannel,_serverRemoveMethod:"delete",_serverIdField:"id"}))})(toa);(function(d,c){var b=d.deliveryChannels.CollectionDataMapper;d.ns("toa.deliveryChannels.dataMappers.ListDataMapper",d.define(b,function(c,d){b.apply(this,arguments)},{_modelConstructor:d.models.deliveryChannels.SortableCollection,_serverGetMethod:"getList",_serverGetField:"delivery_channels"}))})(toa,$);(function(d,c){var b=d.deliveryChannels.DataMapper;d.ns("toa.deliveryChannels.dataMappers.FormDataMapper",d.define(b,function(c){b.apply(this,arguments)},{_modelConstructor:d.models.deliveryChannels.BaseModel,_serverGetMethod:"getItem",_serverSaveMethod:"modify",_serverGetField:"delivery_channel",_serverIdField:"id",save:function(c){this._serverSaveMethod=c.get("id")?"modify":"create";return b.prototype.save.apply(this,arguments)},emptyModel:function(b){this._fillModel(b,{})},_fillModel:function(b,
g){b.reset({},{silent:!0});var k={id:g.id||"",name:g.name||"",method:g.method||"",bulkSize:g.bulkSize||10,status:g.status||!1,host:"",port:"",url:"",user:"",password:"",confirmPassword:"",passwordChanged:"",disableWeakPasswordHash:!1!==g.disableWeakPasswordHash?!0:!1,allowHttpBasic:!1!==g.allowHttpBasic?!0:!1,isTLSenabled:!1,tlsVersion:"",tlsCaFile:"",tlsCrlFile:"",tlsCertFile:"",tlsKeyFile:"",muted:!d.app.model("companySettings").settings.outbound_configuration_status},l={},n={};g.connection&&(l=
{host:g.connection.host,port:g.connection.port,url:g.connection.url,user:g.connection.user},g.connection.tls&&(n={isTLSenabled:g.connection.tls.isTLSenabled,tlsVersion:g.connection.tls.version,tlsCaFile:g.connection.tls.caFile,tlsCrlFile:g.connection.tls.crlFile,tlsCertFile:g.connection.tls.certFile,tlsKeyFile:g.connection.tls.keyFile}));k=c.extend(k,l,n);b.set(k,{silent:!0})},serialize:function(b){var c=b.get("isTLSenabled");return{delivery_channel:{id:b.get("id"),status:b.get("status"),name:b.get("name"),
method:b.get("method"),bulkSize:b.get("bulkSize"),disableWeakPasswordHash:b.get("disableWeakPasswordHash"),allowHttpBasic:b.get("allowHttpBasic"),connection:{host:b.get("host"),port:b.get("port"),url:b.get("url"),user:b.get("user"),password:b.get("password"),confirmPassword:b.get("confirmPassword"),passwordChanged:b.get("passwordChanged"),tls:{isTLSenabled:c,version:c?b.get("tlsVersion"):"",caFile:c?b.get("tlsCaFile"):"",crlFile:c?b.get("tlsCrlFile"):"",certFile:c?b.get("tlsCertFile"):"",keyFile:c?
b.get("tlsKeyFile"):""}}}}}}))})(toa,$);(function(d){var c=d.deliveryChannels.DataMapper;d.ns("toa.deliveryChannels.dataMappers.InitialDataMapper",d.define(c,function(b){c.apply(this,arguments)},{_modelConstructor:d.models.deliveryChannels.BaseModel,_serverGetMethod:"getInitialData",_serverGetField:"initial_data"}))})(toa);(function(d){d.ns("toa.controllers.DeliveryChannels",d.define(d.Controller,function(c){this.sandbox=c;this.pageLabel=this.sandbox.name;this.content=c.options.content;this.triggerFunction=c.trigger.bind(c);this.setDefaultState();this.resume()},{toString:function(){return"DeliveryChannels config screen controller"},createPanelTitle:function(){this.panel=d.view.control.create({xtype:"PanelTitleAlta",addClass:"jet-css-only toa-panel-title jet-screen-title panel-title-deliverychannel-settings",name:"titleCaption",
titleText:h(15405),resourceTreeButton:!1,backButton:!0,backButtonIcon:"",headerResponsive:_DATA.page_label,backButtonLabel:_DATA.glossary.action_links.company_settings_triggers,backButtonHint:h(16257),filter:!1,calendar:!1,listeners:{backButtonClick:function(){d.app.trigger("layout.menu.click",{label:"company_settings_triggers",url:"",name:_DATA.glossary.action_links.company_settings_triggers,params:{}})}}});this.panel.render(this.content)},resume:function(){this.setState("formChanged",!1);this.setState("newChannel",
!1);this.triggerFunction("layout.tabs.set",{tabs:0,show:0});this.createPanelTitle();this.initModels();this.initViews();this.showInitialViews();this.initialDataMapper.load(this.initialModel).done(this.setInitial.bind(this)).fail(function(c,b){this.sandbox.error(b);this.showError(h(15367))}.bind(this))},setInitial:function(c){this.setState("allowModify",c.get("allow_modify"));this.channelsListMapper.load(this.channelsListCollection).done(this.showPanelContent.bind(this)).fail(function(b,c){var d=h(19139);
7==b?d=h(15401):this.sandbox.error(c);this.showError(d)}.bind(this))},initModels:function(){var c=new d.deliveryChannels.ServerConnector(this.triggerFunction,"deliverychannel"),b=new d.deliveryChannels.dataMappers.BaseDataMapper(c);new d.deliveryChannels.dataMappers.BaseCollectionDataMapper(c,b);this.channelsListItemMapper=new d.deliveryChannels.dataMappers.ListItemDataMapper(c);this.channelsListMapper=new d.deliveryChannels.dataMappers.ListDataMapper(c,this.channelsListItemMapper);this.channelsListCollection=
this.channelsListMapper.create();this.initialDataMapper=new d.deliveryChannels.dataMappers.InitialDataMapper(c);this.initialModel=this.initialDataMapper.create();this.getState("currentItemModel")||this.setState("currentItemModel",this.channelsListItemMapper.create());this.formMapper=new d.deliveryChannels.dataMappers.FormDataMapper(c);this.formModel=this.formMapper.create();c=function(){this.setState("formChanged",!0);this.formButtonsView.clearNotification()}.bind(this);this.formModel.addListener("all",
c)},initViews:function(){this.containerView=new d.views.deliveryChannels.Container;this.listPanelView=new d.views.deliveryChannels.ListPanel;this.listControlsView=new d.views.deliveryChannels.ListControls;this.listView=new d.views.deliveryChannels.ListItems({collection:this.channelsListCollection});this.formPanelView=new d.views.deliveryChannels.FormPanel;this.formSectionsView=new d.views.deliveryChannels.FormSections({model:this.formModel});this.formSectionsEmalVoiceView=new d.views.deliveryChannels.FormSectionsEmailVoice({model:this.formModel});
this.formSectionsEmalVoiceROView=new d.views.deliveryChannels.FormSectionsEmailVoiceReadonly({model:this.formModel});this.formSectionsROView=new d.views.deliveryChannels.FormSectionsReadonly({model:this.formModel});this.formButtonsView=new d.views.deliveryChannels.FormButtons;this.listView.addListener("channel:selected",this.onChannelSelected.bind(this));this.listControlsView.addListener("channelaction:add",this.onDeliveryChannelAdd,this);this.listControlsView.addListener("channelaction:delete",this.onDeliveryChannelDelete,
this);this.formButtonsView.addListener("save:clicked",this.onClickSave.bind(this))},showInitialViews:function(){this.screen=$('<div id="toa-deliverychannels-screen"></div>');this.content.append(this.screen);this.containerView.render(this.screen)},showPanelContent:function(c){var b=-1;this.containerView.showRegion("rightPanel",this.formPanelView);this.containerView.showRegion("leftPanel",this.listPanelView);this.listPanelView.showRegion("controls",this.listControlsView);this.listPanelView.showRegion("list",
this.listView);var d=this.channelsListCollection.getCount();this.getState("allowModify")?0===d&&this.listControlsView.disableControl("remove"):this.listControlsView.disableControls();c&&(b=this.listView.setActiveItem(c,!1,!0));0>b&&this.listView.selectFirst()},onClickSave:function(){if(!this.validateForm())return!1;this.saveForm().done(this.showFormSections.bind(this))},isEmailVoiceChannel:function(){return"email"==this.formModel.get("method")||"voice"==this.formModel.get("method")},validateForm:function(){var c=
this.isEmailVoiceChannel()?this.formSectionsEmalVoiceView:this.formSectionsView;return c.validate&&!c.validate()?!1:!0},saveForm:function(){var c=$.Deferred(),b=this.formSectionsView;this.formButtonsView.setBtnDisabled("Save",!0);this.formMapper.save(this.formModel).done(function(d){this.getState("newChannel")&&(d=d.delivery_channel,this.getState("currentItemModel").reset({id:d}));b.notify("action:save",b);this.setState("formChanged",!1);this.afterChangeDeliveryChannel(!0).done(function(){c.resolve(b,
!0)}).fail(function(d){c.reject(b,!1)})}.bind(this)).fail(function(d){var g=19149;switch(d){case 3:g=15369;break;case 5:g=15370;break;case 6:g=15371;break;default:this.sandbox.error(d)}this.showError(h(g));this.formButtonsView.setBtnDisabled("Save",!1);c.reject(b,!1)}.bind(this));return c.promise()},onChannelSelected:function(c,b,d){var g=b.model;if(this.getState("formChanged"))return this.showChangeConfirmation().done(function(b){if("save"===b){if(!this.validateForm())return!1;this.saveForm().done(function(b){this.displayDeliveryChannel(g,
b)}.bind(this))}else"discard"===b&&(this.setState("formChanged",!1),this.displayDeliveryChannel(g))}.bind(this)),!1;this.formButtonsView.clearNotification();this.displayDeliveryChannel(g)},displayDeliveryChannel:function(c,b){this.getState("currentItemModel").reset(c.toJSON());this.listView.setActiveItem(c,!0);this.getState("allowModify")&&this.listControlsView.enableControl("remove");this.showFormSections(b)},displayEmptyForm:function(){this.listView.unselectItem();this.listControlsView.disableControl("remove");
this.setState("newChannel",!0);this.formMapper.emptyModel(this.formModel);this.getState("currentItemModel").reset({});this.formPanelView.showRegion("sections",this.formSectionsView);this.formPanelView.showRegion("statusBar",this.formButtonsView);this.formButtonsView.setBtnDisabled("Save",!1)},showChangeConfirmation:function(){var c=h(14603),b=h(19153),d=[{text:h(14621),position:"left",click:function(b){b.reject()}},{text:h(13242),position:"right",tpl:'<button class="popup-button toa-button">Ok</button>',
click:function(b){b.resolve("discard")}},{text:h(13246),position:"right",type:"submit",click:function(b){b.resolve("save")}}];return this.showPopup(c,b,d)},getCurrentChannelId:function(){return this.getState("currentItemModel").getId()},showFormSections:function(c){var b=this.formModel;b.set({id:this.getCurrentChannelId()},{silent:!0});return this.formMapper.load(b).done(function(){if(this.getState("allowModify")){var b=this.isEmailVoiceChannel()?this.formSectionsEmalVoiceView:this.formSectionsView;
this.formPanelView.showRegion("sections",b);this.formPanelView.showRegion("statusBar",this.formButtonsView);this.formButtonsView.setBtnDisabled("Save",!1);c&&this.formButtonsView.showNotification(this.getState("newChannel")?h(19161):h(19160));this.getState("newChannel")&&this.setState("newChannel",!1)}else b=this.isEmailVoiceChannel()?this.formSectionsEmalVoiceROView:this.formSectionsROView,this.formPanelView.showRegion("sections",b),this.formPanelView.showRegion("statusBar",this.formButtonsView),
this.formButtonsView.setBtnVisible("Save",!1),this.formButtonsView.setBtnDisabled("Save",!0)}.bind(this)).fail(function(b,c){this.sandbox.error(c);this.showError(h(19147))}.bind(this))},refreshChannelList:function(){var c=this.channelsListCollection.getCount(),b=this.listView;if(0===c)return this.listControlsView.disableControl("remove"),this.listPanelView.showRegion("list",b),this.containerView.showRegion("rightPanel",this.formPanelView),!1;this.getState("allowModify")&&this.listControlsView.enableControl("remove");
c=b.getActiveItem();!c&&this.getCurrentChannelId()&&(c=d.create("toa.models.deliveryChannels.DeliveryChannel",{id:this.getCurrentChannelId()}));var e=b.getViewIndexByModel(c);this.listPanelView.showRegion("list",b);0>b.setActiveItem(c,!0,!0)&&(c=b.getSiblingChildView(e),b.setActiveItem(c,!1,!0))},onDeliveryChannelAdd:function(c,b){if(this.getState("formChanged"))return this.showChangeConfirmation().done(function(b){if("save"===b){if(!this.validateForm())return!1;this.saveForm().done(function(b){this.displayEmptyForm()}.bind(this))}else"discard"===
b&&(this.setState("formChanged",!1),this.displayEmptyForm())}.bind(this)),!1;this.formButtonsView.clearNotification();this.displayEmptyForm()},onDeliveryChannelDelete:function(c,b){var e=this.channelsListCollection.find("id",this.getCurrentChannelId());if(e&&e.isRemovable())var g=new d.ui.Popup({title:h(13294),autoOpen:!0,html:h(19150),modal:!0,buttons:[{text:h(14621),position:"left",click:function(){g.destroy()}},{text:h(12252),type:"submit",position:"right",click:function(b){this.channelsListItemMapper.remove(e).done(this.afterChangeDeliveryChannel.bind(this)).fail(function(b){var c=
19151;4===b?c=15374:this.sandbox.error(b);this.showError(h(c)).always(this.refreshChannelList.bind(this))}.bind(this));g.destroy()}.bind(this)}]})},afterChangeDeliveryChannel:function(c){c=[this.channelsListMapper.load(this.channelsListCollection)];return $.when.apply($,c).done(this.refreshChannelList.bind(this)).fail(function(b,c){this.sandbox.error(c);this.showError(h(19147))}.bind(this))},suspend:function(c){this.destroy()},destroy:function(){this.screen.empty()},setState:function(c,b){d.isString(c)?
this.state[c]=b:d.isObject(c)?$.extend(this.state,c):!1===c&&this.setDefaultState()},getState:function(c){return this.state[c]},setDefaultState:function(){this.state=$.extend(this.state,{currentItemModel:null,newChannel:!1,formChanged:!1,allowModify:!1})},showError:function(c,b){c=c||h(3057);b=b||h(5651);return this.showPopup(b,c)},showPopup:function(c,b,e){c=c||"";b=b||"";var g=$.Deferred();e&&$.isArray(e)&&e.length?$.each(e,function(b,c){if("function"===typeof c.click){var d=c.click;c.click=function(){var b=
Array.prototype.slice.call(arguments);b.unshift(g);d.apply(this,b)}}}.bind(this)):e=[{text:h(445),position:"right",tpl:'<button class="popup-button toa-button"></button>',click:function(){g.reject()}}];g.always(function(){k.destroy()});var k=new d.ui.Popup({title:c,autoOpen:!0,html:b,modal:!0,onClose:function(){k.destroy();g.reject()},buttons:e});k._dom.base.id="toa-deliverychannels-popup";return g}}))})(toa);(function(d){var c=d.models.ObservableModel;d.ns("toa.CompanySettings.ActivityTypes.BasePopupModel",d.define(c,function(){c.apply(this,arguments)},{idField:"id",saveFields:["label","name"],setLookups:function(b){this.set({lookups:b})},getLookups:function(){return this.get("lookups",[])},getLookup:function(b){return this.getLookups()[b]||null},setData:function(b){if(!b||$.isEmptyObject(b))this.setDefault();else{var c=this.getDefaultData();$.isArray(b.name)&&(b.name={});$.extend(c,b);this.set(c)}},
setDefault:function(){this.set(this.getDefaultData())},getDefaultData:function(){return{label:"",name:{}}},getNames:function(){return this.get("name",{})},getName:function(b){return this.getNames()[b]||""},setName:function(b,c){var d=this.getNames();d[b]=c;this.set({name:d})},getLabel:function(){return this.get("label","")},spliceData:function(b){b=b||[];var c={},d=this.getDefaultData();$.each(b,function(b,l){c[l]=this.get(l,d[l]||"")}.bind(this));return c},getPreparedData:function(){return this.spliceData(this.saveFields)}}))})(toa);(function(d){d.ns("toa.CompanySettings.ActivityTypes.BasePopupController",d.define(d.Controller,function(c){this.readOnlyMode=c.readOnly||!1;this.resume()},{_itemModelClass:d.CompanySettings.ActivityTypes.BasePopupModel,_popupContainerViewClass:d.views.BaseView,_serverController:"activitytypes",_serverGetMethod:"get",_serverSetMethod:"set",_loadParams:{},_saveParams:{},_popupWidth:100,_itemDataField:"item",itemId:null,readOnlyMode:!1,errors:[],toString:function(){return"Popup controller"},isNewItem:function(){return null===
this.itemId},isReadOnly:function(){return this.readOnlyMode||!1},getItemId:function(){return this.itemId},resume:function(){this.initModels();this.initViews();this.loadData()},initModels:function(){this.itemModel=new this._itemModelClass},initViews:function(){this.popupContainerView=new this._popupContainerViewClass({model:this.itemModel});this.isReadOnly()&&this.popupContainerView.setReadOnlyMode(!0);this.popupContainerView.addListener("center_popup",this.recenterPopup.bind(this))},loadData:function(){d.app.trigger("global.data.get",
{controller:this._serverController,method:this._serverGetMethod,params:this._loadParams,responseHandler:this.onLoadDataResponse.bind(this),errorHandler:this.onLoadDataError.bind(this)})},onLoadDataResponse:function(c,b){b&&b.status&&"OK"===b.status&&b[this._itemDataField]&&b.initialData&&b.initialData.lookups?(this.itemModel.setLookups(b.initialData.lookups),this.itemModel.setData(b[this._itemDataField]),this.initPopup()):this.showError(this._loadFailErrorText||null)},onLoadDataError:function(){this.showInternalError()},
initPopup:function(){this.popup=new d.ui.Popup({title:this.getPopupTitle(),autoOpen:!0,view:this.popupContainerView,modal:!0,width:this._popupWidth,onClose:this.closePopup.bind(this),buttons:this.getPopupButtons()});this.hackOverlay();this.recenterPopup()},hackOverlay:function(){var c=this.popup._dom,b=parseInt($(c.base).css("z-index"),10)-10;$(c.overlay).css({"z-index":b});$(c.base).css({"z-index":++b});$(c.contentMarginTop).height(0)},getPopupButtons:function(){var c=[];this.isReadOnly()?c.push({text:h(436),
type:"submit",position:"right",id:"closeButton",click:this.closePopup.bind(this)}):(c.push({text:h(22),position:"left",id:"cancelButton",click:this.closePopup.bind(this)}),c.push({text:this.getSubmitButtonText(),type:"submit",position:"right",id:"saveButton",click:this.saveItem.bind(this)}));return c},getSubmitButtonText:function(){var c=h(405);this.isNewItem()&&(c=h(222));return c},getPopupTitle:function(){return""},closePopup:function(){this.popup.destroy()},saveItem:function(){this.popup.disableButton("saveButton");
this.validateItem();this.errors.length?(this.showPopupErrors(),this.popup.enableButton("saveButton")):this.processSaveItem()},processSaveItem:function(){d.app.trigger("global.data.get",{controller:this._serverController,method:this._serverSetMethod,params:this._saveParams,responseHandler:this.onSaveItemSuccess.bind(this),errorHandler:this.onSaveItemError.bind(this)})},onSaveItemSuccess:function(c,b){this.popup.enableButton("saveButton");this.popup.removeErrors();if("OK"===b.status)this.closePopup(),
this.refreshList();else if("ERR_VALIDATION"===b.status){var d=b.error_code||[];d.length&&(this.errors=[],$.each(d,function(b,c){this.errors.push({errorText:c})}.bind(this)),this.showPopupErrors())}else this.showError(this._saveFailErrorText||null)},onSaveItemError:function(c){this.popup.enableButton("saveButton");isError(c)||this.showInternalError()},validateItem:function(){this.errors=[]},showPopupErrors:function(){var c=$(this.popup._dom.errors);c.empty().hide();$.each(this.errors,function(b,d){c.append(d.errorText+
"<br />")}.bind(this));c.show();this.recenterPopup()},recenterPopup:function(){this.popup.setPositionCenter()},suspend:function(c){this.destroy()},destroy:function(){this.screen.empty()},setState:function(c,b){d.isString(c)?this.state[c]=b:d.isObject(c)?$.extend(this.state,c):!1===c&&this.setDefaultState()},getState:function(c){return this.state[c]},setDefaultState:function(){this.state=$.extend(this.state,{allowModify:!1})},refreshList:function(){request({url:"?cmd=company_settings&sub=activity_types_list",
data:{}})},showInternalError:function(){this.showError(h(15367))},showError:function(c,b){c=c||h(3057);b=b||h(5651);return this.showPopup(b,c,!1)},showPopup:function(c,b,e){c=c||"";b=b||"";var g=$.Deferred(),k=[{text:h(445),position:"right",type:"submit",click:function(){g.reject()}}];e&&$.isArray(e)&&e.length&&($.each(e,function(b,c){if("function"===typeof c.click){var d=c.click;c.click=function(){var b=Array.prototype.slice.call(arguments);b.unshift(g);d.apply(this,b)}}}.bind(this)),k=e);g.always(function(){l.destroy()});
var l=new d.ui.Popup({title:c,autoOpen:!0,html:b,modal:!0,onClose:function(){l.destroy();g.reject()},buttons:k});l._dom.base.id="toa-activitytypes-popup";return g}}))})(toa);(function(d){var c=d.CompanySettings.ActivityTypes.BasePopupModel;d.ns("toa.CompanySettings.ActivityTypes.ActivityTypeGroupPopup.Model",d.define(c,function(){c.apply(this,arguments)},{idField:"groupId",getDefaultData:function(){return{label:"",isInternal:!1,name:{}}}}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.ActivityTypes.ActivityTypeGroupPopup.ContainerView",d.define(c,function(){c.apply(this,arguments)},{events:{"change #groupLabel":"onChangeLabel","change .groupName":"onChangeName"},onChangeLabel:function(b){b=$(b.currentTarget).val();this.model.set({label:b})},onChangeName:function(b){var c=$(b.currentTarget);b=c.val();c=c.data("langid");this.model.setName(c,b)},template:'<% var inactive = function(condition) { %><% return condition ? \' disabled="disabled"\' : \'\'; %><% }; %><div class="jet-css-only-popup"><div class="jet-css-only-iframe company-settings-set-activity-type" id="activityTypeContainer" style="padding: 0px"><table role="none" class="pwc form" cellpadding="2" cellspacing="0" border="0" width="100%"><tr><td style="padding-top: 6px;" colspan="4"></td></tr><tr class="bct"><td width="1"><abbr id="abbr_activity_type_label" class="ofsc-abbr-mandatory" title="<%= h(22351/*required*/) %>">*</abbr></td><td class="turn-left"><label id="lbl_activity_type_label"><%= h(1645/*Label*/) %></label></td><td width="55%"><input aria-labelledby="abbr_activity_type_label lbl_activity_type_label"required type="text" id="groupLabel" name="activity_type_label" value="<%- label %>" <%- inactive(label === \'WarehouseVisits\') %><% if (isInternal) { %> disabled="disabled" <% } %> class="pwi1" maxlength="32"/></td></tr><tr class="bct"><td width="1"><abbr id="abbr_gname" class="ofsc-abbr-mandatory" title="<%= h(22351/*required*/) %>">*</abbr></td><td class="turn-left"><label id="lbl_gname"><%= h(68/*Name*/) %></label></td><% if (lookups.languages.length === 1) { %><% var lang = lookups.languages[0]; %><td colspan="2" width="55%"><input aria-labelledby="abbr_gname lbl_gname" required type="text" name="name[<%- lang.id %>]" value="<%- name[lang.id] || \'\' %>" lang="<%- lang.label %>" data-langid="<%- lang.id %>" class="groupName pwi1" /></td></tr><% } else { %></tr><% for (var i in lookups.languages) { %><% var lang = lookups.languages[i]; %><tr><td width="1"></td><% if (lang.id == 1) { %><td class="turn-left padL5">* <% } else { %><td class="turn-left padL13"><% } %><label id="tdlang<%- lang.id %>"><%- lang.text %></label></td><td width="55%"><input <% if (lang.id == 1) {%>required="requred" aria-labelledby="abbr_gname tdlang<%- lang.id %> lbl_gname" <%} else { %>aria-labelledby="tdlang<%- lang.id %> lbl_gname"  <% } %>type="text" name="name[<%- lang.id %>]" value="<%- name[lang.id] || \'\' %>" class="groupName pwi1" lang="<%- lang.label %>" data-langid="<%- lang.id %>" /></td></tr><% } %><% } %></table></div></div>'}))})(toa);(function(d){var c=d.CompanySettings.ActivityTypes.BasePopupController;d.ns("toa.CompanySettings.ActivityTypes.ActivityTypeGroupPopup.Controller",d.define(c,function(b){this.itemId=b||null;this.readOnlyMode=!1;this._loadFailErrorText=h(23112);this._saveFailErrorText=h(23113);this._popupWidth=400;this.resume()},{_itemModelClass:d.CompanySettings.ActivityTypes.ActivityTypeGroupPopup.Model,_popupContainerViewClass:d.CompanySettings.ActivityTypes.ActivityTypeGroupPopup.ContainerView,_itemDataField:"activityTypeGroup",
_serverGetMethod:"getGroup",_serverSetMethod:"setGroup",toString:function(){return"ActivityTypeGroup popup controller"},loadData:function(){this._loadParams={activityTypeGroupId:this.getItemId()};c.prototype.loadData.apply(this,arguments)},getPopupTitle:function(){var b="";return b=this.isNewItem()?h(9007):h(9008)},processSaveItem:function(){this._saveParams={groupId:this.getItemId(),groupData:this.itemModel.getPreparedData()};c.prototype.processSaveItem.apply(this,arguments)},validateItem:function(){this.errors=
[];var b=this.itemModel.getLabel(),c=this.itemModel.getName(1);""===b.trim()&&this.errors.push({errorText:h(23352)});""===c.trim()&&this.errors.push({errorText:h(9009)})}}))})(toa);(function(d){var c=d.CompanySettings.ActivityTypes.BasePopupModel;d.ns("toa.CompanySettings.ActivityTypes.ActivityTypePopup.Model",d.define(c,function(){c.apply(this,arguments)},{idField:"activityTypeId",saveFields:"label name status groupId defaultDuration colors timeslots features multidayMinDuration multidayMaxDuration".split(" "),getDefaultData:function(){var b=this.getLookup("groups");return{label:"",name:{},status:"inactive",groupId:b[0]&&b[0].id?b[0].id:null,defaultDuration:"",colors:{pending_color:"FFFFFF",
complete_color:"FFFFFF",warning_color:"FFFFFF",suspended_color:"FFFFFF",notdone_color:"FFFFFF",not_ordered_color:"FFFFFF",started_color:"FFFFFF",enroute_color:"FFFFFF",cancelled_color:"FFFFFF"},timeslots:[],features:[],featureChecks:{},disabledFeatures:{},multidayMinDuration:60,multidayMaxDuration:420}},getColors:function(){return this.get("colors",{})},getColor:function(b){return this.getColors()[b]||null},setColors:function(b){this.set({colors:b})},setColor:function(b,c){var d=this.getColors();
d[b]=c;this.setColors(d)},getTimeslots:function(){return this.get("timeslots",[])},setTimeslots:function(b){b=b||[];this.set({timeslots:b})},setTimeslot:function(b,c){c=c||!1;var d=this.getTimeslots();c?-1===$.inArray(b,d)&&d.push(b):d=d.filter(function(c){return c!=b});this.setTimeslots(d)},isFeatureDisabled:function(b){var c=this.get("disabledFeatures",{});return c[b]&&1===c[b]?!0:!1},isFeatureChecked:function(b){var c=this.get("features",[]);return-1!==$.inArray(b,c)},isMultidayFeatureChecked:function(){return this.isFeatureChecked("ACTIVITY_FEATURE_MULTIDAY")}}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.ActivityTypes.ActivityTypePopup.ContainerView",d.define(c,function(){c.apply(this,arguments)},{chained_triggers:{},events:{"change #activityTypeLabel":"onChangeLabel","change .activityTypeName":"onChangeName","change #activityTypeStatus":"onChangeStatus","change #activityTypeGroup":"onChangeGroup","change #activityTypeDuration":"onChangeDuration","change #copy_from":"onChangeCopyFrom","change .activityTypeColor":"onChangeColor","change #group_checkbox":"invertCheckboxSelection",
"change .timeslotCheckbox":"onChangeTimeslot","change .activityTypeFeature":"checkChained","change #multiday_min_segment_duration":"onChangeMultidayMinDuration","change #multiday_max_duration_of_day_segments":"onChangeMultidayMaxDuration"},onChangeLabel:function(b){b=$(b.currentTarget).val();this.model.set({label:b})},onChangeName:function(b){var c=$(b.currentTarget);b=c.val();c=c.data("langid");this.model.setName(c,b)},onChangeStatus:function(b){b=$(b.currentTarget).prop("checked")?"active":"inactive";
this.model.set({status:b})},onChangeGroup:function(b){b=parseInt($(b.currentTarget).val(),10);this.model.set({groupId:b});var c=this._$el.find('input[name="features[ACTIVITY_FEATURE_WAREHOUSE_VISIT]"]');this._$el.find('input[name="features[ACTIVITY_FEATURE_INVENTORY_SUPPORT]"]');this.isWarehauseVisit(b)?c.prop("checked")||(c.click(),this._$el.find('input[name="features[ACTIVITY_FEATURE_INVENTORY_SUPPORT]"]').prop("disabled",!0)):c.prop("checked")&&(c.click(),this._$el.find('input[name="features[ACTIVITY_FEATURE_INVENTORY_SUPPORT]"]').prop("disabled",
!1))},onChangeDuration:function(b){b=$(b.currentTarget).val();this.model.set({defaultDuration:b})},findGroupLookupById:function(b){var c=this.model.getLookup("groups"),d=null,k;for(k in c)if(c[k].id===b){d=c[k];break}return d},isWarehauseVisit:function(b){return this.findGroupLookupById(b)&&"WarehouseVisits"===this.findGroupLookupById(b).label?!0:!1},onChangeCopyFrom:function(b){b=$(b.currentTarget).val();var c=this.model.getLookup("activityTypeColors"),d,k;if(c[b]){for(var l in c[b])k=c[b][l],d=
this._$el.find("#colors_"+l),d.css({"background-color":"#"+k}),d.val(k);this.model.setColors(c[b])}},onChangeColor:function(b){var c=$(b.target);b=c.val();c=c.data("colorkey");this.model.setColor(c,b)},invertCheckboxSelection:function(b){var c=$(b.target).prop("checked"),d=[];$.each(this._$el.find(".timeslotCheckbox"),function(b,l){$(l).prop("disabled")||($(l).prop("checked",c),c&&d.push(parseInt($(l).data("tsid"),10)))}.bind(this));this.model.setTimeslots(d)},onChangeTimeslot:function(b){var c=$(b.target);
b=parseInt(c.data("tsid"),10);c=c.prop("checked");this.model.setTimeslot(b,c)},onChangeMultidayMinDuration:function(b){b=parseInt($(b.target).val(),10);this.model.set({multidayMinDuration:b})},onChangeMultidayMaxDuration:function(b){b=parseInt($(b.target).val(),10);this.model.set({multidayMaxDuration:b})},checkChained:function(b,c){c=c||!1;var d="";b&&(d=$(b.target).data("featurelabel"),this.triggerUpdateWarning(b,d));this._$el.find('input[name="features[ACTIVITY_FEATURE_MULTIDAY]"]').prop("checked")?
(this._$el.find('input[name="features[ACTIVITY_FEATURE_PREDEFINED_DURATION]"]').attr("checked",!1),this.showMultidaySection()):this.hideMultidaySection();if(!0===c||this.chained_triggers[d]){var k,l=k=!1,n=!1,p=this.model.getLookup("featureChained"),s;for(s in p)if(n=!1,l=p[s].rules?p[s].rules:!1,!this.model.isFeatureDisabled(s)){for(var t in p[s])if("rules"!==t&&(d=l&&l[t]?l[t]:"checked",k=p[s][t],k=this._$el.find("input[name='features["+k+"]']").prop("checked"),"checked"===d&&k||"unchecked"===d&&
!k)){n=!0;break}this.setFeatureStatus(s,n,!0===c)}this._$el.find('input[name="features[ACTIVITY_FEATURE_WAREHOUSE_VISIT]"]').prop("checked")&&this._$el.find('input[name="features[ACTIVITY_FEATURE_INVENTORY_SUPPORT]"]').prop("checked",!0)}},setFeatureStatus:function(b,c,d){var k=this._$el.find('input[name="'+("features["+b+"]")+'"]');c?(d||k.prop("checked",!1),k.prop("disabled",!0)):k.prop("disabled",!1);this._$el.find("label#feature_caption_"+b).css("color",c?"rgb(119, 119, 119)":"#333333")},showMultidaySection:function(){this._$el.find(".multiday_activity_section").show().removeClass("toa-hidden")},
hideMultidaySection:function(){this._$el.find(".multiday_activity_section").hide().addClass("toa-hidden")},grabColors:function(){var b=this._$el.find(".activityTypeColor"),c={};$.each(b,function(b,d){var l=$(d).data("colorkey"),n=$(d).val();c[l]=n}.bind(this));this.model.setColors(c)},grabFeatures:function(){var b=this._$el.find(".activityTypeFeature"),c=[];$.each(b,function(b,d){$(d).prop("checked")&&c.push($(d).data("featurelabel"))}.bind(this));this.model.set({features:c})},render:function(b,d){c.prototype.render.apply(this,
arguments);this.initColorPicker();this.initFeatures();this.model.attributes.typeId&&this.isWarehauseVisit(this.model.attributes.groupId)&&this._$el.find("#activityTypeGroup").prop("disabled",!0);this.readOnlyMode&&(this._$el.find(".formField").prop("disabled",!0),this._$el.find("label.FeatureCaption").css({color:"#777777"}));return this},initFeatures:function(){var b=this.model.getLookup("featureChained");this.chained_triggers={};for(var c in b)for(var d in b[c])"rules"!==d&&(this.chained_triggers[b[c][d]]=
b[c][d]);this.checkChained(null,!0)},initColorPicker:function(){!0==_DATA.is_mobility_app?require(["ojs/ojcore","knockout"],function(b,c){b.ModuleBinding.defaults.modelPath="lib/oracle_jet/js/modules/";b.ModuleBinding.defaults.viewPath="text!lib/oracle_jet/templates/";b.ModuleBinding.defaults.viewSuffix=".tmpl.html";c.applyBindings(null,document.getElementById("color-picker-container"))}):require(["ojs/ojcore","knockout","ojs/ojknockout","ojs/ojmodule"],function(b,c){b.ModuleBinding.defaults.modelPath=
"modules/";b.ModuleBinding.defaults.viewPath="text!../templates/";b.ModuleBinding.defaults.viewSuffix=".tmpl.html";c.applyBindings(null,document.getElementById("color-picker-container"))});jetcolor.bind()},triggerUpdateWarning:function(b,c){var d=this.model.get("featureChecks");if(!d||$.isEmptyObject(d))return null;var k=$(b.target),l=k.prop("checked"),d=!!d[c],n=k.parents("tr .bct.turn-center").nextUntil(".bct",".enableWarning"),k=k.parents("tr .bct.turn-center").nextUntil(".bct",".disableWarning");
0<n.length&&(l&&!d?n.show().removeClass("toa-hidden"):n.hide().addClass("toa-hidden"));0<k.length&&(!l&&d?k.show().removeClass("toa-hidden"):k.hide().addClass("toa-hidden"))},template:'<% var selected = function(condition) { %><% return condition ? \' selected="selected"\' : \'\'; %><% }; %><% var inactive = function(condition) { %><% return condition ? \' disabled="disabled"\' : \'\'; %><% }; %><% var checked = function(condition) { %><% return condition ? \' checked="checked"\' : \'\'; %><% }; %><% var disabled = function(condition) { %><% return condition ? \' disabled="disabled"\' : \'\'; %><% }; %><div class="jet-css-only"><div class="jet-css-only-iframe company-settings-set-activity-type" id="activityTypeContainer"><table class="pwc" cellpadding="2" cellspacing="0" border="0" width="100%" height="100%"><tr><td width="50%" valign="top"><table cellpadding="2" role="none" cellspacing="0" border="0" width="100%"><tr class="pwt"><td colspan="3"><div class="form-section-title"><h2 class="form-section-title__text"><%= h(5379/*Activity type info*/) %></h2></div></td></tr><tr class="bct"><td width="1"><abbr id="abbr_activity_type_label" class="ofsc-abbr-mandatory" title="<%= h(22351/*required*/) %>">*</abbr></td><td class="turn-left"><label id="lbl_activity_type_label"><%= h(1645/*Label*/) %></label></td><td width="55%"><input aria-labelledby="abbr_activity_type_label lbl_activity_type_label" required type="text" id="activityTypeLabel" value="<%- label %>" class="pwi1 formField" maxlength="32"/></td></tr><tr class="bct"><td width="1"><abbr id="abbr_activity_type_name" class="ofsc-abbr-mandatory" title="<%= h(22351/*required*/) %>">*</abbr></td><td class="turn-left"><label id="lbl_activity_type_name"><%= h(68/*Name*/) %></label></td><% if (lookups.languages.length === 1) { %><% var lang = lookups.languages[0]; %><td colspan="2" width="55%"><input aria-labelledby="abbr_activity_type_name lbl_activity_type_name" required type="text" value="<%- name[lang.id] || \'\' %>"lang="<%- lang.label %>"class="activityTypeName pwi1 formField" data-langid="<%- lang.id %>" /></td></tr><% } else { %></tr><% for (var i in lookups.languages) { %><% var lang = lookups.languages[i]; %><tr><td width="1"></td><% if (lang.id == 1) { %><td class="turn-left padL5">* <% } else { %><td class="turn-left padL13"><% } %><label id="tdlang<%- lang.id %>"><%- lang.text %></label></td><td width="55%"><input <% if (lang.id == 1) {%>required="requred" aria-labelledby="abbr_activity_type_label tdlang<%- lang.id %> lbl_activity_type_name" <%} else { %>aria-labelledby="tdlang<%- lang.id %> lbl_activity_type_name"  <% } %>value="<%- name[lang.id] || \'\' %>" class="activityTypeName pwi1 formField" lang="<%- lang.label %>" data-langid="<%- lang.id %>" /></td></tr><% } %><% } %><tr class="bct"><td width="1"></td><td class="turn-left"><label for="activityTypeStatus"><%= h(30/*Active*/) %></label></td><td><input type="checkbox" id="activityTypeStatus" class="formField" value="1" <%- checked(status !== \'inactive\') %> /></td></tr><tr class="bct"><td width="1"></td><td class="turn-left"><label for="activityTypeGroup"><%= h(5165/*Group*/) %></label></td><td><select id="activityTypeGroup" class="formField pwi1"><% for (var i in lookups.groups) { %><% var item = lookups.groups[i]; %><option value="<%- item.id %>" <%- inactive(label && item.label === \'WarehouseVisits\') %><%- selected(item.id === groupId) %>><%- item.text %></option><% } %></select></td></tr><tr class="bct"><td width="1"><abbr id="abbr_activity_type_default_duration" class="ofsc-abbr-mandatory" title="<%= h(22351/*required*/) %>">*</abbr></td><td class="turn-left"><label id="lbl_activity_type_default_duration"><%= h(17087/*Default Duration*/) %></label></td><td width="55%">'+
r(19515,{"{VALUE}":'<input aria-labelledby="abbr_activity_type_default_duration lbl_activity_type_default_duration" required type="text" maxlength="4" id="activityTypeDuration" value="<%- defaultDuration %>" class="pwi1 half-width formField"/>'})+'</td></tr><tr><td><br/></td></tr><tr class="pwt"><td colspan="3"><div class="form-section-title"><h2 class="form-section-title__text"><%= h(9004/*Color scheme*/) %></h2></div></td></tr><tr class="bct"><td width="5px">&nbsp;</td><td class="turn-left"><label for="copy_from"><%= h(9079/*Copy from*/) %></label></td><td><select id="copy_from" class="formField pwi1"><option></option><% for (var i in lookups.groups) { %><% var group = lookups.groups[i]; %><optgroup label="<%- group.text %>"><% var atypes = lookups.activityTypes[group.id] || []; %><% for (var j in atypes) { %><% var type = atypes[j]; %><option value="<%- type.id %>"><%- type.text %></option><% } %></optgroup><% } %></select></td></tr><% var getTextColor = function(hexValue) { %><% var rgb = []; %><% rgb.push(parseInt(hexValue.substring(0, 2), 16)/255); %><% rgb.push(parseInt(hexValue.substring(2, 4), 16)/255); %><% rgb.push(parseInt(hexValue.substring(4, 6), 16)/255); %><% var res = 0.213 * rgb[0] + 0.715 * rgb[1] + 0.072 * rgb[2]; %><% return res < 0.5 ? \'FFFFFF\' : \'000000\'; %><% }; %><% for (var i in lookups.colors) { %><% var color = lookups.colors[i]; %><% var colorBackground = colors[color.label] ? colors[color.label] : \'FFFFFF\'; %><tr class="bct"><td width="5px">&nbsp;</td><td class="turn-left"><label for="colors_<%- color.label %>"><%- color.text %></label></td><td class="turn-left"><input type="text" class="color jetcolor pwi1 formField activityTypeColor" value="<%- colorBackground %>" style="background-color:#<%- colorBackground %>;<% if (colors[color.label]) { %>color: #<%- getTextColor(colors[color.label]) %>;<% } %>" data-colorkey="<%- color.label %>" id="colors_<%- color.label %>"/></td></tr><% } %><tr><td><br/></td></tr> <tr><td valign="top" colspan="3"><table cellpadding="2" cellspacing="1" border="0" width="100%" class="oj-table"><caption style="display: none"><%= h(9005/*Available time slots*/) %></caption><tr class="pwt" class="turn-center"><td width="10" class="ht"><input id="group_checkbox" type="checkbox" class="formField" /></td><th scope="col" class="ht"><label for="group_checkbox"><%= h(9005/*Available time slots*/) %></label></th></tr><% if (lookups.timeslots.length > 0) { %><% var disabledText = h(5580/*Disabled*/).toLowerCase(); %><% for (var i in lookups.timeslots) { %><% var timeslot = lookups.timeslots[i]; %><% var timeslotChecked = -1 !== $.inArray(timeslot.id, timeslots); %><% if (timeslotChecked || timeslot.status === \'active\') { %><tr class="grid_data" class="turn-center"><td width="10"><input id="time_slots_<%- timeslot.id %>" type="checkbox" value="1" data-tsid="<%- timeslot.id %>" <%- checked(timeslotChecked) %> class="timeslotCheckbox formField"/></td><th scope="row" class="turn-left"><label for="time_slots_<%- timeslot.id %>"><%- timeslot.name %> (<%- timeslot.startEnd ? timeslot.startEnd : h(5590/*All-day time slot*/) %>)<% if (!timeslotChecked) { %> - <%- disabledText %><% } %></label></th></tr><% } %><% } %><% } else { %><tr class="grid_data" class="turn-center"><td colspan="3"><%= h(3453/*There are no time slots in the system*/) %></td></tr><% } %></table></td></tr></table></td><td width="20px">&nbsp;</td><td valign="top"><table class="pwc" role="none" cellpadding="2" cellspacing="2" border="0"><tr class="pwt"><td colspan="2"><div class="form-section-title"><h2 class="form-section-title__text"><%= h(9006/*Features*/) %></h2></div></td></tr><tr><td valign="top" colspan="2"><table class="pwc1" role="none" cellpadding="2" cellspacing="0" border="0"><% for (var i in lookups.features) { %><% var feature = lookups.features[i]; %><% var isDisabled = disabledFeatures[feature.label] && 1 === disabledFeatures[feature.label]; %><tr class="bct turn-center"><td width="7%"><input type="checkbox" class="activityTypeFeature formField" id="feature_id_<%- feature.label %>" name="features[<%- feature.label %>]" <% if (feature.label == "ACTIVITY_FEATURE_WAREHOUSE_VISIT"){ %>style="display:none"<% } %>data-featurelabel="<%- feature.label %>" value="1" <%- checked(featureChecks[feature.label] && 1 === featureChecks[feature.label]) %><%- disabled(isDisabled) %>/></td><td class="turn-left"><label for="feature_id_<%- feature.label %>" class="featureCaption" id="feature_caption_<%- feature.label %>" <% if (isDisabled) { %>style="color: #777777;"<% } %>><%= feature.text %></label></td></tr><% if(feature.enableWarning) { %><tr class="enableWarning toa-hidden"><td width="7%"></td><td><p class="warningMessage" tabindex="0"><%- feature.enableWarning || null %></p></td></tr><% } %><% if(feature.disableWarning) { %><tr class="disableWarning toa-hidden"><td width="7%"></td><td><p class="warningMessage" tabindex="0"><%- feature.disableWarning || null %></p></td></tr><% } %><% } %></table></td></tr></table></td></tr><tr class="multiday_activity_section toa-hidden"><td colspan="3"><table width="100%" class="pwc1 form"><tr class="pwt"><td colspan="2"><div class="form-section-title"><h2 class="form-section-title__text"><%= h(15800/*Multi-day activity*/) %></h2></div></td></tr><tr class="bct"><td colspan="2" width="50%"><label for="multiday_min_segment_duration">'+
r(19536,{"{SELECT}":'&nbsp;&nbsp;<select id="multiday_min_segment_duration" class="pwi5"><% for (var i in lookups.durations) { %><% var item = lookups.durations[i]; %><option value="<%- item %>"<%- selected(item === multidayMinDuration) %>><%- item %></option><% } %></select>',"{UNIT}":h(15073)})+'</label></td></tr><tr class="bct"><td colspan="2" width="50%"><label for="multiday_max_duration_of_day_segments">'+r(19537,{"{SELECT}":'&nbsp;&nbsp;<select id="multiday_max_duration_of_day_segments" class="pwi5"><% for (var i in lookups.durations) { %><% var item = lookups.durations[i]; %><option value="<%- item %>"<%- selected(item === multidayMaxDuration) %>><%- item %></option><% } %></select>',
"{UNIT}":h(15073)})+'</label></td></tr><tr><td colspan="2" class="note">'+r(21742)+'</td></tr></table></td></tr></table><div class="oracle-jet jet-css-only screen-container" id="color-picker-container" dir="ltr" data-bind="ojModule: {name: \'colorpicker\'}"></div></div></div>'}))})(toa);(function(d){var c=d.CompanySettings.ActivityTypes.BasePopupController;d.ns("toa.CompanySettings.ActivityTypes.ActivityTypePopup.Controller",d.define(c,function(b){this.itemId=b.activityTypeId||null;this.clone=b.clone||!1;this._loadFailErrorText=h(23110);this._saveFailErrorText=h(23111);this._popupWidth=800;c.apply(this,arguments)},{_itemModelClass:d.CompanySettings.ActivityTypes.ActivityTypePopup.Model,_popupContainerViewClass:d.CompanySettings.ActivityTypes.ActivityTypePopup.ContainerView,_itemDataField:"activityType",
_serverGetMethod:"get",_serverSetMethod:"set",toString:function(){return"ActivityTypes popup controller"},isClone:function(){return this.clone||!1},loadData:function(){var b=this.getItemId();this.clone&&(this.itemId=null);this._loadParams={activityTypeId:b,clone:this.clone};c.prototype.loadData.apply(this,arguments)},getSubmitButtonText:function(){var b=h(405);this.clone?b=h(5387):this.isNewItem()&&(b=h(222));return b},getPopupTitle:function(){var b="";return b=this.isReadOnly()?h(23114):this.clone?
h(9080):this.isNewItem()?h(3479):h(3478)},hackOverlay:function(){$(this.popup._dom.content).css({"padding-left":0,"padding-right":0});c.prototype.hackOverlay.apply(this,arguments)},saveItem:function(){this.popupContainerView.grabColors();this.popupContainerView.grabFeatures();c.prototype.saveItem.apply(this,arguments)},processSaveItem:function(){this._saveParams={activityTypeId:this.getItemId(),activityTypeData:this.itemModel.getPreparedData(),clone:this.clone};c.prototype.processSaveItem.apply(this,
arguments)},validateItem:function(){this.errors=[];var b=this.itemModel.get("label",""),c=this.itemModel.getName(1);""===b.trim()&&this.errors.push({errorText:h(3476)});""===c.trim()&&this.errors.push({errorText:h(3475)});b=""+this.itemModel.get("defaultDuration","");""===b.trim()?this.errors.push({errorText:h(17089)}):1>parseInt(b)||1440<parseInt(b)?this.errors.push({errorText:r(17971,{"{FROM}":1,"{TO}":1440})}):-1===b.search(/^[0-9]+$/g)&&this.errors.push({errorText:h(17972)});if(this.itemModel.isMultidayFeatureChecked()){var c=
this.itemModel.get("multidayMinDuration",0),d=this.itemModel.get("multidayMaxDuration",0);c>d&&this.errors.push({errorText:h(15069)});c>parseInt(b,10)&&this.errors.push({errorText:r(20802,{"{DURATION}":c})})}}}))})(toa);(function(d){d.ns("toa.CompanySettings.Flows.ServerConnector",d.define(null,function(c,b){this._triggerFunction=c;this._controller=b},{_triggerFunction:function(){},_controller:"",updateFlowDependencies:function(c){return this.request("updateFlowDependencies",{label:c})},request:function(c,b){var d=this;return new Promise(function(g,k){d._triggerFunction("global.data.get",{controller:d._controller,method:c,params:b||{},responseHandler:function(b,c){c.status&&"OK"===c.status?g(c):k(c)}.bind(this)})})}}))})(toa);(function(d){d.ns("toa.CompanySettings.Flows.constants",d.define(null,function(){this.TARGET_TYPE_IDS_LOOKUP_KEYS_MAP[1]="forms";this.TARGET_TYPE_IDS_LOOKUP_KEYS_MAP[2]="plugins";this.TARGET_TYPE_IDS_LOOKUP_KEYS_MAP[3]="screens";this.STEP_TYPE_TRANSLATION_MAP[1]=18181;this.STEP_TYPE_TRANSLATION_MAP[2]=18143;this.STEP_TYPE_TRANSLATION_MAP[3]=225781},{DEFAULT_TARGET_OBJECT:{type:1,label:null},visibilityTypeTranslations:{stepIsAvailable:h(226530),stepIsCompleted:h(226531)},CONDITION_ROW_FIELD:0,CONDITION_ROW_STEP:1,
TARGET_TYPE_IDS_LOOKUP_KEYS_MAP:{},STEP_TYPE_TRANSLATION_MAP:{},DEFAULT_TARGET_TYPE:1,TARGET_TYPE_FORM:1,TARGET_TYPE_PLUGIN:2,TARGET_TYPE_ACTION_SCREEN:3,TARGET_TYPE_FORM_NAME:"forms",TARGET_TYPE_PLUGIN_NAME:"plugins",TARGET_TYPE_ACTION_SCREEN_NAME:"screens",IS_AVAILABLE_VISIBILITY_NAME:"stepIsAvailable",IS_COMPLETED_VISIBILITY_NAME:"stepIsCompleted",MAX_STEP_NAME:256,ENTITY_TYPE_FORM_DATA:11,ENTITY_TYPE_SCREEN:10,PLUGIN_TYPE_ADDON:"addon",FORM_FIELD_LABEL:"form",INVENTORY_LIST_SCREEN_FIELD_LABEL:"list_inventories"}))})(toa);(function(d){var c=new d.CompanySettings.Flows.constants;d.ns("toa.CompanySettings.Flows.service.DefaultConditionsManager",d.define(null,function(){this.defaultConditionProcessors=[{defaultConditionId:0,defaultConditionPropertyLabel:c.FORM_FIELD_LABEL,getConditionObject:function(){return{entity:c.ENTITY_TYPE_FORM_DATA,field:c.FORM_FIELD_LABEL,value:"submitted",condition:"in"}},getConditionRows:function(b,d){return[{id:c.FORM_FIELD_LABEL,label:d||c.FORM_FIELD_LABEL,targetLabel:d||c.FORM_FIELD_LABEL,
text:h(22391),selected:c.FORM_FIELD_LABEL===b?'selected="selected"':"",disabled:""}]},getVisibilityObject:function(){var b={};b[c.IS_COMPLETED_VISIBILITY_NAME]={};b[c.IS_COMPLETED_VISIBILITY_NAME][c.TARGET_TYPE_FORM]=[this.getConditionObject()];return b},applyWhen:function(b){return b.isFormTargetType()},getBaseRowTemplateCondition:function(b,c){var g=new d.Template('<div class="item_row">;<div data-id="<%-id%>" title="<%-fieldName%>" class="defaultCondition fieldName"><nobr><%-fieldName%></nobr></div>;<div class="fieldValue" >;<span data-id="value-short-<%-id%>" class="condition-value condition-value-short">;<span class="visibility-condition"><%-condition%></span>;<%- valueName %>;</span>;</span>;</div>;</div>'.split(";"));
return $(g.apply({id:b,fieldName:c,condition:h(11456),valueName:this.getConditionObject().value}))}},{defaultConditionId:1,defaultConditionPropertyLabel:c.INVENTORY_LIST_SCREEN_FIELD_LABEL,getConditionObject:function(){return{entity:c.ENTITY_TYPE_SCREEN,field:c.INVENTORY_LIST_SCREEN_FIELD_LABEL,value:"installed",condition:"in"}},getConditionRows:function(b,d){return[{id:c.INVENTORY_LIST_SCREEN_FIELD_LABEL,label:d||c.INVENTORY_LIST_SCREEN_FIELD_LABEL,targetLabel:d||c.INVENTORY_LIST_SCREEN_FIELD_LABEL,
text:h(14260),selected:c.INVENTORY_LIST_SCREEN_FIELD_LABEL===b?'selected="selected"':"",disabled:""}]},getVisibilityObject:function(){var b={};b[c.IS_COMPLETED_VISIBILITY_NAME]={};b[c.IS_COMPLETED_VISIBILITY_NAME][c.TARGET_TYPE_FORM]=[this.getConditionObject()];return b},applyWhen:function(b){return b.isInventoryListTarget()},getBaseRowTemplateCondition:function(b){var c=new d.Template('<div class="item_row">;<div data-id="<%-id%>" title="<%-fieldName%>" class="defaultCondition fieldName"><nobr><%-fieldName%></nobr></div>;<div class="fieldValue" >;<span data-id="value-short-<%-id%>" class="condition-value condition-value-short">;<span class="visibility-condition"><%-condition%></span>;<%- valueName %>;</span>;</span>;</div>;</div>'.split(";"));
return $(c.apply({id:b,fieldName:h(14260),condition:h(11456),valueName:this.getConditionObject().value}))}}]},{isConditionDefault:function(b){return!!this.findDefaultConditionProcessorByCondition(b)},areConditionsEqual:function(b,c){return Number(b.entity)===Number(c.entity)&&b.value===c.value&&b.field===c.field&&b.condition===c.condition},findDefaultConditionProcessorByStep:function(b){return this.defaultConditionProcessors.find(function(c){return c.applyWhen(b)})},findDefaultConditionProcessorByPropertyLabel:function(b){return this.defaultConditionProcessors.find(function(c){return c.defaultConditionPropertyLabel===
b})},findDefaultConditionProcessorByCondition:function(b){var c=[].slice.call(arguments,1),g=this;b instanceof d.CompanySettings.Flows.models.TmpConditionDictionary&&(b={entity:Number(b.get("entity")),field:b.get("field"),value:b.get("value"),condition:b.get("condition")});return this.defaultConditionProcessors.find(function(d){d=d.getConditionObject.call(c);return g.areConditionsEqual(d,b)})},sanitizeVisibilityObject:function(b,c){var d=this.mapVisibilityObject(c),d=this.filterNotRelatedConditions(b,
d);return d=this.addDefaultCondition(b,d)},filterNotRelatedConditions:function(b,c){var d=this,k=this.defaultConditionProcessors.filter(function(c){return!c.applyWhen(b)});c.map(function(b){b.conditions=b.conditions.filter(function(b){return!k.some(function(c){return d.areConditionsEqual(c.getConditionObject(),b)})});return b});1<c.length&&c.filter(function(b){return 0!==b.conditions.length});return c},addDefaultCondition:function(b,c){var d=this.findDefaultConditionProcessorByStep(b);d&&c[0].conditions.unshift(d.getConditionObject());
return c},mapVisibilityObject:function(b){return b&&0!==b.length?b:[{conditions:[]}]}}))})(toa);(function(d){var c=new d.CompanySettings.Flows.constants;d.ns("toa.CompanySettings.Flows.service.StepConditionsManager",d.define(null,function(){},{getFlowElement:function(b){return{entity:c.ENTITY_TYPE_FORM_DATA,field:b,value:"completed",condition:"in"}},getStepConditionObject:function(b){return this.getFlowElement(b)},isStep:function(b){return b.match(/^step_\d+$/)}}))})(toa);(function(d){var c=d.models.ObservableModel;d.ns("toa.CompanySettings.Flows.models.BaseModel",d.define(c,function(b){c.apply(this,arguments);this._lookups={};this._flowMethod=""},{skippedToJSONAttributes:["errors","names"],subscribeOnChild:function(b){b.addListener("all",function(){this.notify.apply(this,arguments)},this)},toJSON:function(){var b=c.prototype.toJSON.apply(this,arguments);this.idField in this.attributes||delete b[this.idField];return b},getDefault:function(b){var c="";this.getLookup(b)&&
this.getLookup(b).length&&(c=this.getLookup(b)[0].label);return c},setLookups:function(b){this._lookups=b},getLookups:function(){return this._lookups},setflowMethod:function(b){this._flowMethod=b},getflowMethod:function(){return this._flowMethod},getLookup:function(b){b=b||!1;var c=this.getLookups();return b?c[b]||null:c},getModelField:function(b,c){c=c||!1;var d=this.get(b,"");return c?this.translate(this.getLookup(b),d):d},translate:function(b,c){for(var d=c,k=0;k<b.length;k++)if(c===b[k].label){d=
b[k].text;break}return d}}))})(toa);(function(d){var c=d.models.ObservableCollection;d.ns("toa.CompanySettings.Flows.models.BaseCollection",d.define(c,function(){c.apply(this,arguments)},{modelConstructor:d.CompanySettings.Flows.models.BaseModel,where:function(b,c){var d=[];this.each(function(k,l){k.get(b)===c&&d.push(k)},this);return d},first:function(){return this.models[0]||null},find:function(b,c,d){return this.findBy(function(d){return d.get(b)==c},null,d)},findBy:function(b,c,d){b=this.findIndexBy(b,c,d);return-1<b?this.models[b]:
null},findIndexBy:function(b,c,d){var k=this.models;d=d||0;for(var l=k.length;d<l;d++)if(b.call(c||this,k[d]))return d;return-1},compact:function(){for(var b=this.compactData.apply(this,arguments),c=new this.constructor,d=0,k=b.length;d<k;d++)c.add(b[d],{silent:!0});return c},compactData:function(){var b=[],c=Array.prototype.slice.call(arguments,0);this.each(function(d){d=d.pick(c);b.push(d)});return b},getAutoIncrement:function(b){var c=0;b=this.pluck(b);b.length&&(c=+Math.max.apply(null,b));c++;
return c},toJSON:function(){var b=c.prototype.toJSON.apply(this,arguments);this.idField in this.attributes||delete b[this.idField];return b},insert:function(b,c){this.models.splice(b,0,c)}}))})(toa);(function(d){var c=d.CompanySettings.Flows.models.BaseModel;d.ns("toa.CompanySettings.Flows.models.Flow",d.define(c,function(){c.apply(this,arguments)},{idField:"label",getId:function(){return this.get(this.idField)},isRemovable:function(){return!0},validate:function(){return!0}}))})(toa);(function(d){var c=d.CompanySettings.Flows.models.BaseModel,b=new d.CompanySettings.Flows.constants,e=new d.CompanySettings.Flows.service.DefaultConditionsManager;d.ns("toa.CompanySettings.Flows.models.Step",d.define(c,function(){c.apply(this,arguments)},{idField:"stepId",getId:function(){return this.get(this.idField)},isRemovable:function(){return!0},validate:function(){return!0},loadModel:function(b){var c={stepId:b.getId(),defaultVisibility:b.get("defaultVisibility"),gui:b.get("gui"),locked:b.get("locked")?
b.get("locked"):!1,label:b.get("label"),name:this.checkAndAssign(b,"name"),order:b.get("order"),parameters:this.checkAndAssign(b,"parameters"),target:this.checkAndAssign(b,"target"),visibility:this.checkAndAssign(b,"visibility")};"undefined"!==typeof b.collection&&(this.collection=b.collection);this.set(c);return this},checkAndAssign:function(b,c){return"undefined"!==typeof b.get(c)&&0!==b.get(c).length?JSON.parse(JSON.stringify(b.get(c))):{}},setDefaultValues:function(){var c={defaultVisibility:"stepIsVisible",
gui:"input",locked:!1,name:{},order:0,parameters:[],target:b.DEFAULT_TARGET_OBJECT,visibility:{stepIsCompleted:[{conditions:[e.defaultConditionProcessors[0].getConditionObject()]}],stepIsAvailable:{}}};this.set(c);return this},setVisibility:function(b,c,d){var e=this.get("visibility")||{stepIsCompleted:[],stepIsAvailable:[]};if("undefined"===typeof c&&"undefined"!==typeof e[b]&&"undefined"!==typeof e[b][d])e[b]=e[b].filter(function(b,c){return parseInt(c)!==parseInt(d)});else if(c){var p=!!c.conditions,
s=!!c.expression;"undefined"!==typeof e[b][d]&&null!==e[b][d]?p&&0===c.conditions.length?e[b].splice(d,1):e[b][d]=c:(p&&0!==c.conditions.length||s&&0!==c.expression.length)&&e[b].push(c)}else return;this.set({visibility:e})},getTargetTypeName:function(){var c=this.get("target",b.DEFAULT_TARGET_OBJECT).type;return b.TARGET_TYPE_IDS_LOOKUP_KEYS_MAP[c]},getSelectedTargetValue:function(){return this.get("target",b.DEFAULT_TARGET_OBJECT).label},getOrder:function(){return this.get("order",0)},getSelectedTargetType:function(){return this.get("target",
b.DEFAULT_TARGET_OBJECT).type},setTarget:function(b){this.set({target:b})},setTargetLabel:function(b){this.setTarget({type:this.getSelectedTargetType(),label:b})},setTargetType:function(b){this.setTarget({type:b,label:this.getSelectedTargetValue()})},isPluginTargetType:function(){return Number(this.getSelectedTargetType())===b.TARGET_TYPE_PLUGIN},isFormTargetType:function(){return Number(this.getSelectedTargetType())===b.TARGET_TYPE_FORM},isScreenTargetType:function(){return Number(this.getSelectedTargetType())===
b.TARGET_TYPE_ACTION_SCREEN},isInventoryListTarget:function(){return this.isScreenTargetType()&&this.getSelectedTargetValue()===b.INVENTORY_LIST_SCREEN_FIELD_LABEL},setLabel:function(b){this.set({label:b});return this},setCollection:function(b){this.collection=b;return this},stepTypeTranslationMap:function(c){return b.STEP_TYPE_TRANSLATION_MAP[c]},getLabel:function(){return h(this.stepTypeTranslationMap(this.getSelectedTargetType()))},getParameters:function(){return Array.isArray(this.get("parameters"))?
this.get("parameters"):[]},isLocked:function(){return"true"===this.get("locked")},isEqual:function(b){var c=this.getId(),d=b.getId();return c||d?c===d:JSON.stringify(this.toJSON())===JSON.stringify(b.toJSON())},isNotEqual:function(b){return!this.isEqual(b)}}))})(toa);(function(d){var c=d.CompanySettings.Flows.models.BaseModel,b=new d.CompanySettings.Flows.constants;d.ns("toa.CompanySettings.Flows.models.StepItemCondition",d.define(c,function(){c.apply(this,arguments)},{getName:function(){if(this.get("field")===b.FORM_FIELD_LABEL)return h(22391);var c="",g=this.get("field"),k=new d.CompanySettings.Flows.service.TranslationService;$.each(this.get("stepsCollection").models,function(b,d){g===d.get("label")&&(c=k.getNameTranslation(d))});return c},getLabel:function(){return this.get("field")},
isRemovable:function(){return!0},validate:function(){return!0},hasLookups:function(){return!1},isEnumeration:function(){return!1}}))})(toa);(function(d){var c=new d.CompanySettings.Flows.constants;d.ns("toa.CompanySettings.Flows.models.StepValueComboBoxViewModel",d.define(null,function(b){var c=this;require(["knockout"],function(d){c.optionsKeys=d.observable(c.getOptionsKeys(b.targetType));c.selectedValue=d.observable(b.selectedValue);c.currentValue=b.selectedValue;c.dataProvider=d.observable(b.dataArray);c.onValueChanged=b.onValueChanged;c.optionRenderer=c.getOptionRenderer.bind(c)})},{getOptionsKeys:function(b){switch(b){case c.TARGET_TYPE_FORM_NAME:return{value:"form_id",
label:"label"};case c.TARGET_TYPE_PLUGIN_NAME:return{value:"label",label:"label"};case c.TARGET_TYPE_ACTION_SCREEN_NAME:return{value:"label",label:"name"}}},getOptionRenderer:function(b){var c=document.createElement("div");c.style.fontWeight="normal";c.style.lineHeight="normal";c.style.paddingTop="6px";c.style.paddingBottom="6px";if(b.data.text){var d=document.createElement("span");d.style.fontSize="12px";d.style.display="block";d.style.lineHeight="normal";d.textContent=b.data.text;c.appendChild(d)}b.data.value&&
(d=document.createElement("span"),d.style.fontSize="11px",d.style.lineHeight="normal",d.textContent="["+b.data.value+"]",c.appendChild(d));return{insert:c}},update:function(b){b.hasOwnProperty("dataArray")&&b.hasOwnProperty("targetType")&&(this.optionsKeys(this.getOptionsKeys(b.targetType)),this.dataProvider(b.dataArray));b.hasOwnProperty("selectedValue")&&this.selectedValue(b.selectedValue||null)}}))})(toa);(function(d){d.ns("toa.CompanySettings.Flows.models.StepOrderComboBoxViewModel",d.define(null,function(c){var b=this;require(["knockout","ojs/ojarraydataprovider"],function(d,g){b.order=d.observable(c.order);b.selectedValue=d.observable(c.selectedValue);b.currentValue=c.selectedValue;b.dataProvider=new g(c.dataArray,{keyAttributes:"value"});b.onValueChanged=c.onValueChanged})},{update:function(c){this.selectedValue(Number(c.selectedValue))}}))})(toa);(function(d){var c=new d.CompanySettings.Flows.constants;d.ns("toa.CompanySettings.Flows.models.StepListViewModel",d.define(null,function(b,e){var g=this,k=b.ko,l=b.ArrayTreeDataProvider;this.dataProvider=k.observable();this.activeLayout=k.observable("list");this.draggedItem={};this.translationService=new d.CompanySettings.Flows.service.TranslationService;this.modifyStepLabel=h(227207);this.deleteStepLabel=h(227208);this.editFormStepLabel=h(227209);this.isReadOnlyMode=b.isReadOnlyMode;this.menuStepItemAction=
b.menuStepItemAction;this.TARGET_TYPE_FORM=c.TARGET_TYPE_FORM;var n=d.app.model("companySettings").getUser().ulanguage,p=[];b.data.models.forEach(function(b,c){var d=g.translationService.getTransformedTranslations(b.get("target").type,b.get("target").label),d="undefined"!==typeof b.get("name")&&"undefined"!==typeof b.get("name")[n]?b.get("name")[n]:d[n];p.push({idx:c,id:b.getId(),name:d.text||"",label:b.getLabel(),order:b.getOrder(),target:b.get("target").label||"",type:b.get("target").type})});this.data=
k.observableArray(p);this.dataProvider(new l(g.data,{keyAttributes:"id"}));this.handleDragStart=function(b,c){g.substituteListViewDragImage();g.draggedItem={id:c.items[0].id,idx:c.items[0].idx}};this.handleDragEnd=function(){var c=0;g.data().forEach(function(b,d){b.id===g.draggedItem.id&&(c=d)});c!==g.draggedItem.idx&&e.notify("flow_step_action:dnd_reorder",b.data.models[g.draggedItem.idx],c);g.bringBackListViewDragImage()};this.handleReorder=function(b){for(var c=document.getElementById("listview"),
d=c.getContextByNode(b.detail.reference),e=b.detail.items,k=0;k<e.length;k++){var l=c.getContextByNode(e[k]),l=g.findItem(g.data,l.key),n;l&&(n=l.arr.splice(l.index,1)[0]);l=g.findItem(g.data,d.key);"undefined"!==typeof l&&l&&n?"inside"===b.detail.position?l.arr()[l.index].children.push(n):"after"===b.detail.position&&l.index===l.arr.length-1?l.arr.push(n):l.arr.splice("after"===b.detail.position?l.index+1:l.index,0,n):(l={index:d.index,arr:g.data},l.arr.splice(d.index,0,n))}g.handleDragEnd()};this.findItem=
function(b,c){for(var d,e=b(),k=0;k<e.length&&(e[k].id===c?d={index:k,arr:b}:e[k].children&&(d=g.findItem(e[k].children,c)),!d);k++);return d};this.substituteListViewDragImage=function(){$("body > .oj-listview-drag-image").addClass("oj-listview-drag-image-flows-manage").detach().appendTo(_DATA.popup_container+" #company-settings-flows")};this.bringBackListViewDragImage=function(){$(".oj-listview-drag-image-flows-manage").detach().appendTo("body")}}))})(toa);(function(d){var c=d.CompanySettings.Flows.models.BaseModel;d.ns("toa.CompanySettings.Flows.models.BaseLayoutItem",d.define(c,function(b){c.apply(this,arguments);this.setNames();this.setTranslations()},{_defaultType:"",getType:function(){return this.get("type",this._defaultType)},getLabel:function(){return this.get("label","")},getEntity:function(){return this.get("entity","")},setDefaultVisibility:function(b,c){0===this.get("visibility").getCount()&&null==b.default_visibility&&this.set({default_visibility:c})},
setNames:function(b){var c;b=b||this.get("names",[]);b instanceof d.CompanySettings.Flows.models.collection.Translations||(c=new d.CompanySettings.Flows.models.collection.Translations,c.load(b),this.set({names:c},{silent:!0}))},clearNames:function(){var b=this.get("names");b instanceof d.CompanySettings.Flows.models.collection.Translations&&b.clear()},clearTranslations:function(){var b=this.get("translations");b instanceof d.CompanySettings.Flows.models.collection.Translations&&b.clear()},getName:function(){var b,
c,g,k;c=new d.CompanySettings.Flows.service.TranslationService;g=c.getUserLanguage();(b=this.get("names"))&&b instanceof d.models.ObservableCollection&&b.getCount()&&(c=b.get(g));c&&(k=c.get("name",""));k||(b=this.get("names"),(g=b.get(g))&&(k=g.get("name")));k||(k=this.get("name"));return k||""},setTranslations:function(b){var c;b=b||this.get("translations",[]);b instanceof d.CompanySettings.Flows.models.collection.Translations||(c=new d.CompanySettings.Flows.models.collection.Translations,c.load(b),
this.set({translations:c},{silent:!0}))},isSpecialElement:function(){return!1},isButton:function(){return!1},isEvaluationAllowed:function(){return!1},hasValidationErrors:function(){var b=this.get("errors",[]);return b&&$.isArray(b)&&b.length},append:function(b){this.collection.appendAfter(b,this)}}))})(toa);(function(d){var c=d.CompanySettings.Flows.models.BaseModel;d.ns("toa.CompanySettings.Flows.models.Translation",d.define(c,function(){c.apply(this,arguments)},{clone:function(){return c.prototype.clone.apply(this,arguments)},isUserLanguage:function(){return(new d.CompanySettings.Flows.service.TranslationService).getUserLanguage()===this.getId()},getId:function(){return this.get("id")},toJSON:function(){if(this.get("name")){var b={},c;b[this.idField]=this.getId();for(c in this.attributes)b[c]=this.attributes[c]instanceof
d.models.ObservableCollection||this.attributes[c]instanceof d.models.ObservableModel?this.attributes[c].toJSON():this.attributes[c];return b}}}))})(toa);(function(d){var c=d.models.ObservableModel;d.ns("toa.CompanySettings.Flows.models.Parameter",d.define(c,function(b){c.apply(this,arguments)},{idField:"parameter_id",setParameters:function(b){this.params=b}}))})(toa);(function(d){var c=d.models.ObservableModel;d.ns("toa.CompanySettings.Flows.models.Language",d.define(c,function(){c.apply(this,arguments)}))})(toa);(function(d){var c=d.CompanySettings.Flows.models.BaseLayoutItem;d.ns("toa.CompanySettings.Flows.models.BaseField",d.define(c,function(b){c.apply(this,arguments);this.predefineGui()},{idField:"item_id",_defaultType:"field",_defaultEntity:1,_guiTypes:"combobox radiogroup input checkbox image file signature geolocation".split(" "),_defaultGuiType:"input",_enumerationGuiTypes:["combobox","radiogroup"],_inputGuiTypes:["input","text","url","phone","email"],_datetimeGuiTypes:["datepicker","timepicker",
"datetimepicker"],_defaultEnumerationGuiType:"combobox",predefineGui:function(){var b=!1;"list"===this.getGuiType()&&(b=this._defaultEnumerationGuiType);"capture_image"===this.getGuiType()&&(b="image");b&&this.set({gui:b},{silent:!0})},getGuiType:function(){return this.get("gui",this._defaultGuiType)},getEntity:function(){return parseInt(this.get("entity",this._defaultEntity),10)},getBarcodeFlag:function(){return this.get("scanner",0)},supportsValueVisibility:function(){return"user_type_id"===this.get("label")?
!1:this.isEnumeration()},isField:function(){return"field"===this.getType()},isProperty:function(){return"property"===this.getType()},isFormElement:function(){return"flow_element"===this.getType()},getPropertyId:function(){return this.get("property_id",!1)},isEnumeration:function(b){b=b||this.getGuiType();return-1!==$.inArray(b,this._enumerationGuiTypes)},isBarcode:function(b){b=b||this.getGuiType();return-1!==$.inArray(b,this._inputGuiTypes)},isDateTime:function(b){b=b||this.getGuiType();return-1!==
$.inArray(b,this._datetimeGuiTypes)},toJSON:function(){var b=c.prototype.toJSON.apply(this,arguments);"lookups"in this.attributes&&delete b.lookups;return b}}))})(toa);(function(d){var c=d.CompanySettings.Flows.models.BaseField;d.ns("toa.CompanySettings.Flows.models.AvailableField",d.define(c,function(b){c.apply(this,arguments)},{isAllowed:function(){return!0},getName:function(){var b=this.get("names"),c=d.app.model("companySettings").getUser().ulanguage,g;for(g in b.models)if(c==b.models[g].id)return b.models[g].get("name");return""},hasLookups:function(){return 0<this.getLookups().length},getLookups:function(){return this.get("lookups",[])},isDisabledCondition:function(){return this.isFormElement()&&
!0!==this.get("canBeUsedInCondition")}}))})(toa);
(function(d){var c=d.models.ObservableCollection;d.ns("toa.CompanySettings.Flows.models.collection.AvailableFields",d.define(c,function(){c.apply(this,arguments)},{modelConstructor:d.CompanySettings.Flows.models.AvailableField,toString:function(){return"Available Fields collection"},getFirst:function(){var b,c=this.getCount();for(b=0;b<c;b++)if(this.isCanBeUsedInCondition(this.models[b]))return this.models[b];return null},isCanBeUsedInCondition:function(b){return"flow_element"===b.get("type")&&b.get("canBeUsedInCondition")||
"flow_element"!==b.get("type")?!0:!1},getFirstWithCondition:function(b){b=b||!1;var c=!1,d=this.getCount()||0,k,l=0;if(d){do k=this.models[l],k instanceof this.modelConstructor&&k.get("condition",0)&&(!b||!k.isDisabledCondition())&&(c=k),l+=1;while(!c&&l<d)}return c},getByLabel:function(b){return this.models.find(function(c){return c.get("label")===b})},getByLabelEntity:function(b,c){var d,k=this.getCount();for(d=0;d<k;d++)if(this.models[d].get("label")==b&&this.models[d].get("entity")==c)return this.models[d];
return null},getPropertyByLabel:function(b){var c,d=this.getCount();for(c=0;c<d;c++)if((this.models[c].isField()||this.models[c].isProperty())&&this.models[c].getLabel()===b)return this.models[c];return null},getPropertyById:function(b){var c,d=this.getCount();for(c=0;c<d;c++)if((this.models[c].isField()||this.models[c].isProperty())&&this.models[c].getId()===b)return this.models[c];return null},getConditionFields:function(){var b,c=[],d=this.getCount();for(b=0;b<d;b++)this.models[b].get("condition",
0)&&c.push(this.models[b]);return c},comparator:function(b,c){var d,k;d=b.getName();k=c.getName();return d<k?-1:d>k?1:0},load:function(b){var c,d=b.length;for(c=0;c<d;c++)-1===this.indexOf(b[c])&&this.add(b[c],{silent:!0,doNotAutoSort:!0});this.sort({silent:!0});this.notify("load")},defineUnusedFormElements:function(b){b.get("items")&&b.get("items").each(function(b){b.get("items")?this.defineUnusedFormElements(b):"flow_element"===b.get("type")&&null!==this.getByLabel(b.get("label"))&&this.getByLabel(b.get("label")).set({canBeUsedInCondition:!0})}.bind(this))}}))})(toa);(function(d){var c=d.models.ObservableModel;d.ns("toa.CompanySettings.Flows.models.ConditionDictionary",d.define(c,function(b){c.apply(this,arguments)},{systemIdField:"_id",get:function(b){return this.attributes[this.idField]},_setOneField:function(b,c,d){d=0<Object.keys(d).length?d:{};switch(b){case "value":d.value=c;break;case "condition":d.condition=c;break;case "property_id":d.property_id=c;break;case "field":d.field=c;break;case "entity":d.entity=c}return d},__getValue:function(){return this.attributes.hasOwnProperty(this.idField)?
this.attributes[this.idField]:null},set:function(b,c){var d,k,l={};for(d in b)k=b[d],l=this._setOneField(d,k,l);this.attributes[this.idField]=l},getData:function(){return this.attributes[this.idField]}}))})(toa);(function(d){var c=d.models.ObservableModel;d.ns("toa.CompanySettings.Flows.models.TmpConditionDictionary",d.define(c,function(b){c.apply(this,arguments)},{idField:"",getData:function(){return this.attributes},setDictionaryIndex:function(b){this.set({dictionaryIndex:b},{silent:!0})},getDictionaryIndex:function(){return this.get("dictionaryIndex",!1)},clear:function(){this.attributes={}}}))})(toa);(function(d){var c=d.models.ObservableCollection;d.ns("toa.CompanySettings.Flows.models.collection.Languages",d.define(c,function(){c.apply(this,arguments)},{modelConstructor:d.CompanySettings.Flows.models.Language,toString:function(){return"Fields model"},load:function(b){var c,d=b.length;for(c=0;c<d;c++)-1==this.indexOf(b[c])&&this.add(b[c],{silent:!0,doNotAutoSort:!0});this.sort({silent:!0});this.notify("load")}}))})(toa);(function(d){var c=d.models.ObservableCollection;d.ns("toa.CompanySettings.Flows.models.collection.Translations",d.define(c,function(){c.apply(this,arguments)},{modelConstructor:d.CompanySettings.Flows.models.Translation,toString:function(){return"Fields model"},load:function(b){for(var c in b)this.add(b[c],{silent:!0,doNotAutoSort:!0});this.sort({silent:!0});this.notify("load")},toJSON:function(){var b=[];this.each(function(c){(c=c.toJSON())&&b.push(c)});return b}}))})(toa);(function(d){var c=d.models.ObservableCollection;d.ns("toa.CompanySettings.Flows.models.collection.ConditionsDictionary",d.define(c,function(){c.apply(this,arguments)},{modelConstructor:d.CompanySettings.Flows.models.ConditionDictionary,collectionConditionFields:null,toString:function(){return"ConditionsDictionary model"},load:function(b){var c;if(b){for(c in b)-1==this.indexOf(b[c])&&this.add(b[c],{silent:!0,doNotAutoSort:!0});this.notify("load")}},getConditions:function(){var b=[],c;for(c in this.models)b.push(this.models[c].get("id"));
return b}}))})(toa);(function(d){var c=d.models.ObservableCollection;d.ns("toa.CompanySettings.Flows.models.collection.TmpConditionsDictionary",d.define(c,function(){c.apply(this,arguments)},{modelConstructor:d.CompanySettings.Flows.models.TmpConditionDictionary,collectionConditionFields:null,toString:function(){return"ConditionsDictionary model"},load:function(b){var c;if(b){for(c in b)if(-1==this.indexOf(b[c])){var d=new this.modelConstructor(b[c]);this.add(d,{silent:!0,doNotAutoSort:!0})}this.notify("load")}}}))})(toa);(function(d){var c=d.CompanySettings.Flows.models.BaseCollection;d.ns("toa.CompanySettings.Flows.models.collection.StepCollection",d.define(c,function(){c.apply(this,arguments)},{findIndex:function(b){return this.models.findIndex(function(c){return c.isEqual(b)})},isFirst:function(b){return 0===this.findIndex(b)},isNotFirst:function(b){return!this.isFirst(b)},isTheLast:function(b){return this.findIndex(b)===this.models.length-1},remove:function(b){b=c.prototype.remove.call(this,b);this.models.forEach(function(b,
c){b.set({order:c})});return b}}))})(toa);(function(d,c){d.ns("toa.CompanySettings.Flows.DataMapper",d.define(null,function(b){this._serverConnector=b},{_modelConstructor:function(){},_serverGetMethod:"",_serverSaveMethod:"",_serverRemoveMethod:"",_serverGetField:"",_serverIdField:"",load:function(b,c){c=c||{};this._serverIdField&&(c[this._serverIdField]=b.id);var d=this;return this._serverConnector.request(this._serverGetMethod,c).then(function(c){if(!c||!c[d._serverGetField])return Promise.reject('Field "'+d._serverGetField+'" is not available');
try{return d._fillModel(b,c[d._serverGetField])}catch(e){return Promise.reject("Unable to fill model with given data ("+e.message+")")}})},create:function(b){var c=new this._modelConstructor;this._fillModel(c,b||{});return c},save:function(b){return this._serverConnector.request(this._serverSaveMethod,this.serialize(b))},remove:function(b){var c={};this._serverIdField&&(c[this._serverIdField]=b.id);return this._serverConnector.request(this._serverRemoveMethod,c)},_fillModel:function(b,c){b.reset({},
{silent:!0});b.set(c,{silent:!0});return b},serialize:function(b){return b.toJSON()}}))})(toa,$);(function(d){var c=d.CompanySettings.Flows.DataMapper;d.ns("toa.CompanySettings.Flows.dataMappers.BaseDataMapper",d.define(c,function(b){c.apply(this,arguments)},{_modelConstructor:d.CompanySettings.Flows.models.BaseModel}))})(toa);(function(d){var c=d.CompanySettings.Flows.DataMapper;d.ns("toa.CompanySettings.Flows.dataMappers.InitialDataMapper",d.define(c,function(b){c.apply(this,arguments)},{_modelConstructor:d.CompanySettings.Flows.models.BaseModel,_serverGetMethod:"getInitialData",_serverGetField:"initial_data",_serverGetStatsMethod:"getStatistics",_serverStatsField:"statistics",_serverIdField:"label"}))})(toa);(function(d,c){var b=d.CompanySettings.Flows.DataMapper;d.ns("toa.CompanySettings.Flows.dataMappers.CollectionDataMapper",d.define(b,function(c,d){b.apply(this,arguments);this._itemMapper=d},{_modelConstructor:d.CompanySettings.Flows.models.BaseCollection,create:function(b){var c=new this._modelConstructor;this._comparator&&"function"===typeof this._comparator&&(c.comparator=this._comparator);this._fillModel(c,b||{});return c},_fillModel:function(b,d){b.clear({silent:!0});c.each(d,function(c,d){var g=
this._itemMapper.create(d);b.add(g,{silent:!0})}.bind(this))},serialize:function(b){var c=[];b.each(function(b){c.push(this._itemMapper.serialize(b))},this);return c}}))})(toa,$);(function(d,c){var b=d.CompanySettings.Flows.dataMappers.CollectionDataMapper;d.ns("toa.CompanySettings.Flows.dataMappers.FlowsListDataMapper",d.define(b,function(c,d){b.apply(this,arguments)},{_modelConstructor:d.CompanySettings.Flows.models.BaseCollection,_serverGetMethod:"getList",_serverGetField:"flows"}))})(toa,$);(function(d){var c=d.CompanySettings.Flows.DataMapper;d.ns("toa.CompanySettings.Flows.dataMappers.FlowDataMapper",d.define(c,function(b){c.apply(this,arguments)},{_modelConstructor:d.CompanySettings.Flows.models.Flow,_serverGetMethod:"getFlow",_serverSaveMethod:"createFlow",_serverRemoveMethod:"deleteFlow",_serverUpdateMethod:"updateFlow",_serverIdField:"label",_serverGetField:"flow",save:function(b,d){this._serverSaveMethod="createFlow";"update"===d&&(this._serverSaveMethod="updateFlow");return c.prototype.save.apply(this,
arguments)}}))})(toa);(function(d,c){var b=d.CompanySettings.Flows.dataMappers.CollectionDataMapper;d.ns("toa.CompanySettings.Flows.dataMappers.FlowStepsListDataMapper",d.define(b,function(c,d){b.apply(this,arguments)},{_modelConstructor:d.CompanySettings.Flows.models.collection.StepCollection,_serverGetMethod:"getSteps",_serverGetField:"steps",_serverIdField:"step_id",_serverSaveMethod:"updateSteps",serialize:function(b){var c=[];b.each(function(b){delete b.attributes.escapeHtml;delete b.attributes.getTranslation;c.push(this._itemMapper.serialize(b))},
this);return{steps:c,label:this.flowId}},setFlowId:function(b){this.flowId=b}}))})(toa,$);(function(d){var c=d.CompanySettings.Flows.DataMapper;d.ns("toa.CompanySettings.Flows.dataMappers.FlowStepDataMapper",d.define(c,function(b){c.apply(this,arguments)},{_modelConstructor:d.CompanySettings.Flows.models.Step,_serverGetMethod:"getSteps",_serverSaveMethod:"updateSteps",_serverIdField:"label",_serverGetField:"flow"}))})(toa);(function(d){d.ns("toa.CompanySettings.Flows.classes.factory",{initializeAvailableFieldCollection:function(c){this.collectionAvailableFields=new d.CompanySettings.Flows.models.collection.AvailableFields;this.collectionAvailableFields.load(this.unique(c,"property_id"))},getAvailableFieldCollection:function(){return this.collectionAvailableFields},getAvailableParametersCollection:function(){this.collectionAvailableParameters||(this.collectionAvailableParameters=new d.CompanySettings.Flows.models.collection.AvailableFields);
return this.collectionAvailableParameters},getExpressionManager:function(){this.objectExpression||(this.objectExpression=new d.CompanySettings.Flows.classes.ExpressionManager,this.objectExpression.initLookups(this.collectionAvailableFields));return this.objectExpression},getEntitiesCollection:function(){if(!this.collectionEntites){this.collectionEntites=new d.models.ObservableCollection;var c=this.initialLookups.get("entity");if(!1===!(!c||!c.length))return;$.each(c,function(b,c){this.collectionEntites.add(c)}.bind(this))}return this.collectionEntites},
getLanguagesCollection:function(){this.collectionLanguages||(this.collectionLanguages=new d.CompanySettings.Flows.models.collection.Languages);return this.collectionLanguages},setInitialLookups:function(c){this.initialLookups=c;this.initializeAvailableFieldCollection(this.initialLookups.get("fields"))},getInitialLookups:function(){return this.initialLookups},unique:function(c,b){var d=[],g=[],k;for(k in c){var l=c[k],n=l[b];-1<d.indexOf(n)||(d.push(n),g.push(l))}return g}})})(toa);(function(d){var c=new d.CompanySettings.Flows.constants;d.ns("toa.CompanySettings.Flows.service.TranslationService",d.define(null,function(){var b=d.CompanySettings.Flows.classes.factory.getInitialLookups().get("languages");this.languagesMap={};for(var c in b)b.hasOwnProperty(c)&&(this.languagesMap[b[c].label]=b[c].id)},{DEFAULT_LANG_ID:1,getNameTranslation:function(b){var c=this.getUserLanguage(),d=this.isFlowModel(b)?b.get("name"):Object.assign({},b.get("name"));if(this.isStepModel(b)){var k=this.getTransformedTranslations(b.get("target").type,
b.get("target").label);"undefined"===typeof d&&(d={});for(var l in k)"undefined"===typeof d[l]&&(d[l]=k[l])}return"string"===typeof d&&"undefined"!==typeof b.get("translations")?(d=b.get("translations"),"undefined"!==typeof d[c]&&""!==d[c]?d[c]:d[this.DEFAULT_LANG_ID]):"string"===typeof d?d:"object"===typeof d?"undefined"!==typeof d[c]&&""!==d[c].text?d[c].text:"undefined"!==typeof d[this.DEFAULT_LANG_ID]?d[this.DEFAULT_LANG_ID].text:"":""},getTransformedTranslations:function(b,e){var g={},k=d.CompanySettings.Flows.classes.factory.getInitialLookups(),
l=k.get(c.TARGET_TYPE_IDS_LOOKUP_KEYS_MAP[b]),k=k.get("languages"),n=this.getTranslations(e,b,l,!1);if(0===Object.keys(n).length)this.getTranslations(e,b,l,!0);else for(var p in k)k.hasOwnProperty(p)&&(l=k[p].id,g[l]={text:this.getTmpName(n,l).trim()});return g},getTranslations:function(b,d,g,k){if(!b)return[];var l=[],n;for(n in g)if(g.hasOwnProperty(n)){var p=Number(d)===c.TARGET_TYPE_FORM?g[n].name:g[n].text;if(k&&p.toString()===b.toString()||g[n].label.toString()===b.toString()){l=g[n].translations;
break}}return l},getUserLanguage:function(){var b=this.getLanguageData();return this.languagesMap[b.htmlLang]===b.jsLang?b.jsLang:this.languagesMap[b.htmlLang]},checkLanguageConsistency:function(){var b=this.getLanguageData(),c=this.languagesMap[b.htmlLang]===b.jsLang;c||(d.app.model("companySettings").getUser().ulanguage=this.languagesMap[b.htmlLang]);return c},getLanguageData:function(){return{htmlLang:document.getElementsByTagName("html")[0].getAttribute("lang"),jsLang:d.app.model("companySettings").getUser().ulanguage||
this.DEFAULT_LANG_ID}},getTmpName:function(b,c){return"undefined"!==typeof b[c]&&0<b[c].length?b[c]:b[(new d.CompanySettings.Flows.service.TranslationService).DEFAULT_LANG_ID]},isFlowModel:function(b){return d.CompanySettings.Flows.models.Flow.prototype.isPrototypeOf(b)},isStepModel:function(b){return d.CompanySettings.Flows.models.Step.prototype.isPrototypeOf(b)}}))})(toa);(function(d){var c=new d.CompanySettings.Flows.service.DefaultConditionsManager;d.ns("toa.CompanySettings.Flows.classes.ExpressionManager",d.define(null,function(){},{idMap:{},propertyMap:{},enumPropertiesMap:{},entityMap:{1:"activity",2:"inventory",3:"resource",5:"request",9:"user",11:""},numberRegEx:RegExp(/^(([1-9]\d*)|0)((\.\d*[1-9])|)$/),initLookups:function(b){var c=["aworktype","invtype","srtype","ptype","user_type_id"];b.each(function(b){var d=b.get("entity",""),l=b.get("property_id",""),
n=b.get("label","");d&&l&&n&&("undefined"===typeof this.propertyMap[d]&&(this.propertyMap[d]={}),this.propertyMap[d][l]=n,-1!==$.inArray(n,c)&&"undefined"!==b.get("lookups")&&(this.idMap[n]={},$.each(b.get("lookups",[]),function(b,c){var d=c.id+"";this.idMap[n][d]=c.label||d}.bind(this))),"undefined"!==typeof b.get("lookups")&&""!==b.get("lookups")&&(this.enumPropertiesMap[n]=1))}.bind(this))},conditionsToExpression:function(b,d){var g=b.map(function(b){var g=b.entity||null,n=b.field?b.field+"":"",
p=b.condition,s=b.value;if(!this.entityMap.hasOwnProperty(g)&&null!==g)throw Error("Entity "+g+" is not recognized");var t="",t=d.get("target").label;c.isConditionDefault(b)&&t||("property"===n?(t=b.property_id||"",t=this.propertyMap[g]&&this.propertyMap[g][t]||t):t=this.propertyMap[g]&&this.propertyMap[g][n]||n);"user_type_id"===t&&(t="type");var g=null!==g&&this.entityMap[g]&&""!==this.entityMap[g]?this.entityMap[g]+".":"",g=g+("`"+t+"`"),u="";switch(p){default:throw Error("Unknown condition type: "+
b);case "in":case "not_in":u=g+" IN ("+this._toArguments(n,s)+")";break;case "contains":case "dcontain":u=this._makeContainsSection(t,g,s);break;case "is_null":case "is_not_null":u="empty("+g+")"}"aworktype"===n&&(u="("+u+" OR "+u.replace(RegExp(n,"g"),n+"_group")+")");switch(p){case "not_in":case "dcontain":case "is_not_null":u="NOT "+u}return u}.bind(this));return 0<g.length?"("+g.join(")\nAND\n(")+")":null},_makeContainsSection:function(b,c,d){var k="";if(this._isEnumProperty(b)){b=[];d=d.split(",");
for(var l in d)d.hasOwnProperty(l)&&b.push(c+" CONTAINS "+this._toStringLiteral(c,d[l]));k="(\n"+b.join(" OR \n")+"\n)"}else k=c+" CONTAINS "+this._toStringLiteral(c,d);return k},_toStringLiteral:function(b,c){c=c?(c+"").trim():"";if(this.idMap.hasOwnProperty(b)){var d=this.idMap[b];d.hasOwnProperty(c)&&(c=d[c]+"")}return this.numberRegEx.test(c)?c:this._putInQuotesAndEscape(c)},_toArguments:function(b,c){return(c?c+"":"").split(",").map(this._toStringLiteral.bind(this,b)).join(", ")},_isEnumProperty:function(b){return"undefined"!==
typeof this.enumPropertiesMap[b]},_escapeQuotes:function(b){return b.replace(/'/g,"\\'")},_putInQuotesAndEscape:function(b){return"'"+this._escapeQuotes(b)+"'"},destroy:function(){this.idMap={};this.propertyMap={}}}))})(toa);(function(d){d.ns("toa.CompanySettings.Flows.classes.HtmlHelper",d.define(null,function(){},{escapeHtml:function(c){var b=document.createTextNode(c);c=document.createElement("p");c.appendChild(b);b=c.innerHTML;c.remove();return b}}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.Flows.view.Import.FileUploadForm",d.define(c,function(){c.apply(this,arguments)},{events:{"change .import-form-file":"onChangeFileUpload"},onChangeFileUpload:function(b){b=b.target.value.replace(/^.*[\\\/]/,"");if(!b)return!1;var c=this._container.find(".import-form-fileText"),d=b.split(".").pop();c.val(b);this.model.set({fileType:"json"===d?"application/json":d,fileName:b});return!1},getFileType:function(){return this.model.get("fileType")},
getFileName:function(){return this.model.get("fileName")},template:'<form class="content-import-form" action="?controller=flowconfiguration&amp;method=importFlowContent" enctype="multipart/form-data" method="POST"><input type="hidden" name="flowId" value="<%- flowId %>" id="lbl_flowId" /><input type="hidden" name="flowLabel" value="<%- flowLabel %>" id="lbl_flowLabel" /><div class="import-form-row" id="lbl_fileImport"><div class="import-form-label"><abbr class="asterisk asterisk-no-margin import-form-mandatory-field ofsc-abbr-mandatory" title="<%= h(22958 /* required */) %>">*</abbr><%= h(22959 /* Choose file */) %></div><div class="import-form-pseudo-file"><input aria-label="Import form file" aria-labelledby="lbl_fileImport" tabindex="0" type="text" class="import-form-fileText"><input aria-label="File import" aria-labelledby="lbl_fileImport" tabindex="0" required type="file" name="fileImport" accept=".json, application/json" size="1" class="import-form-file"><input type="button" class="toa-button flow-import-button" tabindex="0" value="<%= h(22960 /* Browse... */) %>" ></div><br></div></form>'}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.Flows.view.Import.FileUploadStatusForm",d.define(c,function(){c.apply(this,arguments)},{template:'<div class="import_popup import_user_types form-import"><div><strong><%= h(22972 /* Details: */) %></strong></div><div class="content"><div class="form-import-statistics"><table><tr><td><%= h(22969 /* Number of errors: */) %></td><td><%- countErrors %></td></tr><tr><td><%= h(22970 /* Number of warnings: */) %></td><td><%- countWarnings %></td></tr><tr><td><%= h(22971 /* Number of notices: */) %></td><td><%- countNotices %></td></tr><tr><td colspan="2"><strong class="status-<%- status %>"><%= h(processStatus) %></strong></td></tr></table></div></div><div><strong><%= h(22973 /* Validation log: */) %></strong></div><div class="content"><div class="form-import-validation-log-wrapper"><div class="form-import-validation-log"></div></div></div></div>',
templateProcessLogItem:new d.Template('<div class="import-log-node <%- type %>">;<h5><%- r(message.tid, message.lookup) %></h5>;<% if (snippet) { %>;<pre><%- snippet %></pre>;<% } %>;</div>'.split(";")),render:function(){c.prototype.render.apply(this,arguments);this.logContainer=this.getElement().find(".form-import-validation-log");this.renderProcessLog();return this},renderProcessLog:function(){this.logContainer.empty();$.each(this.model.get("processLog",[]),function(b,c){var d=$(this.templateProcessLogItem.apply({type:c.type||
"",message:c.message||{},snippet:c.snippet||null}));this.logContainer.append(d)}.bind(this))}}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.Flows.view.Import.ImportFileUpload",d.define(c,function(b){this.flowId=b.id;this.flowLabel=b.label;this._defaultErrorMessage=h(22955);c.apply(this,arguments)},{render:function(){return!1},glossary:{title:h(226918),dismiss:h(22953),import:h(22954)},show:function(){this.model=new d.models.BaseModel({flowId:this.flowId,flowLabel:this.flowLabel});this.fileUploadForm=d.create("toa.CompanySettings.Flows.view.Import.FileUploadForm",{model:this.model});
this.popup=new d.ui.Popup({title:this.glossary.title,view:this.fileUploadForm,popup_extra_css_class:"flow_popup",height:"200px",autoOpen:!0,modal:!0,buttons:[{id:"validate_btn",text:this.glossary.import,type:"submit",position:"right",attr:{tabindex:0},click:this.submitUploadForm.bind(this)},{text:this.glossary.dismiss,position:"right",click:this.closeForm.bind(this),attr:{tabindex:0}}],onClose:this.closeForm.bind(this)});this.popup.setPositionCenter();$(window).bind("keydown.import",this.onKeydown.bind(this));
return this},getImportData:function(){return $(this.popup.getDomContent()).find("form.content-import-form")[0]},submitUploadForm:function(){this.setPopupButtonDisabled("validate_btn",!0,!0);if(this.validateForm())return ajaxForm(this.getImportData(),{responseHandler:this.onSubmitUploadResponse.bind(this),errorHandler:this.onSubmitUploadResponse.bind(this)}),!1;this.setPopupButtonDisabled("validate_btn",!1,!0)},onSubmitUploadResponse:function(b){if(b&&b.status&&"ERR"!==b.status)"NOT_UPLOADED"===b.status?
(c=b.errorMsg||(b.errorCode?h(b.errorCode):""),this.showUploadError(c)):(this.model.set({fileName:b.fileName||"",status:b.status||"",processStatus:b.processStatus||"",processLog:b.processLog||[],countErrors:b.countErrors||0,countWarnings:b.countWarnings||0,countNotices:b.countNotices||0}),this.notify("import.validate",this.model),this.closeForm());else{var c=null;"undefined"!==typeof b.error_code&&0<b.error_code&&(c=h(b.error_code));this.showUploadError(c)}},onSubmitUploadError:function(){this.showUploadError()},
showUploadError:function(b){b=b||this._defaultErrorMessage;this.setErrorMessages([b]);this.setPopupButtonDisabled("validate_btn",!1,!0)},setPopupButtonDisabled:function(b,c,d){if(!this.popup.hasOwnProperty("_dom")||null!=this.popup._dom)if(b=this.popup._dom.buttons[b])$(b).toggleClass("toa-button-disable",c),d&&c?$(b).removeClass("toa-button-active"):d&&!c&&$(b).addClass("toa-button-active")},validateForm:function(){var b=[];this.fileUploadForm.getFileName()?"application/json"!=this.fileUploadForm.getFileType()&&
b.push(h(18330)):b.push(h(22956));this.setErrorMessages(b);return 0==b.length},setErrorMessages:function(b){if(1>b.length)return this.popup.removeErrors(),!1;for(var c=0,d=[];c<b.length;c++)d.push({id:c+1,message:b[c]});this.clearErrors();this.showErrors(d)},clearErrors:function(){$(".error",this.$el).remove();return this},showErrors:function(b){$.each(b,function(b,c){$(".import-form-pseudo-file",this.$el).append('<span class="error import-error">'+c.message+"</span>")}.bind(this));return this},onKeydown:function(b){13!=
b.keyCode||this.popup.isDestroyed||this.submitUploadForm()},closeForm:function(){this.popup.destroy()},destroy:function(){$(window).unbind("keydown.import");this.popup=null}}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.Flows.view.Import.ImportFileUploadStatus",d.define(c,function(){c.apply(this,arguments)},{render:function(){return!1},glossary:{fileTitle:function(b){return r(226917,b)},title:h(226918),dismiss:h(13305)},show:function(){var b=this.model.get("fileName",""),b=b?this.glossary.fileTitle({"{FILE_NAME}":b}):this.glossary.title;this.importView=d.create("toa.CompanySettings.Flows.view.Import.FileUploadStatusForm",{model:this.model});this.popup=
new d.ui.Popup({title:b,popup_extra_css_class:"flow_popup",autoOpen:!0,modal:!0,view:this.importView,buttons:[{id:"close_btn",text:this.glossary.dismiss,display:!0,type:"submit",position:"right",click:this.closeForm.bind(this)}],onClose:this.closeForm.bind(this)});this.popup.setPositionCenter();$(this.popup._dom.buttons.close_btn).removeClass("toa-button-active");return this},closeForm:function(){this.notify("import.finish");this.popup.destroy()},destroy:function(){this.popup=null}}))})(toa);(function(d){var c=d.views.BaseView,b=new d.CompanySettings.Flows.classes.HtmlHelper;d.ns("toa.CompanySettings.Flows.view.FlowDetailsView",d.define(c,function(){c.apply(this,arguments);this.setDefaultState()},{events:{'click button[name="flow-dismiss"]':"onFlowDismiss",'click button[name="flow-save"]':"onFlowSave"},template:'<div class="flow-details section"><div class="oj-flex details"><div class="flow-details-item oj-flex-item oj-sm-7"><span class="value-label text-muted"><%= h(225780) /* Workflow conditions */ %></span><span class="toa-flow-details-conditions"><%= escapeHtml(conditions) %></span></div><div id="flowDetailsActions" class="oj-flex-item oj-sm-5 right"><oj-menu-button chroming="borderless"><oj-bind-text value="[[buttonText]]"></oj-bind-text><oj-menu class="flow-menu-button" slot="menu" on-oj-action="[[menuItemAction]]"><oj-bind-for-each data="[[menuItems]]"><template><oj-option value="[[$current.data.value]]" disabled="[[$current.data.disabled]]"><span><oj-bind-text value="[[$current.data.label]]"></oj-bind-text></span></oj-option></template></oj-bind-for-each></oj-menu></oj-menu-button><div class="flow-actions toa-hidden"><button class="button dismiss" name="flow-dismiss"><%= h(225793 /* Discard */) %></button><button class="button submit" name="flow-save"><%= h(12 /* Save */) %></button></div></div></div></div>',
render:function(){this.model.set({escapeHtml:function(c){return b.escapeHtml(c)}});c.prototype.render.apply(this,arguments);this.renderFlowDetailsActions();return this},onFlowDetailsMenuItemClick:function(b){switch(b.target.value){case "actionImport":this.notify("flow_details:import");return;case "actionExport":this.notify("flow_details:export");return}this.notify("flow_details:modify",this.model)},setFlowMapper:function(b){this.flowMapper=b},setState:function(b,c){d.isString(b)?this.state[b]=c:d.isObject(b)?
$.extend(this.state,b):!1===b&&this.setDefaultState()},renderFlowDetailsActions:function(){var b=this;require(["knockout","ojs/ojknockout","ojs/ojbutton","ojs/ojmenu"],function(c){c.applyBindings(new function(){this.buttonText=h(11925);this.disabledValue=c.observableArray();this.menuItemAction=b.onFlowDetailsMenuItemClick.bind(b);this.menuItems=[{value:"actionModify",label:h(19136),disabled:b.options.readOnlyMode},{value:"actionImport",label:h(225759),disabled:b.options.readOnlyMode},{value:"actionExport",
label:h(225760),disabled:b.options.readOnlyMode}]},document.getElementById("flowDetailsActions"))})},updateFlowConditions:function(){this.getElement().find(".toa-flow-details-conditions").text(b.escapeHtml(this.model.get("conditions")))},getState:function(b){return this.state[b]},setDefaultState:function(){this.state=$.extend(this.state,{currentFlowModel:null,allowModify:!1,newFlow:!1})},getCurrentFlowId:function(){return this.getState("currentFlowModel").getId()},onFlowDismiss:function(b){this.notify("flow-action:flow-dismiss",
b,this);b.preventDefault();b.stopPropagation();return!1},onFlowSave:function(b){this.notify("flow-action:flow-save",b,this);b.preventDefault();b.stopPropagation();return!1},showFlowActions:function(){this.getElement().find(".flow-actions").removeClass("toa-hidden")},hideFlowActions:function(){this.getElement().find(".flow-actions").addClass("toa-hidden")},enableFlowActions:function(){this.getElement().find(".flow-actions button").removeAttr("disabled")},disableFlowActions:function(){this.getElement().find(".flow-actions button").prop("disabled",
!0)}}))})(toa);(function(d){var c=d.views.BaseView,b=new d.CompanySettings.Flows.classes.HtmlHelper;d.ns("toa.CompanySettings.Flows.view.flowList.ListItem",d.define(c,function(){c.apply(this,arguments)},{events:{"click .flow-item":"selectFlow","keypress .flow-item":"selectFlow"},template:'<li class="flow-item" tabindex="0" role="button"><div class="flow-item-content"><div class="flow-item-details"><span class="flow-item-name" title="<%= escapeHtml(getTranslation()) %>"><%= escapeHtml(getTranslation()) %></span><span class="flow-item-label text-muted"><%- label %></span></div><div class="spacer"></div><div class="stats"><span class="steps-amount"><%- steps %></span><span class="steps"> <%= h(19102)/* Steps */ %></span><span class="flow-status"><% if(getStatus() != "active"){ %><%= h(18281) /* Inactive */ %><% } %></span></div><input name="flow-item" type="radio" class="toa-hidden" value="<%- label %>" /></div></li>',
render:function(){var e=this;this.model.set({getTranslation:function(){return(new d.CompanySettings.Flows.service.TranslationService).getNameTranslation(e.model)}});this.model.set({escapeHtml:function(c){return b.escapeHtml(c)}});this.model.set({getStatus:function(){return"active"===e.model.attributes.status?"active":"inactive"}});c.prototype.render.apply(this,arguments);return this},selectFlow:function(b){"keypress"===b.type&&13!==b.keyCode||this._$el.hasClass("toa-disable-click")||("undefined"===
typeof b.isTrigger?this.notify("flow-action:select",this.model.getId()):this.notify("flow-action:select-by-trigger",this.model.getId()),b.stopPropagation(),b.preventDefault())}}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.Flows.view.flowList.NoListItems",d.define(c,function(){c.apply(this,arguments)},{template:'<li class="empty-no-flows"><%= h(225773)/* No workflows yet configured. Start by adding a new workflow. */ %></li>'}))})(toa);(function(d){var c=d.views.BaseCollectionView;d.ns("toa.CompanySettings.Flows.view.flowList.ListView",d.define(c,function(){c.apply(this,arguments);this.selectedView=null},{events:{'click button[name="flow-add"]':"onAddFlow",'click button[name="flow-remove"]:not(.toa-disabled)':"onRemoveFlow"},childView:d.CompanySettings.Flows.view.flowList.ListItem,childRegion:".flowList",noItemsView:d.CompanySettings.Flows.view.flowList.NoListItems,template:'<div class="flows-list"><div class="flows-list-holder"><div class="controls"><% if (!isReadOnly) { %><button tabindex="0" title="<%= h(21040) /*Add new*/ %>" name="flow-add" class="button-icon"></button><button tabindex="0" title="<%= h(22626) /* Remove*/ %>" name="flow-remove" class="button-icon <%- removeInactive %>"></button><% } %></div><ul class="flowList"></ul></div></div>',
onAddFlow:function(b){this.notify("flow-action:add",b,this);b.preventDefault();b.stopPropagation();return!1},onRemoveFlow:function(b){this.notify("flow-action:remove",b,this);b.preventDefault();b.stopPropagation();return!1},render:function(){this.model=new d.models.ObservableModel;this.model.set({removeInactive:0===this.options.collection.models.length?"toa-disabled":"",isReadOnly:this.options.readOnlyMode});c.prototype.render.apply(this,arguments);return this},highlightSelected:function(b){this._childViews.forEach(function(b){b._$el.removeClass("selected")});
b._$el.addClass("selected");this.selectedView=b;b.getElement().focus()},lockChildClickEvent:function(){this._childViews.forEach(function(b){b._$el.addClass("toa-disable-click")})},unlockChildClickEvent:function(){this._childViews.forEach(function(b){b._$el.removeClass("toa-disable-click")})},getActiveItem:function(){return this.selectedView&&this.selectedView.model?this.selectedView.model:null},getViewIndexByModel:function(b){var c=b?b.getId():-1;return this._childViews.findIndex(function(b){return b.model.getId()===
c})},setActiveItem:function(b,c,d){b=this.getViewIndexByModel(b);-1<b&&this._childViews[b]&&(c?this.highlightSelected(this._childViews[b]):this._childViews[b]._$el.trigger("click"),d&&this.scrollToItem(this._childViews[b]));return b},checkFlowDetailsConsistency:function(b){var c=this.getActiveItem();if(c=this.isSyncNeeded(c,b)){var d=this.getViewIndexByModel(b),d=this._childViews[d],k=d.getElement();if(c.status){d.model.set({status:b.get("status")});var l=$(k.find(".flowStatus")[0]);l.hasClass("active")?
l.removeClass("active"):l.addClass("active")}c.name&&(d.model.set({name:b.get("name")}),k.find(".flow-item-name").text(b.get("name")));c.steps&&(d.model.set({steps:b.get("steps")}),k.find(".stats .steps-amount").text(b.get("steps")))}},isSyncNeeded:function(b,c){var d=b.get("status")!==c.get("status"),k=b.get("name")!==c.get("name"),l=b.get("steps")!==c.get("steps");return d||k||l?{status:d,name:k,steps:l}:!1},scrollToItem:function(b){var c=this._container.find(".flows-list"),d=c.outerHeight(),k=
this.getRegionContainer();d<k.outerHeight()&&(k=k.children(":first").position().top,b=b._$el.position().top-k,b>d/2&&c.scrollTop(b-d/2))},selectFirst:function(){return this.setActiveItem(0<this._childViews.length?this._childViews[0].model:null)},getSiblingChildView:function(b){var c=this._childViews.length,d=c-1,k={model:null};0!==c&&(b=0<b?b:0,k=b<=d?this._childViews[b]:this._childViews[d]);return k.model}}))})(toa);(function(d){var c=d.views.BaseView,b=new d.CompanySettings.Flows.constants;d.ns("toa.CompanySettings.Flows.view.stepList.ListView",d.define(c,function(){c.apply(this,arguments)},{events:{"click button.iconAddCondition":"onAddNewStep"},viewModelListViewValues:null,template:'<div class="list steps-list section"><div class="section-title"><div><h1 id="steps_lbl"><%= h(19102)/* Steps */ %></h1><% if (isReadWriteMode) { %><small><%= h(227012) /* You can change the order of steps using drag & drop */ %></small><% } %></div><span class="spacer"></span><% if (isReadWriteMode) { %><button aria-label="<%= h(225771) /* add step */ %>" class="button-icon iconAddCondition" title="<%= h(225771) /* add step */ %>"></button><% } %></div><div id="flow-steps" class="flow-steps-oj-list-view"><div id="listviewContainer"><oj-list-view id="listview" selection-mode="none" aria-labelledby="steps_lbl"  display="{{activeLayout}}" data="[[dataProvider]]" <% if (isReadWriteMode) { %>    dnd.reorder.items="enabled"    dnd.drag.items.drag-start="[[handleDragStart]]"    on-oj-reorder="[[handleReorder]]"  <% } %>><template slot="itemTemplate" data-oj-as="item"><li class="flow-step"><div class="oj-flex"><oj-list-item-layout class="oj-flex-item"><span slot="selector" role="img" aria-label="[[item.data.name]]" class="chain"></span><% if (isReadWriteMode) { %><div slot="leading" role="button" tabindex="0" aria-label="Drag handle" class="button-icon oj-listview-drag-handle"></div><% } %><span :data-step-id="[[item.data.id + \'_\' + item.data.idx]]" class="oj-typography-body-md oj-text-color-primary"><oj-bind-text value="[[item.data.name]]"></oj-bind-text></span><span slot="secondary" class="oj-typography-body-sm oj-text-color-secondary"><span class="text-muted"><oj-bind-text value="[[item.data.label]]"></oj-bind-text></span><span><oj-bind-text value="[[item.data.target]]"></oj-bind-text></span></span><div slot="metadata"><oj-menu-button chroming="borderless" display="icons" class="step-actions-menu">Step action menu<oj-menu class="flow-menu-button" data-status="enabled" slot="menu" on-oj-action="[[menuStepItemAction]]"><oj-option :data-step-id="[[item.data.id + \'_\' + item.data.idx]]" data-action="modify"><span><oj-bind-text value="[[modifyStepLabel]]"></oj-bind-text></span></oj-option><oj-option :data-step-id="[[item.data.id + \'_\' + item.data.idx]]" data-action="remove" disabled="[[isReadOnlyMode]]"><span><oj-bind-text value="[[deleteStepLabel]]"></oj-bind-text></span></oj-option><oj-bind-if test="item.data.type === TARGET_TYPE_FORM"><oj-option :data-id="\'divider_\'+ [[item.data.id + \'_\' + item.data.idx]]"></oj-option><oj-option :data-step-id="[[item.data.id + \'_\' + item.data.idx]]" :data-action="[[\'modify_\' + item.data.type]]" disabled="[[isReadOnlyMode]]"><span><oj-bind-text value="[[editFormStepLabel]]"></oj-bind-text></span></oj-option></oj-bind-if></oj-menu></oj-menu-button></div></oj-list-item-layout></div></li></template><template slot="noData"></template></oj-list-view></div></div></div>',
initViewModel:function(b){this.viewModelListViewValues=b},render:function(){this.model=new d.models.ObservableModel;this.model.set({isReadWriteMode:!this.readOnlyMode});c.prototype.render.apply(this,arguments);this.renderJetComponents();return this},renderJetComponents:function(){var b=this;require(["knockout","ojs/ojarraytreedataprovider","ojs/ojknockout","ojs/ojlistviewdnd","ojs/ojlistitemlayout"],function(c,k){var l=new d.CompanySettings.Flows.models.StepListViewModel({data:b.viewModelListViewValues,
isReadOnlyMode:b.readOnlyMode,menuStepItemAction:b.onClickStepAction.bind(b),ko:c,ArrayTreeDataProvider:k},b);c.applyBindings(l,document.getElementById("listviewContainer"))})},onAddNewStep:function(b){this.notify("flow_step_action:add",this,this.options.collection);"string"!==typeof b&&(b.preventDefault(),b.stopPropagation());return!1},onClickStepAction:function(c){c=$(c.target);var d=c.data("step-id").replace(/step_/ig,"").split("_"),k=0;if(2===d.length)switch(k=d[1],c.data("action")){case "view":case "modify":this.notify("flow_step_action:"+
(this.readOnlyMode?"view":"modify"),this.viewModelListViewValues.models[k]);break;case "modify_"+b.TARGET_TYPE_FORM:this.notify("flow_step_action:modify_form",this.viewModelListViewValues.models[k]);break;case "remove":this.notify("flow_step_action:delete",this.viewModelListViewValues.models[k])}},destroy:function(){this.getElement().remove();this._$el=null;this.notify("destroy",this)}}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.Flows.view.MainView",d.define(c,function(){c.apply(this,arguments)},{regions:{flowList:".r-flows-list",flowDetails:".r-flow-details",flowSteps:".r-flow-steps"},template:'<div id="company-settings-flows-container"><div id="company-settings-flows"><div class="column left r-flows-list"></div><div class="column right"><div class="r-flow-details"></div><div class="r-flow-steps"></div></div></div></div>',showRegion:function(){if(this.isFlowsContainerRendered())return c.prototype.showRegion.apply(this,
arguments)},isFlowsContainerRendered:function(){return!!$("#company-settings-flows-container").length},destroy:function(){this.getElement().remove();this._$el=null;this.notify("destroy",this)}}))})(toa);(function(d){d.ns("toa.CompanySettings.Flows.view.popups.ErrorPopup",d.define(null,function(c){this.message=c;this.render()},{errorsMap:{"Server error (13) has occurred":h(225782)},render:function(){var c=new d.ui.Popup({title:h(5332),autoOpen:!0,html:this.errorsMap[this.message],modal:!0,buttons:[{text:h(12252),type:"submit",position:"right",click:function(){c.destroy()}}]})}}))})(toa);(function(d){var c=new d.CompanySettings.Flows.constants;d.ns("toa.CompanySettings.Flows.view.popups.BaseView",d.define(null,function(b){this.model=b.model;this.stepModel=b.stepModel;this.initialLookups=b.initialLookups;this.visibilityType=b.visibilityType;this.readOnlyMode=b.readOnlyMode;this.visibilityTypeMap={};this.visibilityTypeMap[c.IS_COMPLETED_VISIBILITY_NAME]=d.glossary({id:225775});this.visibilityTypeMap[c.IS_AVAILABLE_VISIBILITY_NAME]=d.glossary({id:225776})},$.extend({},d.mixins.EventEmitter,
{render:function(){},getElement:function(){return this.element},getContainer:function(){return this.element},append:function(b){b&&this.getContainer().append(b.getElement())},initEvent:function(){this.model.addListener("changeName",this.changeName.bind(this))},changeName:function(b,c){""===c.trim()&&(c=this.model.getName()||"");this.setUpdatedName(c)},setUpdatedName:function(b){},showPopup:function(b,c,g){var k=this,l=[{text:h(225768),position:"left",click:function(){k.notify("flow-visibility-row:show-popup",
k);k.notify("action:recheck-on-close",k);c.destroy();n.destroy();k.notify("flow-visibility-row:reset-focus",k)}.bind(this)},{id:"applyVisibilityConditions",text:h(225769),type:"submit",position:"right",disable:0===this.model.conditions.length,click:function(){k.notify("flow-visibility-row:show-popup",k);c.notify("action:save");n.destroy();k.notify("flow-visibility-row:reset-focus",k)}.bind(this)}],n=new d.ui.Popup({isTitleHtml:!0,popup_extra_css_class:"stepPopup flow_popup",title:b,autoOpen:!0,view:c,
modal:!0,onClose:function(){k.notify("flow-visibility-row:show-popup",k);k.notify("action:recheck-on-close",k);c.destroy();n.destroy();k.notify("flow-visibility-row:reset-focus",k)},buttons:l});this.stepModel.addListener("is-visibility-conditions-changed",function(b,c){$('[data-popupbtnid="applyVisibilityConditions"]').toggleClass("toa-button-disable",!c)});g&&n.setTitleHtml(g)},limitStepConditions:function(){var b=this.stepModel.collection.getCount();return 0===b||1===b&&null!==this.stepModel.collection.find("label",
this.stepModel.get("label"))},empty:function(){this.getElement().empty()},_isOneLanguage:function(){return 1==d.CompanySettings.Flows.classes.factory.getLanguagesCollection().getCount()},getLanguageElem:function(){var b,c,g,k;b=this.model.get("names");g=this.model.get("translations");k=d.CompanySettings.Flows.classes.factory.getLanguagesCollection().models[0];c=g.get(k.getId());b=b.get(k.getId());c||(c=new d.CompanySettings.Flows.models.Translation({id:k.getId()}),g.add(c));c=new d.CompanySettings.Flows.view.popups.Language(c);
c.render(b);c.addListener("changeName",this.onChangeName.bind(this));return c.getElement()},renderLanguage:function(){var b=this.element.find(".sectionContent"),b=0==b.length?this.element.closest(".sectionContent"):b;b.append(this.getLanguageElem())},onChangeName:function(b,c){this.model.notify("changeName",c)},fetchNamesOrLabels:function(b,c){if(!(c instanceof d.CompanySettings.Flows.models.AvailableField||c instanceof d.CompanySettings.Flows.models.StepItemCondition))throw"Second parameter should be instance of toa.CompanySettings.Flows.models.AvailableField/StepFormCondition";
var g,k=[],l;if(("string"===typeof b||b instanceof String)&&""!==b){g=b.split(",");if(!c.hasLookups()&&!c.isEnumeration())return g;for(var n=c.getLookups(),p=0;p<g.length;p++){l=!1;if(n)for(var s in n)n[s].id==g[p]&&(k.push(n[s].text),l=!0);l||k.push("["+g[p]+"]")}}return k},sortParameters:function(b){var c=b?b:"text";return function(b,d){return 1*(b[c]<d[c]?-1:b[c]>d[c]?1:0)}},destroy:function(){if(this.element){try{this.element.draggable("destroy")}catch(b){}this.element.remove()}}})))})(toa);(function(d){var c=d.CompanySettings.Flows.view.popups.BaseView,b=new d.CompanySettings.Flows.constants,e=new d.CompanySettings.Flows.service.DefaultConditionsManager;d.ns("toa.CompanySettings.Flows.view.popups.stepItems.BaseRow",d.define(c,function(b){c.apply(this,arguments);this.visibilityId=b.visibilityId;this.conditionTranslations={"in":d.glossary({id:11456}),not_in:d.glossary({id:11457}),contains:d.glossary({id:11458}),dcontain:d.glossary({id:11459}),is_null:d.glossary({id:11460}),is_not_null:d.glossary({id:11461})}},
{expressionError:null,conditionErrors:{},visibilityId:null,VISIBILITY_REMOVE_ACTIVE:!0,VISIBILITY_REMOVE_NOTACTIVE:!1,templateCondition:new d.Template(['<div class="item_row <%- locked %>">','<div data-id="<%-id%>" title="<%-fieldName%>" class="fieldName"><nobr><%-fieldName%></nobr></div>','<div class="fieldValue" >','<span data-id="value-short-<%-id%>" class="condition-value condition-value-short">','<span class="visibility-condition"><%-condition%></span>&nbsp;','<%- null === valueNameShort ? "" : valueNameShort %>',
"<% if (valueCountShort > 0) { %>",'&nbsp; <span class="show-more"><%=r(17401 /* and {NUM} more */, { "{NUM}": valueCountShort })%></span>',"<% } %>","</span>",'<span data-id="value-full-<%-id%>" class="condition-value condition-value-full toa-hidden">','<span class="visibility-condition"><%-condition%></span>&nbsp;',"<%-valueName%>",'&nbsp; <span class="show-less"><%=h(17402)%></span>',"</span>","</div>","</div>"]),templateExpression:new d.Template(['<div class="item_row">','<div class="fieldValue expressionPreview">',
"<%- expression %>","</div>","</div>"]),templateError:new d.Template(['<div class="fieldError <%- errorTypeClass %>">','<div class="warningIcon"><div></div></div>','<div class="errorPreview"><%- errorText %></div>',"</div>"]),SHOW_VALUES_LIMIT:10,setExpressionError:function(b){var c=$(this.templateError.apply({errorText:b,errorTypeClass:"expressionError"}));this.element.find(".fieldValue").after(c);this.expressionError=b},setConditionError:function(b,c){var d=$(this.templateError.apply({errorText:c,
errorTypeClass:"conditionError"}));this.element.find('.fieldValue[data-dictlink="'+b+'"]').after(d);d=this.model.get("conditionErrors",{});"undefined"===typeof d[b]&&(d[b]=c);this.model.set({conditionErrors:d},{silent:!0})},renderExpression:function(b){b=$(this.templateExpression.apply({expression:d.multilineEllipsis(b,5)}));this.element.find(".rows").empty().append(b)},getConditionValuesList:function(b,c){var d,e,p=b.value,s=0,t={};e=this.fetchNamesOrLabels(p,c);d=p=e.join(", ");var u=this.SHOW_VALUES_LIMIT,
v=e.length;u+2<v&&(d=e.slice(0,u).join(", ")+"...",s=v-u);t.valueName=p;t.valueNameShort=d;t.valueCountShort=s;return t},renderCondition:function(c,k,l){var n=d.CompanySettings.Flows.classes.factory.getAvailableFieldCollection(),p,s=[b.ENTITY_TYPE_FORM_DATA.toString(),b.ENTITY_TYPE_SCREEN.toString()];"undefined"!==typeof c.property_id&&null!==c.property_id?p=n.get(c.property_id):s.includes(c.entity.toString())?(p=new d.CompanySettings.Flows.models.StepItemCondition({stepsCollection:this.stepModel.collection}),
p.set(c,{silent:!0})):p=n.getByLabelEntity(c.field,c.entity);if(p){s=this.getConditionValuesList(c,p);n=p.getName()||"";if(""===n&&"property"!==p.get("label"))n="["+p.get("label")+"]";else{var t=p.getLabel();null!==t.match(/step_(\d+)/)?this.stepModel.collection.models.forEach(function(b){"undefined"!==typeof b.attributes.label&&"undefined"!==typeof b.attributes.target.label&&b.attributes.label===t&&(t=b.attributes.target.label)}):t===b.FORM_FIELD_LABEL&&0===l&&null!==this.stepModel.attributes.target.label&&
(t=this.stepModel.attributes.target.label);n+=" ["+t+"]"}p=c.condition?this.conditionTranslations[c.condition]:"";var u=e.findDefaultConditionProcessorByCondition(c),v=!!u;l=v&&0===this.visibilityId;c=v?u.getBaseRowTemplateCondition(k,n):$(this.templateCondition.apply({id:k,locked:c.locked&&"true"===c.locked?"toa-flow-step-condition-locked":"",fieldName:n,condition:p,valueName:s.valueName,valueNameShort:s.valueNameShort,valueCountShort:s.valueCountShort}));this.element.find(".rows").append(c);l&&
this.element.find(".rows").next().find(".remove").remove();$(this.element).find('[data-id="value-short-'+k+'"] .show-more').on("click",this.onShowMoreValues.bind(this));$(this.element).find('[data-id="value-full-'+k+'"] .show-less').on("click",this.onShowLessValues.bind(this))}},onChangedRow:function(){var b,c,d=this;this.element.find(".rows").empty();b=this.model.conditions;c=this.model.expression;this.changeVisibilityRemoveState(!("undefined"===typeof b||0===b.length));c?this.renderExpression(c):
$.each(b,function(b,c){d.renderCondition(c)})},initEvent:function(){this.element.find(".rows").off("click").on("click",this.onEditVisibility.bind(this));this.element.find(".visibility_item_area").off("keydown").on("keydown",this.onEditVisibility.bind(this));this.element.find(".remove").off("click keydown").on("click keydown",this.onRemoveVisibility.bind(this));this.changeUID&&this.model.removeListener(this.changeUID)},onShowMoreValues:function(b){var c=$(b.target),c=$(c).parent().attr("data-id").split("-").slice(-1).pop();
this.element.find('[data-id="value-short-'+c+'"]').addClass("toa-hidden");this.element.find('[data-id="value-full-'+c+'"]').removeClass("toa-hidden");b.preventDefault();b.stopPropagation()},onShowLessValues:function(b){var c=$(b.target),c=$(c).parent().attr("data-id").split("-").slice(-1).pop();this.element.find('[data-id="value-short-'+c+'"]').removeClass("toa-hidden");this.element.find('[data-id="value-full-'+c+'"]').addClass("toa-hidden");b.preventDefault();b.stopPropagation()},onRemoveVisibility:function(b){if("undefined"===
typeof b||"keydown"!==b.type||13===b.keyCode){b=this.model.conditions;var c=[],d=this,e;for(e in b)"undefined"!==typeof b[e].locked&&"true"===b[e].locked&&c.push(b[e]);0<c.length?(this.model.conditions=c,this.element.find(".rows").empty(),$.each(c,function(b,c){d.renderCondition(c)})):(this.model={},this.element.find(".rows").empty(),this.changeVisibilityRemoveState(this.VISIBILITY_REMOVE_NOTACTIVE),this.notify("flow-visibility-row:remove",this))}},changeVisibilityRemoveState:function(b){b===this.VISIBILITY_REMOVE_NOTACTIVE?
(this.element.find(".remove_area").remove(),this.shouldRenderDefaultVisibility()&&this.element.find(".rows").append(this.renderDefaultVisibility())):(this.element.find(".toa-flow-step-visibility-no-conditions").remove(),this.element.find(".remove_area").removeClass("toa-disabled"),this.element.find(".remove").on("click keydown",this.onRemoveVisibility.bind(this)))},shouldRenderDefaultVisibility:function(){return this.visibilityType===b.IS_AVAILABLE_VISIBILITY_NAME||this.stepModel.isFormTargetType()},
destroy:function(){this.element.find(".visibility_item_area").off("click keydown");this.element.find(".remove").off("click keydown");c.prototype.destroy.apply(this)}}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.Flows.view.popups.BaseFlow",d.define(c,function(){c.apply(this,arguments);this.translationService=new d.CompanySettings.Flows.service.TranslationService},{_validationErrors:[],translationService:{},render:function(b,d){c.prototype.render.apply(this,arguments);this.list=this.getElement().find(".flow-translations");this.renderLanguages();return this},renderLanguages:function(){var b,c,g,k,l;b=this.model.get("translations");k=this.model.get("translationsList")?
this.model.get("translationsList"):[];d.CompanySettings.Flows.classes.factory.getLanguagesCollection().each(function(n){g=0<k.length?k.includes(new d.CompanySettings.Flows.models.Translation({id:n.getId()})):null;c="undefined"!==typeof b[n.getId()]?b[n.getId()]:"";g||(g=new d.CompanySettings.Flows.models.Translation({id:n.getId()}),k.push(g));l=new d.CompanySettings.Flows.view.popups.Language({model:g,readOnlyMode:this.readOnlyMode});l.addListener("flow-visibility-row:translation-updated",this.onTranslationChange.bind(this));
l.render(c,"");this.list.append(l.getElement())}.bind(this))},onTranslationChange:function(b,c){var d=this.model.get("translations"),k=!1;$.each(d,function(b,n){if(parseInt(b)===parseInt(c.model.get("id")))return d[b]=c.model.get("name")||"",k=!0,!1});k||(d[c.model.get("id")]=c.model.get("name"));this.model.set({translations:d})},getValidationErrors:function(){return this._validationErrors},showErrors:function(b){$.each(b,function(b,c){var d=$("input."+c.class,this.$el);d.closest(".control-group, .translation-item").addClass("control-group-error");
$('<span class="error">'+c.message+"</span>").insertAfter(d)}.bind(this));return this},clearErrors:function(){$(".error",this.$el).remove();$(".control-group, .translation-item").removeClass("control-group-error");return this}}))})(toa);(function(d){var c=d.CompanySettings.Flows.view.popups.BaseFlow;d.ns("toa.CompanySettings.Flows.view.popups.Flow",d.define(c,function(){c.apply(this,arguments)},{events:{"change input.flowLabel":"onChangeLabel"},template:'<form class="toa-form-horizontal"><div class="form-group vfe_settings_popup flow_settings_popup"><div class="control-group flow-label oj-flex"><label for="flowLabel" class="control-label oj-flex-item oj-sm-4 oj-sm-padding-3x-end right"><span class="asterisk">&#42;</span><%= h(18321)/* Workflow label */ %></label><div class="controls oj-flex-item oj-sm-8"><input required type="text" <% if (typeof(editMode) !== "undefined" && editMode === true) { %> readonly="true" <% } %> aria-label="<%= h(18321)/* Workflow label */ %>" name="flowLabel" tabindex="0" autofocus class="flowLabel required" value="<%- label %>" maxlength="40" /></div></div></div><div class="form-group flow-details-translations-container"><div class="flow-translations"></div></div></form>',
render:function(){this.model.set({translations:{}});c.prototype.render.apply(this,arguments);return this},onChangeLabel:function(b){this.model.set({label:$(b.target).val().trim()})},validate:function(){var b=[],c=this.model.get("label","");""===c&&b.push({class:"flowLabel",message:h(225762)});var d=this.model.get("translations",{});d[this.translationService.DEFAULT_LANG_ID]&&""!==d[this.translationService.DEFAULT_LANG_ID].trim()&&""!==$("input.item-defaultLanguage").val()||b.push({class:"item-defaultLanguage",
message:h(225763)});this.options.flowsCollection.each(function(d){if(c===d.get("label"))return b.push({class:"flowLabel",message:h(225783)}),!1});this._validationErrors=b;return!b.length}}))})(toa);(function(d){var c=d.CompanySettings.Flows.view.popups.BaseFlow;d.ns("toa.CompanySettings.Flows.view.popups.FlowDetails",d.define(c,function(){c.apply(this,arguments)},{events:{"change textarea.flowConditions":"onChangeConditions","change input.flowStatus":"onChangeStatus"},template:'<form id="flow-details-popup" class="toa-form-horizontal"><div class="form-group form-group-general-settings vfe_settings_popup flow_settings_popup"><div class="control-group oj-flex"><label for="flowLabel" class="oj-flex-item oj-sm-4 oj-sm-padding-3x-end right"><%= h(18321)/* Workflow label */ %></label><div class="controls oj-flex-item oj-sm-8"><input readOnly="readonly" aria-label="<%= h(18321)/* Workflow label */ %>" name="flowLabel" tabindex="0" class="flowLabel" value="<%- label %>"/></div></div><div class="control-group flow-auto-height oj-flex"><label for="flowConditions" class="oj-flex-item oj-sm-4 oj-sm-padding-3x-end right"><%= h(15025)/* Conditions */ %></label><div class="controls flow-auto-height oj-flex-item oj-sm-8"><textarea name="flowConditions" aria-label="<%= h(15025)/* Conditions */ %>" tabindex="0" class="flowConditions" rows="10" cols="50"><%= conditions %></textarea></div></div><div class="control-group control-group-flow-status oj-flex"><label for="flowStatus" class="flow-status oj-flex-item oj-sm-4 oj-sm-padding-3x-end right"><%= h(19108)/* Status */ %></label><div class="controls flow-status oj-flex-item oj-sm-8"><oj-radioset class="flowStatus" id="radiosetFlowStatusId" value="{{status}}"  class="oj-choice-direction-row"  on-value-changed="[[onValueChanged]]"><oj-bind-for-each data="[[options]]"><template><oj-option :title="[[$current.data.text]]" value="[[$current.data.value]]"><oj-bind-text value="[[$current.data.text]]"></oj-bind-text></oj-option></template></oj-bind-for-each></oj-radioset></div></div></div><div class="form-group flow-details-translations-container"><span class="flow-names-translations-title"><%-h(225797 /*Workflow Name*/)%></span><div class="flow-translations"></div></div></form>',
render:function(){c.prototype.render.apply(this,arguments);this.renderJetComponents()},renderJetComponents:function(){var b={options:[{id:"active_opt",value:"active",text:h(18280)},{id:"inactive_opt",value:"inactive",text:h(18281)}],status:this.model.get("status"),onValueChanged:this.onChangeStatus.bind(this)};require(["knockout","ojs/ojknockout","ojs/ojradioset"],function(c){var d=document.getElementById("radiosetFlowStatusId");c.applyBindings(b,d)})},onChangeConditions:function(b){this.model.set({conditions:$(b.target).val().trim()})},
onChangeStatus:function(b,c){this.model.set({status:c.status})},validate:function(){var b=[],c=this.model.get("translations",{});c[this.translationService.DEFAULT_LANG_ID]&&""!==c[this.translationService.DEFAULT_LANG_ID]&&""!==$("input.item-defaultLanguage").val()||b.push({class:"item-defaultLanguage",message:h(225763)});this._validationErrors=b;return!b.length}}))})(toa);(function(d){d.ns("toa.CompanySettings.Flows.view.popups.Expression",d.define(d.CompanySettings.Flows.view.BaseView,function(c,b,d){this.isAutoGenerated=b||!1;this.expression=c||"";this.errorText=d||"";b&&(this.autogeneratedValue=this.expression)},$.extend({},d.mixins.EventEmitter,{isAutoGenerated:!1,autogeneratedValue:"",isChanged:!1,isConstructorAccessible:!1,getElement:function(){return this.element},template:new d.Template(['<div class="visibility-conditions-content"><div class="conditions-header oj-flex oj-sm-margin-4x-bottom"><div class="oj-flex-item oj-sm-12"><span class="conditions-subheader"><%-h(15025 /*Conditions*/)%></span></div></div><div class="wysiwyg-visibilily-expression">',
'<textarea class="wysiwyg-expression-value" rows="15" aria-label="Expression value"><%- expression %></textarea>',"</div>",'<div class="oj-flex-item oj-sm-12 oj-sm-margin-4x-top"><a href="#" class="condition-list-action" style="display: none;"><%-h(21088 /*Show conditions as list*/)%></a></div></div>']),render:function(){this.element=$(this.template.apply({expression:this.expression}));this.isAutoGenerated&&(this.element.find(".condition-list-action").show(),this.isConstructorAccessible=!0);this.initEvent();
this.errorText&&this.element.find(".wysiwyg-visibilily-expression").append('<div class="fieldError">'+this.errorText+"</div>");return!0},initEvent:function(){this.element.find(".condition-list-action").on("click",this.onShowConditionsConstructor.bind(this));this.element.find(".wysiwyg-expression-value").on("input",this.onChangeExpression.bind(this))},onShowConditionsConstructor:function(c){this.isConstructorAccessible&&!this.element.find(".condition-list-action").hasClass("disabled")&&this.notify("show_constructor",
this)},isNotChanged:function(c){return this.autogeneratedValue===c},onChangeExpression:function(c){c=$(c.currentTarget).val();""===c||this.isNotChanged(c)?(this.isConstructorAccessible=!0,this.isChanged=!1):(this.isChanged=!0,this.isConstructorAccessible=!1);this.checkConstructorLink()},checkConstructorLink:function(){this.isConstructorAccessible?this.element.find(".condition-list-action").removeClass("disabled").show():this.element.find(".condition-list-action").addClass("disabled")},getExpressionValue:function(){var c=
this.element.find(".wysiwyg-expression-value").val();return this.isAutoGenerated&&this.isNotChanged(c)?!1:c}})))})(toa);(function(d){var c=d.CompanySettings.Flows.view.popups.BaseView;d.ns("toa.CompanySettings.Flows.view.popups.stepForms.ParameterForm",d.define(c,function(){c.apply(this,arguments);this.submitBtn=null},{submitBtn:null,MAX_FIELD_PARAMETER_VALUE:255,_validationErrors:[],template:new d.Template(['<div class="wysiwyg-parameter-form">','<div class="wysiwyg-content">','<div class="wysiwyg-visibility-condition">','<div class="wysiwyg-visibility-condition-content">','<div class="wysiwyg-condition-value-wrapper parameter-field-name">',
'<label class="parameter-label"><span>'+d.glossary({id:18161})+"</span></label>",'<select tabindex="0" class="wysiwyg-properties-list entities parameter" aria-label="<%= h(23667/*Property selection*/) %>" <%=checkDisabled%>>',"<%  for(var i = 0; i < entities.length; i++) { %>","<option  <%=entities[i].selected%> ","<%-entities[i].disabled%> ",'value="<%=entities[i].id%>">',"<%= h( entities[i].name ) %>","</option>","<% } %>","</select>","</div>","</div>","</div>","</div>","</div>"]),templateFormSelect:new d.Template(['<div class="wysiwyg-condition-value-wrapper parameter-field-name">',
'<label class="parameter-label"><span>'+d.glossary({id:18162})+"</span></label>",'<select class="wysiwyg-properties-list parameter" tabindex="0" aria-label="<%= h(18162/* Field name */) %>" <%=checkDisabled%>>',"<%  for(var i = 0; i < propertiesList.length; i++) { %>","<option  <%=propertiesList[i].selected%> ","<%-propertiesList[i].disabled%> ",'value="<%=propertiesList[i].id%>">',"<%=propertiesList[i].text%>&nbsp;","</option>","<% } %>","</select>","</div>"]),templateFormInput:new d.Template(['<div class="wysiwyg-condition-value-wrapper parameter-field-name">',
'<label class="parameter-label"><span>'+d.glossary({id:18163})+"</span></label>",'<input type="text" class="wysiwyg-condition-value parameter-value" value="<%=value%>" aria-label="<%= h(18163 /* Value */) %>"/>',"</div>"]),templateFormSelectValue:new d.Template(['<div class="wysiwyg-condition-value-wrapper">','<label class="parameter-label"><b>'+d.glossary({id:18163})+"</b></label>",'<select tabindex="0" class="wysiwyg-properties-list parameter-value" aria-label="<%= h(18163 /* Value */) %>">',"<%  for(var i = 0; i < propertiesList.length; i++) { %>",
"<option  <%=propertiesList[i].selected%> ","<%-propertiesList[i].disabled%> ",'value="<%=propertiesList[i].id%>">',"<%=propertiesList[i].text%>","</option>","<% } %>","</select>","</div>"]),checkSelectedEntity:function(){var b=this.getParameters();if(0<b.length&&"undefined"!==typeof this.model.get("field"))for(var c=0,d=b.length;c<d;c++)if(this.model.get("field")===b[c].label)return b[c].entity;return!1},render:function(b){this.submitBtn=$(b).parent().find("button.popup-button-submit:first");$(this.submitBtn).attr("disabled",
!0);this.paramsByEntity={};for(var c=this.getParameters(),d=0,k=c.length;d<k;d++){var l=c[d].entity;this.paramsByEntity.hasOwnProperty(l)||(this.paramsByEntity[l]=[]);this.paramsByEntity[l].push(c[d])}this.setUpEntities();c=this.paramsByEntity[this.selectedEntity]||[];this.element=$(this.template.apply({entities:this.entities,checkDisabled:"undefined"!==typeof this.model.get("value")?"disabled":""}));this.property=$(this.templateFormSelect.apply({propertiesList:c.sort(this.sortParameters()),value:"undefined"!==
typeof this.model.get("value")?this.model.get("value"):"",checkDisabled:"undefined"!==typeof this.model.get("value")?"disabled":""}));b.append(this.element);this.element.find(".wysiwyg-visibility-condition-content").append(this.property);this.initEvent();this.showPropertyValue();return this},initEvent:function(){c.prototype.initEvent.apply(this);$(".entities").on("change",this.showProperty.bind(this));this.property.find(".delete-condition").on("click",this.onDelete.bind(this));this.property.find("select").on("change",
this.showPropertyValue.bind(this))},showProperty:function(){var b=$(".wysiwyg-visibility-condition-content");"undefined"!==typeof this.input&&this.input.detach();"undefined"!==typeof this.property&&this.property.detach();"undefined"!==typeof this.select&&this.select.detach();for(var c=$(".entities :selected").val(),c=this.paramsByEntity[c]||[],d=[],k="",l=0,n=c.length;l<n;l++)c[l].hasOwnProperty("disabled")&&(k="disabled"),this.model.get("field","")===c[l].label&&(c[l].selected="selected"),d.push(c[l]);
"undefined"===typeof this.model.get("field")&&(k="");this.property=$(this.templateFormSelect.apply({propertiesList:d,checkDisabled:k}));this.property.appendTo(b);this.showPropertyValue();this.property.find("select").on("change",this.showPropertyValue.bind(this))},showPropertyValue:function(){var b=this.element.find(".wysiwyg-visibility-condition-content");$(this.submitBtn).attr("disabled",!0);this.input&&this.input.detach();"undefined"!==typeof this.select&&this.select.detach();var c=d.CompanySettings.Flows.classes.factory.getAvailableParametersCollection().getByLabelEntity(this.property.find("select :selected").val(),
$(".entities :selected").val());if(c&&c.get("lookups")){var c=c.get("lookups"),g;for(g in c)"undefined"!==typeof this.model.get("value")&&c[g].text===this.model.get("value")&&(c[g].selected="selected");this.select=$(this.templateFormSelectValue.apply({propertiesList:c}));this.select.appendTo(b);$(this.submitBtn).attr("disabled",!1)}else g="undefined"!==typeof this.model.get("value")?this.model.get("value"):"",this.input=$(this.templateFormInput.apply({value:g})),$(this.input).find("input").on("keyup",
function(b){b=!!this.submitBtn&&""===$(b.target).val();$(this.submitBtn).attr("disabled",b)}.bind(this)),this.input.appendTo(b)},isCustomParamExists:function(b){var c=this.model.get("stepParameters"),d="",k;if("undefined"!==typeof c&&0<c.length)for(var l=0;l<c.length;l++)if(k=Number.isInteger(c[l].field)&&!Number.isInteger(b)?c[l].text:c[l].field,k===b){d="disabled";break}return d},getParameters:function(){return this.processAvailableParams()},processAvailableParams:function(){for(var b=[],c=this.model.get("parameters"),
d=0;d<c.length;d++)b.push({id:c[d].label,label:c[d].label,text:c[d].text,type:c[d].type,entity:c[d].entity,selected:this.model.get("field")===c[d].label?"selected":"",disabled:this.isCustomParamExists(c[d].label)});return b},setUpEntities:function(){var b=this.model.get("entities");this.selectedEntity="undefined"!==typeof b[0]?b[0].id:"";this.entities=[];if(0<b.length)for(var c=this.checkSelectedEntity(),d=0,k=b.length;d<k;d++){var l=b[d];if(c||this.paramsByEntity.hasOwnProperty(l.id))l.id===c&&(l.selected=
"selected",this.selectedEntity=l.id),this.entities.push(l)}},onDelete:function(b){$(b.target.parentElement).remove()},validate:function(){var b=[],c=this.element.find(".wysiwyg-condition-value.parameter-value");0<c.length&&c.val().length>this.MAX_FIELD_PARAMETER_VALUE&&b.push({id:1,message:h(16917,{"{FIELD}":d.glossary({id:18163}),"{LENGTH}":this.MAX_FIELD_PARAMETER_VALUE})});this._validationErrors=b;return!b.length},getValidationErrors:function(){return this._validationErrors},getFormData:function(){return{field:this.element.find("select:eq(1) :selected").val(),
value:"undefined"!==typeof this.element.find("input").val()?this.element.find("input").val():this.element.find("select.parameter-value :selected").val(),text:this.element.find("select:eq(1).parameter :selected").text(),entity:this.element.find("select.entities :selected").val()}},destroy:function(){"undefined"!==typeof this.select&&this.select.find(".delete-condition").off("click",this.onDelete.bind(this));c.prototype.destroy.apply(this)}}))})(toa);(function(d){var c=d.CompanySettings.Flows.view.popups.BaseView;d.ns("toa.CompanySettings.Flows.view.popups.stepForms.PluginParameterForm",d.define(c,function(){c.apply(this,arguments);this.validator=new d.CompanySettings.VisualFormEditor.validators.PluginParameterValidator(this.model.get("stepParameters"))},{template:new d.Template('<div class="wysiwyg-parameter-form">;<div class="wysiwyg-parameter-form-container">;<div class="row"><label class="parameter-label"><span><%-h(19974 /*Name*/)%></span></label><input class="name parameter <%=disabled%>" aria-label="<%= h(19974/*Name*/) %>" <%-disabled%> type="text" name="name" value="<%-name%>" /></div>;<div class="row"><label class="parameter-label"><span><%-h(19975 /*Value*/)%></span></label><textarea rows="5" class="value parameter" name="value" aria-label="<%= h(19975/*Value*/) %>"><%-value%></textarea></div>;</div>;</div>'.split(";")),
render:function(b){this.element=$(this.template.apply({disabled:this.model.get("field","").length?"disabled":"",name:this.model.get("field",""),value:this.model.get("value","")}));b.append(this.element);this.initEvent();return this},validate:function(){var b=this.element.find(".name").val().trim(),c=this.element.find(".value").val().trim();return this.validator.validate(b,c)},getValidationErrors:function(){return this.validator.getErrors().map(function(b){return{id:1,message:b}})},getFormData:function(){return{field:this.element.find(".name").val().trim(),
value:this.element.find(".value").val().trim(),text:"",entity:14}}}))})(toa);(function(d){var c=d.CompanySettings.Flows.view.popups.BaseView;d.ns("toa.CompanySettings.Flows.view.popups.Language",d.define(c,function(){c.apply(this,arguments);this.translationService=new d.CompanySettings.Flows.service.TranslationService},{originalName:"",template:new d.Template('<div class="translation-item oj-flex oj-sm-padding-1x-vertical">,<div class="language oj-flex-item oj-sm-4 oj-sm-padding-3x-end right">,<label for="<%- uniq_language_id %>_<%- languageLabel %>"><% if (defaultLanguage) { %><span class="asterisk">&#42;</span>,<% }%>,<%- languageName %></label>,</div>,<div class="translation oj-flex-item oj-sm-8">,<input type="text" ,<% if (readOnlyMode) { %>, readonly="true" ,<% }%>, placeholder="<%- placeholder %>" lang="<%- languageLabel %>" id="<%- uniq_language_id %>_<%- languageLabel %>" rows="1" cols="5" class="hide-placeholder <% if (defaultLanguage) { %>item-defaultLanguage<% } %>" ,value="<%- value %>" />,</div>,</div>'.split(",")),
render:function(b,c){var g=d.CompanySettings.Flows.classes.factory.getLanguagesCollection(),k=1===g.getCount()?h(68):g.get(this.model.getId()).get("name");this.originalName=c;this.originValue=b||"";this.isOriginalSet=""===this.originValue||b===c;this.element=$(this.template.apply({languageLabel:g.get(this.model.getId()).get("label"),defaultLanguage:this.model.getId()===this.translationService.DEFAULT_LANG_ID&&0===c.length,languageName:k,placeholder:c,uniq_language_id:generate_id(),originValue:this.originValue,
value:b,title:this.originValue&&!this.isOriginalSet?r(21055,{"{ORIGINAL_TEXT}":this.originValue}):"",readOnlyMode:this.readOnlyMode}));!0!==this.readOnlyMode&&this.initEvent();return this},initEvent:function(){var b=this.element.find("input");b.on("input",this.onTranslateValue.bind(this));b.on("focus",this.onShowPlaceholder.bind(this));b.on("blur",this.onHidePlaceholder.bind(this))},onShowPlaceholder:function(b){if(!this.isOriginalSet)return!1;$(b.currentTarget).removeClass("hide-placeholder")},onHidePlaceholder:function(b){if(!this.isOriginalSet)return!1;
$(b.currentTarget).addClass("hide-placeholder")},onTranslateValue:function(b){b=$(b.currentTarget);var c=b.val().trim();""===c||c===this.originalName?(c=this.originalName,this.isOriginalSet=!0,b.attr("title",""),this.model.set({name:!1})):(b.attr("title",r(21055,{"{ORIGINAL_TEXT}":this.originalName})),this.isOriginalSet=!1,this.model.set({name:c}));this.notify("flow-visibility-row:translation-updated",this);this.model.isUserLanguage()&&this.notify("changeName",c)},destroy:function(){this.element.find("input").off("input");
this.element.find("input").off("focus");this.element.find("input").off("blur");c.prototype.destroy.apply(this)}}))})(toa);(function(d){var c=d.CompanySettings.Flows.view.popups.BaseView;d.ns("toa.CompanySettings.Flows.view.popups.ValueList",d.define(c,function(){c.apply(this,arguments);this.initFliper()},{template:new d.Template(['<ul id="wysiwyg-enum-options-list"></ul>']),itemTemplate:new d.Template('<li>;<label tabindex="0" >;<input type="checkbox" tabindex="-1"  value="<%- value %>" <%=checked%> />;<%- name %>;</label>;</li>'.split(";")),render:function(b,c){var d,k,l;$("#wysiwyg-enum-options-list")&&$("#wysiwyg-enum-options-list").remove();
this.element=$(this.template.apply({}));this.element.appendTo(_DATA.popup_container);l=c.get("lookups");l.sort&&l.sort(function(b,c){var d,e;d=b.text;e=c.text;return d<e?-1:d>e?1:0});k=this.model.get("values")||this.model.get("value")||[];var n=[];if("string"===typeof k)n=k.split(",");else for(d=0;d<k.length;d++)n[d]=k[d].val;for(d=0;d<l.length;d++)k=$(this.itemTemplate.apply({value:l[d].id,checked:0<=$.inArray(""+l[d].id,n)?"checked":"",name:l[d].text})),this.element.append(k);this.element.find("label")[0].focus();
this.anchor=b;this.setPositionElement();this.initEvent();return this},initFliper:function(){this.fliper=new d.Fliper({getRectAnchor:this._getRectAnchor.bind(this),getRectElement:this._getRectElement.bind(this),mapPosition:this.mapPosition,mapOverlayPosition:this.mapOverlayPosition})},initEvent:function(){this.element.find("input").on("change",this.onSelectValue.bind(this));this.element.find("label").on("keydown",this.onLabelPress.bind(this));$(_DATA.popup_container).on("mousedown",this.onMouseDown.bind(this));
this.scrollableContainer=this.anchor.closest(".wysiwyg-visibility-condition").parent();this.scrollableContainer.on("scroll",this.destroy.bind(this))},setPositionElement:function(){var b;b=this.fliper.getOptimalPosition();this.element.css(b.point)},onLabelPress:function(b){"keydown"===b.type&&(13===b.keyCode?$(b.target).find("input").trigger("click"):27===b.keyCode&&(b.stopPropagation(),b.preventDefault(),this.notify("destroy"),this.destroy()))},onSelectValue:function(b){var c=this.element.find("input"),
d=[];for(b=0;b<c.length;b++)c[b].checked&&d.push(c[b].value);this.notify("selected",d)},onMouseDown:function(b){$(b.target).closest(this.element).length||this.destroy()},destroy:function(){this.scrollableContainer&&this.scrollableContainer.off("scroll",this.destroy);this.scrollableContainer.find(".toa-button.selected").removeClass("selected");$(_DATA.popup_container).off("mousedown",this.onMouseDown);c.prototype.destroy.apply(this)},_getRectAnchor:function(){var b={};this.anchor&&(b={width:this.anchor.outerWidth(),
height:this.anchor.outerHeight(),top:this.anchor.offset().top,left:this.anchor.offset().left});return b},_getRectElement:function(){var b={};this.element&&(b={width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.offset().top,left:this.element.offset().left});return b}}))})(toa);(function(d){var c=d.CompanySettings.Flows.view.popups.BaseView,b=new d.CompanySettings.Flows.service.DefaultConditionsManager,e=new d.CompanySettings.Flows.service.StepConditionsManager,g=new d.CompanySettings.Flows.classes.HtmlHelper,k=new d.CompanySettings.Flows.constants;d.ns("toa.CompanySettings.Flows.view.popups.stepItems.ConditionRow",d.define(c,function(){this.stepModel=arguments[0].stepModel;this.conditionType=arguments[0].conditionType||k.CONDITION_ROW_FIELD;c.apply(this,arguments);this.initValueList();
this.conditionTranslations={"in":d.glossary({id:11456}),not_in:d.glossary({id:11457}),contains:d.glossary({id:11458}),dcontain:d.glossary({id:11459}),is_null:d.glossary({id:11460}),is_not_null:d.glossary({id:11461})};this.exceptedFieldsArr="resource_workskills resource_effective_workskills resource_workzones queue_status reactivated total pending alerts calendar oncall_calendar resource_capacity_categories resource_time_slots date time_slot service_window".split(" ")},$.extend({},d.mixins.EventEmitter,
{template:new d.Template(['<div class="wysiwyg-visibility-condition oj-flex" data-id="<%-label%>" data-index=<%-index%>>','<div class="wysiwyg-visibility-condition-content oj-flex-item oj-sm-11"></div>','<% if (!disabled) { %><div class="delete-condition-container oj-flex-item oj-sm-1"><div class="delete-condition flow-popup-button-icon" role="button" tabindex="0" aria-label="Delete condition"></div></div>',"<% }%>","</div>"]),templateProperty:new d.Template('<div class="wysiwyg-properties-list-wrapper oj-flex-item oj-sm-6">,<select tabindex="0" class="wysiwyg-properties-list" aria-label="<%= h(23667/*Property selection*/) %>" <%-disabled%>>,<%  for(var i = 0; i < propertiesList.length; i++) { %>,<option  <%=propertiesList[i].selected%> ,<%-propertiesList[i].disabled%> ,value="<%=propertiesList[i].id%>">,<%=propertiesList[i].text%> [<%=propertiesList[i].targetLabel%>],</option>,<% } %>,</select>,</div>'.split(",")),
templateCondition:new d.Template('<div class="wysiwyg-conditions-list-wrapper oj-flex-item oj-sm-3">;<select tabindex="0" class="wysiwyg-conditions-list" aria-label="<%= h(23667/*Condition selection*/) %>" <%-disabled%>>;<% for(var condition in condititions) { %>;<option value="<%-condition%>"><%=condititions[condition]%></option>;<% } %>;</select>;</div>'.split(";")),templateFormInput:new d.Template(['<div class="wysiwyg-condition-value-wrapper oj-flex-item oj-sm-3">','<input type="text" class="wysiwyg-condition-value" aria-label="Condition value" <%-disabled%> />',
"</div>"]),templateFormSelect:new d.Template('<div class="wysiwyg-condition-value-wrapper oj-flex-item oj-sm-3">;<button class="toa-button" >;<%-h(15029)/*Select value*/%><span class="arrow"></span>;</button>;</div>;<div class="wysiwyg-add-enum-result oj-sm-6"></div>'.split(";")),templateError:new d.Template(['<div class="wysiwyg-condition-error fieldError">','<div class="errorText"><%- errorText %></div>',"</div>"]),render:function(b,c){var d;d="";var e=$(".wysiwyg-visibility-form");this.canNotBeModified(c,
e)&&(d="disabled");this.conditionField=[];this.element=$(this.template.apply({index:this.model.getId(),label:this.getConditionLabel(),disabled:d}));this.property=$(this.templateProperty.apply({propertiesList:this.getConditionField(),disabled:d}));this.condition=$(this.templateCondition.apply({condititions:this.conditionTranslations,disabled:d}));this.input=$(this.templateFormInput.apply({disabled:d}));this.select=$(this.templateFormSelect.apply({}));d=this.element.find(".wysiwyg-visibility-condition-content");
this.property.appendTo(d);this.condition.appendTo(d);this.initEvent();this.setValuesForm();this.setConditionError(b||!1);return!0},canNotBeModified:function(b,c){return b&&"undefined"!==typeof c.data("visibility")&&0===c.data("visibility")},isConditionUseSteps:function(){return[k.ENTITY_TYPE_FORM_DATA,k.ENTITY_TYPE_SCREEN].includes(parseInt(this.model.get("entity")))||this.conditionType===k.CONDITION_ROW_STEP},getConditionField:function(){var c=[],e,p,s,t,u=this;p=d.CompanySettings.Flows.classes.factory.getAvailableFieldCollection();
t="property"===this.model.get("field")?p.get(this.model.get("property_id")):p.getByLabel(this.model.get("field"));e=this.model.get("property_id");t&&(e=t.get("property_id"));if(this.isConditionUseSteps()){if((p=b.findDefaultConditionProcessorByStep(this.stepModel))&&k.IS_COMPLETED_VISIBILITY_NAME==u.visibilityType){t=p.getConditionRows(this.model.get("field"),this.stepModel.get("target").label);for(var v in t)t.hasOwnProperty(v)&&c.push(t[v]);this.limitStepConditions()&&0<c.length&&(this.clearSetModel(p.getConditionObject(),
!0),c[0].selected='selected="selected"')}this.stepModel.collection.each(function(b){var e=(new d.CompanySettings.Flows.service.TranslationService).getNameTranslation(b),k=b.get("label");"undefined"!==typeof b.attributes.target.label&&(k=b.attributes.target.label);u.stepModel.get("label")!==b.get("label")&&c.push({id:b.get("label"),label:b.get("label"),targetLabel:k,text:g.escapeHtml(e),selected:b.get("label")===u.model.get("field")?'selected="selected"':"",disabled:""})})}else p.each(function(b){if(b.get("condition",
0)&&!(b.getId()!==e&&-1!==u.exceptedFieldsArr.indexOf(b.get("label"))||u.visibilityType===k.IS_COMPLETED_VISIBILITY_NAME&&9===b.get("entity"))){var d=b.get("label");s=b.isDisabledCondition();c.push({id:b.getId(),label:b.get("label"),targetLabel:d,text:b.getName(),selected:s||b.getId()!==e?"":'selected="selected"',disabled:s?"disabled":""})}});return this.conditionField=c},getConditionLabel:function(){var b=this.conditionField,c="";Object.keys(b).forEach(function(d){""!==b[d].selected&&(c=b[d].id+
"_"+b[d].label)});return c},initValueList:function(){this.valueList=new d.CompanySettings.Flows.view.popups.ValueList({model:this.model})},initEvent:function(){this.element.find(".delete-condition").on("click keypress",this.onDelete.bind(this));this.property.find("select").on("change",this.onChangeProperty.bind(this));this.condition.find("select").on("change",this.onChangeCondition.bind(this));this.valueList.addListener("selected",this.onChangeValueList.bind(this));this.valueList.addListener("destroy",
this.onDestroyValueList.bind(this));this.select.find("button").on("click",this.onClickValueList.bind(this));this.input.find(".wysiwyg-condition-value").on("input",this.onChangeValue.bind(this))},onDestroyValueList:function(){$(".wysiwyg-condition-value-wrapper button").focus()},onClickValueList:function(){var b;b=d.CompanySettings.Flows.classes.factory.getAvailableFieldCollection().get(this.property.find("select").val());this.valueList.render(this.select.find(".toa-button"),b);this.select.find(".toa-button").addClass("selected")},
onChangeProperty:function(){var c=this.property.find("select").val(),g=b.findDefaultConditionProcessorByPropertyLabel(c);if(g)this.clearSetModel(g.getConditionObject());else if(e.isStep(c))this.clearSetModel(e.getStepConditionObject(c));else{var c=d.CompanySettings.Flows.classes.factory.getAvailableFieldCollection().get(c),g=["field","flow_element"],k={entity:c.get("entity"),field:-1<g.indexOf(c.get("type"))?c.get("label"):"property",value:"",condition:"in"};-1===g.indexOf(c.get("type"))&&(k.property_id=
c.getId());this.clearSetModel(k)}},clearSetModel:function(b,c){this.model.clear();this.model.set(b);c||this.setValuesForm()},onChangeCondition:function(){this.model.set({condition:this.condition.find("select").val()})},onChangeValue:function(){this.model.set({value:this.input.find("input").val()})},onChangeValueList:function(b,c){this.model.set({value:c.join(",")});this.setValuesForm()},onDelete:function(b){"true"===this.model.get("locked")||"keypress"===b.type&&"Enter"!==b.key||(this.element.remove(),
this.model.remove(),this.notify("condition-row:remove"))},showPropertyValue:function(){var b,c;c=this.element.find(".wysiwyg-visibility-condition-content");this.input.detach();this.select.detach();this.select.find(".wysiwyg-add-enum-result").empty();b=d.CompanySettings.Flows.classes.factory.getAvailableFieldCollection().get(this.property.find("select :selected").val());!this.isConditionUseSteps()&&b.get("lookups")?this.select.appendTo(c):this.input.appendTo(c)},showFormElementValue:function(){var b;
b=this.element.find(".wysiwyg-visibility-condition-content");this.input.detach();this.select.detach();this.input.appendTo(b)},setValuesForm:function(){var b;b=[];b=d.CompanySettings.Flows.classes.factory.getAvailableFieldCollection();b="property"===this.model.get("field")||this.model.get("property_id",null)?b.get(this.model.get("property_id")):b.getByLabelEntity(this.model.get("field"),this.model.get("entity"));!this.isConditionUseSteps()&&b?(this.property.find("select").val(b.get("property_id")),
this.condition.find("select").val(this.model.get("condition")),this.showPropertyValue(),b=this.fetchNamesOrLabels(this.model.get("value",""),b),0!==this.element.find(".wysiwyg-add-enum-result").length&&this.element.find(".wysiwyg-add-enum-result").empty().append(b.join(", ")),0!==this.element.find(".wysiwyg-condition-value").length&&this.element.find(".wysiwyg-condition-value").val(this.model.get("value"))):(this.condition.find("select").val(this.model.get("condition")),this.showFormElementValue(),
b=this.model.get("value")||"submitted",this.element.find(".wysiwyg-condition-value").val(b),this.element.find(".wysiwyg-condition-value").attr("readonly","true"),this.element.find(".wysiwyg-conditions-list").attr("disabled","true"))},setConditionError:function(b){(b=b||!1)&&this.element.append($(this.templateError.apply({errorText:b})))}})))})(toa);(function(d){var c=d.CompanySettings.Flows.view.popups.BaseView;d.ns("toa.CompanySettings.Flows.view.popups.stepForms.BaseForm",d.define(c,function(b,d){this.stepModel=arguments[0].stepModel;c.apply(this,arguments);this.expressionError=d||null;this.cloneModel();this.initConditionForm()},{expressionError:null,skipConditionValidation:!1,setOptions:function(b){this.options=b},hasExpression:function(){var b=this.cloneModel.expression;return null!==b&&""!==b&&"undefined"!==typeof b},initConditionForm:function(){this.hasExpression()?
this.initExpressionForm():this.initConditionsConstructor()},initExpressionForm:function(b,c){b=b||this.cloneModel.expression;this.conditionForm=new d.CompanySettings.Flows.view.popups.Expression(b,c||!1,this.expressionError);this.conditionForm.addListener("show_constructor",this.onShowConstructor.bind(this))},initConditionsConstructor:function(){this.conditionForm=new d.CompanySettings.Flows.view.popups.ConditionDictionary({model:this.cloneModel.conditions,initialLookups:this.initialLookups,stepModel:this.stepModel,
visibilityType:this.visibilityType});this.conditionForm.addListener("show_expression",this.onShowExpression.bind(this))},onShowExpression:function(b){this.skipConditionValidation=!0;b=this.generateExpression();this.initExpressionForm(b,!0);this.renderConditionsForm()},onShowConstructor:function(b){this.skipConditionValidation=!1;this.initConditionsConstructor();this.renderConditionsForm()},renderConditionsForm:function(){this.conditionForm.render();var b=this.conditionForm.getElement();this.element.find(".wysiwyg-visibility-settings").empty().append(b)},
generateExpression:function(){var b=this.cloneModel.conditions.toJSON(),c;for(c in b)null===b[c].condition&&b.splice(c,1);return d.CompanySettings.Flows.classes.factory.getExpressionManager().conditionsToExpression(b,this.stepModel)},initEvent:function(){this.addListener("action:save",this.onSave.bind(this))},cloneModel:function(){this.cloneModel=Object.assign({},this.model);this.cloneModel.conditions=this.createTmpConditionsDictionaryCollection()},createTmpConditionsDictionaryCollection:function(){var b=
this.cloneModel.conditions,c=new d.CompanySettings.Flows.models.collection.TmpConditionsDictionary;"undefined"!==typeof b&&c.load(b);return c},onValidateCondition:function(b,c){if(!this.skipConditionValidation){var d=document.querySelector('[data-index="'+b+'"]').querySelector(".wysiwyg-condition-value");d&&(d="INPUT"==d.tagName?d:d.querySelector(".toa-button"),c?d.classList.add("wysiwyg-form-invalid"):d.classList.remove("wysiwyg-form-invalid"))}},onSave:function(b){b=this.conditionForm.getExpressionValue();
var c=this.cloneModel.conditions,d=[],k=[],l=null;if(!1!==b&&0!==b.length)this.setExpression(b);else{c.each(function(b){""===b.get("value","")&&("in"===b.get("condition")&&b.set({condition:"is_null"}),"not_in"===b.get("condition")&&b.set({condition:"is_not_null"}));if("contains"===b.get("condition")||"dcontain"===b.get("condition"))""===b.get("value","")?(l="changed",d.push(b.id||b.uid)):l=null,this.onValidateCondition(b.id||b.uid,l);k.push(b.getData())}.bind(this));if(0<d.length)return;this.setConditions(k)}this.notify("flow-visibility-row:save");
this.destroy()},setExpression:function(b){this.model.conditions&&delete this.model.conditions;this.model.expression=b},setConditions:function(b){this.model.expression&&delete this.model.expression;this.model.conditions=b},destroy:function(){c.prototype.destroy.apply(this)}}))})(toa);(function(d){var c=d.CompanySettings.Flows.view.popups.BaseView,b=new d.CompanySettings.Flows.constants,e=new d.CompanySettings.Flows.service.DefaultConditionsManager,g=new d.CompanySettings.Flows.service.StepConditionsManager;d.ns("toa.CompanySettings.Flows.view.popups.ConditionDictionary",d.define(c,function(){this.stepModel=arguments[0].stepModel;c.apply(this,arguments);this.conditionErrors={};this.addConditionType=b.CONDITION_ROW_FIELD},$.extend({},d.mixins.EventEmitter,{template:new d.Template(['<div class="visibility-conditions-content"><div class="conditions-header oj-flex oj-sm-margin-4x-bottom"><div class="oj-flex-item oj-sm-6"><span class="conditions-subheader"><%-h(15025 /*Conditions*/)%></span></div><div class="oj-flex oj-sm-6 oj-sm-justify-content-flex-end"><div class="conditionTypeLabelWrapper"><select class="conditionTypeLabel" tabindex="0" aria-label="Condition type"><option <% if (!hideAddStep) { %> selected <% } %>value="0"><%-h(226527) /* Fields and properties */%></option><option value="1"<% if (hideAddStep) { %>    disabled="true" <% } else { %>    selected <% } %>><%-h(226528) /* Workflow steps*/ %></option></select></div><span class="iconAddConditions flow-popup-button-icon" role="button" tabindex="0" aria-label="Add condition"></span></div></div><div class="wysiwyg-visibilily-conditions conditions-content"><p class="no-condition-rows"><%= h(226937) /* Start configuring conditions for this step */ %></p></div><div class="oj-flex-item oj-sm-12"><a href="#" class="condition-list-action"><%-h(21087 /*Show conditions as formula*/)%></a></div></div>']),
render:function(){this.element=$(this.template.apply({hideAddStep:this.shouldHideAddStep()}));this.toggleNoConditionRows();this.model.models.forEach(this.renderCondition.bind(this));this.initEvent();this.stringifySnapshotOfConditions();return!0},stringifySnapshotOfConditions:function(){this.stringifiedConditionsSnapshot=JSON.stringify(this.model.models)},notifyOnConditionsChanged:function(){this.stepModel.notify("is-visibility-conditions-changed",this.stringifiedConditionsSnapshot.toString()!==JSON.stringify(this.model.models))},
toggleNoConditionRows:function(){this.element.find(".no-condition-rows").toggleClass("toa-hidden",0!==this.model.models.length)},setConditionErrors:function(b){this.conditionErrors=b=b||{}},getConditionError:function(b){var c="";b=b.getDictionaryIndex();!1!==b&&"undefined"!==typeof this.conditionErrors[b]&&(c=this.conditionErrors[b]);return c},shouldHideAddStep:function(){return this.limitStepConditions()&&(this.visibilityType!==b.IS_COMPLETED_VISIBILITY_NAME||this.stepModel.isPluginTargetType())},
renderCondition:function(b,c){var g,p=0===c&&e.isConditionDefault(b);b.get("condition")&&(g=new d.CompanySettings.Flows.view.popups.stepItems.ConditionRow({model:b,initialLookups:this.initialLookups,stepModel:this.stepModel,visibilityType:this.visibilityType,conditionType:this.addConditionType}),g.render(this.getConditionError(b),p),g.addListener("condition-row:remove",this.onRemoveConditionRow,this),this.element.find(".wysiwyg-visibilily-conditions").append(g.getElement()))},addConditionItem:function(c){if("undefined"===
typeof c||"keydown"!==c.type||13===c.keyCode){var e=this,n=!1,p=["field","flow_element"];c=d.CompanySettings.Flows.classes.factory.getAvailableFieldCollection().getFirstWithCondition(!0);this.addConditionType===b.CONDITION_ROW_STEP&&(n=this.stepModel.collection.findBy(function(b){return e.stepModel.get("label")!==b.get("label")}));c=new d.CompanySettings.Flows.models.TmpConditionDictionary(this.addConditionType===b.CONDITION_ROW_STEP?g.getStepConditionObject(n?n.get("label"):""):{entity:c.get("entity"),
field:-1<p.indexOf(c.get("type"))?c.get("label"):"property",property_id:c.getId(),condition:"in",value:""});this.model.add(c);this.toggleNoConditionRows();this.renderCondition(c);this.notifyOnConditionsChanged()}},initEvent:function(){this.element.find(".iconAddConditions").on("click keydown",this.onCreateCondition.bind(this));this.element.find(".add-flow-step-condition-button").on("click keydown",this.addConditionItem.bind(this));this.element.find(".condition-list-action").on("click",this.onShowFormulaExpression.bind(this))},
onCreateCondition:function(b){if("undefined"===typeof b||"keydown"!==b.type||13===b.keyCode)b.stopPropagation(),b.preventDefault(),b=this.element.find(".conditionTypeLabel option:selected").val(),this.addConditionType=parseInt(b),this.addConditionItem()},onShowFormulaExpression:function(){this.notify("show_expression",this)},onRemoveConditionRow:function(){this.toggleNoConditionRows();this.notifyOnConditionsChanged()},getExpressionValue:function(){return!1}})))})(toa);(function(d){var c=d.CompanySettings.Flows.view.popups.stepForms.BaseForm;d.ns("toa.CompanySettings.Flows.view.popups.stepForms.VisibilityForm",d.define(c,function(){this.visibilityId=arguments[0].visibilityId;c.apply(this,arguments)},{template:new d.Template(['<div class="wysiwyg-visibility-form" data-visibility="<%-visibilityId %>">','<div class="wysiwyg-visibility-settings"></div>',"</div>"]),render:function(b){this.element=$(this.template.apply({visibilityId:this.visibilityId}));b.append(this.element);
this.abilityConditions()&&this.renderConditionsForm();this.initEvent();return this},initEvent:function(){c.prototype.initEvent.apply(this)},abilityConditions:function(){return 0<d.CompanySettings.Flows.classes.factory.getAvailableFieldCollection().getConditionFields().length},setExpression:function(b){c.prototype.setExpression.apply(this,arguments)},setConditions:function(b){c.prototype.setConditions.apply(this,arguments)},setVisibility:function(){this.model.conditions=this.cloneModel.conditions},
destroy:function(){c.prototype.destroy.apply(this)}}))})(toa);(function(d){var c=d.CompanySettings.Flows.view.popups.stepItems.BaseRow,b=new d.CompanySettings.Flows.constants;d.ns("toa.CompanySettings.Flows.view.popups.stepItems.VisibilityRow",d.define(c,function(){c.apply(this,arguments)},{template:new d.Template('<div class="visibility_item">;<div class="visibility_item_area" tabindex="0">;<div class="rows"></div>;<div class="remove_area">;<% if (!readOnlyMode) { %>;<div role="button" aria-label="<%= h(18125) /* Remove */%>" tabindex="0" class="remove flow-popup-button-icon"></div>;<% } %>;</div>;</div>;</div>'.split(";")),
templateNoConditions:new d.Template(['<span class="toa-flow-step-visibility-no-conditions"><%= h(225790) /* Always available (no conditions) */ %></span>']),templatePluginNoConditions:new d.Template(['<span class="toa-flow-step-visibility-no-conditions" style="display: none;"></span>']),localVisibilityTypeMap:{stepIsAvailable:h(226530),stepIsCompleted:h(226531)},render:function(b){var c,d;c=this.model.conditions;d=this.model.expression;this.element=this.renderRow();if(this.shouldRenderPluginNoConditionsTemplate())return this.element=
$(this.templatePluginNoConditions.apply({})),this;if(!d&&("undefined"===typeof c||0===c.length))return this.changeVisibilityRemoveState(this.VISIBILITY_REMOVE_NOTACTIVE),this;if(d)"object"===typeof d&&(d=d[0]),""!==d&&this.renderExpression(d);else{"undefined"!==typeof c.models&&(c=c.models);for(var l in c)c.hasOwnProperty(l)&&(d="undefined"===typeof c[l].entity?c[l].getData():c[l],this.renderCondition(d,l,b))}!0!==this.readOnlyMode&&this.initEvent();return this},renderDefaultVisibility:function(){return $(this.templateNoConditions.apply({}))},
renderRow:function(){return $(this.template.apply({readOnlyMode:this.readOnlyMode}))},onChangedRow:function(){this.notify("flow-visibility-row:save",this);this.initEvent();c.prototype.onChangedRow.apply(this,arguments)},onEditVisibility:function(b){if("undefined"===typeof b||"keydown"!==b.type||13===b.keyCode)this.visibilityForm=new d.CompanySettings.Flows.view.popups.stepForms.VisibilityForm({model:this.model,initialLookups:this.initialLookups,stepModel:this.stepModel,visibilityType:this.visibilityType,
visibilityId:this.visibilityId}),this.visibilityForm.addListener("flow-visibility-row:save",this.onChangedRow,this),this.notify("flow-visibility-row:hide-popup",this),b=new d.CompanySettings.Flows.service.TranslationService,this.showPopup("",this.visibilityForm,this.generatePopupTitle(b.getNameTranslation(this.stepModel))+'<br/><span class="flow-step-additional-title">'+this.generatePopupAdditionalTitle()+"</span>")},generatePopupTitle:function(b){var c=r(225774,{"{STEP_NAME}":b});""===b&&(c=c.replace("|",
""));return c},generatePopupAdditionalTitle:function(){return h(15023)+" - "+b.visibilityTypeTranslations[this.visibilityType]},shouldRenderPluginNoConditionsTemplate:function(){return(this.stepModel.isPluginTargetType()||this.stepModel.isScreenTargetType())&&this.visibilityType===b.IS_COMPLETED_VISIBILITY_NAME&&this.model.conditions&&0===this.model.conditions.length}}))})(toa);(function(d){var c=d.CompanySettings.Flows.view.popups.stepItems.BaseRow;d.ns("toa.CompanySettings.Flows.view.popups.stepItems.ParameterRow",d.define(c,function(b){this.model=b.model;this.parameters=b.row;c.apply(this,arguments)},{template:new d.Template('<div class="parameter_item">;<div class="parameter_item_area" tabindex="0" data-id="<%-field%>">;<div class="parameter"><div class="parameter_text"><%-text%></div><div class="parameter_field">[ <%-field%> ]</div></div>;<div class="rows"></div>;<div class="remove_area">;<% if (!readOnlyMode) { %>;<div role="button" tabindex="0" aria-label="<%= h(18125) /* Remove */%>" data-id="" class="remove flow-popup-button-icon"></div>;<% } %>;</div>;</div>;</div>'.split(";")),
templateDefault:new d.Template(['<div class="item_row">','<div class="defaultValue" data-id="<%-field%>"><i><%-value%></i></div>',"</div>"]),render:function(){var b=this.getPropertyData(this.parameters),c=this.parameters.value;this.element=this.renderRow(b);if(b&&b.get("lookups")&&"field"!==b.get("type")){var b=b.get("lookups"),d;for(d in b)if("undefined"!==typeof this.parameters.value&&b[d].id===this.parameters.value){c=b[d].text;break}}c=$(this.templateDefault.apply({field:this.parameters.field,
value:c}));this.element.find(".rows").append(c);return this},getPropertyData:function(b){var c=null,g=d.CompanySettings.Flows.classes.factory.getAvailableFieldCollection(),k=d.CompanySettings.Flows.classes.factory.getAvailableParametersCollection();null===b.text&&(b.text="");-1<b.text.indexOf("[")&&0<b.text.indexOf("]")&&(c=b.text.split("[")[1].trim().slice(0,-1),c=k.getByLabel(c));!c&&0>b.text.indexOf("[")&&(c=k.getByLabel(b.text));c||"undefined"===typeof b.text||b.field===this.parameters.text||
(c=g.getPropertyById(b.field));c||(c=g.getByLabel(b.field));c||(c=k.getPropertyByLabel(b.field));return c},renderRow:function(b){return $(this.template.apply({field:b.getLabel(),text:b.getName().split("[")[0].trim(),readOnlyMode:this.readOnlyMode}))}}))})(toa);(function(d){var c=d.CompanySettings.Flows.view.popups.stepItems.ParameterRow;d.ns("toa.CompanySettings.Flows.view.popups.stepItems.PluginParameterRow",d.define(c,function(){c.apply(this,arguments)},{template:new d.Template('<div class="parameter_item plugin_parameter_item">;<div class="parameter_item_area" data-id="<%-field%>" tabindex="0">;<div class="parameter"><div class="parameter_text"><%-field%></div></div>;<div class="rows"></div>;<div class="remove_area">;<% if (!readOnlyMode) { %>;<div data-id="<%-field%>" role="button" tabindex="0" aria-label="<%= h(18125) /* Remove */%>"  class="remove flow-popup-button-icon"></div>;<% } %>;</div>;</div>;</div>'.split(";")),
templateDefault:new d.Template(["<div>",'<div class="defaultValue" data-id="<%-field%>"><i><%-value%></i></div>',"</div>"]),renderRow:function(){return $(this.template.apply({field:this.parameters.field,readOnlyMode:this.readOnlyMode}))}}))})(toa);(function(d){var c=d.views.BaseView,b=new d.CompanySettings.Flows.constants;d.ns("toa.CompanySettings.Flows.view.popups.StepPopup",d.define(c,function(){c.apply(this,arguments);this.initFields();this.initViews()},{_validationErrors:[],events:{},regions:{generalSection:".generalSectionContainer",translationSection:".translationsSectionContainer",availableWhenSection:".availableWhenContainer",completedWhenSection:".completedWhenContainer",parametersSection:".parametersSectionContainer"},template:'<div id="stepEditorPopup" class="vfe_settings_popup"><div class="settingsContent"><div class="generalSectionContainer"></div><div class="translationsSectionContainer"></div><div class="availableWhenContainer visibilitySectionContainer"></div><div class="completedWhenContainer valuesSectionsContainer"></div><div class="parametersSectionContainer"></div></div></div>',
initViews:function(){this.generalSection=new d.CompanySettings.Flows.view.popups.stepSections.General({model:this.model,initialLookups:this.options.initialLookups,readOnlyMode:this.readOnlyMode});this.translationSection=new d.CompanySettings.Flows.view.popups.stepSections.Translations({model:this.model,initialLookups:this.options.initialLookups,readOnlyMode:this.readOnlyMode})},initEvents:function(){$("div.collapsible").off("click keypress").on("click keypress",function(b){b.preventDefault();this.onClickArrowIcon(b)}.bind(this));
$("div.parametersSectionContainer").off("click keypress","div.collapsible").on("click keypress","div.collapsible",function(b){b.preventDefault();this.onClickArrowIcon(b)}.bind(this))},initFields:function(){this.pluginParameters=this.model.isPluginTargetType()?this.model.getParameters():[];this.formParameters=this.model.isFormTargetType()?this.model.getParameters():[];this.currentStep=this.model.getSelectedTargetValue()},renderRegions:function(){this.onRenderAvailableWhen();this.onRenderCompletedWhen();
this.translationSection.render();this._$el.find(".translationsSectionContainer").html(this.translationSection.getElement());this.generalSection.addListener("flow-step-target:change",this.onStepTargetChange.bind(this));this.generalSection.addListener("flow-step-target:change-type",this.onStepTargetTypeChange.bind(this));this.generalSection.addListener("flow-step-target:update-params",this.onStepTargetUpdateParams.bind(this));this.onRenderParameters();this.showRegion("generalSection",this.generalSection);
this.showRegion("translationSection",this.translationSection);this.showRegion("availableWhenSection",this.availableWhenSection);this.showRegion("completedWhenSection",this.completedWhenSection)},onStepTargetChange:function(c,d){this.clearErrors();this.translationSection.updateTranslations(d);this.updateDefaultCondition(d);if(this.model.get("target").type===b.TARGET_TYPE_ACTION_SCREEN)this.onRenderCompletedWhen(d)},onStepTargetUpdateParams:function(){this.toggleParametersSectionContainer();this.resetStepParameters();
this.onRenderParameters()},onStepTargetTypeChange:function(b,c){this.clearErrors();this.onStepTargetUpdateParams();this.translationSection.updateTranslations();this.onRenderCompletedWhen(c)},updateDefaultCondition:function(c){"undefined"!==typeof c&&null!==c&&c.type===b.TARGET_TYPE_FORM&&this._$el.find(".defaultCondition").html("<nobr>"+h(22391)+" ["+c.label+"]</nobr>")},onRenderParameters:function(){this.toggleParametersSectionContainer();this.parametersSection=new d.CompanySettings.Flows.view.popups.stepSections.Parameters({model:this.model,
readOnlyMode:this.readOnlyMode,ParameterRowClass:this.getParameterRowClass(),ParameterFormClass:this.getParameterFormClass()});this.parametersSection.render(this._$el.find(".parametersSectionContainer"));this.parametersSection.addListener("flow-visibility-row:hide-popup",this.onChangePopupState.bind(this));this.parametersSection.addListener("flow-visibility-row:show-popup",this.onChangePopupState.bind(this));this.parametersSection.addListener("flow-visibility-row:reset-focus",this.onResetFocus.bind(this));
this.parametersSection.addListener("flow-visibility-row:rerender-parameters",this.onRerenderParameters.bind(this));this.initEvents()},onRerenderParameters:function(){this.onRenderParameters();$(".add_parameter").focus()},onRenderCompletedWhen:function(c){"undefined"!==typeof this.completedWhenSection&&(this.completedWhenSection.destroy(),this._$el.find(".completedWhenContainer").html(""));this.completedWhenSection=new d.CompanySettings.Flows.view.popups.stepSections.CompletedWhen({model:this.model,
initialLookups:this.options.initialLookups,visibilityType:b.IS_COMPLETED_VISIBILITY_NAME,readOnlyMode:this.readOnlyMode,changeTargetType:c});this.completedWhenSection.render();this._$el.find(".completedWhenContainer").html(this.completedWhenSection.getElement());this.completedWhenSection.addListener("flow-visibility:pre-save-remove",this.preRemove.bind(this));this.completedWhenSection.addListener("flow-visibility:pre-save-save",this.preSave.bind(this));this.completedWhenSection.addListener("flow-visibility-row:hide-popup",
this.onChangePopupState.bind(this));this.completedWhenSection.addListener("flow-visibility-row:show-popup",this.onChangePopupState.bind(this));this.completedWhenSection.addListener("flow-visibility-row:reset-focus",this.onResetFocus.bind(this));this.initEvents()},onRenderAvailableWhen:function(){"undefined"!==typeof this.availableWhenSection&&(this.availableWhenSection.destroy(),this._$el.find(".availableWhenContainer").html(""));this.availableWhenSection=new d.CompanySettings.Flows.view.popups.stepSections.AvailableWhen({model:this.model,
initialLookups:this.options.initialLookups,visibilityType:b.IS_AVAILABLE_VISIBILITY_NAME,readOnlyMode:this.readOnlyMode});this.availableWhenSection.render();this._$el.find(".availableWhenContainer").html(this.availableWhenSection.getElement());this.availableWhenSection.addListener("flow-visibility:pre-save-remove",this.preRemove.bind(this));this.availableWhenSection.addListener("flow-visibility:pre-save-save",this.preSave.bind(this));this.availableWhenSection.addListener("flow-visibility-row:hide-popup",
this.onChangePopupState.bind(this));this.availableWhenSection.addListener("flow-visibility-row:show-popup",this.onChangePopupState.bind(this));this.availableWhenSection.addListener("flow-visibility-row:reset-focus",this.onResetFocus.bind(this));this.initEvents()},onChangePopupState:function(b){"flow-visibility-row:hide-popup"===b?$(this._$el).parent().parent().hide():$(this._$el).parent().parent().show()},onResetFocus:function(c,d){var k=$(".add_parameter");d.visibilityType===b.IS_COMPLETED_VISIBILITY_NAME?
k=$(".completedWhenContainer").find(".add_visibility"):d.visibilityType===b.IS_AVAILABLE_VISIBILITY_NAME&&(k=$(".availableWhenContainer").find(".add_visibility"));k.focus()},render:function(){this.attachOracleJet();c.prototype.render.apply(this,arguments);this.renderRegions();this.initEvents()},reRenderWhen:function(c){if(c===b.IS_AVAILABLE_VISIBILITY_NAME)this.onRenderAvailableWhen();else this.onRenderCompletedWhen()},onClickArrowIcon:function(b){if("keypress"!==b.type||13===b.keyCode)$(b.target).closest(".section").toggleClass("collapsed"),
this.notify("step-popup:section-collapsed-toggle")},preSave:function(b,c){this.model.setVisibility(c.visibilityType,c.model,c.visibilityId);this.reRenderWhen(c.visibilityType)},preRemove:function(b,c){this.model.setVisibility(c.visibilityType,void 0,c.visibilityId);this.reRenderWhen(c.visibilityType)},attachOracleJet:function(){var b,c;document.getElementById("jet-alta-style")||(b=document.head,c=document.createElement("link"),c.rel="stylesheet",c.id="jet-alta-style",c.href=b.getAttribute("data-resource")+
"/vendor/css/oj/v11.0.5/alta/oj-alta-min.css",b.insertBefore(c,b.firstElementChild))},validate:function(){this._validationErrors=[];this._validationErrors=this._validationErrors.concat(this.generalSection.doValidation()).concat(this.translationSection.doValidation());return 0!==this._validationErrors.length?(this.clearErrors().showErrors(),!1):!0},showErrors:function(){this._validationErrors.forEach(function(b){b.showError()});return this},clearErrors:function(){this._validationErrors.forEach(function(b){b.clearError()});
return this},getParameterRowClass:function(){return this.model.isPluginTargetType()?d.CompanySettings.Flows.view.popups.stepItems.PluginParameterRow:d.CompanySettings.Flows.view.popups.stepItems.ParameterRow},getParameterFormClass:function(){return this.model.isPluginTargetType()?d.CompanySettings.Flows.view.popups.stepForms.PluginParameterForm:d.CompanySettings.Flows.view.popups.stepForms.ParameterForm},resetStepParameters:function(){this.model.isPluginTargetType()?(this.formParameters=this.model.getParameters(),
this.model.set({parameters:this.pluginParameters})):this.model.isFormTargetType()&&(this.pluginParameters=this.model.getParameters(),this.model.set({parameters:this.formParameters}));this.currentStep!==this.model.getSelectedTargetValue()&&this.model.set({parameters:[]})},toggleParametersSectionContainer:function(){this._$el.find(".parametersSectionContainer").toggle(this.shouldRenderParametersSection())},shouldRenderParametersSection:function(){if(null===this.model.getSelectedTargetValue()||this.model.isScreenTargetType())return!1;
if(this.model.isPluginTargetType()){var c=this.options.initialLookups.get(b.TARGET_TYPE_PLUGIN_NAME),d=this.model.getSelectedTargetValue();return c.find(function(b){return b.label===d}).type===b.PLUGIN_TYPE_ADDON}return!0},destroy:function(){c.prototype.destroy.apply(this)}}))})(toa);(function(d){var c=d.views.BaseView,b=new d.CompanySettings.Flows.constants;d.ns("toa.CompanySettings.Flows.views.popups.DeleteStep",d.define(c,function(){c.apply(this,arguments)},{_validationErrors:[],templateZ:new d.Template(['<div class="flow-delete-step-used-in"><p><%- message %></p><ul class="warning-explanation"></ul></div>']),templateItem:new d.Template(['<li class="flow-delete-step-used-in-item warning"><%-name%>(<%-label%>) | <%-type%></li>']),render:function(){var e=this,g=new d.CompanySettings.Flows.service.TranslationService,
k=this.checkStepUsage(this.model),l=$(this.templateZ.apply({message:h(225766).replace("{STEP_NAME}",g.getNameTranslation(this.model))}));if(0<k.length){var l=$(this.templateZ.apply({message:h(226525).replace("{STEP_NAME}",'"'+g.getNameTranslation(this.model)+'"')})),n=l.find(".warning-explanation");k.forEach(function(c){c=$(e.templateItem.apply({name:g.getNameTranslation(c.model),label:c.model.get("target").label,type:h(15023)+" - "+b.visibilityTypeTranslations[c.type]}));n.append(c)})}c.prototype.render.apply(this,
arguments);this._$el.append(l);return this},checkStepUsage:function(c){var d=[],k=this,l=c.get("label");this.model.collection.each(function(c){var e=c.get("visibility");k.checkStepUse(b.IS_COMPLETED_VISIBILITY_NAME,e,l)&&d.push({model:c,type:b.IS_COMPLETED_VISIBILITY_NAME});k.checkStepUse(b.IS_AVAILABLE_VISIBILITY_NAME,e,l)&&d.push({model:c,type:b.IS_AVAILABLE_VISIBILITY_NAME})});return d},checkStepUse:function(b,c,d){return c&&c[b]&&0<c[b].length?c[b].some(this.containsStepUsageInConditions.bind(null,
d))||c[b].some(this.containsStepUsageInExpression.bind(null,d)):!1},containsStepUsageInConditions:function(c,d){return d.conditions&&0<d.conditions.length?d.conditions.some(function(d){return Number(d.entity)===b.ENTITY_TYPE_FORM_DATA&&d.field===c}):!1},containsStepUsageInExpression:function(b,c){return c.expression?-1!==c.expression.indexOf("`"+b+"`"):!1}}))})(toa);(function(d){var c=d.CompanySettings.Flows.view.popups.BaseView,b=new d.CompanySettings.Flows.service.DefaultConditionsManager;d.ns("toa.CompanySettings.Flows.view.popups.stepSections.BaseWhen",d.define(c,function(b){this.changeTargetType=b.changeTargetType;this.visibilityRows=[];c.apply(this,arguments)},{template:new d.Template(['<div class="section base-when"><div class="sectionTitle"><div class="title"><div class="collapsible label" tabindex="0" role="button"><span class="arrow-icon"></span><span class="labelText"><%=visibilityTypeMap[visibilityType]%></span></div></div><% if (!readOnlyMode) { %><div tabindex="0" class="add_visibility flow-popup-button-icon"><%= h(21071/* Add new */) %></div><% } %></div><div class="sectionContent"></div></div>']),
render:function(){this.element=$(this.template.apply({visibilityTypeMap:this.visibilityTypeMap,visibilityType:this.visibilityType,readOnlyMode:this.readOnlyMode}));this.list=this.element.find(".sectionContent");this.visibility=this.model.get("visibility")?this.model.get("visibility"):{};"undefined"!==typeof this.visibility[this.visibilityType]&&0<this.visibility[this.visibilityType].length&&"undefined"===typeof this.changeTargetType?($.each(this.visibility[this.visibilityType],this.renderVisibilityRow.bind(this)),
this.setValueCount()):"undefined"!==typeof this.changeTargetType?(this.visibility[this.visibilityType]=b.sanitizeVisibilityObject(this.model,this.visibility[this.visibilityType]),delete this.changeTargetType,$.each(this.visibility[this.visibilityType],this.renderVisibilityRow.bind(this)),this.setValueCount()):(this.visibility[this.visibilityType]=[{conditions:[]}],this.renderVisibilityRow(0,this.visibility[this.visibilityType][0]));!0!==this.readOnlyMode&&this.initEvent();return this},renderVisibilityRow:function(b,
c){var k;k=new d.CompanySettings.Flows.view.popups.stepItems.VisibilityRow({model:c,visibilityId:b,readOnlyMode:this.readOnlyMode,initialLookups:this.initialLookups,stepModel:this.model,visibilityType:this.visibilityType});k.render(b);this.initChildEvents(k);this.visibilityRows.push(k);this.list.append(k.getElement());return k},setValueCount:function(){var b=r(21052,{"{VALUE_COUNT}":this.element.find(".visibility_item").length});this.element.find(".valueCount").text(b)},initEvent:function(){this.element.find(".add_visibility").on("click keydown",
this.onAddVisibility.bind(this))},initChildEvents:function(b){var c=this;b.addListener("flow-visibility-row:remove",function(){c.notify("flow-visibility:pre-save-remove",this)});b.addListener("flow-visibility-row:save",function(){c.notify("flow-visibility:pre-save-save",this)});b.addListener("action:recheck-on-close",this.onRecheckOnClose,this);b.addListener("flow-visibility-row:show-popup",this.onChangePopupState,this);b.addListener("flow-visibility-row:hide-popup",this.onChangePopupState,this);
b.addListener("flow-visibility-row:reset-focus",this.onResetFocus.bind(this))},onRecheckOnClose:function(b,c){var d=c.model.conditions,l=c.visibilityId,n=this.visibilityRows[l].model.conditions;"undefined"!==typeof d&&"undefined"!==typeof n&&0===d.length&&0===n.length&&(this.visibilityRows=this.visibilityRows.slice(l,1),c.destroy())},onAddVisibility:function(b){if("undefined"===typeof b||"keydown"!==b.type||"Enter"===b.key)1===this.element.find(".toa-flow-step-visibility-no-conditions").length&&(this.visibilityRows=
[],this.element.find(".visibility_item").remove()),b=new d.CompanySettings.Flows.view.popups.stepItems.VisibilityRow({model:{conditions:[]},visibilityId:this.visibilityRows.length,readOnlyMode:this.readOnlyMode,initialLookups:this.initialLookups,stepModel:this.model,visibilityType:this.visibilityType}),b.render(),this.initChildEvents(b),this.visibilityRows.push(b),this.list.append(b.getElement()),b.onEditVisibility()},onChangePopupState:function(b){this.notify(b,this)},onResetFocus:function(b){this.notify(b,
this)},destroy:function(){this.element&&this.element.find(".add_visibility").off();for(var b in this.visibilityRows)this.visibilityRows.hasOwnProperty(b)&&this.visibilityRows[b].destroy();this.visibilityRows=[];c.prototype.destroy.apply(this)}}))})(toa);(function(d){var c=d.CompanySettings.Flows.view.popups.stepSections.BaseWhen;d.ns("toa.CompanySettings.Flows.view.popups.stepSections.AvailableWhen",d.define(c,function(){c.apply(this,arguments)}))})(toa);(function(d){var c=d.CompanySettings.Flows.view.popups.stepSections.BaseWhen;d.ns("toa.CompanySettings.Flows.view.popups.stepSections.CompletedWhen",d.define(c,function(){c.apply(this,arguments)}))})(toa);(function(d){var c=d.views.BaseView,b=new d.CompanySettings.Flows.constants;d.ns("toa.CompanySettings.Flows.view.popups.stepSections.General",d.define(c,function(){c.apply(this,arguments);this.translationService=new d.CompanySettings.Flows.service.TranslationService;this.initViewModel()},{events:{"change .stepType":"onChangeStepType","click .boundFieldValue":"onFieldValueClick"},template:'<div id="selectorsSection" class="section visibility-hidden"><% var constants = new toa.CompanySettings.Flows.constants(); %><% var typeFormId = constants.TARGET_TYPE_FORM; %><% var typePluginId = constants.TARGET_TYPE_PLUGIN; %><% var typeActionScreenId = constants.TARGET_TYPE_ACTION_SCREEN; %><% var translationForm = constants.STEP_TYPE_TRANSLATION_MAP[typeFormId]; %><% var translationPlugin = constants.STEP_TYPE_TRANSLATION_MAP[typePluginId]; %><% var translationActionScreen = constants.STEP_TYPE_TRANSLATION_MAP[typeActionScreenId]; %><div class="sectionContent"><div class="fieldRow elementField"><div class="item-wrapper"><div class="oj-flex-item oj-sm-3"><div class="flowFieldLabel"><span title="<%= h(18140 /*Screen type*/) %>"><%= h(18140 /*Screen type*/) %></span></div></div><div class="oj-flex-item oj-sm-9"><div class="stepTypeFieldValue"><oj-radioset id="radiosetTargetTypeId" value="{{currentStepType}}"  class="oj-choice-direction-row"  on-value-changed="[[onValueChanged]]"><oj-bind-for-each data="[[stepTypeOptions]]"><template><oj-option :title="[[$current.data.text]]" value="[[$current.data.value]]"><oj-bind-text value="[[$current.data.text]]"></oj-bind-text></oj-option></template></oj-bind-for-each></oj-radioset></div></div></div></div><div class="fieldRow elementField"><div class="item-wrapper"><div class="oj-flex-item oj-sm-3"><div class="flowFieldLabel"><span title="<%= h(18144 /*Screen*/) %>"><%= h(18144 /*Screen*/) %></span></div></div><div class="oj-flex-item oj-sm-9"><div class="fieldValue boundFieldValue flowStepValue"><div id="dataBindingForm"><oj-combobox-one aria-label="dataBindingComboboxFlowStep" id="dataBindingComboboxFlowStep" options="[[dataProvider]]" value="[[selectedValue]]" options-keys = "[[optionsKeys]]"  on-value-changed="[[onValueChanged]]" option-renderer="[[optionRenderer]]"></oj-combobox-one></div></div></div></div></div><div class="fieldRow fieldRowError elementField"><div class="item-wrapper elementLabel oj-flex"><div class="oj-flex-item oj-sm-3"></div><div id="generalSectionErrorMessageContainer" class="oj-flex-item oj-sm-9 text-right"></div></div></div><div class="fieldRow elementField"><div class="item-wrapper elementLabel"><div class="oj-flex-item oj-sm-3 oj-sm-margin-3x-vertical"><div class="flowFieldLabel"><label for="stepPositionCombobox" id="stepPositionName"><%= h(227008 /* Position in workflow */) %></label></div></div><div class="oj-flex-item oj-sm-9"><div class="fieldValue boundFieldValue"><div id="stepPositionForm"><oj-select-single id="stepPositionCombobox" aria-label="<%= h(227008 /* Position in workflow */) %>" data="[[dataProvider]]" value="[[selectedValue]]" on-value-changed="[[onValueChanged]]"></oj-select-single></div></div></div></div></div></div></div>',
viewModel:null,viewModelPosition:null,render:function(){c.prototype.render.apply(this,arguments);this.selectorsSection=$("#selectorsSection");this.readOnlyMode&&(this._$el.find(".stepType").attr("disabled",!0),this._$el.find("#dataBindingComboboxFlowStep").attr("disabled",!0),this._$el.find("#stepPositionCombobox").attr("disabled",!0));this.renderJetComponents()},initViewModel:function(){var b="",b=null===this.model.getSelectedTargetValue()?"add":"edit",c=this.getOrderDataArray();this.viewModel=new d.CompanySettings.Flows.models.StepValueComboBoxViewModel({targetType:this.model.getTargetTypeName(),
dataArray:this.getDataArray(),selectedValue:this.model.getSelectedTargetValue(),onValueChanged:this.onChangeTargetValue.bind(this)});2===c.length&&"edit"===b?(b=0<parseInt(this.model.getOrder())?1:0,b=c[b].value):b=2<c.length&&"edit"===b?c[parseInt(this.model.getOrder())].value:1<c.length&&"add"===b?c[c.length-1].value:c[0].value;this.model.set({order:b});this.viewModelPosition=new d.CompanySettings.Flows.models.StepOrderComboBoxViewModel({dataArray:c,selectedValue:b,onValueChanged:this.onChangeOrderValue.bind(this)})},
renderJetComponents:function(){var c=this;this.updateTypeNameLabel();$(document).ready(function(){$(c.selectorsSection).removeClass("visibility-hidden")});var d={stepTypeOptions:[{id:"custom_forms_opt",value:b.TARGET_TYPE_FORM,text:h(b.STEP_TYPE_TRANSLATION_MAP[b.TARGET_TYPE_FORM])},{id:"plugins_opt",value:b.TARGET_TYPE_PLUGIN,text:h(b.STEP_TYPE_TRANSLATION_MAP[b.TARGET_TYPE_PLUGIN])},{id:"action_screens_opt",value:b.TARGET_TYPE_ACTION_SCREEN,text:h(b.STEP_TYPE_TRANSLATION_MAP[b.TARGET_TYPE_ACTION_SCREEN])}],
currentStepType:this.model.get("target").type,onValueChanged:this.onChangeStepType.bind(this)};require(["knockout","ojs/ojknockout","ojs/ojselectcombobox","ojs/ojselectsingle","ojs/ojradioset"],function(b){var l=document.getElementById("dataBindingForm");b.applyBindings(c.viewModel,l);l=document.getElementById("stepPositionForm");b.applyBindings(c.viewModelPosition,l);l=document.getElementById("radiosetTargetTypeId");b.applyBindings(d,l)})},getDataArray:function(){var c=this.model.getTargetTypeName();
return this.options.initialLookups.get(c,[]).map(function(d){switch(c){case b.TARGET_TYPE_ACTION_SCREEN_NAME:case b.TARGET_TYPE_FORM_NAME:return{label:d.name+" ["+d.label+"]",text:d.name,value:d.label};case b.TARGET_TYPE_PLUGIN_NAME:return{label:d.text+" ["+d.label+"]",text:d.text,value:d.label}}})},getOrderDataArray:function(){var b=this.model.collection.models,c="",k="",k="",l={label:h(227009),text:h(227009),value:0},n={label:h(227010),text:h(227010),value:"last"},p=null===this.model.getSelectedTargetValue()?
"add":"edit",s=d.app.model("companySettings").getUser().ulanguage;if(0===b.length||1===b.length&&"edit"===p)return[l];if(1===b.length&&"add"===p)return n.value=1,[l,n];for(var t=[],u=0;u<=b.length;u++)if(0===u)t.push(l);else if(u===b.length)n.value=u,t.push(n);else if(2!==b.length||"add"===p)if(u-1!==this.model.getOrder()||"add"===p)if(u!==b.length-1||this.model.getOrder()!==b.length-1||"add"===p){var c=u-1,v=this.translationService.getTransformedTranslations(b[c].get("target").type,b[c].get("target").label),
k=b[c].get("name")||{};b[c].getId();c="undefined"!==typeof k[s]||"undefined"!==typeof v[s]?s:1;k=k[c]?k[c].text:v[c]?v[c].text:"";k=r(227011,{"{STEP}":k});t.push({label:k,text:k,value:u})}return t},onFieldValueClick:function(b){if($(b.target).hasClass("fieldValue")){b=$(b.target).find(">div>oj-combobox-one .oj-combobox-choice, >div>oj-select-single .oj-text-field-container")[0];var c=new MouseEvent("mousedown");b.dispatchEvent(c)}},onChangeTargetValue:function(b){b=b.detail.value;this.getName(b)||
(b=this.getLabelFromOption(b));!1!==b&&(this.model.setTargetLabel(b),this.viewModel.update({selectedValue:this.model.getSelectedTargetValue()}),this.notify("flow-step-target:change",this.model.get("target")),this.notify("flow-step-target:update-params",this.model.getSelectedTargetType()))},onChangeOrderValue:function(b){this.model.set({order:b.detail.value||0});this.viewModelPosition.update({selectedValue:this.model.getOrder()})},onChangeStepType:function(b){b=Number(b.target.value);this.model.setTarget({type:b,
label:null});this.viewModel.update({targetType:this.model.getTargetTypeName(),dataArray:this.getDataArray(),selectedValue:this.getName(this.model.getSelectedTargetValue())||""});this.updateTypeNameLabel();this.notify("flow-step-target:change-type",b)},getName:function(c){var d=this.model.getTargetTypeName(),k=this.options.initialLookups.get(d,[]).find(function(b){return b.label===c});if(k)switch(d){case b.TARGET_TYPE_FORM_NAME:return k.name;case b.TARGET_TYPE_PLUGIN_NAME:return k.text;case b.TARGET_TYPE_ACTION_SCREEN_NAME:return k.label}return!1},
getLabelFromOption:function(b){return b?(b=b.match(/^(.*) \[([^\[|\]]+)]$/))&&b[1]&&0<b[1].length&&b[2]&&0<b[2].length&&this.getName(b[2])?b[2]:!1:!1},doValidation:function(){var b=document.getElementById("dataBindingComboboxFlowStep|input").value,c=[],d=this;this.getLabelFromOption(b)||c.push({id:1,message:h(225784),clearError:function(){$(".hasError",d.$el).removeClass("hasError");$(".error",d.$el).remove()},showError:function(){$("#generalSectionErrorMessageContainer").append('<span class="error">'+
this.message+"</span>");$(".flowStepValue").addClass("hasError")}});return c},updateTypeNameLabel:function(){this._$el.find("#bindingTypeName").text(this.model.getLabel())}}))})(toa);(function(d){var c=d.CompanySettings.Flows.view.popups.BaseView,b=[2,9,10];d.ns("toa.CompanySettings.Flows.view.popups.stepSections.Parameters",d.define(c,function(b){this.parameterRows=[];this.clickCounter=0;this.ParameterRowClass=b.ParameterRowClass||d.CompanySettings.Flows.view.popups.stepItems.ParameterRow;this.ParameterFormClass=b.ParameterFormClass||d.CompanySettings.Flows.view.popups.stepForms.ParameterForm;c.apply(this,arguments)},{availableParameters:[],template:new d.Template('<div class="section parameterSection">;<div class="sectionTitle">;<div class="title">;<div class="collapsible label" role="button" tabindex="0">;<span class="arrow-icon"></span>;<span class="labelText"><%= h(18145 /*Parameters*/) %></span>;<span class="labelText valueCount"></span>;</div>;</div>;<% if (!readOnlyMode) { %>;<div tabindex="0" class="add_parameter flow-popup-button-icon"><%= h(21071/* Add new */) %></div>;<% } %>;</div>;<div class="sectionContent"></div>;</div>'.split(";")),
render:function(b){this.container=b;this.element=$(this.template.apply({readOnlyMode:this.readOnlyMode}));this.list=this.element.find(".sectionContent");this.loadAvailableParametersCollection(this.renderRows.bind(this));return this},renderRows:function(){this.parameterRows=this.model.getParameters();for(var b=0;b<this.parameterRows.length;b++)this.renderParameterRow(this.parameterRows[b]);!0!==this.readOnlyMode&&this.initEvent();this.container.html(this.element);this.notify("flow-visibility-row:reset-focus",
this)},initEvent:function(){this.element.find(".add_parameter").on("click keydown",this.onAddParameter.bind(this));this.element.find(".parameter_text").on("click",this.onEditParameter.bind(this));this.element.find(".parameter_item_area").off("keydown").on("keydown",this.onEditParameter.bind(this));this.element.find(".remove").on("click keydown",this.onDeleteParameter.bind(this))},renderParameterRow:function(b){b=new this.ParameterRowClass({model:this.model,row:b,readOnlyMode:this.readOnlyMode});b.render();
this.list.append(b.getElement())},onEditParameter:function(b){if("undefined"==typeof b||"keydown"!=b.type||13==b.keyCode){if(1<=this.clickCounter||!0===this.model.get("is_plugin"))return!1;this.parameterForm&&this.parameterForm.destroy();this.renderParamPopup({field:$(b.target.parentElement.parentElement).data("id"),value:$(b.target.parentElement.parentElement).find(".defaultValue").text(),action:"edit",parameters:this.availableParameters});this.clickCounter++}},onAddParameter:function(b){if("undefined"==
typeof b||"keydown"!=b.type||13==b.keyCode){if(1<=this.clickCounter)return!1;this.parameterForm&&this.parameterForm.destroy();this.renderParamPopup({parameters:this.availableParameters,action:"add"});this.clickCounter++}},onDeleteParameter:function(b){if("undefined"==typeof b||"keydown"!=b.type||13==b.keyCode){b=$(b.target).closest(".parameter_item");var c=b.find(".parameter_item_area").data("id"),d=[];b.remove();d=this.model.getParameters().filter(function(b){if(!Number.isInteger(b.field))return b.field!==
c;if("undefined"!==typeof b.text){var d=b.text.match(/\ \[(.*)\]/);return(d?d[1]:b.text)!==c}});this.model.set({parameters:d});this.notify("flow-visibility-row:rerender-parameters",this)}},processAvailableParameters:function(b){var c=this.model.getParameters(),k={},l,n;b.forEach(function(b){l=[b.entity,b.label].join(".");k.hasOwnProperty(l)||(k[l]=b)});c.forEach(function(c){l=[c.entity,c.field].join(".");n=[c.entity,c.text].join(".");k.hasOwnProperty(l)||k.hasOwnProperty(n)||(c={id:c.parameter_id,
label:c.field,text:c.text,type:"string",entity:c.entity},k[l]=c,b.push(c))});d.CompanySettings.Flows.classes.factory.getAvailableParametersCollection().clear();d.CompanySettings.Flows.classes.factory.getAvailableParametersCollection().load(b);return b},renderParamPopup:function(b){var c=new d.CompanySettings.Flows.models.Parameter,k=this.getEntitiesList(),l="edit"===b.action?h(23675):h(18146),k={parameters:b.parameters,item_id:this.model.getId(),customParams:this.model.get("customParams"),entities:k,
action:b.action,stepParameters:this.model.getParameters()};"undefined"!==typeof b.field&&(k.field=b.field);"undefined"!==typeof b.value&&(k.value=b.value);c.set(k);this.parameterForm=new this.ParameterFormClass({model:c});this.notify("flow-visibility-row:hide-popup",this);this.showPopup(l,this.parameterForm)},getEntitiesList:function(){return d.CompanySettings.Flows.classes.factory.getEntitiesCollection().models.map(function(b){return{id:b.get("id"),name:b.get("name"),selected:"",disabled:""}}).filter(function(c){return-1===
b.indexOf(c.id)})},showPopup:function(b,c){var k=this;this.paramPopup=new d.ui.Popup({title:b,autoOpen:!0,view:c,popup_extra_css_class:"flow_popup",modal:!0,onClose:function(){k.notify("flow-visibility-row:show-popup",k);c.destroy();this.paramPopup.destroy();k.clickCounter=0;k.notify("flow-visibility-row:reset-focus",k)}.bind(this),buttons:[{text:h(225769),type:"submit",position:"right",click:function(){if(!c.validate())return k.paramPopup.setErrors(c.getValidationErrors()),!1;k.notify("flow-visibility-row:show-popup",
k);this.onSaveParameters(c.getFormData());k.notify("flow-visibility-row:rerender-parameters",k);k.clickCounter=0;k.notify("flow-visibility-row:reset-focus",k)}.bind(this)},{text:h(225768),position:"right",click:function(){k.notify("flow-visibility-row:show-popup",k);c.destroy();this.paramPopup.destroy();k.clickCounter=0;k.notify("flow-visibility-row:reset-focus",k)}.bind(this)}]});this.clickCounter++},onSaveParameters:function(b){var c=this.parameterRows.findIndex(function(c){c=Number.isInteger(c.field)&&
!Number.isInteger(b.field)?c.text:c.field;-1<c.indexOf("[")&&0<c.indexOf("]")&&(c=c.split("[")[1].trim().slice(0,-1));return c===b.field});-1===c?this.parameterRows.push({entity:b.entity,field:b.field,value:b.value,text:b.text}):(this.parameterRows[c].entity=b.entity,this.parameterRows[c].value=b.value,this.parameterRows[c].text=b.text);this.paramPopup.destroy();2<this.parameterRows.length&&(this.parameterRows=this.parameterRows.sort(this.sortParameters()));this.model.set({parameters:this.parameterRows})},
destroy:function(){this.parameterForm&&this.parameterForm.destroy();this.parameterRows=[];this.clickCounter=0;this.element&&(this.element.find(".add_parameter").off("click"),this.element.find(".parameter_text").off("click"),this.element.find(".label").off("click"));this.changeUID&&this.model.removeListener(this.changeUID);c.prototype.destroy.apply(this)},loadAvailableParametersCollection:function(b){var c=this,d={};null!=this.model.getSelectedTargetValue()&&(this.model.isFormTargetType()&&(d.form_label=
this.model.getSelectedTargetValue()),request({url:"?controller=wysiwyg&method=getFormParameters",data:d,responseHandler:function(d){Object.getPrototypeOf(c).availableParameters=c.processAvailableParameters(d.availableParameters);b.call()}}))}}))})(toa);(function(d){var c=d.CompanySettings.Flows.view.popups.BaseView,b=new d.CompanySettings.Flows.constants;d.ns("toa.CompanySettings.Flows.view.popups.stepSections.Translations",d.define(c,function(){c.apply(this,arguments);this.translationService=new d.CompanySettings.Flows.service.TranslationService},{template:new d.Template('<div class="translationsSection section collapsed">;<div class="sectionTitle">;<div class="title">;<div class="collapsible label" tabindex="0" role="button">;<span class="arrow-icon"></span>;<span class="labelText"><%= h(21054/*Translations*/) %></span>;</div>;</div>;</div>;<div class="sectionContent"></div>;</div>'.split(";")),
errorTemplate:new d.Template(['<div class="translationErrorContainer oj-flex-item oj-sm-12 right"><div class="language oj-flex-item oj-sm-4 oj-sm-padding-3x-end right"></div><div class="translation oj-flex-item oj-sm-8"><span class="error"><%= errorMessage %></span></div></div>']),render:function(){this.element=$(this.template.apply());this.list=this.element.find(".sectionContent");this.renderLanguages();return this},updateTranslations:function(){this.clearTranslations();this.model.set({name:{}});
this.rerender()},getElement:function(){return this.element},rerender:function(){this.renderLanguages(!0);return this},renderLanguages:function(b){var c,k,l,n,p,s,t;c=this.model.get("name");n=this.model.get("translations")?this.model.get("translations"):[];p=d.CompanySettings.Flows.classes.factory.getLanguagesCollection();var u=this.model.get("target");if("undefined"!==typeof u.type&&"undefined"!==typeof u.label&&null!==u.label){var v=parseInt(u.type);t=this.translationService.getTransformedTranslations(v,
u.label)}p.each(function(p){if(b){var u=document.querySelector('.sectionContent input[lang="'+p.get("label")+'"]');u.value="";u.setAttribute("placeholder",t&&"undefined"!==typeof t[p.getId()]?t[p.getId()].text:"")}else l=0<n.length?n.includes(new d.CompanySettings.Flows.models.Translation({id:p.getId()})):null,k="undefined"!==typeof c[p.getId()]?c[p.getId()].text:"",l||(l=new d.CompanySettings.Flows.models.Translation({id:p.getId()}),n.push(l)),s=new d.CompanySettings.Flows.view.popups.Language({model:l,
initialLookups:this.initialLookups,readOnlyMode:this.readOnlyMode}),s.addListener("flow-visibility-row:translation-updated",this.onTranslationChange.bind(this)),s.render(k,t&&"undefined"!==typeof t[p.getId()]?t[p.getId()].text:k),s.addListener("changeName",this.onChangeName.bind(this)),this.list.append(s.getElement())}.bind(this))},onTranslationChange:function(b,c){var d=this.model.get("name"),l=!1;$.each(d,function(b){if(parseInt(b)===parseInt(c.model.get("id")))return!1===c.model.get("name")?delete d[b]:
d[b].text=c.model.get("name"),l=!0,!1});l||!1===c.model.get("name")||(d[c.model.get("id")]={text:c.model.get("name")});this.model.set({name:d})},onChangeName:function(b,c){this.model.notify("changeName",c)},clearTranslations:function(){$.each(document.querySelectorAll(".sectionContent textarea"),function(b,c){c.value=""})},doValidation:function(){var c=[],d=this;$(".translation-item",this.$el).each(function(k,l){var n=$(l).find('input[type="text"]');$(n).val().length>b.MAX_STEP_NAME&&c.push({id:1,
message:h(227013,{"{MAX_SYMBOLS}":b.MAX_STEP_NAME}),clearError:function(){$(l).removeClass("translation-item-error").find(".translationErrorContainer").detach();$(n).off("keydown")},showError:function(){var c=this,e=d.errorTemplate.apply({errorMessage:h(227013,{"{MAX_SYMBOLS}":b.MAX_STEP_NAME})});$(".translationsSection").removeClass("collapsed");d.notify("step-popup:section-collapsed-toggle");$(n).keydown(function(){c.clearError()});$(l).addClass("translation-item-error").append(e)}})});return c},
destroy:function(){this.element&&this.element.find(".label").off("click");c.prototype.destroy.apply(this)}}))})(toa);(function(d){var c=d.Controller,b={glossary:{titlePanel:{title:h(225758),back:h(16257),titleSelectedFlow:h(225761)},popup:{addFlow:{title:h(225764),dismiss:h(225768),add:h(225791)},modifyFlow:{title:h(225779),dismiss:h(225768),modify:h(225792)},deleteFlow:{title:h(227204),dismiss:h(225768),delete:h(225770)},stepView:{title:function(b){return h(225785,b)},dismiss:h(225768)},stepAdd:{title:h(225771),dismiss:h(225768),add:h(225791)},stepModify:{title:function(b){return h(225774,b)},dismiss:h(225768),
modify:h(225792)},stepDelete:{title:h(227205),titleErr:h(227206),dismiss:h(225768),delete:h(225770),close:h(13305)}}},unsavedFlag:!1,cancelledPopupFlag:!1,isReadOnly:function(){return this.readOnlyMode},resume:function(b){var d=this;this.cancelledPopupFlag=!1;this.clearUnsavedFlag();c.prototype.resume.call(this,b);this.preExecute();this.initTitlePanel();this.initModels();"undefined"!==typeof b&&(this.activeFlowModel="undefined"!==typeof b.params.flowModel?b.params.flowModel:null);this.initialDataMapper.load(this.initialModel).then(function(b){d.renderWrapper(b)}).catch(function(b){d.sandbox.error(b)})},
preExecute:function(){this.triggerFunction("layout.tabs.set",{tabs:0,show:0})},initTitlePanel:function(){this.panel=d.view.control.create({xtype:"PanelTitleAlta",addClass:"jet-css-only toa-panel-title jet-screen-title panel-title-flows-settings",titleText:this.glossary.titlePanel.title,name:"titleCaption",resourceTreeButton:!1,calendar:!1,filter:!1,backButton:!0,backButtonIcon:"",backButtonLabel:_DATA.glossary.action_links.company_settings_configuration,backButtonHint:this.glossary.titlePanel.back,
listeners:{backButtonClick:this.returnToConfigScreen.bind(this)},actions:[]});this.panel.render(this.container,!0)},setTitlePanelText:function(b){var c=null,k=_DATA.glossary.action_links.company_settings_configuration,c=this.glossary.titlePanel.title;b&&(c=new d.CompanySettings.Flows.service.TranslationService,k=this.glossary.titlePanel.titleSelectedFlow,c=c.getNameTranslation(b));this.panel.applyOptionBackButtonLabel("",k);this.panel.applyOptionTitleText("",c)},returnToConfigScreen:function(){this.sandbox.trigger("layout.menu.click",
{label:"company_settings_configuration",url:"",name:"",params:{}})},setUnsavedFlag:function(){this.unsavedFlag=!0},clearUnsavedFlag:function(){this.unsavedFlag=!1},canExit:function(){return!this.unsavedFlag},cancelledPopup:function(){return this.cancelledPopupFlag},suspend:function(b){if(!this.canExit()&&!this.cancelledPopup())this.onUnsavedChanges({});c.prototype.suspend.call(this,b)},onUnsavedChanges:function(b){var c=this,k=r(227201),l=r(227203,{"{BUTTON_NAME}":h(14621)});c.cancelledPopupFlag=
!1;var n=new d.ui.Popup({title:h(227202),autoOpen:!0,popup_extra_css_class:"flow_popup confirm_flow",html:k+"<br />"+l,modal:!0,onClose:function(){n.destroy();c.cancelledPopupFlag=!0},buttons:[{text:h(14621),position:"left",click:function(){n.destroy();c.cancelledPopupFlag=!0}},{text:h(225793),type:"submit",position:"right",click:function(){c.executeCallback(b,"ignoreChanges");n.destroy()}.bind(this)}]})},executeCallback:function(b,c){if(Array.isArray(b[c]))for(var d in b[c]){if(b[c].hasOwnProperty(d)&&
"function"===typeof b[c][d])b[c][d]()}else if("object"===typeof b&&"function"===typeof b[c])b[c]()},serverConnector:null,initModels:function(){this.serverConnector=new d.CompanySettings.Flows.ServerConnector(this.triggerFunction,"flowconfiguration");this.initialDataMapper=new d.CompanySettings.Flows.dataMappers.InitialDataMapper(this.serverConnector);this.initialModel=this.initialDataMapper.create();this.flowMapper=new d.CompanySettings.Flows.dataMappers.FlowDataMapper(this.serverConnector);this.flowModel=
this.flowMapper.create();this.flowsListMapper=new d.CompanySettings.Flows.dataMappers.FlowsListDataMapper(this.serverConnector,this.flowMapper);this.flowsListCollection=this.flowsListMapper.create();this.stepMapper=new d.CompanySettings.Flows.dataMappers.FlowStepDataMapper(this.serverConnector);this.stepsListMapper=new d.CompanySettings.Flows.dataMappers.FlowStepsListDataMapper(this.serverConnector,this.stepMapper);this.stepsListCollection=this.stepsListMapper.create()},renderMainLayout:function(){this.layout&&
this.layout.destroy();this.layout=new d.CompanySettings.Flows.view.MainView;this.layout.render(this.container,!0)},onFlowActionDismiss:function(){this.flowDetailsView.hideFlowActions();this.onFlowReload();this.cancelledPopupFlag=!1},onFlowActionSave:function(b){this.disableActions();this.clearUnsavedFlag();var c=this;c.flowMapper.save(this.flowDetailsView.model,"update").then(function(){return c.stepsListMapper.save(c.stepsListCollection)}).then(function(){var b=c.flowDetailsView.model.get("label");
return c.serverConnector.updateFlowDependencies(b)}).then(function(){return c.afterChangeFlow(!0)}).then(function(){c.flowDetailsView.hideFlowActions();c.cancelledPopupFlag=!1;"function"===typeof b&&b()}).catch(function(b){c.enableActions();c.sandbox.error(b)})},toString:function(){return"Flows Screen Controller"},flowActionsController:"flows-configuration",onFlowExport:function(){post({label:this.flowDetailsView.model.getId(),controller:"flowconfiguration",method:"exportFlowContent"})},importFileUploadForm:null,
onFlowImport:function(){this.importFileUploadForm&&this.importFileUploadForm.destroy();this.importFileUploadForm=new d.CompanySettings.Flows.view.Import.ImportFileUpload({id:this.flowDetailsView.getCurrentFlowId(),label:this.flowDetailsView.model.get("label")});this.importFileUploadForm.addListener("import.validate",this.onFlowImportValidate.bind(this));this.importFileUploadForm.show()},importStatusForm:null,onFlowImportValidate:function(b,c){this.importStatusForm&&this.importStatusForm.destroy();
this.importStatusForm=new d.CompanySettings.Flows.view.Import.ImportFileUploadStatus({model:c});this.importStatusForm.addListener("import.finish",this.reloadAfterImport.bind(this));this.importStatusForm.show()},reloadAfterImport:function(){this.clearUnsavedFlag();this.afterChangeFlow()},renderWrapper:function(b){var c=d.CompanySettings.Flows.classes.factory.getLanguagesCollection();c.clear();c.load(b.get("languages"));this.readOnlyMode=!b.get("allow_modify");d.CompanySettings.Flows.classes.factory.setInitialLookups(b);
if((new d.CompanySettings.Flows.service.TranslationService).checkLanguageConsistency())this.setInitial(),this.render(),"undefined"!==typeof this.activeFlowModel&&null!==this.activeFlowModel&&this.listView.setActiveItem(this.activeFlowModel,!0,!0);else{var k=this;(new Promise(function(b){request({url:"?m=manage&a=get",responseHandler:function(c){window._DATA.glossary=c._DATA.glossary;b()}})})).then(function(){k.setInitial();k.render()})}},setInitial:function(){var b=this;this.initViews();this.initListeners();
this.flowsListMapper.load(this.flowsListCollection).then(this.showPanelContent.bind(this)).catch(function(c){b.sandbox.error(c)})},initViews:function(){this.renderMainLayout();this.listView=new d.CompanySettings.Flows.view.flowList.ListView({collection:this.flowsListCollection,readOnlyMode:this.isReadOnly()});this.flowDetailsView=new d.CompanySettings.Flows.view.FlowDetailsView({model:this.flowModel,readOnlyMode:this.isReadOnly()});this.flowDetailsView.addListener("flow_details:reload",this.onFlowReload,
this);this.flowDetailsView.addListener("flow_details:modify",this.onFlowModify,this);this.flowDetailsView.addListener("flow_details:export",this.onFlowExport,this);this.flowDetailsView.addListener("flow_details:import",this.onFlowImport,this);this.flowDetailsView.addListener("flow-action:flow-dismiss",this.onFlowActionDismiss,this);this.flowDetailsView.addListener("flow-action:flow-save",this.onFlowActionSave,this);this.flowDetailsView.getState("currentFlowModel")||this.flowDetailsView.setState("currentFlowModel",
this.flowMapper.create())},initListeners:function(){this.listView.addListener("flow-action:add",this.onFlowAdd,this);this.listView.addListener("flow-action:select",this.onFlowChangeFullRefresh,this);this.listView.addListener("flow-action:select-by-trigger",this.onFlowChange,this);this.listView.addListener("flow-action:remove",this.onFlowRemove,this)},render:function(){this.layout.showRegion("flowList",this.listView)},showPanelContent:function(){this.layout.showRegion("flowList",this.listView);this.listView.selectFirst()},
refreshFlowsList:function(){var b=this.listView.getActiveItem(),c;"undefined"!==typeof b&&null!==b&&(c=this.listView.getViewIndexByModel(b));this.flowDetailsView.getState("newFlow")&&this.flowDetailsView.getCurrentFlowId()&&(b=this.flowDetailsView.getState("currentFlowModel"),this.flowDetailsView.setState("newFlow",!1));this.layout.showRegion("flowList",this.listView);0>this.listView.setActiveItem(b,!0,!0)&&(b=this.listView.getSiblingChildView(c));null===b&&(this.flowDetailsView.clear(),this.stepsListView.clear(),
this.flowDetailsView.hideFlowActions());this.listView.setActiveItem(b,!1,!0);this.enableActions()},onFlowReload:function(){this.afterChangeFlow(!0)},onStepView:function(b,c){var k=(new d.CompanySettings.Flows.models.Step).loadModel(c),l=new d.CompanySettings.Flows.service.TranslationService;this.getPopupController(k,!0).showPopup({title:this.glossary.popup.stepView.title({"{STEP_NAME}":l.getNameTranslation(c)})})},onStepAdd:function(b,c,k){b=this.getNextStepId(k);c="step_"+b;var l=new d.CompanySettings.Flows.models.Step;
l.setDefaultValues().setLabel(c).setCollection(k||this.stepsListCollection).set({stepId:b});k=this.getPopupController(l);var n=k.getStepPopupView(),p=k.showPopup({title:this.glossary.popup.stepAdd.title,popup_extra_css_class:"flow_popup step_general_popup",buttons:[{text:this.glossary.popup.stepAdd.add,type:"submit",position:"right",click:function(){if(n.validate()){this.stepsListCollection.add(l);var b=n.model.getOrder();"first"!==b&&0!==b&&(b=parseInt(b));this.saveSteps(n,b);p.destroy()}}.bind(this)},
{text:this.glossary.popup.stepAdd.dismiss,position:"right",click:function(){n.destroy();p.destroy()}}]})},onStepChange:function(b,c){var k=(new d.CompanySettings.Flows.models.Step).loadModel(c),k=this.getPopupController(k),l=k.getStepPopupView(),n=this.stepsListCollection.models.indexOf(c),p=new d.CompanySettings.Flows.service.TranslationService,s=k.showPopup({title:this.glossary.popup.stepModify.title({"{STEP_NAME}":p.getNameTranslation(c)}),isTitleHtml:!0,popup_extra_css_class:"flow_popup step_general_popup",
buttons:[{text:this.glossary.popup.stepModify.modify,type:"submit",position:"right",click:function(){if(l.validate()){var b=this.stepsListCollection.models[n].getOrder(),c=l.model.getOrder();this.stepsListCollection.remove(this.stepsListCollection.models[n]);this.stepsListCollection.add(l.model);c>b&&0<c-1&&(c-=1);this.saveSteps(l,c);s.destroy()}}.bind(this)},{text:this.glossary.popup.stepModify.dismiss,position:"right",click:function(){l.destroy();s.destroy()}}]})},onStepModifyFormBefore:function(b,
c){var d=this;this._initUnsavedChangesSavePopup(function(){d.onStepModifyForm(b,c)})},_initUnsavedChangesSavePopup:function(b){var c=this;if(this.canExit())b(!0);else this.onUnsavedChanges({ignoreChanges:function(){c.clearUnsavedFlag();b(!1)}})},onStepModifyForm:function(b,c){var d=this;this.triggerFunction("layout.menu.click",{label:"company_settings_forms_and_plugins_content",url:"",name:h(15001),params:{isForm:!0,formId:c.getSelectedTargetValue(),formLabel:c.getSelectedTargetValue(),onClose:function(){this.triggerFunction("layout.menu.click",
{label:d.pageLabel,url:"",name:h(225758),params:{flowModel:d.flowModel}})}.bind(this)}})},getPopupController:function(b,c){var k,l=new d.CompanySettings.Flows.view.popups.StepPopup({model:b,initialLookups:this.initialModel,readOnlyMode:!!c}),n={view:l,popup_extra_css_class:"flow_popup",autoOpen:!0,modal:!0,buttons:[{text:this.glossary.popup.stepView.dismiss,position:"right",click:function(){l.destroy();k.destroy()}.bind(this)}],onClose:function(){l.destroy();k.destroy()}};return{getStepPopupView:function(){return l},
showPopup:function(b){b=Object.assign(n,b);k=new d.ui.Popup(b);l.addListener("step-popup:section-collapsed-toggle",function(){k.recalculateHeight()});return k}}},onStepDelete:function(b,c){var k=new d.CompanySettings.Flows.views.popups.DeleteStep({model:c}),l=1>k.checkStepUsage(c).length,n=l?this.glossary.popup.stepDelete.title:this.glossary.popup.stepDelete.titleErr,p=[];l?(p.push({text:this.glossary.popup.stepDelete.delete,type:"submit",position:"right",click:function(){this.stepsListCollection.remove(c);
this.updateFlowStepList();s.destroy()}.bind(this)}),p.push({text:this.glossary.popup.stepDelete.dismiss,position:"right",click:function(){s.destroy()}})):p.push({text:this.glossary.popup.stepDelete.close,position:"right",click:function(){s.destroy()}});var s=new d.ui.Popup({title:n,view:k,popup_extra_css_class:"flow_popup",modal:!0,autoOpen:!0,buttons:p,onClose:function(){s.destroy()}})},getNextStepId:function(b){var c=0;b&&b instanceof d.CompanySettings.Flows.models.collection.StepCollection&&$.each(b.models,
function(b,d){var e=d.get("label").match(/step_(\d+)/);c=parseInt(e[1])>=c?parseInt(e[1])+1:c});return c},applyDragAndDropOrder:function(b,c,d){this.applyOrder({model:c},d)},applyOrder:function(b,c){var d=this.stepsListCollection.models,l=this.stepsListCollection.findIndex(b.model),n=null,n="first"===c?0:"last"===c?d.length-1:parseInt(c);n>d.length-1&&(n=d.length-1);if(l!==n){this.stepsListCollection.models=this.moveTo(d,l,n);var p=0;this.stepsListCollection.each(function(b){b.set({order:p});p+=1})}this.renderStepsListView();
this.showFlowActionsBlock()},showFlowActionsBlock:function(){this.setUnsavedFlag();this.flowDetailsView.showFlowActions()},moveTo:function(b,c,d){var l=b[c];b.splice(c,1);b.splice(d,0,l);return b},saveSteps:function(b,c){this.applyOrder(b,c)},onFlowAdd:function(){var b=this;this._initUnsavedChangesSavePopup(function(c){if(!c)b.onFlowActionDismiss();b.createAddNewFlowPopup({name:"",label:"",notifications:[],conditions:"",startSteps:null,steps:0})})},createAddNewFlowPopup:function(b){var c=d.create("toa.CompanySettings.Flows.models.Flow",
b),k=d.create("toa.CompanySettings.Flows.view.popups.Flow",{model:c,flowsCollection:this.flowsListCollection}),l=new d.ui.Popup({title:this.glossary.popup.addFlow.title,view:k,popup_extra_css_class:"flow_popup add_flow",autoOpen:!0,modal:!0,buttons:[{text:this.glossary.popup.addFlow.add,type:"submit",position:"right",click:function(b){if(!k.validate())return k.clearErrors(),k.showErrors(k.getValidationErrors()),!1;$(b.target).removeClass("toa-button-active").addClass("toa-button-disable");this.flowMapper.save(c).then(function(b){this.flowDetailsView.getState("currentFlowModel").reset(b.flow);
this.flowDetailsView.setState("newFlow",!0);this.afterChangeFlow(!0);l.destroy()}.bind(this)).catch(function(c){c.error_code&&c.error_message?l.setErrors([{id:c.error_code,message:c.error_message}]):l.setErrors([{id:1,message:h(c)}]);$(b.target).removeClass("toa-button-disable").addClass("toa-button-active")}.bind(this))}.bind(this)},{text:this.glossary.popup.addFlow.dismiss,position:"right",click:function(){l.destroy()}}],onClose:function(){l.destroy()}})},onFlowModify:function(b,c){this.createEditFlowPopup({status:c.get("status"),
name:c.get("name"),label:c.get("label"),conditions:c.get("conditions"),translations:$.extend({},c.get("translations")),notifications:[],startSteps:null,steps:0})},createEditFlowPopup:function(b){b.editMode=!0;b=d.create("toa.CompanySettings.Flows.models.Flow",b);var c=d.create("toa.CompanySettings.Flows.view.popups.FlowDetails",{model:b}),k=this,l=function(){n.destroy();k.flowDetailsView.getElement().find("oj-menu-button").focus()},n=new d.ui.Popup({title:this.glossary.popup.modifyFlow.title,view:c,
popup_extra_css_class:"flow_popup modify_flow_popup",autoOpen:!0,modal:!0,buttons:[{text:this.glossary.popup.modifyFlow.modify,type:"submit",position:"right",click:function(b){if(!c.validate())return c.clearErrors(),c.showErrors(c.getValidationErrors()),!1;k.displayFlowAfterModify(c.model);this.showFlowActionsBlock();$(b.target).removeClass("toa-button-active").addClass("toa-button-disable");l()}.bind(this)},{text:this.glossary.popup.modifyFlow.dismiss,position:"right",click:l}],onClose:l})},onFlowRemove:function(){var b=
this.flowDetailsView.model,c=b.get("name");""===c.trim()&&(c=b.get("translations")[1]);var k=new d.ui.Popup({title:this.glossary.popup.deleteFlow.title,html:h(225765,{"{FLOW_NAME}":c}),popup_extra_css_class:"flow_popup confirm_flow",autoOpen:!0,modal:!0,buttons:[{text:this.glossary.popup.deleteFlow.delete,type:"submit",position:"right",click:function(){this.disableActions();this.clearUnsavedFlag();this.flowMapper.remove(b).then(this.afterChangeFlow.bind(this)).catch(function(){this.enableActions()}.bind(this));
k.destroy()}.bind(this)},{text:this.glossary.popup.deleteFlow.dismiss,position:"right",click:function(){k.destroy()}}]})},onFlowChangeFullRefresh:function(b,c,d){var l=this;this._initUnsavedChangesSavePopup(function(){l.onFlowChange(b,c,d)})},onFlowChange:function(b,c,d){b=c.model;"undefined"!==typeof this.activeFlowModel&&null!==this.activeFlowModel&&(b=this.activeFlowModel,d=this.activeFlowModel.getId());this.displaySteps(b,d,!0);this.displayFlow(b);this.activeFlowModel=null},displaySteps:function(b,
c,d){this.stepsListMapper.setFlowId(c);d?this.showStepsSection(c):this.renderStepsListView()},_displayFlow:function(b){this.flowDetailsView.getState("currentFlowModel").reset(b.toJSON());this.listView.setActiveItem(b,!0);this.flowModel=this.flowDetailsView.model=b;this.setTitlePanelText(b)},displayFlow:function(b){this._displayFlow(b);this.layout.showRegion("flowDetails",this.flowDetailsView)},displayFlowAfterModify:function(b){this._displayFlow(b);this.flowDetailsView.updateFlowConditions()},renderFlowGeneralSection:function(){this.layout.showRegion("flowDetails",
this.flowDetailsView)},showGeneralSection:function(b){var c=this.flowModel;c.set({label:"undefined"!==typeof b?b:this.flowDetailsView.getCurrentFlowId()},{silent:!0});return this.flowMapper.load(c).then(function(){this.renderFlowGeneralSection();this.listView.checkFlowDetailsConsistency(this.flowDetailsView.model);this.enableActions()}.bind(this)).catch(function(b){this.enableActions();new d.CompanySettings.Flows.view.popups.ErrorPopup(b);this.sandbox.error(b)}.bind(this))},renderStepsListView:function(b){this.stepsListView&&
this.stepsListView.destroy();this.stepsListView=new d.CompanySettings.Flows.view.stepList.ListView({collection:this.stepsListCollection,readOnlyMode:this.isReadOnly()});this.stepsListView.initViewModel(this.stepsListCollection);this.stepsListView.addListener("flow_step_action:modify",this.onStepChange,this);this.stepsListView.addListener("flow_step_action:modify_form",this.onStepModifyFormBefore,this);this.stepsListView.addListener("flow_step_action:view",this.onStepView,this);this.stepsListView.addListener("flow_step_action:delete",
this.onStepDelete,this);this.stepsListView.addListener("flow_step_action:add",this.onStepAdd,this);this.stepsListView.addListener("flow_step_action:dnd_reorder",this.applyDragAndDropOrder,this);this.layout.showRegion("flowSteps",this.stepsListView);"undefined"!==typeof b&&!0===b.setSaveAttr&&$("div.steps-list").attr("data-refresh-unique-code",Date.now())},showStepsSection:function(b){b=[this.stepsListMapper.load(this.stepsListCollection,{label:b})];var c=this;Promise.all(b).then(function(){c.renderStepsListView({setSaveAttr:!0})}).catch(function(b){c.sandbox.error(b)})},
afterChangeFlow:function(b){var c=[this.flowsListMapper.load(this.flowsListCollection)],d=this;b&&c.push(this.initialDataMapper.load(this.initialModel));b=Promise.all(c);b.then(function(){d.setTitlePanelText(null);d.refreshFlowsList();d.clearUnsavedFlag()});return b},updateFlowStepList:function(b,c){"undefined"!==typeof c&&(this.stepsListCollection.models[b]=c);this.renderStepsListView();this.showFlowActionsBlock()},disableActions:function(){$(".step-actions-menu").attr("disabled",!0);$(".flow-menu-button").attr("disabled",
!0);$(".flow-menu-button").attr("data-status","disabled");this.listView.lockChildClickEvent();this.flowDetailsView.disableFlowActions()},enableActions:function(){$(".step-actions-menu").removeAttr("disabled");$(".flow-menu-button").removeAttr("disabled");$(".flow-menu-button").attr("data-status","enabled");this.listView.unlockChildClickEvent();this.flowDetailsView.enableFlowActions();$(".flow-menu-button").attr("data-status","enabled")}};d.ns("toa.CompanySettings.Flows.controller.FlowActions",d.define(c,
function(b){this.sandbox=b;this.pageLabel="company_settings_flows";this.container=b.options.content;this.readOnlyMode=!1;this.triggerFunction=b.trigger.bind(b);this.resume()},b))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.BaseUploaderView",d.define(c,function(){c.apply(this,arguments)},{popup:null,popupClass:["form-popup"],widthForXS:600,classForXS:"form-popup-xs",resizeUid:null,show:function(){this.resizeUid=d.app.reflowManager.addListener("resize",this.updatePopupWidth.bind(this,"div.form-popup"));this.popupClass.push(this.getAdditionalPopupClass())},updatePopupWidth:function(b){this.getWindowWidth()<=this.widthForXS?$(b).addClass(this.classForXS):$(b).removeClass(this.classForXS);
this.popup.setPositionCenter()},getAdditionalPopupClass:function(){return this.getWindowWidth()<=this.widthForXS?this.classForXS:""},getWindowWidth:function(){return Math.min(window.innerWidth,window.screen.availWidth)},closeForm:function(){d.app.reflowManager.removeListener(this.resizeUid);this.resizeUid=null}}))})(toa);(function(d){var c=d.models.BaseCollection;d.ns("toa.CompanySettings.Forms.models.SortableCollection",d.define(c,function(b){c.apply(this,arguments);this.sortedFieldsTypes={string:"string",date:"date"};this.sortedField={value:"name",type:"string"};b&&this.load(b)},{comparator:function(b,c){var d=this.__getSortedValue(b)||+b.id,k=this.__getSortedValue(c)||+c.id;return this.__compareValues(d,k)},sortableDate:function(b){return b?b:""},__getSortedValue:function(b){switch(this.sortedField.type){case this.sortedFieldsTypes.date:return this.sortableDate(b.get(this.sortedField.value));
default:return b.get(this.sortedField.value)}},__compareValues:function(b,c){if(this.sortedField.type===this.sortedFieldsTypes.date){var d=b.toLowerCase(),k=c.toLowerCase();return d===k?0:d<k?1:-1}return b==c?0:b?c?b.toLowerCase()<c.toLowerCase()?-1:1:1:-1},setSortedField:function(b,c){this.sortedField.value=b;this.sortedField.type=c},sort:function(b){b=b||{};this.comparator&&"function"===typeof this.comparator&&(this.models.sort(this.comparator.bind(this)),b.silent||this.notify("reset"))},load:function(b){var c,
d=b.length;for(c=0;c<d;c++)-1==this.indexOf(b[c])&&this.add(b[c],{silent:!0,doNotAutoSort:!0});this.sort({silent:!0});this.notify("load")}}))})(toa);(function(d){var c=d.models.BaseModel;d.ns("toa.CompanySettings.Forms.models.Form",d.define(c,function(){c.apply(this,arguments)},{idField:"form_id",_defaultUnit:"kb",_emptyData:{label:"",translations:{}},isRemovable:function(){return 0<parseInt(this.get("count_links",0),10)+parseInt(this.get("cml_count_links",0),10)?!1:!0},convertSize:function(b){b=b||this._defaultUnit;var c=parseInt(this.get("content_size",0),10);"kb"===b&&(c=Math.round(100*c/1024)/100);return c},getFormattedDate:function(){var b=
this.get("updated_at",""),c="";b&&(c=d.date.formatDate(d.date.format.iso_long,d.date.currentDate()),c=d.date.formatAdaptive(b,c));return c},getFormName:function(b){return(b=b||null)?this.get("translations",{})[b]||"":this.get("name","")},setData:function(b){null===b&&(b={label:"",translations:{}});this.reset(b)}}))})(toa);(function(d){var c=d.models.ObservableCollection;d.ns("toa.CompanySettings.Forms.models.BaseCollection",d.define(c,function(){c.apply(this,arguments)},{modelConstructor:d.models.userTypes.BaseModel,where:function(b,c){var d=[];this.each(function(k,l){k.get(b)===c&&d.push(k)},this);return d},first:function(){return this.models[0]||null},find:function(b,c,d){return this.findBy(function(d){return d.get(b)==c},null,d)},findBy:function(b,c,d){b=this.findIndexBy(b,c,d);return-1<b?this.models[b]:null},findIndexBy:function(b,
c,d){var k=this.models;d=d||0;for(var l=k.length;d<l;d++)if(b.call(c||this,k[d]))return d;return-1},compact:function(){for(var b=this.compactData.apply(this,arguments),c=new this.constructor,d=0,k=b.length;d<k;d++)c.add(b[d],{silent:!0});return c},compactData:function(){var b=[],c=Array.prototype.slice.call(arguments,0);this.each(function(d){d=d.pick(c);b.push(d)});return b}}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.Forms.views.Container",d.define(c,function(){c.apply(this,arguments)},{regions:{form_list:".form_list",plugin_list:".plugin_list"},template:'<div id="toa-formsconfiguration-screen"><div class="form_list list jet-css-only"></div><div class="plugin_list list jet-css-only"></div><div id="notificationMessages"></div></div>'}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.Forms.views.Form",d.define(c,function(){c.apply(this,arguments);this.languageCollection=[]},{_mandatoryLanguageId:1,_validationErrors:[],events:{"change input.frmLabel":"onChangeLabel"},setLanguageCollection:function(b){this.languageCollection=b},render:function(b,d){c.prototype.render.apply(this,arguments);this.afterRender();return this},afterRender:function(){var b=this.getElement().find(".languageContainer");$.each(this.languageCollection,
function(c,g){var k={isMandatory:this.isMandatoryLanguage(g.id),languageId:g.id,languageLabel:g.label,languageName:g.name,formName:this.model.getFormName(g.id)},l=new d.Template(this.templateLanguage),k=$(l.apply(k));b.append(k)}.bind(this));this.readOnlyMode&&this.getElement().find("input").prop("readonly",!0);this.getElement().find("input.frmName").change(this.onChangeName.bind(this))},isMandatoryLanguage:function(b){return this._mandatoryLanguageId===b},onChangeLabel:function(b){b=$(b.target).val();
this.model.set({label:b})},onChangeName:function(b){var c=$(b.target).val();b=parseInt($(b.target).parent(".controls").parent(".control-group").data("language"),10);var d=this.model.get("translations",{});d[b]=c;this.model.set({translations:d})},validate:function(){var b=[];""===this.model.getFormName(this._mandatoryLanguageId)&&b.push({class:"frmName.required",message:h(22633)});""===this.model.get("label","")&&b.push({class:"frmLabel",message:h(22634)});this._validationErrors=b;return b.length?
!1:!0},getValidationErrors:function(){return this._validationErrors},showErrors:function(b){$.each(b,function(b,c){var d=$("input."+c.class,this.$el);$('<span class="error">'+c.message+"</span>").insertAfter(d)}.bind(this));return this},clearErrors:function(){$(".error",this.$el).remove();return this},template:'<form class="toa-form-horizontal add-form"><div class="form-group"><div class="languageContainer"></div><div class="control-group"><label class="control-label"><span class="asterisk">&#42;</span><%= h(19107)/* Label */ %></label><div class="controls"><input type="text" aria-label="Form label" name="formLabel" tabindex="0" class="frmLabel" autofocus value="<%- label %>" maxlength="40" /></div></div></div></form>',
templateLanguage:'<div class="control-group" data-language="<%- languageId %>" data-language-label="<%- languageLabel %>"><label class="control-label"><% if (true === isMandatory) { %><span class="asterisk">&#42;</span><% } %><%- languageName %></label><div class="controls"><input type="text"  aria-label="Form name" name="formName_<%- languageId %>" tabindex="0" autofocus lang="<%- languageLabel %>" value="<%- formName %>" class="frmName<%- (isMandatory ? " required" : "") %>" maxlength="255" /></div></div>'}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.Forms.views.NoItems",d.define(c,function(){c.apply(this,arguments)},{template:'<tr><td class="emptySection formItemCell noForms"><%= h(22629)/* No forms */ %></td></tr>'}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.Forms.views.FormItem",d.define(c,function(){c.apply(this,arguments)},{events:{"click .formName":"actionModify","click .linksCountNotNull":"actionDisplayConfiguredLinks","keydown .formName":"actionModify","keydown .linksCountNotNull":"actionDisplayConfiguredLinks"},template:'<tr <% if (typeof recently_updated !== "undefined") { %> class="recentlyUpdated" <% } %>><td class="formItemCell formIcon"><div class="icon" role="img" aria-label="'+
h(22391)+'"></div></td><th class="formItemCell cellName" scope="row"><a class="formName" name="a<%- _id %>" tabindex="0"><%- name %></a></th><td class="formItemCell cellLabel"><div class="formLabel"><%- label %></div></td><td class="formItemCell cellData"><div class="formDataRow"><div class="formDataCell dataTitle"><%= h(22618/* Size: */) %></div><div class="formDataCell dataValue"><%= h(22616, {"{FILE_SIZE}": content_size }) %></div></div><div class="formDataRow"><div class="formDataCell dataTitle"><%= h(18119/* Created: */) %></div><div class="formDataCell dataValue"><%- created_at %></div></div><div data-marker="updated" class="formDataRow"><div class="formDataCell dataTitle"><%= h(22619/* Modified: */) %></div><div class="formDataCell dataValue"><%- updated_at %></div></div><div class="formDataRow"><div class="formDataCell dataTitle"><%= h(22620/* User: */) %></div><div class="formDataCell dataValue"><%- name_modified_by %></div></div></td><td class="formItemCell cellLinks"><% if (0 < count_links || 0 < cml_count_links) { %><a name="cl<%- _id %>"><div role="button" tabindex="0" class="linksCount linksCountNotNull"><%- (count_links + cml_count_links) %></div><div><%= h(22621/* Configured links */) %></div></a><% } else { %><div><%= h(22635 /* No links configured. */) %></div><% } %></td><td class="formItemCell formTools"></td></tr>',
render:function(b,d){c.prototype.render.apply(this,arguments);this.showFormMenu();this.drawStatsChart();return this},getData:function(){var b=c.prototype.getData.apply(this,arguments);b.content_size=this.model.convertSize();return b},showFormMenu:function(){var b=[];this.readOnlyMode?(b.push({name:"actionView",addClass:"toa-dropdown-item",attr:{"aria-label":h(8047),"aria-labelledby":h(8047),tabindex:0},text:h(8047)}),b.push({name:"actionViewContent",addClass:"toa-dropdown-item",attr:{"aria-label":h(16553),
"aria-labelledby":h(16553),tabindex:0},text:h(16553)})):(b.push({name:"actionModify",addClass:"toa-dropdown-item",attr:{"aria-label":h(22625),"aria-labelledby":h(22625),tabindex:0},text:h(22625)}),b.push({name:"actionChangeContent",addClass:"toa-dropdown-item",attr:{"aria-label":h(22627),"aria-labelledby":h(22627),tabindex:0},text:h(22627)}),b.push({name:"actionImport",addClass:"toa-dropdown-item",attr:{"aria-label":h(226555),"aria-labelledby":h(226555),tabindex:0},text:h(226555)}));b.push({name:"actionExport",
addClass:"toa-dropdown-item",attr:{"aria-label":h(226554),"aria-labelledby":h(226554),tabindex:0},text:h(226554)});this.readOnlyMode||b.push({name:"actionDelete",addClass:"toa-dropdown-item",attr:{"aria-label":h(22626),"aria-labelledby":h(22626),tabindex:0},text:h(22626)});this.menuButton=d.view.control.create({xtype:"button.Menu",name:"formMenuButton",text:h(3514),addClass:"toa-item-menu-button",attr:{"aria-label":this.model.getFormName()+" "+h(3514),"aria-labelledby":h(3514),"aria-haspopup":"true",
tabindex:0},icon:"toa-item-menu-icon",menuItems:b,listeners:{menuItemClick:this.actionMenuItemClick.bind(this)}});this.menuButton.render(this._$el.find(".formItemCell.formTools"))},drawStatsChart:function(){},actionMenuItemClick:function(b,c){var d=Array.prototype.slice.call(arguments);d[0]=b;this[c.name].apply(this,d)},actionView:function(b){this.notify("formaction:view",b,this.model)},actionModify:function(b){if("undefined"!==typeof b.keyCode){if(13!==b.keyCode)return;b.stopPropagation()}b.preventDefault();
this.notify("formaction:"+(this.readOnlyMode?"view":"modify"),b,this.model)},actionDisplayConfiguredLinks:function(b){if("undefined"!==typeof b.keyCode){if(13!==b.keyCode)return;b.stopPropagation()}b.preventDefault();this.notify("formaction:displayFormLinks",b,this.model)},actionDelete:function(b){if(this.readOnlyMode)return!1;this.notify("formaction:delete",b,this.model)},actionActivate:function(b){if(this.readOnlyMode)return!1;this.notify("formaction:activate",b,this.model)},actionDeactivate:function(b){if(this.readOnlyMode)return!1;
this.notify("formaction:deactivate",b,this.model)},actionChangeContent:function(b){if(this.readOnlyMode)return!1;this.notify("formaction:changeContent",b,this.model)},actionImport:function(b){this.notify("formaction:import",b,this.model)},actionViewContent:function(b){this.notify("formaction:viewContent",b,this.model)},actionExport:function(b){this.notify("formaction:export",b,this.model)}}))})(toa);(function(d){var c=d.views.BaseCollectionView;d.ns("toa.CompanySettings.Forms.views.FormsList",d.define(c,function(){c.apply(this,arguments)},{idFieldName:"id",template:'<table class="formsListContainer"><caption style="display: none"><%= h(18181 /* Forms */) %></caption><tr><td style="font-size: 0px;" colspan="6"><%= h(18181 /* Forms */) %></td></table>',childView:d.CompanySettings.Forms.views.FormItem,childRegion:".formsListContainer",noItemsView:d.CompanySettings.Forms.views.NoItems,setCollection:function(b){this.collection=
b}}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.Forms.views.ConfiguredLinks",d.define(c,function(){this.readOnly=arguments[0].readOnly;c.apply(this,arguments)},{render:function(b,d){this.layouts=this.model.layouts;this.flows=this.model.flows;c.prototype.render.apply(this,arguments);b=this.getElement().find(".template-contexts");var g=this.renderUTItems();b.append(g);this.afterRender();return this},afterRender:function(){this.getElement().find("tr.context-row")},openEditorVFEorCLE:function(b){if("undefined"!==
typeof b.keyCode){if(13!==b.keyCode)return;b.stopPropagation()}var c=$(b.target),d=c.attr("data-element");if("context"==d){var k=c.attr("data-context"),d=this.getElement().find(".template-contexts");c.hasClass("selected")?(c.removeClass("selected"),c.attr("aria-label",h(22361)+" "+c.text()),d.find(".context-row[data-context="+k+"]").addClass("hidden")):(c.addClass("selected"),c.attr("aria-label",h(22362)+" "+c.text()),d.find(".context-row[data-context="+k+"]").removeClass("hidden"));this.notify("viewaction:displayFormLinksCenterPopup",
b,this.model);b.preventDefault()}else if("flow"==d)k=c.attr("data-flow"),d=this.getElement().find(".template-contexts"),c.hasClass("selected")?(c.removeClass("selected"),c.attr("aria-label",h(22361)),d.find(".context-row[data-flow="+k+"]").addClass("hidden")):(c.addClass("selected"),c.attr("aria-label",h(22362)),d.find(".context-row[data-flow="+k+"]").removeClass("hidden")),this.notify("viewaction:displayFormLinksCenterPopup",b,this.model),b.preventDefault();else if("link"==d&&!c.hasClass("toa-disabled")){var d=
c.attr("data-layout_id"),k=c.attr("data-context_type"),l=c.attr("data-editor"),n=c.attr("data-ut"),c=c.attr("data-item_id");d&&l&&("vfe"===l?this.openWysiwyg(n,d,c):"map_layer"===l?this.openMapLayer(c):this.openLayoutEditor(n,d,k,c),$('button[data-popupbtnid="closeBtn"]').click())}b.preventDefault()},renderUTItems:function(){var b=this,c=[],d=[],k=[],l=[],n=[],p=0;b.layouts.forEach(function(s){for(var u=0;u<s.length;u++){k=[];n=[];c=s[u].ut;if(1<c.length){for(var v=[],w=[],x=0;x<c.length;x++)v.push(c[x].name+
" ("+c[x].label+")"),w.push(c[x].label);d=c[0].buttons;for(x=0;x<d.length;x++)k.push(b.template_ut_button.apply({button_name:d[x].name,item_id:d[x].item_id,layout_id:s[u].layout_id,editor:s[u].type,context_type:s[u].context_type,ut:c[0].utype_id,ut_label:c[0].label,disabled:b.readOnly?"toa-disabled":""}));n.push(b.template_shared_ut_item.apply({ut_list:v.join("<br />"),ut_labels:w.join(" "),context_id:s[u].context_id,template_btns:k.join(" ")}))}else{k=[];d=c[0].buttons;for(x=0;x<d.length;x++)k.push(b.template_ut_button.apply({button_name:d[x].name,
item_id:d[x].item_id,layout_id:s[u].layout_id,editor:s[u].type,context_type:s[u].cntype,ut:c[0].utype_id,ut_label:c[0].label,disabled:b.readOnly?"toa-disabled":""}));n.push(b.template_ut_item.apply({ut_name:c[0].name,ut_label:c[0].label,context_id:s[u].context_id,template_btns:k.join(" ")}))}v=h(16014);s[u].custom_ut_title&&(v=s[u].custom_ut_title);0<p&&(p!=s[u].context_id?(l.push(b.template_context_delimiter.apply({context_id:p})),l.push(b.template_context.apply({context_id:s[u].context_id,context_layout_name:s[u].name,
context_label:s[u].label,context_layout_ut:n.join(" "),ut:v,buttons:h(18175),arialabel:h(22361)})),p=s[u].context_id):l.push(b.template_context_next.apply({context_layout_ut:n.join(" ")})));0==p&&(p=s[u].context_id,l.push(b.template_context.apply({context_id:s[u].context_id,context_label:s[u].label,context_layout_name:s[u].name,context_layout_ut:n.join(" "),ut:v,buttons:h(18175),arialabel:h(22361)})))}});l.push("<tr><td></td><td></td></tr>");if(0<b.flows.length){l.push(b.template_flow.apply({flows:"",
buttons:""}));for(var s=0;s<b.flows.length;s++)l.push(b.template_flow_item.apply({flow_name:b.flows[s].name,flow_label:b.flows[s].label}));l.push("<tr><td></td><td></td></tr>")}return l.join(" ")},openLayoutEditor:function(b,c,g,k){c=$.param({id:c,cmd:1==d.currentInterface||3==d.currentInterface?"company_settings":"config_ca_company",sub:"api"===g?"api":"display",action:"layout_structure",output:"ajax"});var l=this;request({url:"?"+c,data:{typeid:b,select_item_id:k},responseHandler:function(b){"undefined"===
typeof b.cgData&&l.showError(h(18116))}})},openWysiwyg:function(b,c,g){d.app.trigger("layout.menu.click",{label:"company_settings_wysiwyg",url:"",name:h(15001),params:{select:{context_layout_item_id:g},layout_id:c,typeid:b,context_layout_item_id:g,onClose:function(){d.app.trigger("layout.menu.click",{label:"company_settings_forms_and_plugins",url:"",name:r(22612),params:{}})}}})},openMapLayer:function(b){d.app.trigger("layout.menu.click",{label:"company_settings_business_rules",url:"cmd=company_settings&sub=business_rules&map_layer="+
b})},showError:function(b,c){b=b||h(3057);c=c||h(5651);return this.showPopup(c,b)},showPopup:function(b,c,g){b=b||"";c=c||"";var k=$.Deferred();g&&$.isArray(g)&&g.length?$.each(g,function(b,c){if("function"===typeof c.click){var d=c.click;c.click=function(){var b=Array.prototype.slice.call(arguments);b.unshift(k);d.apply(this,b)}}}.bind(this)):g=[{text:h(445),position:"right",tpl:'<button class="popup-button toa-button"></button>',click:function(){k.reject()}}];k.always(function(){l.destroy()});var l=
new d.ui.Popup({title:b,autoOpen:!0,html:c,modal:!0,onClose:function(){l.destroy();k.reject()},buttons:g});l._dom.base.id="toa-usertypes-popup";return k},events:{"click .configured-links":"openEditorVFEorCLE","keydown .configured-links":"openEditorVFEorCLE"},template:'<div class="vfeGeneralDataBindingFilterForm configured-links"><div id="toa-forms-plugins-configured-links-screen"><table border="0" cellpadding="0" cellspacing="0" class="template-contexts jet-css-only-page-content"><caption>'+h(16014)+
"</caption></table></div></div>",template_context:new d.Template(['<tr>  <td class="toa-grid settings-section display" tabindex="0" role="button" aria-label="<%- context_layout_name %> <%- arialabel %>" data-element="context" data-label="<%- context_label %>" data-context="<%- context_id %>" colspan="2"><%- context_layout_name %> <span  class="button_count"></span></td></tr><tr class="context-row hidden" data-context="<%- context_id %>" class="grid-gray-header">    <th scope="col"><%- ut %></th>    <th scope="col" class="btns"><%- buttons %></th>\n</tr><%= context_layout_ut %>']),
template_context_delimiter:new d.Template(['<tr>  <td class="context-row hidden" data-context="<%- context_id %>" colspan="2"></td></tr>']),template_context_next:new d.Template(["<%= context_layout_ut %>"]),template_ut_item:new d.Template(['<tr class="context-row grid-data hidden" data-context="<%- context_id %>">   <td data-usertypelabel="<%- ut_label %>"><%- ut_name %> (<%- ut_label %>)</td>   <td class="btns"><%= template_btns %></td></tr>']),template_shared_ut_item:new d.Template(['<tr class="context-row grid-data hidden" data-context="<%- context_id %>">   <td data-usertypelabel="<%- ut_labels %>"><%= ut_list %></td>   <td class="btns"><%= template_btns %></td></tr>']),
template_ut_button:new d.Template(['<a class="editor <%- disabled %>" tabindex="0" data-element="link" data-ut="<%- ut %>" data-utlabel="<%- ut_label %>" data-layout_id="<%- layout_id %>"  data-item_id="<%- item_id %>" data-context_type="<%- context_type %>"  name="a<%- layout_id %>" data-editor="<%- editor %>"><%- button_name %></a> ']),template_flow:new d.Template(['<tr>  <td class="toa-grid settings-section display" tabindex="0" data-element="flow" data-flow="all" role="button" aria-label="<%- h(225758 /*Flows*/ )%>" colspan="2"><%- h(225758 /*Flows*/ )%></td></tr><tr class="context-row hidden" data-flow="all" class="grid-gray-header">    <th scope="col"><%- flows %></th>    <th scope="col" class="btns"><%- buttons %></th>\n</tr>']),
template_flow_item:new d.Template(['<tr class="context-row grid-data hidden" data-flow="all">   <td><%- flow_name %> (<%- flow_label %>)</td>   <td class="btns"></td></tr>'])}))})(toa);(function(d){d.ns("toa.CompanySettings.Forms.views.Export.BaseView",d.define(null,function(c){this.options=c||{};this.model=this.options.model;this.collectionModel=this.options.collectionModel;this._tpl=new d.Template(this.template)},$.extend({},d.mixins.EventEmitter,{template:"",regions:{},events:{},tag:"",render:function(c,b){b||c.empty();var d=$(this.getHtml());this._container=c;this._$el=0<d.length?d:c;c.append(d);this.initEvents();return this},getData:function(){return this.model&&this.model.toJSON()||
{}},getHtml:function(){return this._tpl.apply(this.getData())},initEvents:function(){$.each(this.events,function(c,b){var d=this._$el,g=c.split(" ");if(1!==g.length&&2!==g.length||!g[0].length)throw Error("Incorrect description of event selector ("+c+")");var k=b;"string"===typeof b&&(k=this[b]);if(!k||"function"!==typeof k)throw Error('Incorrect event handler for selector "'+c+'"');2===g.length&&(d=g[1],d=this._$el.find(d).addBack().filter(d));d.on(g[0],k.bind(this))}.bind(this))},showRegion:function(c,
b){var d=this.regions[c],g=this._container.find(d).first();g.length||console.error("Couldn't find \""+c+'" region ("'+d+'")');b.render(g)},hideRegion:function(c,b){b.hideRegion();this.hideRegionHeading(c)},hideRegionHeading:function(c){this._$el.find(this.regionHeading[c]).hide()},hide:function(){this._$el&&this._$el.hide()},show:function(){this._$el&&this._$el.show()},_notifyOnChild:function(c,b){var d=Array.prototype.slice.call(arguments);d[0]=b;d[1]=c;this.notify.apply(this,d)},_subscribeChildView:function(c){c.addListener("all",
$.proxy(this._notifyOnChild,this,c))},destroy:function(){$.isEmptyObject(this._childViews)||($.each(this._childViews,function(c,b){b.destroy.apply(b)}.bind(this)),this._childViews=[]);this.notify("destroy",this)}})))})(toa);(function(d){var c=d.CompanySettings.Forms.views.Export.BaseView;d.ns("toa.CompanySettings.Forms.views.Export.FilterableItem",d.define(c,function(b){c.apply(this,arguments)},{events:{"click .listItem":"onItemClick"},template:"<div class=\"listItem <%= ('undefined' !== typeof status && '' !== status && 'active' !== status ) ? ' toa-disabled' : '' %>\"><%- translation %></div>",onItemClick:function(b){this.notify("click:listitem",this)}}))})(toa);(function(d){var c=d.CompanySettings.Forms.views.Export.BaseView;d.ns("toa.CompanySettings.Forms.views.Export.FilterableListItem",d.define(c,function(b){c.apply(this,arguments);this.model.addListener("change",this.onChangeModel,this)},{events:{"change .cbFilterableItem":"onChangeState"},template:'<tr data-type="<%- type %>" data-id="<%- id %>"><th class="colCheckbox"><input id="cbFilterableLI-<%- id %>" data-frmListItemId="<%- id %>" class="cbFilterableItem" type="checkbox" <% if (\'undefined\' !== typeof disabled && disabled) {%>disabled="disabled"<% } %> <% if (assigned) {%>checked="checked"<% } %>></th><td><label title="<%- translation %>" for="cbFilterableLI-<%- id %>" <%= (\'undefined\' !== typeof status && \'\' !== status && \'active\' !== status ) ? \'class="toa-disabled"\' : \'\' %>><%- translation %></label></td></tr>',
onChangeModel:function(b,c){this._$el.find(".cbFilterableItem").prop("checked",c.assigned)},onChangeState:function(b){(b=$(b.target).is(":checked"))||$('input[name="filterSelectAll"]').prop("checked",!1);this.setSelectedItems();this.notify("list:change",this.model,b)},setSelectedItems:function(){var b=this._container.find("tr:not(.hidden) .cbFilterableItem:checked").length;$(".selectedElem").text(b)}}))})(toa);(function(d){var c=d.CompanySettings.Forms.views.Export.BaseView;d.ns("toa.CompanySettings.Forms.views.Export.BaseCollectionView",d.define(c,function(b){c.apply(this,arguments);this.collection=this.options.collection;this.model=this.options.model},{template:"",childRegion:"",childView:{},childSeparator:"",render:function(b,d){d||b.empty();this._childViews=[];c.prototype.render.apply(this,arguments);var g=this.getRegionContainer();this._renderCollection(g);this._container=b;return this},getRegionContainer:function(){var b=
this.childRegion;return b?this._container.find(b).first():this._container},_renderCollection:function(b){var c=this.collection.getCount();this.collection.each(function(d,k){var l=new this.childView({model:d,collection:this.collection});this._subscribeChildView(l);this._childViews.push(l);l.render(b,!0);this.childSeparator&&k!==c-1&&b.append(this.childSeparator)},this)},hideRegion:function(){this._container.hide()},applyUpwardHierarchicalPermissions:function(){$.each(this._container.find("div.permission"),
function(b,c){var d=$(c).attr("parent"),d=this._container.find('div.permission[current="'+d+'"]');0<d.length&&!1===d.find(":checkbox").is(":checked")&&$(c).hide()}.bind(this))}}))})(toa);(function(d){var c=d.CompanySettings.Forms.views.Export.BaseCollectionView;d.ns("toa.CompanySettings.Forms.views.Export.FilterableList",d.define(c,function(b){this.filterable=!1!==b.filterable;this.filterSelect=b.filterSelect||!1;c.apply(this,arguments);this.addListener("list:change",this.onChangeAssigned,this)},{events:{"keyup .filterableSearchInput":"onTypeSearch","change .filterForms":"onClickFilterForms","click .clearSearchButton":"onClickClearSearch","change .exportType":"onChangeExportType"},
childRegion:".checkboxTable tbody",childView:d.CompanySettings.Forms.views.Export.FilterableListItem,template:'<div class="filterableList"><p><%= r(227215, {"{EXPORT_BTN}" : h(14622) /*Export*/  }) %></p><input type="radio" id="exportForm" class="exportType" name="exportType" value="form" tabindex="0" checked autofocus /><label for="exportForm" class="filterForms"><%= h(18405/* Export forms */)%></label><input type="radio" id="exportPlugin"  class="exportType" name="exportType" value="plugin" tabindex="0" /><label for="exportPlugin"><%= h(18406/* Export plugins */)%></label><% if (filterable) { %><div class="filterableSearch"><i class="searchIcon"></i><input aria-label="<%-h(13745)%>" placeholder="<%-h(18407 /* Narrow the list below with this filter of forms */)%>" tabindex="0" class="filterableSearchInput" ><i class="clearSearchButton hidden"></i></div><% } %><% if (filterSelect) { %><div class="filterSelectBox"><input id="export-select-all" type="checkbox" tabindex="0" aria-label="<%= h(12033)/*Select all*/ %>" name="filterSelectAll" class="filterForms" /><label for="export-select-all" class="selectAll"><%= h(12033)/*Select all*/ %></label><label class="selectedItems"><%= r(227214, {"{SEL_FROM}" : "<span><span class=\'selectedElem\'>0</span> / <span class=\'allItems\'>0</span></span>"  }) %></label></div><% } %><div class="filterableListSection"><table class="checkboxTable" role="presentation"><caption>'+
h(18390)+"</caption><tbody></tbody></table></div></div>",render:function(b,d){c.prototype.render.apply(this,arguments);this.setItemsEnabled(!1,[]);this.setAllSelectedItems("form");this.defineHiddenItems("form")},getData:function(){var b=c.prototype.getData.apply(this,arguments);b.filterable=this.filterable;b.filterSelect=this.filterSelect;b.countForms=this.collection.models.filter(function(b){return"form"==b.get("type")}).length;return b},onChangeAssigned:function(b,c,d,k){var l=d.get("id"),n=d.get("label");
if(!n)return d.set({assigned:k}),!0;this.collection.each(function(b,c){if(n===b.get("label")){var d={silent:l===b.get("id")};b.set({assigned:k},d)}},this)},onChangeExportType:function(b){this.setItemsEnabled(!1,[]);this.notify("filterable-list:toggle-select-all",{selectAll:!1==$('input[name="filterSelectAll"]').prop("checked")});$('input[name="filterSelectAll"]').prop("checked",!1);this.setPrompt(b.target.value);this.setAllSelectedItems(b.target.value);this.defineHiddenItems(b.target.value);this.onTypeSearch({target:$(".filterableSearchInput")})},
setPrompt:function(b){$(".filterableSearchInput").attr("placeholder",h("plugin"==b?18410:18407))},setAllSelectedItems:function(b){var c=this.collection.models.filter(function(c){return c.get("type")==b}).length;this._$el.find(".allItems").text(c)},defineHiddenItems:function(b){var c=this._container.find(".checkboxTable tr"),d=this;$.each(c,function(c,e){var n=$(e);if(n.data("type")===b){var p=n.find("input").prop("id").replace("cbFilterable-","");d.collection.each(function(b){b.get("id")===parseInt(p)&&
b.set({disabled:!1,assigned:!1})});n.removeClass("hidden")}else n.addClass("hidden")})},onTypeSearch:function(b){b=$(b.target).val().toLowerCase();this._container.find(".error").remove();this.filterList(b);this.notify("filterable-list:toggle-select-all",{selectAll:!0==$('input[name="filterSelectAll"]').prop("checked")});this.notify("list:on_type_search",{})},filterList:function(b){var c=this._container.find("input[name='exportType']:checked").val(),c=this._container.find('.checkboxTable tr[data-type="'+
c+'"]'),d=this._container.find(".clearSearchButton");if(!b)return d.toggleClass("hidden",!0),$.each(c,function(b,c){$(c).toggleClass("hidden",!1)}),!1;d.toggleClass("hidden",!1);$.each(c,function(c,d){var e=$(d),g=-1<e.find("label").text().toLowerCase().indexOf(b);e.toggleClass("hidden",!g)})},onClickFilterForms:function(b){var c=[];this._container.find("tr:not(.hidden) .cbFilterableItem").each(function(b,d){c.push($(d).attr("data-frmListItemId"))});!0==b.target.checked?this.setItemsEnabled(!0,c):
this.setItemsEnabled(!1,[]);this.notify("filterable-list:toggle-select-all",{selectAll:!0==b.target.checked});this.filterHiddenItems();this.notify("list:on_type_search",{});return!1},setItemsEnabled:function(b,c){this.collection.each(function(d,g){if(0<c.length){var n=d.getId();0<=c.indexOf(n.toString())&&(d.set({assigned:b}),d.set({disabled:!1}))}else d.set({assigned:b}),d.set({disabled:!1})});var d=b?this._container.find(".allItems").text():0;this._container.find(".selectedElem").text(d)},filterHiddenItems:function(){var b=
this._container.find(".checkboxTable tr"),c=this;$.each(b,function(b,d){var l=$(d);if(l.hasClass("hidden")){var n=l.find("input").prop("id").replace("cbFilterable-","");c.collection.each(function(b){b.get("id")===parseInt(n)&&b.set({disabled:!0,assigned:!1})})}})},onClickClearSearch:function(b){this._container.find(".clearSearchButton").toggleClass("hidden",!0);this._container.find(".filterableSearchInput").val("");this.filterList();this.notify("filterable-list:toggle-select-all",{selectAll:!0==$('input[name="filterSelectAll"]').prop("checked")});
this.notify("list:on_type_search",{})}}))})(toa);(function(d){var c=d.CompanySettings.Forms.views.Export.FilterableList;d.ns("toa.CompanySettings.Forms.views.Export.FilterableExportList",d.define(c,function(b){c.apply(this,arguments)},{onChangeAssigned:function(b,c,d,k){var l=d.get("id"),n=d.get("label");this.collection.each(function(b,c){if(n===b.get("label")){var d={silent:l===b.get("id")};b.set({assigned:k},d)}},this)}}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.Forms.views.Export.ToastMessage",d.define(c,function(){c.apply(this,arguments)},{template:'<oj-messages class="oj-color-invert" messages="[[messagesDataprovider]]" position.my.vertical="bottom" position.my.horizontal="center" position.at.vertical="bottom" position.at.horizontal="center" display="notification" display-options.category="none"></oj-messages>'}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.Forms.views.Import.FileUploadForm",d.define(c,function(){c.apply(this,arguments)},{fileTypesConfiguration:["application/json"],fileUploadTranslations:{primaryText:null,secondaryText:null,invalidFileTypeError:null,selectedFile:null},render:function(){c.prototype.render.apply(this,arguments);this.initializeUploadConfiguration();this.renderJetComponents()},initializeUploadConfiguration:function(){this.fileUploadTranslations={primaryText:h(227264),
secondaryText:h(227211),invalidFileTypeError:h(18389),selectedFile:h(227162)}},renderJetComponents:function(){var b=this;require(["knockout","ojs/ojbootstrap","ojs/ojknockout","ojs/ojfilepicker","ojs/ojbutton"],function(c,d){b.viewModel=new function(){this.fileTypes=c.observable();this.fileTypes(b.fileTypesConfiguration);this.primaryText=c.observable(b.fileUploadTranslations.primaryText);this.secondaryText=c.observable(b.fileUploadTranslations.secondaryText);this.beforeListener=function(c){$("#selected-fp-file").text(c.detail.files[0].name);
$(".import-form-info").show();$(".import-info-desc").hide();b.clearErrors()}.bind(this);this.selectListener=function(c){$('button[popup_btn_id="validate_btn"]').removeAttr("disabled");b.triggerUpload(c)}.bind(this);this.invalidListener=function(c){$(".import-form-info").hide();for(var d in c.detail.messages)b.errorMessages([b.fileUploadTranslations.invalidFileTypeError])}.bind(this)};d.whenDocumentReady().then(function(){c.applyBindings(b.viewModel,document.querySelector(".form-content-import-container"))})})},
triggerUpload:function(b){this.notify("form-content-import:setFile",{file:b.detail.files[0]})},errorMessages:function(b){if(1>b.length)return this.clearErrors(),!1;for(var c=0,d=[];c<b.length;c++)d.push({id:c+1,message:b[c]});this.clearErrors();this.showErrors(d)},clearErrors:function(){$(".err-node",this.$el).remove();$(".form-content-import-container .import-status").hide();return this},showErrors:function(b){$(".form-content-import-container .import-status").addClass("status-error");$.each(b,function(b,
c){$(".form-content-import-container .import-status ul").append('<li class="err-node">'+c.message+"</li>")}.bind(this));$('button[popup_btn_id="validate_btn"]').attr("disabled",!0);$(".form-content-import-container .import-status").slideDown();return this},template:'<form class="content-import-form" enctype="multipart/form-data" method="POST"><div class="form-content-import-container"><div class="import-status"><ul></ul></div><div class="file-picker"><oj-file-picker max="101" selection-mode="single" primary-text="{{primaryText}}" secondary-text="{{secondaryText}}" accept="[[fileTypes]]" on-oj-select="[[selectListener]]" on-oj-invalid-select="[[invalidListener]]" on-oj-before-select="[[beforeListener]]"></oj-file-picker></div><div class="import-info-desc"><%= h(18411 /* Once you attach a file the application will automatically start uploading and validating it. To finish the operation you\'ll have to click the \'Import\' button. */) %></div><div class="import-form-info">   <label for="selected-file"><%= h(227162 /* Selected file: */) %> </label>   <span class="selected_files_block" id="selected-fp-file"></span></div></div></form>'}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.Forms.views.Import.FileUploadStatusForm",d.define(c,function(){c.apply(this,arguments)},{template:'<div class="import_popup form-import"><div><strong><%= h(22972 /* Details: */) %></strong></div><div class="content"><div class="form-import-statistics"><table><tr><td><%= h(22969 /* Number of errors: */) %></td><td><%- countErrors %></td></tr><tr><td><%= h(22970 /* Number of warnings: */) %></td><td><%- countWarnings %></td></tr><tr><td><%= h(22971 /* Number of notices: */) %></td><td><%- countNotices %></td></tr><tr><td colspan="2"><strong class="status-<%- status %>"><%= h(processStatus) %></strong></td></tr></table></div></div><div><strong><%= h(22973 /* Validation log: */) %></strong></div><div class="content"><div class="form-import-validation-log-wrapper"><div class="form-import-validation-log"></div></div></div></div>',
templateProcessLogItem:new d.Template('<div class="import-log-node log-<%- type %>">;<h5><%= r(message.tid, message.lookup) %></h5>;<% if (snippet) { %>;<pre><%- snippet %></pre>;<% } %>;</div>'.split(";")),render:function(){c.prototype.render.apply(this,arguments);this.logContainer=this.getElement().find(".form-import-validation-log");this.renderProcessLog();return this},renderProcessLog:function(){this.logContainer.empty();$.each(this.model.get("processLog",[]),function(b,c){var d=$(this.templateProcessLogItem.apply({type:c.type||
"",message:c.message||{},snippet:c.snippet||null}));this.logContainer.append(d)}.bind(this))}}))})(toa);(function(d){var c=d.CompanySettings.BaseUploaderView;d.ns("toa.CompanySettings.Forms.views.Import.ImportFileUpload",d.define(c,function(b){this.formLabel=b;this._defaultErrorMessage=h(22955);c.apply(this,arguments)},{jsonFile:null,render:function(){return!1},show:function(){c.prototype.show.apply(this,arguments);this.model=new d.models.BaseModel({formLabel:this.formLabel});this.fileUploadForm=d.create("toa.CompanySettings.Forms.views.Import.FileUploadForm",{model:this.model});this.fileUploadForm.addListener("form-content-import:setFile",
this.setFile,this);console.log(this.popupClass.join(" "));this.popup=new d.ui.Popup({title:h(22952),height:150,autoOpen:!0,view:this.fileUploadForm,popup_extra_css_class:this.popupClass.join(" "),modal:!0,buttons:[{id:"validate_btn",text:h(13295),type:"submit",position:"right",attr:{tabindex:0},click:this.submitUploadForm.bind(this)},{text:h(22953),position:"right",click:this.closeForm.bind(this),attr:{tabindex:0}}],onClose:this.closeForm.bind(this)});this.popup.setPositionCenter();$(window).bind("keydown.import",
this.onKeydown.bind(this));return this},setFile:function(b,c){this.jsonFile=c.file},submitUploadForm:function(){null!=this.jsonFile&&this.setPopupButtonDisabled("validate_btn",!0,!0);this.jsonUploadRequest({method:"importFormContent",params:{fileImport:this.jsonFile,formLabel:this.formLabel},onSuccess:this.onSubmitUploadResponse.bind(this),onError:this.onSubmitUploadError.bind(this)});this.setPopupButtonDisabled("validate_btn",!1,!0)},jsonUploadRequest:function(b){var c=new FormData;b&&b.params&&
$.each(b.params,function(b,d){c.append(b,d)});var g=GetSessId();c.append(g.substr(0,g.indexOf("=")),g.substr(g.indexOf("=")+1,g.length-g.indexOf("=")));g=d.Ajax.prototype.route("formsconfiguration",b.method);$.ajax({type:"POST",url:g+"&output=ajax",data:c,dataType:"json",cache:!1,processData:!1,contentType:!1,success:b.onSuccess,error:b.onError})},onSubmitUploadResponse:function(b){if(b&&b.status&&"ERR"!==b.status)"NOT_UPLOADED"===b.status?(c=b.errorMsg||(b.errorCode?h(b.errorCode):""),this.showUploadError(c)):
(this.model.set({fileName:b.fileName||"",status:b.status||"",processStatus:b.processStatus||"",processLog:b.processLog||[],countErrors:b.countErrors||0,countWarnings:b.countWarnings||0,countNotices:b.countNotices||0}),this.notify("import.validate",this.model),this.closeForm());else{var c=null;"undefined"!==typeof b.error_code&&0<b.error_code&&(c=h(b.error_code));this.showUploadError(c)}},onSubmitUploadError:function(){this.showUploadError()},showUploadError:function(b){b=b||this._defaultErrorMessage;
this.setErrorMessages([b]);this.setPopupButtonDisabled("validate_btn",!1,!0)},setPopupButtonDisabled:function(b,c,d){if(b=this.popup._dom.buttons[b])$(b).toggleClass("toa-button-disable",c),d&&c?$(b).removeClass("toa-button-active"):d&&!c&&$(b).addClass("toa-button-active")},setErrorMessages:function(b){if(1>b.length)return this.popup.removeErrors(),!1;for(var c=0,d=[];c<b.length;c++)d.push({id:c+1,message:b[c]});this.clearErrors();this.showErrors(d)},clearErrors:function(){$(".err-node",this.$el).remove();
$(".import-status").hide();return this},showErrors:function(b){$.each(b,function(b,c){$(".import-status ul").append('<li class="err-node">'+c.message+"</li>")}.bind(this));$(".import-status").show();return this},onKeydown:function(b){13==b.keyCode&&this.submitUploadForm()},closeForm:function(){c.prototype.closeForm.apply(this,arguments);this.popup.destroy()},destroy:function(){$(window).unbind("keydown.import");this.popup=null}}))})(toa);(function(d){var c=d.CompanySettings.BaseUploaderView;d.ns("toa.CompanySettings.Forms.views.Import.ImportFileUploadStatus",d.define(c,function(){c.apply(this,arguments)},{render:function(){return!1},show:function(){c.prototype.show.apply(this,arguments);var b=this.model.get("fileName",""),b=b?r(22974,{"{FILE_NAME}":b}):h(22952);this.importView=d.create("toa.CompanySettings.Forms.views.Import.FileUploadStatusForm",{model:this.model});this.popup=new d.ui.Popup({title:b,autoOpen:!0,modal:!0,view:this.importView,
popup_extra_css_class:this.popupClass.join(" "),onClose:this.closeForm.bind(this),buttons:[{id:"close_btn",text:h(13305),display:!0,type:"submit",position:"right",click:this.closeForm.bind(this)}]});this.popup.setPositionCenter();$(this.popup._dom.buttons.close_btn).removeClass("toa-button-active");return this},closeForm:function(){c.prototype.closeForm.apply(this,arguments);this.notify("import.finish");this.popup.destroy()},destroy:function(){this.popup=null}}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.Forms.views.ImportBulk.FileUploadForm",d.define(c,function(){c.apply(this,arguments)},{template:'<form class="forms-bulk-import-form content-import-form" method="POST" enctype="multipart/form-data"><div class="bulk-import-container"><div class="import-status"><ul></ul></div><div id="bulkImportFormProgressBar" class="progress-bar"><oj-progress-bar value="{{progressValue}}"></oj-progress-bar><div class="progress-bar-status"></div></div><div class="file-picker"><oj-file-picker max="101" selection-mode="single" primary-text="{{primaryText}}" secondary-text="{{secondaryText}}" accept="[[fileTypes]]" on-oj-select="[[selectListener]]" on-oj-invalid-select="[[invalidListener]]" on-oj-before-select="[[beforeListener]]"></oj-file-picker></div><div class="import-info-desc"><%= h(18411 /* Once you attach a file the application will automatically start uploading and validating it. To finish the operation you\'ll have to click the \'Import\' button. */) %></div><div class="import-form-info"><label><%= h(227162 /* Selected file: */) %></label><div class="selected-file-name"></div></div><div class="validation-section-stats"><ul class="validation-info"><li class="errors empty"></li><li class="warnings empty"></li><li class="notices empty"></li></ul></div><div class="import-caution"><%= h(18402 /* Forms containing warnings and notices can be imported but with some flaws. */) %></div><div class="validation-section-forms"></div></div></form>',
getFileType:function(){return this.model.get("fileType")},getFileName:function(){return this.model.get("fileName")}}))})(toa);(function(d){var c=d.CompanySettings.BaseUploaderView;d.ns("toa.CompanySettings.Forms.views.ImportBulk.ImportUploadForm",d.define(c,function(b){c.apply(this,arguments)},{popup:null,options:{},render:function(){return!1},destroy:function(){$(window).unbind("keydown.import");this.popup&&this.popup.destroy();this.popup=null},errorMessages:function(b){if(1>b.length)return this.popup.removeErrors(),!1;this.popup.enableButton("cancel_btn");for(var c=0,d=[];c<b.length;c++)d.push({id:c+1,message:b[c]});this.clearErrors();
this.showErrors(d)},clearErrors:function(){$(".err-node",this.$el).remove();$(".forms-bulk-import-form .import-status").removeClass("status-error");$(".forms-bulk-import-form .import-status").hide();return this},showErrors:function(b){$(".bulk-import-container .import-status").addClass("status-error");$.each(b,function(b,c){$(".bulk-import-container .import-status ul").append('<li class="err-node">'+c.message+"</li>")}.bind(this));$(".forms-bulk-import-form .import-status").slideDown();this.popup.enableButton("cancel_btn");
return this},fileUploadModel:null,fileUploadView:null,show:function(b){c.prototype.show.apply(this,arguments);this.options=b;this.fileUploadModel=new d.models.ObservableModel;this.fileUploadView=d.create("toa.CompanySettings.Forms.views.ImportBulk.FileUploadForm",{model:this.fileUploadModel});this.popup=new d.ui.Popup({view:this.fileUploadView,title:h(227300),autoOpen:!1,modal:!0,popup_extra_css_class:this.popupClass.join(" "),buttons:[{id:"import_btn",text:h(11955),type:"submit",position:"right",
click:this.triggerImport.bind(this)},{id:"done_btn",text:h(12252),position:"right",click:this.closeForm.bind(this)},{id:"cancel_btn",text:h(14621),position:"right",click:this.closeForm.bind(this)}],onClose:this.closeForm.bind(this)});this.popup.disableButton("import_btn");$('button[popup_btn_id="import_btn"]').attr("disabled",!0);$('button[popup_btn_id="done_btn"]').attr("disabled",!0).hide();this.popup.show();this.renderJetComponents();this.popup.setPositionCenter()},isValidSelectedFile:function(b){if(!b)return this.errorMessages([h(12100)]),
!1;if(-1===["application/zip","application/octet-stream","application/x-zip-compressed","multipart/x-zip"].indexOf(b.type))return this.errorMessages([h(227261)]),!1;var c=this.options&&this.options.maxFileSize?this.options.maxFileSize:null;return c&&c<b.size?(this.errorMessages([r(227294,{"{FILE_SIZE}":this.formatFileSize(c)})]),!1):!0},triggerUpload:function(b){this.isValidSelectedFile(b.detail.files[0])&&($(".forms-bulk-import-form .file-picker").hide(),$(".forms-bulk-import-form .progress-bar .progress-bar-status").text(h(227296)),
this.updateProgressTo(-1),$(".forms-bulk-import-form .progress-bar").slideDown(),this.notify("bulk-import:upload",{file:b.detail.files[0]}))},uploadError:function(){this.updateProgressTo(-1);this.popup.enableButton("cancel_btn");$(".forms-bulk-import-form .progress-bar").slideUp(100,function(){$(".forms-bulk-import-form .file-picker").slideDown()})},metadataMisssingError:function(){this.updateProgressTo(-1);this.popup.enableButton("cancel_btn");this.errorMessages([h(227260)]);$(".forms-bulk-import-form .progress-bar").slideUp(100,
function(){$(".forms-bulk-import-form .file-picker").slideDown()})},sessionExpireError:function(){this.updateProgressTo(-1);this.popup.enableButton("cancel_btn");$(".forms-bulk-import-form .progress-bar").slideUp();this.errorMessages([h(227295)])},triggerImport:function(b){this.popup.disableButton("cancel_btn");this.popup.disableButton("import_btn");this.notify("bulk-import:import",{import_session_id:this.importSessionId});$(".form-import-bulk .popup-content").scrollTop(0);$(".forms-bulk-import-form .progress-bar .progress-bar-status").text(h(227298));
var c=this;$(".forms-bulk-import-form .import-caution").hide(100,function(){c.updateProgressTo(0);$(".forms-bulk-import-form .progress-bar").slideDown(400,function(){c.updateProgressTo(-1)})})},closeForm:function(b){c.prototype.closeForm.apply(this,arguments);this.popup&&this.popup.destroy();this.popup=null;this.formsRendered=!1;$(".company_settings_forms_and_plugins-menu").focus();this.notify("bulk-import:finish",{import_session_id:this.importSessionId});this.destroy()},importSessionId:null,importSession:function(b){this.importSessionId=
b;return this},progressBarElement:null,updateProgressTo:function(b){if("undefined"===typeof b||null===b)b=-1;this.progressBarElement.progressValue(b)},metadataValidationStats:function(b,c){return b.stats&&b.stats[c]?b.stats[c]:0},formatDate:function(b){return b},formatFileSize:function(b){return 0.01*Math.round(100*b/1024/1024+Number.EPSILON)},redrawFile:function(b){b.file&&($(".import-info-desc").hide(),$(".import-form-info .selected-file-name").empty().html(r(18409,{"{FILE_NAME}":'<strong><span class="import-form-info-file-name"></span></strong>',
"{DATE}":this.formatDate(b.file.date),"{TIME}":this.formatDate(b.file.time)})).find(".import-form-info-file-name").text(b.file.name),$(".import-form-info").slideDown())},redrawValidationStats:function(b){b.stats&&($(".validation-info").find("li.errors").text(r(227212,{"{NUMBER}":b.stats.errors})),$(".validation-info").find("li.warnings").text(r(227213,{"{NUMBER}":b.stats.warnings})),$(".validation-info").find("li.notices").text(r(18404,{"{NUMBER}":b.stats.notices})),$(".validation-section-stats").slideDown(400,
function(){0<b.stats.errors&&$(".validation-info li.errors").removeClass("empty");0<b.stats.warnings&&$(".validation-info li.warnings").removeClass("empty");0<b.stats.notices&&$(".validation-info li.notices").removeClass("empty")}))},formsRendered:!1,redrawValidationForms:function(b){if(b.forms){var c=this;"validated"===b.status&&$("div.validation-section-forms").slideDown(400,function(){c.movePopupInScreenCenter()});c.formsRendered?c.patchValidationForms(b):($("div.validation-section-forms").empty().html(this.validationReportFormsTpl().apply({listOfForms:b.forms,
countForms:Object.keys(b.forms).length})).show(100,function(){0<$(".form-popup-xs").length&&c.movePopupInScreenCenter()}),c.formsRendered=!0,$(".form-list li label").on("click keydown",function(b){if("undefined"===typeof b||"keydown"!==b.type||13===b.keyCode)b.preventDefault=!0,b.stopPropagation(),$(this).hasClass("non-empty")&&($(this).toggleClass("selected"),$('div[data-validation-for="'+this.dataset.validationFor+'"]').slideToggle(400,function(){c.movePopupInScreenCenter()}))}))}},patchValidationForms:function(b){if(b.validation){var c,
d,k;for(k in b.validation)d=b.validation[k],this.patchValidationFormStats(k,d.stats),c='[data-validation-for="'+k+'"].form-import-validation-log',$(c).empty().html(this.validationLogEntryTpl().apply({validationLog:d.log}))}},patchValidationFormStats:function(b,c){var d='[data-validation-for="'+b+'"].form-import-validation-stats';c.errors?$(d).find(".log-errors").text("( "+c.errors+" )"):$(d).find(".log-errors").hide();c.warnings?$(d).find(".log-warnings").text("( "+c.warnings+" )"):$(d).find(".log-warnings").hide();
c.notices?$(d).find(".log-notices").text("( "+c.notices+" )"):$(d).find(".log-notices").hide();if(c.errors||c.warnings||c.notices)$('label[data-validation-for="'+b+'"]').addClass("non-empty"),$(d).slideDown()},validationLogEntryTpl:function(){return new d.Template(['<% for (var i in validationLog) { var log = validationLog[i]; %><div class="import-log-node log-<%- log.type %>"><h5><%= r(log.message.tid, log.message.lookup) %></h5><% if (log.snippet) { %><pre><%- log.snippet %></pre><% } %></div><% } %>'])},
validationReportFormsTpl:function(){return new d.Template(["<h3>"+r(227263,{"{FRM_NUMBER}":'<span class="forms-count">(<%= countForms %>)</span>'})+'</h3><ul class="form-list"><% for (var signature in listOfForms) {  var form = listOfForms[signature]; %><li><label tabindex="0" data-validation-for="<%= signature %>" title="<%= form.name %>"><%= form.name %></label><span title="<%= form.label %>"><%= form.label %></span><div class="form-import-validation-stats" data-validation-for="<%= signature %>"><span class="log-errors"></span><span class="log-warnings"></span><span class="log-notices"></div></div><div class="form-import-validation-log" data-validation-for="<%= signature %>"></div></li><% } %></ul>'])},
fileMetadata:function(b){this.redrawFile(b);this.redrawValidationStats(b);this.redrawValidationForms(b);switch(b.status){case "uploaded":return this.metadataUploadComplete(b);case "validated":return this.metadataValidationComplete(b);case "imported":return this.metadataImportComplete(b)}},metadataUploadComplete:function(b){$(".forms-bulk-import-form .progress-bar .progress-bar-status").text(h(227297));$(".forms-bulk-import-form .progress-bar").slideDown()},metadataValidationComplete:function(b){var c=
0<this.metadataValidationStats(b,"errors"),d=0<this.metadataValidationStats(b,"warnings");b=0<this.metadataValidationStats(b,"notices");(d||b)&&$(".forms-bulk-import-form .import-caution").show();$("ul.validation-info li.empty").hide();var k=this;$(".forms-bulk-import-form .progress-bar").slideUp(100,function(){$('button[popup_btn_id="import_btn"]').hide();k.popup.enableButton("cancel_btn");c?$(".forms-bulk-import-form .import-status").addClass("status-error").html(h(18403)).show(100,function(){k.movePopupInScreenCenter()}):
($('button[popup_btn_id="import_btn"]').removeAttr("disabled").attr("data-validated","true").show(),k.popup.enableButton("import_btn"))})},metadataImportComplete:function(b){$('button[popup_btn_id="import_btn"]').attr("disabled",!0).hide();$('button[popup_btn_id="cancel_btn"]').attr("disabled",!0).hide();$('button[popup_btn_id="done_btn"]').attr("disabled",!1).show();var c=0<this.metadataValidationStats(b,"errors"),d=this;$(".forms-bulk-import-form .progress-bar").slideUp(100,function(){c?d.movePopupInScreenCenter():
$(".forms-bulk-import-form .import-status").addClass("status-success").html(h(13297)).slideDown(400,function(){d.movePopupInScreenCenter();$('[popup_btn_id="done_btn"]').focus()})})},movePopupInScreenCenter:function(b){"undefined"!=typeof b||this.isInViewport(".jet-css-only.popup-buttons")?"undefined"!==typeof b&&b&&this.popup.setPositionCenter():this.popup.setPositionCenter()},isInViewport:function(b){var c=$(b).offset();b=c.top+$(b).outerHeight();return 0<c.top&&0<c.left&&window.innerHeight<b?!1:
!0},renderJetComponents:function(){var b=this;require("knockout ojs/ojbootstrap ojs/ojknockout ojs/ojfilepicker ojs/ojbutton ojs/ojprogress-bar".split(" "),function(c,d){b.progressBarElement=new function(){this.progressValue=c.observable();this.progressValue(0);this.fileTypes=c.observable();this.fileTypes(["application/zip","application/x-zip-compressed"]);this.primaryText=c.observable(h(227264));this.secondaryText=c.observable(h(227265));this.beforeListener=function(c){b.clearErrors()}.bind(this);
this.selectListener=function(c){b.triggerUpload(c)}.bind(this);this.invalidListener=function(c){for(var d in c.detail.messages)b.errorMessages([c.detail.messages[d].summary])}.bind(this)};d.whenDocumentReady().then(function(){c.applyBindings(b.progressBarElement,document.querySelector(".bulk-import-container"))})})}}))})(toa);(function(d){var c=d.classes.DataMapper;d.ns("toa.CompanySettings.Forms.classes.ListItemDataMapper",d.define(c,function(b){c.apply(this,arguments)},{_modelConstructor:d.CompanySettings.Forms.models.Form,_serverRemoveMethod:"removeForm",_serverIdField:"form_id"}))})(toa);(function(d,c){var b=d.classes.CollectionDataMapper;d.ns("toa.CompanySettings.Forms.classes.ListDataMapper",d.define(b,function(c,d){b.apply(this,arguments)},{_modelConstructor:d.CompanySettings.Forms.models.SortableCollection,_serverGetMethod:"getFormsList",_serverGetField:"forms",load:function(c,d){return b.prototype.load.apply(this,arguments)}}))})(toa,$);(function(d,c){var b=d.classes.DataMapper;d.ns("toa.CompanySettings.Forms.classes.FormDataMapper",d.define(b,function(c){b.apply(this,arguments)},{_modelConstructor:d.CompanySettings.Forms.models.Form,_serverGetMethod:"getForm",_serverSaveMethod:"saveForm",_serverRemoveMethod:"removeForm",_serverGetField:"form",_serverIdField:"form_id"}))})(toa,$);(function(d){var c=d.classes.DataMapper;d.ns("toa.CompanySettings.Forms.classes.InitialDataMapper",d.define(c,function(b){c.apply(this,arguments)},{_modelConstructor:d.models.BaseModel,_serverGetMethod:"getInitialData",_serverGetField:"initial_data"}))})(toa);(function(d){var c=d.models.BaseCollection;d.ns("toa.CompanySettings.Plugins.models.SortableCollection",d.define(c,function(b){c.apply(this,arguments);this.sortedFieldsTypes={string:"string",date:"date"};this.sortedField={value:"name",type:"string"};b&&this.load(b)},{comparator:function(b,c){var d=this.__getSortedValue(b)||+b.id,k=this.__getSortedValue(c)||+c.id;return this.__compareValues(d,k)},__getSortedValue:function(b){switch(this.sortedField.type){case this.sortedFieldsTypes.date:return new Date(b.get(this.sortedField.value));
default:return b.get(this.sortedField.value)}},__compareValues:function(b,c){switch(this.sortedField.type){case this.sortedFieldsTypes.date:return c-b;default:return b==c?0:b?c?b.toLowerCase()<c.toLowerCase()?-1:1:1:-1}},setSortedField:function(b,c){this.sortedField.value=b;this.sortedField.type=c},sort:function(b){},load:function(b){var c,d=b.length;for(c=0;c<d;c++)-1==this.indexOf(b[c])&&this.add(b[c],{silent:!0,doNotAutoSort:!0});this.sort({silent:!0});this.notify("load")}}))})(toa);(function(d){var c=d.models.BaseModel;d.ns("toa.CompanySettings.Plugins.models.Property",d.define(c,function(){c.apply(this,arguments)},{idField:"propertyId"}))})(toa);(function(d){var c=d.models.BaseCollection;d.ns("toa.CompanySettings.Plugins.models.PropertyCollection",d.define(c,function(){c.apply(this,arguments)},{modelConstructor:d.CompanySettings.Plugins.models.Property}))})(toa);(function(d){var c=d.models.BaseModel;d.ns("toa.CompanySettings.Plugins.models.Plugin",d.define(c,function(){c.apply(this,arguments)},{idField:"alid",_defaultUnit:"kb",pick:function(b){for(var c={},d,k=0,l=b.length;k<l;k++)d=b[k],c[d]=this.getModelField(d);return c},reset:function(b,e){var g=d.mixin({},this.getDefaultData(),b||{});return c.prototype.reset.apply(this,[g,e])},setDefault:function(){this.set(this.getDefaultData())},getDefaultData:function(){return{label:"",translations:{},name:"",entity:0,
"interface":null,baseAction:"",type:"external",useApi:!1,isHosted:!1,pluginPath:"",postData:"",isOnline:!1,serverScript:!1,isTab:!1,showScroll:!1,windowWidth:null,windowHeight:null,authType:"basic",authLogin:"",authPassword:"",archive:null,secureParams:[],versions:[],nativeApp:[],pluginHostedId:null}},getDefaultField:function(b){return this.getDefaultData()[b]||""},isRemovable:function(){return this.isInternal()||0<parseInt(this.get("count_links",0),10)+parseInt(this.get("cml_count_links",0),10)?
!1:!0},convertSize:function(b){b=b||this._defaultUnit;var c=parseInt(this.get("content_size",0),10);"kb"===b&&(c=Math.round(100*c/1024)/100);return c},getFormattedDate:function(){var b=this.get("updated_at",""),c="";b&&(c=d.date.formatDate(d.date.format.iso_long,d.date.currentDate()),c=d.date.formatAdaptive(b,c));return c},getPluginName:function(b){return(b=b||null)?this.getTranslations()[b]||"":this.get("name","")},setData:function(b){null===b&&(b=this.getDefaultData());this.reset(b)},setField:function(b,
c,d){var k={},l={};l[b]=c;d&&(k.silent=!0);this.set(l,k)},setName:function(b,c){var d=this.getTranslations();d[b]=c;this.setField("translations",d)},getModelField:function(b,c){c="undefined"!==typeof c?c:this.getDefaultField(b);return this.get(b,c)},getTranslations:function(){return this.getModelField("translations")},getLabel:function(){return this.getModelField("label")},getType:function(){return this.getModelField("type")},getEntity:function(){return parseInt(this.getModelField("entity"),10)},
getInterface:function(){return parseInt(this.getModelField("interface"),10)},getBaseAction:function(){return this.getModelField("baseAction")},getPluginPath:function(){return this.getModelField("pluginPath")},getPostData:function(){return this.getModelField("postData")},getWidth:function(){return this.getModelField("windowWidth")},getHeight:function(){return this.getModelField("windowHeight")},getAuthType:function(){return this.getModelField("authType")},getSecuredData:function(){return this.getModelField("secureParams")},
getVersions:function(){return this.getModelField("versions")},getNativeAppData:function(){return this.getModelField("nativeApp")},isUseApi:function(){return!0===this.getModelField("useApi")},isHostedPlugin:function(){return!0===this.getModelField("isHosted")},hasHostedId:function(){return!!this.getModelField("pluginHostedId")},isNativeApp:function(){return"external_native"===this.getType()},isInternal:function(){return"internal"===this.getType()},isExternal:function(){return"external"===this.getType()},
isAddon:function(){return this.isExternal()&&this.isUseApi()},isBasicAuthentication:function(){return"basic"===this.getAuthType()},isHmacAuthentication:function(){return"hmac"===this.getAuthType()},getAuthLogin:function(){return this.getModelField("authLogin")},getAuthPassword:function(){return this.getModelField("authPassword")},hasArchive:function(){return!!this.getArchive()},getArchive:function(){return this.getModelField("archive")}}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.Plugins.views.Plugin",d.define(c,function(){c.apply(this,arguments);this.languageCollection=[]},{_mandatoryLanguageId:1,_validationErrors:[],events:{"change input.frmLabel":"onChangeLabel"},setLanguageCollection:function(b){this.languageCollection=b},render:function(b,d){c.prototype.render.apply(this,arguments);this.afterRender();return this},afterRender:function(){var b=this.getElement().find(".languageContainer");$.each(this.languageCollection,
function(c,g){var k={isMandatory:this.isMandatoryLanguage(g.id),languageId:g.id,languageLabel:g.label,languageName:g.name,pluginName:this.model.getPluginName(g.id)},l=new d.Template(this.templateLanguage),k=$(l.apply(k));b.append(k)}.bind(this));this.readOnlyMode&&this.getElement().find("input").prop("readonly",!0);this.getElement().find("input.frmName").change(this.onChangeName.bind(this))},isMandatoryLanguage:function(b){return this._mandatoryLanguageId===b},onChangeLabel:function(b){b=$(b.target).val();
this.model.set({label:b})},onChangeName:function(b){var c=$(b.target).val();b=parseInt($(b.target).parent(".controls").parent(".control-group").data("language"),10);var d=this.model.get("translations",{});d[b]=c;this.model.set({translations:d})},validate:function(){var b=[];""===this.model.getFormName(this._mandatoryLanguageId)&&b.push(h(22633));""===this.model.get("label","")&&b.push(h(22634));this._validationErrors=b;return b.length?!1:!0},getValidationErrors:function(){return this._validationErrors},
template:'<form class="toa-form-horizontal add-form"><div class="form-group"><div class="languageContainer"></div><div class="control-group"><label class="control-label"><span class="asterisk">&#42;</span><%= h(19107)/* Scenario Label */ %></label><div class="controls"><input type="text" aria-label="Plugin label" name="formLabel" class="frmLabel" autofocus tabindex="0" value="<%- label %>" maxlength="40" /></div></div></div></form>',templateLanguage:'<div class="control-group" data-language="<%- languageId %>" data-language-label="<%- languageLabel %>"><label class="control-label"><% if (true === isMandatory) { %><span class="asterisk">&#42;</span><% } %><%- languageName %></label><div class="controls"><input type="text" aria-label="Plugin name" autofocus name="formName_<%- languageId %>" tabindex="0" lang="<%- languageLabel %>" value="<%- formName %>" class="frmName<%- (isMandatory ? " required" : "") %>" maxlength="255" /></div></div>'}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.Plugins.views.NoItems",d.define(c,function(){c.apply(this,arguments)},{template:'<tr><td class="emptySection formItemCell noForms"><%= h(22629)/* No forms */ %></td></tr>'}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.Plugins.views.PluginItem",d.define(c,function(){c.apply(this,arguments)},{events:{"click .pluginName":"actionModify","click .linksCountNotNull":"actionDisplayConfiguredLinks"},template:'<tr><td class="formItemCell pluginIcon"><div class="icon" role="img" aria-label="'+h(18178)+'"></div></td><th class="formItemCell cellName" scope="row"><a class="pluginName" name="mp<%- alid %>" tabindex="0"><%- text %></a></th><td class="formItemCell cellLabel"><div class="formLabel"><%- label %></div></td><td class="formItemCell cellData"><div class="formDataRow"><div class="formDataCell dataTitle"><%= h(18150/* Type: */) %></div><div class="formDataCell dataValue"><%- plugin_type %></div></div><% if (url != "") { %><div class="formDataRow"><div class="formDataCell dataTitle"><%= h(18151/* URL: */) %></div><div class="formDataCell dataValue"><%- url %></div></div><% } %><% if (names != "") { %><div class="formDataRow"><div class="formDataCell dataTitle"><%= h(18152/* Names: */) %></div><div class="formDataCell dataValue"><%- names %></div></div><% } %><% if (name != "") { %><div class="formDataRow"><div class="formDataCell dataTitle"><%= h(18154/* Name: */) %></div><div class="formDataCell dataValue"><%- name %></div></div><% } %></td><td class="formItemCell cellLinks"><% if (0 < count_links || 0 < cml_count_links) { %><a name="cl<%- alid %>" tabindex="0"><div class="linksCount linksCountNotNull"><%- (count_links + cml_count_links) %></div><div><%= h(22621/* Configured links */) %></div></a><% } else { %><div><%= h(22635 /* No links configured. */) %></div><% } %></td><td class="formItemCell formTools"></td></tr>',
render:function(b,d){c.prototype.render.apply(this,arguments);this.showPluginMenu();return this},getData:function(){var b=c.prototype.getData.apply(this,arguments);b.content_size=this.model.convertSize();return b},showPluginMenu:function(){var b=[];this.readOnlyMode||this.model.isInternal()?(b.push({name:"actionView",addClass:"toa-dropdown-item",attr:{"aria-label":h(8047),"aria-labelledby":h(8047),tabindex:0},text:h(8047)}),this.model.isInternal()||b.push({name:"actionExport",addClass:"toa-dropdown-item",
attr:{"aria-label":h(22628),"aria-labelledby":h(22628),tabindex:0},text:h(22628)})):(b.push({name:"actionModify",addClass:"toa-dropdown-item",attr:{"aria-label":h(22644),"aria-labelledby":h(22644),tabindex:0},text:h(22644)}),b.push({name:"actionExport",addClass:"toa-dropdown-item",attr:{"aria-label":h(22628),"aria-labelledby":h(22628),tabindex:0},text:h(22628)}),b.push({name:"actionDelete",addClass:"toa-dropdown-item",attr:{"aria-label":h(22626),"aria-labelledby":h(22626),tabindex:0},text:h(22626)}));
this.menuButton=d.view.control.create({xtype:"button.Menu",name:"pluginMenuButton",text:h(3514),addClass:"toa-item-menu-button",attr:{"aria-haspopup":"true"},icon:"toa-item-menu-icon",menuItems:b,listeners:{menuItemClick:this.actionMenuItemClick.bind(this)}});this.menuButton.render(this._$el.find(".formItemCell.formTools"))},actionMenuItemClick:function(b,c){var d=Array.prototype.slice.call(arguments);d[0]=b;this[c.name].apply(this,d)},actionView:function(b){this.notify("pluginaction:view",b,this.model)},
actionModify:function(b){var c=this.readOnlyMode||this.model.isInternal()?"view":"modify";this.notify("pluginaction:"+c,b,this.model);b.preventDefault()},actionExport:function(b){this.notify("pluginaction:export",b,this.model)},actionDelete:function(b){if(this.readOnlyMode)return!1;this.notify("pluginaction:delete",b,this.model)},actionDisplayConfiguredLinks:function(b){this.notify("pluginaction:displayPluginLinks",b,this.model);b.preventDefault()}}))})(toa);(function(d){var c=d.views.BaseCollectionView;d.ns("toa.CompanySettings.Plugins.views.PluginsList",d.define(c,function(){c.apply(this,arguments)},{idFieldName:"id",template:'<table class="pluginsListContainer" style="width: 100%;" ><caption style="display: none"><%= h(18182 /* Plugins */) %></caption><tr><td style="font-size: 0px;" colspan="6"><%= h(18182 /* Plugins */) %></td></tr></table>',childView:d.CompanySettings.Plugins.views.PluginItem,childRegion:".pluginsListContainer",noItemsView:d.CompanySettings.Plugins.views.NoItems,
setCollection:function(b){this.collection=b}}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.Plugins.views.Import.FileUploadPlugins",d.define(c,function(){c.apply(this,arguments)},{containerSelector:".plugin-import-jet-container",containerErrorBlockSelector:".plugin-import-jet-container .import-status",fileTypesConfiguration:["application/xml","text/xml"],fileUploadTranslations:{primaryText:null,secondaryText:null,invalidFileTypeError:null,selectedFile:null},render:function(){c.prototype.render.apply(this,arguments);this.initializeUploadConfiguration();
this.renderJetComponents()},initializeUploadConfiguration:function(){this.fileUploadTranslations={primaryText:h(227264),secondaryText:h(227210),invalidFileTypeError:h(18396),selectedFile:h(227162)}},renderJetComponents:function(){var b=this;require(["knockout","ojs/ojbootstrap","ojs/ojknockout","ojs/ojfilepicker","ojs/ojbutton"],function(c,d){b.viewModel=new function(){this.fileTypes=c.observable();this.fileTypes(b.fileTypesConfiguration);this.primaryText=c.observable(b.fileUploadTranslations.primaryText);
this.secondaryText=c.observable(b.fileUploadTranslations.secondaryText);this.beforeListener=function(c){$("#selected-fp-file").text(c.detail.files[0].name);$(".import-form-info").show();b.clearErrors()}.bind(this);this.selectListener=function(c){$('button[popup_btn_id="validate_btn"]').removeAttr("disabled");b.triggerUpload(c)}.bind(this);this.invalidListener=function(c){$(".import-form-info").hide();for(var d in c.detail.messages)b.errorMessages([b.fileUploadTranslations.invalidFileTypeError])}.bind(this)};
d.whenDocumentReady().then(function(){c.applyBindings(b.viewModel,document.querySelector(".plugin-import-jet-container"))})})},triggerUpload:function(b){this.notify("plugin-import:setFile",{file:b.detail.files[0]})},errorMessages:function(b){if(1>b.length)return this.clearErrors(),!1;for(var c=0,d=[];c<b.length;c++)d.push({id:c+1,message:b[c]});this.clearErrors();this.showErrors(d)},clearErrors:function(){$(".err-node",this.$el).remove();$(".plugin-import-jet-container .import-status").hide();return this},
showErrors:function(b){$(this.containerErrorBlockSelector).addClass("status-error");$.each(b,function(b,c){$(this.containerErrorBlockSelector+" ul").append('<li class="err-node">'+c.message+"</li>")}.bind(this));$(this.containerErrorBlockSelector).slideDown();$('button[popup_btn_id="validate_btn"]').attr("disabled",!0);return this},template:'<form class="content-import-form" enctype="multipart/form-data" method="POST"><div class="plugin-import-jet-container"><div class="import-status"><ul></ul></div><div class="file-picker"><oj-file-picker max="101" selection-mode="single" primary-text="{{primaryText}}" secondary-text="{{secondaryText}}" accept="[[fileTypes]]" on-oj-select="[[selectListener]]" on-oj-invalid-select="[[invalidListener]]" on-oj-before-select="[[beforeListener]]"></oj-file-picker></div><div class="import-info-desc"><%= h(18411 /* Once you attach a file the application will automatically start uploading and validating it. To finish the operation you\'ll have to click the \'Import\' button. */) %></div><div class="import-form-info">   <label for="selected-file"><%= h(227162 /* Selected file: */) %> </label>   <span class="selected_files_block" id="selected-fp-file"></span></div></div></form>'}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.Plugins.views.Import.FileUploadStatusPlugins",d.define(c,function(){c.apply(this,arguments)},{template:'<div class="import_popup form-import"><div><strong><%= h(22972 /* Details: */) %></strong></div><div class="content"><div class="form-import-statistics"><table><tr><td><%= h(20564 /* Number of not valid items: */) %></td><td><%- countErrors %></td></tr><tr><td><%= h(20565 /* Number of valid items: */) %></td><td><%- validCount %></td></tr></table></div></div></div>',
templateProcessLogItem:new d.Template('<div class="import-log-node <%- type %>">;<h5><%= r(message.tid, message.lookup) %></h5>;<% if (snippet) { %>;<pre><%- snippet %></pre>;<% } %>;</div>'.split(";")),render:function(){c.prototype.render.apply(this,arguments);this.logContainer=this.getElement().find(".form-import-validation-log");this.renderProcessLog();return this},renderProcessLog:function(){this.logContainer.empty();$.each(this.model.get("processLog",[]),function(b,c){var d=$(this.templateProcessLogItem.apply({type:c.type||
"",message:c.message||{},snippet:c.snippet||null}));this.logContainer.append(d)}.bind(this))}}))})(toa);(function(d){var c=d.CompanySettings.BaseUploaderView;d.ns("toa.CompanySettings.Plugins.views.Import.ImportFileUpload",d.define(c,function(b){this._defaultErrorMessage=h(22955);c.apply(this,arguments)},{xmlFile:null,render:function(){return!1},show:function(){c.prototype.show.apply(this,arguments);this.model=new d.models.BaseModel({});this.fileUploadForm=d.create("toa.CompanySettings.Plugins.views.Import.FileUploadPlugins",{model:this.model});this.fileUploadForm.addListener("plugin-import:setFile",
this.setFile,this);this.popup=new d.ui.Popup({title:h(20562),height:150,autoOpen:!0,view:this.fileUploadForm,modal:!0,popup_extra_css_class:this.popupClass.join(" "),buttons:[{id:"validate_btn",text:h(15336),type:"submit",position:"right",click:this.submitUploadForm.bind(this)},{text:h(22953),position:"right",click:this.closeForm.bind(this)}],onClose:this.closeForm.bind(this)});this.popup.setPositionCenter();$(window).bind("keydown.import",this.onKeydown.bind(this));return this},setFile:function(b,
c){this.xmlFile=c.file},submitUploadForm:function(){null!=this.xmlFile&&this.setPopupButtonDisabled("validate_btn",!0,!0);this.pluginUploadRequest({method:"validateImportPlugins",params:{fileImport:this.xmlFile},onSuccess:this.onSubmitUploadResponse.bind(this),onError:this.onSubmitUploadError.bind(this)});this.setPopupButtonDisabled("validate_btn",!1,!0)},pluginUploadRequest:function(b){var c=new FormData;b&&b.params&&$.each(b.params,function(b,d){c.append(b,d)});var g=GetSessId();c.append(g.substr(0,
g.indexOf("=")),g.substr(g.indexOf("=")+1,g.length-g.indexOf("=")));g=d.Ajax.prototype.route("formsconfiguration",b.method);$.ajax({type:"POST",url:g+"&output=ajax",data:c,dataType:"json",cache:!1,processData:!1,contentType:!1,success:b.onSuccess,error:b.onError})},onSubmitUploadResponse:function(b){var c=this.getErrorFromResponse(b);c?this.showUploadError(c):(this.model.set({import_id:b.data.import_id||null,status:b.data.status||"",processStatus:b.data.processStatus||"",processLog:b.data.processLog||
[],countErrors:b.data.notValidItemsCount||0,validCount:b.data.validItemsCount||0}),this.notify("import.validate",this.model),this.closeForm())},getErrorFromResponse:function(b){return b&&b.data?b.data.errorMsg?b.data.errorMsg:b.data.error_code?h(b.data.error_code):!1:this._defaultErrorMessage},onSubmitUploadError:function(){this.showUploadError()},showUploadError:function(b){b=b||this._defaultErrorMessage;this.setErrorMessages([b]);this.setPopupButtonDisabled("validate_btn",!1,!0)},setPopupButtonDisabled:function(b,
c,d){if(b=this.popup._dom.buttons[b])$(b).toggleClass("toa-button-disable",c),d&&c?$(b).removeClass("toa-button-active"):d&&!c&&$(b).addClass("toa-button-active")},setErrorMessages:function(b){if(1>b.length)return this.popup.removeErrors(),!1;for(var c=0,d=[];c<b.length;c++)d.push({id:c+1,message:b[c]});this.clearErrors();this.showErrors(d)},clearErrors:function(){$(".error",this.$el).remove();return this},showErrors:function(b){$.each(b,function(b,c){$(".import-form-pseudo-file",this.$el).append('<span class="error import-error">'+
c.message+"</span>")}.bind(this));return this},onKeydown:function(b){13===b.keyCode&&this.submitUploadForm()},closeForm:function(){c.prototype.closeForm.apply(this,arguments);this.destroy()},destroy:function(){$(window).unbind("keydown.import");this.popup.destroy()}}))})(toa);(function(d){var c=d.CompanySettings.BaseUploaderView;d.ns("toa.CompanySettings.Plugins.views.Import.ImportFileUploadStatus",d.define(c,function(b){c.apply(this,arguments)},{render:function(){return!1},show:function(){c.prototype.show.apply(this,arguments);var b=h(20562);this.importView=d.create("toa.CompanySettings.Plugins.views.Import.FileUploadStatusPlugins",{model:this.model});this.popup=new d.ui.Popup({title:b,autoOpen:!0,modal:!0,view:this.importView,popup_extra_css_class:this.popupClass.join(" "),
onClose:this.closeForm.bind(this),buttons:[{id:"import_btn",text:h(99),type:"submit",position:"right",click:this.submitImportForm.bind(this)},{id:"close_btn",text:h(14621),display:!0,position:"right",click:this.closeForm.bind(this)}]});this.model.get("validCount",0)||(this.destroyPopupButtonDisabled("import_btn"),this.popup._dom.buttons.close_btn.textContent=h(13305));this.popup.setPositionCenter();$(this.popup._dom.buttons.close_btn).removeClass("toa-button-active");return this},submitImportForm:function(){this.setPopupButtonDisabled("import_btn",
!0,!0);this.notify("import.start",this.model)},closeForm:function(){c.prototype.closeForm.apply(this,arguments);this.notify("import.finish");request({url:"?controller=formsconfiguration&method=clearImportPluginsData"});this.destroy()},setPopupButtonDisabled:function(b,c,d){if(b=this.popup._dom.buttons[b])$(b).toggleClass("toa-button-disable",c),d&&c?$(b).removeClass("toa-button-active"):d&&!c&&$(b).addClass("toa-button-active")},destroyPopupButtonDisabled:function(b){(b=this.popup._dom.buttons[b])&&
$(b).remove()},destroy:function(){this.popup.destroy()}}))})(toa);(function(d){var c=d.CompanySettings.BaseUploaderView;d.ns("toa.CompanySettings.Plugins.views.Import.ImportResults",d.define(c,function(b){c.apply(this,arguments)},{render:function(){return!1},show:function(){c.prototype.show.apply(this,arguments);var b=h(20562);this.importView=d.create("toa.CompanySettings.Plugins.views.Import.ImportResultsView",{model:this.model});this.popup=new d.ui.Popup({autoOpen:!0,modal:!0,title:b,view:this.importView,onClose:this.closeForm.bind(this),popup_extra_css_class:this.popupClass.join(" "),
buttons:[{id:"close_btn",text:h(13305),display:!0,position:"right",click:this.closeForm.bind(this)}]});this.popup.setPositionCenter();$(this.popup._dom.buttons.close_btn).removeClass("toa-button-active");return this},closeForm:function(){c.prototype.closeForm.apply(this,arguments);this.notify("import.finish");this.destroy()},destroy:function(){this.popup&&this.popup.destroy()}}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.Plugins.views.Import.ImportResultsView",d.define(c,function(){c.apply(this,arguments)},{template:'<div class="import_popup form-import"><div><strong><%= h(22972 /* Details: */) %></strong></div><div class="content"><div class="form-import-statistics"><table><tr><td><%= h(20566 /* Number of imported: */) %></td><td><%- importedItemsCount %></td></tr><tr><td><%= h(20567 /* Number of not imported: */) %></td><td><%- skippedItemsCount %></td></tr></table></div></div></div>',
templateProcessLogItem:new d.Template('<div class="import-log-node <%- type %>">;<h5><%= r(message.tid, message.lookup) %></h5>;<% if (snippet) { %>;<pre><%- snippet %></pre>;<% } %>;</div>'.split(";")),render:function(){c.prototype.render.apply(this,arguments);this.logContainer=this.getElement().find(".form-import-validation-log");this.renderProcessLog();return this},renderProcessLog:function(){this.logContainer.empty();$.each(this.model.get("processLog",[]),function(b,c){var d=$(this.templateProcessLogItem.apply({type:c.type||
"",message:c.message||{},snippet:c.snippet||null}));this.logContainer.append(d)}.bind(this))}}))})(toa);(function(d){d.ns("toa.CompanySettings.Plugins.views.AddEditPlugin.NativeApp",d.define(null,function(c){this.options=c||{};this.init();this.render()},$.extend({},d.mixins.EventEmitter,{cards:null,_container:null,plugins:[],readWrite:!1,newPluginId:0,sortableOptions:{},template:new d.Template(['<div class="native-app-content-wrapper">','<div id="native-app-tab"></div>','<a class="turning" id="app-add" tabindex="0" style="display: none;" title="<%= h(13217/*Add*/) %>"><%= h(13217/*Add*/) %></a>',"</div>"]),
templateCard:new d.Template('<div class="native-app-card-header"><div class="right toa-al-icon-sortable"></div></div>;<div class="card">;<div class="native-app-row">;<input type="hidden" name="p[app][<%- plugin_id %>][sort_order]" value="<%= sort_order %>">;<p class="left"><%= h(13069/*Native application name*/) %>:</p>;<input size="25" type="text" class="right" name="p[app][<%- plugin_id %>][native_app_label]" aria-label="<%= h(13069/*Native application name*/) %>" value="<%- native_app_label %>">;</div>;<div class="native-app-row">;<p class="left"><%= h(13070/*Browser user agents mask*/) %>:</p>;<input name="p[app][<%- plugin_id %>][user_agent_mask]" aria-label="<%= h(13070/*Browser user agents mask*/) %>" size="25" type="text" class="right" value="<%- user_agent_mask %>">;</div>;<textarea class="path-text-area left" name="p[app][<%- plugin_id %>][path]" aria-label="<%- path %>"><%- path %></textarea>;<div class="native-app-row">;<a class="turning native-app-remove" title="<%= h(13071/*Remove*/) %>" tabindex="0"><%= h(13071/*Remove*/) %></a>;</div>;</div>'.split(";")),
templateCardRO:new d.Template('<div class="native-app-card-header"></div>;<div class="card">;<div class="native-app-row native-app-ro">;<p class="left"><%= h(13069/*Native application name*/) %>:</p>;<p class="ro"><%- native_app_label %></p>;</div>;<div class="native-app-row native-app-ro">;<p class="left"><%= h(13070/*Browser user agents mask*/) %>:</p>;<p class="ro"><%- user_agent_mask %></p>;</div>;<div class="native-app-row native-app-ro">;<p class="left"><%= h(13075/*Url*/) %>:</p>;<p class="ro"><%- path %></p>;</div>;</div>'.split(";")),
hints:{native_app_label:h(13072),user_agent_mask:h(13073),path:h(13074)},init:function(){this.plugins=this.options.plugins||[];this.readWrite=this.options.readWrite||!1;this.container=this.options.container||null;this.readWrite?(this.sortableOptions={scrollSensitivity:100,axis:"y",placeholder:""},this.tplCardItem=this.templateCard.compile()):(this.sortableOptions={cancel:"li"},this.tplCardItem=this.templateCardRO.compile());this.sortPlugins()},render:function(){var c=$(this.template.apply({}));this._$el=
0<c.length?c:this.container;this.container.empty();this.container.append(c);this.readWrite&&this.getElement().find("a#app-add").show();this.initCards();this.initEvents();return this},getElement:function(){return this._$el},getContainer:function(){return this.container},sortPlugins:function(){this.plugins&&this.plugins.length&&this.plugins.sort(function(c,b){return c.sort_order-b.sort_order})},initEvents:function(){this.getElement().find("a#app-add").bind("click",this.addCard.bind(this))},initCardEvents:function(){this.getElement().find("a.native-app-remove").bind("click",
this.removeCard.bind(this));this.getElement().find(".path-text-area").autosize()},drawPlugins:function(){"undefined"!==typeof this.plugins&&(this.plugins.length?this.renderCards():this.addCard())},bindHints:function(c){var b,d,g;for(g in this.hints)b=this.hints[g],d=c.find("[name*='"+g+"']"),d.attr("placeholder",b)},saveEditedCards:function(){for(var c=this.cards.options.rows,b=c.length,d=0;d<b;d++)c[d].native_app_label=this.getElement().find("[name='p[app]["+c[d].plugin_id+"][native_app_label]']").val(),
c[d].user_agent_mask=this.getElement().find("[name='p[app]["+c[d].plugin_id+"][user_agent_mask]']").val(),c[d].path=this.getElement().find("[name='p[app]["+c[d].plugin_id+"][path]']").val()},removeCard:function(c){c=$(c.target).closest("li").data("toa-sortablelist-original-position");this.cards.options.rows.splice(c,1);0<this.cards.options.rows.length?this.cards.setOption("rows",this.cards.options.rows):this.addCard();this.renderCards()},addCard:function(){this.saveEditedCards();this.cards.options.rows.push({plugin_id:--this.newPluginId,
native_app_label:"",user_agent_mask:"",sort_order:"",path:""});this.cards.setOption("rows",this.cards.options.rows);this.renderCards();this.getElement().find("a#app-add").get(0).scrollIntoView(!1)},renderCards:function(){this.cards.render("#native-app-tab");this.initCardEvents()},initCards:function(){this.cards=d.view.control.create({xtype:"SortableList",name:"native-app-list",rows:this.plugins,sortableOptions:this.sortableOptions,listeners:{formatHelper:function(c,b){var d=b.originalElement.clone();
b.row.native_app_label=b.originalElement.find("[name*='native_app_label']").val();b.row.path=b.originalElement.find("[name*='path']").val();b.row.user_agent_mask=b.originalElement.find("[name*='user_agent_mask']").val();d.addClass("toa-native-app-drag-helper").attr("id","native-app-tab");d.appendTo(this.getContainer());return d}.bind(this),formatRow:function(c,b){return this.tplCardItem.apply({plugin_id:b.row.plugin_id,native_app_label:b.row.native_app_label,user_agent_mask:b.row.user_agent_mask,
sort_order:b.index,path:b.row.path})}.bind(this),appendItem:function(c,b){b.item.is(":visible")&&b.item.find(".path-text-area").autosize();this.bindHints(b.item)}.bind(this),drag:function(){this.saveEditedCards()}.bind(this)}})},destroy:function(){this.cards.destroy();this.getContainer().empty()},getData:function(){var c=[];this.saveEditedCards();$.each(this.cards.options.rows,function(b,d){c.push({plugin_id:d.plugin_id,path:d.path,user_agent_mask:d.user_agent_mask,sort_order:b,native_app_label:d.native_app_label})});
return c},showError:function(c){if(c&&c.data&&c.data.id&&c.data.field){var b=this.getElement().find('[name="p[app]['+c.data.id+"]["+c.data.field+']"]'),d=$('<div class="native-app-error-line error"></div>');d.text(c.message);b.after(d);"path"!==c.data.field&&b.closest("div").find("p").addClass("native-app-card-hint-warning")}},clearErrors:function(){this.getElement().find("p.native-app-card-hint-warning").removeClass("native-app-card-hint-warning");this.getElement().find("div.native-app-error-line").remove()}})))})(toa);(function(d){d.ns("toa.CompanySettings.Plugins.views.AddEditPlugin.SecureParams",d.define(null,function(c){this.options=c||{};this.init();this.render()},$.extend({},d.mixins.EventEmitter,{rowsNumber:0,addNewButton:"",template:new d.Template('<table id="secureDataContainer">,<tr>,<td style="text-align:right">&nbsp;</td>,<td id="secured_data_lim" colspan="2" style="width:100%">,<span class="secured-data-limitation">,<%= h(22404/*Duplicate names are not allowed. Overall size should not exceed 5 KB.*/) %>,</span>,</td>,</tr>,<tr class="securedRowContainer"><td></td>,<td colspan="2" class="securedDataRowsWrapper">,<div class="securedDataRowsList"></div>,</td>,</tr>,</table>'.split(",")),
templateParameterRow:new d.Template(['<span class="securedRow">','<input type="text" class="securedKeyField securedField"  value="<%- key %>" data-ofsc-role="field-key" data-ofsc-key="<%- key %>" aria-label="<%= h(19974/*Name*/) %>" aria-labelledby="<%= h(19974/*Name*/) %>" placeholder="<%= h(19974/*Name*/) %>" />','<textarea class="securedValueField securedField" data-ofsc-role="field-value" aria-label="<%= h(19975/*Value*/) %>" aria-labelledby="<%= h(19975/*Value*/) %>" data-ofsc-key="<%- key %>" placeholder="<%= h(19975/*Value*/) %>"><%- value %></textarea>',
'<button style="display: none;" type="button" class="securedRowDeleteButton" aria-label="<%= h(19977/*Remove name/value pair*/) %>" aria-labelledby="<%= h(19977/*Remove name/value pair*/) %>" title="<%= h(19977/*Remove name/value pair*/) %>"><%= h(19977/*Remove name/value pair*/) %></button>',"</span>"]),init:function(){this.securedData=this.options.securedData||"";this.readWrite=this.options.readWrite||!1;this.container=this.options.container||null;this.buttonContainer=this.options.buttonContainer||
null;this.rowsNumber=this.securedData.length},render:function(){var c=$(this.template.apply({}));this._$el=0<c.length?c:this.container;this.container.append(c);this.rowWithList=this.getElement().find(".securedRowContainer");this.rowContainerWrapper=this.getElement().find(".securedDataRowsWrapper");this.rowContainer=this.getElement().find(".securedDataRowsList");return this},getElement:function(){return this._$el},getContainer:function(){return this.container},renderRows:function(){this.clear();this.initAddButton();
this.securedData.forEach(function(c){this.addRow(c.key,c.value)}.bind(this));this.onRowsNumberChanged();this.rowWithList.show()},initAddButton:function(){this.addNewButton=$('<button type="button" class="securedDataAddButton" style="display: none;"></button>').text(h(19976)).attr("title",h(19976)).on("click",this.onAddClick.bind(this));this.readWrite&&this.addNewButton.show();20<=this.rowsNumber&&this.addNewButton.prop("disabled",!0)},addRow:function(c,b){var d=$(this.templateParameterRow.apply({key:c,
value:b}));if(this.readWrite)d.find(".securedRowDeleteButton").show().on("click",this.onDeleteClick.bind(this));this.rowContainer.append(d);this.onRowsNumberChanged()},onAddClick:function(c){20>this.rowsNumber&&(this.addRow("",""),this.rowsNumber++,this.onRowsNumberChanged());c.preventDefault();c.stopPropagation();return!1},onDeleteClick:function(c){c=$(c.target).closest("span.securedRow");--this.rowsNumber;this.rowsNumber=Math.max(0,this.rowsNumber);c.remove();this.onRowsNumberChanged()},onRowsNumberChanged:function(){this.readWrite&&
(20<=this.rowsNumber?this.addNewButton.hide():(this.addNewButton.show(),this.addNewButton.prop("disabled",!1)),0<this.rowsNumber?this.addNewButton.appendTo(this.rowContainerWrapper):this.buttonContainer.append(this.addNewButton));0<this.rowsNumber?this.rowWithList.show():this.rowWithList.hide()},clear:function(){this.rowWithList.hide();this.rowContainer.empty();$(".securedDataAddButton").remove()},destroy:function(){this.getContainer().empty()},setData:function(c){this.securedData=c},getData:function(){var c=
[];$.each(this.getElement().find("span.securedRow"),function(b,d){var g=$(d).find("input.securedKeyField").val()||"",k=$(d).find("textarea.securedValueField").val()||"";g&&c.push({key:g,value:k})});return c}})))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.Plugins.views.AddEditPlugin.FormContainer",d.define(c,function(){c.apply(this,arguments)},{regions:{form:".pluginForm"},events:{"click .btnSaveSettings":"onClickSave","click .btnCancel":"onClickCancel"},template:'<div id="toa-addeditplugin" class="jet-css-only"><div class="content"><div class="toa-plugin"><div class="pluginForm"></div><div class="bottomPanel"><button name="cancel" class="btnCancel toa-button"><%= h(14621/*Cancel*/) %></button><button name="save" class="btnSaveSettings toa-button toa-button-active" style="display: none;"><%= h(12/*Save*/) %></button><div class="message"></div></div></div></div></div>',
notFoundTemplate:'<div class="pluginNotFound"><%= h(23136/*Plugin does not exist*/) %></div>',onClickSave:function(b){if($(b.target).hasClass("toa-button-disable"))return!1;this.setBtnDisabled(!0);this.clearNotificaton();this.notify("save:clicked",this)},onClickCancel:function(b){this.clearNotificaton();this.notify("cancel:clicked",this)},render:function(b,d){c.prototype.render.apply(this,arguments);this.clearNotificaton();return this},hideButton:function(){this.setBtnDisabled(!0);this.getElement().find(".btnSaveSettings").hide()},
showButton:function(){this.readOnlyMode?this.hideButton():(this.setBtnDisabled(!1),this.getElement().find(".btnSaveSettings").show())},setBtnDisabled:function(b){this.getElement().find(".btnSaveSettings").toggleClass("toa-button-disable",b)},showNotFound:function(){var b=new d.Template(this.notFoundTemplate),b=$(b.apply({}));this.getElement().find(".toa-plugin").empty().append(b)},showNotification:function(b){this.getElement().find(".message").text(b)},clearNotificaton:function(){this.getElement().find(".message").empty()},
destroy:function(){this.getElement().remove();this._$el=null;this.notify("destroy",this)}}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.Plugins.views.AddEditPlugin.FormSections",d.define(c,function(){c.apply(this,arguments)},{template:'<div class="sectionGroup"><div class="sectionForm generalInfo"><h2 class="sectionHead"><%= h(20609)/*General Information*/ %></h2><div class="generalSettingsContent"></div></div></div><div class="sectionGroup"><div class="sectionForm generalInfo"><h2 class="sectionHead"><%= h(23127)/*Plugin settings*/ %></h2><div class="pluginSettingsContent"></div></div><div class="sectionForm generalInfo hostedVersionSection" style="display: none;"><h2 class="sectionHead"><%= h(20614)/*Version History*/ %></h2><div class="versionHistory"></div></div><div class="sectionForm generalInfo pluginPropertiesSection pluginPropertiesSection--hidden"><h2 class="sectionHead"><%= h(23656) /*Available Properties*/ %></h2><div class="propertiesContent"></div></div></div>',
regions:{generalSettings:".generalSettingsContent",pluginSettings:".pluginSettingsContent",properties:".propertiesContent",versionHistory:".versionHistory"},showVersions:function(){this.getElement().find(".hostedVersionSection").show()},hideVersions:function(){this.getElement().find(".hostedVersionSection").hide()},showPluginProperties:function(){this.getElement().find(".pluginPropertiesSection").removeClass("pluginPropertiesSection--hidden")},hidePluginProperties:function(){this.getElement().find(".pluginPropertiesSection").addClass("pluginPropertiesSection--hidden")}}))})(toa);(function(d){var c=d.views.BaseForm;d.ns("toa.CompanySettings.Plugins.views.AddEditPlugin.BaseFormSection",d.define(c,function(){c.apply(this,arguments)},{findElement:function(b){return this.getContainer().find(b)},findFieldRow:function(b){return this.findElement('.toa-formrow[data-field-name="'+b+'"]')},render:function(b,d){c.prototype.render.apply(this,arguments);this.afterRender();return this},afterRender:function(){this.checkReadOnly()},checkReadOnly:function(){if(this.readOnlyMode||this.model.isInternal())this.findElement("input").prop("readonly",
!0),this.findElement("input,select,textarea").prop("disabled",!0)},showFieldError:function(b){b=b||{};if(b.field){var c=this.findFieldRow(b.field);c.find("div.formLabel > label").addClass("error");if(""!==b.message){var d=c.find(".errorContainer");d.length||(d=$('<div class="errorContainer"></div>'),c.find(".formField").append(d));c=$('<div class="errorLine error" tabindex="0" aria-label="'+b.message+'" aria-labelledby="'+b.message+'" ></div>');c.text(b.message);d.append(c)}}},clearFieldError:function(b){b=
this.findFieldRow(b);b.find("div.formLabel > label").removeClass("error");b.find(".errorContainer").remove()},clearErrors:function(){this.findElement("div.formLabel > label.error").removeClass("error");this.findElement(".errorContainer").remove()}}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.Plugins.views.AddEditPlugin.FilterableListItem",d.define(c,function(b){c.apply(this,arguments);this.model.addListener("change",this.onChangeModel,this)},{events:{"change .cbFilterableItem":"onChangeState"},template:'<tr><td class="colCheckbox"><input id="cbFilterablePluginLI-<%- propertyId %>" class="cbFilterableItem" type="checkbox" <% if (\'undefined\' !== typeof disabled && disabled) {%>disabled="disabled"<% } %> <% if (\'undefined\' !== typeof assigned && assigned) {%>checked="checked"<% } %>></td><td class="cdFilterableText"><label for="cbFilterablePluginLI-<%- propertyId %>" <%= (\'undefined\' !== typeof status && \'\' !== status && \'active\' !== status ) ? \'class="toa-disabled"\' : \'\' %>><b><%- text %></b><div><%- label %></div><span class="toa-disabled"><%= entity === "provider"? h(23659 /* Resource */): entity === "inventory"? h(23658 /* Inventory */): h(23671 /* Activity */) %></span></label></td></tr>',
onChangeModel:function(b,c){this._$el.find(".cbFilterableItem").prop("checked",c.assigned)},onChangeState:function(b){b=$(b.target).is(":checked");this.notify("list:change",this.model,b)}}))})(toa);(function(d){var c=d.views.BaseCollectionView;d.ns("toa.CompanySettings.Plugins.views.AddEditPlugin.FilterableList",d.define(c,function(b){this.filterable=!1!==b.filterable;c.apply(this,arguments);this.addListener("list:change",this.onChangeAssigned,this)},{events:{"keyup .filterableSearchInput":"onTypeSearch","click .clearSearchButton":"onClickClearSearch","change #filterableListOptionSelectedOnly":"onChangeSelectedOnly"},childRegion:".checkboxTable tbody",childView:d.CompanySettings.Plugins.views.AddEditPlugin.FilterableListItem,
template:'<div class="filterableList"><% if (filterable) { %><div class="filterableSearch"><i class="searchIcon"></i><input aria-label="<%-h(13745)%>" class="filterableSearchInput" autofocus ><i class="clearSearchButton hidden"></i></div><% } %><div class="filterableListSection"><table class="checkboxTable"><tbody></tbody></table></div><div class="filterableListOptions"><input type="checkbox" class="filterableListOptionInput" id="filterableListOptionSelectedOnly"><label class="filterableListOptionLabel" for="filterableListOptionSelectedOnly"><%= h(23668 /*Show configured properties for this plugin*/) %></label></div></div>',
getData:function(){var b=c.prototype.getData.apply(this,arguments);b.filterable=this.filterable;return b},onChangeAssigned:function(b,c,d,k){d.set({assigned:k})},onTypeSearch:function(b){b=$(b.target).val().toLowerCase();this.filterList(b)},filterList:function(b){var c=this._container.find(".checkboxTable tr"),d=this._container.find(".clearSearchButton");if(!b)return d.toggleClass("hidden",!0),$.each(c,function(b,c){$(c).toggleClass("hidden",!1)}),!1;d.toggleClass("hidden",!1);$.each(c,function(c,
d){var e=$(d),g=-1<e.find("label").text().toLowerCase().indexOf(b);e.toggleClass("hidden",!g)})},onClickClearSearch:function(b){this._container.find(".clearSearchButton").toggleClass("hidden",!0);this._container.find(".filterableSearchInput").val("");this.filterList()},onChangeSelectedOnly:function(b){$(b.target).is(":checked")?this.hideNotSelectedInitially():this.showNotSelectedInitially()},hideNotSelectedInitially:function(){this.collection.each(function(b){b.get("initiallySelected")||this._container.find("#cbFilterablePluginLI-"+
b.getId()).closest("tr").addClass("initiallySelectedFilterHidden")}.bind(this))},showNotSelectedInitially:function(){this._container.find(".initiallySelectedFilterHidden").removeClass("initiallySelectedFilterHidden")}}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.Plugins.views.AddEditPlugin.FilterableItem",d.define(c,function(b){c.apply(this,arguments)},{events:{},template:"<div class=\"listItem<%= ('undefined' !== typeof status && '' !== status && 'active' !== status ) ? ' toa-disabled' : '' %>\"><%- text %></div>"}))})(toa);(function(d){var c=d.CompanySettings.Plugins.views.AddEditPlugin.BaseFormSection;d.ns("toa.CompanySettings.Plugins.views.AddEditPlugin.GeneralSection",d.define(c,function(b){c.apply(this,arguments);this.lookupsModel=b.lookupsModel},{template:'<div class="languageContainer"></div><div class="toa-formrow pluginLabelRow" data-field-name="label"><div class="formLabel"><label for="pluginLabel"><span class="asterisk">&#42;</span><%= h(23129)/*Label*/ %></label></div><div class="formField"><input type="text" value="<%- label %>" id="pluginLabel" aria-label="pluginLabel" aria-labelledby="pluginLabel" class="pluginLabel" name="pluginLabel" <% if (label !== "") { %>disabled<% } %> /></div></div><div class="toa-formrow pluginEntityRow" data-field-name="entity"><div class="formLabel"><label for="pluginEntity"><%= h(2322)/*Entity*/ %></label></div><div class="formField"><select id="pluginEntity" class="pluginEntity" aria-label="pluginEntity" aria-labelledby="pluginEntity" name="pluginEntity"></select></div></div><div class="toa-formrow pluginBaseActionRow" data-field-name="baseAction"><div class="formLabel"><label for="pluginBaseAction"><%= h(23130)/*Visibility rules similar to*/ %></label></div><div class="formField"><select id="pluginBaseAction" class="pluginBaseAction" name="pluginBaseAction" aria-label="pluginBaseAction" aria-labelledby="pluginBaseAction"></select></div></div>',
templateLanguage:'<div class="toa-formrow pluginNameRow" data-language="<%- languageId %>" data-language-label="<%- languageLabel %>" data-field-name="name"><div class="formLabel"><label for="pluginName_<%- languageId %>"><% if (true === isMandatory) { %><span class="asterisk">&#42;</span><% } %><%- languageText %></label></div><div class="formField"><input value="<%- pluginName %>" id="pluginName_<%- languageId %>" aria-label="pluginName_<%- languageId %>" aria-labelledby="pluginName" class="pluginName" name="pluginName[<%- languageId %>]" type="text"></div></div>',
events:{"input .pluginLabel":"onChangeLabel","change .pluginEntity":"onChangeEntity","change .pluginBaseAction":"onChangeBaseAction"},afterRender:function(){this.renderPluginName();this.renderEntities();this.renderBaseActions();c.prototype.afterRender.apply(this,arguments)},renderPluginName:function(){var b=this.findElement(".languageContainer"),c=new d.Template(this.templateLanguage);$.each(this.lookupsModel.get("languages",{}),function(d,k){var l={isMandatory:this._isMandatoryLanguage(k.id),languageId:k.id,
languageLabel:k.label,languageName:k.text,languageText:r(23128,{"{LANGUAGE_NAME}":k.text}),pluginName:this.model.getPluginName(k.id)};b.append($(c.apply(l)))}.bind(this));this.findElement("input.pluginName").change(this.onChangeName.bind(this))},renderEntities:function(){var b=this.findElement("#pluginEntity"),c=this.model.getEntity();b.html('<option value="0"></option>');$.each(this.lookupsModel.get("entities",[]),function(d,k){var l=parseInt(k.id,10);b.append('<option value="'+l+'"'+(c===l?" selected":
"")+">"+k.text+"</option>")})},renderBaseActions:function(){var b=this.findElement("select#pluginBaseAction"),c=this.model.getBaseAction();b.html('<option value=""></option>');$.each(this.getFilteredBaseActions(),function(d,k){b.append('<option data-entity="'+k.entity+'" value="'+k.label+'"'+(c===k.label?" selected":"")+">"+k.label+"</option>")})},getFilteredBaseActions:function(){var b=this.model.getEntity(),c=[];$.each(this.lookupsModel.get("baseActions"),function(d,k){var l=parseInt(k.entity,10);
b&&(isNaN(l)||l&&l!==b)||c.push(k)});return c},onChangeLabel:function(b){b=$(b.target).val().trim();this.model.setField("label",b);this.clearFieldError("label")},onChangeName:function(b){var c=$(b.target).val().trim();b=parseInt($(b.target).parent(".formField").parent(".pluginNameRow").data("language"),10);this.model.setName(b,c);this.clearFieldError("name")},onChangeEntity:function(b){b=parseInt($(b.target).val());this.model.setField("entity",b);this.model.setField("baseAction","");this.renderBaseActions()},
onChangeBaseAction:function(b){b=$(b.target).val();this.model.setField("baseAction",b)},_isMandatoryLanguage:function(b){return 1===b},destroy:function(){c.prototype.destroy.apply(this,arguments)},findFieldRow:function(b){return"name"===b?this.findElement('.toa-formrow[data-field-name="'+b+'"][data-language="1"]'):c.prototype.findFieldRow.apply(this,arguments)}}))})(toa);(function(d){var c=d.views.BaseCollectionView;d.ns("toa.CompanySettings.Plugins.views.AddEditPlugin.PropertiesSection",d.define(c,function(b){c.apply(this,arguments);this.popupTitle=h(23667)},{events:{"click .multiselect-tip-button":"onClickSelectButton"},endOfLine:",",activityChildRegion:".activitySelectedLabels",inventoryChildRegion:".inventorySelectedLabels",resourceChildRegion:".resourceSelectedLabels",childView:d.CompanySettings.Plugins.views.AddEditPlugin.FilterableItem,template:'<div class="plugin-properties-container"><div class="plugin-properties-list"><div class="sectionItemList <% if (isEmptyItemList) {%>emptySectionItemList<% } %>"><div role="button" class="ui-button multiselect-tip-button ui-button-icon-only" title="'+
h(462)+'"><span class="ui-icon ui-button-icon-primary ui-icon-modify"></span><span class="ui-button-text">'+h(462)+'</span></div><div class="plugin-properties-message"><%= h(23660) /*Add properties that must be available through Plugin API*/ %></div><div class="activitySelectedLabelsGroup"><div class="selectedLabelsTitle activitySelectedLabelsTitle"><%= h(23671) /*Activity*/ %></div><div class="selectedLabels activitySelectedLabels"></div><div class="clear"></div></div><div class="inventorySelectedLabelsGroup"><div class="selectedLabelsTitle inventorySelectedLabelsTitle"><%= h(23658) /*Inventory*/ %></div><div class="selectedLabels inventorySelectedLabels"></div><div class="clear"></div></div><div class="resourceSelectedLabelsGroup"><div class="selectedLabelsTitle resourceSelectedLabelsTitle"><%= h(23659) /*Resource*/ %></div><div class="selectedLabels resourceSelectedLabels"></div><div class="clear"></div></div></div></div></div>',
setCollection:function(b){this.collection=b},getData:function(){var b=c.prototype.getData.apply(this,arguments),d=this.collection.find("assigned",!0);b.isEmptyItemList=d?!1:!0;return b},render:function(b,d){d||b.empty();this._childViews=[];c.prototype.render.apply(this,arguments);var g=this.collection.filter(function(b){if(!0===b.get("assigned")&&"activity"===b.get("entity"))return b}),k=b.find(this.activityChildRegion).first();this._renderCollection(k,g);g.length||b.find(".activitySelectedLabelsGroup").hide();
g=this.collection.filter(function(b){if(!0===b.get("assigned")&&"inventory"===b.get("entity"))return b});k=b.find(this.inventoryChildRegion).first();this._renderCollection(k,g);g.length||b.find(".inventorySelectedLabelsGroup").hide();g=this.collection.filter(function(b){if(!0===b.get("assigned")&&"provider"===b.get("entity"))return b});k=b.find(this.resourceChildRegion).first();this._renderCollection(k,g);g.length||b.find(".resourceSelectedLabelsGroup").hide();this._container=b;return this},_renderCollection:function(b,
c){$.each(c,function(c,d){var e=new this.childView({model:d,collection:this.collection});this._subscribeChildView(e);this._childViews.push(e);e.render(b,!0)}.bind(this))},applyChanges:function(b){b.each(function(b){var c=b.getId();b=b.get("assigned");(c=this.collection.get(c))&&c.get("assigned")!==b&&(c.set({assigned:b}),this.render(this._container))}.bind(this));this.render(this._container)},onClickSelectButton:function(b){var c=this.collection.compact("id","assigned","label","text","entity","propertyId");
c.each(function(b){b.set({initiallySelected:b.get("assigned")})});b=d.create("toa.CompanySettings.Plugins.views.AddEditPlugin.FilterableList",{model:this.model,collection:c});var g=new d.ui.Popup({title:this.popupTitle,width:450,autoOpen:!0,view:b,modal:!0,onClose:function(){g.destroy()},buttons:[{text:h(14621),position:"left",click:function(){g.destroy()}},{text:h(12252),type:"submit",position:"right",click:function(b){$(b.target).removeClass("toa-button-active").addClass("toa-button-disable");this.applyChanges(c);
g.destroy()}.bind(this)}]})}}))})(toa);(function(d){var c=d.CompanySettings.Plugins.views.AddEditPlugin.BaseFormSection;d.ns("toa.CompanySettings.Plugins.views.AddEditPlugin.SettingsSection",d.define(c,function(){c.apply(this,arguments)},{template:'<% var checked = function(condition) { return condition ? \' checked="checked"\' : \'\'; }; %><% var disabled = function(condition) { return condition ? \' disabled="disabled"\' : \'\'; }; %><% var selected = function(condition) { return condition ? \' selected\' : \'\'; }; %><div class="toa-formrow pluginTypeRow"><div class="formLabel"><label for="pluginType"><%= h(658)/*Type*/ %></label></div><div class="formField"><select id="pluginType" class="pluginType" name="pluginType"><% if (\'internal\' === type) { %><option value="internal" selected><%= h(14618)/*Internal*/ %></option><% } %><option value="external" <%- selected(type === \'external\') %>><%= h(14619)/*HTML5 application*/ %></option><option value="external_native" <%- selected(type === \'external_native\') %>><%= h(13068)/*Native application*/ %></option></select></div></div><div class="html5SettingsBlock" style="display: none;"><div class="toa-formrow useApiRow"><div class="formLabel"><label for="pluginUseApi"><%= h(16309)/*Use Plugin API*/ %></label></div><div class="formField"><input type="checkbox" id="pluginUseApi" class="pluginUseApi" name="pluginUseApi" <%- checked(useApi) %> /></div></div><div class="toa-formrow isHostedRow" style="display: none;"><div class="formLabel"><label for="pluginIsHosted"><%= h(16749)/*Hosted plugin*/ %></label></div><div class="formField"><input type="checkbox" id="pluginIsHosted" class="pluginIsHosted" name="pluginIsHosted" <%- checked(isHosted) %> /></div></div><div class="toa-formrow pluginArchiveRow hostedPluginSetting" style="display: none;" data-field-name="archive"><div class="formLabel"><label for="pluginArchive"><% if (!pluginHostedId) { %><span class="asterisk">&#42;</span><% } %><%= h(20611)/* Plugin archive */ %></label></div><div class="formField"><input type="file" class="pluginArchive" id="pluginArchive" name="pluginArchive" /><div id="archiveInfo"><%= h(23131/*Info*/) %></div></div></div><div class="toa-formrow pluginUrlRow" title="<%= h(11864)/*Free format URL. Example: http://domain.com/, skype:name?call*/ %>" style="display: none;" data-field-name="pluginPath"><div class="formLabel"><label for="pluginUrl"><% if (type === \'internal\') { %><%= h(6798)/*Relative path*/ %><% } else { %><%= h(6799)/*URL*/ %><% } %></label></div><div class="formField"><input type="text" value="<%- pluginPath %>" id="pluginUrl" class="pluginUrl pwi1" name="pluginUrl" /></div></div><div class="toa-formrow pluginPostDataRow noApiSetting" title="<%= h(10468)/*Url can contain letters, digits and...*/ %>" style="display: none;" data-field-name="postData"><div class="formLabel"><label for="pluginPostData"><%= h(6800)/*POST data*/ %></label></div><div class="formField"><textarea rows="5" id="pluginPostData" class="pluginPostData pwi4" name="pluginPostData" <%- disabled(\'internal\' === type) %>><%- postData %></textarea></div></div><div class="toa-formrow pluginIsOnlineRow"><div class="formLabel"><label for="pluginIsOnline"><%= h(23132)/*Disable plugin in offline*/ %></label></div><div class="formField"><input type="checkbox" id="pluginIsOnline" class="pluginIsOnline" name="pluginIsOnline" <%- checked(isOnline) %> /></div></div><div class="toa-formrow pluginServerScriptRow" style="display: none;"><div class="formLabel"><label for="pluginServerScript"><%= h(10738)/*Server-side script*/ %></label></div><div class="formField"><% var isExternal = \'external\' === type; %><% var isChecked = isExternal || serverScript; %><% var isDisabled = isExternal || !isOnline; %><input type="checkbox" id="pluginServerScript" class="pluginServerScript" name="pluginServerScript" <%- checked(isChecked) %> <%- disabled(isDisabled) %> /></div></div><div class="toa-formrow pluginIsTabRow noApiSetting" style="display: none;"><div class="formLabel"><label for="pluginIsTab"><%= h(10447)/*Tab or Iframe layout*/ %></label></div><div class="formField"><input type="checkbox" id="pluginIsTab" class="pluginIsTab" name="pluginIsTab" <%- checked(isTab) %> /></div></div><div class="toa-formrow pluginShowScrollRow noApiSetting" style="display: none;"><div class="formLabel"><label for="pluginShowScroll"><%= h(6871)/*Show scrollbars*/ %></label></div><div class="formField"><input type="checkbox" id="pluginShowScroll" class="pluginShowScroll" name="pluginShowScroll" <%- checked(showScroll) %> /></div></div><div class="toa-formrow pluginWidthRow noApiSetting" style="display: none;" data-field-name="windowWidth"><div class="formLabel"><label for="pluginWidth"><%= h(19533)/*Width in pixels*/ %></label></div><div class="formField"><input type="text" value="<%- windowWidth === null ? \'\' : windowWidth %>" id="pluginWidth" class="pluginWidth pwi1" name="pluginWidth" /></div></div><div class="toa-formrow pluginHeightRow noApiSetting" style="display: none;" data-field-name="windowHeight"><div class="formLabel"><label for="pluginHeight"><%= h(19534)/*Height in pixels*/ %></label></div><div class="formField"><input type="text" value="<%- windowHeight === null ? \'\' : windowHeight %>" id="pluginHeight" class="pluginHeight pwi1" name="pluginHeight" /></div></div><div class="toa-formrow pluginAuthTypeRow" style="display: none;"><div class="formLabel"><label for="pluginAuthType"><%= h(16301)/*Authentication*/ %></label></div><div class="formField"><select id="pluginAuthType" class="pluginAuthType" name="pluginAuthType"><option value="basic" <%- selected(authType === \'basic\') %>><%= h(16302)/*Basic HTTP*/ %></option><option value="hmac" <%- selected(authType === \'hmac\') %>><%= h(16303)/*HMAC*/ %></option></select></div></div><div class="toa-formrow pluginLoginRow authenticationSetting" style="display: none;" data-field-name="authLogin"><div class="formLabel"><label for="pluginLogin"><%= h(16304)/*Login*/ %></label></div><div class="formField"><input type="text" value="<%- authLogin %>" id="pluginLogin" class="pluginLogin pwi1" name="pluginLogin" /></div></div><div class="toa-formrow pluginPasswordRow authenticationSetting" style="display: none;" data-field-name="authPassword"><div class="formLabel"><label for="pluginPassword"><% if (authType === \'basic\') { %><%= h(16305)/*Password*/ %><% } else { %><span class="asterisk">&#42;</span><%= h(16306)/*Secret key*/ %><% } %></label></div><div class="formField"><input type="text" value="<%- authPassword %>" id="pluginPassword" class="pluginPassword pwi1" name="pluginPassword" /></div></div><div id="hmacKeyHint" class="authenticationSetting" style="display: none;"><%= h(16311/*All parameters of the plug-in URL with replaced placeholders will be encrypted on the basis of the SHA-256 hash of the Secret Key value using the HMAC algorithm. The resulting string will be appended to the URL as the hmac parameter*/) %></div><div class="toa-formrow pluginSecureParamsRow" style="display: none;" data-field-name="secureParams"><div class="formLabel"><label><%= h(19981)/*Secure parameters*/ %></label></div><div class="formField"></div></div></div><div class="nativeSettingsBlock" style="display: none;"></div>',
templateArchiveDesc:'<div class="toa-formrow"><h4><b><%= h(20616)/*Archive file format */ %></b></h4><div class="formNote"><p><%= h(20617)/* The archive must have .zip extension and be ZIP archive. */ %></p><p><%= h(20618)/* The size of archive must not exceed 500 KB. */ %></p></div><h4><b><%= h(20619)/* Archive content */ %></b></h4><div class="formNote"><p><%= h(20620)/* The archive must contain only directories and files of the following types: */ %><ul><li><%= h(20621)/* .html files */ %></li><li><%= h(20622)/* .css files */ %></li><li><%= h(20623)/* .js files */ %></li><li><%= h(19973)/* .appcache files */ %></li><li><%= h(20624)/* .jpg, .jpeg, .png, .gif, .svg files */ %></li><li><%= h(20625)/* Directories */ %></li></ul><p><%= h(23672, {"{MAX_TOTAL_FILE_SIZE}": MAX_TOTAL_FILE_SIZE })/* The total size of all the files must not exceed {MAX_TOTAL_FILE_SIZE} MB.*/ %></p><p><%= h(20626)/* The "index.html" file must be located in the root of the archive.*/ %></p><p><%= h(20628)/* The archive must contain not more than 10 entries, including empty directories.*/ %></p></div></div>',
events:{"change .pluginType":"onChangeType","change .pluginUseApi":"onChangeUseApi","input .pluginUrl":"onChangeUrl","input .pluginPostData":"onChangePostData","change .pluginIsOnline":"onChangeIsOnline","change .pluginServerScript":"onChangeServerScript","change .pluginIsTab":"onChangeIsTab","change .pluginShowScroll":"onChangeShowScroll","input .pluginWidth":"onChangeWidth","input .pluginHeight":"onChangeHeight","change .pluginAuthType":"onChangeAuthType","input .pluginLogin":"onChangeAuthLogin",
"input .pluginPassword":"onChangeAuthPassword","change .pluginIsHosted":"onChangeIsHosted","change .pluginArchive":"onChangeArchive","click #archiveInfo":"showArchiveInfo"},afterRender:function(){this.initNativeApp();this.initSecureParams();this.showSettings();c.prototype.afterRender.apply(this,arguments)},initNativeApp:function(){this.nativeApp=new d.CompanySettings.Plugins.views.AddEditPlugin.NativeApp({plugins:this.model.getNativeAppData(),readWrite:!this.readOnlyMode,container:this.findElement(".nativeSettingsBlock")})},
initSecureParams:function(){this.secureParams=new d.CompanySettings.Plugins.views.AddEditPlugin.SecureParams({securedData:this.model.getSecuredData(),readWrite:!this.readOnlyMode,container:this.findElement(".pluginSecureParamsRow"),buttonContainer:this.findElement(".pluginSecureParamsRow > .formField")})},showSettings:function(){this.model.isNativeApp()?(this.findElement(".html5SettingsBlock").hide(),this.findElement(".nativeSettingsBlock").show(),this.nativeApp.drawPlugins()):(this.findElement(".nativeSettingsBlock").hide(),
this.findElement(".html5SettingsBlock").show(),this.model.isInternal()?this.showInternalSettings():this.handleUseApiVisibility())},showInternalSettings:function(){this.findElement(".useApiRow").hide();this.findElement(".pluginUrlRow").show();this.findElement(".pluginServerScriptRow").show();3!==this.model.getInterface()&&(this.findElement(".pluginIsTabRow").show(),this.findElement(".pluginShowScrollRow").show(),this.model.getWidth()&&this.model.getHeight()&&(this.findElement(".pluginWidthRow").show(),
this.findElement(".pluginHeightRow").show()))},handleUseApiVisibility:function(){this.model.isUseApi()?this.showUseApiSettings():this.hideUseApiSettings();this.clearErrors()},showUseApiSettings:function(){this.showPluginSettingsRow(".isHostedRow");this.handleHostedVisibility();this.showSecureParameters();this.notify("isPluginApi:true");this.findElement(".noApiSetting").hide()},hideUseApiSettings:function(){this.showPluginSettingsRow(".isHostedRow",!1);this.handleHostedVisibility();this.hideSecureParameters();
this.notify("isPluginApi:false");this.showPluginSettingsRow(".pluginUrlRow");this.findElement(".noApiSetting").show()},handleHostedVisibility:function(){this.findElement("#pluginArchive").val("");this.model.set({archive:null});this.clearFieldError("archive");this.model.isHostedPlugin()?(this.showPluginSettingsRow(".pluginUrlRow",!1),this.showHostedSettings(),this.hideAuthenticationSettings()):(this.showPluginSettingsRow(".pluginUrlRow"),this.hideHostedSettings(),this.model.isUseApi()?this.showAuthenticationSettings():
this.hideAuthenticationSettings())},showHostedSettings:function(){this.findElement(".hostedPluginSetting").show();this.notify("version:showhide",!0)},hideHostedSettings:function(){this.findElement(".hostedPluginSetting").hide();this.notify("version:showhide",!1)},showAuthenticationSettings:function(){this.showPluginSettingsRow(".pluginAuthTypeRow");this.showPluginSettingsRow(".pluginPasswordRow");this.handleAuthenticationVisibility()},hideAuthenticationSettings:function(){this.showPluginSettingsRow(".pluginAuthTypeRow",
!1);this.findElement(".authenticationSetting").hide();this.clearFieldError("authLogin");this.clearFieldError("authPassword")},handleAuthenticationVisibility:function(){this.clearFieldError("authLogin");this.clearFieldError("authPassword");if(this.model.isBasicAuthentication())this.findElement("#hmacKeyHint").hide(),this.showPluginSettingsRow(".pluginLoginRow"),this.findElement(".pluginPasswordRow > .formLabel > label").empty().text(h(16305));else{this.showPluginSettingsRow(".pluginLoginRow",!1);this.findElement("#hmacKeyHint").show();
var b=$('<span class="asterisk">&#42;</span>');b.append(h(16306));this.findElement(".pluginPasswordRow > .formLabel > label").empty().append(b)}},showSecureParameters:function(){this.showPluginSettingsRow(".pluginSecureParamsRow");this.secureParams.renderRows()},hideSecureParameters:function(){this.showPluginSettingsRow(".pluginSecureParamsRow",!1)},showPluginSettingsRow:function(b,c){!1===c?this.findElement(b).hide():this.findElement(b).show()},onChangeType:function(b){b=$(b.target).val();this.model.set({type:b});
this.notify("version:showhide",!1);this.showSettings();this.clearErrors()},onChangeUseApi:function(b){b=$(b.target).prop("checked");this.model.set({useApi:b});b||(this.findElement(".pluginIsHosted").prop("checked",!1),this.model.set({isHosted:!1,archive:null}));this.handleUseApiVisibility()},onChangeUrl:function(b){b=$(b.target).val();this.model.set({pluginPath:b});this.clearFieldError("pluginPath")},onChangePostData:function(b){b=$(b.target).val();this.model.set({postData:b});this.clearFieldError("postData")},
onChangeIsOnline:function(b){b=$(b.target).prop("checked");this.model.set({isOnline:b})},onChangeServerScript:function(b){b=$(b.target).prop("checked");this.model.set({serverScript:b})},onChangeIsTab:function(b){b=$(b.target).prop("checked");this.model.set({isTab:b})},onChangeShowScroll:function(b){b=$(b.target).prop("checked");this.model.set({showScroll:b})},onChangeWidth:function(b){b=$(b.target).val();this.model.set({windowWidth:b});this.clearFieldError("windowWidth")},onChangeHeight:function(b){b=
$(b.target).val();this.model.set({windowHeight:b});this.clearFieldError("windowHeight")},onChangeAuthType:function(b){b=$(b.target).val();this.model.set({authType:b,authLogin:"",authPassword:""});this.findElement(".pluginLogin").val("");this.findElement(".pluginPassword").val("");this.handleAuthenticationVisibility()},onChangeAuthLogin:function(b){b=$(b.target).val();this.model.set({authLogin:b});this.clearFieldError("authLogin")},onChangeAuthPassword:function(b){b=$(b.target).val();this.model.set({authPassword:b});
this.clearFieldError("authPassword")},onChangeIsHosted:function(b){b=$(b.target).prop("checked");this.model.set({isHosted:b,pluginPath:"",archive:null});this.findElement(".pluginUrl").val("");this.handleHostedVisibility();this.clearFieldError("pluginPath")},onChangeArchive:function(b){b=b.target;this.model.set({archive:b.files&&b.files[0]||null});this.clearFieldError("archive")},showArchiveInfo:function(b){b=new d.Template(this.templateArchiveDesc);b=$(b.apply({MAX_TOTAL_FILE_SIZE:10}));new d.ui.Popup({title:h(20615),
autoOpen:!0,html:b,modal:!0,onClose:function(){this.destroy()},buttons:[{text:h(445),position:"right",tpl:'<button class="popup-button toa-button"></button>',click:function(){this.destroy()}}]})},destroy:function(){this.nativeApp.destroy();this.secureParams.destroy();c.prototype.destroy.apply(this,arguments)},getSecuredData:function(){this.model.set({secureParams:this.secureParams.getData()})},getNativeAppData:function(){this.model.set({nativeApp:this.nativeApp.getData()})},showFieldError:function(b){b&&
b.field&&"nativeApp"===b.field?this.nativeApp.showError(b):c.prototype.showFieldError.apply(this,arguments)},clearErrors:function(){c.prototype.clearErrors.apply(this,arguments);this.nativeApp.clearErrors()}}))})(toa);(function(d){var c=d.views.BaseView;d.ns("toa.CompanySettings.Plugins.views.AddEditPlugin.VersionsListItem",d.define(c,function(){c.apply(this,arguments)},{events:{"click .downloadPluginVersion":"downloadVersion"},template:'<tr class="grid_data pluginVersion <%- (isCurrent ? \'pluginVersionCurrent\' : \'\') %>"><td><%- userName %></td><td><%- time %></td><% if (hasContent) { %><td><a href="#" class="downloadPluginVersion"><%= h(20631)/* Download */ %></a></td><% } else { %><td><span></span></td><% } %></tr>',
downloadVersion:function(b){b.preventDefault();this.notify("version:download",this.model.getId())}}))})(toa);(function(d){var c=d.views.BaseCollectionView;d.ns("toa.CompanySettings.Plugins.views.AddEditPlugin.VersionsList",d.define(c,function(){c.apply(this,arguments)},{template:'<table class="versionsList oj-table" cellpadding="2" cellspacing="1" border="0"><thead><tr class="pwt"><td class="ofsc-report-table-row ht" data-ofsc-column="user"><%= h(20647)/* User */ %></td><td class="ofsc-report-table-row ht" data-ofsc-column="modification-time"><%= h(20648)/* Modification time */ %></td><td class="ofsc-report-table-row ht" data-ofsc-column="download-link"><%= h(20649)/* Archive */ %></td></tr></thead><tbody class="versionsList"></tbody></table>',
childView:d.CompanySettings.Plugins.views.AddEditPlugin.VersionsListItem,childRegion:".versionsList"}))})(toa);(function(d){var c=d.classes.DataMapper;d.ns("toa.CompanySettings.Plugins.classes.ListItemDataMapper",d.define(c,function(b){c.apply(this,arguments)},{_modelConstructor:d.CompanySettings.Plugins.models.Plugin,_serverRemoveMethod:"removePlugin",_serverIdField:"alid"}))})(toa);(function(d,c){var b=d.classes.CollectionDataMapper;d.ns("toa.CompanySettings.Plugins.classes.ListDataMapper",d.define(b,function(c,d){b.apply(this,arguments)},{_modelConstructor:d.CompanySettings.Plugins.models.SortableCollection,_serverGetMethod:"getPluginList",_serverGetField:"plugins",load:function(c,d){return b.prototype.load.apply(this,arguments)}}))})(toa,$);(function(d){var c=d.classes.DataMapper;d.ns("toa.CompanySettings.Plugins.classes.PropertyDataMapper",d.define(c,function(b){c.apply(this,arguments)},{_modelConstructor:d.CompanySettings.Plugins.models.Property}))})(toa);(function(d,c){var b=d.classes.CollectionDataMapper;d.ns("toa.CompanySettings.Plugins.classes.PropertiesDataMapper",d.define(b,function(c,d,k){b.apply(this,arguments);this._lookupModel=k},{_modelConstructor:d.CompanySettings.Plugins.models.PropertyCollection,_serverGetField:"properties",_lookupModelField:"properties",_fillModel:function(b,g){b.clear({silent:!0});var k=this._lookupModel.get(this._lookupModelField,[]);k.sort(function(b,c){b=b.text.trim();c=c.text.trim();return b.localeCompare(c)});
k.forEach(function(k){var n={assigned:-1!==c.inArray(k.propertyId,g)};k=this._itemMapper.create(d.mixin({},k,n));b.add(k,{silent:!0})}.bind(this))},serialize:function(b){var c=[];b.each(function(b){b.get("assigned")&&c.push(b.getId())});return JSON.stringify(c)}}))})(toa,$);(function(d){var c=d.classes.DataMapper;d.ns("toa.CompanySettings.Plugins.classes.LookupsDataMapper",d.define(c,function(b){c.apply(this,arguments)},{_modelConstructor:d.models.userTypes.BaseModel,_serverGetMethod:"getLookups",_serverGetField:"lookups"}))})(toa);(function(d,c){var b=d.classes.ComplexDataMapper;d.ns("toa.CompanySettings.Plugins.classes.PluginDataMapper",d.define(b,function(c,d){b.apply(this,arguments)},{_modelConstructor:d.CompanySettings.Plugins.models.Plugin,_serverGetMethod:"getPlugin",_serverSaveMethod:"savePlugin",_serverRemoveMethod:"removePlugin",_serverDownloadMethod:"downloadVersionArchive",_serverGetField:"pluginData",_serverSetField:"pluginData",_serverIdField:"alid",download:function(b){this._serverConnector.downloadRequest(this._serverDownloadMethod,
{versionId:b})},save:function(b){var c={};c[this._serverIdField]=b.id;c[this._serverSetField]=this.serialize(b);if(this.isFileUpload(b)){var d={};this._processKeyChain(d,c);d.archive=b.getArchive();return this._serverConnector.formRequest(this._serverSaveMethod,d)}return this._serverConnector.request(this._serverSaveMethod,c)},_processKeyChain:function(b,d,k){k=k||[];c.each(d,function(c,d){""!==d&&null!==d&&("object"===typeof d?this._processKeyChain(b,d,k.concat(c)):(c=k.concat(c).map(function(b,
c){return c?"["+b+"]":b}).join(""),b[c]=d))}.bind(this))},isFileUpload:function(b){return b.isHostedPlugin()&&b.hasArchive()},_getModelJson:function(b){var g=b.pick("label translations entity interface baseAction type".split(" "));if(b.isNativeApp())return d.mixin(g,{nativeApp:b.getNativeAppData()}),g;d.mixin(g,b.pick(["isOnline","serverScript","useApi"]));if(!b.isUseApi())return d.mixin(g,b.pick("pluginPath postData isTab showScroll windowWidth windowHeight".split(" "))),g;b.isAddon()&&(d.mixin(g,
b.pick(["isHosted","secureParams","properties"])),b.isHostedPlugin()||c.extend(g,b.pick(["pluginPath","authType","authLogin","authPassword"])));return g}}))})(toa,$);(function(d){var c=d.classes.DataMapper;d.ns("toa.CompanySettings.Plugins.classes.InitialDataMapper",d.define(c,function(b){c.apply(this,arguments)},{_modelConstructor:d.models.BaseModel,_serverGetMethod:"getInitialData",_serverGetField:"initial_data"}))})(toa);(function(d,c){var b=d.classes.ServerConnector;d.ns("toa.CompanySettings.Plugins.classes.ServerConnector",d.define(b,function(){b.apply(this,arguments)},{formRequest:function(b,g){this.defer=c.Deferred();var k=new FormData,l=GetSessId(),n=d.Ajax.prototype.route(this._controller,b);c.each(g,function(b,c){k.append(b,c)});k.append(l.substr(0,l.indexOf("=")),l.substr(l.indexOf("=")+1,l.length-l.indexOf("=")));set_indicator(2);c.ajax({type:"POST",url:n+"&output=ajax",cache:!1,data:k,dataType:"json",processData:!1,
contentType:!1,success:this.formResponseHandler.bind(this),error:this.defer.reject});return this.defer.promise()},downloadRequest:function(b,d){d=d||{};c.extend(d,{method:b,controller:this._controller});post(d,null,"_blank")},_responseHandler:function(b,c){c.status&&"OK"===c.status?this.defer.resolve(c):this.defer.reject(c)},formResponseHandler:function(b){b?isError(b)?processError({errorHandler:this.defer.reject},b):(d.reloader.clear(),show_content.apply(window,[b])&&this._responseHandler(null,b)):
this.defer.reject()}}))})(toa,$);(function(d,c){d.ns("toa.CompanySettings.Plugins.classes.Validator",d.define(null,function(b){this.model=b;this.errors=new d.models.ObservableCollection},{errors:null,clear:function(){this.errors.clear()},getErrors:function(){return this.errors.toJSON()||[]},getErrorByField:function(b){var c=null;this.errors.each(function(d){b===d.get("field")&&(c=d.toJSON())});return c},hasErrors:function(){return 0<this.errors.getCount()},setError:function(b,c,d,k){this.errors.add({field:b||"",code:d||null,message:c||
"",data:k||null})},checkPlugin:function(){this.clear();this.validateLabel();this.validateTranslations();this.model.isNativeApp()?this.validateNativeApp():(this.model.isHostedPlugin()||this.validateUrl(),this.model.isAddon()&&(this.model.isHostedPlugin()&&this.validateArchive(),this.validateSecureParams()))},validateTranslations:function(){var b=this.model.getPluginName(_DATA.ulanguage);TypeValidator.isStringEmpty(b)&&(b=h(23354),this.setError("name",b,this.constructor.ERROR_MISSING_MANDATORY))},validateLabel:function(){var b=
this.model.getLabel();TypeValidator.isStringEmpty(b)&&(b=h(23352),this.setError("label",b,this.constructor.ERROR_MISSING_MANDATORY))},validateUrl:function(){var b=this.model.getPluginPath();TypeValidator.isStringEmpty(b)?(b=r(806,{"{FIELD}":h(6799)}),this.setError("pluginPath",b,this.constructor.ERROR_MISSING_MANDATORY)):this.model.isUseApi()&&(/^https:\/\/.+$/i.test(b)?TypeValidator.isUrlWithParams(b)||(b=h(16711),this.setError("pluginPath",b,this.constructor.ERROR_WRONG_FORMAT)):(b=h(16709),this.setError("pluginPath",
b,this.constructor.ERROR_WRONG_FORMAT)))},validateNativeApp:function(){c.each(this.model.getNativeAppData(),function(b,c){this._validateNativeAppField("native_app_label",h(13069),c);this._validateNativeAppField("user_agent_mask",h(13070),c);this._validateNativeAppField("path",h(13075),c)}.bind(this))},_validateNativeAppField:function(b,c,d){TypeValidator.isStringEmpty(d[b])&&(c=r(806,{"{FIELD}":c}),this.setError("nativeApp",c,this.constructor.ERROR_MISSING_MANDATORY,{id:d.plugin_id,field:b}))},validateArchive:function(){var b;
if(this.model.hasHostedId()||this.model.hasArchive()){if(b=this.model.getArchive())this._isZipArchive(b)?this._canUpload(b)||(b=h(20630),this.setError("archive",b,this.constructor.ERROR_SIZE_OVERFLOW)):(b=h(20629),this.setError("archive",b,this.constructor.ERROR_WRONG_FORMAT))}else b=h(23137),this.setError("archive",b,this.constructor.ERROR_MISSING_MANDATORY)},_isZipArchive:function(b){b=b.name;return".zip"===b.substr(b.length-4,4).toLowerCase()},_canUpload:function(b){return!(512E3<b.size)},validateSecureParams:function(){var b=
this.model.getSecuredData();if(b.length){var d=[];try{c.each(b,function(b,c){var g=c.key;if(d.hasOwnProperty(g)){var p=Error();p.code=this.constructor.ERROR_KEY_DUPLICATE;p.keyName=g;throw p;}d[g]=!0}.bind(this))}catch(g){b=r(19980,{"{KEY_NAME}":g.keyName});this.setError("secureParams",b,g.code);return}5120<JSON.stringify(b).length&&(b=r(19979,{"{MAX_LENGTH}":5120}),this.setError("secureParams",b,this.constructor.ERROR_SIZE_OVERFLOW))}}},{ERROR_MISSING_MANDATORY:1,ERROR_WRONG_TYPE:2,ERROR_WRONG_FORMAT:3,
ERROR_KEY_DUPLICATE:4,ERROR_SIZE_OVERFLOW:5}))})(toa,$);(function(d){d.ns("toa.CompanySettings.Plugins.controllers.AddEditPlugin",d.define(d.Controller,function(c){_DATA.ulanguage=d.app.model("companySettings").getUser().ulanguage||1;this.sandbox=c;this.pageLabel=this.sandbox.name;this.content=c.options.content;this.triggerFunction=c.trigger.bind(c);this.resume(c.options)},{toString:function(){return"Forms and Plugins: Add/edit plugin screen controller"},setParams:function(c){this.params=$.extend({},c.params);this.readOnlyMode=!!this.params.isReadOnlyMode;
this.actionLinkId=this.params.actionLinkId||null},isNewPlugin:function(){return null===this.getActionLinkId()},isReadOnly:function(){return this.readOnlyMode||!1},getActionLinkId:function(){return this.actionLinkId||null},setActionLinkId:function(c){this.actionLinkId=c||null},resume:function(c){this.triggerFunction("layout.tabs.set",{tabs:0,show:0});this.setParams(c);this.triggerFunction("layout.menu.changeTitle",{label:"company_settings_forms_and_plugins",url:"",name:this.getScreenTitle(),params:{}});
this.createPanelTitle();this.initModels();this.initViews();this.showInitialViews();this.loadPluginData()},createPanelTitle:function(){this.panel=d.view.control.create({xtype:"PanelTitleAlta",addClass:"jet-css-only toa-panel-title jet-screen-title toa-addeditplugin-title-panel",name:"titleCaption",headerResponsive:_DATA.page_label,titleText:this.getScreenTitle(),resourceTreeButton:!1,backButton:!0,backButtonIcon:"",backButtonLabel:_DATA.glossary.action_links.company_settings_forms_and_plugins,backButtonHint:h(16257),
filter:!1,calendar:!1,listeners:{backButtonClick:this.returnToPluginsScreen.bind(this)}});this.panel.render(this.content)},returnToPluginsScreen:function(){this.triggerFunction("layout.menu.click",{label:"company_settings_forms_and_plugins",url:"",name:_DATA.glossary.action_links.company_settings_forms_and_plugins,params:{}})},getScreenTitle:function(){var c="";return c=this.isReadOnly()?h(23126):this.isNewPlugin()?h(23124):h(23125)},initModels:function(){this.serverConnector=new d.CompanySettings.Plugins.classes.ServerConnector(this.triggerFunction,
"pluginsconfiguration");this.lookupsDataMapper=new d.CompanySettings.Plugins.classes.LookupsDataMapper(this.serverConnector);this.lookupsModel=this.lookupsDataMapper.create({baseActions:{},entities:{},languages:{},properties:{}});this.propertiesDataMapper=new d.CompanySettings.Plugins.classes.PropertiesDataMapper(this.serverConnector,new d.CompanySettings.Plugins.classes.PropertyDataMapper(null),this.lookupsModel);this.pluginDataMapper=new d.CompanySettings.Plugins.classes.PluginDataMapper(this.serverConnector,
{properties:this.propertiesDataMapper});this.pluginModel=this.pluginDataMapper.create({alid:this.getActionLinkId()});this.versionCollection=new d.models.ObservableCollection;this.validator=new d.CompanySettings.Plugins.classes.Validator(this.pluginModel)},initViews:function(){this.container=new d.CompanySettings.Plugins.views.AddEditPlugin.FormContainer;this.pluginForm=new d.CompanySettings.Plugins.views.AddEditPlugin.FormSections;this.generalSection=new d.CompanySettings.Plugins.views.AddEditPlugin.GeneralSection({model:this.pluginModel,
lookupsModel:this.lookupsModel});this.settingsSection=new d.CompanySettings.Plugins.views.AddEditPlugin.SettingsSection({model:this.pluginModel});this.propertiesSection=new d.CompanySettings.Plugins.views.AddEditPlugin.PropertiesSection;this.versionsListView=new d.CompanySettings.Plugins.views.AddEditPlugin.VersionsList({collection:this.versionCollection});this.settingsSection.addListener("isPluginApi:true",this.onPluginApiIsUsed.bind(this));this.settingsSection.addListener("isPluginApi:false",this.onPluginApiIsNotUsed.bind(this));
this.settingsSection.addListener("version:showhide",this.onShowHideVersion.bind(this));this.versionsListView.addListener("version:download",this.onDownloadVersion.bind(this));this.container.addListener("save:clicked",this.onSaveClicked.bind(this));this.container.addListener("cancel:clicked",this.onCancelClicked.bind(this))},onPluginApiIsUsed:function(){this.pluginForm.showPluginProperties()},onPluginApiIsNotUsed:function(){this.pluginForm.hidePluginProperties()},onShowHideVersion:function(c,b){!0===
b?this.pluginForm.showVersions():this.pluginForm.hideVersions()},onDownloadVersion:function(c,b,d){this.pluginDataMapper.download(d)},showInitialViews:function(){this.container.render(this.content,!0);this.isReadOnly()&&this.setScreenReadOnly(!0)},loadPluginData:function(){this.lookupsDataMapper.load(this.lookupsModel).then(function(){return this.pluginDataMapper.load(this.pluginModel)}.bind(this)).done(this.onLoadSuccess.bind(this)).fail(this.onLoadError.bind(this))},onLoadSuccess:function(c){this.versionCollection.reset(this.pluginModel.getVersions());
this.propertiesSection.setCollection(this.pluginModel.get("properties"));this.pluginModel.isInternal()&&this.setScreenReadOnly(!0);this.showPluginDetails();this.container.showButton()},onLoadError:function(c){c&&c.status&&"ERR_NOT_FOUND"===c.status?this.container.showNotFound():c&&c.error_code?this.showError(h(23133)):this.showDefaultError()},showPluginDetails:function(){this.container.showRegion("form",this.pluginForm);this.pluginForm.showRegion("generalSettings",this.generalSection);this.pluginForm.showRegion("pluginSettings",
this.settingsSection);this.pluginForm.showRegion("versionHistory",this.versionsListView);this.pluginForm.showRegion("properties",this.propertiesSection)},setScreenReadOnly:function(c){this.container.setReadOnlyMode(c);this.generalSection.setReadOnlyMode(c);this.settingsSection.setReadOnlyMode(c);c&&this.container.hideButton()},onSaveClicked:function(){this.settingsSection.getSecuredData();this.settingsSection.getNativeAppData();this.clearErrors();this.validator.checkPlugin();this.validator.hasErrors()?
(this.showErrorsList(this.validator.getErrors()),this.container.setBtnDisabled(!1)):this.pluginDataMapper.save(this.pluginModel).done(this.onSaveSuccess.bind(this)).fail(this.onSaveError.bind(this))},onCancelClicked:function(){this.returnToPluginsScreen()},clearErrors:function(){this.generalSection.clearErrors();this.settingsSection.clearErrors()},bindFormError:function(c){if((c=c||null)&&c.field)switch(c.field){case "label":case "name":this.generalSection.showFieldError(c);break;default:this.settingsSection.showFieldError(c)}},
onSaveSuccess:function(c){console.log("save: success",c);this.returnToPluginsScreen()},onSaveError:function(c){console.log("save: error",c);this.container.setBtnDisabled(!1);c&&c.status&&"ERR_VALIDATION"===c.status&&c.errors_list&&c.errors_list.length?this.showErrorsList(c.errors_list):c&&c.error_message?this.showError(c.error_message):c&&c.error_code?this.showError(h(23134)):this.showDefaultError()},suspend:function(){this.destroy()},destroy:function(){this.versionCollection.clear();this.panel.destroy();
this.container.destroy();this.content.empty()},showErrorsList:function(c){c=c||[];$.each(c,function(b,c){console.log(c);this.bindFormError(c)}.bind(this))},showDefaultError:function(){this.showError(h(15367))},showError:function(c,b){c=c||h(3057);b=b||h(5651);return this.showPopup(b,c)},showPopup:function(c,b,e){c=c||"";b=b||"";var g=$.Deferred();e&&$.isArray(e)&&e.length?$.each(e,function(b,c){if("function"===typeof c.click){var d=c.click;c.click=function(){var b=Array.prototype.slice.call(arguments);
b.unshift(g);d.apply(this,b)}}}.bind(this)):e=[{text:h(445),position:"right",tpl:'<button class="popup-button toa-button"></button>',click:function(){g.reject()}}];g.always(function(){k.destroy()});var k=new d.ui.Popup({title:c,autoOpen:!0,html:b,modal:!0,onClose:function(){k.destroy();g.reject()},buttons:e});k._dom.base.id="toa-pluginsconfiguration-popup";return g}}))})(toa);(function(d){d.ns("toa.CompanySettings.Forms.controllers.Forms",d.define(d.Controller,function(c){this.sandbox=c;this.pageLabel=this.sandbox.name;this.content=c.options.content;this.triggerFunction=c.trigger.bind(c);this._accessModeTrigger=this._formsController+".accessMode";this.previousFilters={default:!0,searchText:"",currentView:"all"};this.setCurrentView();this.resume()},{_formsController:"formsconfiguration",_pluginsController:"pluginsconfiguration",_loadedBlocksDef:{plugins:!1,forms:!1},_loadedBlocks:{plugins:!1,
forms:!1},bulkImportOperationStatus:null,toString:function(){return"Forms and Plugins Screen controller"},createPanelTitle:function(){this.actionPanelList=[{xtype:"Button",label:h(22613),name:"add_new_form",attr:{tabindex:0},listeners:{click:this.onAddNewForm.bind(this)}},{xtype:"Button",label:h(22614),name:"add_new_plugin",attr:{tabindex:0},listeners:{click:this.onAddNewPlugin.bind(this)}},{xtype:"Button",label:h(18388),name:"export_forms",attr:{tabindex:0},listeners:{click:this.onExportForms.bind(this)}},
{xtype:"button.Menu",label:h(13304),tag:"button",attr:{tabindex:0},addClass:"import_menu",menuItems:[{xtype:"Button",label:h(19519),name:"bulk_import_forms",attr:{tabindex:0},listeners:{click:this.onBulkImportForms.bind(this)}},{xtype:"Button",label:h(227111),name:"import_plugins",listeners:{click:this.onPluginsImport.bind(this)}}]}];this.actionPanelListReadOnly=[{xtype:"Button",label:h(18388),name:"export_forms",attr:{tabindex:0},listeners:{click:this.onExportForms.bind(this)}}];this.panel=d.view.control.create({xtype:"PanelTitleAlta",
addClass:"jet-css-only toa-panel-title jet-screen-title panel-title-forms-settings",titleText:r(22612),name:"titleCaption",resourceTreeButton:!1,backButton:!0,backButtonIcon:"",backButtonLabel:_DATA.glossary.action_links.company_settings_configuration,backButtonHint:h(16257),calendar:!1,filterDesc:this.getFilter(),listeners:{backButtonClick:this.returnToConfigScreen.bind(this),filterApply:this.onViewData.bind(this)}});this.sandbox.bind(this._accessModeTrigger,this.showHideReadWriteActions.bind(this));
this.panel.render(this.content);this.attachPanelEventListeners()},attachPanelEventListeners:function(){var c=this;$('input[name="searchText"]').on("keydown",function(b){switch(b.keyCode){case 13:c.panel.notify("filterApply",{values:c.panel.getFilterPopup().getChild("filterForm").getValues()}),b.preventDefault()}})},getFilter:function(){var c=this;return[{xtype:"Input",name:"searchText",formLabel:d.glossary({id:1747})},{xtype:"Select",name:"viewData",value:this.getCurrentView(),withEmpty:!1,optionItems:[{label:"*",
value:"all"},{label:h(18181),value:"forms"},{label:h(18182),value:"plugins"}],listeners:{change:function(b,d){c.onSelectorsChange(b,d)}}}]},setPreviousFiltersValues:function(c){this.previousFilters=c;this.updateHtmlFilter()},setDefaultFilters:function(){this.previousFilters={default:!0,searchText:"",currentView:"all"};this.updateHtmlFilter()},updateHtmlFilter:function(){$("input[name=searchText]").val(this.previousFilters.searchText);$("select[name=viewData]").val(this.previousFilters.currentView)},
onSelectorsChange:function(c,b){var d=this.panel.getFilterPopup().findChild("filterForm").getValues();this.setCurrentView(d.viewData)},showHideReadWriteActions:function(c,b){!0===b?(this.panel.setOption("actions",this.actionPanelList),this.readOnlyMode=!1):(this.panel.setOption("actions",this.actionPanelListReadOnly),this.readOnlyMode=!0);this.panel.setOption("headerResponsive",_DATA.page_label)},returnToConfigScreen:function(){$app.navigation().redirect("company_settings_configuration")},onAddNewForm:function(c,
b){this.createFormPopup()},compactFormsPLuginsList:function(){var c=new d.CompanySettings.Forms.models.BaseCollection;this.formsListCollection.each(function(b){c.add({id:b.get("form_id"),translation:b.get("name")+" ["+b.get("label")+"]",status:b.get("status"),label:b.get("label"),assigned:!1,type:"form"},{silent:!0})});this.pluginsListCollection.each(function(b){"internal"!=b.get("type")&&c.add({id:b.get("alid"),translation:b.get("text")+" ["+b.get("label")+"]",status:"",label:b.get("label"),assigned:!1,
type:"plugin"},{silent:!0})});return c},onBulkUploadError:function(c){this.bulkImportOperationStatus.failed||(this.bulkImportOperationStatus.failed=!0,this.uploadStatusInterval&&(window.clearInterval(this.uploadStatusInterval),this.uploadStatusInterval=null),c&&c.message&&this.importBulkUploadForm.errorMessages([c.message]))},uploadRequestProgress:0,uploadRequestCount:0,uploadRequestLimit:60,uploadStatusInterval:null,uploadStatusTimeout:3E3,bulkUploadRequest:function(c){this.uploadRequestCount++;
if(this.uploadRequestLimit<this.uploadRequestCount)window.clearInterval(this.uploadStatusInterval),this.uploadStatusInterval=null,c.onError({message:h(3057)});else{var b=new FormData;c&&c.params&&$.each(c.params,function(c,d){b.append(c,d)});var e=GetSessId();b.append(e.substr(0,e.indexOf("=")),e.substr(e.indexOf("=")+1,e.length-e.indexOf("=")));e=d.Ajax.prototype.route("formsconfiguration",c.method);$.ajax({type:"POST",url:e+"&output=ajax",data:b,dataType:"json",cache:!1,processData:!1,contentType:!1,
success:c.onSuccess,error:c.onError})}},initBulkImportForm:function(){this.importBulkUploadForm=new d.CompanySettings.Forms.views.ImportBulk.ImportUploadForm;this.importBulkUploadForm.addListener("bulk-import:upload",this.formsBulkUpload,this);this.importBulkUploadForm.addListener("bulk-import:import",this.formsBulkImport,this);this.importBulkUploadForm.addListener("bulk-import:finish",this.formsBulkCleanup,this)},onBulkImportForms:function(c,b){this.bulkUploadRequest({method:"bulkImportInit",onSuccess:function(b){this.importBulkUploadForm.show({maxFileSize:b.initial["file-upload-max-size"]||
10485760})}.bind(this),onError:this.onBulkUploadError.bind(this)})},resetOperationStatus:function(){this.bulkImportOperationStatus={imported:!1,failed:!1,validated:!1,uploaded:!1}},formsBulkUpload:function(c,b){this.resetOperationStatus();this.bulkUploadRequest({method:"bulkImportUploadFile",params:{fileImport:b.file},onSuccess:this.onBulkUploadSuccess.bind(this),onError:this.onBulkUploadError.bind(this)})},onBulkUploadSuccess:function(c){if("ERR"===c.status)return this.onBulkUploadError(c);if("ERR-UPLOAD"===
c.status)return this.importBulkUploadForm.uploadError(),this.onBulkUploadError(c);if("ERR-UPLOAD-METADATA"===c.status)return this.importBulkUploadForm.metadataMisssingError(),this.onBulkUploadError(c);if("ERR-SESSION-EXPIRE"===c.status)return this.importBulkUploadForm.sessionExpireError(),this.onBulkUploadError(c);this.importBulkUploadForm.importSession(c.import_session_id);this.importBulkUploadForm.fileMetadata({status:c.status,file:c.file,stats:c.stats,forms:c.forms});this.bulkUploadStatus(c.import_session_id)},
bulkUploadStatus:function(c){this.uploadRequestCount=0;this.uploadStatusInterval=window.setInterval(function(){this.bulkUploadRequest({method:"bulkImportUploadStatus",params:{import_session_id:c},onSuccess:this.onBulkUploadStatusSuccess.bind(this),onError:this.onBulkUploadError.bind(this)})}.bind(this),this.uploadStatusTimeout)},onBulkUploadStatusSuccess:function(c){if(!this.bulkImportOperationStatus[c.status]){"uploaded"==c.status&&(this.bulkImportOperationStatus[c.status]=!0,window.clearInterval(this.uploadStatusInterval),
this.uploadStatusInterval=null);this.uploadRequestProgress=Math.ceil(0.5*c.progress+0.1);this.importBulkUploadForm.importSession(c.import_session_id);this.importBulkUploadForm.updateProgressTo(this.uploadRequestProgress);this.importBulkUploadForm.fileMetadata({status:c.status,file:c.file,stats:c.stats,forms:c.forms});if("ERR"===c.status)return this.onBulkUploadError(c);if("ERR-SESSION-EXPIRE"===c.status)return this.importBulkUploadForm.sessionExpireError(),this.onBulkUploadError(c);"uploaded"==c.status&&
(this.importBulkUploadForm.updateProgressTo(null),this.bulkUploadValidation(c.import_session_id))}},bulkUploadValidation:function(c){this.uploadRequestCount=0;this.uploadStatusInterval=window.setInterval(function(){this.bulkUploadRequest({method:"bulkImportValidationStatus",params:{import_session_id:c},onSuccess:this.onBulkUploadValidationSuccess.bind(this),onError:this.onBulkUploadError.bind(this)})}.bind(this),this.uploadStatusTimeout)},onBulkUploadValidationSuccess:function(c){if(!this.bulkImportOperationStatus[c.status]){"validated"==
c.status&&(this.bulkImportOperationStatus[c.status]=!0,window.clearInterval(this.uploadStatusInterval),this.uploadStatusInterval=null);if("ERR"===c.status)return this.onBulkUploadError(c);if("ERR-SESSION-EXPIRE"===c.status)return this.importBulkUploadForm.sessionExpireError(),this.onBulkUploadError(c);var b=this.uploadRequestProgress+Math.ceil(0.5*c.progress);this.importBulkUploadForm.importSession(c.import_session_id);this.importBulkUploadForm.updateProgressTo(b);this.importBulkUploadForm.fileMetadata({status:c.status,
forms:c.forms,validation:c.validation,stats:c.stats});"validated"==c.status&&this.importBulkUploadForm.updateProgressTo(100)}},formsBulkImport:function(c,b){this.uploadRequestCount=0;this.uploadStatusInterval=window.setInterval(function(){this.bulkUploadRequest({method:"bulkImportApply",params:{import_session_id:b.import_session_id},onSuccess:this.onBulkImportApplySuccess.bind(this),onError:this.onBulkUploadError.bind(this)})}.bind(this),this.uploadStatusTimeout)},onBulkImportApplySuccess:function(c){if(!this.bulkImportOperationStatus[c.status]){"imported"==
c.status&&(this.bulkImportOperationStatus[c.status]=!0,window.clearInterval(this.uploadStatusInterval),this.uploadStatusInterval=null);if("ERR"===c.status)return this.onBulkUploadError(c);if("ERR-SESSION-EXPIRE"===c.status)return this.importBulkUploadForm.sessionExpireError(),this.onBulkUploadError(c);this.importBulkUploadForm.importSession(c.import_session_id);this.importBulkUploadForm.updateProgressTo(c.progress);this.importBulkUploadForm.fileMetadata({status:c.status});"imported"==c.status&&this.importBulkUploadForm.updateProgressTo(100)}},
formsBulkCleanup:function(c,b){this.uploadStatusInterval&&(window.clearInterval(this.uploadStatusInterval),this.uploadStatusInterval=null);this.afterChangeForm();this.bulkUploadRequest({method:"bulkImportClearData",params:{import_session_id:b.import_session_id}})},onExportForms:function(c,b){var e=this,g=this.compactFormsPLuginsList(),k=d.create("toa.CompanySettings.Forms.views.Export.FilterableExportList",{filterSelect:!0,collection:g});k.addListener("filterable-list:toggle-select-all",function(){n.disableButton("exportButton");
0<$('.filterableListSection .checkboxTable tr:not(.hidden) input[type="checkbox"]:checked').length&&n.enableButton("exportButton")});var l=function(){n.disableButton("exportButton");var b=$('.filterableListSection .checkboxTable tr:not(.hidden) input[type="checkbox"]'),c=$(b).filter(":checked").length;0<parseInt(c)&&n.enableButton("exportButton");0<parseInt(b.length)&&0<parseInt(c)&&parseInt(c)==parseInt(b.length)?$('input[name="filterSelectAll"]').prop("checked",!0):$('input[name="filterSelectAll"]').prop("checked",
!1);$(".selectedElem").text(c)};k.addListener("list:change",l);k.addListener("list:on_type_search",l);var n=new d.ui.Popup({title:h(18390),autoOpen:!0,view:k,modal:!0,popup_extra_css_class:"form-export",onClose:function(){n.destroy()},buttons:[{text:h(14621),position:"right",type:"standard",click:function(){n.destroy()}},{id:"exportButton",text:h(14622),position:"right",type:"submit",click:function(b){var c=[],d=$("input[name='exportType']:checked").val();g.each(function(b){var e="string"===typeof b.getId()?
b.getId().replace(/'/g,"\\'").replace(/"/g,'\\"'):b.getId(),e=$('.checkboxTable tr[data-id="'+e+'"]').hasClass("hidden");!0!==b.get("assigned")||b.get("type")!=d||e||"undefined"!==typeof b.get("disabled")&&!1!==b.get("disabled")||c.push(encodeURIComponent(b.get("id")))});if(!c.length)return n.disableButton("exportButton"),!1;"form"==d?this.exportSelectedForms(c):this.exportSelectedPlugins(c);n.destroy();e.renderJetComponents();return!1}.bind(this)}]});$("#exportForm").focus();n.disableButton("exportButton")},
renderJetComponents:function(){var c=this;require("require exports knockout ojs/ojbootstrap ojs/ojarraydataprovider ojs/ojknockout ojs/ojmessages".split(" "),function(b,d,g,k,l){function n(){this.messages=[{severity:"confirmation",summary:h(18408),autoTimeout:3E3}];this.messagesDataprovider=new l(this.messages)}k.whenDocumentReady().then(function(){var b=c.containerView.getElement().find("#notificationMessages")[0];g.cleanNode(b);var d=$(c.toastMessageView.getHtml());$(b).empty().append(d);g.applyBindings(new n,
d.get(0))})})},exportSelectedForms:function(c){var b=c.length?Object.keys(c).map(function(b){return"ids[]="+c[b]}).join("&"):"";exportRequest({controller:"formsconfiguration",method:"bulkFormExport",ids:c.length?c:[]},b,!0)},onAddNewPlugin:function(c,b){this.openPluginScreen()},getCurrentView:function(){return _DATA.formsAndPluginsViewFilter||"all"},setCurrentView:function(c){_DATA.formsAndPluginsViewFilter=c||"all"},resume:function(){this.triggerFunction("layout.tabs.set",{tabs:0,show:0});this.triggerFunction("layout.menu.changeTitle",
{label:"company_settings_forms_and_plugins",url:"",name:r(22612),params:{}});this.createPanelTitle();this.initModels();this.initViews();this.initBulkImportForm();this.showContainerView();this.initialDataMapper.load(this.initialModel).done(this.getList.bind(this)).fail(function(c,b){this.sandbox.error(b);this.showError(h(15367))}.bind(this))},getList:function(){this.userTypesReadOnlyMode=2!==this.initialModel.get("user_types_permission");this.containerView.getElement().find(".form_list").show();this.containerView.getElement().find(".plugin_list").show();
this.getAllList()},getFormsList:function(){this.formsListMapper.load(this.formsListCollection).done(this.refreshFormList.bind(this,!0)).fail(this.onLoadListFail.bind(this))},getPluginsList:function(){var c=this;this.pluginsListMapper.load(this.pluginsListCollection).done(function(){c.refreshPluginList(!0)}).fail(this.onLoadPluginListFail.bind(this))},refreshAllListsAfterImportPlugins:function(){this.listView.setReadOnlyMode(this.readOnlyMode);"plugins"!==this.previousFilters.currentView&&this.containerView.showRegion("form_list",
this.listView);this.pluginsListMapper.load(this.pluginsListCollection).done(function(){this._loadedBlocks.forms=!0;this.refreshPluginList(!0)}.bind(this)).fail(this.onLoadPluginListFail.bind(this))},getAllList:function(){this.getFormsList();this.getPluginsList()},onLoadListFail:function(c){this.sandbox.error(c);this.showError(h(22630))},initModels:function(){var c=new d.classes.ServerConnector(this.triggerFunction,this._formsController);this.initialDataMapper=new d.CompanySettings.Forms.classes.InitialDataMapper(c);
this.initialModel=this.initialDataMapper.create();this.formsListItemMapper=new d.CompanySettings.Forms.classes.ListItemDataMapper(c);this.formsListMapper=new d.CompanySettings.Forms.classes.ListDataMapper(c,this.formsListItemMapper);this.formsListCollection=this.formsListMapper.create();this.formMapper=new d.CompanySettings.Forms.classes.FormDataMapper(c);this.formModel=this.formMapper.create();c=new d.classes.ServerConnector(this.triggerFunction,this._pluginsController);this.pluginsListItemMapper=
new d.CompanySettings.Plugins.classes.ListItemDataMapper(c);this.pluginsListMapper=new d.CompanySettings.Plugins.classes.ListDataMapper(c,this.pluginsListItemMapper);this.pluginsListCollection=this.pluginsListMapper.create();this.pluginMapper=new d.CompanySettings.Plugins.classes.PluginDataMapper(c);this.pluginModel=this.pluginMapper.create();this.formsListCollection.setSortedField("date","date")},initViews:function(){this.containerView=new d.CompanySettings.Forms.views.Container;this.toastMessageView=
new d.CompanySettings.Forms.views.Export.ToastMessage;this.listView=new d.CompanySettings.Forms.views.FormsList({collection:this.formsListCollection});this.pluginView=new d.CompanySettings.Plugins.views.PluginsList({collection:this.pluginsListCollection});this.listView.setReadOnlyMode(this.readOnlyMode);this.listView.addListener("formaction:delete",this.onFormDelete,this);this.listView.addListener("formaction:modify",this.onFormModify,this);this.listView.addListener("formaction:view",this.onFormView,
this);this.listView.addListener("formaction:displayFormLinks",this.onDisplayConfiguredFormLinks,this);this.listView.addListener("formaction:viewContent",this.onFormChangeContent,this);this.listView.addListener("formaction:changeContent",this.onFormChangeContent,this);this.listView.addListener("formaction:import",this.onFormImport,this);this.listView.addListener("formaction:export",this.onFormExport,this);this.listView.addListener("formaction:listLoaded",this.onFormsListLoaded,this);this.pluginView.setReadOnlyMode(this.readOnlyMode);
this.pluginView.addListener("pluginaction:delete",this.onPluginDelete,this);this.pluginView.addListener("pluginaction:modify",this.onPluginModify,this);this.pluginView.addListener("pluginaction:view",this.onPluginView,this);this.pluginView.addListener("pluginaction:export",this.onPluginExport,this);this.pluginView.addListener("pluginaction:displayPluginLinks",this.onDisplayConfiguredPluginLinks,this);this.pluginView.addListener("pluginaction:listLoaded",this.onPluginListLoaded,this)},onPluginListLoaded:function(){this._loadedBlocks.plugins=
!0;this.onListLoaded()},onFormsListLoaded:function(){this._loadedBlocks.forms=!0;this.onListLoaded()},onListLoaded:function(){switch(this.previousFilters.currentView){case "all":if(!0===this._loadedBlocks.plugins&&!0===this._loadedBlocks.forms){if(!this.previousFilters.default)this.onSearch(this.previousFilters.searchText);this.containerView.showRegion("form_list",this.listView);this.containerView.showRegion("plugin_list",this.pluginView);this._loadedBlocks=Object.assign({},this._loadedBlocksDef)}break;
case "plugins":if(!0===this._loadedBlocks.plugins){if(!this.previousFilters.default)this.onSearch(this.previousFilters.searchText);this.containerView.showRegion("plugin_list",this.pluginView);this._loadedBlocks=Object.assign({},this._loadedBlocksDef)}break;case "forms":if(!0===this._loadedBlocks.forms){if(!this.previousFilters.default)this.onSearch(this.previousFilters.searchText);this.containerView.showRegion("form_list",this.listView);this._loadedBlocks=Object.assign({},this._loadedBlocksDef)}}},
onSearch:function(c){c=c.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&").trim();var b=!0;if(""!==c.trim()||"all"!==this.getCurrentView())b=!1;this.setPreviousFiltersValues({default:b,searchText:c,currentView:this.getCurrentView()});if("forms"==this.getCurrentView())this.onSearchForm(c);else"plugins"!=this.getCurrentView()&&(this.isFormNotExists=!1,this.onSearchForm(c)),this.onSearchPlugin(c)},onSearchForm:function(c){if(!c)return this.refreshFormListCollection();for(var b=[],e=0;e<this.formsListCollection.models.length;e++){var g=
RegExp(c,"gi"),k=this.formsListCollection.models[e];(k.get("label","").match(g)||k.get("name","").match(g))&&b.push(k)}b=new d.CompanySettings.Forms.models.SortableCollection(b);this.listView.noItemsView=d.CompanySettings.Forms.views.NoItems;"all"==this.getCurrentView()&&0==b.getCount()&&(this.listView.noItemsView=null,this.isFormNotExists=!0);this.refreshFormListCollection(b)},onSearchPlugin:function(c){if(!c)return this.refreshPluginListCollection();for(var b=[],e=0;e<this.pluginsListCollection.models.length;e++){var g=
RegExp(c,"gi"),k=this.pluginsListCollection.models[e];(k.get("label","").match(g)||k.get("text","").match(g))&&b.push(k)}b=new d.CompanySettings.Plugins.models.SortableCollection(b);this.pluginView.noItemsView=d.CompanySettings.Plugins.views.NoItems;"all"!=this.getCurrentView()||this.isFormNotExists||(this.pluginView.noItemsView=null);this.refreshPluginListCollection(b)},onViewData:function(c,b){var d="undefined"!==typeof b.values.viewData?b.values.viewData:"all";if("undefined"!==typeof b.values.searchText)this.onSearch(b.values.searchText);
this.setCurrentView(d);this.containerView.getElement().find(".form_list").show();this.containerView.getElement().find(".plugin_list").show();"plugins"==d?(this.getPluginsList(),this.containerView.getElement().find(".form_list").hide()):"forms"==d?(this.getFormsList(),this.containerView.getElement().find(".plugin_list").hide()):this.getAllList();this.panel.closeFilter()},refreshPluginListCollection:function(c){c=c||this.pluginsListCollection;this.pluginView.setCollection(c);this.refreshPluginList()},
refreshPluginList:function(c){"undefined"===typeof c&&(c=!1);this.pluginView.setReadOnlyMode(this.readOnlyMode);!0===c?this.pluginView.notify("pluginaction:listLoaded"):this.containerView.showRegion("plugin_list",this.pluginView)},onLoadPluginListFail:function(c){this.sandbox.error(c);this.showError(h(18153))},deletePluginPopup:null,onPluginDelete:function(c,b){var e=b.model;if(!e||!1===e.isRemovable())return this.showError(h(23138),h(14603)),!1;var g=this;this.deletePluginPopup=new d.ui.Popup({title:h(18392),
autoOpen:!0,html:r(16557,{"{LINE_BREAK}":"</br>","{PLUGIN_NAME}":e.get("text","")}),modal:!0,popup_extra_css_class:"form-popup",buttons:[{id:"dismiss_btn",text:h(8623),position:"right",click:function(){g.deletePluginPopup.destroy()}},{id:"delete_btn",text:h(972),type:"submit",position:"right",click:function(){g.deletePluginPopup.disableButton("dismiss_btn");g.deletePluginPopup.disableButton("delete_btn");this.removePlugin(e);g.pluginView.addListener("pluginaction:listLoaded",function(){g.deletePluginPopup&&
(g.deletePluginPopup.destroy(),g.deletePluginPopup=null)},g)}.bind(this)}]})},onPluginExport:function(c,b){var d=["actionLinkId="+encodeURIComponent(b.model.id)],d=this._getDownloadUrl("Formsconfiguration","exportPlugins",d);download_file(d)},onPluginModify:function(c,b){this.openPluginScreen(b.model.getId())},onPluginView:function(c,b){this.openPluginScreen(b.model.getId(),!0)},openPluginScreen:function(c,b){this.triggerFunction("layout.menu.click",{label:"company_settings_add_edit_plugin",url:"",
name:"",params:{isReadOnlyMode:b||!1||this.readOnlyMode,actionLinkId:c||null}})},removePlugin:function(c){var b=new d.CompanySettings.Plugins.classes.ServerConnector(this.triggerFunction,"pluginsconfiguration");(new d.CompanySettings.Plugins.classes.PluginDataMapper(b)).remove(c).done(function(){this._loadedBlocks.forms=!0;this.getPluginsList()}.bind(this)).fail(function(b){this.showError(h(23139)).always(this.refreshPluginList.bind(this))}.bind(this))},deleteFormPopup:null,onFormDelete:function(c,
b){var e=b.model;if(!e||!1===e.isRemovable())return this.showError(h(16556),h(14603)),!1;var g=this;this.deleteFormPopup=new d.ui.Popup({title:h(18391),autoOpen:!0,html:r(16554,{"{LINE_BREAK}":"</br>","{FORM_NAME}":e.getFormName()}),modal:!0,popup_extra_css_class:"form-popup",buttons:[{id:"dismiss_btn",text:h(8623),position:"right",click:function(){g.deleteFormPopup.destroy()}},{id:"delete_btn",text:h(972),type:"submit",position:"right",click:function(b){g.deleteFormPopup.disableButton("dismiss_btn");
g.deleteFormPopup.disableButton("delete_btn");this.removeForm(e);this.listView.addListener("formaction:listLoaded",function(){g.deleteFormPopup&&(g.deleteFormPopup.destroy(),g.deleteFormPopup=null)},g)}.bind(this)}]})},removeForm:function(c){this.formMapper.remove(c).done(this.afterChangeForm.bind(this)).fail(function(b){this.showError(h(16555)).always(this.refreshFormList.bind(this))}.bind(this))},onFormModify:function(c,b){this.createFormPopup({form_id:b.model.getId(),label:b.model.get("label",
""),translations:b.model.get("translations",{})},"edit")},onFormView:function(c,b){this.createFormPopup({form_id:b.model.getId(),label:b.model.get("label",""),translations:b.model.get("translations",{})},"view")},onFormChangeContent:function(c,b){this.triggerFunction("layout.menu.click",{label:"company_settings_forms_and_plugins_content",url:"",name:h(15001),params:{isForm:!0,formId:b.model.getId(),formLabel:b.model.get("label"),onClose:function(){this.triggerFunction("layout.menu.click",{label:this.pageLabel,
url:"",name:r(22612),params:{}})}.bind(this)}})},_getDownloadUrl:function(c,b,d){var g="?";_DATA.is_mobility_app?(d.push("m="+c),d.push("a="+b),d.push("itype=manage")):(d.push("controller="+c),d.push("method="+b));return g+=d.join("&")},onFormExport:function(c,b){var d=["form_id="+encodeURIComponent(b.model.getId())],d=this._getDownloadUrl("Formsconfiguration","exportFormContent",d);download_file(d)},onFormImport:function(c,b){var e=b.model.get("label");this.importFileUploadForm&&this.importFileUploadForm.destroy();
this.importFileUploadForm=new d.CompanySettings.Forms.views.Import.ImportFileUpload(e);this.importFileUploadForm.addListener("import.validate",this.onFormImportValidate.bind(this));this.importFileUploadForm.show()},onFormImportValidate:function(c,b){this.importStatusForm&&this.importStatusForm.destroy();this.importStatusForm=new d.CompanySettings.Forms.views.Import.ImportFileUploadStatus({model:b});this.importStatusForm.addListener("import.finish",this.afterChangeForm.bind(this));this.importStatusForm.show()},
showContainerView:function(){this.containerView.render(this.content,!0);this.screen=this.containerView.getElement()},refreshFormList:function(c){"undefined"===typeof c&&(c=!1);this.listView.setReadOnlyMode(this.readOnlyMode);!0===c?this.listView.notify("formaction:listLoaded"):this.containerView.showRegion("form_list",this.listView)},refreshFormListCollection:function(c){c=c||this.formsListCollection;this.listView.setCollection(c);this.refreshFormList()},destroyFormPopup:function(){this.formPopup instanceof
d.ui.Popup&&this.formPopup.destroy()},onSubmitFormPopup:function(c){this.formPopup.setErrors([]);if(!this.formView.validate())return this.formView.clearErrors(),this.formView.showErrors(this.formView.getValidationErrors()),!1;this.lockFormPopup(!0,c.target);this.formMapper.save(this.formModel).done(this.onSaveFormSuccess.bind(this)).fail(this.onSaveFormFail.bind(this))},onSaveFormSuccess:function(c){this.afterChangeForm();this.formPopup.destroy()},onSaveFormFail:function(c){this.formView.clearErrors();
var b=h(22631),d=[];switch(c){case 79:b=h(22632);d.push({class:"frmLabel",id:"error_"+c,message:b});break;case 22634:b=h(22634);d.push({class:"frmLabel",id:"error_"+c,message:b});break;case 22633:b=h(22633);d.push({class:"frmName.required",id:"error_"+c,message:b});break;case 16551:b=h(16551)}this.lockFormPopup(!1);0===d.length?(this.formPopup.destroy(),this.showError(b)):this.formView.showErrors(d)},createFormPopup:function(c,b){c=c||null;b=b||"add";var e="";switch(b){case "add":e=h(22622);break;
case "view":e=h(16552);break;case "export":e=h(18390);break;default:e=h(22623)}this.formView&&this.formView.destroy();this.formModel.setData(c);this.formView=new d.CompanySettings.Forms.views.Form({model:this.formModel});this.formView.setReadOnlyMode(this.readOnlyMode);this.formView.setLanguageCollection(this.initialModel.get("languages",[]));var g=[{text:h(14621),position:"right",click:this.destroyFormPopup.bind(this)}];"view"!==b&&g.push({id:"form_edit_submit",text:"add"==b?h(222):h(12252),type:"submit",
position:"right",click:this.onSubmitFormPopup.bind(this)});this.formPopup=new d.ui.Popup({title:e,autoOpen:!0,view:this.formView,modal:!0,popup_extra_css_class:"form-popup",onClose:this.destroyFormPopup.bind(this),buttons:g});$('input[name="formName_1"]').focus()},onDisplayConfiguredFormLinks:function(c,b){this.triggerFunction("global.data.get",{controller:"formsconfiguration",method:"getConfiguredLinks",params:{form_id:b.model.attributes._id,plugin:"Plugin"==b.model.constructor.name?1:0},responseHandler:this.afterGetConfiguredLinks.bind(this)})},
onDisplayConfiguredPluginLinks:function(c,b){this.triggerFunction("global.data.get",{controller:"formsconfiguration",method:"getConfiguredLinks",params:{plugin_id:b.model.attributes.alid,plugin:"Plugin"==b.model.constructor.name?1:0},responseHandler:this.afterGetConfiguredLinks.bind(this)})},afterGetConfiguredLinks:function(c,b){b&&b.errorMsg?this.showError(b.errorMsg):this.createConfiguredLinksPopup({layouts:b.layouts,flows:b.flows,item:b.item,mapLayers:b.mapLayers})},closeConfiguredLinksPopup:function(){this.configuredLinksPopup instanceof
d.ui.Popup&&(this.configuredLinksPopup.destroy(),this.configuredLinksPopup=null)},addMapLayersToLayouts:function(c,b){var d=[];$.each(b,function(b,c){d.push({name:h("fp.map_layers"),label:"map_layer_layout",cntype:"0",type:"map_layer",layout_id:"0",context_id:"1",custom_ut_title:h("fp.custom_map_layer"),ut:[{utype_id:1,label:c.label,name:c.name,buttons:[{name:c.button_name,item_id:c.layer_id}]}]})});d.length&&c.push(d)},createConfiguredLinksPopup:function(c){var b=c.item.name;this.configuredLinksView&&
(this.configuredLinksView.removeListener(this.configuredLinksViewListener),this.configuredLinksView.destroy(),this.configuredLinksView=null);this.addMapLayersToLayouts(c.layouts,c.mapLayers);this.configuredLinksView=new d.CompanySettings.Forms.views.ConfiguredLinks({model:c,readOnly:this.userTypesReadOnlyMode});var e=[{id:"closeBtn",text:h(13305),position:"right",click:this.closeConfiguredLinksPopup.bind(this)}];this.configuredLinksPopup&&this.closeConfiguredLinksPopup();this.configuredLinksPopup=
new d.ui.Popup({title:b,autoOpen:!0,view:this.configuredLinksView,modal:!0,autoHeight:!0,popup_extra_css_class:"configure-links",onClose:this.closeConfiguredLinksPopup.bind(this),buttons:e});this.configuredLinksPopup.setMaxHeight("90%");$(".popup-title").append('<div class="info-label"><label>'+h(22604)+"</label><br /><span>"+c.item.label+"</span></div>");this.configuredLinksViewListener=this.configuredLinksView.addListener("viewaction:displayFormLinksCenterPopup",this.onDisplayConfiguredFormLinksCenter,
this)},onDisplayConfiguredFormLinksCenter:function(c,b){void 0!==this.configuredLinksPopup&&this.configuredLinksPopup.setPositionCenter()},lockFormPopup:function(c,b){c=c||!1;if(b=b||$(this.formPopup._dom.buttons.form_edit_submit))this.formPopupOkButton=$(b);this.formPopupOkButton&&(c?this.formPopupOkButton.attr("disabled","disabled").addClass("toa-button-disable").removeClass("toa-button-active"):this.formPopupOkButton.removeAttr("disabled").removeClass("toa-button-disable").addClass("toa-button-active"))},
afterChangeForm:function(){var c=[this.formsListMapper.load(this.formsListCollection)];return $.when.apply($,c).done(function(){this._loadedBlocks.plugins=!0;this.refreshFormList(!0)}.bind(this)).fail(this.onLoadListFail.bind(this))},suspend:function(c){this.destroy()},destroy:function(){this.panel&&(this.panel.destroy(!0),this.panel=null);this.formsListCollection.clear();this.formView&&(this.formView.destroy(),this.formView=null);this.listView.destroy();this.listView=null;this.pluginView.destroy();
this.pluginView=null;this.configuredLinksView&&(this.configuredLinksView.removeListener(this.configuredLinksViewListener),this.configuredLinksView.destroy(),this.configuredLinksView=null);this.screen.empty();this.screen.remove();this.containerView=this.screen=null;this.sandbox.unbind(this._accessModeTrigger,null,this)},setState:function(c,b){d.isString(c)?this.state[c]=b:d.isObject(c)?$.extend(this.state,c):!1===c&&this.setDefaultState()},getState:function(c){return this.state[c]},setDefaultState:function(){this.state=
$.extend(this.state,{allowModify:!1})},showError:function(c,b){c=c||h(3057);b=b||h(5651);return this.showPopup(b,c)},showPopup:function(c,b,e){c=c||"";b=b||"";var g=$.Deferred();e&&$.isArray(e)&&e.length?$.each(e,function(b,c){if("function"===typeof c.click){var d=c.click;c.click=function(){var b=Array.prototype.slice.call(arguments);b.unshift(g);d.apply(this,b)}}}.bind(this)):e=[{text:h(445),position:"right",tpl:'<button class="popup-button toa-button"></button>',click:function(){g.reject()}}];g.always(function(){k.destroy()});
var k=new d.ui.Popup({title:c,autoOpen:!0,html:b,modal:!0,popup_extra_css_class:"form-popup",onClose:function(){k.destroy();g.reject()},buttons:e});k._dom.base.id="toa-formsconfiguration-popup";return g},exportSelectedPlugins:function(c){post({controller:"Formsconfiguration",method:"exportPlugins",actionLinkId:c.length?c:[]})},onPluginsImport:function(c,b){this.importFileUploadPlugins&&this.importFileUploadPlugins.destroy();this.importFileUploadPlugins=new d.CompanySettings.Plugins.views.Import.ImportFileUpload;
this.importFileUploadPlugins.addListener("import.validate",this.onPluginsImportValidate.bind(this));this.importFileUploadPlugins.show()},onPluginsImportValidate:function(c,b){this.importStatusForm&&this.importStatusForm.destroy();this.importStatusForm=new d.CompanySettings.Plugins.views.Import.ImportFileUploadStatus({model:b});this.importStatusForm.addListener("import.start",this.onPluginsImportStart.bind(this));this.importStatusForm.show()},onPluginsImportStart:function(c,b){this.triggerFunction("global.data.get",
{controller:"formsconfiguration",method:"importPlugins",params:{import_id:b.get("import_id",null)},responseHandler:this.afterImportPlugins.bind(this)})},afterImportPlugins:function(c,b){this.importStatusForm.destroy();this.importPluginsResult&&(this.importPluginsResult.destroy(),this.importPluginsResult=null);b.data&&b.data.errorMsg?this.showError(b.data.errorMsg):(this.importPluginsResult=new d.CompanySettings.Plugins.views.Import.ImportResults({model:new d.models.BaseModel(b.data||{})}),this.importPluginsResult.addListener("import.finish",
this.refreshAllListsAfterImportPlugins.bind(this)),this.importPluginsResult.show())}}))})(toa);(function(d){d.ns("toa.views.applications.Layout",d.define(null,function(){this.template=new d.Template(['<div id="toa-applications" class="jet-css-only">','<div class="content"></div>',"</div>"]);this.element=$(this.template.apply());this.content=this.getElement().find(".content")},{getElement:function(){return this.element},getContent:function(){return this.content},enableReadOnlyMode:function(){this.readOnlyMode=!0;this.getElement().addClass("readOnlyMode")},disableReadOnlyMode:function(){this.getElement().removeClass("readOnlyMode");
this.readOnlyMode=!1},destroy:function(){this.getElement().remove()}}))})(toa);(function(d){d.ns("toa.views.applications.ControlPanel",d.define(null,function(){this.template=new d.Template(['<div class="toa-applications-control-panel">','<div role="button" aria-haspopup="true" aria-label="<%=h(13820/*Add*/)%>" class="add" tabindex="0"></div>','<div role="button" aria-haspopup="true" aria-label="<%=h(13071/*Remove*/)%>" class="remove" tabindex="0"></div>',"</div>"]);this.readOnlyMode=!1;this.element=$(this.template.apply());this.initEvent()},$.extend({},d.mixins.EventEmitter,
{getElement:function(){return this.element},initEvent:function(){var c=this.getElement();c.find(".add").on("click",this.onClickAdd.bind(this));c.find(".add").on("keypress",this.onClickAdd.bind(this));c.find(".remove").on("click",this.onClickRemove.bind(this));c.find(".remove").on("keypress",this.onClickRemove.bind(this))},onClickAdd:function(c){"keypress"===c.type&&13!==c.keyCode||!1!=this.readOnlyMode||this.notify("add")},onClickRemove:function(c){"keypress"===c.type&&13!==c.keyCode||!1!=this.readOnlyMode||
this.notify("remove")},enableReadOnlyMode:function(){this.readOnlyMode=!0},disableReadOnlyMode:function(){this.readOnlyMode=!1},destroy:function(){this.getElement().remove()}})))})(toa);(function(d){d.ns("toa.views.applications.popupBase",d.define(null,function(){},$.extend({},d.mixins.EventEmitter,{title:"",label:"",sort:function(c,b){return c.name>b.name?1:c.name<b.name?-1:0},initPopup:function(){this.popup=new d.ui.Popup;this.popup.setTitle(this.title);this.popup.setContent(this.getElement());this.setButtons()},setButtons:function(){this.readOnlyMode?this.popup.setButtons([{text:h(445),type:"right",click:function(){this.close()}.bind(this)}]):this.popup.setButtons([{text:h(11947),
position:"right",click:function(){this.close()}.bind(this)},{text:h(11948),type:"submit",position:"right",click:function(){this.setPermissionModel();this.model.set({permissions:this.permissions});this.notify("save");this.close()}.bind(this)}])},getValues:function(){for(var c={},b=this.getElement().serializeArray(),d=0;d<b.length;d++)c[b[d].name]=b[d].value;return c},getElement:function(){return this.element},getPermistionGroup:function(){var c=[],b=this.permissions;b.id==this.group?c=b.children:b&&
b.children[this.group]&&(c=b.children[this.group].children);return c},setPermissionModel:function(){var c,b;c=this.getValues();list=this.getPermistionGroup(this.group);for(b in list)list[b].access=0,c[list[b].label]&&(list[b].access="on"==c[list[b].label]?1:0)},setPermissionGroupId:function(c){this.group=c},setModel:function(c){this.permissions={};this.model=c;this.permissions=$.extend({},this.model.get("permissions"))},draw:function(){var c,b,d,g,k=["core_api_dailyextract","metadata_api_non_working_reasons",
"metadata_api_resource_type","metadata_api_time_slot"];g=$.map(this.getPermistionGroup(this.group),function(b,c){return[b]});g.sort(this.sort);if(g)for(c in d=this.getElement().find(".list ul").empty(),g)b=this.templateItem.apply({label:g[c].label,name:g[c].name,access:g[c].access,hiddenRW:-1!==$.inArray(g[c].label,k)?!0:!1}),d.append(b)},show:function(){this.draw();this.popup.show()},enableReadOnlyMode:function(){this.readOnlyMode=!0;this.getElement().addClass("readOnlyMode");this.setButtons()},
disableReadOnlyMode:function(){this.readOnlyMode=!1;this.getElement().removeClass("readOnlyMode");this.setButtons()},close:function(){this.popup.hide();this.popup.destroy()},destroy:function(){this.getElement().remove()}})))})(toa);(function(d){var c=d.views.applications.popupBase;d.ns("toa.views.applications.popupMethods",d.define(c,function(){var b=this;this.template=new d.Template('<form name="popupMethods" id="methodListPopup">;<div class="filterableSearch">;<i class="searchIcon"></i>;<input aria-label="<%-h(13745)%>" class="filterableSearchInput" autofocus >;<i class="clearSearchButton hidden"></i>;</div>;<div class="filter">;<span class="icon"></span>;<span class="name"> <%= h(18127) %></span>;<a tabindex="0" class="selectall"><%= h(18128) %></a> - <a tabindex="0" class="clearall"><%= h(18129) %></a></div>;<div class="list">;<ul></ul>;</div>;</form>'.split(";"));
this.templateItem=new d.Template(["<li>",'<label><input type="checkbox" name="<%-label%>" <% if (access) {%> checked="checked" <% } %> /><%-name%></label>',"</li>"]);this.element=$(this.template.apply());this.element.find(".selectall").on("click",this.selectAll.bind(this));this.element.find(".clearall").on("click",this.clearall.bind(this));this.element.find(".selectall").on("keydown",function(c){if(13===c.keyCode||32==c.keyCode)c.stopPropagation(),b.selectAll(),c.preventDefault()});this.element.find(".clearall").on("keydown",
function(c){if(13===c.keyCode||32==c.keyCode)c.stopPropagation(),b.clearall(),c.preventDefault()});this.title=h(21042);this.initPopup();this.element.on("submit",function(b){b.stopPropagation();return!1});this.initEvent()},{label:"methods",filter:"",initEvent:function(){this.getElement().find(".filterableSearchInput").on("input",d.utils.func.debounce(this.onInput.bind(this),100))},enableReadOnlyMode:function(){c.prototype.enableReadOnlyMode.apply(this,arguments);this.getElement().find(".list input").each(function(b,
c){$(c).attr({disabled:"disabled"})})},disableReadOnlyMode:function(){c.prototype.disableReadOnlyMode.apply(this,arguments);this.getElement().find("#methodListPopup .list input").each(function(b,c){$(c).attr({disabled:"disabled"})})},draw:function(){var b,c,d;list=$.map(this.getPermistionGroup(this.group),function(b,c){return[b]});list.sort(this.sort);if(list)for(b in d=this.getElement().find(".list ul").empty(),list)c=$(this.templateItem.apply({label:list[b].label,name:list[b].name,access:list[b].access})),
this.readOnlyMode&&c.find("input").attr({disabled:"disabled"}),d.append(c),""!=this.filter&&-1==list[b].name.toLowerCase().indexOf(this.filter)&&c.hide()},selectAll:function(){this.readOnlyMode||this.getElement().find(".list ul input").each(function(b,c){c.checked=!0})},clearall:function(){this.readOnlyMode||this.getElement().find(".list ul input").each(function(b,c){c.checked=!1})},onInput:function(b){this.filter=b.target.value.toLowerCase();this.draw()}}))})(toa);(function(d){d.ns("toa.views.applications.popupEntity",d.define(d.views.applications.popupBase,function(){this.template=new d.Template(['<form id="entityListPopup" name="popupEntity">','<div class="list">',"<ul></ul>","</div>","</form>"]);this.templateItem=new d.Template('<li>,<select name="<%-label%>" style="min-width: 100px;">,<option <% if (access == 0) {%> selected="selected"  <% } %> value="0"><%=h(21018 /* Hidden */)%></option>,<option <% if (access == 1) {%> selected="selected"  <% } %> value="1"><%=h(21019 /* ReadOnly */)%></option>,<% if (hiddenRW == false) {%><option  <% if (access == 2) {%> selected="selected"  <% } %> value="2"><%=h(21020 /* ReadWrite */)%></option><% } %>,</select>,<label><%-name%></label>,</li>'.split(","));
this.element=$(this.template.apply());this.title=h(21041);this.initPopup();this.element.on("submit",function(c){c.stopPropagation();return!1})},{label:"entity",enableReadOnlyMode:function(){this.readOnlyMode=!0;this.getElement().addClass("readOnlyMode");this.getElement().find("select").each(function(c,b){$(b).attr({disabled:"disabled"})});this.setButtons()},disableReadOnlyMode:function(){this.readOnlyMode=!1;this.getElement().removeClass("readOnlyMode");this.getElement().find("#entityListPopup select").each(function(c,
b){$(b).attr({disabled:"disabled"})});this.setButtons()},setPermissionModel:function(){var c,b;c=this.getValues();list=this.getPermistionGroup(this.group);for(b in list)list[b].access=0,c[list[b].label]&&(list[b].access=c[list[b].label])}}))})(toa);(function(d){var c=d.views.applications.popupBase;d.ns("toa.views.applications.popupAccessList",d.define(c,function(){this.template=new d.Template('<form name="popupMethods">;<div id="methodListPopup">;<div class="filterableSearch">;<i class="searchIcon"></i>;<input aria-label="<%-h(13745)%>" class="filterableSearchInput" autofocus />;<i class="clearSearchButton hidden"></i>;</div>;<div class="list">;<ul></ul>;</div>;</div>;</form>'.split(";"));this.templateItem=new d.Template(["<li>",'<label><input type="checkbox" name="<%-label%>" <% if (access) {%> checked="checked" <% } %> /><%-name%></label>',
"</li>"]);this.element=$(this.template.apply());this.title=h(21040);this.initPopup();this.element.on("submit",function(b){b.stopPropagation();return!1});this.initEvent()},{label:"access_list",filter:"",initEvent:function(){this.getElement().find(".filterableSearchInput").on("input",d.utils.func.debounce(this.onInput.bind(this),100))},getPermistionGroup:function(){var b,d=$.extend({},c.prototype.getPermistionGroup.apply(this,arguments));for(b in this.model.hiddenApiIds)this.model.hiddenApiIds.hasOwnProperty(b)&&
delete d[this.model.hiddenApiIds[b]];if(""==this.filter)return d;for(b in d)-1==d[b].name.toLowerCase().indexOf(this.filter)&&delete d[b];return d},setPermissionModel:function(){var b,c,d,k;b=this.getValues();list=this.getPermistionGroup(this.group);this.permissions.access=0;for(c in list)if(list[c].access=0,b[list[c].label]&&(this.permissions.access=1,list[c].access="on"==b[list[c].label]?1:0),"api_parts_catalog"==list[c].label||"outbound"==list[c].label)for(d in k=list[c].children,k)k[d].access=
"on"==b[list[c].label]?1:0},onInput:function(b){this.filter=b.target.value.toLowerCase();this.draw()}}))})(toa);(function(d){d.ns("toa.views.applications.popupJwtExample",d.define(null,function(){this.template=new d.Template('<div id="jwtExample">,<h1>Header: algogithm &amp; Token type</h1>,<div class="jwt_head"></div>,<h1>Payload: data</h1>,<div class="jwt_data"></div>,</div>'.split(","));this.element=$(this.template.apply());this.title=h(21039)},$.extend({},d.mixins.EventEmitter,{initPopup:function(){this.popup=new d.ui.Popup;this.popup.setContent(this.getElement())},getElement:function(){return this.element},
show:function(c,b,d){this.element=$(this.template.apply());this.initPopup();this.popup.setTitle(c);this.getElement().find(".jwt_head").append(JSON.stringify(b,!1,"<b/>").replace(/\n/g,"<br />"));this.getElement().find(".jwt_data").append(JSON.stringify(d,!1,"<b/>").replace(/\n/g,"<br />"));this.popup.show()},close:function(){this.popup.hide();this.popup.destroy()},destroy:function(){this.popup&&this.popup.destroy();this.getElement().remove()}})))})(toa);(function(d){d.ns("toa.views.applications.hint",d.define(null,function(){this.template=new d.Template('<div id="toa-application-hint" class="jsHide" tabindex="0">;<div role="button" tabindex="0" class="link availableFileUploadActivityFields" data-action="fileupload_set_activity"><%-h(21026)%></div>;<div role="button" tabindex="0" class="link availableFileUploadInventoryFields" data-action="fileupload_set_inventory"><%-h(21027)%></div>;<div role="button" tabindex="0" class="link availableFileUploadResourceFields" data-action="fileupload_provider_info"><%-h(21028)%></div>;<div role="button" tabindex="0" class="link availableSoapActivityFields" data-action="soap_set_activity"><%-h(21029)%></div>;<div role="button" tabindex="0" class="link availableSoapInventoryFields" data-action="soap_set_inventory"><%-h(21030)%></div>;<div role="button" tabindex="0" class="link availableSoapRequestFields" data-action="soap_send_request"><%-h(21031)%></div>;<div role="button" tabindex="0" class="link availableSoapProviderFields" data-action="soap_set_provider"><%-h(21032)%></div>;<div role="button" tabindex="0" class="link availableSoapUserFields" data-action="soap_set_user"><%-h(21033)%></div>;<div role="button" tabindex="0" class="link availableMethods" data-action="available_methods"><%-h(21034)%></div>;<div role="button" tabindex="0" class="link availableEntity" data-action="available_entity"><%-h(21035)%></div>;<div role="button" tabindex="0" class="link removeAccess" data-action="remove"><%-h(21036)%></div>;</div>'.split(";"));
this.element=$(this.template.apply());this.fliper=new d.Fliper({getRectAnchor:this._getRectAnchor.bind(this),getRectElement:this._getRectElement.bind(this),mapPosition:this.mapPosition});$(_DATA.dispatcher_container).append(this.element);$(_DATA.dispatcher_container).on("click",function(c){$(c.target).hasClass("actions")||this.hide()}.bind(this));this.initEvent()},$.extend({},d.mixins.EventEmitter,{mapPosition:[["right","top"],["right","bottom"],["right","center"],["right","auto"],["left","top"],
["left","bottom"],["left","center"],["left","auto"]],getElement:function(){return this.element},initEvent:function(){this.getElement().on("click",".link",this.onClickAction.bind(this));this.getElement().on("keypress",".link",this.onClickAction.bind(this))},_getRectAnchor:function(){var c={},b=window._DATA&&_DATA.is_mobility_app?40:0;this.anchor&&(c={width:this.anchor.outerWidth(),height:this.anchor.outerHeight(),top:this.anchor.offset().top-b,left:this.anchor.offset().left});return c},_getRectElement:function(){var c=
{};this.element&&(c={width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.offset().top,left:this.element.offset().left});return c},show:function(){this.getElement().removeClass("jsHide");this.element.css(this.fliper.getOptimalPosition().point)},hide:function(){this.getElement().addClass("jsHide")},addClass:function(c){this.getElement().addClass(c)},removeClass:function(c){this.getElement().removeClass(c)},setAnchor:function(c){this.anchor=$(c)},setPermissionId:function(c){this.permissionId=
c},onClickAction:function(c){if("keypress"!==c.type||13===c.keyCode)c=$(c.target),this.notify("actionClick",[c.data("action"),this.permissionId])},enableReadOnlyMode:function(){this.readOnlyMode=!0;this.getElement().addClass("readOnlyMode")},disableReadOnlyMode:function(){this.readOnlyMode=!1;this.getElement().removeClass("readOnlyMode")},showActionLink:function(c){this.getElement().find(".link."+c).addClass("showLink")},hideActionLink:function(c){this.getElement().find(".link."+c).addClass("hideLink")},
resetActionLinksDisplay:function(){this.getElement().find(".link").removeClass("hideLink");this.getElement().find(".link").removeClass("showLink")},destroy:function(){this.getElement().remove()}})))})(toa);(function(d){d.ns("toa.views.applications.Application",d.define(null,function(c){this.template=(new d.Template(['<div data-item=<%-id%> class="item" role="button" tabindex="0">','<div class="application_name"><%-name%></div>','<div class="application_id"><%-app_id%></div>',"</div>"])).compile();this.model=c;this.initEvent()},$.extend({},d.mixins.EventEmitter,{initEvent:function(){this.model.addListener("change",this.onChange.bind(this))},getModel:function(){return this.model},selected:function(){this.element.addClass("selected")},
unselected:function(){this.element.removeClass("selected")},onChange:function(){this.draw()},draw:function(){this.element.attr("data-item",this.model.getId());this.element.find(".misconfigured").remove();!1==this.model.checkConfigured()&&this.element.append('<div class="misconfigured">'+h(21157)+"</div>")},renderTo:function(c){this.element=$(this.template.apply({id:this.model.getId(),app_id:this.model.get("client_id"),name:this.model.get("name")}));c.append(this.element);this.draw()},destroy:function(){this.getElement().remove()}})))})(toa);(function(d){d.ns("toa.views.applications.Applications",d.define(null,function(){this.template=new d.Template(['<div class="toa-applications"></div>']);this.views={};this.element=$(this.template.apply());this.selected=null;this.initEvents()},$.extend({},d.mixins.EventEmitter,{getElement:function(){return this.element},render:function(c){this.getElement().empty();0==c.getCount()&&this.getElement().append(h(21155));this.selected=null;this.collection=c;this.collection.each(function(b){this.renderApplication(b)}.bind(this));
this.checkCollaborationOpened()},renderApplication:function(c){var b=new d.views.applications.Application(c);this.views[c.getId()]=b;b.renderTo(this.getElement());this.selected||(this.selectApplication(c),this.notify("changeApplication",c))},getSelectApplication:function(){return this.selected},selectApplication:function(c){var b=this.views[c.getId()];if(this.selected){if(this.selected.getModel().getId()==c.getId())return;this.selected.unselected()}b.selected();this.selected=b},initEvents:function(){this.getElement().on("click",
".item",this.onClickApplication.bind(this));this.getElement().on("keypress",".item",this.onClickApplication.bind(this))},onClickApplication:function(c){if("keypress"!==c.type||13===c.keyCode)c=$(c.currentTarget).data("item"),c=this.collection.get(c)||this.collection.getByUid(c),this.notify("changeApplication",c)},checkCollaborationOpened:function(){var c=document.getElementById("content-manage-container");this.observer=new MutationObserver(this.checkContainerWidth.bind(this));this.observer.observe(c,
{attributes:!0})},checkContainerWidth:function(c){if("attributes"===c[0].type){var b=$("#manage-content");app.ui.collaborationScreenResizeHelper.adjustOutboundContainerWidth(b,c)}},destroy:function(){this.getElement().remove();this.observer.disconnect()}})))})(toa);(function(d){d.ns("toa.views.applications.sectionAccess",d.define(null,function(){this.template=new d.Template('<div class="sectionForm accessapi">;<h2 class="apiHead">;<span><%-h(21037)%></span>;<div role="button" class="rightPanel changeApi" tabindex="0">;<span class="add"></span>;<span class="addName"><%-h(21012)%></span>;</div>;</h2>;<div class="apilist"></div>;</div>'.split(";"));this.templateApi=new d.Template(['<div class="api_type <%-label%> toa-formrow">','<div class="actions" aria-haspopup="true" tabindex="0" role="button" aria-label="<%-name%>" data-id="<%-id%>" data-label="<%-label%>"  data-actionslist="<%-actionslist%>"></div>',
'<div class="name"><b><%-name%></b><div class="formError"><%-error%></div></div>','<div class="description">',"<% if (description.allowMethod) { %>",'<div class="descAria">','<input class="showHodeMore" name="<%-label%>" id="<%-label%>" type="checkbox" />','<div class="methodList"><div class="descContent">',"<b></b><%=description.allowMethod%>","</div></div>",'<label for="<%-label%>" class="more">',d.glossary({id:12247}).replace("{COUNT}","<span></span>"),"</label>",'<label for="<%-label%>" class="hide"><span><%-h(21045)%></span></label>',
"</div>","<% } %>","<% if (description.allowEntity) { %>",'<div class="descAria">','<input class="showHodeMore" name="<%-label%>" id="<%-label%>" type="checkbox" />','<div class="methodList"><div class="descContent">',"<b></b><%=description.allowEntity%>","</div></div>",'<label for="<%-label%>" class="more">',d.glossary({id:12247}).replace("{COUNT}","<span></span>"),"</label>",'<label for="<%-label%>" class="hide"><span><%-h(21045)%></span></label>',"<% } %>","</div>","</div>"]);this.element=$(this.template.apply());
this.apilist=this.element.find(".apilist");this.initEvent()},{getElement:function(){return this.element},setModel:function(c){this.model=c;this.modelChangeUID=this.model.addListener("change.permissions",this.onChange.bind(this))},getModel:function(){return this.model},getOriginData:function(){return this.originData},initEvent:function(){this.getElement().on("click",".apilist .actions",this.onClickAction.bind(this));this.getElement().on("keypress",".apilist .actions",this.onClickAction.bind(this));
this.getElement().on("keydown",".apilist .actions",this.onEnterPress.bind(this));this.getElement().on("click",".changeApi",this.onClickAddNewApiAccess.bind(this));this.getElement().on("keypress",".changeApi",this.onClickAddNewApiAccess.bind(this));this.resizeEventId=d.app.reflowManager.addListener("resize",this.recalcMoreButtons.bind(this))},initUploadCertificate:function(){var c;c=this.element.find(".importCertificate");this.certificate=new d.view.uploadFile(c);this.certificate.render("certificate");
c.find(".url").hide();c=c.find(".toa-button");c.empty().append(h(21017));c.addClass("toa-button-active")},recalcMoreButtons:function(){this.getElement().find(".description .descAria").each(function(c,b){for(var d=$(b).find(".methodList"),g=d.find("i"),k=d.find("b"),l=0,n=0;n<g.length;n++)$(g[n]).removeClass("resetCounter"),(1==Math.round($(g[n]).innerWidth()/d.outerWidth())||0==n&&k.offset().top!=$(g[0]).offset().top)&&l++,2>l&&$(g[n]).addClass("resetCounter");1<l?$(b).find("input").removeAttr("disabled"):
$(b).find("input").attr("disabled","disabled")})},draw:function(){this.renderPermissions(this.model.get("permissions"));this.recalcMoreButtons()},onChange:function(c){this.draw()},onEnterPress:function(c){13===c.keyCode&&(c.preventDefault(),$(c.target).click())},onClickAction:function(c){if("keypress"!==c.type||13===c.keyCode){var b=this.getHint(),d=$(c.target).data("actionslist");b.resetActionLinksDisplay();0<=d.indexOf("allowEntity")&&b.showActionLink("availableEntity");b.setAnchor(c.target);b.setPermissionId($(c.target).data("id"));
this.currentHintName&&b.removeClass(this.currentHintName);this.currentHintName=$(c.target).data("label");b.addClass(this.currentHintName);b.show()}},onClickAddNewApiAccess:function(c){"keypress"===c.type&&13!==c.keyCode||this.readOnlyMode||(c=new d.views.applications.popupAccessList,c.setModel(this.model),c.setPermissionGroupId(this.model.get("permissions").id),c.addListener("save",this.onSaveAccessList.bind(this)),c.show())},renderPermissions:function(c){var b,d=[],g,k="",l=this.model.hiddenApiIds;
this.apilist.empty();if(c&&c.children){c=c.children;$.each(c,function(b,c){0<c.access&&0>$.inArray(parseInt(b),l)&&d.push(c)});d.sort(function(b,c){return b.name.localeCompare(c.name)});for(c=0;c<d.length;c++)k="",g=this.getPermissionInfo(d[c]),b=this.model.checkConfiguredApi(d[c]),!1==b.status&&(k=b.msg),b=$(this.templateApi.apply({id:d[c].id,name:d[c].name,label:d[c].label,description:g.description,actionslist:Object.keys(g.description).join(","),error:k})),this.apilist.append(b),k=b.find(".methodList"),
g=b.find(".descContent"),b=b.find(".more"),g.innerHeight()>k.innerHeight()&&b.removeClass("toa-hidden");d.length||this.apilist.append('<div class="misconfigured">'+h(21157)+"</div>")}},enableReadOnlyMode:function(){this.readOnlyMode=!0;this.getHint().enableReadOnlyMode()},disableReadOnlyMode:function(){this.readOnlyMode=!1;this.getHint().disableReadOnlyMode()},getPermissionInfo:function(c){var b={},d={};this.model.get("layouts",[]);var g=function(b,c){return b>c?1:b<c?-1:0},d=function(b){var c=[],
d={0:h(21018),1:h(21019),2:h(21020)},e;for(e in b)0<b[e].access&&c.push(b[e].name+": "+d[b[e].access]);return c.sort(g)},k=function(b){var c=[],d;for(d in b)0<b[d].access&&c.push(b[d].name);return c.sort(g)};switch(c.label){case "mobile_client":c=k(c.children);d={allowMethod:"<i>"+c.join(",&nbsp</i><i>")+"</i>"};break;case "capacity_api":c=k(c.children);d={allowMethod:"<i>"+c.join(",&nbsp</i><i>")+"</i>"};break;case "core_api":c=d(c.children);d={allowEntity:"<i>"+c.join(",&nbsp</i><i>")+"</i>"};break;
case "metadata_api":c=d(c.children);d={allowEntity:"<i>"+c.join(",&nbsp</i><i>")+"</i>"};break;case "resource_management":c=k(c.children);d={allowMethod:"<i>"+c.join(",&nbsp</i><i>")+"</i>"};break;case "outbound":case "api_parts_catalog":d={allowMethod:"<i>"+h(1458)+"</i>"};break;default:c.hasOwnProperty("children")&&0<Object.keys(c.children).length?(c=d(c.children),d={allowEntity:"<i>"+c.join(",&nbsp</i><i>")+"</i>"}):d={allowMethod:"<i>"+h(1458)+"</i>"}}b.description=d;return b},getHint:function(){this.hint||
(this.hint=new d.views.applications.hint,this.onLoadApplicationUID=this.hint.addListener("actionClick",this.onActionClick.bind(this)));return this.hint},onActionClick:function(c,b){var e;switch(b[0]){case "available_methods":var g=new d.views.applications.popupMethods;g.setModel(this.model);g.setPermissionGroupId(b[1]);g.disableReadOnlyMode();g.show();this.readOnlyMode&&g.enableReadOnlyMode();break;case "available_entity":g=new d.views.applications.popupEntity;g.setModel(this.model);g.setPermissionGroupId(b[1]);
g.disableReadOnlyMode();g.show();this.readOnlyMode&&g.enableReadOnlyMode();break;case "remove":this.removeAccessApi(b[1]);break;default:var k=$.Deferred();if(this.model.isModify){if(""===$("#application_form_name_label").val())return new d.ui.Popup({title:h(5651),html:h(20198),autoOpen:!0,buttons:[{text:h(445),position:"right",tpl:'<button class="popup-button toa-button"></button>',click:function(){k.resolve();this.destroy()}}]});g=new d.ui.Popup({title:h(13294),html:h(15046),autoOpen:!0,buttons:[{text:h(6266),
click:function(){this.destroy()}},{text:h(11947),click:function(){k.resolve();this.destroy()}},{text:h(21013),type:"submit",click:function(){this.saveApplication().done(function(){k.resolve()}.bind(this));g.destroy()}.bind(this)}]})}else k.resolve();k.promise().done(function(){this.getContextLayoutId(b[0]).then(function(b){e=$.param({id:b,cmd:"company_settings",sub:"api",action:"layout_structure",output:"ajax"});request({url:"?"+e})})}.bind(this))}},onSaveAccessList:function(c,b){this.renderPermissions(this.model.get("permissions"));
this.recalcMoreButtons()},removeAccessApi:function(c){var b,d;permissions=$.extend({},this.model.get("permissions"));d=permissions.children;d[c]&&(d[c].access=0);permissions.access=0;for(b in d)if(1==d[b].access){permissions.access=1;break}this.model.set({permissions:permissions});this.renderPermissions(permissions);this.recalcMoreButtons()},getContextLayoutId:function(c){var b=$.Deferred(),e=b.promise(),g=this.model.get("layouts");g&&g[c]?b.resolve(g[c]):this.readOnlyMode?(d.ui.Alert({text:h(5516)}),
b.reject()):d.app.trigger("global.data.get",{controller:"applications",method:"createContextLayout",params:{display_profile_id:this.model.get("display_profile_id"),contextLabel:c},responseHandler:function(c,d){b.resolve(d.context_layout_id)}.bind(this),errorHandler:function(){b.reject()}.bind(this)});return e},setApplication:function(c){this.isUpdate=!1;c.app_id&&(this.isUpdate=!0);this.setValues(c)},saveApplication:function(){return this.model.save()},destroy:function(){this.getElement().remove();
this.getHint().destroy()}}))})(toa);(function(d){d.ns("toa.views.applications.sectionAuthentications",d.define(null,function(){this.template=new d.Template('<div class="sectionForm authentications">,<h2 class="apiHead auth_settings"><%-h(15085)%></h2>,<div class="allowCheckbox">,<input aria-labelledby="label_for_allowClientSecret" aria-describedby="clientSecretContent_formNote" type="checkbox" name="allowClientSecret"/>,<label id="label_for_allowClientSecret"><%-h(21173)%></label>,</div>,<div class="clientSecretContent">,<div class="formNote" id="clientSecretContent_formNote"><%-h(21006)%></div>,<div class="toa-formrow clientId toa-hidden">,<div class="formLabel"><%-h(21003)%></div>,<div class="formField">&nbsp;</div>,</div>,<div class="toa-formrow clientSecret toa-hidden">,<div class="formLabel"><b><%-h(21005)%></b></div>,<button class="toa-button renew_secret toa-hidden buttonToLink"><%-h(21050)%></button>,<div class="formField"></div>,</div>,<div class="toa-formrow">,<button class="toa-button show_secret buttonToLink"><%-h(21004)%></button>,<button class="toa-button hide_secret buttonToLink toa-hidden"><%-h(21008)%></button>,</div>,</div>,<div class="allowCheckbox cert">,<input aria-labelledby="label_for_allow_certificate" type="checkbox" name="allow_certificate" id="allow_certificate"/>,<label id="label_for_allow_certificate"><%-h(21049)%></label>,</div>,<div class="toa-formrow uploadCertificate">,<div class="formNote internal" id="<%-allow_certificate_internal_id%>"><%-h(21176)%></div>,<div class="formNote external certificate" id="<%-allow_certificate_external_id%>"><%-h(21177)%></div>,<div class="formLabel internal" id="<%-internal_label_id%>"><%-h(15087)%></div>,<div class="formLabel external">,<abbr  id="<%-req_id%>" class="ofsc-abbr-mandatory" title="<%-h(22351)%>">*</abbr>,<label id="<%-external_label_id%>"><%-h(21163)%>,</div>,<div class="certificateInfo">,<div class="certificate_issued"></div>,<div class="certificate_expires"></div>,</div>,<div class="formField importCertificate"></div>,<div class="formError"></div>,<div class="formNote internal" id="<%-internal_desc_id%>"><%-h(21002)%></div>,<div class="formNote external" id="<%-external_desc_id%>"><%-h(21152)%></div>,<button class="toa-button buttonToLink required_token"></button>,</div>,</div>'.split(","));
var c=generate_id(),b={internal_label_id:"internal_"+c,req_id:"req_"+c,external_label_id:"external_"+c,internal_desc_id:"internal_desc_"+c,external_desc_id:"external_desc_"+c,allow_certificate_internal_id:"allow_certificate_internal_desc_"+c,allow_certificate_external_id:"allow_certificate_external_desc_"+c};this.element=$(this.template.apply(b));this.element.options=b;this.clientId=this.element.find(".clientId .formField");this.allowClientSecret=this.element.find("input[name='allowClientSecret']");
this.clientSecret=this.element.find(".clientSecret .formField");this.certificateSection=this.getElement().find(".uploadCertificate");this.allowCertificate=this.element.find("input[name='allow_certificate']");this.initUploadCertificate(c);this.initEvent()},{getElement:function(){return this.element},setModel:function(c){this.model=c;this.modelChangeUID=this.model.addListener("change",this.onChange.bind(this));this.modelResetUID=this.model.addListener("reset",this.onChange.bind(this));this.modelBeforeSaveUID=
this.model.addListener("beforeSave",this.onBeforeSave.bind(this));this.modelErrorMessage=this.model.addListener("errorMessage",this.onError.bind(this))},initEvent:function(){this.element.find(".show_secret").on("click",this.onClickShowSecret.bind(this));this.element.find(".hide_secret").on("click",this.onClickHideSecret.bind(this));this.element.find(".renew_secret").on("click",this.onClickRenewSecret.bind(this));this.allowClientSecret.on("change",function(c){this.model.set({client_secret_exist:c.target.checked},
{silent:!0});c.target.checked?(this.getElement().find(".clientSecretContent").show(),this.onClickShowSecret()):this.getElement().find(".clientSecretContent").hide()}.bind(this));this.certificate.addListener("change",function(){this.getElement().find(".formError").empty();524288>=this.certificate.getFileSize()?"ofsc"==this.model.get("token_service")?this.model.set({assertion_cert:this.certificate.getFile().split(",")[1]}):this.model.set({access_token_cert:this.certificate.getFile().split(",")[1]}):
this.getElement().find(".formError").append(h(21161))}.bind(this));this.allowCertificate.on("change",function(c){this.model.set({client_certificate_exist:c.target.checked},{silent:!0,silentModify:!0});c.target.checked?this.certificateSection.show():this.certificateSection.hide()}.bind(this));this.getElement().find(" .required_token").on("click",function(){var c;c="ofsc"==this.model.get("token_service")?this.model.get("assertion_info"):this.model.get("access_token_info");var b=new d.views.applications.popupJwtExample;
c={sub:"&lt;your user&gt;",iss:c.name,aud:["ofsc",c.instance,this.model.get("client_id")].join(":"),scope:"/REST",exp:"&lt;expiration timestamp&gt;"};b.show(h(21156),{alg:"RS256"},c)}.bind(this))},initUploadCertificate:function(){var c;c=this.element.find(".importCertificate");this.certificate=new d.view.uploadFile(c);this.certificate.render("certificate");c.find(".url").hide()},draw:function(){switch(this.model.get("token_service")){case "ofsc":this.drawOfsc();break;case "external":this.drawExternal();
break;case "idcs":this.drawIdcs();break;default:this.drawOfsc()}},drawOfsc:function(){this.clientId.empty().append(this.model.get("client_id"));this.clientSecret.empty();this.element.find(".clientSecret .show_secret").removeClass("toa-hidden");this.element.find(".clientSecret .hide_secret").addClass("toa-hidden");this.element.find(".clientSecret .renew_secret").addClass("toa-hidden");this.getElement().find(".allowCheckbox").show();this.model.get("client_secret_exist")?(this.allowClientSecret.prop("checked",
!0),this.model.set({client_secret_exist:!0},{silent:!0}),this.getElement().find(".clientSecretContent").show()):(this.allowClientSecret.prop("checked",!1),this.model.set({client_secret_exist:!1},{silent:!0}),this.getElement().find(".clientSecretContent").hide());this.getElement().find(".formError").empty();this.certificateSection.addClass("certificate");this.certificateSection.removeClass("certificateExternal");this.getElement().find(".cert label").empty().append(h(21049));this.getElement().find("#"+
this.element.options.allow_certificate_external_id).hide();this.getElement().find(".cert input").attr("aria-describedby",this.element.options.allow_certificate_internal_id);this.getElement().find(".toa-uploadFile button").attr("aria-describedby",this.element.options.allow_certificate_external_id);this.certificate.fileForm.attr({required:!1,"aria-describedby":this.element.options.internal_desc_id,"aria-labelledby":this.element.options.internal_label_id});this.certificate.urlField.attr("aria-labelledby",
this.element.options.internal_label_id);if(!1!=this.model.get("assertion_info",!1)){var c=this.model.get("assertion_info",!1);this.getElement().find(".certificate_issued").empty().append("<b>"+h(21180)+"</b>"+c.issued);this.getElement().find(".certificate_expires").empty().append("<b>"+h(21181)+"</b>"+c.expires);this.getElement().find(".required_token").empty().append(h(21154));this.getElement().find(".required_token").show()}else this.getElement().find(".certificate_issued").empty(),this.getElement().find(".certificate_expires").empty(),
this.getElement().find(".required_token").hide();var c=this.element.find(".importCertificate"),b=c.find(".toa-button");""!=this.model.get("assertion_cert")?(this.allowCertificate.prop("checked",!0),this.model.set({client_certificate_exist:!0},{silent:!0}),this.certificateSection.show(),c.addClass("replaceCertificate"),b.empty().append(h(21174))):(this.allowCertificate.prop("checked",!1),this.model.set({client_certificate_exist:!1},{silent:!0}),this.certificateSection.hide(),c.removeClass("replaceCertificate"),
b.empty().append(h(21017)));b.addClass("toa-button-active");this.element.find(" .show_secret").removeClass("toa-hidden");this.element.find(" .hide_secret").addClass("toa-hidden");this.element.find(" .renew_secret").addClass("toa-hidden");this.element.find(".clientId").addClass("toa-hidden");this.element.find(".clientSecret").addClass("toa-hidden")},drawExternal:function(){this.clientId.empty().append(this.model.get("client_id"));this.clientSecret.empty();this.element.find(".clientSecret .show_secret").removeClass("toa-hidden");
this.element.find(".clientSecret .hide_secret").addClass("toa-hidden");this.element.find(".clientSecret .renew_secret").addClass("toa-hidden");this.getElement().find(".allowCheckbox").show();this.model.get("client_secret_exist")?(this.allowClientSecret.prop("checked",!0),this.getElement().find(".clientSecretContent").show()):(this.allowClientSecret.prop("checked",!1),this.getElement().find(".clientSecretContent").hide());this.getElement().find(".formError").empty();this.certificateSection.removeClass("certificate");
this.certificateSection.addClass("certificateExternal");this.getElement().find(".cert label").empty().append(h(21151));this.getElement().find("#"+this.element.options.allow_certificate_external_id).empty().append(h(21177)).show();this.getElement().find(".uploadCertificate .formLabel.external label").empty().append(h(21163));this.getElement().find(".cert input").attr("aria-describedby",this.element.options.allow_certificate_external_id);this.getElement().find(".toa-uploadFile button").attr("aria-describedby",
this.element.options.allow_certificate_external_id);this.certificate.fileForm.attr({required:"","aria-describedby":this.element.options.external_desc_id,"aria-labelledby":this.element.options.req_id+" "+this.element.options.external_label_id});this.certificate.urlField.attr("aria-labelledby",this.element.options.external_label_id);if(!1!=this.model.get("access_token_info",!1)){var c=this.model.get("access_token_info",!1);this.getElement().find(".certificate_issued").empty().append("<b>"+h(21180)+
"</b>"+c.issued);this.getElement().find(".certificate_expires").empty().append("<b>"+h(21181)+"</b>"+c.expires);this.getElement().find(".required_token").empty().append(h(21179));this.getElement().find(".required_token").show()}else this.getElement().find(".certificate_issued").empty(),this.getElement().find(".certificate_expires").empty(),this.getElement().find(".required_token").hide();var c=this.element.find(".importCertificate"),b=c.find(".toa-button");""!=this.model.get("access_token_cert")?
(this.allowCertificate.prop("checked",!0),this.model.set({client_certificate_exist:!0},{silent:!0}),this.certificateSection.show(),c.addClass("replaceCertificate"),b.empty().append(h(21174))):(this.allowCertificate.prop("checked",!1),this.model.set({client_certificate_exist:!1},{silent:!0}),this.certificateSection.hide(),c.removeClass("replaceCertificate"),b.empty().append(h(21017)));b.addClass("toa-button-active");this.element.find(" .show_secret").removeClass("toa-hidden");this.element.find(" .hide_secret").addClass("toa-hidden");
this.element.find(" .renew_secret").addClass("toa-hidden");this.element.find(".clientId").addClass("toa-hidden");this.element.find(".clientSecret").addClass("toa-hidden")},drawIdcs:function(){this.getElement().find(".allowCheckbox").hide();this.getElement().find(".clientSecretContent").hide();this.allowClientSecret.prop("checked",!1);this.allowCertificate.prop("checked",!0);this.model.set({client_certificate_exist:!0,client_secret_exist:!1},{silent:!0});this.getElement().find("#"+this.element.options.allow_certificate_external_id).empty().append(h(23453)).show();
this.getElement().find(".uploadCertificate .formLabel.external label").empty().append(h(23452));this.certificateSection.removeClass("certificate");this.certificateSection.addClass("certificateExternal");this.getElement().find(".toa-uploadFile button").attr("aria-describedby",this.element.options.allow_certificate_external_id);this.certificate.fileForm.attr({required:"","aria-describedby":this.element.options.external_desc_id,"aria-labelledby":this.element.options.req_id+" "+this.element.options.external_label_id});
this.certificate.urlField.attr("aria-labelledby",this.element.options.external_label_id);this.certificateSection.show();if(!1!=this.model.get("access_token_info",!1)){var c=this.model.get("access_token_info",!1);this.getElement().find(".certificate_issued").empty().append("<b>"+h(21180)+"</b>"+c.issued);this.getElement().find(".certificate_expires").empty().append("<b>"+h(21181)+"</b>"+c.expires);this.getElement().find(".required_token").empty().append(h(21179));this.getElement().find(".required_token").show()}else this.getElement().find(".certificate_issued").empty(),
this.getElement().find(".certificate_expires").empty(),this.getElement().find(".required_token").hide();var c=this.element.find(".importCertificate"),b=c.find(".toa-button");""!==this.model.get("access_token_cert")?(c.addClass("replaceCertificate"),b.empty().append(h(21174))):(c.removeClass("replaceCertificate"),b.empty().append(h(21017)));b.addClass("toa-button-active")},enableReadOnlyMode:function(){this.readOnlyMode=!0;this.allowClientSecret.attr({disabled:"disabled"});this.allowCertificate.attr({disabled:"disabled"});
this.element.find(" .renew_secret").attr({disabled:"disabled"});this.element.find(".importCertificate").find(".toa-button").attr({disabled:"disabled"})},disableReadOnlyMode:function(){this.readOnlyMode=!1;this.allowClientSecret.removeAttr("disabled");this.allowCertificate.removeAttr("disabled");this.element.find(" .renew_secret").removeAttr("disabled");this.element.find(".importCertificate").find(".toa-button").removeAttr("disabled")},onChange:function(c){this.draw()},onBeforeSave:function(c){c={};
this.allowCertificate.prop("checked")?"ofsc"==this.model.get("token_service")?c.access_token_cert="":c.assertion_cert="":(c.assertion_cert="",c.access_token_cert="");c.client_secret_exist=this.allowClientSecret.prop("checked");var b=this.element.find("[type=file]");b&&b.val()&&b.val("");this.model.set(c,{silent:!0})},onClickShowSecret:function(c){d.app.trigger("global.data.get",{controller:"applications",method:"getClientSecret",params:{form:d.utils.json.encode(this.model.toJSON())},responseHandler:function(b,
c){this.clientSecret.empty().append(c.client_secret);this.element.find(".show_secret").addClass("toa-hidden");this.element.find(".hide_secret").removeClass("toa-hidden");this.element.find(".renew_secret").removeClass("toa-hidden");this.element.find(".clientId").removeClass("toa-hidden");this.element.find(".clientSecret").removeClass("toa-hidden")}.bind(this)})},onClickHideSecret:function(c){this.clientSecret.empty();this.element.find(" .show_secret").removeClass("toa-hidden");this.element.find(" .hide_secret").addClass("toa-hidden");
this.element.find(" .renew_secret").addClass("toa-hidden");this.element.find(".clientId").addClass("toa-hidden");this.element.find(".clientSecret").addClass("toa-hidden")},onClickRenewSecret:function(c){var b=new d.ui.Popup({title:h(13294),html:"<h1>"+h(23454)+"</h1>",autoOpen:!0,buttons:[{text:h(6266),click:function(){this.destroy()}},{text:h(445),click:function(){d.app.trigger("global.data.get",{controller:"applications",method:"createClientSecret",params:{form:d.utils.json.encode(this.model.toJSON())},
responseHandler:function(c,d){this.clientSecret.empty().append(d.client_secret);b.destroy()}.bind(this)})}.bind(this)}]})},onError:function(c,b){b.certificate&&(this.allowCertificate.prop("checked",!0),this.certificateSection.show(),this.getElement().find(".formError").empty().append(h(b.certificate)))},destroy:function(){void 0!==this.model&&(this.model.removeListener(this.modelChangeUID),this.model.removeListener(this.modelResetUID),this.model.removeListener(this.modelBeforeSaveUID),this.model.removeListener(this.modelErrorMessage));
this.getElement().remove()}}))})(toa);(function(d){d.ns("toa.views.applications.sectionAuthorization",d.define(null,function(){this.template=new d.Template('<div class="sectionForm authorization_settings">;<h2 class="apiHead"><%-h(21007)%></h2>;<div class="allowCheckbox"><label><input type="checkbox" name="allow_resources"/><%-h(21171)%></label></div>;<div class="toa-formrow multiSelectResource">;<div class="formLabel" id="<%-allow_resources_id%>"><%-h(21009)%>;<div class="formNote" id="desc_<%-allow_resources_id%>"><%-h(21166)%></div></div>;<div class="formField"></div>;</div>;<div class="allowCheckbox"><label><input type="checkbox" name="allow_ipaddresses"/><%-h(21172)%></label></div>;<div class="toa-formrow whiteList">;<div class="formLabel" id="<%-allow_ipaddresses_id%>">;<div class="formNote" id="desc_<%-allow_ipaddresses_id%>"></div></div>;<div class="formField">;<textarea aria-labelledby="<%-allow_ipaddresses_id%>" aria-describedby="desc_<%-allow_ipaddresses_id%>" placeholder="" rows="6" cols="40" name="white_list"></textarea>;</div>;<div class="formError"></div>;</div>;<div class="allowCheckbox"><label><input type="checkbox" name="allow_cors_domain_list"/><%-h(22111)%></label></div>;<div class="toa-formrow corsDomainList">;<div class="formLabel" id="<%-allow_cors_domain_list_id%>">;<div class="formNote" id="desc_<%-allow_cors_domain_list_id%>"><%-h(22113)%></div></div>;<div class="formField">;<textarea aria-labelledby="<%-allow_cors_domain_list_id%>" aria-describedby="desc_<%-allow_cors_domain_list_id%>" placeholder="" rows="6" cols="40" name="cors_domain_list"></textarea>;</div>;<div class="formError"></div>;</div>;</div>'.split(";"));
this.element=$(this.template.apply({allow_resources_id:generate_id(),allow_ipaddresses_id:generate_id(),allow_cors_domain_list_id:generate_id()}));this.tree=this.element.find(".multiSelectResource .formField");this.whiteList=this.element.find(".whiteList textarea");this.element.find(".whiteList .formNote").append(h(21167).replace(/{SP}/g,"<br/>"));this.allowResource=this.element.find("input[name='allow_resources']");this.allowIPAddres=this.element.find("input[name='allow_ipaddresses']");this.corsDomainList=
this.element.find(".corsDomainList textarea");this.allowCorsDomainList=this.element.find("input[name='allow_cors_domain_list']");this.initMultiSelectResourceModel();this.initMultiSelectResource();this.initEvent()},{getElement:function(){return this.element},setModel:function(c){this.model=c;this.modelChangeUID=this.model.addListener("change",this.onChange.bind(this));this.modelBeforeSaveUID=this.model.addListener("beforeSave",this.onBeforeSave.bind(this));this.modelErrorMessage=this.model.addListener("errorMessage",
this.onError.bind(this))},initEvent:function(){this.whiteList.on("input",function(c){this.readOnlyMode||(c=$(c.target),this.model.set({white_list:c.val()}))}.bind(this));this.allowResource.on("change",function(c){c.target.checked?(this.allowResource.attr("checked","checked"),this.getElement().find(".multiSelectResource").show()):(this.allowResource.removeAttr("checked"),this.getElement().find(".multiSelectResource").hide())}.bind(this));this.allowIPAddres.on("change",function(c){c.target.checked?
(this.allowIPAddres.attr("checked","checked"),this.getElement().find(".whiteList").show()):(this.allowIPAddres.removeAttr("checked"),this.getElement().find(".whiteList").hide())}.bind(this));this.corsDomainList.on("input",function(c){this.readOnlyMode||(c=$(c.target),this.model.set({cors_domain_list:c.val()}))}.bind(this));this.allowCorsDomainList.on("change",function(c){c.target.checked?(this.allowCorsDomainList.attr("checked","checked"),this.getElement().find(".corsDomainList").show()):(this.allowCorsDomainList.removeAttr("checked"),
this.getElement().find(".corsDomainList").hide())}.bind(this))},initMultiSelectResource:function(){var c=generate_id(this.element.find(".multiSelectResource .formLabel").get(0)),b=generate_id(this.element.find(".multiSelectResource .formNote").get(0));this.tree.empty().ResourceMultiSelect({treeState:this.resourcesTreeState,readOnly:this.readOnlyMode,attrs:{aria_labelledby:c},add:function(b,c){var d=this.model.get("resources",[]);d.push(c);this.model.set({resources:d})}.bind(this),remove:function(b,
c){var d=this.model.get("resources",[]);d.indexOf(c.pid);for(var l=0;l<d.length;l++)d[l].pid==c.pid&&d.splice(l,1);console.log(d);this.model.set({resources:d})}.bind(this)}).find('[name="resources"]').attr({"aria-describedby":b})},initMultiSelectResourceModel:function(){this.resourcesTreeState=new d.models.ResourceTree("user resources",{treeDate:_DATA.tree_date,structure:_DATA.p_tree,treeUpdatesFor:_DATA.tree_updates_for,version:_DATA.tree_version,structChangeTime:_DATA.struct_change_time,treeRoots:_DATA.tree_roots,
treeMode:_DATA.tree_mode});self.selectElement},draw:function(){var c=this.model.get("resources",[]),b=this.model.get("white_list","");this.getElement().find(".formError").empty();this.whiteList.val(hs(b));this.tree.ResourceMultiSelect("setResources",$.extend([],c));var d=this.model.get("cors_domain_list","");this.corsDomainList.val(hs(d));0<c.length?(this.allowResource.prop("checked",!0),this.getElement().find(".multiSelectResource").show()):(this.allowResource.prop("checked",!1),this.getElement().find(".multiSelectResource").hide());
""!=b?(this.allowIPAddres.prop("checked",!0),this.getElement().find(".whiteList").show()):(this.allowIPAddres.prop("checked",!1),this.getElement().find(".whiteList").hide());""!=d?(this.allowCorsDomainList.prop("checked",!0),this.getElement().find(".corsDomainList").show()):(this.allowCorsDomainList.prop("checked",!1),this.getElement().find(".corsDomainList").hide())},enableReadOnlyMode:function(){this.readOnlyMode=!0;this.initMultiSelectResource();this.allowResource.attr("disabled","disabled");this.allowIPAddres.attr("disabled",
"disabled");this.whiteList.attr({disabled:"disabled"});this.allowCorsDomainList.attr("disabled","disabled");this.corsDomainList.attr({disabled:"disabled"})},disableReadOnlyMode:function(){this.readOnlyMode=!1;this.initMultiSelectResource();this.allowResource.removeAttr("disabled");this.allowIPAddres.removeAttr("disabled");this.whiteList.removeAttr("disabled");this.allowCorsDomainList.removeAttr("disabled");this.corsDomainList.removeAttr("disabled")},onChange:function(c){this.draw()},onBeforeSave:function(c){this.allowResource.prop("checked")||
this.model.set({resources:[]});this.allowIPAddres.prop("checked")||this.model.set({white_list:""});this.allowCorsDomainList.prop("checked")||this.model.set({cors_domain_list:""})},onError:function(c,b){b.white_list&&this.getElement().find(".whiteList .formError").empty().append(h(b.white_list,{"{LINE_NUM}":b.white_list_line}));b.cors_domain_list_num&&this.getElement().find(".corsDomainList .formError").empty().append(h(b.cors_domain_list_num));b.cors_domain_list&&this.getElement().find(".corsDomainList .formError").empty().append(h(b.cors_domain_list,
{"{LINE_NUM}":b.cors_domain_list_line}))},destroy:function(){void 0!==this.model&&(this.model.removeListener(this.modelChangeUID),this.model.removeListener(this.modelBeforeSaveUID),this.model.removeListener(this.modelErrorMessage));this.getElement().remove()}}))})(toa);(function(d){d.ns("toa.views.applications.sectionGeneral",d.define(null,function(c){this.template=new d.Template('<div class="sectionForm general_info">;<h2 class="apiHead "><%-h(15051)%></h2>;<div class="toa-formrow application_name">;<div class="formLabel">;<label for="application_form_name_label"><%-h(15067)%>:</label>;</div>;<div class="formField">;<input id="application_form_name_label" class="applicationName" name="application_name" type="text" />;</div>;</div>;<div class="toa-formrow application_id">;<div class="formLabel"><%-h(21175)%>:</div>;<div class="formField"></div>;</div>;<div class="toa-formrow is_active">;<div class="formLabel">;<label for="is_active_label"><%-h(15076)%>:</label>;</div>;<div class="formField">;<input id="is_active_label" name="is_active" type="checkbox" />;</div>;</div>;<div class="toa-formrow identity_provider">;<div class="formLabel">;<label for="token_service_label"><%-h(21046)%>:</label>;</div>;<div class="formField">;<select id="token_service_label" name="token_service">;<option value="ofsc"><%-h(21047)%></option>;<option value="external"><%-h(21048)%></option>;<option value="idcs"><%-h(23451)%></option>;</select>;</div>;</div>;</div>'.split(";"));
this.element=$(this.template.apply());this.tokenService=this.element.find(".formField select[name='token_service']");this.name=this.element.find(".formField input[name='application_name']");this.applicationId=this.element.find(".application_id .formField");this.isActive=this.element.find(".formField input[name='is_active']");this.initEvent()},{getElement:function(){return this.element},setModel:function(c){this.model=c;this.modelChangeUID=this.model.addListener("change",this.onChange.bind(this))},
initEvent:function(){this.name.on("input",function(c){this.readOnlyMode||(c=$(c.target),this.model.set({name:c.val()}),c.attr("value",c.val()),$(".item.selected .application_name").text(c.val()))}.bind(this));this.isActive.on("change",function(c){this.readOnlyMode||this.model.set({status:c.target.checked?"active":"inactive"})}.bind(this));this.tokenService.on("change",function(c){this.readOnlyMode||(c=$(c.target),this.model.set({token_service:c.val()}))}.bind(this))},draw:function(){this.name.val(this.model.get("name"));
this.applicationId.empty().append(this.model.get("client_id"));this.isActive.prop("checked","active"==this.model.get("status"));"active"==this.model.get("status")&&this.isActive.attr("checked","checked");this.tokenService.val(this.model.get("token_service","ofsc"))},enableReadOnlyMode:function(){this.readOnlyMode=!0;this.tokenService.attr({disabled:"disabled"});this.name.attr({disabled:"disabled"});this.isActive.attr({disabled:"disabled"})},disableReadOnlyMode:function(){this.readOnlyMode=!1;this.tokenService.removeAttr("disabled");
this.name.removeAttr("disabled");this.isActive.removeAttr("disabled")},onChange:function(c){this.draw()},destroy:function(){void 0!==this.model&&this.model.removeListener(this.modelChangeUID);this.getElement().remove()}}))})(toa);(function(d){d.ns("toa.views.applications.ApplicationForm",d.define(null,function(c){this.originData={};this.template=new d.Template('<div class="toa-application">;<div class="applicationForm"></div>;<div class="bottomPanel">;<button name="save" class="toa-button toa-button-active"><%-h(21013)%></button>;<div class="message"></div>;</div>;</div>'.split(";"));this.templateGroup=new d.Template(['<div class="sectionGroup"></div>']);this.element=$(this.template.apply());this.element.hide();this.appForm=
this.getElement().find(".applicationForm");this.buttonSave=this.element.find(".bottomPanel button[name='save']");this.message=this.element.find(".message");this.initEvent();this.initView()},{initView:function(){var c,b;this.sectionAccess=new d.views.applications.sectionAccess;this.sectionAuthentications=new d.views.applications.sectionAuthentications;this.sectionAuthorization=new d.views.applications.sectionAuthorization;this.sectionGeneral=new d.views.applications.sectionGeneral;c=$(this.templateGroup.apply());
b=$(this.templateGroup.apply());this.appForm.empty();this.appForm.append(c);this.appForm.append(b);c.append(this.sectionGeneral.getElement());c.append(this.sectionAuthentications.getElement());b.append(this.sectionAccess.getElement());b.append(this.sectionAuthorization.getElement())},getElement:function(){return this.element},setModel:function(c){this.modelChangeUID&&this.model.removeListener(this.modelChangeUID);if(!c)return!1;this.originData=$.extend(!0,{},c.toJSON());this.model=c;this.modelChangeUID=
this.model.addListener("change",this.onChange.bind(this));this.sectionAccess.setModel(this.model);this.sectionAuthentications.setModel(this.model);this.sectionAuthorization.setModel(this.model);this.sectionGeneral.setModel(this.model)},getModel:function(){return this.model},getOriginData:function(){return this.originData},initEvent:function(){this.element.find(".applicationForm").on("scroll",function(){this.sectionAccess.getHint().hide()}.bind(this));this.buttonSave.on("click",function(){if(this.readOnlyMode)return!1;
this.saveApplication().done(function(){$(".toa-panel-caption").text(this.model.attributes.name);this.message.empty().append(h(21178))}.bind(this))}.bind(this))},draw:function(){this.sectionGeneral.draw();this.sectionAuthorization.draw();this.sectionAuthentications.draw();this.sectionAccess.draw();this.element.show();this.message.empty()},onChange:function(c){this.message.empty()},enableReadOnlyMode:function(){this.readOnlyMode=!0;this.sectionGeneral.enableReadOnlyMode();this.sectionAuthorization.enableReadOnlyMode();
this.sectionAuthentications.enableReadOnlyMode();this.sectionAccess.enableReadOnlyMode();this.buttonSave.attr({disabled:"disabled"})},disableReadOnlyMode:function(){this.readOnlyMode=!1;this.sectionGeneral.disableReadOnlyMode();this.sectionAuthorization.disableReadOnlyMode();this.sectionAuthentications.disableReadOnlyMode();this.sectionAccess.disableReadOnlyMode();this.buttonSave.removeAttr("disabled")},setApplication:function(c){this.setValues(c)},saveApplication:function(){return this.validateForm()?
this.model.save():$.Deferred().reject()},validateForm:function(){this.hideErrors();var c=!1;""===$("#application_form_name_label").val()&&(this.showError("#application_form_name_label",h(20198)),c=!0);return!c},showError:function(c,b){var d=$("<div>").addClass("formError").text(b);$(c).parent().find(":last-child").after(d)},hideErrors:function(){this.sectionGeneral.element.find(".formError").remove()},destroy:function(){void 0!==this.model&&this.model.removeListener(this.modelChangeUID);this.sectionAccess.destroy();
this.sectionAuthentications.destroy();this.sectionAuthorization.destroy();this.sectionGeneral.destroy();this.getElement().remove()}}))})(toa);(function(d){var c=d.models.ObservableModel;d.ns("toa.models.applications.application",d.define(c,function(b){c.apply(this,arguments)},{idField:"app_id",hiddenApiIds:[14,65,780,99,96],set:function(b,d){d=d||{};c.prototype.set.apply(this,arguments);if(d.silent)d.silentModify&&(this.isModify=!0);else{for(var g in b)this.notify("change."+g,this.changes);d.noModify||(this.isModify=!0)}},save:function(){this.notify("beforeSave");var b=$.Deferred();d.app.trigger("global.data.get",{controller:"applications",
method:this.get("is_new")?"insert":"update",params:{form:d.utils.json.encode(this.toJSON())},responseHandler:function(c,g){if(g.application)this.notify("afterSave"),this.reset(g.application),this.isModify=!1,b.resolve();else{b.reject();if(g.errors.appName)return new d.ui.Popup({title:h(5651),html:h(20781),autoOpen:!0,buttons:[{text:h(445),position:"right",tpl:'<button class="popup-button toa-button"></button>',click:function(){b.resolve();this.destroy()}}]});this.notify("errorMessage",g.errors)}}.bind(this),
errorHandler:function(){b.reject();set_indicator(0)}.bind(this)});return b.promise()},remove:function(){var b=$.Deferred();d.app.trigger("global.data.get",{controller:"applications",method:"delete",params:{form:d.utils.json.encode(this.toJSON())},responseHandler:function(d,g){c.prototype.remove.apply(this,arguments);b.resolve()}.bind(this),errorHandler:function(){set_indicator(0);b.reject()}.bind(this)});return b.promise()},checkConfigured:function(){var b,c,d;d=!0;c=this.get("permissions");if(!c||
!c.children||0==c.access)return!1;c=c.children;for(b in c)if(c[b].access&&!1==this.checkConfiguredApi(c[b]).status){d=!1;break}return d},checkConfiguredApi:function(b){var c,d,k;c={status:!0,msg:""};k=b.label;if(-1===["history_api","resource_management","mobile_client","smart_location_api","gps_api"].indexOf(k)&&b.children)for(d in b=b.children,c.status=!1,c.msg="capacity_api"===k?h(21158):h(21159),b)if(0<b[d].access){c.status=!0;break}d=this.get("layouts",[]);"file_upload"!==k||d.fileupload_set_activity||
d.fileupload_set_inventory||d.fileupload_provider_info||(c.status=!1,c.msg=h(21160));return c}}))})(toa);(function(d){var c=d.models.ObservableCollection;d.ns("toa.models.applications.applications",d.define(c,function(){c.apply(this,arguments)},{modelConstructor:d.models.applications.application,READ_ONLY:1,READ_WRITE:2,isReadOnly:function(){return this.access<this.READ_WRITE},comparator:function(b,c){var d,k;d=b.get("name");k=c.get("name");return d<k?-1:d>k?1:0},toString:function(){return"Application collection"},load:function(b){var c=$.Deferred();d.app.trigger("global.data.get",{controller:"applications",
method:"getApplicationById",params:b,responseHandler:function(b,d){this.reset(Array(d.applications));this.sort();this.access=d.access;this.notify("load");c.resolve()}.bind(this)});return c.promise()}}))})(toa);(function(d){d.ns("toa.controllers.DashboardSettings",d.define(d.Controller,function(){this._switchToConfigScreen()},{SERVER_CONTROLLER:"Reportdashboard",manageInterface:1,mobilityInterface:3,toString:function(){return"Dashboard Settings screen controller"},_switchToConfigScreen:function(){this._isMobility()&&this._showMobilityDashboardConfigPage();this._isManage()&&this._showManageDashboardConfigPage()},_isMobility:function(){return d.currentInterface===this.mobilityInterface},_isManage:function(){return d.currentInterface===
this.manageInterface},_showMobilityDashboardConfigPage:function(){var c=JSON.stringify({mode:"configure"});$app.navigation().redirect("#dashboard/"+c)},_showManageDashboardConfigPage:function(){this._showError(h(22921),h(5651))},_goBackToConfigurationPage:function(){d.app.trigger("layout.menu.click",{label:"company_settings_configuration",url:"",name:"",params:{}})},_showError:function(c,b){var e=[{text:h(445),position:"right",tpl:'<button class="popup-button toa-button"></button>',click:function(){this._goBackToConfigurationPage();
g.destroy()}.bind(this)}],g=new d.ui.Popup({title:b,autoOpen:!0,html:c,modal:!0,onClose:function(){this._goBackToConfigurationPage();g.destroy()}.bind(this),buttons:e})},suspend:function(c){},resume:function(c){this._switchToConfigScreen()},destroy:function(){this.suspend()}}))})(toa);var jetcolor={bind:function(){$("#color-picker-container").hide();for(var d=$("input.color.jetcolor"),c=0;c<d.length;c+=1)d[c].color||(d[c].color=new jetcolor.color(d[c]))},color:function(d){function c(d){d.target!==g&&(void 0===$(d.target).attr("class")||0>$(d.target).attr("class").trim().indexOf("color-palette-panel")&&0>$(d.target).attr("class").trim().indexOf("oj-colorpalette-swatch")&&0>$(d.target).attr("class").trim().indexOf("oj-colorpalette-swatch-container"))&&($("#color-picker-container").hide(),
$("#color-picker-container").off("mousedown touchstart"),b(g,!1),$("body").off("mousedown touchstart",c),$(g).blur())}function b(b,c){var d=$(b);c&&!d.hasClass("colorFieldSelected")?($("input.color.jetcolor").removeClass("colorFieldSelected"),d.addClass("colorFieldSelected")):c||d.removeClass("colorFieldSelected")}this.pickerOnfocus=!0;this.valueElement=d;this.hash=!1;this.first=!0;this.hsv=[0,0,1];this.rgb=[1,1,1];this.setColor=function(b){void 0!==b&&($("#color-picker-container").hide(),this.valueElement.style.backgroundColor=
b,this.valueElement.value=b,this.hash=!0)};this.showPicker=function(){var b=$("#color-picker-container"),g=jetcolor.getElementPos(d),n=jetcolor.getElementSize(d),p=jetcolor.getViewSize(),s=$(d).position(),t=$(d).offset(),u=[140,252],v=s.left;this.first=!0;$(e.valueElement).hasClass("pwi3")?(s.top=parseInt(t.top)-50,v=parseInt(t.left)+5,u=[0,0],1439>Math.min(window.innerWidth,window.screen.availWidth)&&(v=g[0]+n[0])):$(e.valueElement).hasClass("pwi1")?$(e.valueElement).hasClass("activityTypeColor")?
v+=e.valueElement.offsetWidth:(s.left=g[0],s.top=g[1],v=s.left+n[0]):this.hash=!0;g=[t.top+u[1]>p[1]?s.top-u[1]:s.top+n[1],v];b.show();var w=this;toa.browser.isIpad&&b.bind("touchstart",function(b){b.stopPropagation();if(w.first)return b.preventDefault(),w.first=!1});window.dispatchEvent(new CustomEvent("color",{detail:{hash:this.hash,selField:this.valueElement}}));b.css("position","absolute");b.css("z-index","100");b.css("top",parseInt(g[0])+"px");b.css("left",parseInt(parseInt(g[1]-10))+"px");$("body").on("mousedown touchstart",
c)};var e=this,g=jetcolor.fetchElement(this.valueElement);jetcolor.addEvent(d,"focus",function(){b(g,!0);$("body").off("mousedown touchstart",c);e.showPicker()});jetcolor.addEvent(d,"blur",function(){var b=$(d).val();"#"!==b.substring(0,1)&&(b="#"+b);d.style.backgroundColor=b})},addEvent:function(d,c,b){d.addEventListener?d.addEventListener(c,b,!1):d.attachEvent&&d.attachEvent("on"+c,b)},fetchElement:function(d){return"string"===typeof d?document.getElementById(d):d},getElementPos:function(d){var c=
d,b=0,e=0;if(c.offsetParent){do b+=c.offsetLeft,e+=c.offsetTop;while(c=c.offsetParent)}for(;(d=d.parentNode)&&"BODY"!==d.nodeName.toUpperCase();)b-=d.scrollLeft,e-=d.scrollTop;return[b,e]},getElementSize:function(d){return[d.offsetWidth,d.offsetHeight]},getViewSize:function(){return"number"===typeof window.innerWidth?[window.innerWidth,window.innerHeight]:document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?[document.documentElement.clientWidth,document.documentElement.clientHeight]:
[0,0]}};(function(d){d.ns("toa.models.featureToggle.FeatureToggler",d.define(null,function(c){this.sandbox=c;this._setFeaturesData(this.sandbox.options.togglableFeatures)},{_featuresData:null,isFeatureEnabled:function(c){return this.getTogglableFeature(c).isEnabled()},isFeatureExperimental:function(c){return this.getTogglableFeature(c).isExperimental()},getTogglableFeature:function(c){var b=this._getFeaturesData();if(!b[c])throw Error("Unknown togglable feature: "+c);return d.featureToggle.TogglableFeature.prototype.fromRawObject(b[c])},
_setFeaturesData:function(c){if(!Array.isArray(c))throw Error("Invalid togglable features data");this._featuresData=[];c.forEach(function(b){if(!b.label)throw Error("Invalid togglable feature label");this._featuresData[b.label]=b}.bind(this))},_getFeaturesData:function(c){return this._featuresData}}))})(toa);(function(d){d.Ajax=d.define(null,function(){this._create.apply(this,arguments)},{toString:function(){return"Ajax Data model"},_create:function(c){this.sandbox=c;var b=this;b.toNextRequest={};this.sandbox.bind("global.data.get",this.get,this);this.sandbox.bind("global.provider.changed",function(c,d){b.toNextRequest.sel_pid=d.pid;b.toNextRequest.is_favorite_pid=+d.isFavorite;b.toNextRequest.is_group=+d.isGroup;b.toNextRequest.resourceTreeSelection=d.resourceTreeSelection},this);this.sandbox.bind("global.date.changed",
function(c,d){b.toNextRequest.date=d.date},this)},route:function(c,b){var d="?controller="+c;b&&(d+="&method="+b);return d},get:function(c,b){b.controller&&(b.url=d.Ajax.prototype.route(b.controller,b.method));b.data=b.params||{};$.extend(b.data,this.toNextRequest);b.indicator=!0;if(b.responseHandler){var e=this,g=b.responseHandler;b.responseHandler=function(c){b.callbackParams&&(c.callbackParams=b.callbackParams);e.onReceive(c,g)}}b.data.targ_el||(b.data.targ_el=toaGetTargetFromEvent(c));var k=request(b);
this.toNextRequest={};"function"===typeof b.requestHolder&&b.requestHolder(k)},onReceive:function(c,b){try{this.sandbox.trigger("global.data.beforeReceive",c),b("global.data.receive",c)}catch(d){this.sandbox.error(d)}}})})(toa);(function(d){d.Ajax.prototype.route=function(c,b,d){c="?m="+c;b&&(c+="&a="+b);c+="&itype=manage";if("object"===typeof d)for(var g in d)"undefined"!==typeof d[g]&&"controller"!==g&&"method"!==g&&(c+="&"+g+"="+d[g]);return c}})(toa);(function(d){d.models||(d.models={});d.models.PageLabels=d.define(null,function(){this._create.apply(this,arguments)},{items:{},itemsList:{},_create:function(c){this.sandbox=c;this.setItems(this.sandbox.options.mainMenu);this.sandbox.bind("model.companySettings.reload",this.onReload,this);this.sandbox.bind("layout.menu.find",this.findItem,this)},onReload:function(c,b){this.setItems(b.settings.user.main_menu)},setItems:function(c){var b,d,g;if(c){for(b in c){c[b].label=b;if(c[b].items)for(d in c[b].items){c[b].items[d].label=
d;this.firstMenu||(this.firstMenu=c[b].items[d],this.firstMenu.label=d);if(g=c[b].items[d].url)c[b].items[d].url=this.convertUrl(g);this.itemsList[d]=c[b].items[d];this.itemsList[d].parent=b}else this.firstMenu||(this.firstMenu=c[b],this.firstMenu.label=b),c[b].url&&(c[b].url=this.convertUrl(c[b].url));this.itemsList[b]=c[b]}this.items=c}},getItems:function(){return this.items},findItem:function(c){return this.itemsList[c]?this.itemsList[c]:null},getFirstMenu:function(){return this.firstMenu},convertUrl:function(c){return c.replace(/&amp;/g,
"&")}})})(toa);(function(d,c){var b=d.Controller,e=d.models.ActivitiesListColumns=d.define(b,function(){this._create.apply(this,arguments)},{toString:function(){return"ActivityListColumns model"},_create:function(c){b.prototype._create.call(this,c);this.columns=[]},isLoaded:function(){return!!this.columns.length},getAll:function(){return this.columns},setAll:function(b){var c=this.columns.length;this.columns=b;this.notify("changed",{columns:b});c&&this.save()},get:function(b){return this.columns[b]},save:function(){this.sandbox.trigger("global.data.get",
{controller:"Grid",method:"savesetup",params:{columns:d.utils.json.encode(this.columns)}})}});c.extend(e.prototype,d.mixins.observable)})(toa,jQuery);(function(d){var c=d.Controller;d.models.BucketTree=d.define(c,function(){this.resources=null;this.version=0;this.searchKey="";this.found=[];this.treeDate="";this.structChangeTime=0;this.requestedOpenChildren=[];this.eventPrefix="model.quotaResources";this.treeType="BucketTree";this._create.apply(this,arguments)},{toString:function(){return"Model BucketTree"},_create:function(){c.prototype._create.apply(this,arguments);this.resources=new d.Collection({});this.resources.setComparator(this._resourcesComparator);
this.childrenCache={};this.rootResources=[];this.isClean=!0;this._init()},_init:function(){},setup:function(b){this.setVersion(b.version);b.structChangeTime&&(this.structChangeTime=b.structChangeTime);this.treeDate=b.treeDate;this.setupStructure(b.structure)},setupStructure:function(b){var c,g;this.changed=!1;for(c in b)try{g=new d.Resource(b[c]);g.setId(c);this.resources.add(g,c);this.changed=!0;var k=g.getParent();g.hasChildren()&&"undefined"==typeof this.childrenCache[c]&&(this.childrenCache[c]=
[]);k?("undefined"==typeof this.childrenCache[k]&&(this.childrenCache[k]=[]),this.childrenCache[k].push(c)):this.rootResources.push(c)}catch(l){}},getDate:function(){return this.treeDate},getRootsArray:function(){return this.rootResources},clear:function(){this.resources.clear();this.childrenCache={};this.rootResources=[];this.isClean=!0},update:function(b){this.clear();this.setup({treeDate:b.tree_date,structure:b.tree_updates,version:b.tree_version,structChangeTime:b.struct_change_time})},getResource:function(b){return this.resources.get(b)||
!1},get:function(b){return this.getResource(b)},getCurrent:function(){return this.getResource(this.sandbox.get("pid"))},getCount:function(){return this.resources.getCount()},each:function(b,c){this.resources.each(b,c)},getChildren:function(b){return d.isArray(this.childrenCache[b])&&this.childrenCache[b].length?this.childrenCache[b]:!1},addListener:function(){},setVersion:function(b){this.version=b},getStructChangeTime:function(){return this.structChangeTime},getVersion:function(){return this.version},
openFolder:function(){},closeFolder:function(){},_resourcesComparator:function(b,c){var d=b.entity,k=c.entity;return d.l!=k.l?d.l-k.l:d._C!=k._C?k._C-d._C:"undefined"!=typeof d.i&&"undefined"!=typeof k.i?(d=parseInt(d.i),k=parseInt(k.i),d<k?-1:d>k?1:0):d.n.localeCompare(k.n)},_searchCondition:function(b,c){return this.searchKey?b.entity.n&&""!=b.entity.n&&-1!==b.entity.n.toLowerCase().indexOf(this.searchKey)||b.entity.e&&""!=b.entity.e&&-1!==b.entity.e.toLowerCase().indexOf(this.searchKey):!1},search:function(b){if(void 0==
b&&""==b)return this.openedItems={},!1;this.found=[];this.searchKey=b.toLowerCase();b=this.resources.find(this._searchCondition,this);if(d.isObject(b))for(var c in b)this.found.push(c);return 0<this.found.length},getSearchKey:function(){return this.searchKey},eachFound:function(b,c){var d=this;d.found.sort(function(b,c){return d.get(b)&&d.get(c)?d._resourcesComparator(d.get(b),d.get(c)):0});$.each(d.found,function(k,l){d.get(l)&&b.apply(c,[d.get(l)])})},_trigger:function(b,c){$(this).triggerHandler(b,
[c])}})})(toa);(function(d){d.models||(d.models={});d.models.LoginPolicy=d.define(null,function(){this.items=!1;this._create.apply(this,arguments)},{_create:function(c){this.sandbox=c;this.items=null;this.sandbox.bind("global.config.changed",this.onReload,this)},reload:function(c){var b=this;b.sandbox.trigger("global.data.get",{controller:"Loginpolicy",method:"getpolicies",params:{fields:["auth_type","ldap_url"]},responseHandler:function(d,g){b.items=g.login_policies;c&&c(b.items)}})},onReload:function(){this.reload()},
getList:function(c){this.items?c(this.items):this.reload(c)}})})(toa);(function(d){d.models||(d.models={});d.models.FeatureList=d.define(null,function(){this.sandbox=!1;this.options={};this._create.apply(this,arguments)},{eventPrefix:"model.featureList",_create:function(c){this.sandbox=c;this.options=$.extend(this.options,c.options||{});this.options.eventPrefix&&(this.eventPrefix=this.options.eventPrefix);this.services={};this.sandbox.options.eventPrefix=this.eventPrefix},load:function(c){this.services=c},isCollaborationServiceEnabled:function(){return this.services&&
this.services.collaboration?"enabled"===this.services.collaboration.status?!0:!1:!1},isSLRServiceEnabled:function(){return this.services&&this.services.street_level_routing?"enabled"===this.services.street_level_routing.status?!0:!1:!1}})})(toa);(function(d){d.models=d.models||{};d.models.User=d.define(d.ModelRecord,function(){this._create.apply(this,arguments)},{toString:function(){return"User"},_create:function(c){this.sandbox=c;this.entity=d.app.model("companySettings").getUser()},getShortTimeFormat:function(){this.reload();return this.entity.dateFormats.time_short},getTimezoneDiff:function(){this.reload();return this.entity.tz_diff},reload:function(){d.app.model("companySettings").reload();this.entity=d.app.model("companySettings").getUser()},
getWeekStartDay:function(){return d.app.model("companySettings").getUser().week_start}})})(toa);(function(d){d.models||(d.models={});d.models.CompanySettings=d.define(null,function(){this.sandbox=!1;this.activitiesTypes={};this.options={};this._create.apply(this,arguments)},{eventPrefix:"model.companySettings",_create:function(c){this.sandbox=c;this.options=$.extend(this.options,c.options||{});this.options.eventPrefix&&(this.eventPrefix=this.options.eventPrefix);this.sandbox.options.eventPrefix=this.eventPrefix},reload:function(c){var b=this;c.lookups?b.load(c.lookups):b.sandbox.trigger("global.data.get",
{controller:"Settings",method:"get",params:{},responseHandler:function(c,d){b.load(d.lookups)}})},load:function(c){this.settings=c;if(c.activity&&c.activity.features){this.featuresToTypeId={};var b=c.activity.features,d;for(d in b)this.featuresToTypeId[b[d].features]=d}this.settings.user&&(this.settings.user.server_timestamp&&(this.settings.user.client_server_time_diff=(new Date).getTime()-1E3*this.settings.user.server_timestamp),"undefined"==typeof this.settings.user.refresh_rate_onerror&&(this.settings.user.refresh_rate_onerror=
0.5));this.sandbox.trigger(".reload",{settings:c})},getActivityColor:function(c,b){return this.settings.activity.features[this.featuresToTypeId[c]][(b||"pending")+"_color"]},getActivityColorById:function(c,b){var d=this.settings.activity.items[c];return d?this.settings.activity.features[d.features][(b||"pending")+"_color"]:"FFFFFF"},getActivityFeaturesByType:function(c){return(c=this.settings.activity.items[c])?this.settings.activity.features[c.features].features:null},hasActivityFeature:function(c,
b){return!!(this.getActivityFeaturesByType(c)&b)},getActivityTypeName:function(c){return this.settings.activity.items[c].text},getMapProvider:function(){return this.settings.map_provider||null},getCustomMapLayers:function(){return this.settings.custom_map_layer||null},getMapProviderConfig:function(){return this.settings.map_provider_info||{}},getMapKeys:function(){var c={};if(this.settings.map_provider&&"oracle"!==this.settings.map_provider){var b=this.settings.map_provider_info;b&&(c={password:b.passwd,
clientId:b.username,channel:b.channel})}return c},getActivityTimeSlotName:function(c){return c.afeatures&128?(c=c.time_slot)&&"0"!=c?this.settings.time_slot[c].tsname:"":c.service_window},getGoogleSettings:function(){return this.settings.google||null},getElocationConfig:function(){return this.settings.oracle_eloc},getOracleMapConfig:function(){return this.settings.oracle_maps},getUser:function(){return this.settings.user},getCutLimit:function(){return this.settings.cut_limit},getFutureDaysLimit:function(){return this.settings.future_days_limit},
getDistanceUnits:function(){return this.settings.distance_units},isPopupAction:function(c){c=this.settings.actions[c]||null;return!(!c||!c.options||c.options&1)},getActionsDesc:function(c){return this.settings.actions[c]||null},getQuotaThreshold:function(c){if(1==c)return this.settings.quota_overload_threshold_1/100;if(2==c)return this.settings.quota_overload_threshold_2/100},getResourceFeaturesByType:function(c){return(c=this.settings.provider[c])&&c.features?c.features:0},hasResourceFeature:function(c,
b){return!!(this.getResourceFeaturesByType(c)&b)},getResourceTypeIcon:function(c){return(c=this.settings.provider[c])&&c.icons?c.icons:0},getResourceRole:function(c){return(c=this.settings.provider[c])&&c.role?c.role:0},validateValue:function(c,b){return"undefined"!=typeof c?RegExp("undefined"!=typeof c.regex?c.regex:"",typeof("undefined"!=c.flags)?c.flags:"").test(b):!0},validateEmail:function(c){return this.validateValue(this.settings.validation.email,c)},validatePhone:function(c){return this.validateValue(this.settings.validation.phone,
c)},getResourceFolder:function(){return _DATA.resource_folder||"resource"},getTravelTimeColor:function(){return this.settings.travel_time_color||""},getOptionShowPlanning:function(){return!!this.settings.company_option_show_planning},getTimeWhileYesterdayRw:function(){return this.settings.workingTimeSinceMidnight},getMapBounds:function(){var c=this.settings.map_bounds;return c?parseFloat(c.x1)===c.x1&&parseFloat(c.y1)===c.y1&&parseFloat(c.x2)===c.x2&&parseFloat(c.y2)===c.y2?c.x1==c.x2&&c.y1==c.y2?
{lat:c.y1,lng:c.x1}:{min:{lat:c.y1,lng:c.x1},max:{lat:c.y2,lng:c.x2}}:parseFloat(c.x1)===c.x1&&parseFloat(c.y1)===c.y1?{lat:c.y1,lng:c.x1}:{lat:0,lng:0,zoom:0}:{lat:0,lng:0,zoom:0}}})})(toa);(function(){var d=toa.Controller;toa.ns("toa.models.ResourceTreeManager",toa.define(d,function(c){d.apply(this,arguments);this._treeStates={};this.sandbox.bind("global.provider.update",function(b,c){this.updateTrees(c.trees instanceof Object?c.trees:{})}.bind(this));this.sandbox.bind("global.provider.reloadFavorite",function(b,c){this.updateFavorites(c.favorites instanceof Object?c.favorites:{})}.bind(this));this.sandbox.bind("global.data.beforeRequest",function(b,c){c.trees||(c.trees={});this.updateRequest(c)}.bind(this))},
{toString:function(){return"Resources Tree Manager"},handleTree:function(c){this._treeStates[c.identifier]=c},updateTrees:function(c){for(var b=0,d=c.length;b<d;b+=1){var g=c[b];if(g.tree_updates&&g.hasOwnProperty("tree_identifier")){var k=this._treeStates[g.tree_identifier];k&&k.update(g);toa.currentInterface!==INTERFACE.MOBILITY&&Object.keys(this._treeStates).forEach(function(b){this._treeStates[b].getResourceFavorites&&this._treeStates[b].getResourceFavorites()&&this._treeStates[b].getResourceFavorites().updateCount(g)}.bind(this))}}},
updateFavorites:function(c){Object.keys(c).forEach(function(b){this._treeStates[b].getResourceFavorites&&this._treeStates[b].getResourceFavorites()&&this._treeStates[b].getResourceFavorites().update({favorites:c[b],full_favorites_list:Object.keys(c[b])})}.bind(this))},updateRequest:function(c){for(var b in this._treeStates){var d=this._treeStates[b],g=d._autoUpdateRequired||c.trees.hasOwnProperty(b)||!!_DATA.page_label.match(/^reports_/g)||"tools_offline_sync"===_DATA.page_label;this._treeStates.hasOwnProperty(b)&&
g&&(g=c.trees[b]?c.trees[b]:{},g=$.extend(g,this.retreiveTreeRequestParams(d)),c.trees[b]=g)}},retreiveTreeRequestParams:function(c){if("object"!=typeof c)return{};var b={};b.tree_identifier=c.identifier;b.tree_date=c.getDate();b.tree_version=c.getVersion();b.tree_structure_version=c.getStructureVersion();b.struct_change_time=c.getStructChangeTime();b.tree_roots=c.getTreeRoots();var d=c.getSearchKey()?c.found:c.getOpened();d.length&&(b.opened_providers=d.join("_"));!b.hasOwnProperty("tree_search")&&
c.getSearchKey()&&c.getDate()!==c.searchDate&&(c.searchDate=c.getDate());c.getSearchKey()&&(b.tree_search=c.getSearchKey());toa.currentInterface===INTERFACE.MOBILITY&&c instanceof toa.models.ResourceTree&&(c.isMainTree()||c.isGroupTree())&&(b=c.addTreeParameters(b));return b}}))})();(function(d){var c=d.ModelEntity;d.Resource=d.define(c,function(){this._create.apply(this,arguments)},{idField:"PID",entityDefault:{PID:0,VERSION:"",INDEX:-1,NAME:" ",TYPE:1,FLAGS:"",ACTIVATED:0,TIME_FROM:0,TIME_TO:0},fieldName:{NAME:"n",EXTERNAL_ID:"e",PID:"z",GROUP_ID:"g",DATE:"D",PARENT:"p",TYPE:"t",ACTIVE:"s",ZONE_DIFF:"S",ACTIVATED:"a",DEACTIVATED:"d",TIME_FROM:"F",TIME_TO:"T",FLAGS:"f",LEVEL:"l",CHILDREN:"c",ASSISTS_TO:"A",TEAM:"M",VERSION:"v",INDEX:"i",TOTAL:"X",PENDING:"Y",FINAL_TRAVEL:"L",
FINAL_TRAVEL_TOTAL:"LD",DYNAMIC_NODE:"r",REACTIVATION_TIME:"rt",REGULAR_TIME_FROM:"FR",REGULAR_TIME_TO:"TR",ONCALL_TIME_FROM:"FO",ONCALL_TIME_TO:"TO",ONCALL_SHIFT:"SO",ONCALL_DECORATION:"DO",REGULAR_SHIFTID:"SR",TRAVEL_ESTIMATION_WRANING:"TW",DAYS:"days"},fieldKey:{empty:!0},dynamicFields:["M","A","X","Y"],toString:function(){return"Provider model, id: "+this.getId()},_create:function(b,d){c.prototype._create.call(this,b,d);this.entity.groups={};this.entity.groups[this.TIME_VIEW_GROUP_ORDERED]={};
this.entity.groups[this.TIME_VIEW_GROUP_NOT_ORDERED]={};this.entity.groups[this.TIME_VIEW_GROUP_NOT_SCHEDULED]={}},update:function(b){if("object"==typeof b){for(var c in b)"NAME"!=this.keyToName(c)||b[c]||(b[c]="< "+h(12414)+" >"),this.set(c,b[c]);for(c=0;c<this.dynamicFields.length;c+=1)"undefined"==typeof b[this.dynamicFields[c]]&&this.unset(this.dynamicFields[c]);this.set("_C",this.isAllowChild())}},getName:function(b){return this.get("NAME",b)},hasChildren:function(){return!!this.get("CHILDREN",
!1)},getParent:function(){return this.get("PARENT",!1)},isTechnician:function(){return this.hasOption(this.PROVIDER_FEATURE_QUEUE_OWNER)},isActive:function(){return this.get("FLAGS")&this.ACTIVE_PROVIDER},isBucket:function(){return this.hasOption(this.PROVIDER_FEATURE_BUCKET)},isRoleVehicle:function(){return"vehicle"==this.settings.getResourceRole(this.get("TYPE"))},isRoleTool:function(){return"tool"==this.settings.getResourceRole(this.get("TYPE"))},isRoleFieldResource:function(){return"field_resource"==
this.settings.getResourceRole(this.get("TYPE"))},isRoleBucket:function(){return"bucket"==this.settings.getResourceRole(this.get("TYPE"))},isRoleOrganizationUnit:function(){return"organization_unit"==this.settings.getResourceRole(this.get("TYPE"))},isAllowChild:function(){return this.hasOption(this.PROVIDER_FEATURE_ALLOW_CHILD_PROVIDERS)},getQueue:function(b){if(+b>=this.TIME_VIEW_GROUP_ORDERED&&+b<=this.TIME_VIEW_GROUP_NOT_SCHEDULED)return this.entity.groups[b];if(d.isDefined(this.queueName[b]))return this.entity.groups[this.queueName[b]];
throw Error("No such resource queue "+b);},getQueueForMultiDay:function(b,c){d.isDefined(this.entity.groups[c])||(this.entity.groups[c]={});if(+b>=this.TIME_VIEW_GROUP_ORDERED&&+b<=this.TIME_VIEW_GROUP_NOT_SCHEDULED)return d.isDefined(this.entity.groups[c][b])||(this.entity.groups[c][b]={}),this.entity.groups[c][b];d.isDefined(this.entity.groups[c][this.queueName[b]])||(this.entity.groups[c][this.queueName[b]]={});return this.entity.groups[c][this.queueName[b]]},hasOption:function(b){return this.settings.hasResourceFeature(this.get("TYPE"),
b)},isActiveQueue:function(){return this.get("FLAGS")&this.ACTIVE_QUEUE?!0:!1},icon:function(){var b=this.get("FLAGS"),c=this.get("TYPE");if(b&this.ON_CALL_PROVIDER&&!(b&this.ACTIVE_QUEUE||this.isFlagSet(b,this.REGULAR_PROVIDER)))return"icr ptnon_working_cal";if(b&this.PENDING_ACTIVITIES_WARNING||b&this.ACTIVE_QUEUE_WARNING)return"icr ptinactive_alert";if(!(b&this.ACTIVE_PROVIDER))return"ic ptinactive";if(b&this.MISCONFIGURED_CALENDAR||this.isFlagSet(b,this.NO_ASSIGNED_ACTIVE_USER_BIT))return"ic ptnon_configured_cal";
if(b&this.MISCONFIGURED_TIME_ZONE)return"ic ptnon_configured_tz";if(b&this.NON_WORKING_DAY&&(b&this.PENDING_ACTIVITIES_WARNING||b&this.ACTIVE_QUEUE_WARNING))return"icr ptnon_working_cal_alert";if(b&this.NON_WORKING_DAY)return"ic ptnon_working_cal";var d=this.settings.getResourceTypeIcon(c),l=b&this.QUEUE_STATUS,n=b&this.LOAD,p="0",p=b&this.NOT_ACTIVATED_IN_TIME?this.NOT_ACTIVATED_IN_TIME:b&(this.SW_WARNING|this.SLA_WARNING)?this.SW_WARNING:b&this.STOPPED_REPORTING?this.STOPPED_REPORTING:this.isFlagSet(b,
this.NOT_ENOUGH_INVENTORY_BIT)?this.NOT_ACTIVATED_IN_TIME:this.isFlagSet(b,this.ACCESS_HOURS_WARNING)?this.SW_WARNING:"0";return this.getIconPrefix()+" res_type_"+c+" pt"+d+"_"+l+"_"+n+"_"+p},getIconPrefix:function(){return"res-ic"},getResourceTypeIcon:function(){return this.settings.getResourceTypeIcon(this.get("TYPE"))},isFlagSet:function(b,c){if($.isArray(c)){var d=Number(b).toString(2),l=d.length-1-c[0];return l<d.length?"1"==d[l]:!1}return!!(b&c)},hasMultidayData:function(){return null!==this.get("DAYS",
null)},getFromMultiday:function(b,c){var k=this.get("DAYS",null);if(null===k)return null;k=k[b];if(!d.isDefined(k))return null;k=k[this.nameToKey(c)];return d.isDefined(k)?k:null},isAcceptActivity:function(b,c){b=b||!1;c=c||!1;var d=this.get("FLAGS");if(!(d&this.ACTIVE_PROVIDER))return this.isBucket()?5568:5567;if(this.isRoleFieldResource()&&this.isFlagSet(d,this.NO_ASSIGNED_ACTIVE_USER_BIT))return 16802;if(!c&&(this.isRoleTool()||this.isRoleVehicle())&&this.isFlagSet(d,this.ONLY_TEAMWORK_ALLOWED_BIT))return 16803;
if(this.isTechnician()&&!b){if(!(d&this.WORKING_DAY))return 5570;if(d&this.DEACTIVATED_QUEUE&&!(d&this.ON_CALL_PROVIDER))return 5571}return this.isTechnician()||this.isBucket()?5579:5569},copyState:function(){return new d.Resource($.extend(!0,{},this.getEntity()))},queueName:{ordered:0,notOrdered:1,withoutDate:2},TIME_VIEW_GROUP_ORDERED:0,TIME_VIEW_GROUP_NOT_ORDERED:1,TIME_VIEW_GROUP_NOT_SCHEDULED:2,ENTITY_PROVIDER:3,PROVIDER_TYPE_PROVIDER:1,PROVIDER_TYPE_AGGREGATOR:2,PROVIDER_TYPE_BUCKET:3,PROVIDER_FEATURE_QUEUE_OWNER:2,
PROVIDER_FEATURE_BUCKET:4,PROVIDER_FEATURE_ALLOW_CHILD_PROVIDERS:16,PROVIDER_FEATURE_ALLOW_TO_ASSIST_TO:32,PROVIDER_FEATURE_ALLOW_TO_BE_A_TEAMHOLDER:64,PROVIDER_FEATURE_SHARE_INVENTORY_IN_TEAMWORK:128,PROVIDER_FEATURE_ALLOW_USERS:256,PROVIDER_FEATURE_ENABLE_CAPACITY:512,PROVIDER_FEATURE_USE_IN_ROUTING:1024,PROVIDER_FEATURE_STARTING_TRAVEL_IS_WORKTIME:2048,PROVIDER_FEATURE_ENDING_TRAVEL_IS_WORKTIME:4096,PROVIDER_FEATURE_TRACK_LOCATION:8192,PROVIDER_FEATURE_SHARE_LOCATION_IN_TEAMWORK:16384,PROVIDER_FEATURE_ENABLE_NOT_ACTIVATED_IN_TIME:32768,
PROVIDER_FEATURE_SHARE_WORK_SKILLS_IN_TEAMWORK:65536,PROVIDER_FEATURE_CONTINGENT_WORKERS:131072,ACTIVE_PROVIDER:1,ON_CALL_PROVIDER:2,MISCONFIGURED_CALENDAR:4,WORKING_DAY:8,NON_WORKING_DAY:16,ACTIVE_QUEUE:32,NOT_ACTIVATED_QUEUE:64,DEACTIVATED_QUEUE:128,NO_LOAD:256,MIDDLE_LOAD:512,FULL_LOAD:1024,PENDING_ACTIVITIES_WARNING:33554432,ACTIVE_QUEUE_WARNING:67108864,NOT_ACTIVATED_IN_TIME:2048,SW_WARNING:4096,STOPPED_REPORTING:8192,MISCONFIGURED_TIME_ZONE:16384,PAST_DAY:32768,SLA_WARNING:131072,NOT_ENOUGH_INVENTORY_BIT:[32],
NO_ASSIGNED_ACTIVE_USER_BIT:[33],ONLY_TEAMWORK_ALLOWED_BIT:[34],REGULAR_PROVIDER:[35],ACCESS_HOURS_WARNING:[36],PROVIDER:1,AGGREGATOR:2,BUCKET:3});var b=d.Resource.prototype;b.QUEUE_STATUS=b.ACTIVE_QUEUE+b.DEACTIVATED_QUEUE+b.NOT_ACTIVATED_QUEUE;b.LOAD=b.NO_LOAD+b.MIDDLE_LOAD+b.FULL_LOAD;b.FILTER=b.NON_WORKING_DAY+b.ACTIVE_QUEUE+b.NOT_ACTIVATED_QUEUE+b.DEACTIVATED_QUEUE;b.MAX_FILTER=b.NON_WORKING_DAY+b.INACTIVE_PROVIDER+b.ACTIVE_QUEUE+b.NOT_ACTIVATED_QUEUE+b.DEACTIVATED_QUEUE;b.ALWAYS_SHOW=[b.MISCONFIGURED_CALENDAR,
b.MISCONFIGURED_TIME_ZONE,b.NO_ASSIGNED_ACTIVE_USER_BIT];b.NORMALIZED_FILTER=b.FILTER&b.MAX_FILTER})(toa);(function(d){var c=d.define(null,function(b){this._options=b;b=d.Resource.prototype;this._mask=b.NON_WORKING_DAY+b.ACTIVE_QUEUE+b.NOT_ACTIVATED_QUEUE+b.DEACTIVATED_QUEUE},{_mask:0,_options:null,getMask:function(){return this._mask},getOption:function(b){return this._options[b]},getOptions:function(){return this._options},toggleOption:function(b){var c=this.getOption(b);if(!c)return!1;c.active=!c.active;this._mask^=c.flag;this.notify("option toggled",b);return!0},copyState:function(b){b=b._options;
for(var c in b)b.hasOwnProperty(c)&&this._options[c].active!==b[c].active&&this.toggleOption(c)}});d.mixin(c.prototype,d.mixins.EventEmitter);d.models.ResourceTree=d.define(null,function(b,e){this.identifier=b;this.found=[];this.requestedOpenChildren=[];this.openedResources=[];this.wereOpened=[];this.childrenCache={};this.rootResources=[];this.filter=new c({inactive:{active:!1,flag:1,translation:5174},nonworking:{active:!0,flag:16,translation:5173},notstarted:{active:!0,flag:64,translation:5175},
started:{active:!0,flag:32,translation:5176},stopped:{active:!0,flag:128,translation:5177}});this.resources=new d.Collection({add:function(b){this.notify("added",{resourceId:b.id,date:this.getDate()})}.bind(this),remove:function(b){this.notify("removed",{resourceId:b.id,date:this.getDate()})}.bind(this)});this.resources.setComparator(this._resourcesComparator);this.dynamicResources=new d.Collection({add:function(b){this.notify("dynamicAdded",{resourceId:b.id,date:this.getDate()})}.bind(this),remove:function(b){this.notify("dynamicRemoved",
{resourceId:b.id,date:this.getDate()})}.bind(this)});this._scrollOffset={top:0,left:0};e instanceof Object&&this.setup(e);d.app.model("resourceTreeManager").handleTree(this)},{version:0,tree_structure_version:null,previouslySelected:0,currentlySelected:0,previouslySelectedGroup:0,currentlySelectedGroup:0,searchKey:"",previousSearchKey:"",searchDate:"",searchLimited:!1,found:null,treeDate:"",structChangeTime:0,treeMode:"",requestedOpenChildren:[],identifier:"",_autoUpdateRequired:!1,openedResources:null,
childrenCache:null,rootResources:null,isClean:!0,resources:null,resourceGroups:null,dynamicResources:null,filter:null,_scrollOffset:null,toString:function(){return"Model ResourceTree"},setup:function(b){this.setVersion(b.version);this.setStructureVersion(b.tree_structure_version);b.structChangeTime&&(this.structChangeTime=b.structChangeTime);b.treeRoots&&(this.treeRoots=b.treeRoots);this.treeDate=b.treeDate;b.treeMode&&(this.treeMode=b.treeMode);d.currentInterface!==INTERFACE.MOBILITY&&(this.resourceFavorites=
b.resourceFavorites)&&this.resourceFavorites.addListener("reloadState",this.requestFavorites.bind(this));this.setupStructure(b.structure);this.updateVersions(b.treeUpdatesFor)},setResourceGroups:function(b,c){d.currentInterface===INTERFACE.MOBILITY&&this.isMainTree()&&(b=b||{},c=c||{},this.resourceGroups=new d.models.ResourceGroups(this.identifier,b,c))},updateResourceGroups:function(b){if(this.hasResourceGroups()&&b.resource_groups){var c=!!b.reload_resource_groups;this.getResourceGroups().update(b,
c)}},getResourceFavorites:function(){return this.resourceFavorites},getResourceGroups:function(){return this.resourceGroups},hasResourceGroups:function(){return this.getResourceGroups()&&this.getResourceGroups()instanceof d.models.ResourceGroups?!0:!1},setupStructure:function(b){var c,g=this,k;g.changed=!1;g.dynamicResources.each(function(c){c=c.getId();b[c]&&b[c].r||(g.dynamicResources.remove(c),g.changed=!0)});for(c in b)if(b[c].r)if(k=g.dynamicResources.get(c))k.update(b[c]),k.isChanged()&&(k.clearChanged(),
g.notify("updated",{resourceId:c}),g.changed=!0);else try{var l=new d.Resource(b[c]);l.setId(c);g.dynamicResources.add(l,c);g.changed=!0}catch(n){}else if(k=g.resources.get(c))k.update(b[c]),k.isChanged()&&(k.clearChanged(),g.notify("updated",{resourceId:c}),g.changed=!0);else if("undefined"!==typeof b[c].n)try{k=new d.Resource(b[c]);k.setId(c);g.resources.add(k,c);g.changed=!0;var p=k.getParent();k.hasChildren()&&"undefined"==typeof g.childrenCache[c]&&(g.childrenCache[c]=[]);p?("undefined"==typeof g.childrenCache[p]&&
(g.childrenCache[p]=[]),g.childrenCache[p].push(c)):g.rootResources.push(c)}catch(s){}else console.error("Incorrect tree node found id:"+c)},setDate:function(b){if(this.treeDate===b)return this;this.setVersion(0);this.treeDate=b;this.updateVersions(this.wereOpened);this.wereOpened.length=0;return this},getDate:function(){return this.treeDate},getStructure:function(){return!0},getRootsArray:function(){return this.rootResources},clear:function(){this.openedResources=this.getOpened();this.searchLimited=
!1;this.dynamicResources.clear();this.resources.clear();this.childrenCache={};this.rootResources=[];this.isClean=!0},updateVersions:function(b){for(var c in b){var d=this.get(b[c]);d&&d.set("VERSION",this.getVersion())}},update:function(b){var c=!1;b.reload_tree&&!b.tree_search&&(this.clearInvisible(b.tree_invisible),this.clear(),c=!0);b.favorites=b.favorites instanceof Array?{}:b.favorites;var d=this.getResourceFavorites()&&b.favorites?this.getResourceFavorites().update(b,!1):this.getResourceFavorites();
this.setup({treeDate:b.tree_date,structure:b.tree_updates,resourceFavorites:d,version:b.tree_version,tree_structure_version:b.tree_structure_version,structChangeTime:b.struct_change_time,treeRoots:b.tree_roots});b.tree_search?(this.found=b.tree_updates_for,this.searchLimited=!!b.tree_search_limited):this.updateVersions(b.tree_updates_for);b.tree_mode&&(this.treeMode=b.tree_mode,this.notify("treeModeUpdated",b.tree_mode));this.changed&&this.notify("changed",{clear:c});this.updateResourceGroups(b)},
setResource:function(b,c){throw Error("implement setResource method");},getResource:function(b){return this.resources.get(b)||this.dynamicResources.get(b)||!1},get:function(b){var c=this.getResource(b);!c&&this.getResourceFavorites()&&(c=this.getResourceFavorites().getResource(b));return c},getCurrent:function(){return this.getResource(this.currentlySelected)},getCount:function(){return this.resources.getCount()+this.dynamicResources.getCount()},getTreeMode:function(){return this.treeMode},each:function(b,
c){this.resources.each(b,c);this.dynamicResources.each(b,c)},openFolder:function(b){b+="";var c=this.get(b);if(!(this.searchKey||c&&!c.hasChildren()||0<=$.inArray(b,this.openedResources))){this.openedResources.push(b);-1===$.inArray(b,this.wereOpened)&&this.wereOpened.push(b);if(c){var d=c.get("VERSION");d&&this.getChildren(c.getId())?d!=this.getVersion()&&this.requestUpdate():this.requestLoadChildren(b)}else this.requestLoadParents(b);this.notify("provider opened",b)}},closeFolder:function(b){b+=
"";delete this.wereOpened[b];this.resources.get(b).set("VERSION","");var c=$.inArray(b,this.openedResources);0<=c&&(this.openedResources.splice(c,1),200<this.resources.getCount()?(this.clearClosedResources(),this.notify("changed")):this.notify("provider closed",b))},clearClosedResources:function(){this.openedResources=this._filterWithClosedParent();var b=[];this.resources.each(function(b,c){!this._checkIsParentsOpened(c)&&this._clearParrentVersionAndCachedChildren(c)&&b.push(c.getId())}.bind(this,
b));for(var c=0;c<b.length;c++)this.resources.remove(b[c]),delete this.wereOpened[b[c]]},_clearParrentVersionAndCachedChildren:function(b){b=b.getParent();var c=this.resources.get(b);delete this.childrenCache[b];c&&c.set("VERSION","");return!0},_checkIsParentsOpened:function(b){if(0===b.getId()||-1!==this.rootResources.indexOf(b.getId()+""))return!0;b=b.getParent();return-1===this.openedResources.indexOf(b+"")?!1:this._checkIsParentsOpened(this.resources.get(b))},_filterWithClosedParent:function(){for(var b=
[],c=0;c<this.openedResources.length;c++)this._checkIsParentsOpened(this.resources.get(this.openedResources[c]))&&b.push(this.openedResources[c]);return b},isOpened:function(b){return 0<=$.inArray(b+"",this.openedResources)?!0:!1},isDistantParent:function(b,c){var d=b;do{d=this.get(d);if(!d)break;d=d.getParent();if(d==c)return!0}while(d);return!1},getChildren:function(b){return d.isArray(this.childrenCache[b])&&this.childrenCache[b].length?this.childrenCache[b]:!1},getOpened:function(b){var c=[];
"undefined"==typeof b&&(b=this.rootResources);for(var d in b)this.isOpened(b[d])&&(c.push(b[d]),c=c.concat(this.getOpened(this.getChildren(b[d]))));return c},getAllOpened:function(b){var c=[];"undefined"==typeof b&&(b=this.rootResources);for(var d in b)this.isOpened(b[d])&&c.push(b[d]),c=c.concat(this.getAllOpened(this.getChildren(b[d])));return c},clearInvisible:function(b){if(b){b=b.split("_");for(var c=0;c<b.length;c++)this.removeInvisible(b[c]),this.closeFolder(b[c])}},removeInvisible:function(b){if(this.resources.get(b)){var c=
this.getChildren(b);if(c&&d.isArray(c))for(var g=0;g<c.length;g++)this.removeInvisible(c[g]);this.childrenCache[b]&&delete this.childrenCache[b];this.resources.remove(b)}},setVersion:function(b){this.version=b},setStructureVersion:function(b){this.tree_structure_version=b},getStructChangeTime:function(){return this.structChangeTime},getTreeRoots:function(){return this.treeRoots},getVersion:function(){return this.version},getStructureVersion:function(){return this.tree_structure_version},selectProvider:function(b,
c){var d=0;b.selectedPid?d=b.selectedPid:(d=b,b={groupId:0,rootPid:0,selectedPid:d});var k=function(){var c=!1;this.getResourceFavorites()&&((c=this.getResourceFavorites().isCurrent(d))||this.getResourceFavorites().unselectProvider());if(d&&!this.getResource(d))return!1;this.previouslySelected=this.currentlySelected;this.currentlySelected=d;this.previouslySelectedGroup=this.currentlySelectedGroup;this.currentlySelectedGroup=0;b.groupId&&this.getResourceGroups()?this.getResourceGroups().selectGroupResource(b):
(this.getResourceGroups()&&this.getResourceGroups().clearSelection(),this.notify("provider selected",d,c,b));return!0}.bind(this);!0!==c&&k()||this.requestLoadParents(d,k);return this},selectProviderGroup:function(b,c,d){this.previouslySelectedGroup=this.currentlySelectedGroup;this.currentlySelectedGroup=b;this.previouslySelected=this.currentlySelected;this.currentlySelected=0;this.notify("provider selected",d,b);return this},selectGroup:function(b){this.previouslySelectedGroup=this.currentlySelectedGroup;
this.currentlySelectedGroup=b;this.previouslySelected=this.currentlySelected;this.currentlySelected=0;this.notify("group selected",b);return this},selectGroupResource:function(b){this.previouslySelectedGroup=this.currentlySelectedGroup;this.currentlySelectedGroup=0;this.previouslySelected=this.currentlySelected;this.currentlySelected=b.selectedPid;this.notify("provider selected",this.currentlySelected,!0,b);return this},getSelectedProvider:function(){return this.getResource(this.currentlySelected)},
_resourcesComparator:function(b,c){var d=b.entity,k=c.entity;return d.l!=k.l?d.l-k.l:d._C!=k._C?k._C-d._C:"undefined"!=typeof d.i&&"undefined"!=typeof k.i?(d=parseInt(d.i),k=parseInt(k.i),d<k?-1:d>k?1:0):d.n.localeCompare(k.n)},getAsync:function(b,c){var d=this;if(!$.isArray(b))throw Error("getAsync: first argument must be array");c=c||function(){};for(var k={},l=[],n=0;n<b.length;n++){var p=b[n],s=d.get(p);s?k[p]=s:l.push(p)}if(!l.length)return c.apply(this,[k]),!0;d.requestLoadParents(l,function(){k=
{};for(var l=0;l<b.length;l++){var n=b[l],p=d.get(n);p&&(k[n]=p)}c.apply(d,[k])});return!1},search:function(b){2>b.length||(this.found=[],this.setSearchKey(b),this.searchLimited=!1,this.searchDate=this.treeDate,this.requestSearch(b))},clearSearch:function(){this.found=[];this.setSearchKey("");this.searchLimited=!1;this.tree_structure_version=0;this.selectProvider(this.currentlySelected,!0)},setSearchKey:function(b){this.previousSearchKey=this.searchKey;this.searchKey=b;this.notify("provider search",
b)},getSearchKey:function(){return this.searchKey},eachFound:function(b,c){var d=this;d.found.sort(function(b,c){return d.get(b)&&d.get(c)?d._resourcesComparator(d.get(b),d.get(c)):0});$.each(d.found,function(k,l){d.get(l)&&b.apply(c,[d.get(l)])})},requestUpdate:function(b){this.timeoutUpdate||(this.timeoutUpdate=setTimeout(function(){var c={};c[this.identifier]={tree_identifier:this.identifier};d.app.trigger("global.data.get",{controller:"Provider",method:"updatetree",responseHandler:b,params:{trees:c}});
this.timeoutUpdate=null}.bind(this),100))},requestLoadChildren:function(b){var c=this;this.requestedOpenChildren.push(b);this.timeoutLoadChildren||(this.timeoutLoadChildren=setTimeout(function(){var g={};g[this.identifier]={open_provider:this.requestedOpenChildren,tree_identifier:this.identifier};d.app.trigger("global.data.get",{controller:"Provider",method:"opentree",responseHandler:function(d,g){""===d&&c._cancelOpenTreeNode(b)},errorHandler:function(){c._cancelOpenTreeNode(b)},params:{trees:g}});
this.timeoutLoadChildren=null;this.requestedOpenChildren=[]}.bind(this),100))},addTreeParameters:function(b){b=b||{};b.is_main_tree=!0;this.hasResourceGroups()&&!b.tree_search&&(b.groups_trees_data=this.getResourceGroups().getTreesRequestData());return b},isMainTree:function(){return this.identifier===TOP_PANEL_MAIN_TREE||this.identifier===BOTTOM_PANEL_MAIN_TREE},isGroupTree:function(){return!1},_cancelOpenTreeNode:function(b){set_indicator(1);this.notify("provider closed",b);delete this.wereOpened[b];
delete this.openedResources[b]},requestLoadParents:function(b,c){$.isArray(b)||(b=[b]);if(b.length){var g={};g[this.identifier]={open_to_provider:b,tree_identifier:this.identifier};d.app.trigger("global.data.get",{controller:"Provider",method:"opentree",params:{trees:g},responseHandler:c})}else c&&$.isFunction(c)&&c.apply(this)},requestSearch:function(b){var c={};c[this.identifier]={tree_identifier:this.identifier,tree_search:b,tree_search_start:!0};d.app.trigger("global.data.get",{controller:"Provider",
method:"searchtree",params:{trees:c}})},requestFavorites:function(){var b={};b[this.identifier]={tree_identifier:this.identifier,tree_date:this.getDate()};d.app.trigger("global.data.get",{controller:"Provider",method:"reloadfavorites",params:{tree_favorites:b}})},enableAutoUpdate:function(){this._autoUpdateRequired=!0},disableAutoUpdate:function(){this._autoUpdateRequired=!1},copyState:function(b){this.setSearchKey(b.getSearchKey());this.setDate(b.getDate());this.searchDate=b.searchDate;this.openedResources=
Array.prototype.slice.call(b.openedResources,0);this.found=Array.prototype.slice.call(b.found,0);this.currentlySelected=b.currentlySelected;this.currentlySelectedGroup=b.currentlySelectedGroup;this.treeRoots=b.treeRoots;this.rootResources=Array.prototype.slice.call(b.rootResources,0);this.version=0;this.getResourceFavorites()&&b.getResourceFavorites()&&(this.getResourceFavorites().currentlySelected=b.getResourceFavorites().currentlySelected);this.getResourceGroups()&&b.getResourceGroups()&&this.getResourceGroups().copyState(b.getResourceGroups());
this.filter.copyState(b.filter);this.resources.clear();b.resources.each(function(b){this.resources.add(b.copyState(),b.getId())}.bind(this));this.dynamicResources.clear();b.dynamicResources.each(function(b){this.dynamicResources.add(b.copyState(),b.getId())}.bind(this));this.childrenCache={};for(var c in b.childrenCache)b.childrenCache.hasOwnProperty(c)&&(this.childrenCache[c]=Array.prototype.slice.call(b.childrenCache[c],0));this.notify("changed")},setScrollOffset:function(b){this._scrollOffset.top=
"undefined"!==typeof b.top?b.top:this._scrollOffset.top;this._scrollOffset.left="undefined"!==typeof b.left?b.left:this._scrollOffset.left;this.notify("scroll offset updated")},getScrollOffset:function(){return this._scrollOffset}});d.mixin(d.models.ResourceTree.prototype,d.mixins.EventEmitter)})(toa);(function(d){var c=d.models.ResourceTree;d.models.GroupChildResourceTree=d.define(c,function(){c.apply(this,arguments)},{resourceGroups:!1,resourceFavorites:!1,toString:function(){return"Model GroupChildResourceTree"},setup:function(b){b=b||{};var d=b.treeRoots;b.structure&&b.structure[d]&&(b.structure[d].p&&(b.structure[d].p=0),b.structure[d].l&&(this.treeRootsLevel=b.structure[d].l));c.prototype.setup.apply(this,arguments)},update:function(b){b=b||{};b.favorites=!1;c.prototype.update.apply(this,
arguments)},getResourceFavorites:function(){return!1},getResourceGroups:function(){return!1},unselectResource:function(){this.currentlySelected=0},requestSearch:function(b){},selectProvider:function(b,d){!1!==!!+b.selectedPid&&c.prototype.selectProvider.apply(this,arguments)},addTreeParameters:function(b){b=b||{};b.is_group_tree=!0;b.group_root_pid=this.getRootPid();return b},isMainTree:function(){return!1},isGroupTree:function(){return!0},getRootPid:function(){return this.rootResources[0]||0}});
d.mixin(d.models.GroupChildResourceTree.prototype,d.mixins.EventEmitter)})(toa);(function(d){d.models.ResourceFavorites=d.define(null,function(c,b,e){b=b||{};e=+e||0;this.identifier=c;this.resources=new d.Collection;this.resources.setComparator(d.models.ResourceFavorites.resourceComparator);this._found=new Set;this._foundSearchKey=this._searchKey="";this.setup({favorites:b});this._currentlySelected=this.isFavorite(e)?e:0},{_currentlySelected:0,resources:null,toString:function(){return"Model ResourceFavorites "+this.identifier},setup:function(c){var b;Object.keys(c.favorites).forEach(function(e){if((b=
this.getResource(e))||!this._isResourceStateDelta(c.favorites[e]))if(b)b.update(c.favorites[e]);else try{b=new d.Resource(c.favorites[e]),b.setId(e),this.resources.add(b,e)}catch(g){}}.bind(this));this._foundSearchKey=c.hasOwnProperty("tree_search")?c.tree_search:this._foundSearchKey;this._sync(c);this._found.clear();this.resources.each(function(b){this.getSearchKey()&&this._isResourceMatchSearchKey(b)&&this._found.add(String(b.getId()))}.bind(this))},_sync:function(c){if(c.full_favorites_list){var b=
[],d=c.full_favorites_list.map(function(b){return String(b)});this.resources.each(function(c){-1===d.indexOf(String(c.getId()))&&b.push(c.getId())}.bind(this));b.forEach(function(b){this.resources.remove(b)}.bind(this));c.full_favorites_list.length===this.getCount()||this.timeoutUpdate||(this.timeoutUpdate=setTimeout(function(){this.notify("reloadState");this.timeoutUpdate=null}.bind(this),500))}},clear:function(){this.resources.clear();this._currentlySelected=0},update:function(c,b){"undefined"===
typeof b&&(b=!0);this.setup(c);b&&this.notify("changed");return this},updateCount:function(c){this._sync(c);this.notify("changed");return this},_isResourceStateDelta:function(c){return!c.hasOwnProperty("e")||!c.hasOwnProperty("p")},_isResourceMatchSearchKey:function(c){var b=(c.getName()||"").toLowerCase();c=(c.get("EXTERNAL_ID")||"").toLowerCase();var d=this.getSearchKey().toLowerCase();return-1!==b.indexOf(d)||-1!==c.indexOf(d)},getResource:function(c){return this.resources.get(c)||null},getCurrent:function(){return this.getResource(this._currentlySelected)},
isCurrent:function(c){return!!this._currentlySelected&&this.getCurrent()&&String(c)===String(this.getCurrent().getId())},getCount:function(){return this.resources.getCount()},getFoundCount:function(){return this._found.size},each:function(c,b){this.resources.each(c,b)},eachFound:function(c){this._found.forEach(function(b){this.getResource(b)&&c(this.getResource(b))}.bind(this))},selectProvider:function(c){if(!this.getResource(c))return!1;this._currentlySelected=c;this.notify("provider selected",this._currentlySelected);
return this},isFavorite:function(c){return null!==this.getResource(c)},unselectProvider:function(){this._currentlySelected=0;this.notify("favorite provider unselected")},search:function(c){2>c.length||this._setSearchKey(c)},clearSearch:function(){this._setSearchKey("")},_setSearchKey:function(c){this._searchKey=c;this._foundSearchKey="";this._found=new Set;this.notify("favorite provider search",c)},getSearchKey:function(){return this._searchKey},getFoundSearchKey:function(){return this._foundSearchKey}},
{resourceComparator:function(c,b){return c.entity.n.localeCompare(b.entity.n)}});d.mixin(d.models.ResourceFavorites.prototype,d.mixins.EventEmitter)})(toa);(function(d){var c=d.models.ObservableModel;d.ns("toa.models.ResourceGroupModel",d.define(c,function(b){c.apply(this,arguments);this.treeMap={};this.treeIds=[];this._fillModel(b)},{idField:"gid",treeMap:{},treeIds:[],_expanded:!1,defaultTreeMode:"full",_fillModel:function(b){this.reset({},{silent:!0});this.set(b,{silent:!0})},setExpanded:function(b){!1!==b&&(b=!0);this._expanded=b},isExpanded:function(){return this._expanded},update:function(b){this.reset(b,{silent:!0});this.setupTrees()},getName:function(){return this.get("name",
"")},isEmptyGroup:function(){return 0===this.getRootCount()},getRootCount:function(){return this.get("total",0)},getRootPids:function(){return this.get("roots",[])},getVisibleStructureRootPids:function(){return Object.keys(this.getTreesMap())},isFavorite:function(){return this.get("isFavorite",!1)},getTreesMap:function(){return this.get("trees",{})},getTreeMapByPid:function(b){return this.getTreesMap()[b]||null},getTreeModels:function(){var b,c=[];$.each(this.treeIds,function(d,k){(b=this.getTreeModel(k))&&
c.push(b)}.bind(this));return c},setupTrees:function(){var b,c=this.getVisibleStructureRootPids();$.each(c,function(c,e){(b=this.getTreeModelByPid(e))&&b instanceof d.models.GroupChildResourceTree?this.updateRootTreeModel(b,e):this.initRootTreeModel(e)}.bind(this));this.removeOldTrees()},removeOldTrees:function(){var b=this.getRootPids().map(function(b){return String(b)}),c=Object.keys(this.treeMap);$.each(c,function(c,d){-1===$.inArray(d,b)&&this.removeTreeByPid(d)}.bind(this))},initRootTreeModel:function(b,
c){if("undefined"===typeof c&&(c=this.getTreeStructure(b),$.isEmptyObject(c)))return!1;var g,k=this.getMainTreeModel(),l="group_tree "+k.identifier+" "+this.getId()+" "+b;g={treeDate:k.getDate(),structure:c,treeUpdatesFor:[b],version:k.getVersion(),structChangeTime:k.getStructChangeTime(),treeRoots:b,treeMode:this.defaultTreeMode,tree_structure_version:k.getStructureVersion()};g=new d.models.GroupChildResourceTree(l,g);g.filter=k.filter;this.treeMap[b]=l;this.treeIds.push(l);return g},updateRootTreeModel:function(b,
c){var d=this.getTreeStructure(c);if(!$.isEmptyObject(d)){var k=this.getMainTreeModel(),d={tree_date:k.getDate(),tree_updates:d,tree_version:k.getVersion(),tree_structure_version:k.getStructureVersion(),struct_change_time:k.getStructChangeTime(),tree_roots:[c],tree_updates_for:this.getTreeMapByPid(c),tree_mode:this.defaultTreeMode};k.getSearchKey()&&(d.tree_search=k.getSearchKey());k.getRootsArray().length||(d.reload_tree=1);b.update(d)}},clearSearch:function(){$.each(this.treeIds,function(b,c){this.getTreeModel(c).clearSearch()}.bind(this))},
setSearch:function(b){$.each(this.treeIds,function(c,d){this.getTreeModel(d).search(b)}.bind(this))},getMainTreeId:function(){return this.collection.getMainTreeIdentifier()},getResourcesData:function(){return this.collection.getResourcesDataList()},getResourceData:function(b){return this.getResourcesData()[b]||{}},getTreeStructure:function(b){var c={};b=this.getTreeMapByPid(b);if(!b||!b.length)return{};$.each(b,function(b,d){var l=this.getResourceData(d);l&&!$.isEmptyObject(l)&&(c[d]=l)}.bind(this));
return c},getMainTreeModel:function(){return this.getTreeModel(this.getMainTreeId())},getTreeModel:function(b){return d.app.model("resourceTreeManager")._treeStates[b]||null},getTreeModelByPid:function(b){return this.getTreeModel(this.treeMap[b]||null)},getAllOpenedPids:function(){var b=[],c=this.getOpenedByRoot();Object.keys(c).forEach(function(d){b=b.concat(c[d])}.bind(this));return b=Array.from(new Set(b))},getOpenedByRoot:function(){var b={};$.each(this.treeIds,function(c,d){var k=this.getTreeModel(d);
b[k.getRootPid()]=k.getAllOpened()}.bind(this));return b},remove:function(){this.clear();c.prototype.remove.apply(this,arguments)},removeTreeByPid:function(b){(b=this.treeMap[b]||null)&&this.removeTreeModel(b)},removeTreeModel:function(b){if(b){var c=this.getTreeModel(b);c&&(c=c.getRootPid(),delete d.app.model("resourceTreeManager")._treeStates[b],b=this.treeIds.indexOf(b),this.treeIds.splice(b,1),delete this.treeMap[c])}},clearTrees:function(){$.each(this.treeIds,function(b,c){this.removeTreeModel(c)}.bind(this))},
clear:function(){this.clearTrees()},copyState:function(b){this.setExpanded(b.isExpanded());this.copyTrees(b.getTreeModels())},copyTrees:function(b){$.each(b,function(b,c){this.copyRootTreeModel(c)}.bind(this))},copyRootTreeModel:function(b){var c=b.getRootPid(),d={},k=b.getResource(c);k&&k.sandbox&&(d[c]=k.sandbox,(c=this.initRootTreeModel(c,d))&&c.copyState(b))},subscribeOnChild:function(b){b.addListener("all",function(){this.notify.apply(this,arguments)},this)},toJSON:function(){var b=c.prototype.toJSON.apply(this,
arguments);this.idField in this.attributes||delete b[this.idField];return b}}))})(toa);(function(d){var c=d.models.ObservableCollection;d.ns("toa.models.ResourceGroupsCollection",d.define(c,function(b,d,g){c.apply(this,arguments);g=g||{};this.setResources();d=d||[];d.length&&this._fillCollection(d);this._mainTreeIdentifier=b},{modelConstructor:d.models.ResourceGroupModel,_resourcesDataList:{},_mainTreeIdentifier:"",setResources:function(b){this._resourcesDataList=b=b||{}},setGroups:function(b){this._fillCollection(b)},_fillCollection:function(b){this.clear({silent:!0});$.each(b,function(b,
c){this.add(c,{silent:!0})}.bind(this))},add:function(b,d){c.prototype.add.apply(this,arguments);var g=this.get(b.gid);d&&d.copyState||g.setupTrees()},addCopyState:function(b){this.add(b.toJSON(),{copyState:!0});this.get(b.getId()).copyState(b)},comparator:function(b,c){return b.getName().localeCompare(c.getName())},getNames:function(){return this.pluck("name")},getIds:function(){return this.pluck("gid")},getResourcesDataList:function(){return this._resourcesDataList},getMainTreeIdentifier:function(){return this._mainTreeIdentifier}}))})(toa);(function(d){d.models.ResourceGroups=d.define(null,function(c,b,d){b=b||{};d=d||{};this.selection=$.extend({},{groupId:0,rootPid:0,selectedPid:0},d);this.mainTreeIdentifier=c;this._found=new Set;this._foundSearchKey=this._searchKey="";this._isNewSearch=!1;c=b.groups_list||{};this._fullGroupsList=Object.keys(c);this.setup({resource_groups:{groups_list:c,groups_resources:b.groups_resources||{}}});this._currentlySelectedGroup=this._currentlySelected=0},{_currentlySelected:0,_currentlySelectedGroup:0,
groups:null,groupsResources:{},_fullGroupsList:[],reloadGroups:!1,toString:function(){return"Model ResourceGroups "+this.mainTreeIdentifier},getResources:function(){return this.groupsResources},getGroups:function(){return this.groups},setGroups:function(c){c=c||{};this.groups&&this.groups instanceof d.models.ResourceGroupsCollection||(this.groups=new d.models.ResourceGroupsCollection(this.mainTreeIdentifier));this.groups.setResources(this.getResources());var b;Object.keys(c).forEach(function(e){if((b=
this.getResourceGroup(e))&&b instanceof d.models.ResourceGroupModel)this.reloadGroups||c[e].name===b.getName()||(this.reloadGroups=!0),b.update(c[e]);else try{this.groups.add(c[e])}catch(k){}}.bind(this));if(this.selection.groupId&&this.selection.selectedPid){var e=this.getResourceGroup(this.selection.groupId);e&&e.setExpanded(!0)}this.sync();this._found.clear();this.getSearchKey()&&Object.keys(c).length&&this.groups.each(function(b){b=String(b.getId());c[b]&&this._found.add(b)}.bind(this))},setup:function(c){c=
c||{};this._fullGroupsList=c.hasOwnProperty("full_resource_groups_list")?c.full_resource_groups_list:this._fullGroupsList;this._foundSearchKey=c.hasOwnProperty("tree_search")?c.tree_search:this._foundSearchKey;var b=c.resource_groups||{};this.groupsResources=b.groups_resources||{};this.setGroups(b.groups_list||{});this._isNewSearch=c.hasOwnProperty("tree_search_start")},sync:function(){var c=this.groups.getIds();$.each(c,function(b,c){-1===$.inArray(c,this._fullGroupsList)&&this.groups.get(c).remove()}.bind(this));
this.groups.sort()},clear:function(){this.groups.clear();this.clearSelection()},update:function(c,b){"undefined"===typeof b&&(b=!0);this.reloadGroups=b;this.setup(c);this.reloadGroups&&this.notify("changed");return this},getResourceGroup:function(c){return this.groups.get(c)||null},getTreesRequestData:function(){var c={groups:this.groups.getIds(),structure:{}};this.groups.each(function(b){var d=b.getId();c.structure[d]={opened:b.getOpenedByRoot(),roots:b.getRootPids()}}.bind(this));return c},getGroupIdAfterDelete:function(){var c=
!1,b=!1,d=!1;this.groups.each(function(g){if(c)return b=g.getId(),!1;g.getId()!=this.selection.groupId?d=g.getId():c=!0}.bind(this));return b||d},getCurrent:function(){return this.getResourceGroup(this._currentlySelectedGroup)},getCurrentGroupId:function(){return this._currentlySelectedGroup},getCurrentSelection:function(){return this.selection},isCurrent:function(c){return!!this._currentlySelectedGroup&&this.getCurrent()&&String(c)===String(this.getCurrent().getId())},getCount:function(){return this.groups.getCount()},
each:function(c,b){this.groups.each(c,b)},selectGroup:function(c){this._currentlySelectedGroup=c;this._currentlySelected=0;this.selection={groupId:c||0,rootPid:0,selectedPid:0};c&&this.notify("group selected",c)},selectGroupResource:function(c){this._currentlySelectedGroup=0;this._currentlySelected=c.selectedPid;this.selection=c;c.selectedPid&&this.notify("resource selected",c)},unselectGroup:function(){this._currentlySelectedGroup=0;this.notify("group unselected")},unselectGroupResource:function(){this._currentlySelected=
0;this.groups.each(function(c){$.each(c.getTreeModels(),function(b,c){c.unselectResource()}.bind(this))}.bind(this));this.notify("resource unselected")},clearSelection:function(){this.unselectGroup();this.unselectGroupResource();this.selection={groupId:0,rootPid:0,selectedPid:0}},getFoundCount:function(){return this._found.size},eachFound:function(c){this._found.forEach(function(b){this.getResourceGroup(b)&&c(this.getResourceGroup(b))}.bind(this))},search:function(c){2>c.length||(this._setSearchKey(c),
this.groups.each(function(b){b.setSearch(c)}.bind(this)))},clearSearch:function(){this._setSearchKey("");this.groups.each(function(c){c.clearSearch()}.bind(this))},_setSearchKey:function(c){this._searchKey=c;this._foundSearchKey="";this._found=new Set;this.notify("groups search",c)},isSearch:function(){return""!==this.getSearchKey()},isNewSearch:function(){return this.isSearch()&&this._isNewSearch},getSearchKey:function(){return this._searchKey},getFoundSearchKey:function(){return this._foundSearchKey},
copyState:function(c){this.clear();this.currentlySelected=c.currentlySelected;this.currentlySelectedGroup=c.currentlySelectedGroup;this.selection=c.selection;this.groupsResources=c.getResources();this._fullGroupsList=c._fullGroupsList;this.reloadGroups=!0;this.groups.setResources(this.getResources());this._searchKey=c.getSearchKey();this._foundSearchKey=c._foundSearchKey;this._found=c._found;this._isNewSearch=c._isNewSearch;c.each(function(b){this.groups.addCopyState(b)}.bind(this));this.notify("changed")}});
d.mixin(d.models.ResourceGroups.prototype,d.mixins.EventEmitter)})(toa);toa.ns("toa.models.RouteService",function(){return toa.define(null,function(d){this.sandbox=d;this._ajaxOptions={get:{type:"GET",async:!0,params:{}}};return this},{moveActivity:function(d,c){var b,e=$.extend(!0,{},this._ajaxOptions.get);return b=new Promise(function(g,k){e.url="?"+d.join("&");e.params=$.extend(!0,{packVars:!0},c||{});e.responseHandler=this._onGetSuccess.bind(b,g);e.errorHandler=this._onGetError.bind(b,k);toa.app.trigger("global.data.get",e)}.bind(this))},_onGetSuccess:function(d,
c,b){d.call(this,b)},_onGetError:function(d,c,b){d.call(this,{errorThrown:b,textStatus:c})}},{})}());toa.toJson=function(d,c){var b="",e;if(1<arguments.length&&!0===c){for(e in d)d.hasOwnProperty(e)&&(b+=toa._printType(d[e])+",");return b.substr(0,b.length-1)}if("object"===typeof d){if($.isArray(d)){for(e in d)d.hasOwnProperty(e)&&(b+=toa._printType(d[e])+",");return 1<arguments.length?b.substr(0,b.length-1):"["+b.substr(0,b.length-1)+"]"}if(null===d)return"null";if(d.hasOwnProperty)for(e in d)d.hasOwnProperty(e)&&(b+='"'+e+'":'+toa._printType(d[e])+",");return 1<arguments.length?b.substr(0,b.length-
1):"{"+b.substr(0,b.length-1)+"}"}return b+=toa._printType(d)};toa._printType=function(d){switch(typeof d){case "number":return d;case "string":return'"'+d.replace(/(["\\])/g,"\\$1")+'"';case "object":return $.isArray(d)?"["+toa.toJson(d,!0)+"]":null===d?"null":"{"+toa.toJson(d,!1)+"}";case "boolean":return d?"true":"false";case "undefined":return"undefined";default:return d}};(function(d){d.widgets.MultiselectFieldDialog=d.define(null,function(){this.options={input:null,dialogTarget:null,lookup:{},title:"Edit",format:null,baseWidget:"checkboxtable"};this.input=this.dialog=this.widget=null;this.values={};this._create.apply(this,arguments)},{_create:function(c){this.setOptions(c);this.values=[];this.input=this.options.input;this.options.baseWidget=c.baseWidget||"checkboxtable";c=this.options.removeButton||!1;this.input.length&&(this.values=this.getValues(this.input),c&&
this._removeWidgetButton(),this.isReadOnly(this.input)?this.input.parent().addClass("ro").removeAttr("style").append("<span>"+d.toHtml(this.format(this.values))+"<span>"):(this.input.parent().removeClass("ro"),this.initWidget(this.input.parent()),this.initDialog(this.options.dialogTarget)))},_removeWidgetButton:function(){this.input.parent().find("div").remove();this.input.parent().find("span").remove()},isReadOnly:function(c){c=c.attr("data-access");return"1"!=c&&"2"!=c},setOptions:function(c){$.extend(this.options,
c)},getValues:function(c){return c.val()&&$.parseJSON(c.val())},initWidget:function(c){c.css({maxWidth:"300px",border:"1px solid #eee"});this.widget=d.formBuilder({xtype:"popupLabel",buttonText:this.options.title,value:this.format(this.values),listeners:{popup:this.openDialog.bind(this)}});this.widget.renderTo(c)},format:function(c){if($.isFunction(this.options.format))return this.options.format.apply(this,[c,this.options.lookup]);var b=[],d;for(d in c)"undefined"!==typeof this.options.lookup[d]&&
b.push(this.options.lookup[d]);b.sort();return b.join(", ")},initDialog:function(c){var b={xtype:"dialog",title:this.options.title,layout:"vbox",listeners:{ok:this.onSave.bind(this)},items:[{xtype:"hidden",name:"id"},{xtype:"checkboxtableBase",name:"checkboxtable"}]};this.editDialog=d.formBuilder(b);this.editDialog.renderTo(c)},openDialog:function(){this.editDialog.reset();this.editDialog.find(this.options.baseWidget).setItemsList(this.options.lookup).setValue(this.values);this.editDialog.open()},
onSave:function(){this.values=this.editDialog.find(this.options.baseWidget).getValue();this.widget.setValue(this.format(this.values));this.input.val(d.toJson(this.values));this.input.parent().css("borderColor","#bed");this.editDialog.close()},destroy:function(){this.values=this.input=this.dialog=null;this.editDialog.reset();this.editDialog.destroy();this.editDialog=null;this.widget.destroy();this.widget=null}})})(toa);toa.ns("toa.models.quota.Coordinate",function(){var d=toa.define(null,function(c){this.bucket=c.bucket||0;this.day=c.day||"";this.timeSlot=c.timeSlot||0;this.category=c.category||0;this.workzone=c.workzone||0;this.field=c.field||""},{LEVEL_NAMES:" bucket day timeSlot category workzone".split(" "),TOTAL:"-1",clone:function(c){var b=new d(this);toa.isObject(c)&&$.extend(b,c);return b},getParent:function(){var c=new d(this);c.workzone?c.workzone=null:c.category?c.category=null:c.timeSlot?c.timeSlot=
null:c.day&&(c.day=null);return c},getChild:function(c){var b=new d(this);if(this.workzone)throw"Quota coord.getChild: cant make child for workzone level";this.category?b.workzone=c:this.timeSlot?b.category=c:this.day?b.timeSlot=c:this.bucket&&(b.day=c);return b},toArray:function(){return[this.bucket,this.day,this.timeSlot,this.category,this.workzone]},getTotal:function(){var c=this.getLevelName(),b=this.clone();b[c]=this.TOTAL;return b},isTotal:function(){return this[this.getLevelName()].toString()===
this.TOTAL},getLevel:function(){return this.workzone?5:this.category?4:this.timeSlot?3:this.day?2:this.bucket?1:0},getLevelName:function(){return this.LEVEL_NAMES[this.getLevel()]},getId:function(){return this[this.getLevelName()]+""||null},setId:function(c){this[this.getLevelName()]=c+""}});return d}());toa.ns("toa.models.quota.BucketSettings",function(){return toa.define(null,function(d){this.settings=d||{available_capacity_flags:0,category_quota_flags:0,close_quota_flags:0,day_quota_flags:0,historical_data_period:"",max_capacity_flags:0,quota_flags:0,time_slot_quota_flags:0}},{isQuotaCloseAllowed:function(d){d=d.getLevelName();var c=!1;if("day"==d||"timeSlot"==d||"category"==d)c=!0;return c},isWorkzonesCloseAllowed:function(){return!!(this.settings.close_quota_flags&8)},isQuotaDefinedInMinutes:function(d){return!(this.getLevelFlags(d)&
1)},isQuotaDefinedInPercent:function(d){return this.getLevelFlags(d)&1},isQuotaDefinedInTopPercent:function(d){return"day"===d.getLevelName()?!1:this.getLevelFlags(d)&2},isExcludeOtherActivities:function(d){return"day"===d.getLevelName()?this.getLevelFlags(d)&4:this.getLevelFlags(d)&8},isNormalizePercents:function(d){return"timeSlot"===d.getLevelName()?this.getLevelFlags(d)&32:"category"===d.getLevelName()?this.getLevelFlags(d)&64:!1},getLevelFlags:function(d){var c=0;switch(d.getLevelName()){case "day":c=
this.settings.day_quota_flags;break;case "timeSlot":c=this.settings.time_slot_quota_flags;break;case "category":c=this.settings.category_quota_flags}return c}})}());toa.ns("toa.models.quota.Calculator",function(){return toa.define(null,function(d,c){this.model=d;this.uom=c;this.settings=null;this.precisionPercent=2;this.lockUpdate=!1},{calculate:function(d,c,b){this.isFiledUserChangeable(c)&&!this.isTransactionStarted()&&(this.startTransaction(),this.loadBucketSettings(d),"min_quota"===c&&this.updateMinQuota(d),"quota_percent"===c&&this.settings.isNormalizePercents(d)&&this.redistributeQuotaPercentsBetweenSublings(d,b),this.updateAll(d,b),this.stopTransaction())},
calculateOnMassPopulate:function(d,c){this.isFiledUserChangeable(c)&&!this.isTransactionStarted()&&(this.startTransaction(),this.loadBucketSettings(d),"min_quota"===c&&this.updateMinQuota(d),"quota_percent"===c&&this.settings.isNormalizePercents(d)&&this.normalizeQuotaPercents(d),this.updateAll(d,0),this.stopTransaction())},updateAll:function(d,c){this.updateQuota(d,c);this.updateQuotaPercent(d);this.updateUsedQuotaPercent(d)},updateMinQuota:function(d){var c=this.model.get(d,"min_quota",0),c=this.uom.toPrecision(c);
this.model.set(d,"min_quota",c)},updateUsedQuotaPercent:function(d){var c=this.model.get(d,"used",0),b=this.model.get(d,"quota",0),e=0;b&&(e=this.toPercentPrecision(c/b*100));this.model.set(d,"used_quota_percent",e)},updateQuotaPercent:function(d){if(!this.settings.isQuotaDefinedInPercent(d)&&!this.settings.isQuotaDefinedInTopPercent(d)){var c=this.model.get(d.getTotal(),"quota",0),b=this.model.get(d,"quota",0),e=0;c&&(e=this.toPercentPrecision(b/c*100));this.model.set(d,"quota_percent",e)}},updateQuota:function(d,
c){var b=this.model.get(d,"quota",0);if(this.settings.isQuotaDefinedInPercent(d)){b=this.model.get(d,"max_available",0);if(this.settings.isExcludeOtherActivities(d)){var e=this.model.get(d,"other_activities",0),b=b-e;0>b&&(b=0)}e=this.model.get(d,"quota_percent",0);b=this.ensureMinQuota(d,e/100*b);b=this.uom.toPrecision(b);this.model.set(d,"quota",b)}else this.settings.isQuotaDefinedInTopPercent(d)?(b=this.model.get(d.getParent(),"quota",0),e=this.model.get(d,"quota_percent",0),b=this.ensureMinQuota(d,
e/100*b),b=this.uom.toPrecision(b),this.model.set(d,"quota",b)):(b=this.uom.toPrecision(b),this.model.set(d,"quota",b),d.isTotal()?this.redistributeTotalQuota(d,b,c):this.isTotalLocked(d)&&this.redistributeQuotaBetweenSublings(d,b,c));this.updateChildrenQuota(d)},ensureMinQuota:function(d,c){var b=this.model.get(d,"min_quota",0);c<b&&(c=b);return c},redistributeQuotaBetweenSublings:function(d,c,b){var e=this.getUnlockedQuotas(d);e.list.length?(c-=b,e.summ<c&&(c=e.summ,this.model.set(d,"quota",b+c)),
this.redistributeQuota(d,e,-c)):this.model.set(d,"quota",b)},redistributeTotalQuota:function(d,c,b){var e=this.getUnlockedQuotas(d);e.list.length?(c-=b,e.summ<-c&&(c=-e.summ,this.model.set(d,"quota",b+c)),this.redistributeQuota(d,e,c)):this.model.set(d,"quota",b)},normalizeQuotaPercents:function(d){var c=0,b=0,e=0,g=0,k=[];this.eachSibling(d,function(d){var g=+this.model.get(d,"quota_percent",0);this.model.isLocked(d)?c+=g:(e+=g,b++,k.push({id:d.getId(),value:g}))});if(100!=c+e&&0!==b&&e){d=d.clone();
var l=100-c;0>l&&(l=0);for(var n=0;n<k.length;n++){var p=k[n],s=p.value/e*l,s=this.toPercentPrecision(s),g=g+s;if(n==k.length-1){var t=100-c-g;0!=t&&(s+=t)}d.setId(p.id);this.model.set(d,"quota_percent",s);this.updateQuota(d);this.updateUsedQuotaPercent(d)}}},redistributeQuotaPercentsBetweenSublings:function(d,c){if(100<this.model.get(d,"quota_percent",0))this.model.set(d,"quota_percent",c);else{var b=d.getId(),e=0,g=0,k=0,l=0,n=[],p=this;this.eachSibling(d,function(c){if(0===c.category||!p.model.categoryLookup||
"undefined"!==typeof p.model.categoryLookup[c.getId()]){var d=+this.model.get(c,"quota_percent",0);e+=d;c.getId()===b||this.model.isLocked(c)?l+=d:(k+=d,g++,n.push({id:c.getId(),value:d}))}});if(100!==e)if(0===g)this.model.set(d,"quota_percent",c);else{if(!k)var s=1/n.length;var t=d.clone(),u=100-e;if(0>u&&k<-u)this.model.set(d,"quota_percent",c);else for(var v=0;v<n.length;v++){var w=n[v],x=w.value+u*(s||w.value/k),x=this.toPercentPrecision(x),l=l+x;if(v==n.length-1){var y=100-l;0!=y&&(x+=y)}t.setId(w.id);
this.model.set(t,"quota_percent",x);this.updateQuota(t);this.updateUsedQuotaPercent(t)}}}},updateChildrenQuota:function(d){"workzone"!==d.getLevelName()&&(d=d.getChild(-9999),this.eachSibling(d,function(c){if("workzone"!==c.getLevelName()){var b=this.model.get(c,"quota",0);this.updateAll(c,b)}}))},setQuotaFromTotal:function(d){var c=this.getQuotaSum(d),c=this.model.get(d,"quota",0)-c,b=this.getUnlockedQuotas(d);this.redistributeQuota(d,b,c)},redistributeQuota:function(d,c,b){var e=c.summ||0;c=c.list||
[];if(!e)var g=1/c.length;d=d.clone();for(var k=0;k<c.length;k++){var l=c[k],n=this.uom.toPrecision(l.value+b*(g||l.value/e));d.setId(l.id);this.model.set(d,"quota",n);this.updateQuotaPercent(d);this.updateUsedQuotaPercent(d)}},getUnlockedQuotas:function(d){var c=d.getId(),b=0,e=[];this.eachSibling(d,function(d){if(d.getId()!==c&&!this.model.isLocked(d)){var k=this.model.get(d,"quota",0);b+=k;e.push({id:d.getId(),value:k})}});return{list:e,summ:b}},getQuotaSum:function(d){var c=0;this.eachSibling(d,
function(b){b=this.model.get(b,"quota",0);c+=b});return c},toPercentPrecision:function(d){var c=Math.pow(10,this.precisionPercent);return d=Math.round(d*c)/c},loadBucketSettings:function(d){this.settings=this.model.getBucketSettings(d)},eachSibling:function(d,c){var b=this.model.getChildren(d.getParent()),e=d.clone(),g;for(g in b)e.setId(g),e.isTotal()||c.apply(this,[e])},isFiledUserChangeable:function(d){return d in{quota_percent:1,quota:1,min_quota:1}},isTotalLocked:function(d){return this.model.isLocked(d.getTotal())},
isTransactionStarted:function(){return this.lockUpdate},startTransaction:function(){this.lockUpdate=!0},stopTransaction:function(){this.lockUpdate=!1}})}());toa.ns("toa.models.quota.DataStorage",function(){function d(b,c){for(var d,e,g=0;e=c.shift();){if(!(b instanceof Object))return null;d=b[e];if(!(d instanceof Object))return null;b=d[p[g]];g++}return d}var c=toa.models.quota.Coordinate,b=toa.models.quota.BucketSettings,e=toa.define(null,function(b){this.currentArea={};this.uom=b;this.unitRatio=1;this.MASK_TO_FIELDS=s;this.FIELDS_TO_MASK=l;this.STATUS=n;this.COLLECTIONS=k},{load:function(b){if(!b||!b.buckets||!b.filter)throw"No buckets in responce found";
this.init(b);this.setFieldLookup(b.filter.fields);this.setDaysFields(b.days);this.setTimeSlotLookup(b.filter.timeslots);this.setCategoryLookup(b.filter.categories);this.setBuckets(b.buckets);this.setMassPopulateOptions(b.massPopulateFields);this.setAutoPopulateData(b.autoPopulateData);this.setAccess(b.access)},init:function(){this.buckets={};this.bucketIdList=[];this.categoryIdList={};this.fieldLookup={};this.timeSlotLookup={};this.categoryLookup={};this.fieldsList={};this.workzoneDelta=[];this.delta=
{};this.deltaChangeCounter=0;this.daysFields={};this.quotaCategories=[];this.quotaTimeslots=[];this.massPopulateOptions=[];this.autoPopulateData=[];this.access=0},setCurrentArea:function(b){this.currentArea=b},getCurrentArea:function(){return this.currentArea},setBuckets:function(b){for(var c in b)b.hasOwnProperty(c)&&this.addBucket(b[c].bucket_id,b[c])},addBucket:function(d,e){this.recalculateMinutesToUnits(e);this.buckets[d]=e;this.bucketIdList.push(d);e.settings=new b(e.info);var g=new c({bucket:d});
this.addDates(e,g)},addDates:function(b,c){var d=b[this.COLLECTIONS[0]]||{};b.ids=b.ids||[];for(var e in d){var g=d[e];b.ids.push(e);this.recalculateMinutesToUnits(g);c.day=e;this.addTimeSlots(g,c)}b.ids.sort()},addTimeSlots:function(b,c){var d=b[this.COLLECTIONS[1]]||{};b.ids=b.ids||[];for(var e in d){var g=d[e];-1===this.quotaTimeslots.indexOf(e)&&this.quotaTimeslots.push(e);b.ids.push(e);this.recalculateMinutesToUnits(g);c.timeSlot=e;this.addCategories(g,c)}b.ids.sort()},addCategories:function(b,
c){var d=b[this.COLLECTIONS[2]]||{};b.ids=b.ids||[];for(var e in d){var g=d[e];-1===this.quotaCategories.indexOf(e)&&this.quotaCategories.push(e);b.ids.push(e);this.recalculateMinutesToUnits(g);c.category=e;this.addWorkZones(g,c)}b.ids.sort()},addWorkZones:function(b,c){var d=b[this.COLLECTIONS[3]]||{};b.ids=b.ids||[];var e=!1,g;for(g in d){var k=d[g];b.ids.push(g);!e&&b.status&this.STATUS.CLOSED&&k.status==this.STATUS.OPEN&&(e=!0)}e&&this.fixCategoryStatus(b,c);b.ids.sort()},getQuotaCategories:function(){return this.quotaCategories},
getQuotaTimeslots:function(){return this.quotaTimeslots},fixCategoryStatus:function(b,c){b.status_fixed=b.status;1!==b.status&&(b.status|=this.STATUS.OPEN,b.status&=~this.STATUS.CLOSED);b.ids=[];var d=this.getDayWorkzones(c),e;for(e in d){var g=d[e].id;b.ids.push(g);b.workzones[g]||(b.workzones[g]={});b.workzones[g].status||(b.workzones[g].status=this.STATUS.CLOSED)}b.ids.sort()},getBucketSettings:function(b){b=new c({bucket:b.bucket});return this.get(b,"settings")},getFirstBucketId:function(b){b=
b.clone();var c=this.bucketIdList[0]||0;b.bucket=c;b.timeSlot=this.getFirstTimeSlotId(b);b.category=0;return c&&d(this.buckets,b.toArray())?c:this.getNextBucketById(b,c)},getNextBucketById:function(b,c){for(var e=b.clone(),g=!1,k=0,l=1;l<this.bucketIdList.length;l++)if(this.bucketIdList[l-1]==c||g)if(g=!0,k=this.bucketIdList[l],e.timeSlot=this.getFirstTimeSlotId(e),e.category=0,d(this.buckets,e.toArray()))return k;return 0},getFirstDateId:function(b){b=b.clone();return this.buckets[b.bucket].ids[0]||
""},getNextDateId:function(b,c){for(var d=b.clone(),d=this.buckets[d.bucket].ids,e=1;e<d.length;e++)if(d[e-1]==c)return d[e];return""},get:function(b,c,d){var e=this.getDelta(b,c);return null!==e?e:this.getOld(b,c,d)},set:function(b,c,d){var e=this.getDelta(b,c,null);if(null!==e&&e==d)return!1;var g=this.getOld(b,c,null),e=null!==e?e:g;if(g==d)return this.removeDelta(b,c,e),!1;this.setDelta(b,c,d,e);return!0},getOld:function(b,e,g){b=new c(b);b=d(this.buckets,b.toArray());return null===b||void 0===
b[e]?void 0!==g?g:null:this.convertMinutesToUnits(e,b[e])},getChildren:function(b){var c=b.getLevel()-1;return this.getOld(b,this.COLLECTIONS[c]||"",{})},getBuckets:function(){return this.bucketIdList||[]},setTimeSlotLookup:function(b){if(b){this.timeSlotList=b;for(var c=0;c<b.length;c++)this.timeSlotLookup[b[c].id]=b[c].name}},getAllTimeSlots:function(){return this.timeSlotList||[]},getTimeSlotName:function(b){return this.timeSlotLookup[b]||""},getFirstTimeSlotId:function(b){b=b.clone();var c=this.timeSlotList[0].id||
0;b.timeSlot=c;b.category=0;return c&&d(this.buckets,b.toArray())?c:this.getNextTimeSlotById(b,c)},getNextTimeSlotById:function(b,c){for(var e=b.clone(),g=!1,k=0,l=1;l<this.timeSlotList.length;l++)if(this.timeSlotList[l-1].id==c||g)if(g=!0,k=this.timeSlotList[l].id,e.timeSlot=k,e.category=0,d(this.buckets,e.toArray()))return k;return 0},setCategoryLookup:function(b){if(b){this.categoryList=b;for(var c=0;c<b.length;c++)this.categoryLookup[b[c].id]=b[c].name}},getAllCategories:function(){return this.categoryList||
[]},getCategoryName:function(b){return this.categoryLookup[b]||""},getTimeslotName:function(b){return this.timeSlotLookup[b]||""},getFirstCategoryId:function(b){b=b.clone();var c=this.categoryList[0].id||0;return(b.category=c)&&d(this.buckets,b.toArray())?c:this.getNextCategoryById(b,c)},getNextCategoryById:function(b,c){for(var e=b.clone(),g=!1,k=0,l=1;l<this.categoryList.length;l++)if(this.categoryList[l-1].id==c||g)if(g=!0,k=this.categoryList[l].id,e.category=k,d(this.buckets,e.toArray()))return k;
return 0},getWorkzoneStatus:function(b){var c=this.getDelta(b,"status");if(c||(c=this.get(b,"status")))return c;b=b.clone({workzone:null});return(b=this.get(b,"status"))?b:this.STATUS.OPEN},setWorkzonesStatus:function(b,c,d){b=b.clone({workzone:null});var e=0,g=0,k=this.getOld(b,"status",this.STATUS.OPEN),l=k&this.STATUS.CLOSED?this.STATUS.CLOSED:this.STATUS.OPEN,n=this.get(b,"status",0)&this.STATUS.READONLY;if(c)e=c;else{for(var p in d)var s=d[p],e=e+ +s,g=g+ +!s;if(!e&&!g)return;e=!e&&g?this.STATUS.CLOSED:
this.STATUS.OPEN}l!=e?this.setDelta(b,"status",this.setLockedStatusBitInMask(e,n),k):(l=this.getDelta(b,"status",0))&&((k&this.STATUS.READONLY)!=(l&this.STATUS.READONLY)?this.setDelta(b,"status",this.setLockedStatusBitInMask(e,n),k):this.removeDelta(b,"status"));for(p in d)b.workzone=p,k=d[p]?this.STATUS.OPEN:this.STATUS.CLOSED,c&&(k=this.STATUS.DEFAULT),this.setWorkzoneStatus(b,k)},setLockedStatusBitInMask:function(b,c){return c?b|this.STATUS.READONLY:b&~this.STATUS.READONLY},setWorkzoneStatus:function(b,
c){var d=b.clone({workzone:null}),d=this.getDelta(d,"status",null),e=this.getOld(b,"status"),g=e&this.STATUS.CLOSED?this.STATUS.CLOSED:this.STATUS.OPEN;e&this.STATUS.CLOSED_ON_TOP_LEVEL&&e&0!==this.STATUS.OPEN&&(g=this.STATUS.CLOSED);c===this.STATUS.OPEN&&(c=this.STATUS.DEFAULT);c===this.STATUS.CLOSED&&g===this.STATUS.OPEN||c===this.STATUS.DEFAULT&&g===this.STATUS.CLOSED&&!(e&this.STATUS.CLOSED_ON_TOP_LEVEL)||c===this.STATUS.DEFAULT&&g===this.STATUS.OPEN&&d||c===this.STATUS.CLOSED&&g===this.STATUS.CLOSED&&
d?this.setDelta(b,"status",c,g):this.removeDelta(b,"status")},getAllWorkzones:function(b){return this.get(new c({bucket:b}),"workzones",[])},getDayWorkzones:function(b){var c=this.getAllWorkzones(b.bucket);b=b.day;for(var d=[],e=[],g=0;g<c.length;g++){var k=c[g];toa.isDefined(k.startdate)&&k.startdate>b||toa.isDefined(k.enddate)&&k.enddate<b||-1<$.inArray(c[g].id,e)||(d.push(c[g]),e.push(c[g].id))}return d},setDeltaWorkzoneCloseTime:function(b,c){var d=0,e="";c&&(d=c.substr(0,c.indexOf(" "))+" 12:00:00",
d=toa.date.getDatesOffset(d,b.day),e=c.split(" ",2)[1]);this.workzoneDelta.push({bucket_id:+b.bucket,time_slot_id:b.timeSlot,category_id:+b.category,work_zone_id:+b.workzone,close_time:e,day_offset:d})},removeDeltaWorkzoneCloseTime:function(b){for(var c=0;c<this.workzoneDelta.length;c++){var d=this.workzoneDelta[c];if(d.bucket_id===b.bucket&&d.time_slot_id===b.timeSlot&&d.category_id===b.category&&d.work_zone_id===b.workzone)return this.workzoneDelta.splice(c,1),!0}return!1},getDeltaCloseTime:function(){return this.workzoneDelta},
isStatusBitSet:function(b,c){return(this.get(b,"status",0)&c)===c},isLocked:function(b){return this.isStatusBitSet(b,this.STATUS.READONLY)},setStatusBit:function(b,c,d){var e=this.getWorkzoneStatus(b);d?this.set(b,"status",e|c):this.set(b,"status",e&~c)},setLockedStatusBit:function(b,c){var d=this.get(b,"status");(d&this.STATUS.READONLY)!=(c&this.STATUS.READONLY)&&(c?this.set(b,"status",d|this.STATUS.READONLY):this.set(b,"status",d&~this.STATUS.READONLY))},recalculateMinutesToUnits:function(b){if(1!==
this.unitRatio)for(var c=0;c<g.length;c++){var d=g[c],e=b[d];e&&(b[d]=this.uom.minutesToUnits(e))}},convertUnitsToMinutes:function(b,c){return c&&this.isCalculatedField(b)?this.uom.unitsToMinutes(c):c},convertMinutesToUnits:function(b,c){return c&&this.isCalculatedField(b)?this.uom.minutesToUnits(c):c},isCalculatedField:function(b){return toa.isDefined(t[b])},setDaysFields:function(b){this.daysFields=b||{}},getDaysFields:function(b){return this.daysFields[b]||0},setFieldLookup:function(b){this.fieldsList=
b;for(var c=0;c<b.length;c++)this.fieldLookup[b[c].mask]=b[c].name},getFieldNameById:function(b){return this.fieldLookup[b]||""},getFieldNameByLabel:function(b){b=this.getFieldIdByLabel(b);return this.getFieldNameById(b)},getAllFields:function(){return this.fieldsList},maskToFields:function(b){for(var c=[],d=0;d<this.fieldsList.length;d++)b&this.fieldsList[d].mask&&c.push(this.fieldsList[d].mask);return c},maskToFieldsLabels:function(b){for(var c=[],d=0;d<this.fieldsList.length;d++)b&this.fieldsList[d].mask&&
c.push(this.getFieldLabelById(this.fieldsList[d].mask));return c},getFieldLabelById:function(b){return this.MASK_TO_FIELDS[b]||""},getFieldIdByLabel:function(b){return this.FIELDS_TO_MASK[b]||0},setMassPopulateOptions:function(b){this.massPopulateOptions=b},getMassPopulateOptions:function(){return this.massPopulateOptions},isMassPopulateOptionsSet:function(){return this.massPopulateOptions&&!!this.massPopulateOptions.length},setAutoPopulateData:function(b){if(b&&b.length){for(var c={},d=0;d<b.length;d++){var e=
b[d].field,g=b[d].level,k=b[d].time_slot_id||0,l=b[d].category_id||0;c[e]||(c[e]={});c[e][g]||(c[e][g]={});c[e][g][k]||(c[e][g][k]={});c[e][g][k][l]||(c[e][g][k][l]={});c[e][g][k][l]=b[d]}this.autoPopulateData=c}},setAutoPopulateSchedule:function(b){},getAutoPopulateData:function(b,c,d,e){var g="category";d||(g="time_slot",c||(g="day"));return this.autoPopulateData[b]&&this.autoPopulateData[b][g]&&this.autoPopulateData[b][g][c]&&this.autoPopulateData[b][g][c][d]?e?this.autoPopulateData[b][g][c][d][e]:
this.autoPopulateData[b][g][c][d]:!1},setDelta:function(b,c,d,e){var g;g=this.delta;for(var k=b.toArray(),l,n,s=0;n=k.shift();){void 0===g[n]&&(g[n]={});l=g[n];if(!(l instanceof Object))throw"forcePath fail. value of key is not an object key :"+n;n=p[s];s++;if(n&&(void 0===l[n]&&(l[n]={}),g=l[n],!(g instanceof Object)))throw"forcePath fail: it is not object"+g;}g=l;k=this.convertUnitsToMinutes(c,d);g[c]=k;"close_time"===c&&this.setDeltaWorkzoneCloseTime(b,d);this.deltaChangeCounter++;b={coord:b.clone(),
value:d,field:c,oldValue:e};this.notify("setDelta",b)},removeDelta:function(b,c,e){var g=d(this.delta,b.toArray());null!==g&&void 0!==g[c]&&(delete g[c],"close_time"===c&&this.removeDeltaWorkzoneCloseTime(b),this.deltaChangeCounter--,b={coord:b.clone(),field:c,oldValue:e},this.notify("removeDelta",b))},getDelta:function(b,c){var e=d(this.delta,b.toArray());return null===e||void 0===e[c]?null:this.convertMinutesToUnits(c,e[c])},isDeltaChanged:function(){return!!this.deltaChangeCounter},getAllDelta:function(){var b=
this.delta,d=new c({});if(b)for(var e in b){d.bucket=e;var g=b[e],k;for(k in g.days){d.day=k;var l=this.getDayWorkzones(d),n=g.days[k],p;for(p in n.timeslots){d.timeSlot=p;var s=n.timeslots[p],t;for(t in s.categories){d.category=t;var F=s.categories[t];if(this.get(d,"status_fixed",!1)&&F.workzones){var J=!1,H;for(H in F.workzones)if(F.workzones[H].status||F.workzones[H].status===this.STATUS.DEFAULT){J=!0;break}if(J){this.setDelta(d,"status",this.get(d,"status"));for(var K in l)d.workzone=l[K].id,
this.setDelta(d,"status",this.get(d,"status",this.STATUS.DEFAULT)),d.workzone=null}}}}}}return this.delta},openAll:function(){var b=this.delta&&!$.isEmptyObject(this.delta)?this.delta:this.buckets,d=new c({});if(b)for(var e in b)d.bucket=e,this.openBucketDays(b[e],d)},openBucketDays:function(b,c){for(var d in b.days)c.day=d,this.openDayTimeSlots(b,b.days[d],c);c.day=null},openDayTimeSlots:function(b,c,d){for(var e in c.timeslots)d.timeSlot=e,this.set(d,"status",this.STATUS.DEFAULT),this.openTimeSlotCategories(b,
c.timeslots[e],d);d.timeSlot=null},openTimeSlotCategories:function(b,c,d){for(var e in c.categories)d.category=e,this.set(d,"status",this.STATUS.DEFAULT),this.openCategoryWorkZones(b,c.categories[e],d);d.category=null},openCategoryWorkZones:function(b,c,d){if(c.workzones&&!$.isEmptyObject(c.workzones)){b=c.workzones;for(var e in b)d.workzone=e,this.set(d,"status",this.STATUS.DEFAULT)}else if(b.workzones&&!$.isEmptyObject(b.workzones))for(b=b.workzones,e=0;e<b.length;e++)d.workzone=b[e].id,this.set(d,
"status",this.STATUS.DEFAULT),this.setDelta(d,"status",this.STATUS.DEFAULT);d.workzone=null},getSectorStatus:function(b){var c=!1,d=b.clone({workzone:null}),e=b.clone({day:null});b={status:"",isChanged:null!==this.getDelta(d,"status")};if(!this.get(e,"settings").isQuotaCloseAllowed(d))return b.status="empty",b;(e=this.get(d,"status"))&&e&this.STATUS.CLOSED_ON_TOP_LEVEL&&(b.status="closed",c=!0);!b.status&&e&&e&this.STATUS.CLOSED&&(b.status="closed");var g=this.getDayWorkzones(d);b.status||g.length||
(b.status="open");if(!g.length)return b;for(var k=0,l=0,n=0;n<g.length;n++)d.workzone=g[n].id,b.isChanged||null===this.getDelta(d,"status","")||(b.isChanged=!0),this.isStatusBitSet(d,this.STATUS.CLOSED)?l++:this.isStatusBitSet(d,this.STATUS.OPEN)?k++:e&this.STATUS.CLOSED?l++:k++,d.workzone=null;if(b.status&&c||b.status&&!k&&!l)return b;b.status=!l&&k?"open":!k&&l?"closed":"half";return b},getBookingSectorStatus:function(b){var c=!1,d=b.clone({workzone:null}),e=b.clone({day:null}),g=null!==this.getDelta(d,
"status");b={status:"",isChanged:null!==this.getDelta(d,"status")};if(!this.get(e,"settings").isQuotaCloseAllowed(d))return b.status="empty",b;(e=this.get(d,"status"))&&e&this.STATUS.CLOSED_ON_TOP_LEVEL&&(b.status="closed",c=!g);!b.status&&e&&e&this.STATUS.CLOSED&&(b.status="closed");g=this.getDayWorkzones(d);b.status||g.length||(b.status="open");if(!g.length)return b;for(var k=0,l=0,n=0;n<g.length;n++)d.workzone=g[n].id,b.isChanged||null===this.getDelta(d,"status","")||(b.isChanged=!0),this.isStatusBitSet(d,
this.STATUS.CLOSED)?l++:this.isStatusBitSet(d,this.STATUS.OPEN)?k++:e&this.STATUS.CLOSED?l++:k++,d.workzone=null;if(b.status&&c||b.status&&!k&&!l)return b;b.status=!l&&k?"open":!k&&l?"closed":"half";return b},getSectorCloseTime:function(b){var c=b.clone({workzone:null}),d=this.get(c,"close_time",""),e=this.get(c,"closed_at",""),g=!1,k=!1;null!==this.getDelta(c,"close_time","")&&(k=!0);if(c.category){b=this.getDayWorkzones(b);for(var l="",n=0;n<b.length;n++)c.workzone=+b[n].id,l=this.get(c,"close_time",
""),k||null===this.getDelta(c,"close_time","")||(k=!0),l&&(g=!0)}return{cellCloseTime:d,cellClosedAt:e,isWorkzonesCloseTime:g,isSectorChanged:k}},isCoordinateVisible:function(b){var d=b.clone({workzone:null});b=this.get(new c({bucket:b.bucket}),"ids",[]);for(var e=0;e<b.length;e++)if(d.day=b[e],null!==this.get(d,"rw"))return!0;return!1},setAccess:function(b){this.access=b||this.access},setCategoriesLookup:function(){}});toa.mixin(e.prototype,toa.mixins.EventEmitter);var g="min_quota quota max_available other_activities used plan".split(" "),
k=["days","timeslots","categories","workzones"],l={quota_percent:2,min_quota:4,quota:8,stop_booking_at:16,weight:32,estimated_quota_percent:64,status:128,close_time:512,max_available:1024,other_activities:2048,used:4096,used_quota_percent:8192,count:16384,alerts:32768,open_work_zones:65536,available_capacity_percent:131072,plan:262144,closed_at:2097152},n={DEFAULT:0,CLOSED:1,OPEN:2,AUTO_CLOSE_IS_DONE:4,CLOSED_PARTIALLY:8,CLOSED_ON_TOP_LEVEL:16,READONLY:32},p=["days","timeslots","categories","workzones"],
s=toa.flipHash(l),t=toa.flipHash(g);return e}());toa.ns("toa.models.quota.DataStorageQuotaManage",function(){function d(b,c){for(var d,e,g=0;e=c.shift();){if(!(b instanceof Object))return null;d=b[e];if(!(d instanceof Object))return null;b=d[n[g]];g++}return d}var c=toa.models.quota.Coordinate,b=toa.models.quota.BucketSettings,e=toa.define(null,function(b){this.STATUS=k;this.COLLECTIONS=g;this.buckets={};this.bucketIdList=[];this.quotaTimeslots=[];this.quotaCategories=[];this.categoryIdList=[];this.currentArea={};this.catLookup={};this.uom=b;this.unitRatio=
1;this.categories=[];this.categoriesLabels=[];this.intervals=[];this.intervalsLabels=[];this.totalQuotaField={value:"quota"};this.settings={};this.isOtherActivitiesExcluded=!1;this.recalculationSkipFields={stopBookingAt:1};this.requestFields={required:"date area.status area.label area.name area.quotaPercent area.maxAvailableByPlans area.category.label area.category.status area.category.quota area.category.used area.category.minQuota area.maxAvailable area.category.usedQuotaPercent area.category.maxAvailable area.category.maxAvailableByPlans area.category.interval area.category.interval.status".split(" ")};
this.mandatoryFields={item:["date"],areas:["label"],categories:["label"],intervals:["timeFrom","timeTo"]};this.editableFields={areas:{fields:{quotaPercent:{type:"float",isWrite:8,maxVal:999.99},minQuota:{type:"int",isWrite:4,maxVal:16777215},quota:{type:"int",isWrite:2,maxVal:16777215}},categories:{fields:{quotaPercentDay:{type:"float",isWrite:16,maxVal:999.99},quotaPercentCategory:{type:"float",isWrite:32,maxVal:999.99},stopBookingAt:{type:"int",isWrite:64,maxVal:65535},minQuota:{type:"int",isWrite:4,
maxVal:16777215},quota:{type:"int",isWrite:2,maxVal:16777215}},intervals:{fields:{quota:{type:"int",isWrite:2,maxVal:16777215}}}}}};this.dataObject=function(b,c,d,e,g){b.__namespace=d;b.entityType=c;b.__mandatory={};for(c=0;c<e.length;c++)b.__mandatory[b.__namespace+"__"+e[c]]=b[e[c]];b.getFieldName=function(b){return b=b.substr(b.lastIndexOf(".")+1)};b.getEntityType=function(c){return b.entityType};b.getFieldValue=function(c){return b[b.getFieldName(c)]};b.isEditable=function(c){c=g[b.getFieldName(c)];
return"undefined"===typeof c||"undefined"===typeof b.status?!1:b.status&c.isWrite};b.getId=function(){return b.__namespace};b.getMandatoryFields=function(){return b.__mandatory};b.setFieldValue=function(c,d){var e=g[b.getFieldName(c)];e.maxVal&&d>e.maxVal&&(d=e.maxVal);e&&(b[b.getFieldName(c)]=d)};return b}},{load:function(b,c,d){this.setBuckets(b.buckets||[]);this.setMassPopulateOptions(b.massPopulateFields);this.setFieldsList(c);this.init(b);this.setAutoPopulateData(b.autoPopulateData);this.setAccess(b.access);
d&&this.setSettings(d)},destroy:function(){this.buckets={};this.bucketIdList=[];this.quotaTimeslots=[];this.quotaCategories=[];this.categoryIdList=[];this.currentArea={};this.catLookup={};this.uom=null;this.categories=[];this.categoriesLabels=[];this.intervals=[];this.intervalsLabels=[];this.settings={};for(var b in this._events_uids)this.removeListener(parseInt(b))},setBuckets:function(b){for(var c in b)b.hasOwnProperty(c)&&this.addBucket(b[c].bucket_id,b[c])},getBuckets:function(){return this.bucketIdList||
[]},addBucket:function(d,e){this.recalculateMinutesToUnits(e);this.buckets[d]=e;this.bucketIdList.push(d);e.settings=new b(e.info);var g=new c({bucket:d});this.addDates(e,g)},addDates:function(b,c){var d=b[this.COLLECTIONS[0]]||{};b.ids=b.ids||[];for(var e in d){var g=d[e];b.ids.push(e);this.recalculateMinutesToUnits(g);c.day=e;this.addTimeSlots(g,c)}b.ids.sort()},addTimeSlots:function(b,c){var d=b[this.COLLECTIONS[1]]||{};b.ids=b.ids||[];for(var e in d){var g=d[e];-1===this.quotaTimeslots.indexOf(e)&&
this.quotaTimeslots.push(e);b.ids.push(e);this.recalculateMinutesToUnits(g);c.timeSlot=e;this.addCategories(g,c)}b.ids.sort()},addCategories:function(b,c){var d=b[this.COLLECTIONS[2]]||{};b.ids=b.ids||[];for(var e in d){var g=d[e];-1===this.quotaCategories.indexOf(e)&&this.quotaCategories.push(e);b.ids.push(e);this.recalculateMinutesToUnits(g);c.category=e;this.addWorkZones(g,c)}b.ids.sort()},addWorkZones:function(b,c){var d=b[this.COLLECTIONS[3]]||{};b.ids=b.ids||[];var e=!1,g;for(g in d){var k=
d[g];b.ids.push(g);!e&&b.status&this.STATUS.CLOSED&&k.status==this.STATUS.OPEN&&(e=!0)}e&&this.fixCategoryStatus(b,c);b.ids.sort()},fixCategoryStatus:function(b,c){b.status_fixed=b.status;b.status|=this.STATUS.OPEN;b.status&=~this.STATUS.CLOSED;b.ids=[];var d=this.getDayWorkzones(c),e;for(e in d){var g=d[e].id;b.ids.push(g);b.workzones[g]||(b.workzones[g]={});b.workzones[g].status?b.workzones[g].status==this.STATUS.OPEN&&(b.workzones[g].status=null):b.workzones[g].status=this.STATUS.CLOSED}b.ids.sort()},
recalculateMinutesToUnits:function(b){if(1!==this.unitRatio)for(var c=0;c<l.length;c++){var d=l[c],e=b[d];e&&(b[d]=this.uom.minutesToUnits(e))}},setCurrentArea:function(b){this.currentArea=b},getCurrentArea:function(){return this.currentArea},setSettings:function(b){this.settings=b||{};this.setFlagOtherActivitiesExcluded()},isTimeSlotQuotaEnabled:function(){return"undefined"!==typeof this.settings.area_settings&&!0===this.settings.area_settings.is_old_quota_enabled},setAccess:function(b){this.access=
b||this.access},setCategoriesLookup:function(b){this.catLookup=b},getAllCategories:function(){return this.categories},getCategoryName:function(b){return this.catLookup[b]?this.catLookup[b].text:b},init:function(b){this.dataToUpdate={};this.deltaChangeFlag=!1;this.data=b.items||[];this.autoPopulateData=[];this.categories=[];this.categoriesLabels=[];this.intervals=[];this.intervalsLabels=[];this.days=[];this.areas=[];for(b=0;b<this.data.length;b++){var c=b;this.data[b]=this.dataObject(this.data[b],
"item",c,this.mandatoryFields.item,{});this.days.push(this.data[b].date);for(var c=c+"__areas",d=0;d<this.data[b].areas.length;d++)this.data[b].areas[d]=this.setAreaObject(this.data[b].areas[d],c+"__"+d)}},setAreaObject:function(b,c){var d=c+"__categories";b.categories=b.categories||[];for(var e=0;e<b.categories.length;e++)b.categories[e]=this.setCategoryObject(b,b.categories[e],d+"__"+e);0<b.used&&0<b[this.totalQuotaField.value]&&(b.usedQuotaPercent=this.getAreaUsedPercent(b));return this.dataObject(b,
"area",c,this.mandatoryFields.areas,this.editableFields.areas.fields)},setCategoryObject:function(b,c,d){var e={id:c.label,name:this.getCategoryName(c.label)};0>this.categoriesLabels.indexOf(c.label)&&(this.categories.push(e),this.categoriesLabels.push(c.label));0<c.used&&0<c[this.totalQuotaField.value]&&(c.usedQuotaPercent=this.getCatUsedPercent(b,c));e=d+"__intervals";c.intervals=c.intervals||[];for(var g=0;g<c.intervals.length;g++)c.intervals[g]=this.setTimeintervalObject(b,c,c.intervals[g],e+
"__"+g);return this.dataObject(c,"category",d,this.mandatoryFields.categories,this.editableFields.areas.categories.fields)},setTimeintervalObject:function(b,c,d,e){b={id:d.timeFrom+"_"+d.timeTo,label:d.label};0>this.intervalsLabels.indexOf(b.label)&&(this.intervalsLabels.push(b.label),this.intervals.push(b));return this.dataObject(d,"interval",e,this.mandatoryFields.intervals,this.editableFields.areas.categories.intervals.fields)},getTimeIntervals:function(){return this.intervals},getDates:function(){return this.days},
setFieldsList:function(b){return this.fields=b||[]},setFlagOtherActivitiesExcluded:function(){this.isOtherActivitiesExcluded=this.settings.area_settings&&this.settings.area_settings.area&&this.settings.area_settings.area.options&4},getRequestedRequiredFields:function(){return this.requestFields.required},getFieldList:function(){var b={},c=Object.keys(this.fields);this.isMaxAvailableByPlansEligible()||-1===c.indexOf("maxAvailableByPlans")||c.splice(c.indexOf("maxAvailableByPlans"),1);for(var d in c){var e=
c[d];b[e]=this.fields[e]}return b},isMaxAvailableByPlansEligible:function(){return"undefined"!==this.settings.oldQuotaMenuVisibility&&!0===this.settings.oldQuotaMenuVisibility?!1:-1!==["DAY_QUOTA_IS_CALCULATED_BASED_PLANS","DAY_QUOTA_IS_CALCULATED_BASED_PLANS_AFTER_NEXT_N_DAYS"].indexOf(this.settings.quota_settings.day_settings.DAY_QUOTA_FLAG_DEFINED)?!0:!1},getFieldName:function(b){b=b||"";var c=this.fields[b]||!1;if(!c)return b;b=this.settings.quota_uom;return c.uomNames&&c.uomNames[b]?c.uomNames[b]:
c.name},getCatMaxAvailable:function(b,c){return"undefined"!==typeof c.maxAvailableByPlans?c.maxAvailableByPlans:c.maxAvailable?c.maxAvailable:0},getAreaMaxAvailable:function(b){var c=b.maxAvailable;"undefined"!==typeof b.maxAvailableByPlans&&(c=b.maxAvailableByPlans);b=this.isOtherActivitiesExcluded&&b.otherActivities||0;return c?c-b:0},getAreaQuotaPercent:function(b){return null===b.quota&&"object"===typeof b.quota?null:b.quota/(b.maxAvailable-(this.isOtherActivitiesExcluded&&b.otherActivities||
0))*100},getCatQuotaPercent:function(b,c){return null===c.quota&&"object"===typeof c.quota?null:c.quota/this.getCatMaxAvailable(b,c)*100},getCatUsedPercent:function(b,c){if(!c.used||"undefined"===typeof c[this.totalQuotaField.value])return null;var d=0.01*(c[this.totalQuotaField.value]||this.getCatMaxAvailable(b,c)||0);"number"===typeof c[this.totalQuotaField.value]&&0===c[this.totalQuotaField.value]&&(d=c[this.totalQuotaField.value]);return d?c.used/d:null},getAreaUsedPercent:function(b){if(!b.used||
"undefined"===typeof b[this.totalQuotaField.value])return null;var c=0.01*(b[this.totalQuotaField.value]||0);return c?b.used/c:null},recalculateQuota:function(b){if(b&&this.data[b])return this.recalculateAreasQuota(this.data[b].areas);for(b=0;b<this.data.length;b++)this.recalculateAreasQuota(this.data[b].areas)},recalculateAreasQuota:function(b){for(var c=0;c<b.length;c++){var d=b[c];if("undefined"!==typeof d.maxAvailable){var e=d.getId()+"__"+this.totalQuotaField.value,g=d[this.totalQuotaField.value]?
d[this.totalQuotaField.value]:null,k=this.calculatedAreaQuota(d);d[this.totalQuotaField.value]=k;k=Math.round(k);g=Math.round(g);this.__sendNotify(e,k,g,"quota");e=d.getId()+"__usedQuotaPercent";g=d.usedQuotaPercent?d.usedQuotaPercent:null;k=this.getAreaUsedPercent(d);d.usedQuotaPercent=k;this.__sendNotify(e,k,g,"usedQuotaPercent");d.isEditable("quotaPercent")||(e=d.getId()+"__quotaPercent",g=d.quotaPercent?d.quotaPercent:null,k=this.getAreaQuotaPercent(d),d.quotaPercent=k,k=null!==k?Math.round(k):
k,g=null!==g?Math.round(g):g,this.__sendNotify(e,k,g,"quotaPercent","quotaPercent"));this.recalculateCategoriesQuota(d.categories,d)}}},recalculateCategoriesQuota:function(b,c){for(var d=0;d<b.length;d++){var e=b[d],g=e.getId()+"__"+this.totalQuotaField.value,k=e[this.totalQuotaField.value]||null,l=this.calculatedCategotyQuota(e,c);e.setFieldValue(this.totalQuotaField.value,l);this.__sendNotify(g,l,k,"quota");e.isEditable("quotaPercentCategory")||(g=e.getId()+"__quotaPercentCategory",k=e.quotaPercentCategory?
e.quotaPercentCategory:null,l=this.getCatQuotaPercent(c,e),e.quotaPercentCategory=l,l=null!==l?Math.round(l):l,k=null!==k?Math.round(k):k,this.__sendNotify(g,l,k,"quotaPercentCategory","quotaPercent"));g=e.getId()+"__usedQuotaPercent";k=e.usedQuotaPercent?e.usedQuotaPercent:null;l=this.getCatUsedPercent(c,e);e.usedQuotaPercent=l;this.__sendNotify(g,l,k,"usedQuotaPercent");g=e.getId()+"__quotaPercentDay";k=e.quotaPercentDay?e.quotaPercentDay:null;l=this.calcCatQuotaPercentDay(e,c);l=this.roundValue(l);
e.quotaPercentDay=l;this.__sendNotify(g,l,k,"quotaPercentDay")}},roundValue:function(b){return this.isNumeric(b)?Math.round(1*b)/1:null},roundValueMiddle:function(b){return this.isNumeric(b)?Math.round(b):null},calculatedAreaQuota:function(b){if(b.isEditable(this.totalQuotaField.value))return"undefined"!==typeof b[this.totalQuotaField.value]?b[this.totalQuotaField.value]:null;var c=this.getAreaMaxAvailable(b),d=b.getFieldValue("quotaPercent");b=b.getFieldValue("minQuota");return this.isNumeric(b)||
this.isNumeric(d)?Math.max(0.01*(d||0)*c,b||0):null},calculatedCategotyQuota:function(b,c){if(b.isEditable(this.totalQuotaField.value))return"undefined"!==typeof b[this.totalQuotaField.value]?b[this.totalQuotaField.value]:null;var d=b.getFieldValue("quotaPercentCategory"),e=b.getFieldValue("quotaPercentDay"),g=this.getCatMaxAvailable(c,b),k=b.getFieldValue("minQuota"),d=this.isNumeric(d)?Math.round(0.01*d*g):null;b.isEditable("quotaPercentDay")&&this.isNumeric(e)&&(d=e/100*c.quota);return this.isNumeric(d)?
this.roundValueMiddle(Math.max(d||0,k||0)):null},calcCatQuotaPercentDay:function(b,c){if(!b.isEditable("quotaPercentDay")){var d=0.01*(c[this.totalQuotaField.value]||0),e=b[this.totalQuotaField.value]||0;return 0===e&&null!==b[this.totalQuotaField.value]&&d?0:d&&e?Math.round(e/(Math.round(100*d)/100)):null}return b.quotaPercentDay},isDeltaChanged:function(){return this.deltaChangeFlag},setMassPopulateOptions:function(b){this.massPopulateOptions=b},getMassPopulateOptions:function(){return this.massPopulateOptions},
isMassPopulateOptionsSet:function(){return this.massPopulateOptions&&!!this.massPopulateOptions.length},setAutoPopulateData:function(b){if(b&&b.length){for(var c={},d=0;d<b.length;d++){var e=b[d].field,g=b[d].category_id||0;c[e]||(c[e]={});c[e][g]||(c[e][g]={});c[e][g]=b[d]}this.autoPopulateData=c}},setAutoPopulateSchedule:function(b){},getAutoPopulateData:function(b,c,d){"quota"==b&&(b="quotaValue");"quotaPercent"==b&&(b="quotaPercentCategory");return this.autoPopulateData&&this.autoPopulateData[b]&&
this.autoPopulateData[b][c]?d?this.autoPopulateData[b][c][d]:this.autoPopulateData[b][c]:!1},getFieldNameByLabel:function(){},isNumeric:function(b){return!isNaN(parseFloat(b))&&isFinite(b)},getDelta:function(){return this.dataToUpdate},set:function(b,c,d,e){var g=this.get(b);this.setUpdatedData(b,c,d);this.__sendNotify(b,c,g,d,e)},__sendNotify:function(b,c,d,e,g){c!==d&&(b={coord:b,value:c,field:e,oldValue:d},b.filterField=g?g:e,this.deltaChangeFlag=!0,this.notify("setDelta",b))},setUpdatedData:function(b,
c,d){for(var e=this.data,g=b.split("__"),k=0;k<g.length;k++)if(e=e[g[k]]||(e?e[g[k]]:e),null!==e&&"undefined"!==typeof e&&"undefined"!==typeof e.getMandatoryFields){var l=e.getMandatoryFields(),n;for(n in l)l.hasOwnProperty(n)&&this._setPropByStr(this.dataToUpdate,n,l[n])}this._setPropByStr(this.dataToUpdate,b,c);this._setPropByStr(this.data,b,c);1===this.recalculationSkipFields[d]||g[5]&&"intervals"==g[5]||this.recalculateQuota(g[0]||null)},_setPropByStr:function(b,c,d){c=c.split("__");for(var e,
g,k=0;k<c.length;k++)e=c[k],"undefined"===typeof b[e]&&(g={},b[e]=g),k+1==c.length&&("undefined"!==typeof b.setFieldValue&&b.setFieldValue(e,d),b[e]=d),b=b[e]},getOld:function(b,c){},get:function(b){var c=this.data;b=b.split("__");for(var d=0;d<b.length;d++)c=c[b[d]]||(c?c[b[d]]:c);return c},getEntity:function(b){var c=this.data;b=b.split("__");for(var d=0;d<b.length;d++)c=c[b[d]]||(c&&"function"===typeof c.getEntityType?c:null);return c},getSectorStatus:function(b){return"open"},decorateTo:function(b,
c){if("undefined"===typeof b)return"";b=this.roundValue(b);b=this.decorateToMaxValue(b);return"uom"===c&&"hours"===this.settings.quota_uom?Math.round(b/60*100)/100:"uom"===c&&"man-days"===this.settings.quota_uom?Math.round(b/parseInt(this.settings.quota_hours_per_man_day)/60*100)/100:"percent"===c?b+"%":b=Math.round(b)},revertTo:function(b,c){"uom"===c&&"hours"===this.settings.quota_uom&&(b=Math.round(60*b));"uom"===c&&"man-days"===this.settings.quota_uom&&(b=Math.round(60*b*parseInt(this.settings.quota_hours_per_man_day)));
return b=this.decorateToMaxValue(b)},decorateToMaxValue:function(b){this.isMoreThenMaxInteger(b)&&(b=16777215);return b},isMoreThenMaxInteger:function(b){return 16777215<+b},getAllWorkzones:function(b){return this.getByCoord(new c({bucket:b}),"workzones",[])},getByCoord:function(b,c,d){var e=this.getDeltaByCoord(b,c);return null!==e?e:this.getOldByCoord(b,c,d)},getOldByCoord:function(b,e,g){b=new c(b);b=d(this.buckets,b.toArray());return null===b||void 0===b[e]?void 0!==g?g:null:this.convertMinutesToUnits(e,
b[e])},getDeltaByCoord:function(b,c){var e=d(this.delta,b.toArray());return null===e||void 0===e[c]?null:this.convertMinutesToUnits(c,e[c])},convertMinutesToUnits:function(b,c){return c&&this.isCalculatedField(b)?this.uom.minutesToUnits(c):c},isCalculatedField:function(b){return toa.isDefined(p[b])}}),g=["days","timeslots","categories","workzones"],k={DEFAULT:0,CLOSED:1,OPEN:2,AUTO_CLOSE_IS_DONE:4,CLOSED_PARTIALLY:8,CLOSED_ON_TOP_LEVEL:16,READONLY:32},l="min_quota quota max_available other_activities used plan".split(" "),
n=["days","timeslots","categories","workzones"],p=toa.flipHash(l);toa.mixin(e.prototype,toa.mixins.EventEmitter);return e}());toa.ns("toa.models.quota.DataStorageCapacity",function(){var d=toa.define(null,function(){this.isSetMaxAvailable=!0;this.currentArea={};this.catLookup={};this.settings={};this.areaSettings={};this.resourceCapacityPlans={};this.capacityAreaFieldResources={};this.timeIntervals=[];this.timeIntervalString="all";this.categories=[];this.requestFields="area.label area.name area.available.count area.available.minutes area.category.available.count area.category.available.minutes".split(" ");this.id=1;this.dataObject=
function(c,b,d){c.__namespace=d;c.entityType=b;c.getFieldName=function(b){return b=b.substr(b.lastIndexOf(".")+1)};c.getEntityType=function(b){return c.entityType};c.getFieldValue=function(b,d){for(var e=b.split("."),n=c,p=!1,s=0;s<e.length;s++){if("undefined"===typeof n[e[s]]){p=!0;break}n=n[e[s]]}return!1===p&&"undefined"!==typeof n[d]?n[d]:""};c.getId=function(){return c.__namespace};return c}},{load:function(c){this.init(c)},setFilter:function(c){this.isSetMaxAvailable=c},setCurrentArea:function(c){this.currentArea=
c},getCurrentArea:function(){return this.currentArea},getTimeIntervalString:function(){return this.timeIntervalString},setIntervals:function(c){var b=[];this.timeIntervals=[];""===c?b.push("all"):(b=c.split(","),"all"===b[0]&&1<b.length&&b.shift(),"all"!==b[b.length-1]&&b.push("all"));this.timeIntervalString=b.join(",");this.intervalModel=null;$.each(b,function(b,c){var d={label:c},l=this.intervalModel;this.intervalModel=new toa.models.TimeIntervalModel(d);d.caption=this.intervalModel.getIntervalText();
d.fields=this.getIntervalFields(b);0<this.timeIntervals.length&&l&&l.isZeroLength()&&this.intervalModel.isUsual()&&l.getStartTime()===this.intervalModel.getStartTime()&&(l=this.timeIntervals.pop(),d.fields.unshift(l.fields[0]));this.timeIntervals.push(d)}.bind(this))},getIntervalFields:function(c){var b=[];this.intervalModel.isAllDay()&&this.isSetMaxAvailable&&b.push({label:"max_available_resources",caption:h(20456),source:"calendar.count",sourceIndex:c});if(this.intervalModel.isZeroLength())c={label:"resources_at",
caption:r(20463,{"{INTERVAL_VALUE}":this.intervalModel.getIntervalText("start")}),sourceIndex:c},this.isSetMaxAvailable?(c.firstSource="available.count",c.secondSource="calendar.count"):c.source="available.count";else{var d="";switch(this.settings.quota_uom){case "minutes":d=h(23401);break;case "hours":d=h(23402);break;case "man-days":d=h(23403)}c={label:"available_capacity",caption:d,sourceIndex:c,decorateValue:this.decorateValue.bind(this)};this.isSetMaxAvailable?(c.firstSource="available.minutes",
c.secondSource="calendar.minutes"):c.source="available.minutes"}b.push(c);return b},setSettings:function(c){this.settings=c||{}},setAreaSettings:function(c){this.areaSettings=c||{}},getPlannedCapacityMeasureType:function(){return this.areaSettings.area&&0==(this.areaSettings.area.options&128)?"availableTime":"availableResourcesCount"},decorateValue:function(c){return"undefined"===typeof c||""===c?"":"hours"===this.settings.quota_uom?Math.round(c/60*100)/100:"man-days"===this.settings.quota_uom?Math.round(c/
parseInt(this.settings.quota_hours_per_man_day)/60*100)/100:c=Math.round(c)},getTimeIntervals:function(){return this.timeIntervals},getIntervalFieldsCount:function(c){if("undefined"!==typeof c)return this.timeIntervals[parseInt(c,10)].fields.length;var b=0;$.each(this.timeIntervals,function(c,d){b+=d.fields.length});return b},setCategoriesLookup:function(c){this.catLookup=c},getAllCategories:function(){return this.categories},getCategoryName:function(c){return this.catLookup[c]?this.catLookup[c].text:
c},init:function(c){this.dataToUpdate={};this.deltaChangeFlag=!1;this.data=c.items||[];this.categories=[];this.days=[];this.areas=[];for(c=0;c<this.data.length;c++){var b=c;this.data[c]=this.dataObject(this.data[c],b);this.days.push(this.data[c].date);for(var b=this.getNamespace(b,"areas"),d=0;d<this.data[c].areas.length;d++){var g=this.data[c].areas[d],k=this.getNamespace(b,d);this.data[c].areas[d]=this.setAreaObject(g,k)}}},setAreaObject:function(c,b){var d=this.getNamespace(b,"categories");c.categories=
c.categories||[];for(var g=0;g<c.categories.length;g++){var k=this.getNamespace(d,g);c.categories[g]=this.setCategoryObject(c.categories[g],k)}return this.dataObject(c,"area",b)},setCategoryObject:function(c,b){return this.dataObject(c,"category",b)},getNamespace:function(c,b){return c+"__"+b},getDates:function(){return this.days},getRequestFields:function(){return this.requestFields},findAreaByLabel:function(c,b){var d=-1;if(this.data[c]&&this.data[c].areas)for(var g=this.data[c].areas,k=0;k<g.length;k++)if(!g[k].label&&
"total"===b||g[k].label&&g[k].label===b){d=k;break}return d},getAreaCategory:function(c,b,d){var g=null;if(this.data[c]&&this.data[c].areas&&this.data[c].areas[b]&&this.data[c].areas[b].categories)for(c=this.data[c].areas[b],b=0;b<c.categories.length;b++)if(c.categories[b].label===d){g=c.categories[b];break}return g},get:function(c){var b=this.data;c=c.split("__");for(var d=0;d<c.length;d++)b=b[c[d]]||(b?b[c[d]]:b);return b}});toa.mixin(d.prototype,toa.mixins.EventEmitter);return d}());toa.ns("toa.models.quota.DataStorageBookingStatus",function(){function d(b,c){for(var d,e,g=0;e=c.shift();){if(!(b instanceof Object))return null;d=b[e];if(!(d instanceof Object))return null;b=d[n[g]];g++}return d}var c=toa.models.quota.Coordinate,b=toa.models.quota.BucketSettings,e=toa.define(null,function(b){this.uom=b;this.unitRatio=1;this.MASK_TO_FIELDS=p;this.FIELDS_TO_MASK=k;this.STATUS=l;this.COLLECTIONS=g},{load:function(b){if(!b||!b.days||!b.filter)throw"No days data in responce found";this.init(b);
this.setFieldLookup(b.filter.fields);this.setDaysFields(b.days);this.setTimeSlotLookup(b.filter.timeslots);this.setCategoryLookup(b.filter.categories);this.addBucket(b);this.setMassPopulateOptions(b.massPopulateFields);this.setAutoPopulateData(b.autoPopulateData);this.setAccess(b.access)},init:function(){this.buckets={};this.bucketIdList=[];this.categoryIdList={};this.fieldLookup={};this.timeSlotLookup={};this.categoryLookup={};this.fieldsList={};this.workzoneDelta=[];this.delta={};this.deltaChangeCounter=
0;this.daysFields={};this.quotaCategories=[];this.quotaTimeslots=[];this.massPopulateOptions=[];this.autoPopulateData=[];this.access=0},addBucket:function(d){var e=d||{};e.settings=new b(d.info);this.buckets[d.bucket_id]=e;this.bucketIdList.push(d.bucket_id);d=new c({bucket:d.bucket_id});this.addDates(e,d)},addDates:function(b,c){var d=b[this.COLLECTIONS[0]]||{};b.ids=b.ids||[];for(var e in d){var g=d[e];b.ids.push(e);c.day=e;this.addTimeSlots(g.ts,c);this.addTimeIntervals(g.ti,c)}b.ids.sort()},addTimeIntervals:function(b,
c){var d=b[this.COLLECTIONS[4]]||{};b.ids=b.ids||[];for(var e in d)-1===this.quotaIntervals.indexOf(e)&&this.quotaIntervals.push(e),b.ids.push(e),c.interval=e,this.addCategories(e,c);b.ids.sort()},addTimeSlots:function(b,c){var d=b[this.COLLECTIONS[1]]||{};b.ids=b.ids||[];for(var e in d){var g=d[e];-1===this.quotaTimeslots.indexOf(e)&&this.quotaTimeslots.push(e);b.ids.push(e);c.timeSlot=e;this.addCategories(g,c)}b.ids.sort()},addCategories:function(b,c){var d=b[this.COLLECTIONS[2]]||{};b.ids=b.ids||
[];for(var e in d){var g=d[e];-1===this.quotaCategories.indexOf(e)&&this.quotaCategories.push(e);b.ids.push(e);c.category=e;this.addWorkZones(g,c)}b.ids.sort()},addWorkZones:function(b,c){var d=b[this.COLLECTIONS[3]]||{};b.ids=b.ids||[];var e=!1,g;for(g in d){var k=d[g];b.ids.push(g);!e&&b.status&this.STATUS.CLOSED&&k.status==this.STATUS.OPEN&&(e=!0)}e&&this.fixCategoryStatus(b,c);b.ids.sort()},getQuotaCategories:function(){return this.quotaCategories},getQuotaTimeslots:function(){return this.quotaTimeslots},
fixCategoryStatus:function(b,c){b.status_fixed=b.status;1!==b.status&&(b.status|=this.STATUS.OPEN,b.status&=~this.STATUS.CLOSED);b.ids=[];var d=this.getDayWorkzones(c),e;for(e in d){var g=d[e].id;b.ids.push(g);b.workzones[g]||(b.workzones[g]={});b.workzones[g].status||(b.workzones[g].status=this.STATUS.CLOSED)}b.ids.sort()},getBucketSettings:function(b){b=new c({bucket:b.bucket});return this.get(b,"settings")},getFirstBucketId:function(b){b=b.clone();var c=this.bucketIdList[0]||0;b.bucket=c;b.timeSlot=
this.getFirstTimeSlotId(b);b.category=0;return c&&d(this.buckets,b.toArray())?c:this.getNextBucketById(b,c)},getNextBucketById:function(b,c){for(var e=b.clone(),g=!1,k=0,l=1;l<this.bucketIdList.length;l++)if(this.bucketIdList[l-1]==c||g)if(g=!0,k=this.bucketIdList[l],e.timeSlot=this.getFirstTimeSlotId(e),e.category=0,d(this.buckets,e.toArray()))return k;return 0},getFirstDateId:function(b){b=b.clone();return this.buckets[b.bucket].ids[0]||""},getNextDateId:function(b,c){for(var d=b.clone(),d=this.buckets[d.bucket].ids,
e=1;e<d.length;e++)if(d[e-1]==c)return d[e];return""},get:function(b,c,d){var e=this.getDelta(b,c);return null!==e?e:this.getOld(b,c,d)},set:function(b,c,d){var e=this.getDelta(b,c,0);if(null!==e&&e==d)return!1;var g=this.getOld(b,c,0),e=null!==e?e:g;if(g==d)return this.removeDelta(b,c,e),!1;this.setDelta(b,c,d,e);return!0},getOld:function(b,e,g){b=new c(b);b=d(this.buckets,b.toArray());return null===b||void 0===b[e]?void 0!==g?g:null:this.convertMinutesToUnits(e,b[e])},getChildren:function(b){var c=
b.getLevel()-1;return this.getOld(b,this.COLLECTIONS[c]||"",{})},getBuckets:function(){return this.bucketIdList||[]},setTimeSlotLookup:function(b){if(b){this.timeSlotList=b;for(var c=0;c<b.length;c++)this.timeSlotLookup[b[c].id]=b[c].name}},getAllTimeSlots:function(){return this.timeSlotList||[]},getTimeSlotName:function(b){return this.timeSlotLookup[b]||""},getFirstTimeSlotId:function(b){b=b.clone();var c=this.timeSlotList[0].id||0;b.timeSlot=c;b.category=0;return c&&d(this.buckets,b.toArray())?
c:this.getNextTimeSlotById(b,c)},getNextTimeSlotById:function(b,c){for(var e=b.clone(),g=!1,k=0,l=1;l<this.timeSlotList.length;l++)if(this.timeSlotList[l-1].id==c||g)if(g=!0,k=this.timeSlotList[l].id,e.timeSlot=k,e.category=0,d(this.buckets,e.toArray()))return k;return 0},setCategoryLookup:function(b){if(b){this.categoryList=b;for(var c=0;c<b.length;c++)this.categoryLookup[b[c].id]=b[c].name}},getAllCategories:function(){return this.categoryList||[]},getCategoryName:function(b){return this.categoryLookup[b]||
""},getTimeslotName:function(b){return this.getTimeSlotName(b)},getFirstCategoryId:function(b){b=b.clone();var c=this.categoryList[0].id||0;return(b.category=c)&&d(this.buckets,b.toArray())?c:this.getNextCategoryById(b,c)},getNextCategoryById:function(b,c){for(var e=b.clone(),g=!1,k=0,l=1;l<this.categoryList.length;l++)if(this.categoryList[l-1].id==c||g)if(g=!0,k=this.categoryList[l].id,e.category=k,d(this.buckets,e.toArray()))return k;return 0},getWorkzoneStatus:function(b){var c=this.getDelta(b,
"status");if(c||(c=this.get(b,"status")))return c;b=b.clone({workzone:null});return(b=this.get(b,"status"))?b:this.STATUS.OPEN},setWorkzonesStatus:function(b,c,d){b=b.clone({workzone:null});var e=0,g=0,k=this.getOld(b,"status",this.STATUS.OPEN),l=k&this.STATUS.CLOSED?this.STATUS.CLOSED:this.STATUS.OPEN,n=this.get(b,"status",0)&this.STATUS.READONLY;if(c)e=c;else{for(var p in d)var s=d[p],e=e+ +s,g=g+ +!s;if(!e&&!g)return;e=!e&&g?this.STATUS.CLOSED:this.STATUS.OPEN}l!=e?this.setDelta(b,"status",this.setLockedStatusBitInMask(e,
n),k):(l=this.getDelta(b,"status",0))&&((k&this.STATUS.READONLY)!=(l&this.STATUS.READONLY)?this.setDelta(b,"status",this.setLockedStatusBitInMask(e,n),k):this.removeDelta(b,"status"));for(p in d){b.workzone=p;k=d[p]?this.STATUS.OPEN:this.STATUS.CLOSED;if(c||k==e)k=this.STATUS.DEFAULT;this.setWorkzoneStatus(b,k)}},setLockedStatusBitInMask:function(b,c){return c?b|this.STATUS.READONLY:b&~this.STATUS.READONLY},setWorkzoneStatus:function(b,c){var d=b.clone({workzone:null}),d=this.getDelta(d,"status",
null),e=this.getOld(b,"status"),g=this.STATUS.OPEN;if(e&this.STATUS.CLOSED_ON_TOP_LEVEL||e&this.STATUS.CLOSED)g=this.STATUS.CLOSED;c===this.STATUS.OPEN&&(c=this.STATUS.DEFAULT);c===this.STATUS.CLOSED&&g===this.STATUS.OPEN||c===this.STATUS.DEFAULT&&g===this.STATUS.CLOSED&&!(e&this.STATUS.CLOSED_ON_TOP_LEVEL)||c===this.STATUS.DEFAULT&&g===this.STATUS.OPEN&&d||c===this.STATUS.CLOSED&&g===this.STATUS.CLOSED&&d?this.setDelta(b,"status",c,g):this.removeDelta(b,"status")},getAllWorkzones:function(b){return this.get(new c({bucket:b}),
"workzones",[])},getDayWorkzones:function(b){var c=this.getAllWorkzones(b.bucket);b=b.day;for(var d=[],e=[],g=0;g<c.length;g++){var k=c[g];toa.isDefined(k.startdate)&&k.startdate>b||toa.isDefined(k.enddate)&&k.enddate<b||-1<$.inArray(c[g].id,e)||(d.push(c[g]),e.push(c[g].id))}return d},setDeltaWorkzoneCloseTime:function(b,c){var d=0,e="";c&&(d=toa.date.getDatesOffset(c,b.day),e=c.split(" ",2)[1]);this.workzoneDelta.push({bucket_id:+b.bucket,time_slot_id:+b.timeSlot,category_id:+b.category,work_zone_id:+b.workzone,
close_time:e,day_offset:d})},removeDeltaWorkzoneCloseTime:function(b){for(var c=0;c<this.workzoneDelta.length;c++){var d=this.workzoneDelta[c];if(d.bucket_id===b.bucket&&d.time_slot_id===b.timeSlot&&d.category_id===b.category&&d.work_zone_id===b.workzone)return this.workzoneDelta.splice(c,1),!0}return!1},getDeltaCloseTime:function(){return this.workzoneDelta},isStatusBitSet:function(b,c){return(this.get(b,"status",0)&c)===c},isLocked:function(b){return this.isStatusBitSet(b,this.STATUS.READONLY)},
setStatusBit:function(b,c,d){var e=this.getWorkzoneStatus(b);d?this.set(b,"status",e|c):this.set(b,"status",e&~c)},setLockedStatusBit:function(b,c){var d=this.get(b,"status");(d&this.STATUS.READONLY)!=(c&this.STATUS.READONLY)&&(c?this.set(b,"status",d|this.STATUS.READONLY):this.set(b,"status",d&~this.STATUS.READONLY))},convertUnitsToMinutes:function(b,c){return c&&this.isCalculatedField(b)?this.uom.unitsToMinutes(c):c},convertMinutesToUnits:function(b,c){return c&&this.isCalculatedField(b)?this.uom.minutesToUnits(c):
c},isCalculatedField:function(b){return toa.isDefined(s[b])},setDaysFields:function(b){this.daysFields=b||{}},getDaysFields:function(b){return this.daysFields[b]||0},setFieldLookup:function(b){this.fieldsList=b;for(var c=0;c<b.length;c++)this.fieldLookup[b[c].mask]=b[c].name},getFieldNameById:function(b){return this.fieldLookup[b]||""},getFieldNameByLabel:function(b){b=this.getFieldIdByLabel(b);return this.getFieldNameById(b)},getAllFields:function(){return this.fieldsList},maskToFields:function(b){for(var c=
[],d=0;d<this.fieldsList.length;d++)b&this.fieldsList[d].mask&&c.push(this.fieldsList[d].mask);return c},maskToFieldsLabels:function(b){for(var c=[],d=0;d<this.fieldsList.length;d++)b&this.fieldsList[d].mask&&c.push(this.getFieldLabelById(this.fieldsList[d].mask));return c},getFieldLabelById:function(b){return this.MASK_TO_FIELDS[b]||""},getFieldIdByLabel:function(b){return this.FIELDS_TO_MASK[b]||0},setMassPopulateOptions:function(b){this.massPopulateOptions=b},getMassPopulateOptions:function(){return this.massPopulateOptions},
isMassPopulateOptionsSet:function(){return this.massPopulateOptions&&!!this.massPopulateOptions.length},setAutoPopulateData:function(b){if(b&&b.length){for(var c={},d=0;d<b.length;d++){var e=b[d].field,g=b[d].level,k=b[d].time_slot_id||0,l=b[d].category_id||0;c[e]||(c[e]={});c[e][g]||(c[e][g]={});c[e][g][k]||(c[e][g][k]={});c[e][g][k][l]||(c[e][g][k][l]={});c[e][g][k][l]=b[d]}this.autoPopulateData=c}},setAutoPopulateSchedule:function(b){},getAutoPopulateData:function(b,c,d,e){var g="category";d||
(g="time_slot",c||(g="day"));return this.autoPopulateData[b]&&this.autoPopulateData[b][g]&&this.autoPopulateData[b][g][c]&&this.autoPopulateData[b][g][c][d]?e?this.autoPopulateData[b][g][c][d][e]:this.autoPopulateData[b][g][c][d]:!1},setDelta:function(b,c,d,e){var g;g=this.delta;for(var k=b.toArray(),l,p,s=0;p=k.shift();){void 0===g[p]&&(g[p]={});l=g[p];if(!(l instanceof Object))throw"forcePath fail. value of key is not an object key :"+p;p=n[s];s++;if(p&&(void 0===l[p]&&(l[p]={}),g=l[p],!(g instanceof
Object)))throw"forcePath fail: it is not object"+g;}g=l;k=this.convertUnitsToMinutes(c,d);g[c]=k;"close_time"===c&&this.setDeltaWorkzoneCloseTime(b,d);this.deltaChangeCounter++;b={coord:b.clone(),value:d,field:c,oldValue:e};this.notify("setDelta",b)},removeDelta:function(b,c,e){var g=d(this.delta,b.toArray());null!==g&&void 0!==g[c]&&(delete g[c],"close_time"===c&&this.removeDeltaWorkzoneCloseTime(b),this.deltaChangeCounter--,b={coord:b.clone(),field:c,oldValue:e},this.notify("removeDelta",b))},getDelta:function(b,
c){var e=d(this.delta,b.toArray());return e&&null!==e&&void 0!==e[c]?this.convertMinutesToUnits(c,e[c]):null},isDeltaChanged:function(){return!!this.deltaChangeCounter},getAllDelta:function(){var b=this.delta,d=new c({});if(b)for(var e in b){d.bucket=e;var g=b[e],k;for(k in g.days){d.day=k;var l=this.getDayWorkzones(d),n=g.days[k],p;for(p in n.timeslots){d.timeSlot=p;var s=n.timeslots[p],D;for(D in s.categories){d.category=D;var C=s.categories[D];if(this.get(d,"status_fixed",!1)&&C.workzones){var F=
!1,J;for(J in C.workzones)if(C.workzones[J].status||C.workzones[J].status===this.STATUS.DEFAULT){F=!0;break}if(F){this.setDelta(d,"status",this.get(d,"status"));for(var H in l)d.workzone=l[H].id,this.setDelta(d,"status",this.get(d,"status",this.STATUS.DEFAULT)),d.workzone=null}}}}}}return this.delta},getSectorStatus:function(b){var c=!1,d=b.clone({workzone:null}),e=b.clone({day:null});b={status:"",isChanged:null!==this.getDelta(d,"status")};if(!this.get(e,"settings").isQuotaCloseAllowed(d))return b.status=
"empty",b;(e=this.get(d,"status"))&&e&this.STATUS.CLOSED_ON_TOP_LEVEL&&(b.status="closed",c=!0);!b.status&&e&&e&this.STATUS.CLOSED&&(b.status="closed");var g=this.getDayWorkzones(d);b.status||g.length||(b.status="open");if(!g.length)return b;for(var k=0,l=0,n=0;n<g.length;n++)d.workzone=g[n].id,b.isChanged||null===this.getDelta(d,"status","")||(b.isChanged=!0),this.isStatusBitSet(d,this.STATUS.CLOSED)?l++:this.isStatusBitSet(d,this.STATUS.OPEN)?k++:e&this.STATUS.CLOSED?l++:k++,d.workzone=null;if(b.status&&
c||b.status&&!k&&!l)return b;b.status=!l&&k?"open":!k&&l?"closed":"half";return b},getSectorCloseTime:function(b){var d=b.clone({workzone:null}),e=this.get(d,"close_time",""),g=this.get(new c({bucket:d.bucket}),"current_date");toa.date.getDateFromDateTime(e)<g&&(e="");var k=this.get(d,"closed_at",""),l=!1,n=!1;null!==this.getDelta(d,"close_time","")&&(n=!0);if(d.category){b=this.getDayWorkzones(b);for(var p="",s=0;s<b.length;s++)d.workzone=+b[s].id,p=this.get(d,"close_time",""),toa.date.getDateFromDateTime(p)<
g&&(p=""),n||null===this.getDelta(d,"close_time","")||(n=!0),p&&(l=!0)}return{cellCloseTime:e,cellClosedAt:k,isWorkzonesCloseTime:l,isSectorChanged:n}},isCoordinateVisible:function(b){var d=b.clone({workzone:null});b=this.get(new c({bucket:b.bucket}),"ids",[]);for(var e=0;e<b.length;e++)if(d.day=b[e],null!==this.get(d,"rw"))return!0;return!1},setAccess:function(b){this.access=b||this.access},setCategoriesLookup:function(){}});toa.mixin(e.prototype,toa.mixins.EventEmitter);var g=["days","timeslots",
"categories","workzones"],k={quota_percent:2,min_quota:4,quota:8,stop_booking_at:16,weight:32,estimated_quota_percent:64,status:128,close_time:512,max_available:1024,other_activities:2048,used:4096,used_quota_percent:8192,count:16384,alerts:32768,open_work_zones:65536,available_capacity_percent:131072,plan:262144,closed_at:2097152},l={DEFAULT:0,CLOSED:1,OPEN:2,AUTO_CLOSE_IS_DONE:4,CLOSED_PARTIALLY:8,CLOSED_ON_TOP_LEVEL:16,READONLY:32},n=["days","timeslots","categories","workzones","intervals"],p=
toa.flipHash(k),s=toa.flipHash("min_quota quota max_available other_activities used plan".split(" "));return e}());toa.ns("toa.models.quota.PlannedCapacity",function(){var d=toa.define(null,function(c){this.areaTreeModel=c;this.currentArea=null;this.resourceCapacityPlans={};this.pceNoDataDate=null;this.settings={};this.capacityType=null;this.access=1;this.isReadOnly=!0},{setCurrentArea:function(c){this.currentArea=c},setSettings:function(c){this.settings=c},getCurrentArea:function(){return this.currentArea},setCapacityAreaFieldResources:function(c){this.capacityAreaFieldResources=c||{}},setTarCount:function(c){this.tarCount=
c||{}},getTarCount:function(){return this.tarCount},isCapacityArea:function(c){return this.areaTreeModel.isCapacityArea(c)},isCapacityAreaPlanDefined:function(c,b){return"undefined"!==typeof this.resourceCapacityPlans[c]&&"undefined"!==typeof this.resourceCapacityPlans[c][b]?!0:!1},getCapacityAreaPlanVariance:function(c,b,d){c=this.getOrgUnitPlannedValue(this.resourceCapacityPlans[c][d],!1);return this.calcVariance(c,b)},decorateValue:function(c){return"undefined"===typeof c||""===c?"":"availableTime"!==
this.capacityType?c:"hours"===this.settings.quota_uom?Math.round(c/60*100)/100:"man-days"===this.settings.quota_uom?Math.round(c/parseInt(this.settings.quota_hours_per_man_day)/60*100)/100:c=Math.round(c)},convertPlannedValueForDb:function(c){for(var b in c)if(""!==c[b]&&"availableTime"===this.capacityType)switch(this.settings.quota_uom){case "minutes":c[b]/=60;break;case "man-days":c[b]*=parseInt(this.settings.quota_hours_per_man_day)}return c},getOrgUnitPlannedValue:function(c,b){var d=null,d="availableCount"===
this.capacityType?"scheduled":"man_hours",d=""===c.planValue||"undefined"===typeof c.planValue[d]?"":c.planValue[d];b&&""===d&&(d=c.bucketInfo[this.capacityType]);return d},getTotalOrgUnitsPlannedValue:function(c){var b=!1,d;for(d in c)d==this.bucketId||this.isCapacityArea(d)||(b+=this.getOrgUnitPlannedValue(c[d],!0));return b},calcVariance:function(c,b){if(""===c)return"";var d;return d=Math.round(100*(b-c))/100},setCapacityTypeAsCount:function(){this.capacityType="availableCount"},setCapacityTypeAsTime:function(){this.capacityType=
"availableTime"},setAccess:function(c){this.access=c||1;this.isReadOnly=1===c},setResourceCapacityPlans:function(c){this.resourceCapacityPlans=c||{}},setPceNoDataDate:function(c){this.pceNoDataDate=c},setResourceCapacityPlansOnDate:function(c,b){this.resourceCapacityPlans[c]=b},validatePlansValues:function(c){var b={},d=65535;if("availableTime"===this.capacityType)switch(this.settings.quota_uom){case "minutes":d*=60;break;case "man-days":d=Math.round(d/parseInt(this.settings.quota_hours_per_man_day))}for(var g in c){var k=
c[g];if(""!==k)if(!(0>k||k>d||isInt(k)))b[g]?!1:b[g]=[],b[g].push(r(23413,{"{PLAN_VALUE}":k}));else if(0>k||k>d)b[g]?!1:b[g]=[],b[g].push(r(23411,{"{PLAN_VALUE}":k,"{PLAN_VALUE_MAX}":d}));else if("availableTime"===this.capacityType&&"minutes"===this.settings.quota_uom&&0!==k%60){var l=60*Math.ceil(k/60),n=60*Math.floor(k/60);b[g]?!1:b[g]=[];b[g].push(r(23412,{"{PLAN_VALUE}":k,"{PLAN_VALUE_NEAREST_LOW}":n,"{PLAN_VALUE_NEAREST_HIGH}":l}))}}return b}});toa.mixin(d.prototype,toa.mixins.EventEmitter);
return d}());toa.ns("toa.models.QuotaUnitsOfMeasurement",function(){return toa.define(null,function(){this.unitRatio=1;this.uom="minutes";this.hoursInManDay=8;this.precisionBase=1},{unitsToMinutes:function(d){return Math.round(d/this.unitRatio)},minutesToUnits:function(d){return this.toPrecision(d*this.unitRatio)},setUom:function(d){this.uom=d;this._updateUnitRatio()},getUom:function(){return this.uom},setHoursInManDay:function(d){this.hoursInManDay=d;this._updateUnitRatio()},getHoursInManDay:function(){return this.hoursInManDay},
_updateUnitRatio:function(){switch(this.uom){case "hours":this.unitRatio=1/60;this.setPrecision(2);break;case "man-days":this.unitRatio=1/(60*this.hoursInManDay);this.setPrecision(2);break;default:this.unitRatio=1,this.setPrecision(0)}},setPrecision:function(d){this.precisionBase=Math.pow(10,d)},toPrecision:function(d){return d=Math.round(d*this.precisionBase)/this.precisionBase}})}());(function(d){d.models.quota.AreaTree=d.define(d.models.ResourceTree,function(c,b){this.identifier=c;this.found=[];this.requestedOpenChildren=[];this.openedResources=[];this.wereOpened=[];this.childrenCache={};this.rootResources=[];this.resources=new d.Collection({remove:function(b){this.notify("removeTreeNode",{resourceId:b.id,date:this.getDate()})}.bind(this)});this.resources.setComparator(this._resourcesComparator);this.dynamicResources=new d.Collection;this._scrollOffset={top:0,left:0};b instanceof
Object&&this.setup(b)},{openFolder:function(c){},closeFolder:function(c){},isOpened:null,clear:function(){this.searchLimited=!1;this.resources.clear();this.childrenCache={};this.rootResources=[];this.isClean=!0},copyState:function(){},search:function(c){if(void 0==c&&""==c)return this.openedItems={},!1;this.found=[];this.searchKey=c.toLowerCase();c=this.resources.find(this._searchCondition,this);if(d.isObject(c))for(var b in c)this.found.push(b);return 0<this.found.length},clearSearch:function(){this.found=
[];this.setSearchKey("");this.searchLimited=!1;this.selectProvider(this.currentlySelected)},_searchCondition:function(c,b){return this.searchKey?c.entity.n&&""!=c.entity.n&&-1!==c.entity.n.toLowerCase().indexOf(this.searchKey)||c.entity.e&&""!=c.entity.e&&-1!==c.entity.e.toLowerCase().indexOf(this.searchKey):!1},getSearchKey:function(){return this.searchKey},_trigger:function(c,b){$(this).triggerHandler(c,[b])},setupStructure:function(c){var b,e;this.resources.setComparator(this._resourcesComparator);
this.changed=!1;for(b in c)if(e=this.resources.get(b))e.update(c[b]),e.isChanged()&&(e.clearChanged(),this.changed=!0);else try{e=new d.Resource(c[b]);e.setId(b);this.resources.add(e,b);this.changed=!0;var g=e.getParent();e.hasChildren()&&"undefined"==typeof this.childrenCache[b]&&(this.childrenCache[b]=[]);g?("undefined"==typeof this.childrenCache[g]&&(this.childrenCache[g]=[]),this.childrenCache[g].push(b)):this.rootResources.push(b)}catch(k){}},clearInvisible:function(c){if(c)for(var b=0;b<c.length;b++)this.removeInvisible(c[b]),
this.closeFolder(c[b])},removeInvisible:function(c){if(this.resources.get(c)){var b=this.getChildren(c);if(b&&d.isArray(b))for(var e=0;e<b.length;e++){var g=this.resources.get(b[e]);g&&g.getParent()!==c||this.removeInvisible(b[e])}this.childrenCache[c]&&delete this.childrenCache[c];this.resources.remove(c)}},each:function(c,b){this.resources.each(c,b)}})})(toa);(function(d){d.models.quota.AreaTreeModel=d.define(null,function(){this.areaTree={};this.prevData={};this.nodesToRemove=[];this.providerIdsMap={};this.deltaUpdates={};this.topAreaLabel=null;this.treeObject=function(c,b){var d={},g=b||null,k={},l={},n=function(b){l={n:b.name,e:b.label,p:g?g.getId():0,z:b.label,c:l.c?l.c:0,f:65801,l:g?g.getData().l+1:0,t:2,i:b.idx};k={name:b.name,type:b.type,label:b.label,providerId:b.providerId,providerTypeId:b.providerTypeId||2};g&&g.setChild();d.notifyUpdate()};
d.getData=function(){return l};d.updateData=function(b,c){(!c&&g||g&&c&&g.getId()!==c.getId())&&g.removeChild();d.setParent(c);n(b);d.notifyUpdate()};d.getId=function(){return k.label};d.setParent=function(b){g=b};d.getParent=function(){return g};d.getAreaData=function(){return k};d.remove=function(){g&&g.removeChild()};d.removeChild=function(){l.c--;d.notifyUpdate()};d.setChild=function(){l.c++;d.notifyUpdate()};d.getChildrenCount=function(){return l.c};d.notifyUpdate=function(){this.setToDelta(d.getId(),
l)}.bind(this);n(c);return d}},{getTreeUpdates:function(c){this.topAreaLabel=c[0]?c[0].label:null;this.deltaUpdates={};this.nodesToRemove=[];c=this._fieldToArrayKey(c,"label");var b=this.getDiff(this.prevData,c);this.calculateDeltaTreeUpdates(b,c);this._setToRemove(this.arrayDiff(Object.keys(this.prevData),Object.keys(c)));this._removeNodes();this.prevData=c;return this.deltaUpdates},resetTreeData:function(){this.areaTree={};this.prevData={};this.nodesToRemove=[];this.providerIdsMap={};this.deltaUpdates=
{}},setToDelta:function(c,b){this.deltaUpdates[c]=b},calculateDeltaTreeUpdates:function(c,b){this.items=b;for(var d=0;d<c.length;d++){var g=c[d];this.providerIdsMap[b[g].providerId]=b[g].label;this.setItemData(b[g])}delete this.items},getParent:function(c){"undefined"===typeof this.areaTree[c]&&"undefined"!==typeof this.items[c]&&this.setItemData(this.items[c]);return this.areaTree[c]||null},setItemData:function(c){var b=null;c.parent&&c.parent.label&&(b=this.getParent(c.parent.label));"undefined"===
typeof this.areaTree[c.label]?this.areaTree[c.label]=this.treeObject(c,b):this.areaTree[c.label].updateData(c,b)},getNodesToRemove:function(){return this.nodesToRemove},_setToRemove:function(c){this.nodesToRemove=c},_addToRemove:function(c){this.nodesToRemove.push(c)},_removeNodes:function(){for(var c=this.getNodesToRemove(),b=0;b<c.length;b++)if("undefined"!==typeof this.areaTree[c[b]]){var d=this.getArea(c[b]).providerId||null;this.areaTree[c[b]].remove();var g=this.areaTree[c[b]].getParent();if(g&&
0>=g.getChildrenCount()){var k=g.getAreaData(),k=k?k.providerId:null;g.remove();this._addToRemove(g.getId());delete this.areaTree[g.getId()];k&&this.providerIdsMap[k]&&delete this.providerIdsMap[k]}delete this.areaTree[c[b]];d&&this.providerIdsMap[d]&&delete this.providerIdsMap[d]}},_fieldToArrayKey:function(c,b){for(var d={},g=0;g<c.length;g++)c[g].hasOwnProperty(b)&&(c[g].idx=g,d[c[g][b]]=c[g]);return d},arrayDiff:function(c,b){return c.filter(function(c){return 0>b.indexOf(c)})},getDiff:function(c,
b){var d=[];if(JSON.stringify(b)!==JSON.stringify(c))for(var g in b)b.hasOwnProperty(g)&&(c.hasOwnProperty(g)&&JSON.stringify(b[g])===JSON.stringify(c[g])||d.push(g));return d},isCapacityArea:function(c){return"undefined"===typeof this.providerIdsMap[c]?!1:!0},getAreaByProviderId:function(c){return this.getArea(this.providerIdsMap[c])},getArea:function(c){return this.areaTree[c]?this.areaTree[c].getAreaData():null},getTopArrea:function(){return this.getArea(this.topAreaLabel)}})})(toa);toa.ns("toa.views.quota.Popup",function(){return toa.define(null,function(d){this.model=d;this.target=$();this.hideHandler=this.hide.bind(this);this.init()},{init:function(){this.container=$("<div />");this.container.html("&nbsp;");this.container.Tip({minWidth:217,minHeight:50,closable:!1,flag:"qwerty",close:this.unhighLightTarget.bind(this),container:_DATA.dispatcher_container})},show:function(d){this.target=d.target;this.coord=d.coord;this.hide();this.highLightTarget();d.container=this.container;
d.model=this.model;this.content=this.createContent(d);this.container.Tip("option","className","toaui-workzoneTip jet-css-only");this.container.Tip("option","contents",this.content.getHtml());this.container.Tip("option","callout",{side:"left",position:"center"});this.content.postRender();this.container.Tip("showAt",this.target,"right");this.content.postShow();d=306;this.container.parent().hasClass("quota-closeTimeTip")&&(d=367);this.container.parent().css({"min-width":d+"px"});this.container.Tip("option",
"onResizeWindow",this.onResizeWorkZoneList.bind(this));this.onResizeWorkZoneList()},onResizeWorkZoneList:function(){var d=180;this.container.parent().hasClass("quota-closeTimeTip")&&(d=240);d=$(window).height()-d;this.container.find(".toaui-workzoneTip-main-content").css({"max-height":d+"px"})},hide:function(){this.container.Tip("hide");this.content&&this.content.destroy()},highLightTarget:function(){this.target.addClass("tip-select")},unhighLightTarget:function(){this.target.removeClass("tip-select")},
createContent:function(d){switch(d.type){case "status":d=new toa.views.quota.PopupContentWorkzoneStatus(d);break;case "readonly":d=new toa.views.quota.PopupContentWorkzoneStatusReadonly(d);break;case "closeTime":d=new toa.views.quota.PopupContentWorkzoneCloseTime(d);break;default:throw"View Quota Popup. Wrong content type:"+d.type;}d.close=this.hideHandler;return d},destroy:function(){for(var d in this._events_uids)this.removeListener(parseInt(d));this.container&&(this.container.Tip("destroy"),this.container=
null);this.content=null}})}());toa.ns("toa.views.quota.PopupContent",function(){return toa.define(null,function(d){this.model=d.model;this.options=d},{getHtml:function(){},postRender:function(){},postShow:function(){},close:function(){},destroy:function(){},makeButtons:function(){return'<div class="buttons-ok-cancel"><input type="button" value="'+h(290)+'" id="button-cancel" class="toa-button" /><input type="submit" value="'+h(445)+'" id="button-ok" class="toa-button toa-button-active" /></div>'},timeToUserFormat:function(d,c){return""===
d?"":toa.date.formatDate("time",toa.date.parseDate("iso_long",d))},timeFromUserFormat:function(d){return""===d?"":toa.date.formatDate("H:i",toa.date.parseDate("time",d))},decorateTimeSlot:function(d){if(null===d&&"object"===typeof d)return h(20461);var c=this.model.getTimeslotName(d);return""!==c?c:"all"===d||0===d?h(20461):"-"===d.substr(0,1)?r(20464,{"{INTERVAL_VALUE}":d.substr(1)}):"-"===d.substr(-1,1)?r(20465,{"{INTERVAL_VALUE}":d.substr(0,d.length-1)}):d}})}());READ_ONLY=1;READ_WRITE=2;
toa.ns("toa.views.quota.PopupCellLock",function(){var d=toa.views.quota.Popup;return toa.define(d,function(c){this.model=c;this.target=$();this.hideHandler=this.hide.bind(this);this.autoPopulatePopup=null;this.isReadWriteAccess=this.model.access===READ_WRITE;this.init()},{init:function(){this.container=$(['<div><div class="capacity-cell-lock-popup"><label data-id="locked-label"><input type="checkbox" name="locked">',h(2057),'<br></label><label name="modify_recurrence" ><input type="checkbox" name="recurrence">',toa.glossary({id:11479}),
'</label> <span role="link" class="hint_link span_link" name="modify_recurrence" >',toa.glossary({id:462}),"</span></div></div>"].join("")).Tip({closable:!1,callout:{side:"left",position:"center"}});this.lockedCheckbox=this.container.find('input[name="locked"]');this.lockedCheckbox.on("change",this.onChange.bind(this));this.lockedLabel=this.container.find("label[data-id=locked-label]");this.container.find('[name="modify_recurrence"]').on("click",this.onAutoPopulateClick.bind(this))},show:function(c){this.target=
c.target;this.coord=c.coord;this.lockable=c.lockable;var b=!1;this.hide();c.container=this.container;c.model=this.model;if(this.lockable||this.isReadWriteAccess)this.lockable?(b=this.model.isStatusBitSet(this.coord,this.model.STATUS.READONLY),this.lockedCheckbox[0].checked=b,this.lockedLabel.show(),b=!0):this.lockedLabel.hide(),this.isReadWriteAccess&&this.model.isMassPopulateOptionsSet()?(c=this.model.getAutoPopulateData(this.coord.field,this.coord.timeSlot,this.coord.category,"status"),this.isReadWriteAccess?
(this.container.find('input[name="recurrence"]')[0].checked=c&&"active"===c?!0:!1,this.container.find('[name="modify_recurrence"]').show(),b=!0):this.container.find('[name="modify_recurrence"]').hide()):this.container.find('[name="modify_recurrence"]').hide(),b&&(this.container.Tip("option",{callout:{side:"left",position:"center"},size:function(){var b=$('<div style="position: absolute; left:-10000px;                                                top:0; display: block; margin: 0; padding: 0;" class="'+
this._container.attr("class")+'">'+this._content.html()+"</div>").appendTo(_DATA.dispatcher_container);null!==this.options.maxWidth&&b.width()>this.options.maxWidth&&b.width(this.options.maxWidth+"px");var c={width:b.outerWidth(),height:Math.round(b.height())};b.remove();return c}}),this.container.Tip("showAt",this.target,"right"))},hide:function(){this.container.Tip("hide",!0)},destroy:function(){this.autoPopulatePopup&&this.autoPopulatePopup.destroy();this.autoPopulatePopup=null;for(var c in this._events_uids)this.removeListener(parseInt(c));
this.container.Tip("destroy");this.container.remove();this.container=null;d.prototype.destroy.apply(arguments)},onChange:function(c){this.model.setStatusBit(this.coord,this.model.STATUS.READONLY,c.target.checked)},onAutoPopulateClick:function(c){if(this.autoPopulatePopup){this.hide();var b=c.target.checked;"undefined"===typeof b&&(c=c.target.parentNode,0<c.getElementsByTagName("input").length&&"undefined"!==typeof c.getElementsByTagName("input")[1]&&(b=c.getElementsByTagName("input")[1].checked));
this.autoPopulatePopup.setRecurrenceCheckboxValue(b);this.autoPopulatePopup.hide();this.autoPopulatePopup.setCoord(this.coord);this.autoPopulatePopup.show()}},setAutoPopulatePopup:function(c){this.autoPopulatePopup=c}})}());READ_ONLY=1;READ_WRITE=2;
toa.ns("toa.views.quota.PopupCellLockNew",function(){var d=toa.views.quota.Popup;return toa.define(d,function(c){this.model=c;this.target=$();this.hideHandler=this.hide.bind(this);this.autoPopulatePopupNew=null;this.isReadWriteAccess=this.model.access===READ_WRITE;this.init()},{init:function(){this.container=$(['<div><div class="capacity-cell-lock-popup"><label name="modify_recurrence" ><input type="checkbox" name="recurrence">',toa.glossary({id:11479}),'</label> <span role="link" class="hint_link span_link" name="modify_recurrence" >',toa.glossary({id:462}),
"</span></div></div>"].join("")).Tip({closable:!1,callout:{side:"left",position:"center"}});this.container.find('[name="modify_recurrence"]').on("click",this.onAutoPopulateClick.bind(this))},show:function(c){this.target=c.target;this.coord=c.coord;var b=!1;this.hide();c.container=this.container;c.model=this.model;if(this.isReadWriteAccess){if(this.isReadWriteAccess&&this.model.isMassPopulateOptionsSet())if(c=this.model.getAutoPopulateData(this.coord.field,this.coord.category,"status"),this.isReadWriteAccess){if(c&&
"active"===c)for(b=this.container.find('input[name="recurrence"]'),c=0;c<b.length;c++)b[c].checked=!0;else for(b=this.container.find('input[name="recurrence"]'),c=0;c<b.length;c++)b[c].checked=!1;this.container.find('[name="modify_recurrence"]').show();b=!0}else this.container.find('[name="modify_recurrence"]').hide();else this.container.find('[name="modify_recurrence"]').hide();b&&(this.container.Tip("option",{className:"toaui-autoPopulateTip",callout:{side:"left",position:"center"},size:function(){var b=
$('<div style="position: absolute; left:-10000px;                                top:0; display: block; margin: 0; padding: 0;" class="'+this._container.attr("class")+'">'+this._content.html()+"</div>").appendTo("body");null!==this.options.maxWidth&&b.width()>this.options.maxWidth&&b.width(this.options.maxWidth+"px");var c={width:b.outerWidth(),height:Math.round(b.height())};b.remove();return c}}),this.container.Tip("showAt",this.target,"right"))}},hide:function(){this.container.Tip("hide",!0)},destroy:function(){this.autoPopulatePopupNew&&
this.autoPopulatePopupNew.destroy();this.autoPopulatePopupNew=null;for(var c in this._events_uids)this.removeListener(parseInt(c));this.container.Tip("destroy");this.container.remove();this.container=null;d.prototype.destroy.apply(arguments)},onAutoPopulateClick:function(c){if(this.autoPopulatePopupNew){this.hide();var b=c.target.checked;"undefined"===typeof c.target.checked&&(c=c.target.parentNode,1==c.getElementsByTagName("input").length&&(b=c.getElementsByTagName("input")[0].checked));this.autoPopulatePopupNew.setRecurrenceCheckboxValue(b);
this.autoPopulatePopupNew.hide();this.autoPopulatePopupNew.setCoord(this.coord);this.autoPopulatePopupNew.show()}},setAutoPopulatePopup:function(c){this.autoPopulatePopupNew=c}})}());toa.ns("toa.views.quota.PopupContentWorkzoneStatusReadonly",function(){return toa.define(toa.views.quota.PopupContent,null,{postRender:function(){this.options.container.find("#view-history").on("click",this.showHistory.bind(this))},getHtml:function(){this.options.container.Tip("option","className","toaui-workzoneTip jet-css-only quota-workZoneStatusTip");var d=this.options,c=this.options.coord,b=this.model.getDayWorkzones(c),e=b.length&&c.category,g="",k=toa.date.formatDate("date_long",toa.date.parseDate("iso",
c.day)),l=this.model.getCategoryName(c.category),n=this.decorateTimeSlot(c.timeSlot),g=g+('<div class="toaui-workzoneTip-title"><div class="toaui-workzoneTip-title-main"><span>'+h(11421)+'</span></div><div class="toaui-workzoneTip-title-cell"><span>&nbsp;'+k+" | "+l+" "+n+"</span></div></div>"),g=g+'<div class="toaui-workzoneTip-content">';d.visibilities&&d.visibilities.quota_history&&(g+='<div class="quota-history-link">'+(e?"<strong>"+h(11419)+"</strong>":"&nbsp;"));e&&(g+=this.makeWorkZoneList(b,
c));return g},makeWorkZoneList:function(d,c){if(!this.model.getBucketSettings(c).isWorkzonesCloseAllowed())return"";var b="",e=this.model.get(c,"close_time",""),g=this.model.get(new toa.models.quota.Coordinate({bucket:c.bucket}),"current_date");toa.date.getDateFromDateTime(e)<g&&(e="");for(var k=this.model.get(c,"closed_at",""),l=this.model.get(c,"status",""),b='<div class="toaui-workzoneTip-main-content"><table>',n=c.clone(),p=0;p<d.length;p++){var s=+d[p].id,t=d[p].name;n.workzone=s;var u=this.model.get(n,
"status"),u=this.calculateWorkzoneStatus(u,l)?"checked=checked":"",v=this.model.get(n,"close_time","");toa.date.getDateFromDateTime(v)<g&&(v="");var w=this.model.get(n,"closed_at",""),x=toa.date.formatAdaptive(w||v||k||e,n.day),v=w||v?"":"capacity_disabled",b=b+('<tr><td><input type="checkbox" disabled="disabled" class="wz_quota" id="workzone_'+s+'" data-wzid="'+s+'" '+u+' /></td><td class="wz-name"><label for="workzone_'+s+'">'+hs(t)+'</label></td><td class="cap-time '+v+'" >'+x+"</td></tr>")}return b+
"</table></div>"},calculateWorkzoneStatus:function(d,c){var b=this.model.STATUS;return d&b.OPEN?!0:d&b.CLOSED?!1:c&b.OPEN?!0:c&(b.CLOSED|b.CLOSED_ON_TOP_LEVEL)?!1:!0},showHistory:function(){console.log("Not implemented")}})}());toa.ns("toa.views.quota.PopupContentWorkzoneStatus",function(){var d=toa.views.quota.PopupContentWorkzoneStatusReadonly;return toa.define(d,null,{postRender:function(){this.processCheckboxVisibility();this.options.container.find("#button-ok").on("click",this.onApply.bind(this));this.options.container.find("#button-cancel").on("click",this.close);this.options.container.find("#button-open-all").on("click",this.onOpenAll.bind(this));this.options.container.find("#button-close-all").on("click",this.onCloseAll.bind(this));
d.prototype.postRender.apply(this)},processCheckboxVisibility:function(){var c=this.options.coord,b=this.model.getDayWorkzones(c),c=c.clone(),d;for(d in b){var g=+b[d].id;c.workzone=g;this.model.get(c,"status")&this.model.STATUS.READONLY||this.options.container.find("#workzone_"+g).removeAttr("disabled")}},getHtml:function(){var c=d.prototype.getHtml.apply(this),c=c+('<div class="toaui-workzoneTip-buttons-do-all"><button id="button-open-all" class="toa-button"><div></div>'+h(11425)+'</button><button id="button-close-all" class="toa-button"><div></div>'+
h(11426)+"</button></div>");return c+=this.makeButtons()},apply:function(c){var b=this.options.coord.clone(),d={};this.options.container.find("input.wz_quota").each(function(b,c){var l=+c.getAttribute("data-wzid");d[l]=!!c.checked}.bind(this));this.model.setWorkzonesStatus(b,c,d);this.close()},onApply:function(){this.apply(null)},onOpenAll:function(){this.options.container.find("input.wz_quota").attr("checked","checked");this.apply(this.model.STATUS.OPEN)},onCloseAll:function(){this.options.container.find("input.wz_quota").removeAttr("checked");
this.apply(this.model.STATUS.CLOSED)}})}());toa.ns("toa.views.quota.PopupContentWorkzoneCloseTime",function(){return toa.define(toa.views.quota.PopupContent,null,{getHtml:function(){var d=this.options;this.options.container.Tip("option","zIndex",1002);this.options.container.Tip("option","className","toaui-workzoneTip jet-css-only quota-closeTimeTip");var c=this.options.coord,b=this.model.getCategoryName(c.category),e=this.decorateTimeSlot(c.timeSlot),g=this.model.get(c,"closed_at",""),k=this.model.get(c,"close_time",""),l=this.timeToUserFormat(k),
n=generate_id(),p="",l=this.timeToUserFormat(k),p=p+('<div class="toaui-workzoneTip-title"><div class="toaui-workzoneTip-title-main"><span>'+h(11418)+'</span></div><div class="toaui-workzoneTip-title-cell"><span>&nbsp;'+b+" "+e+"</span></div></div>"),p=p+'<div class="toaui-workzoneTip-content">'+('<div class="quota-closetime"><div class="close-quota-time-label"><span id="close-quota-time-label__'+n+'">'+h(11430)+"</span></div>");g?(c=toa.date.formatAdaptive(g,c.day),p+='<div class="toa-quota-closedat">'+
c+"</div>"):(p+='<input aria-labelledby="close-quota-time-label__'+n+'" class="closetime-input category_closetime" id="workzone_all" data-wzid=0 value="'+l+'" />',p+=this.getDayBefore(c.day,k,n));p+="</div>";d.visibilities&&d.visibilities.quota_history&&(p+='<div class="quota-history-link"></div>');p+='<div class="toaui-workzoneTip-upper-line">&nbsp;</div>';p+=this.makeWorkZoneList();p+='<div id="closetime_error_message">'+h(3287)+"</div>";return p+=this.makeButtons()},makeWorkZoneList:function(){var d=
this.options.coord,c=generate_id();if(!this.model.getBucketSettings(d).isWorkzonesCloseAllowed())return"";var b=this.model.getDayWorkzones(this.options.coord);if(!b.length||!d.category)return"";for(var e='<div class="close-quota-time-label"><span class="close-quota-time-label_'+c+'">'+h(11431)+'</span></div><div class="toaui-workzoneTip-main-content"><table>',g=d.clone(),k=0;k<b.length;k++){var l=b[k].id,n=b[k].name;g.workzone=l;var p=this.model.get(g,"closed_at",""),s=this.model.get(g,"close_time",
""),t=this.timeToUserFormat(s),e=e+('<tr class="quota-closetime"><td class="wz-name"><label id="close-quota-time-label__'+c+"-"+l+'" for="workzone_'+l+'">'+hs(n)+"</label></td>");p?(l=toa.date.formatAdaptive(p,d.day),e+='<td colspan="2">'+l+"</td>"):e+='<td><input class="closetime-input wz_closetime" id="workzone_'+l+'" data-wzid="'+l+'" value="'+t+'" /></td><td>'+this.getDayBefore(d.day,s,c+"-"+l)+"</td>";e+="</tr>"}return e+"</table></div>"},postShow:function(){this.options.container.find("#button-ok").on("click",
this.onApply.bind(this));this.options.container.find("#button-cancel").on("click",this.close);this.options.container.find("#view-history").on("click",this.showHistory.bind(this));var d={source:this.getTimeAutocompleteList(),delay:0,minLength:0,appendTo:_DATA.dispatcher_container};this.options.container.find(".closetime-input").bind("focusin",function(c){c=$(c.target).offset().top;250>=$(window).height()-c?$(this).autocomplete("option","position",{my:"left bottom",at:"left top"}):$(this).autocomplete("option",
"position",{my:"left top",at:"left bottom"})});this.options.container.find(".closetime-input").bind("focus",function(){$(this).autocomplete("search","")}).autocomplete(d);this.options.container.Tip("option","notOutsideElements",$(".ui-autocomplete, .tip-select"))},onApply:function(){var d=[];this.hideError();var c=!1;this.options.container.find(".quota-closetime").each(function(b,e){var g=$(e).find("input.closetime-input");if(!g.length)return!0;var k=$(e).find("select"),t=+g.attr("data-wzid");try{var u=
this.timeFromUserFormat(g.val());d.push({id:t,time:u,dayBefore:+k.val()});g.removeClass("closetime_error_cell")}catch(v){g.addClass("closetime_error_cell"),c=!0,this.showError()}}.bind(this));if(!c){for(var b=this.options.coord.clone(),e=0;e<d.length;e++){var g=d[e];b.workzone=g.id;var k="";g.time&&(k=this.calculateFullCloseTime(b.day,g.time,g.dayBefore));this.model.set(b,"close_time",k)}this.close()}},calculateFullCloseTime:function(d,c,b){d=new Date(toa.date.parseDate("iso_long",d+" 12:00:00")-
b*toa.date.DAY);d=toa.date.formatDate("iso_long",d);return d=d.substr(0,d.indexOf(" "))+" "+c+":00"},getTimeAutocompleteList:function(){for(var d=[],c="00:00 00:30 01:00 01:30 02:00 02:30 03:00 03:30 04:00 04:30 05:00 05:30 06:00 06:30 07:00 07:30 08:00 08:30 09:00 09:30 10:00 10:30 11:00 11:30 12:00 12:30 13:00 13:30 14:00 14:30 15:00 15:30 16:00 16:30 17:00 17:30 18:00 18:30 19:00 19:30 20:00 20:30 21:00 21:30 22:00 22:30 23:00 23:30".split(" "),b=0;b<c.length;b++)d.push(this.timeToUserFormat("4000-01-01 "+
c[b]+":00"));return d},getDayBefore:function(d,c,b){b=['<select class="close-quota-time-day" aria-labelledby="close-quota-time-label__'+b+'">'];var e=this.options.dayOffsetOptions,g="";c&&(g=toa.date.getDatesOffset(c,d));for(d=0;d<e.length;d++)c=e[d],b.push('<option value="',c.id,'"',g===c.id?' selected="selected" ':"",">",c.text,"</option>");b.push("</select>");return b.join("")},hideError:function(){this.options.container.find("#closetime_error_message").css("visibility","hidden")},showError:function(){this.options.container.find("#closetime_error_message").css("visibility",
"visible")},showHistory:function(){console.log("Not implemented")}})}());toa.ns("toa.views.quota.EditBox",function(){return toa.define(null,function(d){this.options=d||{};this.options.onApply=this.options.onApply||function(){};this.options.onCancel=this.options.onCancel||function(){};this.options.onFocusNextCell=this.options.onFocusNextCell||function(){};this.options.onValidate=this.options.onValidate||function(c){return c};this.editBox=$('<input class="toa-quota-editbox" type="text" >').hide().on("keyup",this.onKeyup.bind(this)).on("blur",this.apply.bind(this));this.storedValue=
0;this.KEYCODES={ENTER:13,ESC:27}},{destroy:function(){this.metaData=null;if(this._events_uids)for(var d in this._events_uids)this.removeListener(parseInt(d));this.editBox.off("keyup").off("blur");this.editBox.remove();this.target=this.storedText=this.editBox=null},show:function(d,c){this.keyAction=c;this.target&&this.target[0]===d[0]||(this.target=$(d),this.storedText=this.target.text(),this.storedValue=parseFloat(this.storedText),isNaN(this.storedValue)&&(this.storedValue=""),this.target.empty().append(this.editBox),
this.editBox.val(this.storedValue).show().trigger("select"))},apply:function(d){if(this.target){var c=this.target.attr("id"),b=this.options.onValidate(this.editBox.val(),this.storedValue,this.target,this.storedText);if(!1===b||b===parseFloat(this.storedText))this.cancel(d.keycode||null);else{var e=this.target;this.target=null;this.editBox.detach().val("");this.options.onApply(e,b,d.keycode||null)}if(d.focusNextCell)this.options.onFocusNextCell(c)}},cancel:function(d){if(this.target){var c=this.target;
this.target=null;this.editBox.detach().val("");c.empty().text(this.storedText);this.options.onCancel(c,this.storedValue,d);this.storedValue=0}},onKeyup:function(d){this.keyAction?this.keyAction=!1:d.keyCode===this.KEYCODES.ESC?this.cancel(this.KEYCODES.ESC):d.keyCode===this.KEYCODES.ENTER&&this.apply({focusNextCell:!0,keycode:this.KEYCODES.ENTER})}})}());toa.ns("toa.views.quota.ViewHelper",function(){return toa.define(null,function(){this.scrollStep=40;this.scrollThickness=this.calculateScrollThickness();this.resizeCapacityTableDebounced=toa.utils.func.debounce(this.resizeCapacityTable.bind(this),200);this.tableViewport=null},{bindEvents:function(){this.onWindowResize=toa.utils.func.debounce(this.onWindowResize.bind(this),200);$(window).on("resize",this.onWindowResize);toa.app.bind("layout.panels.resized",this.onPanelResize,this);this.zoomTracerWidth=
$("#zoomTracer").width()},unBindEvents:function(){$(window).off("resize",this.onWindowResize);toa.app.unbind("layout.panels.resized",this.onPanelResize,this)},onWindowResize:function(){var d=$("#zoomTracer").width();this.zoomTracerWidth!=d?(this.onZoom(),this.zoomTracerWidth=d):this.resizeCapacityTable()},onPanelResize:function(){this.resizeCapacityTable()},onZoom:function(){this.scrollThickness=this.calculateScrollThickness();this.setCapacityTableNegativeMargins();this.syncTableHeadersWidth();this.resizeCapacityTable()},
unBindScrolls:function(){$("#capacity_table_container").off("mousewheel");this.scroll_h.off("scroll");this.scroll_v.off("scroll")},bindScrolls:function(){var d=this;d.scroll_h=$("#capacity_horiz_scroll");d.scroll_v=$("#capacity_vert_scroll");d.scrolled_all=$("#capacity_div_scrollable");d.scrolled_h=$("#capacity_div_horiz_scrolled_header");d.scrolled_v=$("#capacity_div_vert_scrolled_header");d.scroll_h.scroll(function(){d.onTableHorizScroll(d.scroll_h.scrollLeft(),d.scrolled_h,d.scrolled_all,d.scroll_h)});
d.scroll_v.scroll(function(){d.onTableVertScroll(d.scroll_v.scrollTop(),d.scrolled_v,d.scrolled_all,d.scroll_v)});$("#capacity_table_container").on("mousewheel",function(c,b,e,g){if(e)d.onTableHorizScroll(d.scrolled_all.scrollLeft()+e*d.scrollStep,d.scrolled_h,d.scrolled_all,d.scroll_h);if(g)d.onTableVertScroll(d.scrolled_all.scrollTop()-g*d.scrollStep,d.scrolled_v,d.scrolled_all,d.scroll_v);return!1});if(toa.dom.isTouch)$("#capacity_table_container").on("touchstart",function(c){c=c.originalEvent.touches[0];
var b=c.screenX,e=c.screenY;$(this).on("touchmove",function(c){c=c.originalEvent.touches[0];d.onTableHorizScroll(d.scrolled_all.scrollLeft()-(c.screenX-b),d.scrolled_h,d.scrolled_all,d.scroll_h);d.onTableVertScroll(d.scrolled_all.scrollTop()-(c.screenY-e),d.scrolled_v,d.scrolled_all,d.scroll_v);b=c.screenX;e=c.screenY});$(this).on("touchend",function(b){$(this).off("touchmove");$(this).off("touchend")})})},destroy:function(){this.scroll_h.remove();this.scroll_h=null;this.scroll_v.remove();this.scroll_v=
null;this.scrolled_all.remove();this.scrolled_all=null;this.scrolled_h.remove();this.scrolled_h=null;this.scrolled_v.remove();this.tableViewport=this.scrolled_v=null},onTableHorizScroll:function(d,c,b,e){b.scrollLeft(d);c.scrollLeft(d);e.scrollLeft(d)},onTableVertScroll:function(d,c,b,e){b.scrollTop(d);c.scrollTop(d);e.scrollTop(d)},resizeCapacityTable:function(){var d=toa.browser.webkit?1:0,c=$("#capacity_div_scrollable");if(c.length){var b=$("#capacity_table_container"),e=$("#capacity_table_scrollable"),
g,k,l,n;g=$("#content_content").height()-$("#capacity_save_container").outerHeight()-$("#footer").height()-$("#capacity_locked").height()-$("#capacity_msg").height()-parseInt(b.css("paddingTop"))-parseInt($("#capacity_content").css("paddingTop"))-2;var p=e.outerHeight();k=b.width()-1;e.width(1);b=e.outerWidth();p<=g-(b>k?this.scrollThickness:0)?(g=p,l=0):(g-=b>k?this.scrollThickness:0,l=this.scrollThickness);b<=k-l?(k=b,n=0):(k-=l,n=this.scrollThickness);c.height(g).width(k+d);$("#capacity_div_vert_scrolled_header").height(g-
this.headerTopHeight+n+1);$("#capacity_div_horiz_scrolled_header").width(k-this.headerLeftWidth+l+1);$("#capacity_horiz_scrolled_table").width(e.width()-this.headerLeftWidth+2+l);l?($("#space_for_vert_scroll").show(),$("#capacity_vert_scroll").width(l+1).css("margin-left",-1*l-1+"px").height(g-this.headerTopHeight).show(),$("#capacity_inner_vert_scroll").height(p-this.headerTopHeight)):($("#capacity_vert_scroll").hide(),$("#space_for_vert_scroll").hide());n?($("#space_for_horiz_scroll").height(n+
1).show(),$("#capacity_horiz_scroll").height(n+1).css("margin-left","1px").css("margin-top","-1px").width(k-this.headerLeftWidth).show(),$("#capacity_inner_horiz_scroll").width(b-this.headerLeftWidth)):($("#capacity_horiz_scroll").hide(),$("#space_for_horiz_scroll").hide());this.calculateTableViewport();this.setSaveContainerWidth()}},setCapacityTableNegativeMargins:function(){var d=$("#capacity_div_nonscrolled_header"),c=$('div[data-id="capacity_orig_header"]');c.length&&($("#capacity_nonscroll_header").width(c.width()),
$("#capacity_nonscroll_header2").width($('div[data-id="capacity_orig_header2"]').width()),$("#capacity_bucket_nonscroll_header").width($("#capacity_bucket_orig_header").width()));this.headerTopHeight=Math.max(d.height(),$("#capacity_div_horiz_scrolled_header").height());this.headerLeftWidth=Math.max(d.width(),$("#capacity_div_vert_scrolled_header").width());$("#capacity_div_scrollable").css({marginTop:this.headerTopHeight?-1*this.headerTopHeight+1:0,marginLeft:this.headerLeftWidth?-1*this.headerLeftWidth+
1:0});$("#inner_space_for_vert_scroll").width(this.scrollThickness-1);this.initWidthAndHeight()},syncTableHeadersWidth:function(){var d=[],c=[],b=[];$("#capacity_horiz_scrolled_table").find(".small_header").each(function(){var e=$(this);c.push(e);e=$("#main"+e.attr("id"));b.push(e);d.push(e.width())});for(var e=0;e<d.length;e++)c[e].width(d[e]),b[e].width(d[e])},initWidthAndHeight:function(){$("#capacity_non_scrolled_table").height(this.headerTopHeight);$("#capacity_horiz_scroll__table").height(this.headerTopHeight);
this.refreshSyntheticScrollSizes()},refreshSyntheticScrollSizes:function(){var d=$("#capacity_table_scrollable");$("#capacity_inner_vert_scroll").width(1).height(d.height()-this.headerTopHeight+1);$("#capacity_inner_horiz_scroll").height(1).width(d.width())},calculateScrollThickness:function(){var d=$('<div style="position:absolute; left:-10000px; top:0;display: block;   overflow-y: scroll;"></div>').appendTo("body"),c=d[0].offsetWidth-d[0].clientWidth;if(c||0<=navigator.userAgent.indexOf("Edge"))d.width(c),
d[0].offsetWidth==d[0].clientWidth&&c++;d.remove();return c},setSaveContainerWidth:function(){var d=$("#capacity_save_container");if(d.length){var c=$("#capacity_div_scrollable"),b=$("#capacity_table_manage_scrollers"),c=Math.max(c.width(),b.outerWidth()),c=c-60;d.width(c);200>c&&d.find(".toa-button").css({"margin-top":"5px"})}},calculateTableViewport:function(){var d=$("#capacity_div_scrollable").parent();this.tableViewport=d.offset();this.tableViewport.bottom=this.tableViewport.top+d.height();this.tableViewport.right=
this.tableViewport.left+d.width()},scrollToCell:function(d){var c=this.tableViewport;d=$("#"+d);var b=d.offset(),e=0,e=b.top-c.top;0>e?this.scroll_v.scrollTop(this.scroll_v.scrollTop()+e):(e=b.top+d.height()-c.bottom,0<e&&this.scroll_v.scrollTop(this.scroll_v.scrollTop()+e));e=b.left+d.width()-c.right;0<e?this.scroll_h.scrollLeft(this.scroll_h.scrollLeft()+e):(e=b.left-c.left,0>e&&this.scroll_h.scrollLeft(this.scroll_h.scrollLeft()+e))}})}());toa.ns("toa.views.quota.View",function(){var d=toa.define(null,function(){},{setModel:function(c){this.model=c},render:function(){},setErrorMessage:function(c){$("#capacity_save_label").css("color","red").html(c)},setMessage:function(c){$("#capacity_save_label").css("color","blue").html(c)},removeMessage:function(){$("#capacity_save_label").css("color","").empty()},destroy:function(){this.editBox&&this.editBox.destroy();this.editBox=null;this.helper&&this.helper.unBindScrolls();this.helper&&this.helper.unBindEvents();
this.helper&&this.helper.destroy();this.helper=null;this.container.empty();this.container=null}});toa.mixin(d.prototype,toa.mixins.EventEmitter);return d}());toa.ns("toa.views.quota.ViewTable",function(){var d=toa.models.quota.Coordinate,c=toa.views.quota.View,b=toa.define(c,function(b,c){var d=this;this.percentPrecision=2;this.container=null;this.lookups=c;b&&this.setModel(b);this.editBox=new toa.views.quota.EditBox({onApply:this.onCellEdit.bind(this),onValidate:this.onCellEditValidate.bind(this),onCancel:this.onCellCancel.bind(this),onFocusNextCell:this.onFocusNextCell.bind(this)});this.autoPopulatePopup=new toa.views.quota.PopupAutoPopulate(b);this.autoPopulatePopup.addListener("saveAutoPopulate",
function(b,c){d.notify("saveAutoPopulatePopup",c)});this.lockPopup=new toa.views.quota.PopupCellLock(b);this.lockPopup.setAutoPopulatePopup(this.autoPopulatePopup);this.visibleColumns=null;this.filterValues={};this.isRenderStopped=!1;this.readOnly=!0},{PERCENT_FIELDS:"quota_percent stop_booking_at weight estimated_quota_percent used_quota_percent available_capacity_percent".split(" "),COLORED_FIELDS:"used quota count quota_percent used_quota_percent min_quota other_activities available_capacity_percent estimated_quota_percent weight".split(" "),
LOCKABLE_FIELDS:["quota","quota_percent"],setModel:function(b){this.model=b;this.setDeltaHandlerId=this.model.addListener("setDelta",function(b,c){this.isRenderStopped||(this.setChangeCorner(b,c),this.refreshValues(b,c),this.refreshStatusSign(b,c),this.refreshSectorColor(b,c),this.refreshBookingColor(b,c),this.refreshCellLock(b,c))},this);this.removeDeltaHandlerId=this.model.addListener("removeDelta",function(b,c){this.isRenderStopped||(this.removeChangeCorner(b,c),this.refreshValues(b,c),this.refreshStatusSign(b,
c),this.refreshSectorColor(b,c),this.refreshBookingColor(b,c),this.refreshCellLock(b,c))},this);this.bucketId=this.model.getBuckets()[0];this.isMultiBucket=!1},destroy:function(){this.model.removeListener(this.setDeltaHandlerId);this.model.removeListener(this.removeDeltaHandlerId);this.lockPopup&&this.lockPopup.destroy();this.lockPopup=null;this.autoPopulatePopup&&this.autoPopulatePopup.destroy();this.autoPopulatePopup=null;c.prototype.destroy.apply(this,arguments)},render:function(b){this.container=
$(b);b=this.getMainTemplate().apply();b+=this.getZoomTracerHtml();this.container.html(b);this.helper=new toa.views.quota.ViewHelper;this.helper.setCapacityTableNegativeMargins();this.helper.syncTableHeadersWidth();this.helper.resizeCapacityTable();this.helper.bindEvents();this.helper.bindScrolls();this.bindTableEvents()},bindTableEvents:function(){var b=this;this.container.find("#capacity_div_scrollable").on("click",".readwriteCell[data-label=status]",function(c){c=$(this);var d=b.idToCoord(c.attr("id"));
b.notify("statusClicked",c,d)}).on("click",".readonlyCell[data-label=status]",function(c){c=$(this);var k=b.idToCoord(c.attr("id"));"category"===(new d(k)).getLevelName()&&b.notify("readonlyStatusClicked",c,k)}).on("click",".readwriteCell[data-label=close_time]",function(c){c=$(this);var d=b.idToCoord(c.attr("id"));b.notify("closeTimeClicked",c,d)}).on("click",".readwriteCell[data-edittype=text]",function(c){b.onReadWriteClick(c,this)}).on("keydown",".readwriteCell[data-edittype=text]",function(c){if(c.keyCode||
c.charCode)if(13!==(c.keyCode||c.charCode)||"INPUT"===c.target.tagName)return;c.preventDefault();c.stopPropagation();b.onReadWriteClick(c,this,!0)}).on("scroll",function(){b.lockPopup.hide();b.notify("scroll")})},onReadWriteClick:function(b,c,d){b=$(c);c=this.idToCoord(b.attr("id"));this.editBox.show(b,d);this.lockPopup.show({target:b,coord:c,lockable:this.isCellLocable(c.field)})},pauseRender:function(){this.isRenderStopped=!0},resumeRender:function(){this.isRenderStopped=!1;this.render(this.container)},
coordToId:function(b,c){return[b.bucket,b.day,b.timeSlot?b.timeSlot:"",b.category?b.category:"",c].join("__")},idToCoord:function(b){b=b.split("__");var c=new d({bucket:+b[0],day:b[1],timeSlot:+b[2],category:+b[3]});c.field=b[4];return c},getDateFields:function(b){var c=this.model.getDaysFields(b.day);c||(c=this.model.get(b.clone({timeSlot:null}),"fields",0));this.visibleColumns&&(c&=this.visibleColumns);return this.model.maskToFieldsLabels(c)},getDates:function(){return this.model.get(new d({bucket:this.bucketId}),
"ids",[])},getHorizontalScrolledHeader:function(){for(var b=this.getDates(),c="",k="",l=new d({bucket:this.bucketId,day:"any"}),n=0;n<b.length;n++){var p=b[n],s=n===b.length-1,t=s?"":"vs";l.setId(p);var u=this.getDateFields(l),v=this.formatDate(p),c=c+['<td class="h ',t,'" colspan="',u.length,'"><b>',v,"</b></td>"].join(""),k=k+this.getHeaderSector(p,s,"topTh")}return['<table id="capacity_horiz_scrolled_table" class="capacity"><tr class="h">',c,'<td id="space_for_vert_scroll" rowspan="2" ><div id="inner_space_for_vert_scroll"></div></td></tr><tr class="h">',
k,"</tr></table>"].join("")},getHorizontalInsideHeader:function(){for(var b=this.getDates(),c="",k="",l=!1,n=new d({bucket:this.bucketId,day:"any"}),p=0;p<b.length;p++){var s=(l=p===b.length-1)?"":"vs",t=b[p];n.setId(t);var u=this.getDateFields(n),v=this.formatDate(t),c=c+('<td class="h '+s+'" colspan="'+u.length+'"><b>'+v+"</b></td>"),k=k+this.getHeaderSector(t,l,"maintopTh")}return[c,'</tr><tr class="h">',k].join("")},getHeaderSector:function(b,c,k){for(var l="",n="",p=this.getDateFields(new d({bucket:this.bucketId,
day:b})),s=0;s<p.length;s++)l=s!==p.length-1||c?"":"vs",n+=['<td class="'+l+'">','<div class="small_header" id="',k+b+s+'">',this.model.getFieldNameByLabel(p[s]),"</div></td>"].join("");return n},getSectorHtml:function(b,c,d){for(var l="",n=this.getDateFields(b),p=this.model.get(b,"rw",0),s=this.isFilterByEntityApplied(),p=this.model.maskToFieldsLabels(p),t=0;t<n.length;t++){var u=n[t],v=-1===$.inArray(u,p)||s&&this.isCellLocable(u);-1!==$.inArray(u,p)&&this.isQuotaDefinedInMinutesOnCapacityCategory(u,
b)&&(v=!1);this.readOnly&&(v=!0);u=this.getCellHtml(b,u,v,t===n.length-1&&!c,d);l+=u}return l},getSectorTotalHtml:function(b,c,d){var l="",n=this.getDateFields(b),p=[];this.isTotalReadOnly(b)||(p=this.model.get(b,"rw",0),p=this.model.maskToFieldsLabels(p));for(var p=toa.flipHash(p),s=0;s<n.length;s++){var t=n[s],u=!(t in p),v=s===n.length-1;t in{status:1,close_time:1,stop_booking_at:1,quota_percent:1,min_quota:1}&&(u=!0,t="_none");t=this.getCellHtml(b,t,u,v&&!c,d);l+=t}return l},getCellHtml:function(b,
c,d,l,n){var p=d?"readonlyCell":"readwriteCell",s="text",t=this.model.get(b,c),u=null!==this.model.getDelta(b,c);l=(l?"vs ":"")+(n?"hs ":"");n=this.getTitleText(c,b);u&&"status"!=c&&"close_time"!=c&&(l+="changed-cell ",n&&(n='title = "'+n+'" '));t=this.formatValue(c,t);this.isColoredField(c)&&(l+=this.getCellColorClass(b)+" ");!d&&this.isCellLocable(c)&&this.model.isLocked(b)&&(l+="capacity-cell-locked ");switch(c){case "stop_booking_at":l+=this.getBookingCellColorClass(b)+" ";break;case "status":s=
"popup";l+=this.getStatusClass(b);t="<div>&nbsp;</div>";break;case "close_time":d=this.model.getSectorCloseTime(b),l+=d.isSectorChanged?"changed-cell ":"",s="popup",t=this.getCloseTimeText(b)}return['<td id="',this.coordToId(b,c),'" ',"readwriteCell"===p?'tabindex="0" ':"",'class="',p," ",l,'" data-label="',c,'" data-edittype="',s,'" title="',n,'">',t,"</td>"].join("")},getCell:function(b,c){var d=this.coordToId(b,c).replace(":","\\:");return this.container.find("#"+d)},isColoredField:function(b){return toa.isDefined(this.COLORED_FIELDS_INDEX[b])},
getCellColorClass:function(b){var c=this.model.get(b,"used"),d=this.model.get(b,"quota");b=this.model.get(b,"used_quota_percent");var l=toa.app.model("companySettings").getQuotaThreshold(1),n=toa.app.model("companySettings").getQuotaThreshold(2);return null===c||null===d?b?100<b?"hl":b>100*l&&b<=100*n?"ml":b>100*n&&100>=b?"sl":"ll":"nl":c||d?c>d?"hl":c>l*d&&c<=n*d?"ml":c>n*d&&c<=d?"sl":"ll":"nl"},getBookingCellColorClass:function(b){var c;c=this.model.get(b,"stop_booking_at");b=b.getParent();b=this.model.get(b,
"used_quota_percent");return c&&b&&c<=b?"ml ":"ll "},getZoomTracerHtml:function(){return'<div id="zoomTracer" style="font-size: 1em; position: fixed; left: -1000px;">This element is made for keeping an eye on zoom event.</div>'},formatDate:function(b){return toa.date.formatDate("date_long",toa.date.parseDate("iso",b))},updateSaveButtonContainer:function(){this.helper.setSaveContainerWidth()},setChangeCorner:function(b,c){var d=this.getCell(c.coord,c.field);d.addClass("changed-cell");var l=this.getTitleText(c.field,
c.coord,c.oldValue);l&&d.attr("title",l)},getTitleText:function(b,c,d){if(!b)return"";if("status"===b)return toa.glossary({id:11427});if("close_time"===b)return toa.glossary({id:11429});if("undefined"!==typeof d&&null!==d){if("quota_percent"==b||"used_quota_percent"==b)d=this.toPrecision(d)+"%";return toa.glossary({id:11428,translations:{"{OLD_VALUE}":d}})}return""},removeChangeCorner:function(b,c){this.getCell(c.coord,c.field).removeClass("changed-cell").removeAttr("title")},refreshStatusSign:function(b,
c){var d=this.getStatusClass(c.coord);this.getCell(c.coord,c.field).removeClass("tick").removeClass("half").removeClass("cross").addClass(d)},refreshCellLock:function(b,c){if("status"===c.field&&!c.coord.workzone)for(var d=this.model.get(c.coord,"status")&this.model.STATUS.READONLY,l=0;l<this.LOCKABLE_FIELDS.length;l++){var n=this.getCell(c.coord,this.LOCKABLE_FIELDS[l]);d?n.addClass("capacity-cell-locked"):n.removeClass("capacity-cell-locked")}},getStatusClass:function(b){b=this.model.getSectorStatus(b);
return{open:"tick",closed:"cross",half:"half",empty:" "}[b.status]+(b.isChanged?" changed-cell ":"")},refreshValues:function(b,c){var d="",l="";"close_time"===c.field?d=this.getCloseTimeText(c.coord):"status"!==c.field&&(l=this.model.get(c.coord,c.field),d=this.formatValue(c.field,l));this.getCell(c.coord,c.field).text(d);this.helper.resizeCapacityTableDebounced()},getCloseTimeText:function(b){var c="",d=this.model.getSectorCloseTime(b);d.cellClosedAt?c+=toa.date.formatAdaptive(d.cellClosedAt,b.day):
d.cellCloseTime&&(c+=toa.date.formatAdaptive(d.cellCloseTime,b.day));d.isWorkzonesCloseTime&&(c+="*");return c},refreshSectorColor:function(b,c){if(this.isColoredField(c.field))for(var d=this.getCellColorClass(c.coord),l=0;l<this.COLORED_FIELDS.length;l++)this.getCell(c.coord,this.COLORED_FIELDS[l]).removeClass("nl").removeClass("hl").removeClass("ml").removeClass("sl").removeClass("ll").addClass(d)},refreshBookingColor:function(b,c){if("stop_booking_at"===c.field){var d=this.getBookingCellColorClass(c.coord);
this.getCell(c.coord,"stop_booking_at").removeClass("nl").removeClass("ll").addClass(d)}},processAutoPopulateSaveResult:function(b){this.autoPopulatePopup.processSaveResult(b)},formatValue:function(b,c){var d=this.toPrecision(c);if(!d)return"";toa.isDefined(this.PERCENT_FIELDS_INDEX[b])&&(d+="%");return d},toPrecision:function(b){var c=Math.pow(10,this.percentPrecision);return Math.round(b*c)/c},onCellEdit:function(b,c){var d=this.idToCoord(b.attr("id"));this.model.set(d,d.field,c);this.lockPopup.hide()},
onCellEditValidate:function(b,c,d){b=this.toPrecision(parseFloat(toa.trim(b+"")||0));if(this.toPrecision(parseFloat(toa.trim(c+"")||0))===b||isNaN(b)||0>+b)return!1;c=this.idToCoord(d.attr("id"));if(toa.isDefined(this.PERCENT_FIELDS_INDEX[c.field])){if(1E4<=+b)return!1}else if(2147483647<+b)return!1;return b},onCellCancel:function(b,c,d){d&&this.lockPopup.hide()},onFocusNextCell:function(b){if(b&&(b=this.getNextCellId(b))){var c=$("#"+b);if(c.length&&!c.hasClass("readonlyCell")){this.helper.scrollToCell(b);
isMSIE11?setTimeout(function(){this.editBox.show(c)}.bind(this),250):this.editBox.show(c);var d=this.idToCoord(b);setTimeout(function(){this.lockPopup.show({target:c,coord:d,lockable:this.isCellLocable(d.field)})}.bind(this),20)}}},getNextCellId:function(b){var c;b=this.idToCoord(b);c=!1;do c=b.clone(),b=this.getNextCellCoord(b),c=this.coordToId(c,c.field)==this.coordToId(b,b.field);while(this.isCellReadOnly(b,b.field)&&!c);return c?"":this.coordToId(b,b.field)},getNextCellCoord:function(b){var c=
b.clone(),d=0;if(d=b.category?this.model.getNextCategoryById(c,b.category):this.model.getFirstCategoryId(c))c.category=d;else if(d=this.model.getNextTimeSlotById(c,b.timeSlot))c.timeSlot=d,c.category=0;else if(d=this.model.getNextBucketById(c,b.bucket))c.bucket=d,c.timeSlot=this.model.getFirstTimeSlotId(c),c.category=0;else if(b=this.model.getNextDateId(c,b.day))c.bucket=this.model.getFirstBucketId(c),c.day=b,c.timeSlot=this.model.getFirstTimeSlotId(c),c.category=0;return c},isCellReadOnly:function(b,
c){var d=this.model.get(b,"rw",0),d=this.model.maskToFieldsLabels(d),l=this.isFilterByEntityApplied()&&this.isCellLocable(c),l=-1===$.inArray(c,d)||l;-1!==$.inArray(c,d)&&this.isQuotaDefinedInMinutesOnCapacityCategory(c,b)&&(l=!1);return l},isQuotaDefinedInMinutesOnCapacityCategory:function(b,c){return this.isFilterByEntityApplied()&&this.model.getBucketSettings(c).isQuotaDefinedInMinutes(c)&&this.isCellLocable(b)&&"quota"==b&&null!==c.category?!0:!1},setVisibleColumnsMask:function(b){this.visibleColumns=
b},setFilterValues:function(b){this.filterValues=b},setMultiBucket:function(b){this.isMultiBucket=b},isTotalReadOnly:function(b){return!(!this.filterValues.categories&&!this.filterValues.timeslots&&this.model.getBucketSettings(b).isQuotaDefinedInMinutes(b))},isCellLocable:function(b){return-1!==$.inArray(b,this.LOCKABLE_FIELDS)},isFilterByEntityApplied:function(){return!1},setToReadOnlyMode:function(){this.readOnly=!0},setToReadWriteMode:function(){this.readOnly=!1},isReadOnlyMode:function(){return this.readOnly}});
b.prototype.PERCENT_FIELDS_INDEX=toa.flipHash(b.prototype.PERCENT_FIELDS);b.prototype.COLORED_FIELDS_INDEX=toa.flipHash(b.prototype.COLORED_FIELDS);return b}());toa.ns("toa.views.quota.ViewTableCategory",function(){var d=toa.models.quota.Coordinate;return toa.define(toa.views.quota.ViewTable,null,{getMainTemplate:function(){return new toa.Template(['<table id="capacity_table_manage_scrollers" class="category">','<tr class="vtop">',"<td>",'<div id="capacity_div_nonscrolled_header">',this.getNonScrolledHeader(),"</div>","</td>",'<td colspan="2">','<div id="capacity_div_horiz_scrolled_header">',this.getHorizontalScrolledHeader(),"</div>","</td>","</tr>",'<tr class="vtop">',
'<td rowspan="2">','<div id="capacity_div_vert_scrolled_header" >',this.getVerticalScrolledHeader(),"</div>","</td>","<td>",'<div id="capacity_div_scrollable">',this.getScrollableTable(),"</div>","</td>",'<td id="capacity_vert_scroll_td">','<div id="capacity_vert_scroll" >','<div id="capacity_inner_vert_scroll" ></div>',"</div>","</td>","</tr>","<tr>","<td>",'<div id="capacity_horiz_scroll" style="display: none;">','<div id="capacity_inner_horiz_scroll" ></div>',"</div>","</td>","<td>","</td>","</tr>",
"</table>"])},getNonScrolledHeader:function(){var c="";this.isMultiBucket&&(c+='<td><div id="capacity_bucket_nonscroll_header" ><b>'+toa.glossary({id:8187})+"</b></div></td>");return(new toa.Template(['<table id="capacity_non_scrolled_table" class="capacity" >','<tr class="h">',c,"<td>",'<div id="capacity_nonscroll_header">',"<b>",toa.glossary({id:3448}),"</b>","</div>",'<div id="capacity_nonscroll_header2">',"<b>",toa.glossary({id:11423}),"</b>","</div>","</td>","</tr>","</table>"])).apply()},getVerticalScrolledHeader:function(){for(var c=
"",b=this.model.getAllTimeSlots(),e=this.model.getBuckets(),g=0;g<e.length;g++){for(var k=new d({bucket:e[g],day:"all"}),l=0,n="",p=!0,s=0,t=0;t<b.length;t++)if(k.timeSlot=b[t].id,k.category="",this.model.isCoordinateVisible(k)){s++;var u=this.model.getAllCategories();p||(n+="<tr>");p=!1;n+='<td class="h primary">'+b[t].name+"</td>";n+="</tr>";l++;for(var v=0;v<u.length;v++)k.category=u[v].id,this.model.isCoordinateVisible(k)&&(n+="<tr>",n+='<td class="h secondary">'+u[v].name+"</td>",n+="</tr>",
l++)}s||(n+='<td class="h secondary readonlyCell">&nbsp;</td>',n+="</tr>",l++);k=this.model.get(new d({bucket:e[g]}),"name","");p="";this.isMultiBucket&&(p+='<td class="h primary" rowspan='+l+">"+k+"</td>");c+="<tr>"+p+n}return['<table id="capacity_vert_scrolled_table" class="capacity" >',c,'<tr><td id="space_for_horiz_scroll" class="h" colspan="2" style="display: none;"></td></tr></table>'].join("")},getScrollableTable:function(){for(var c=this.getDates(),b=this.model.getAllTimeSlots(),e=this.model.getAllCategories(),
g=this.model.getBuckets(),k="",l="",n=!1,p=0;p<g.length;p++){for(var s=new d({bucket:g[p]}),k="",t=0,u=!0,v=0,w=0;w<b.length;w++)if(s.timeSlot=b[w].id,s.category="",this.model.isCoordinateVisible(s)){v++;u||(k+="<tr>");u=!1;k+='<td class="h primary">'+b[w].name+"</td>";s.category=null;for(var x=0;x<c.length;x++)n=x===c.length-1,s.day=c[x],k+=this.getSectorHtml(s,n);k+="</tr>";t++;for(var y=0;y<e.length;y++)if(s.category=e[y].id,this.model.isCoordinateVisible(s)){k+="<tr>";k+='<td class="h secondary">'+
e[y].name+"</td>";for(x=0;x<c.length;x++)n=x===c.length-1,s.day=c[x],k+=this.getSectorHtml(s,n);t++}}if(!v){k+='<td class="h secondary readonlyCell">&nbsp;</td>';for(x=0;x<c.length;x++)for(n=this.getDateFields(new d({bucket:this.bucketId,day:c[x]})),s=0;s<n.length;s++)u="readonlyCell",s===n.length-1&&(u+=" vs"),k+=""+('<td class="'+u+'">&nbsp;</td>');k+="</tr>";t++}x=this.model.get(new d({bucket:g[p]}),"name","");n="";this.isMultiBucket&&(n+='<td class="h primary" rowspan='+t+">"+x+"</td>");l+="<tr>"+
n+k}c=this.getHorizontalInsideHeader();b="";this.isMultiBucket&&(b+='<td rowspan="2"><div id="capacity_bucket_orig_header" ><b>'+toa.glossary({id:8187})+"</b></div></td>");return['<table id="capacity_table_scrollable" class="capacity" ><tr class="h">',b,'<td rowspan="2">','<div data-id="capacity_orig_header"><b>'+toa.glossary({id:3448})+"</b></div>",'<div data-id="capacity_orig_header2"><b>'+toa.glossary({id:11423})+"</b></div>","</td>",c,"</tr>",l,"</table>"].join("")},isTotalReadOnly:function(c){return!(!this.filterValues.categories&&
this.model.getBucketSettings(c).isQuotaDefinedInMinutes(c))},isFilterByEntityApplied:function(){return this.filterValues.categories},getCellHtml:function(c,b,d,g,k){var l=d?"readonlyCell":"readwriteCell",n="text",p=this.model.get(c,b),s=null!==this.model.getDelta(c,b);g=(g?"vs ":"")+(k?"hs ":"");null===p&&"quota"===b&&(p=this.tryAggregateTotalByTimeSlotCategories(c,d));k=this.getTitleText(b,c);s&&"status"!=b&&"close_time"!=b&&(g+="changed-cell ",k&&(k='title = "'+k+'" '));p=this.formatValue(b,p);
this.isColoredField(b)&&(g+=this.getCellColorClass(c)+" ");!d&&this.isCellLocable(b)&&this.model.isLocked(c)&&(g+="capacity-cell-locked ");switch(b){case "stop_booking_at":g+=this.getBookingCellColorClass(c)+" ";break;case "status":n="popup";g+=this.getStatusClass(c);p="<div>&nbsp;</div>";break;case "close_time":d=this.model.getSectorCloseTime(c),g+=d.isSectorChanged?"changed-cell ":"",n="popup",p=this.getCloseTimeText(c)}return['<td id="',this.coordToId(c,b),'" ',"readwriteCell"===l?'tabindex="0" ':
"",'class="',l," ",g,'" data-label="',b,'" data-edittype="',n,'" title="',k,'">',p,"</td>"].join("")},tryAggregateTotalByTimeSlotCategories:function(c,b){if(null!==c.category||null===c.timeSlot||!0!==b)return null;var d="undefined"!==typeof this.model.buckets[c.bucket].info?this.model.buckets[c.bucket].info:null;if(this.isMultiBucket&&(!d||0!==(d.category_quota_flags&0)))return null;var d=null,g="undefined"!==typeof this.model.buckets[c.bucket].days[c.day].timeslots[c.timeSlot].categories?this.model.buckets[c.bucket].days[c.day].timeslots[c.timeSlot].categories:
[],k;for(k in g){var l=g[k],l="undefined"!==typeof l.quota?l.quota:null;null!==l&&(d+=0+l)}return d}})}());toa.ns("toa.views.quota.ViewTableTimeSlots",function(){var d=toa.models.quota.Coordinate;return toa.define(toa.views.quota.ViewTable,null,{getMainTemplate:function(){return new toa.Template(['<table id="capacity_table_manage_scrollers" class="category">','<tr class="vtop">',"<td>",'<div id="capacity_div_nonscrolled_header">',this.getNonScrolledHeader(),"</div>","</td>",'<td colspan="2">','<div id="capacity_div_horiz_scrolled_header">',this.getHorizontalScrolledHeader(),"</div>","</td>","</tr>",'<tr class="vtop">',
'<td rowspan="2">','<div id="capacity_div_vert_scrolled_header" >',this.getVerticalScrolledHeader(),"</div>","</td>","<td>",'<div id="capacity_div_scrollable">',this.getScrollableTable(),"</div>","</td>",'<td id="capacity_vert_scroll_td">','<div id="capacity_vert_scroll" >','<div id="capacity_inner_vert_scroll" ></div>',"</div>","</td>","</tr>","<tr>","<td>",'<div id="capacity_horiz_scroll" style="display: none;">','<div id="capacity_inner_horiz_scroll" ></div>',"</div>","</td>","<td>","</td>","</tr>",
"</table>"])},getNonScrolledHeader:function(){var c="";this.isMultiBucket&&(c+='<td><div id="capacity_bucket_nonscroll_header" ><b>'+toa.glossary({id:8187})+"</b></div></td>");return(new toa.Template(['<table id="capacity_non_scrolled_table" class="capacity" >','<tr class="h">',c,"<td>",'<div id="capacity_nonscroll_header">',"<b>"+toa.glossary({id:3448})+"</b>","</div>","</td>","</tr>","</table>"])).apply()},getVerticalScrolledHeader:function(){for(var c=this.model.getAllTimeSlots(),b=this.model.getBuckets(),
e="",g=0;g<b.length;g++){var k=new d({bucket:b[g],day:"all"}),l=0,n="",n=n+('<td class="h primary">'+toa.glossary({id:11801})+"</td>"),n=n+"</tr>";l++;for(var p=0;p<c.length;p++)k.timeSlot=c[p].id,k.category="",this.model.isCoordinateVisible(k)&&(n+="<tr>",n+='<td class="h secondary">'+c[p].name+"</td>",n+="</tr>",l++);k=this.model.get(new d({bucket:b[g]}),"name","");n="<tr>"+(this.isMultiBucket?'<td class="h primary" rowspan='+l+">"+k+"</td>":"")+n;e+=n}return['<table id="capacity_vert_scrolled_table" class="capacity" >',
e,'<tr><td id="space_for_horiz_scroll" class="h" style="display: none;"></td></tr></table>'].join("")},getScrollableTable:function(){for(var c=this.getDates(),b=this.model.getAllTimeSlots(),e=this.model.getBuckets(),g="",k="",l=!1,k=0;k<e.length;k++){for(var n="",p=0,n=n+('<td class="h primary">'+toa.glossary({id:11801})+"</td>"),s=new d({bucket:e[k]}),t=0;t<c.length;t++)l=t===c.length-1,s.day=c[t],n+=this.getSectorHtml(s,l);n+="</tr>";p++;for(var u=0;u<b.length;u++)if(s.timeSlot=b[u].id,this.model.isCoordinateVisible(s)){n+=
"<tr>";n+='<td class="h secondary ">'+b[u].name+"</td>";for(t=0;t<c.length;t++)l=t===c.length-1,s.day=c[t],n+=this.getSectorHtml(s,l);n+="</tr>";p++}l=this.model.get(new d({bucket:e[k]}),"name","");n="<tr>"+(this.isMultiBucket?'<td class="h primary" rowspan='+p+">"+l+"</td>":"")+n;g+=n}c=this.getHorizontalInsideHeader();return k=['<table id="capacity_table_scrollable" class="capacity" ><tr class="h">',this.isMultiBucket?'<td rowspan="2"><div id="capacity_bucket_orig_header" ><b>'+toa.glossary({id:8187})+
"</b></div></td>":"",'<td rowspan="2">','<div data-id="capacity_orig_header"><b>'+toa.glossary({id:3448})+"</b></div>","</td>",c,"</tr>",g,"</table>"].join("")},isTotalReadOnly:function(c){return!(!this.filterValues.timeslots&&this.model.getBucketSettings(c).isQuotaDefinedInMinutes(c))},isFilterByEntityApplied:function(){return this.filterValues.timeslots}})}());toa.ns("toa.views.quota.ViewTableQuota",function(){var d=toa.models.quota.Coordinate,c=toa.views.quota.ViewTable;return toa.define(c,null,{walkByEnterTimer:null,walkCellList:!1,COLORED_FIELDS:"used quota quotaPercent usedQuotaPercent minQuota otherActivities stopBookingAt quotaPercentCategory".split(" "),PERCENT_FIELDS_INDEX:["quotaPercent","quotaPercentDay","usedQuotaPercent","quotaPercentCategory","stopBookingAt"],render:function(b){this.toogleIntervalData={};b=$(b);var c=this;this.container=b;
b=this.getMainTemplate().apply();b+=this.getZoomTracerHtml();this.container.html(b);this.walkCellList=!1;this.autoPopulatePopupNew=new toa.views.quota.PopupAutoPopulateNew(this.model);this.autoPopulatePopupNew.addListener("saveAutoPopulate",function(b,d){c.notify("saveAutoPopulatePopup",d)});this.lockPopupNew=new toa.views.quota.PopupCellLockNew(this.model);this.lockPopupNew.setAutoPopulatePopup(this.autoPopulatePopupNew);this.helper=new toa.views.quota.ViewHelper;this.helper.setCapacityTableNegativeMargins();
this.helper.syncTableHeadersWidth();this.helper.resizeCapacityTable();this.helper.bindEvents();this.helper.bindScrolls();this.bindTableEvents()},bindTableEvents:function(){var b=this;this.container.find('*[data-label="quota_header"]').on("click",this.getIntervalsGridData.bind(this));this.container.find("#capacity_div_scrollable").on("click",".readwriteCell[data-label=status]",function(c){c=$(this);var d=b.idToCoord(c.attr("id"));b.notify("statusClicked",c,d)}).on("click",".readonlyCell[data-label=status]",
function(c){c=$(this);var g=b.idToCoord(c.attr("id"));"category"===(new d(g)).getLevelName()&&b.notify("readonlyStatusClicked",c,g)}).on("click",".readwriteCell[data-label=close_time]",function(c){c=$(this);var d=b.idToCoord(c.attr("id"));b.notify("closeTimeClicked",c,d)}).on("click",".readwriteCell[data-edittype=text]",function(c){b.onReadWriteClick(c,this)}).on("keydown",".readwriteCell[data-edittype=text]",function(c){if(c.keyCode||c.charCode)if(13!==(c.keyCode||c.charCode)||"INPUT"===c.target.tagName)return;
c.preventDefault();c.stopPropagation();b.onReadWriteClick(c,this,!0)}).on("scroll",function(){b.lockPopupNew.hide();b.notify("scroll")})},onReadWriteClick:function(b,c,g){c=$(c);this.editBox.show(c,g);g=c.attr("id").split("__");var k=b.target.parentElement.getAttribute("id");"undefined"!==typeof k&&null!==k&&-1!==k.indexOf("__")&&(k=b.target.parentElement.parentElement.getAttribute("id"));b="";b="quota"==g[g.length-1]?"quotaValue":"quotaPercent"==g[g.length-1]?"quotaPercentCategory":g[g.length-1];
b=new d({bucket:this.model.getCurrentArea().providerId,field:b,category:k});"interval"!=c.data("filter-label")&&this.lockPopupNew.show({target:c,coord:b})},getIntervalsGridData:function(b){var c=b.target.dataset.date;c||(c=b.target.parentNode.dataset.date);this.renderIntervalsGrid(c)},renderIntervalsGrid:function(b){if(b&&!this.model.isTimeSlotQuotaEnabled()){"undefined"===typeof this.toogleIntervalData[b]&&(this.toogleIntervalData[b]=0);var c=this.model.getTimeIntervals(),d=$("#capacity_horiz_scrolled_table").find('[data-date="'+
b+'"][data-label="day_header"]');this.toogleIntervalData[b]?(this.container.find('[data-date="'+b+'"][data-label="intervalQuota_header"]').each(function(b,c){$(c).hide()}),this.container.find('[data-date="'+b+'"][data-filter-label="interval"]').each(function(b,c){$(c).hide()}),this.container.find('[data-date="'+b+'"].edt-open').toggleClass("ptminus ptplus"),this.toogleIntervalData[b]=0,d.attr("colspan",parseInt(d.attr("colspan"))-c.length)):(this.container.find('[data-date="'+b+'"][data-label="intervalQuota_header"]').each(function(b,
c){$(c).show()}),this.container.find('[data-date="'+b+'"][data-filter-label="interval"]').each(function(b,c){$(c).show()}),this.container.find('[data-date="'+b+'"].edt-open').toggleClass("ptplus ptminus"),this.toogleIntervalData[b]=1,d.attr("colspan",parseInt(d.attr("colspan"))+c.length));this.helper=new toa.views.quota.ViewHelper;this.helper.setCapacityTableNegativeMargins();this.helper.syncTableHeadersWidth();this.helper.resizeCapacityTable();this.helper.bindEvents();this.helper.bindScrolls()}},
setModel:function(b){this.model=b;this.setDeltaHandlerId=this.model.addListener("setDelta",function(b,c){this.isRenderStopped||(this.setChangeCorner(b,c),this.refreshValues(b,c),this.refreshStatusSign(b,c),this.refreshSectorColor(b,c),this.refreshCellLock(b,c))},this);this.removeDeltaHandlerId=this.model.addListener("removeDelta",function(b,c){this.isRenderStopped||(this.removeChangeCorner(b,c),this.refreshValues(b,c),this.refreshStatusSign(b,c),this.refreshSectorColor(b,c),this.refreshCellLock(b,
c))},this);this.bucketId=0;this.isMultiBucket=!1;this.metadata=this.preapareMetaData()},processAutoPopulateSaveResult:function(b){this.autoPopulatePopupNew.processSaveResult(b)},getMainTemplate:function(){return new toa.Template(['<table id="capacity_table_manage_scrollers" class="category">','<caption style="display: none">Quota</caption>','<tr class="vtop">','<th scope="row">','<div id="capacity_div_nonscrolled_header">',this.getNonScrolledHeader(),"</div>","</th>",'<th colspan="2" scope="row">',
'<div id="capacity_div_horiz_scrolled_header">',this.getHorizontalScrolledHeader(),"</div>","</th>","</tr>",'<tr class="vtop">','<td rowspan="2" scope="row">','<div id="capacity_div_vert_scrolled_header" >',this.getVerticalScrolledHeader(),"</div>","</td>","<td>",'<div id="capacity_div_scrollable">',this.getScrollableTable(),"</div>","</td>",'<td id="capacity_vert_scroll_td">','<div id="capacity_vert_scroll" >','<div id="capacity_inner_vert_scroll" ></div>',"</div>","</td>","</tr>","<tr>",'<td role="none">',
'<div id="capacity_horiz_scroll" style="display: none;">','<div id="capacity_inner_horiz_scroll" ></div>',"</div>","</td>","<td>","</td>","</tr>","</table>"])},getNonScrolledHeader:function(){return(new toa.Template(['<table id="capacity_non_scrolled_table" class="capacity" >','<tr class="h">','<td rowspan="2">','<div data-id="capacity_orig_header2" class="non_scrolled_table_capacity_category">',"<b>"+toa.glossary({id:11423})+"</b>","</div>","</td>","</tr>","</table>"])).apply()},sortObj:function(b,
c){var d,k=[],l={};for(d in b)k.push(d);k.sort(function(b,c){return b.toLowerCase().localeCompare(c.toLowerCase())});if("desc"===c)for(d=k.length-1;0<=d;d--)l[k[d]]=b[k[d]];else for(d=0;d<k.length;d++)l[k[d]]=b[k[d]];return l},destroy:function(){this.lookups={};this.autoPopulatePopupNew&&this.autoPopulatePopupNew.destroy();this.autoPopulatePopupNew=null;this.lockPopupNew&&this.lockPopupNew.destroy();this.lockPopupNew=null;c.prototype.destroy.apply(this,arguments)},reverse:function(b,c){var d=[],k;
for(k in b)d.unshift(b[k]);if(c)for(k in d)c(k,d[k]);return d},getCategoriesLookups:function(){var b=[];this.lookups.capacityCategories.length&&(b=this.lookups.capacityCategories);return b},getVerticalScrolledHeader:function(){var b=0,c="",d=this.model.getCurrentArea(),k=this.getCategoriesLookups(),l;for(l in this.metadata.areas)if(this.metadata.areas.hasOwnProperty(l))for(var n=this.metadata.areas[l],p="<b>"+(n.name||d.name)+"</b>",c=c+"<tr>",c=c+('<td class="h primary" scope="row">'+p+"</td>"),
c=c+"</tr>",n=n.categories,p=0,s=k.length;p<s;p++){var t=k[p],u=""+t.label;n.hasOwnProperty(u)&&(c+='<tr data-id="'+t.id+'">',c+='<td class="h secondary" scope="row">'+n[u].name+"</td>",c+="</tr>",b++)}return['<table id="capacity_vert_scrolled_table" class="capacity"><caption style="display: none">Quota</caption>',c,'<tr><td id="space_for_horiz_scroll" class="h" colspan="2" style="display: none;" scope="row"></td></tr></table>'].join("")},preapareMetaData:function(){var b={areas:{},categories:[],
categoriesLabels:{}},c=this.model.data;if(c.length&&0<c.length)for(var d=0,k=c.length;d<k;d++)for(var l=0;l<c[d].areas.length;l++){var n=c[d].areas[l];"undefined"===typeof b.areas[n.label]&&(b.areas[n.label]={name:n.name,categories:{},htmlData:[]});for(var p=0;p<n.categories.length;p++){var s=n.categories[p];b.categoriesLabels[s.label]={label:s.label,name:this.model.getCategoryName(s.label)};b.categories.push({label:s.label,name:this.model.getCategoryName(s.label)});b.areas[n.label].categories[s.label]=
{name:this.model.getCategoryName(s.label),htmlData:[]}}}b.categories.sort(function(b,c){return b.name.toLowerCase()<c.name.toLowerCase()?-1:b.name.toLowerCase()>c.name.toLowerCase()?1:0});return b},findAreaCategory:function(b,c){for(var d=0,k=b.categories.length;d<k;d++){var l=b.categories[d];if(c===l.label)return l}return!1},getScrollableTable:function(){for(var b=0,c="",d=this.model.data,k=this.model.getCurrentArea(),l=this.getCategoriesLookups(),n=0;n<d.length;n++)for(var p=0;p<d[n].areas.length;p++){var s=
d[n].date,t=d[n].areas[p],u="<b>"+(t.name||k.name)+"</b>";this.metadata.areas[t.label].htmlData[n]=this.getSectorHtml(t,s);for(var u=0,v=l.length;u<v;u++){var w=l[u],w=w.label;if("undefined"!==typeof this.metadata.categoriesLabels[w]){var x=this.findAreaCategory(t,w);if(!1===x){for(var y=this.model.getFieldList(),x="",z=0,y=Object.keys(y).length;z<y;z++)x+='<td class="readonlyCell">&nbsp;</td>';this.metadata.areas[t.label].categories[w].htmlData[n]=x}else this.metadata.areas[t.label].categories[w].htmlData[n]=
this.getSectorHtml(x,s)}}}for(var A in this.metadata.areas)if(this.metadata.areas.hasOwnProperty(A))for(t=this.metadata.areas[A],u=t.name||"<b>Total</b>",c+="<tr>",c+='<td class="h primary" scope="row">'+u+"</td>",c+=t.htmlData.join(""),c+="</tr>",u=0,v=l.length;u<v;u++)w=l[u],d=w.label,t.categories.hasOwnProperty(d)&&(c+='<tr id="'+w.id+'">',c+='<td class="h secondary" scope="row">'+t.categories[d].name+"</td>",c+=t.categories[d].htmlData.join(""),c+="</tr>",b++);b=this.getHorizontalInsideHeader();
return['<table id="capacity_table_scrollable" style="width:100%" class="capacity" ><caption style="display: none">Quota</caption><tr class="h"><td rowspan="2" >','<div data-id="capacity_orig_header2" class=" table_scrollable_capacity_category"><b>'+toa.glossary({id:11423})+"</b></div>","</td>",b,"</tr>",c,"</table>"].join("")},getSectorHtml:function(b,c){for(var d=this.model.getFieldList(),k=Object.keys(d),l="",n=0;n<k.length;n++)l+=this.getCellHTML(b,k[n],d[k[n]],c);return l},getCellHTML:function(b,
c,d,k){var l=c;if(d.mapEntityField){var n=b.getEntityType();d.mapEntityField[n]&&(l=d.mapEntityField[n])}var n=b.isEditable(l)&&!this.isReadOnlyMode()?"readwriteCell":"readonlyCell",p=b.getFieldValue(l),s="",t=b.getId()+"__"+b.getFieldName(l);d&&"undefined"!==typeof d.decorateValue&&(p=this.model.decorateTo(p,d.decorateValue));this.isColoredField(c)&&(s+=this.getCellColorClass(b.getId(),c)+" ");t=['<td id="',t,'" ',"readwriteCell"===n?'tabindex="0" ':"",'class="',n," ",s,'" data-label="',l,'" data-filter-label="',
c,'" data-edittype="text" data-date="',k,'" >',p,"</td>"].join("");if("quota"==c)if("area"==b.getEntityType()){b=this.model.getTimeIntervals();for(var u=0;u<b.length;u++)var v=b[u],t=t+('<td data-date="'+k+'" data-filter-label="interval" data-edittype="interval"  style="display:none" class="readonlyCell">&nbsp;</td>')}else for(b=b.getFieldValue("intervals"),u=0;u<b.length;u++)v=b[u],n=v.isEditable(l)&&!this.isReadOnlyMode()?"readwriteCell":"readonlyCell",p=v.getFieldValue(c),p=this.model.decorateTo(p,
d.decorateValue),t+=['<td id="',v.getId(),'__quota" style="display:none"class="',n," ",s,'" data-label="',c,'" data-filter-label="',v.getEntityType(),'" data-edittype="text" data-date="',k,'" >',p,"</td>"].join("");return t},getCell:function(b,c){return this.container.find("#"+b)},onCellEdit:function(b,c){var d=b.attr("id"),k=b.attr("data-label"),l=b.attr("data-filter-label"),n=this.model.getFieldList();null!==c&&n[l]&&"undefined"!==typeof n[l].revertDecorate&&(c=this.model.revertTo(c,n[l].revertDecorate));
"interval"==l&&null!=c&&(c=this.model.revertTo(c,n.quota.revertDecorate));this.model.set(d,c,k,l);this.lockPopup.hide()},refreshValues:function(b,c){var d=this.model.getFieldList(),k=this.model.get(c.coord);null===k&&"object"===typeof k?k="":d[c.filterField]&&"undefined"!==typeof d[c.filterField].decorateValue&&(k=this.model.decorateTo(k,d[c.filterField].decorateValue));"interval"==c.filterField&&(k=this.model.decorateTo(k,d.quota.decorateValue));this.getCell(c.coord,c.field).text(k);this.helper.resizeCapacityTableDebounced()},
getHorizontalScrolledHeader:function(){for(var b=this.model.getDates(),c="",d="",k=Object.keys(this.model.getFieldList()),l=0;l<b.length;l++)var n=b[l],p=l===b.length-1,s=p?"":"vs",t=this.formatDate(n),c=c+('<td data-label="day_header" data-date="'+n+'" class="h '+s+'" colspan="'+k.length+'"><b>'+t+"</b></td>"),d=d+this.getHeaderSector(n,p,"topTh",!0);return['<table id="capacity_horiz_scrolled_table" class="capacity"><caption style="display: none">Quota</caption><tr class="h">',c,'<td id="space_for_vert_scroll" rowspan="2" ><div id="inner_space_for_vert_scroll"></div></td></tr><tr class="h">',
d,"</tr></table>"].join("")},getHorizontalInsideHeader:function(){for(var b=this.model.getDates(),c="",d="",k=Object.keys(this.model.getFieldList()),l=0;l<b.length;l++)var n=b[l],p=l===b.length-1,s=p?"":"vs",t=this.formatDate(n),c=c+('<td class="h '+s+'" colspan="'+k.length+'"><b>'+t+"</b></td>"),d=d+this.getHeaderSector(n,p,"topTh",!1);return[c,'</tr><tr class="h">',d].join("")},getHeaderSector:function(b,c,d,k){var l="",n="",l=this.model.getFieldList(),p=Object.keys(l),s=this.model.getTimeIntervals(),
t=toa.date.formatDate("iso",toa.date.currentDate()),u="id";"undefined"!==typeof k&&!0===k&&(u="data-id");for(k=0;k<p.length;k++){var l=k!==p.length-1||c?"":"vs",v=this.model.getFieldName(p[k]),w="",x="";if(s.length&&"quota"===p[k]&&!this.model.isTimeSlotQuotaEnabled()&&+new Date(t)<=+new Date(b))for(var w='<div data-date="'+b+'" class="edt-open icr ptplus" role="button" aria-label="Expand">&nbsp;</div>',y=0;y<s.length;y++)var z=new toa.models.TimeIntervalModel({label:s[y].label}),x=x+['<td data-date="'+
b+'" data-label="intervalQuota_header" style="display:none" class="'+l+'" scope="row">','<div class="small_header" ',u,'="',d+b+y+'">',z.getIntervalText(),"</div></td>"].join("");"quota"==p[k]&&(l="quota_header");n+=['<td data-date="'+b+'" data-label="'+p[k]+'_header" class="'+l+'" >','<div class="small_header" ',u,'="',d+b+k+'">',v,"</div>",w,"</td>",x].join("")}return n},isTotalReadOnly:function(b){return!(!this.filterValues.categories&&this.model.getBucketSettings(b).isQuotaDefinedInMinutes(b))},
isFilterByEntityApplied:function(){return this.filterValues.categories},isColoredField:function(b){return-1<this.COLORED_FIELDS.indexOf(b)},refreshSectorColor:function(b,c){if(this.isColoredField(c.field)){var d=c.coord.replace("__"+c.field,""),k=this.getCellColorClass(d,c.field);if("stopBookingAt"==c.field)return this.getCell(d+"__stopBookingAt").removeClass("nl").removeClass("ll").addClass(k);for(var l=0;l<this.COLORED_FIELDS.length;l++)this.getCell(d+"__"+this.COLORED_FIELDS[l]).removeClass("nl").removeClass("hl").removeClass("ml").removeClass("sl").removeClass("ll").addClass(k)}},
getCellColorClass:function(b,c){if("stopBookingAt"==c)return this.getBookingCellColorClass(b);var d=this.model.getEntity(b),k=d.getFieldValue("used"),l=d.getFieldValue("quota"),d=d.getFieldValue("usedQuotaPercent"),n=toa.app.model("companySettings").getQuotaThreshold(1),p=toa.app.model("companySettings").getQuotaThreshold(2);return null===k||null===l?d?100<d?"hl":d>100*n&&d<=100*p?"ml":d>100*p&&100>=d?"sl":"ll":"nl":k||l?k>l?"hl":k>n*l&&k<=p*l?"ml":k>p*l&&k<=l?"sl":"ll":"nl"},getBookingCellColorClass:function(b){var c=
b.split("__"),c=c.slice(0,c.length-2);b=this.model.getEntity(b).getFieldValue("stopBookingAt");if(c=this.model.getEntity(c.join("__")))return c=c.getFieldValue("usedQuotaPercent"),b&&c&&b<=c?"ml ":"ll "},onCellEditValidate:function(b,c,d,k){var l=c=null;toa.trim(b+"")&&(c=this.toPrecision(parseFloat(toa.trim(b+""))));toa.trim(k+"")&&(l=this.toPrecision(parseFloat(toa.trim(k+""))));if(c===l||isNaN(c)||0>+c)return!1;b=d.attr("data-label");if(-1!==this.PERCENT_FIELDS_INDEX.indexOf(b)){if(1E3<=+c)return 999}else if(16777215<
+c)return 16777215;return c},createTableWalkList:function(){var b=$(this.container).find("#capacity_table_scrollable"),c=this;c.walkCellList={};if(0!==b.find("td.readwriteCell").length){for(var d="",k="",l="",n=b.find("tr:not(.h):first td:not(.h)").length,p=2;p<=n+1;p++)b.find("td.readwriteCell:nth-child("+p+")").each(function(b){l=$(this).attr("id");d=c.walkCellList[d]=l;""===k&&0==b&&(k=l)});c.walkCellList[l]=k}},getNextEditableCellId:function(b){!1===this.walkCellList&&this.createTableWalkList();
return this.walkCellList[b]},onFocusNextCell:function(b){var c=this.getNextEditableCellId(b);this.helper.scrollToCell(c);isMSIE11?(this.walkByEnterTimer&&window.clearTimeout(this.walkByEnterTimer),this.walkByEnterTimer=setTimeout(function(){$("#"+c).trigger("click")},250)):$("#"+c).trigger("click")}})}());toa.ns("toa.views.quota.ViewTableDay",function(){var d=toa.models.quota.Coordinate;return toa.define(toa.views.quota.ViewTable,null,{getMainTemplate:function(){return new toa.Template(['<table id="capacity_table_manage_scrollers" class="category">','<tr class="vtop">',"<td>",'<div id="capacity_div_nonscrolled_header">',this.getNonScrolledHeader(),"</div>","</td>",'<td colspan="2">','<div id="capacity_div_horiz_scrolled_header">',this.getHorizontalScrolledHeader(),"</div>","</td>","</tr>",'<tr class="vtop">',
'<td rowspan="2">','<div id="capacity_div_vert_scrolled_header" >',this.getVerticalScrolledHeader(),"</div>","</td>","<td>",'<div id="capacity_div_scrollable">',this.getScrollableTable(),"</div>","</td>",'<td id="capacity_vert_scroll_td">','<div id="capacity_vert_scroll" >','<div id="capacity_inner_vert_scroll" ></div>',"</div>","</td>","</tr>","<tr>","<td>",'<div id="capacity_horiz_scroll" style="display: none;">','<div id="capacity_inner_horiz_scroll" ></div>',"</div>","</td>","<td>","</td>","</tr>",
"</table>"])},getNonScrolledHeader:function(){var c="";this.isMultiBucket&&(c+='<td><div id="capacity_bucket_nonscroll_header" ><b>'+toa.glossary({id:8187})+"</b></div></td>");return(new toa.Template(['<table id="capacity_non_scrolled_table" class="capacity" >','<tr class="h">',c,"</tr>","</table>"])).apply()},getVerticalScrolledHeader:function(){for(var c=this.model.getBuckets(),b="",e=0;e<c.length;e++)var g=this.model.get(new d({bucket:c[e]}),"name",""),b=b+("<tr>"+(this.isMultiBucket?'<td class="h primary" >'+
g+"</td>":"")+"<tr>");return['<table id="capacity_vert_scrolled_table" class="capacity" >',b,'<tr><td id="space_for_horiz_scroll" class="h" style="display: none;"></td></tr></table>'].join("")},getScrollableTable:function(){for(var c=this.getDates(),b=this.model.getBuckets(),e="",g=!1,e="",k=0;k<b.length;k++){for(var l=new d({bucket:b[k]}),g=this.model.get(l,"name",""),e=e+("<tr>"+(this.isMultiBucket?'<td class="h primary" >'+g+"</td>":"")),n=0;n<c.length;n++)g=n===c.length-1,l.day=c[n],e+=this.getSectorHtml(l,
g);e+="</tr>"}c=this.getHorizontalInsideHeader();return e=['<table id="capacity_table_scrollable" class="capacity" ><tr class="h">',this.isMultiBucket?'<td rowspan="2"><div id="capacity_bucket_orig_header" ><b>'+toa.glossary({id:8187})+"</b></div></td>":"",c,"</tr>",e,"</table>"].join("")}})}());toa.ns("toa.views.quota.ViewTableBookingStatus",function(){var d=toa.models.quota.Coordinate,c=toa.views.quota.ViewTable;return toa.define(c,function(){c.apply(this,arguments)},{getMainTemplate:function(){return new toa.Template(['<table id="capacity_table_manage_scrollers" class="category">','<tr class="vtop">',"<td>",'<div id="capacity_div_nonscrolled_header">',this.getNonScrolledHeader(),"</div>","</td>",'<td colspan="2">','<div id="capacity_div_horiz_scrolled_header">',this.getHorizontalScrolledHeader(),
"</div>","</td>","</tr>",'<tr class="vtop">','<td rowspan="2">','<div id="capacity_div_vert_scrolled_header" >',this.getVerticalScrolledHeader(),"</div>","</td>","<td>",'<div id="capacity_div_scrollable">',this.getScrollableTable(),"</div>","</td>",'<td id="capacity_vert_scroll_td">','<div id="capacity_vert_scroll" >','<div id="capacity_inner_vert_scroll" ></div>',"</div>","</td>","</tr>","<tr>","<td>",'<div id="capacity_horiz_scroll" style="display: none;">','<div id="capacity_inner_horiz_scroll" ></div>',
"</div>","</td>","<td>","</td>","</tr>","</table>"])},getNonScrolledHeader:function(){var b="";this.isMultiBucket&&(b+='<td><div id="capacity_bucket_nonscroll_header" ><b>'+toa.glossary({id:8187})+"</b></div></td>");return(new toa.Template(['<table id="capacity_non_scrolled_table" class="capacity" >','<tr class="h">',b,"<td>",'<div id="capacity_nonscroll_header2">',"<b>",toa.glossary({id:11423}),"</b>","</div>","</td>","</tr>","</table>"])).apply()},getTimeSlotLookups:function(b){var c=[];switch(b){case "ts":c=
this.lookups.timeSlots;break;case "ti":c=[]}return c},getCategoriesLookups:function(){var b=[];this.lookups.capacityCategories.length&&(b=this.lookups.capacityCategories);return b},getHeaderColumnsHtml:function(){for(var b=this.getDates(),c=this.model.getBuckets(),g={daysColumns:"",timeSlotColumns:""},k=this.model.getQuotaTimeslots(),l=0,n=b.length;l<n;l++){for(var p=l===n-1,s=b[l],t=0,u=!0,v=0,w=c.length;v<w;v++){var x=v===w-1,y=c[v],z=new d({day:s,bucket:y}),A=[];if((k=this.model.getOld(z,"timeslots")||
null)||"ti"!==y){u&&k&&"ts"===y&&(u=!1,t++,z="",A.push(['<td colspan="2" class="'+z+'" style="min-width:212px !important;max-width:212px !important;overflow: hidden;">','<div class="small_header">',this.decorateTimeSlot("all"),"</div></td>"].join("")));k&&"ti"===y&&(k=this.getSortedTimeIntervals(k));var k=k?Object.keys(k):[],B=this.getTimeSlotLookups(y);if(!B||!B.length)for(var D in k)B.push({label:k[D]});for(var C=0,F=0,J=B.length;F<J;F++){var z=B[F],H=k.indexOf("ts"===y?""+z.id:""+z.label);-1!==
H&&(t++,C++,z=(K=C===k.length)?"vs":"",K&&p&&x&&(z="vs"),A.push(['<td colspan="2" class="'+z+'" style="min-width:212px !important;max-width:212px !important;overflow: hidden;">','<div class="small_header">',this.decorateTimeSlot(k[H]),"</div></td>"].join("")))}A.length&&(g.timeSlotColumns+=A.join(""))}else{t++;var K=!0,z=K?"vs":"";K&&p&&x&&(z="vs");A.push(['<td colspan="2" class="'+z+'" style="min-width:212px !important;max-width:212px !important;overflow: hidden;">','<div class="small_header">',
this.decorateTimeSlot("all"),"</div></td>"].join(""));g.timeSlotColumns+=A.join("")}}p=this.formatDate(s);z="vs";g.daysColumns+='<td class="h '+z+'" colspan="'+2*t+'"><b>'+p+"</b></td>"}return g},getSortedTimeIntervals:function(b){b=b?Object.keys(b):[];for(var c=[],d=0,k=b.length;d<k;d++){var l=b[d],n=new toa.models.TimeIntervalModel({label:l}),n="all"!==l?n.getStartTime():-1,n=!1===n?0:n;c.push({id:l,timestamp:n})}c.sort(function(b,c){return b.timestamp===c.timestamp?0:b.timestamp<c.timestamp?-1:
1});b={};d=0;for(k=c.length;d<k;d++)l=c[d].id,b[l]=l;return b},getHorizontalScrolledHeader:function(){var b=this.getHeaderColumnsHtml();return['<table id="capacity_horiz_scrolled_table" class="capacity"><tr class="h">',b.daysColumns,'<td id="space_for_vert_scroll" rowspan="2" ><div id="inner_space_for_vert_scroll"></div></td></tr><tr class="h">',b.timeSlotColumns,"</tr></table>"].join("")},getHorizontalInsideHeader:function(){var b=this.getHeaderColumnsHtml();return[b.daysColumns,'</tr><tr class="h">',
b.timeSlotColumns].join("")},decorateTimeSlot:function(b){if(null===b||"all"===b)return h(20461);var c=this.model.getTimeslotName(b);return""!==c?c:(new toa.models.TimeIntervalModel({label:b})).getIntervalText()},getVerticalScrolledHeader:function(){for(var b=this.model.getBuckets(),c=this.model.getQuotaCategories(),b=new d({day:"all",bucket:b[0]}),g="",k="primary",l="<b>"+this.model.getCurrentArea().name+"</b>",g=g+"<tr>"+('<td class="h '+k+'">'+l+"</td>"),g=g+"</tr>",n=this.getCategoriesLookups(),
p=0,s=n.length;p<s;p++)l=n[p],k=c.indexOf(""+l.id),-1!==k&&(b.category=c[k],this.model.isCoordinateVisible(b)&&(k="secondary",l=l.hasOwnProperty("text")?l.text:this.model.getCategoryName(b.category),g+="<tr>",g+='<td class="h '+k+'">'+l+"</td>",g+="</tr>"));return['<table id="capacity_vert_scrolled_table" class="capacity" >',g,'<tr><td id="space_for_horiz_scroll" class="h" style="display: none;"></td></tr></table>'].join("")},getScrollableTable:function(){for(var b=this.getDates(),c=this.model.getQuotaCategories(),
g=this.model.getBuckets(),k=this.model.getCurrentArea(),l="",n="",p="",s=this.getCategoriesLookups(),t=-1,u=s.length;t<u;t++){var v=(n=s[t]||null)&&"undefined"!==typeof n.id?""+n.id:null,p=c.indexOf(v);if(null==n||-1!==p){l+="<tr>";n="secondary";p=this.model.getCategoryName(v);p||(n="primary",p="<b>"+k.name+"</b>");l+='<td class="h '+n+'">'+p+"</td>";for(n=0;n<b.length;n++)for(var p=n===b.length-1,w=b[n],x=!0,y=0,z=g.length;y<z;y++){var A=y===z-1,B=g[y],D=new d({day:w,bucket:B}),C=this.model.getOld(D,
"timeslots")||null;if(C||"ti"!==B){if(x&&C&&"ts"===B){var x=!1,F=new d({day:w,bucket:B,timeSlot:null,category:v||null});F.fieldsList=["status","close_time"];l+=this.getSectorHtml(F,p,!1,!1)}C&&"ti"===B&&(C=this.getSortedTimeIntervals(C));C=C?Object.keys(C):[];F=this.getTimeSlotLookups(B);if(!F||!F.length)for(var J in C)F.push({label:C[J]});for(var H=0,K=0,G=F.length;K<G;K++){var L=F[K],I=C.indexOf("ts"===B?""+L.id:""+L.label);if(-1!==I){H++;var M=H===C.length;(L=M)&&p&&A&&(L=!0);D.category=v||0;D.timeSlot=
C[I]||null;D.fieldsList=["status","close_time"];l+=this.getSectorHtml(D,p,!1,L)}}}else B=new d({day:w,bucket:B,timeSlot:"all",category:v||null}),B.fieldsList=["status","close_time"],L=!0,p&&A&&(L=!1),l+=this.getSectorHtml(B,p,!1,L)}l+="</tr>"}}b=this.getHorizontalInsideHeader();return['<table id="capacity_table_scrollable" class="capacity" ><tr class="h"><td rowspan="2">','<div id="capacity_orig_header2"><b>'+toa.glossary({id:11423})+"</b></div>","</td>",b,"</tr>",l,"</table>"].join("")},getSectorHtml:function(b,
c,d,k){c="";for(var l=[],l="undefined"!==typeof b.fieldsList?b.fieldsList:this.getDateFields(b),n=this.model.get(b,"rw",0),p=this.isFilterByEntityApplied(),n=this.model.maskToFieldsLabels(n),s=0;s<l.length;s++){var t=l[s],u=-1===$.inArray(t,n)||p&&this.isCellLocable(t);"ts"===b.bucket&&b.category&&b.day&&!b.timeSlot&&(u=!0);var v=s===l.length-1,t=this.getCellHtml(b,t,u,k&&v,d);c+=t}return c},getStatusClass:function(b){b=this.model.getBookingSectorStatus(b);return{open:"tick",closed:"cross",half:"half",
empty:" "}[b.status]+(b.isChanged?" changed-cell ":"")},shouldUnlockTimeIntervalCell:function(b,c,d){if(null===d||"ti"!==b.bucket||"status"!==c)return!1;b=0!==(d&this.model.STATUS.CLOSED);return 0!==(d&this.model.STATUS.CLOSED_ON_TOP_LEVEL)&&b},getCellHtml:function(b,c,d,k,l){var n=this.model.get(b,c);this.shouldUnlockTimeIntervalCell(b,c,n)&&(d=!1);var p=d||this.isReadOnlyMode()?"readonlyCell":"readwriteCell",s="text",t=null!==this.model.getDelta(b,c);k=(k?"vs ":"")+(l?"hs ":"");l=this.getTitleText(c,
b);t&&"status"!=c&&"close_time"!=c&&(k+="changed-cell ",l&&(l='title = "'+l+'" '));n=this.formatValue(c,n);this.isColoredField(c)&&(k+=this.getCellColorClass(b)+" ");this.isCapacityCellLocked(b,c,d)&&(k+="capacity-cell-locked ");d="";switch(c){case "stop_booking_at":k+=this.getBookingCellColorClass(b)+" ";break;case "status":s="popup";k+=this.getStatusClass(b);n="";d=this.model.get(b,"available")||0;t=0<=d?"color: green":"color: red";d=this.decorateTo(d);d='<div style="margin-right: 5px;margin-left: 5px;padding-left:25px;'+
t+'">'+d+"</div>";break;case "close_time":s=this.model.getSectorCloseTime(b),k+=s.isSectorChanged?"changed-cell ":"",s="popup",n=this.getCloseTimeText(b)}return['<td id="',this.coordToId(b,c),'" style="min-width:105px !important;max-width:105px !important;overflow: hidden;" class="',p," ",k,'" data-label="',c,'" data-edittype="',s,'" aria-haspopup="true" title="',l,'">',n,d,"</td>"].join("")},isCapacityCellLocked:function(b,c,d){return!1===d&&this.isCellLocable(c)&&this.model.isLocked(b)},decorateTo:function(b){return"undefined"===
typeof b?"":"hours"===this.model.uom.getUom()?Math.round(b/60*100)/100:"man-days"===this.model.uom.getUom()?Math.round(b/parseInt(this.model.uom.getHoursInManDay())/60*100)/100:b},isTotalReadOnly:function(b){return this.filterValues.categories||!this.model.getBucketSettings(b).isQuotaDefinedInMinutes(b)?!0:!1},isFilterByEntityApplied:function(){return this.filterValues.categories},idToCoord:function(b){b=b.split("__");var c=new d({bucket:b[0],day:b[1],timeSlot:b[2],category:+b[3]});c.field=b[4];return c},
bindTableEvents:function(){var b=this;c.prototype.bindTableEvents.apply(this,arguments);this.container.find("#capacity_div_horiz_scrolled_header").on("click",".readwriteCell[data-label=status]",function(c){c=$(this);var d=b.idToCoord(c.attr("id"));b.notify("statusClicked",c,d)}).on("click",".readonlyCell[data-label=status]",function(c){c=$(this);var g=b.idToCoord(c.attr("id"));"category"===(new d(g)).getLevelName()&&b.notify("readonlyStatusClicked",c,g)})}})}());toa.ns("toa.views.quota.ViewTableAvailableCapacity",function(){return toa.define(toa.views.quota.ViewTable,function(d,c){this.container=null;this.lookups=c;d&&this.setModel(d)},{render:function(d){this.container=d=$(d);d=this.getMainTemplate().apply();d+=this.getZoomTracerHtml();this.container.html(d);this.helper=new toa.views.quota.ViewHelper;this.helper.setCapacityTableNegativeMargins();this.gridResize();this.helper.bindEvents();this.helper.bindScrolls()},gridResize:function(){this.helper.syncTableHeadersWidth();
this.syncTableHeadersWidth();this.helper.resizeCapacityTable();$("#capacity_horiz_scrolled_table").width($("#capacity_horiz_scrolled_table").outerWidth()+1)},syncTableHeadersWidth:function(){var d=$("#capacity_horiz_scrolled_table"),c=$("#capacity_table_scrollable"),d=$(d).find(".capacityHeaderField"),b=$(c).find(".capacityHeaderField");d&&b&&$(d).each(function(c){var d=$(this);c=$(b[c]);var k=$(c).width();d.width(k);c.width(k)})},setModel:function(d){this.model=d;this.makeSmallTableForMultiday();
this.bucketId=0;this.isMultiBucket=!1;this.metadata=this.preapareMetaData();this.timeIntervals=this.model.getTimeIntervals()},setPlannsModel:function(d){this.plansModel=d},isMultidayView:function(){return 1<this.model.getDates().length},makeSmallTableForMultiday:function(){if(1<this.model.data.length)for(var d in this.model.timeIntervals)"all"==this.model.timeIntervals[d].label&&(this.model.timeIntervals=[this.model.timeIntervals[d]])},getMainTemplate:function(){return new toa.Template(['<table id="capacity_table_manage_scrollers" class="availableCapacityTable category">',
'<tr class="vtop">',"<td>",'<div id="capacity_div_nonscrolled_header">',this.getNonScrolledHeader(),"</div>","</td>","<td>",'<div id="capacity_div_horiz_scrolled_header">',this.getHorizontalScrolledHeader(),"</div>","</td>","</tr>",'<tr class="vtop">','<td rowspan="2">','<div id="capacity_div_vert_scrolled_header" >',this.getVerticalScrolledHeader(),"</div>","</td>","<td>",'<div id="capacity_div_scrollable">',this.getScrollableTable(),"</div>","</td>",'<td id="capacity_vert_scroll_td">','<div id="capacity_vert_scroll" >',
'<div id="capacity_inner_vert_scroll" ></div>',"</div>","</td>","</tr>","<tr>","<td>",'<div id="capacity_horiz_scroll" style="display: none;">','<div id="capacity_inner_horiz_scroll" ></div>',"</div>","</td>","<td>","</td>","</tr>","</table>"])},getNonScrolledHeader:function(){var d=this.isMultidayView()?2:3;return(new toa.Template(['<table id="capacity_non_scrolled_table" class="capacity" >','<tr class="h">','<td rowspan="'+d+'">','<div data-id="capacity_orig_header2">',"<b>"+toa.glossary({id:11423})+
"</b>","</div>","</td>","</tr>","</table>"])).apply()},getCategoriesLookups:function(){var d=[];this.lookups.capacityCategories.length&&(d=this.lookups.capacityCategories);return d},getVerticalScrolledHeader:function(){var d=0,c="",b=this.model.getCurrentArea(),e=this.getCategoriesLookups(),g;for(g in this.metadata)if(this.metadata.hasOwnProperty(g))for(var k=this.metadata[g],l="<b>"+(k.name||b.name)+"</b>",c=c+"<tr>",c=c+('<td class="h primary">'+l+"</td>"),c=c+"</tr>",k=k.categories,l=0,n=e.length;l<
n;l++){var p=""+e[l].label;k.hasOwnProperty(p)&&(c+="<tr>",c+='<td class="h secondary" data-id="'+p+'">'+k[p].name+"</td>",c+="</tr>",d++)}return['<table id="capacity_vert_scrolled_table" class="capacity" >',c,'<tr><td id="space_for_horiz_scroll" class="h" colspan="2" style="display: none;"></td></tr></table>'].join("")},preapareMetaData:function(){var d={},c=this.model.data;if(c.length&&0<c.length)for(var b=0;b<c.length;b++){var e=c[b].areas;if(e)for(var g=0;g<e.length;g++){var k=e[g],l=k.label||
"total";d[l]||(d[l]={name:k.name||null,categories:{},categoriesLabels:{},htmlData:[]});for(var n=0;n<k.categories.length;n++){var p=k.categories[n];d[l].categories[p.label]||(d[l].categoriesLabels[p.label]={label:p.label,name:this.model.getCategoryName(p.label)},d[l].categories[p.label]={name:this.model.getCategoryName(p.label),htmlData:[]})}}}return d},getScrollableTable:function(){for(var d=0,c="",b=this.model.data,e=Object.keys(this.metadata),g=!1,k=null,l=this.getCategoriesLookups(),n=0;n<b.length;n++){n===
b.length-1&&(g=!0);for(var k=b[n].date,p=0;p<e.length;p++){var s=e[p],t=this.model.findAreaByLabel(n,s),u=-1<t?b[n].areas[t]:null;this.metadata[s].htmlData[n]=this.getSectorHtml(u,g,k);Object.keys(this.metadata[s].categories);for(var v=0,w=l.length;v<w;v++){var x=l[v],u=x.label;"undefined"!==typeof this.metadata[s].categoriesLabels[u]&&(x=this.model.getAreaCategory(n,t,u),this.metadata[s].categories[u].htmlData[n]=this.getSectorHtml(x,g,k))}}}var b=this.model.getCurrentArea(),y;for(y in this.metadata)if(this.metadata.hasOwnProperty(y))for(u=
this.metadata[y],v="<b>"+(u.name||b.name)+"</b>",c+="<tr>",c+='<td class="h primary">'+v+"</td>",c+=u.htmlData.join(""),c+="</tr>",v=0,w=l.length;v<w;v++)x=l[v],e=x.label,u.categories.hasOwnProperty(e)&&(c+="<tr>",c+='<td class="h secondary" id="'+e+'">'+u.categories[e].name+"</td>",c+=u.categories[e].htmlData.join(""),c+="</tr>",d++);d=this.getHorizontalInsideHeader();return['<table id="capacity_table_scrollable" class="capacity" ><tr class="h">','<td rowspan="'+(this.isMultidayView()?2:3)+'" class="capacity_orig_header2">',
'<div data-id="capacity_orig_header2"><b>'+toa.glossary({id:11423})+"</b></div>","</td>",d,"</tr>",c,"</table>"].join("")},getSectorHtml:function(d,c,b){for(var e,g,k="",l=!1,n=0;n<this.timeIntervals.length;n++){var p=this.model.getIntervalFieldsCount(n);g=n===this.timeIntervals.length-1;for(var s=0;s<p;s++){e=s===p-1;var t=this.timeIntervals[n].fields[s];!c&&g&&e&&(l=!0);k+=this.getCellHTML(d,t,l,this.timeIntervals[n].label,b)}}return k},isActivitiesListDownloadAvailable:function(d,c,b){return"all"===
b&&d!=c},getCellHTML:function(d,c,b,e,g){var k="",l="",n="all";this.isCellClickable=!1;if(d&&c){if(c.firstSource&&c.secondSource){var p=d.getFieldValue(c.firstSource,c.sourceIndex,!0),s=d.getFieldValue(c.secondSource,c.sourceIndex,!0);""!==p&&""!==s&&(k=this.decorateCellMaxAvailableTime(p,s,g,c,e,d.entityType))}else k=d.getFieldValue(c.source,c.sourceIndex,!0),"undefined"!==typeof c.decorateValue&&(k=c.decorateValue(k)),"available_capacity"===c.label&&(p="",0!==k&&(p=0<k?" ll":" hl"),k='<span class="capacityCellValue '+
p+'">'+k+"</span>");"undefined"!==typeof c.label&&"max_available_resources"==c.label&&(k=this.decorateCellMaxAvailableResources(k,g,e,d.entityType))}b&&(l=" vs ");this.isCellClickable&&(l+=" capacityCellActive ");"all"==e&&(l+=" all-day");b=this.getCategoriesLookups();p=0;for(s=b.length;p<s;p++)d.label==""+b[p].label&&(n=b[p].id);return['<td id="ti__'+g+"__"+e+"__"+n+"__"+c.label+'" class="capacityCell readwriteCell '+l+'">',k,"</td>"].join("")},isCapacityPlanEditorAvailableForCell:function(d,c,b,
e){return"group"!==this.model.getCurrentArea().type&&"area"===d&&"all"===c&&this.plansModel.isCapacityAreaPlanDefined(b,this.model.getCurrentArea().providerId)&&this.model.getPlannedCapacityMeasureType()===e},decorateCellMaxAvailableTime:function(d,c,b,e,g,k){var l="",n="",p="",s="capacityPlannedVarianceHidden",t="",u=c;"available_capacity"===e.label&&0!==d&&(t=0<d?" ll":" hl");var v="";this.isActivitiesListDownloadAvailable(d,c,g)&&(v=" csv_activity ",this.isCellClickable=!0);"all"===g&&(v+=" capacityCellDataContainer ");
this.isCapacityPlanEditorAvailableForCell(k,g,b,"availableTime")&&(v+=" planned_capacity_hours_hint ",p=' data-date="'+b+'"  data-maxvalue="'+u+'" ',this.isCellClickable=!0,this.plansModel.setCapacityTypeAsTime(),g=this.plansModel.getCapacityAreaPlanVariance(b,c,this.model.getCurrentArea().providerId),k="",""!==g&&("undefined"!==typeof e.decorateValue&&(g=e.decorateValue(g)),s=0!==g?" capacityPlannedVarianceWarning ":" capacityPlannedVarianceOk ",k=0<g?"+"+g:g,0===g&&(k="&nbsp;")),+new Date(b)>=+new Date(this.plansModel.pceNoDataDate)&&
(s="capacityPlannedVarianceHidden",v+=" center_value "),""==k&&(v+=" center_value "),l='<span class="capacityPlannedVarianceContainer"><span class="capacityCellValue capacityPlannedVariance '+s+'">'+k+"</span></span>");"undefined"!==typeof e.decorateValue&&(d=e.decorateValue(d),c=e.decorateValue(c));n=n+('<span class="'+v+'" '+p+">")+'<span class="capacityCellAvailable">';n+='<span class="capacityCellValue'+t+'">'+d+"</span>";n+='<span class="capacityCellDelimiter"></span>';n+='<span class="capacityCellValue">'+
c+"</span>";n+="</span>";n+=l;return n+="</span>"},decorateCellMaxAvailableResources:function(d,c,b,e){var g="",k="",l="",n="capacityPlannedVarianceHidden",k='<span class="capacityCellAvailable">'+d+"</span>";0<d&&(g=" csv_resource ",this.isCellClickable=!0);this.isCapacityPlanEditorAvailableForCell(e,b,c,"availableResourcesCount")&&(this.plansModel.setCapacityTypeAsCount(),b=this.plansModel.getCapacityAreaPlanVariance(c,d,this.model.getCurrentArea().providerId),e="",""!==b&&(n=0!==b?" capacityPlannedVarianceWarning ":
" capacityPlannedVarianceOk ",e=0<b?"+"+b:b,0===b&&(e="&nbsp;")),+new Date(c)>=+new Date(this.plansModel.pceNoDataDate)&&(n="capacityPlannedVarianceHidden",g=" center_value "),""==e&&(g=" center_value "),k+='<span class="capacityPlannedVarianceContainer"><span class="capacityPlannedVariance '+n+'">'+e+"</span></span>",this.isCellClickable=!0,g+=" planned_capacity_count_hint ",l=' data-date="'+c+'"  data-maxvalue="'+d+'" ');return'<span class="'+g+'" '+l+">"+k+"</span>"},getHorizontalScrolledHeader:function(){for(var d=
this.model.getDates(),c="",b="",e="",g=this.getDayColspan(),k=0;k<d.length;k++)var l=k===d.length-1,n=l?"":"vs",p=this.formatDate(d[k]),c=c+('<td class="h '+n+'" colspan="'+g+'"><b>'+p+"</b></td>"),b=b+this.getHeaderTimeIntervals(l),e=e+this.getHeaderIntervalFields(l);return['<table id="capacity_horiz_scrolled_table" class="capacity"><tr class="h">',c,'<td id="space_for_vert_scroll" rowspan="3" ><div id="inner_space_for_vert_scroll"></div></td></tr><tr class="h">',b,'</tr><tr class="h">',e,"</tr></table>"].join("")},
getHorizontalInsideHeader:function(){for(var d=this.model.getDates(),c="",b="",e="",g=this.getDayColspan(),k=0;k<d.length;k++)var l=k===d.length-1,n=l?"":"vs",p=this.formatDate(d[k]),c=c+('<td class="h '+n+'" colspan="'+g+'"><b>'+p+"</b></td>"),b=b+this.getHeaderTimeIntervals(l),e=e+this.getHeaderIntervalFields(l);d=[];d.push(c);d.push("</tr>");this.isMultidayView()||(d.push('<tr class="h">'),d.push(b),d.push("</tr>"));d.push('<tr class="h">');d.push(e);return d.join("")},getHeaderTimeIntervals:function(d){if(this.isMultidayView())return"";
for(var c="",b="",e=0;e<this.timeIntervals.length;e++)var g=this.timeIntervals[e],k=g.caption,c=e===this.timeIntervals.length-1,c=!d&&c?"vs":"",l=this.model.getIntervalFieldsCount(e),b=b+['<td class="'+c+'" colspan="'+l+'">','<div class="small_header" data-label="'+g.label+'">',k,"</div></td>"].join("");return b},getHeaderIntervalFields:function(d){for(var c="",b="",e,g=!1,k=0;k<this.timeIntervals.length;k++)for(var l=this.timeIntervals[k],g=k===this.timeIntervals.length-1,n=this.timeIntervals[k].fields,
p=0;p<n.length;p++){c="";e=p===n.length-1;var s=n[p];!d&&g&&e&&(c="vs");"all"===l.label&&(c+=" all-day");b+=['<td class="capacityHeaderField '+c+'">','<div class="small_header header_cell" data-label="'+s.label+'">',s.caption,"</div></td>"].join("")}return b},getDayColspan:function(){return this.model.getIntervalFieldsCount()}})}());toa.ns("toa.views.quota.PopupMassPopulate",function(){var d=toa.define(null,function(c){this.content="";this.dialogPopup=null;this.dialogContent="";this.dates=c.dates;this.fields=c.fields;this.fieldTranslations=c.fieldTranslations;this.workZones=c.workZones;this.error=!1;this.errorFieldNames={sourceCount:toa.glossary({id:11473})};this.msPerDay=toa.date.DAY;this.isDatesDiscontinuous=this.isDiscontinuousInterval(this.dates);this.selectedOperation="";this.init()},{init:function(){this.sourceDate="";
this.createContent();this.makePopup();this.createCalendar()},show:function(){this.dialogPopup.show();this.bindEvents();this.renderCalendar()},hide:function(){this.dialogPopup.destroy();this.dialogPopup=null;this.calendar&&(this.calendar.destroy(),this.calendar=null)},save:function(){var c=this.dialogContent.find("#massPopulateField").val(),b=this.dialogContent.find("input[name=operation]:checked").val(),d={field:c,operation:b,targetDates:this.dates};switch(b){case "copy_day_to_day":case "copy_week_to_week":d.sourceDate=
this.sourceDate;d.sourceField="quota"==c?this.dialogContent.find('[data-id="extrapolate-source-field"]').val()||"":c;break;case "percent_shift":c=this.dialogContent.find('[data-id="multiply-percent"]').val()/100;d.multiplyBy=c||"";break;case "close_work_zone":case "open_work_zone":d.workZoneId=this.dialogContent.find('[data-id="work-zone-id"]').val()||"";break;case "extrapolate_day_to_day":case "extrapolate_week_to_week":d.sourceCount=this.dialogContent.find('[data-id="extrapolate-source-count"]').val()||
""}this.notify("applyMassPopulate",d)},createContent:function(){if(this.fields&&this.fields.length){var c=this.fields[0].label;this.selectedOperation=this.getDefaultOperationLabel(c,this.fields);this.content=['<table class="capacity-mass-populate"><tr><td class="mass-populate-field-name"><label for="massPopulateField">',toa.glossary({id:11472}),'</label></td><td class="capacity-mass-populate-padded">',this.getFieldHtml(this.fields),'</td></tr><tr><td><label id="lbl__mass-populate-operation-field">',
toa.glossary({id:11474}),'</label></td><td id="mass-populate-operation-field">',this.getOperationsHtml(c,this.fields),"</td></tr><tr><td>",toa.glossary({id:5854}),'</td><td class="mass-populate-read-only capacity-mass-populate-padded">',this.getShiftedDatesLabel(),'</td></tr><tr data-id="source-date"><td class="mass-populate-field-name" data-id="source-date-label">',this.getSourceDateLabel(this.selectedOperation),'</td><td class="mass-populate-read-only" data-id="source-date-values"><span data-id="source-date-calendar-container"></span><span data-id="source-date-values-container">',
this.getSourceDateValues(this.selectedOperation),'</span></td></tr><tr data-id="additional-fields"><td  lass="mass-populate-field-name" data-id="additional-fields-label">',this.getAdditionalLabel(this.selectedOperation),'</td><td data-id="additional-fields-data" class="capacity-mass-populate-padded">',this.getAdditionalValue(this.selectedOperation,c),"</td></tr></table>"].join("")}else this.content=toa.glossary({id:11475}),this.error=toa.glossary({id:11475})},getFieldHtml:function(c){for(var b='<select name="field" class="toa-view-control-select" id="massPopulateField">',
d=0;d<c.length;d++)var g=c[d],b=b+('<option value="'+g.label+'">'+g.name+"</option>");return b+"</select>"},getOperationsHtml:function(c,b){var d=this.getOperationsByFieldLabel(c,b),g="",k="checked",l="",n;for(n in d){var p=d[n];!this.isDatesDiscontinuous||"shift_forward"!=p.label&&"shift_backward"!=p.label&&"percent_shift"!=p.label||(l="disabled");g+='<input aria-describedby="lbl__mass-populate-operation-field" type="radio" name="operation" value="'+p.label+'" id="'+p.label+'" '+k+" "+l+" />";g+=
'<label for="'+p.label+'">'+p.name+"</label><br>";l=k=""}return g},getOperationsByFieldLabel:function(c,b){for(var d=0;d<b.length;d++){var g=b[d];if(g.label==c)return g.operations}return[]},getDefaultOperationLabel:function(c,b){var d=this.getOperationsByFieldLabel(c,b),g;for(g in d)return d[g].label;return""},getShiftedDatesLabel:function(c,b){c||(c=0);b&&b.length||(b=this.dates);if(!b.length)return"";if(1==b.length){var d=toa.date.parseDate("iso",b[0]);d.setTime(d.getTime()+c*this.msPerDay);return this.capacityDateStr(d)}var d=
toa.date.parseDate("iso",b[0]),g=toa.date.parseDate("iso",b[b.length-1]);d.setTime(d.getTime()+c*this.msPerDay);g.setTime(g.getTime()+c*this.msPerDay);return this.capacityDateStr(d)+" ... "+this.capacityDateStr(g)},bindEvents:function(){var c=this;this.dialogContent.find("#massPopulateField").on("change",function(){c.dialogContent.find("#mass-populate-operation-field").empty().html(c.getOperationsHtml($(this).val(),c.fields));c.operationSelected(c.dialogContent.find("input[name=operation]:checked").val())});
this.dialogContent.find("#mass-populate-operation-field").on("click","input",function(){var b=$(this).val();c.selectedOperation!=b&&c.operationSelected(b)})},operationSelected:function(c){this.selectedOperation=c;var b=this.dialogContent;switch(c){case "copy_day_to_day":case "copy_week_to_week":b=b.find("#massPopulateField").val();this.showSourceDateField(c,!0);this.showAdditionalField(c,b);this.fillSourceDate(this.calendar.getDate());break;case "shift_forward":case "shift_backward":this.showSourceDateField(c,
!1);this.hideAdditionalField();break;case "percent_shift":this.showSourceDateField(c,!1);this.showAdditionalField(c);break;case "close_work_zone":case "open_work_zone":this.hideSourceDateField();this.showAdditionalField(c);break;case "extrapolate_day_to_day":case "extrapolate_week_to_week":this.hideSourceDateField();this.showAdditionalField(c);break;default:this.hideSourceDateField(),this.hideAdditionalField()}},showSourceDateField:function(c,b){this.dialogContent.find('[data-id="source-date"]').show();
this.dialogContent.find('[data-id="source-date-label"]').html(this.getSourceDateLabel(c));b?(this.dialogContent.find('[data-id="source-date-calendar-container"]').show(),this.dialogContent.find('[data-id="source-date-values-container"]').hide()):(this.dialogContent.find('[data-id="source-date-calendar-container"]').hide(),this.dialogContent.find('[data-id="source-date-values-container"]').show().html(this.getSourceDateValues(c)))},hideSourceDateField:function(){this.dialogContent.find('[data-id="source-date"]').hide()},
showAdditionalField:function(c,b){this.dialogContent.find('[data-id="additional-fields"]').show();this.dialogContent.find('[data-id="additional-fields-label"]').html(this.getAdditionalLabel(c));this.dialogContent.find('[data-id="additional-fields-data"]').html(this.getAdditionalValue(c,b))},hideAdditionalField:function(){this.dialogContent.find('[data-id="additional-fields"]').hide()},getSourceDateLabel:function(c){var b="";switch(c){case "copy_day_to_day":case "percent_shift":b=toa.glossary({id:11467});
break;case "copy_week_to_week":b=toa.glossary({id:11468});break;case "shift_forward":case "shift_backward":b=toa.glossary({id:5855})}return b},getSourceDateValues:function(c){var b="";switch(c){case "shift_forward":b=this.getShiftedDatesLabel(-1);break;case "shift_backward":b=this.getShiftedDatesLabel(1);break;case "percent_shift":b=this.getShiftedDatesLabel(-1,[this.dates[0]])}return b},getAdditionalLabel:function(c){switch(c){case "percent_shift":return'<label id="lbl__additional-fields">'+toa.glossary({id:11469})+
"</label>";case "close_work_zone":case "open_work_zone":return'<label id="lbl__additional-fields">'+toa.glossary({id:12010})+"</label>";case "copy_day_to_day":case "copy_week_to_week":case "extrapolate_day_to_day":case "extrapolate_week_to_week":return'<label id="lbl__additional-fields">'+toa.glossary({id:11473})+"</label>"}return""},getAdditionalValue:function(c,b){var d="";switch(c){case "copy_day_to_day":case "copy_week_to_week":d="quota"==b?['<select  aria-labelledby="lbl__additional-fields" name="source" class="toa-view-control-select" data-id="extrapolate-source-field">',
'<option value="quota">'+this.fieldTranslations.quota+"</option>",'<option value="used">'+this.fieldTranslations.used+"</option>","</select>"].join(""):['<span class="mass-populate-read-only">',this.fieldTranslations[b],"</span>"].join("");break;case "percent_shift":d=toa.glossary({id:18132,type:"htmlExceptPlaceholder",translations:{"{INPUTBOX}":'<input aria-labelledby="lbl__additional-fields" size="3" maxlength="4" data-id="multiply-percent" value="98">'}});break;case "close_work_zone":case "open_work_zone":d=
this.makeWorkZoneList();break;case "extrapolate_day_to_day":case "extrapolate_week_to_week":d=toa.glossary({id:"extrapolate_day_to_day"==c?18135:18136,type:"htmlExceptPlaceholder",translations:{"{INPUT}":'<input size="3" aria-labelledby="lbl__additional-fields" maxlength="4" data-id="extrapolate-source-count" value="10"> '}})}return d},makeWorkZoneList:function(){for(var c=['<select class="toa-view-control-select" data-id="work-zone-id">'],b=[],d=0;d<this.workZones.length;d++){var g=this.workZones[d].id,
k=this.workZones[d].name;-1<$.inArray(g,b)||(c.push('<option value="'+hs(g)+'">'+hs(k)+"</option>"),b.push(g))}c.push("</select>");return c.join("")},createCalendar:function(){this.calendar=new toa.view.calendar.Calendar;this.calendar.setToday(toa.app.get("today"))},renderCalendar:function(){var c=this.dialogContent.find("[data-id='source-date-calendar-container']");this.calendar.renderTo(c);this.calendar.addListener("changeDate",this.onCalendarApplied.bind(this));c.find(".prev").hide();c.find(".next").hide();
this.fillSourceDate(this.calendar.getDate())},onCalendarApplied:function(c,b){this.fillSourceDate(b)},fillSourceDate:function(c){var b="";this.sourceDate="";var d=!!this.dialogContent.find("#copy_day_to_day").prop("checked"),g=!!this.dialogContent.find("#copy_week_to_week").prop("checked");d?(this.sourceDate=c,b+=this.capacityDateStr(toa.date.parseDate("iso",c))):g&&(c=this.getWeekDaysByDate(c),b+=this.capacityDateStr(c[0])+" - "+this.capacityDateStr(c[6]),this.sourceDate=toa.date.formatDate("iso",
c[0]));this.dialogContent.find('[data-id="source-date-calendar-container"]').find(".date").empty().html(b)},capacityDateStr:function(c){return toa.date.formatDate("D, M jS",c)},makePopup:function(){var c=[{text:toa.glossary({id:6413}),click:this.hide.bind(this)}];this.error||c.push({type:"submit",text:toa.glossary({id:99}),click:this.save.bind(this)});this.dialogPopup=new toa.ui.Popup({title:toa.glossary({id:5845}),modal:!0,html:this.content,onClose:this.hide.bind(this),buttons:c});this.dialogContent=
$(this.dialogPopup.getDomContent())},getWeekDaysByDate:function(c){c=toa.date.parseDate("iso",c);var b=toa.date.firstDay,b=c.getDay()-(b>c.getDay()?b-7:b);c.setTime(c.getTime()-b*this.msPerDay);for(var b=[],d=0;7>d;d++){var g=new Date;g.setTime(c.getTime()+d*this.msPerDay);b.push(g)}return b},isDiscontinuousInterval:function(c){if(2>c.length)return!1;for(var b=1;b<c.length;b++)if(new Date(c[b])-new Date(c[b-1])>this.msPerDay)return!0;return!1},setError:function(c,b){b&&(c=c.replace("{FIELD_NAME}",
this.errorFieldNames[b]?"'"+this.errorFieldNames[b]+"'":""));this.dialogPopup.setErrors([{id:"someErrorWhileSaving",message:c}])},toString:function(){return"Popup Mass populate"}});toa.mixin(d.prototype,toa.mixins.EventEmitter);return d}());toa.ns("toa.views.quota.PopupMassPopulateQuota",function(){var d=toa.define(null,function(c){this.content="";this.dialogPopup=null;this.dialogContent="";this.dates=c.dates;this.fields=c.fields;this.fieldTranslations=c.fieldTranslations;this.error=!1;this.errorFieldNames={sourceCount:toa.glossary({id:11473})};this.msPerDay=toa.date.DAY;this.isDatesDiscontinuous=this.isDiscontinuousInterval(this.dates);this.selectedOperation="";this.init()},{init:function(){this.sourceDate="";this.createContent();this.makePopup();
this.createCalendar()},show:function(){this.dialogPopup.show();this.bindEvents();this.renderCalendar()},hide:function(){this.dialogPopup.destroy();this.dialogPopup=null;this.calendar&&(this.calendar.destroy(),this.calendar=null)},save:function(){var c=this.dialogContent.find("#massPopulateField").val(),b=this.dialogContent.find("input[name=operation]:checked").val(),d={field:c,operation:b,targetDates:this.dates};switch(b){case "copy_day_to_day":case "copy_week_to_week":d.sourceDate=this.sourceDate;
d.sourceField=c;break;case "percent_shift":c=this.dialogContent.find('[data-id="multiply-percent"]').val()/100;d.multiplyBy=c||"";break;case "extrapolate_day_to_day":case "extrapolate_week_to_week":d.sourceCount=this.dialogContent.find('[data-id="extrapolate-source-count"]').val()||""}this.notify("applyMassPopulate",d)},createContent:function(){if(this.fields&&this.fields.length){var c=this.fields[0].label;this.selectedOperation=this.getDefaultOperationLabel(c,this.fields);this.content=['<table class="capacity-mass-populate"><tr><td class="mass-populate-field-name"><label for="massPopulateField">',
toa.glossary({id:11472}),'</label></td><td class="capacity-mass-populate-padded">',this.getFieldHtml(this.fields),'</td></tr><tr><td><label id="lbl__mass-populate-operation-field">',toa.glossary({id:11474}),'</label></td><td id="mass-populate-operation-field">',this.getOperationsHtml(c,this.fields),"</td></tr><tr><td>",toa.glossary({id:5854}),'</td><td class="mass-populate-read-only capacity-mass-populate-padded">',this.getShiftedDatesLabel(),'</td></tr><tr data-id="source-date"><td class="mass-populate-field-name" data-id="source-date-label">',
this.getSourceDateLabel(this.selectedOperation),'</td><td class="mass-populate-read-only" data-id="source-date-values"><span data-id="source-date-calendar-container"></span><span data-id="source-date-values-container">',this.getSourceDateValues(this.selectedOperation),'</span></td></tr><tr data-id="additional-fields"><td lass="mass-populate-field-name" data-id="additional-fields-label">',this.getAdditionalLabel(this.selectedOperation),'</td><td data-id="additional-fields-data" class="capacity-mass-populate-padded">',
this.getAdditionalValue(this.selectedOperation,c),"</td></tr></table>"].join("")}else this.content=toa.glossary({id:11475}),this.error=toa.glossary({id:11475})},getFieldHtml:function(c){for(var b='<select name="field" class="toa-view-control-select" id="massPopulateField">',d=0;d<c.length;d++){var g=c[d];if("quota"===g.label||"stopBookingAt"===g.label)b+='<option value="'+g.label+'">'+g.name+"</option>"}return b+"</select>"},getOperationsHtml:function(c,b){var d=this.getOperationsByFieldLabel(c,b),
g="",k="checked",l="",n;for(n in d){var p=d[n];!this.isDatesDiscontinuous||"shift_forward"!=p.label&&"shift_backward"!=p.label&&"percent_shift"!=p.label||(l="disabled");g+='<input aria-describedby="lbl__mass-populate-operation-field" type="radio" name="operation" value="'+p.label+'" id="'+p.label+'" '+k+" "+l+" />";g+='<label for="'+p.label+'">'+p.name+"</label><br>";l=k=""}return g},getOperationsByFieldLabel:function(c,b){for(var d=0;d<b.length;d++){var g=b[d];if(g.label==c)return g.operations}return[]},
getDefaultOperationLabel:function(c,b){var d=this.getOperationsByFieldLabel(c,b),g;for(g in d)return d[g].label;return""},getShiftedDatesLabel:function(c,b){c||(c=0);b&&b.length||(b=this.dates);if(!b.length)return"";if(1==b.length){var d=toa.date.parseDate("iso",b[0]);d.setTime(d.getTime()+c*this.msPerDay);return this.capacityDateStr(d)}var d=toa.date.parseDate("iso",b[0]),g=toa.date.parseDate("iso",b[b.length-1]);d.setTime(d.getTime()+c*this.msPerDay);g.setTime(g.getTime()+c*this.msPerDay);return this.capacityDateStr(d)+
" ... "+this.capacityDateStr(g)},bindEvents:function(){var c=this;this.dialogContent.find("#massPopulateField").on("change",function(){c.dialogContent.find("#mass-populate-operation-field").empty().html(c.getOperationsHtml($(this).val(),c.fields));c.operationSelected(c.dialogContent.find("input[name=operation]:checked").val())});this.dialogContent.find("#mass-populate-operation-field").on("click","input",function(){var b=$(this).val();c.selectedOperation!=b&&c.operationSelected(b)})},operationSelected:function(c){this.selectedOperation=
c;var b=this.dialogContent;switch(c){case "copy_day_to_day":case "copy_week_to_week":b=b.find("#massPopulateField").val();this.showSourceDateField(c,!0);this.showAdditionalField(c,b);this.fillSourceDate(this.calendar.getDate());break;case "shift_forward":case "shift_backward":this.showSourceDateField(c,!1);this.hideAdditionalField();break;case "percent_shift":this.showSourceDateField(c,!1);this.showAdditionalField(c);break;case "extrapolate_day_to_day":case "extrapolate_week_to_week":this.hideSourceDateField();
this.showAdditionalField(c);break;default:this.hideSourceDateField(),this.hideAdditionalField()}},showSourceDateField:function(c,b){this.dialogContent.find('[data-id="source-date"]').show();this.dialogContent.find('[data-id="source-date-label"]').html(this.getSourceDateLabel(c));b?(this.dialogContent.find('[data-id="source-date-calendar-container"]').show(),this.dialogContent.find('[data-id="source-date-values-container"]').hide()):(this.dialogContent.find('[data-id="source-date-calendar-container"]').hide(),
this.dialogContent.find('[data-id="source-date-values-container"]').show().html(this.getSourceDateValues(c)))},hideSourceDateField:function(){this.dialogContent.find('[data-id="source-date"]').hide()},showAdditionalField:function(c,b){this.dialogContent.find('[data-id="additional-fields"]').show();this.dialogContent.find('[data-id="additional-fields-label"]').html(this.getAdditionalLabel(c));this.dialogContent.find('[data-id="additional-fields-data"]').html(this.getAdditionalValue(c,b))},hideAdditionalField:function(){this.dialogContent.find('[data-id="additional-fields"]').hide()},
getSourceDateLabel:function(c){var b="";switch(c){case "copy_day_to_day":case "percent_shift":b=toa.glossary({id:11467});break;case "copy_week_to_week":b=toa.glossary({id:11468});break;case "shift_forward":case "shift_backward":b=toa.glossary({id:5855})}return b},getSourceDateValues:function(c){var b="";switch(c){case "shift_forward":b=this.getShiftedDatesLabel(-1);break;case "shift_backward":b=this.getShiftedDatesLabel(1);break;case "percent_shift":b=this.getShiftedDatesLabel(-1,[this.dates[0]])}return b},
getAdditionalLabel:function(c){switch(c){case "percent_shift":return'<label id="lbl__additional-fields">'+toa.glossary({id:11469})+"</label>";case "extrapolate_day_to_day":case "extrapolate_week_to_week":return'<label id="lbl__additional-fields">'+toa.glossary({id:11473})+"</label>"}return""},getAdditionalValue:function(c,b){var d="";switch(c){case "percent_shift":d=toa.glossary({id:18132,type:"htmlExceptPlaceholder",translations:{"{INPUTBOX}":'<input aria-labelledby="lbl__additional-fields" size="3" maxlength="4" data-id="multiply-percent" value="98">'}});
break;case "extrapolate_day_to_day":case "extrapolate_week_to_week":d=toa.glossary({id:"extrapolate_day_to_day"==c?18135:18136,type:"htmlExceptPlaceholder",translations:{"{INPUT}":'<input aria-labelledby="lbl__additional-fields" size="3" maxlength="4" data-id="extrapolate-source-count" value="10"> '}})}return d},createCalendar:function(){this.calendar=new toa.view.calendar.Calendar;this.calendar.setToday(toa.app.get("today"))},renderCalendar:function(){var c=this.dialogContent.find("[data-id='source-date-calendar-container']");
this.calendar.renderTo(c);this.calendar.addListener("changeDate",this.onCalendarApplied.bind(this));c.find(".prev").hide();c.find(".next").hide();this.fillSourceDate(this.calendar.getDate())},onCalendarApplied:function(c,b){this.fillSourceDate(b)},fillSourceDate:function(c){var b="";this.sourceDate="";var d=!!this.dialogContent.find("#copy_day_to_day").prop("checked"),g=!!this.dialogContent.find("#copy_week_to_week").prop("checked");d?(this.sourceDate=c,b+=this.capacityDateStr(toa.date.parseDate("iso",
c))):g&&(c=this.getWeekDaysByDate(c),b+=this.capacityDateStr(c[0])+" - "+this.capacityDateStr(c[6]),this.sourceDate=toa.date.formatDate("iso",c[0]));this.dialogContent.find('[data-id="source-date-calendar-container"]').find(".date").empty().html(b)},capacityDateStr:function(c){return toa.date.formatDate("D, M jS",c)},makePopup:function(){var c=[{text:toa.glossary({id:6413}),click:this.hide.bind(this)}];this.error||c.push({type:"submit",text:toa.glossary({id:99}),click:this.save.bind(this)});this.dialogPopup=
new toa.ui.Popup({title:toa.glossary({id:5845}),modal:!0,html:this.content,onClose:this.hide.bind(this),buttons:c});this.dialogContent=$(this.dialogPopup.getDomContent())},getWeekDaysByDate:function(c){c=toa.date.parseDate("iso",c);var b=toa.date.firstDay,b=c.getDay()-(b>c.getDay()?b-7:b);c.setTime(c.getTime()-b*this.msPerDay);for(var b=[],d=0;7>d;d++){var g=new Date;g.setTime(c.getTime()+d*this.msPerDay);b.push(g)}return b},isDiscontinuousInterval:function(c){if(2>c.length)return!1;for(var b=1;b<
c.length;b++)if(new Date(c[b])-new Date(c[b-1])>this.msPerDay)return!0;return!1},setError:function(c,b){b&&(c=c.replace("{FIELD_NAME}",this.errorFieldNames[b]?"'"+this.errorFieldNames[b]+"'":""));this.dialogPopup.setErrors([{id:"someErrorWhileSaving",message:c}])},toString:function(){return"Popup Mass populate"}});toa.mixin(d.prototype,toa.mixins.EventEmitter);return d}());toa.ns("toa.views.quota.PopupMassPopulateBookingStatus",function(){var d=toa.define(null,function(c){this.content="";this.dialogPopup=null;this.dialogContent="";this.dates=c.dates;this.fields=c.fields;this.fieldTranslations=c.fieldTranslations;this.workZones=c.workZones;this.error=!1;this.errorFieldNames={sourceCount:toa.glossary({id:11473})};this.msPerDay=toa.date.DAY;this.isDatesDiscontinuous=this.isDiscontinuousInterval(this.dates);this.selectedOperation="";this.init()},{init:function(){this.sourceDate=
"";this.createContent();this.makePopup();this.createCalendar()},show:function(){this.dialogPopup.show();this.bindEvents();this.renderCalendar()},hide:function(){this.dialogPopup.destroy();this.dialogPopup=null;this.calendar&&(this.calendar.destroy(),this.calendar=null)},save:function(){var c=this.dialogContent.find("#massPopulateField").val(),b=this.dialogContent.find("input[name=operation]:checked").val(),d={field:c,operation:b,targetDates:this.dates};switch(b){case "close_work_zone":case "open_work_zone":d.workZoneId=
this.dialogContent.find('[data-id="work-zone-id"]').val()||"";break;case "copy_day_to_day":case "copy_week_to_week":d.sourceDate=this.sourceDate,d.sourceField=c}this.notify("applyMassPopulate",d)},createContent:function(){if(this.fields&&this.fields.length){var c=this.fields[0].label;this.selectedOperation=this.getDefaultOperationLabel(c,this.fields);this.content=['<table class="capacity-mass-populate"><tr><td class="mass-populate-field-name">',toa.glossary({id:11472}),'</td><td class="capacity-mass-populate-padded">',
toa.glossary({id:18042}),this.getFieldHtml(this.fields),'</td></tr><tr><td><label id="descr__mass-populate-operation-field">',toa.glossary({id:11474}),'</label></td><td id="mass-populate-operation-field">',this.getOperationsHtml(c,this.fields),"</td></tr><tr><td>",toa.glossary({id:5854}),'</td><td class="mass-populate-read-only capacity-mass-populate-padded">',this.getShiftedDatesLabel(),'</td></tr><tr data-id="source-date"><td class="mass-populate-field-name" data-id="source-date-label">',this.getSourceDateLabel(this.selectedOperation),
'</td><td class="mass-populate-read-only" data-id="source-date-values"><span data-id="source-date-calendar-container"></span><span data-id="source-date-values-container">',this.getSourceDateValues(this.selectedOperation),'</span></td></tr><tr data-id="additional-fields"><td class="mass-populate-field-name" data-id="additional-fields-label">',this.getAdditionalLabel(this.selectedOperation),'</td><td data-id="additional-fields-data" class="capacity-mass-populate-padded">',this.getAdditionalValue(this.selectedOperation,
c),"</td></tr></table>"].join("")}else this.content=toa.glossary({id:11475}),this.error=toa.glossary({id:11475})},getFieldHtml:function(c){for(var b="",d=0;d<c.length;d++)b+='<input id="massPopulateField" type="hidden" name="field"  value="'+c[d].label+'" />';return b},getOperationsHtml:function(c,b){var d=this.getOperationsByFieldLabel(c,b),g="",k="checked",l="",n;for(n in d){var p=d[n];!this.isDatesDiscontinuous||"shift_forward"!=p.label&&"shift_backward"!=p.label||(l="disabled");g+='<input aria-describedby="descr__mass-populate-operation-field" type="radio" name="operation" value="'+
p.label+'" id="'+p.label+'" '+k+" "+l+" />";g+='<label id="descr__'+p.label+'" for="'+p.label+'">'+p.name+"</label><br>";l=k=""}return g},getOperationsByFieldLabel:function(c,b){for(var d=0;d<b.length;d++){var g=b[d];if(g.label==c)return g.operations}return[]},getDefaultOperationLabel:function(c,b){var d=this.getOperationsByFieldLabel(c,b),g;for(g in d)return d[g].label;return""},getShiftedDatesLabel:function(c,b){c||(c=0);b&&b.length||(b=this.dates);if(!b.length)return"";if(1==b.length){var d=toa.date.parseDate("iso",
b[0]);d.setTime(d.getTime()+c*this.msPerDay);return this.capacityDateStr(d)}var d=toa.date.parseDate("iso",b[0]),g=toa.date.parseDate("iso",b[b.length-1]);d.setTime(d.getTime()+c*this.msPerDay);g.setTime(g.getTime()+c*this.msPerDay);return this.capacityDateStr(d)+" ... "+this.capacityDateStr(g)},bindEvents:function(){var c=this;this.dialogContent.find("#massPopulateField").on("change",function(){c.dialogContent.find("#mass-populate-operation-field").empty().html(c.getOperationsHtml($(this).val(),
c.fields));c.operationSelected(c.dialogContent.find("input[name=operation]:checked").val())});this.dialogContent.find("#mass-populate-operation-field").on("click","input",function(){var b=$(this).val();c.selectedOperation!=b&&c.operationSelected(b)})},operationSelected:function(c){this.selectedOperation=c;var b=this.dialogContent;switch(c){case "copy_day_to_day":case "copy_week_to_week":b=b.find("#massPopulateField").val();this.showSourceDateField(c,!0);this.showAdditionalField(c,b);this.fillSourceDate(this.calendar.getDate());
break;case "shift_forward":case "shift_backward":this.showSourceDateField(c,!1);this.hideAdditionalField();break;case "close_work_zone":case "open_work_zone":this.hideSourceDateField();this.showAdditionalField(c);break;default:this.hideSourceDateField(),this.hideAdditionalField()}},showSourceDateField:function(c,b){this.dialogContent.find('[data-id="source-date"]').show();this.dialogContent.find('[data-id="source-date-label"]').html(this.getSourceDateLabel(c));b?(this.dialogContent.find('[data-id="source-date-calendar-container"]').show(),
this.dialogContent.find('[data-id="source-date-values-container"]').hide()):(this.dialogContent.find('[data-id="source-date-calendar-container"]').hide(),this.dialogContent.find('[data-id="source-date-values-container"]').show().html(this.getSourceDateValues(c)))},hideSourceDateField:function(){this.dialogContent.find('[data-id="source-date"]').hide()},showAdditionalField:function(c,b){this.dialogContent.find('[data-id="additional-fields"]').show();this.dialogContent.find('[data-id="additional-fields-label"]').html(this.getAdditionalLabel(c));
this.dialogContent.find('[data-id="additional-fields-data"]').html(this.getAdditionalValue(c,b))},hideAdditionalField:function(){this.dialogContent.find('[data-id="additional-fields"]').hide()},getSourceDateLabel:function(c){var b="";switch(c){case "copy_day_to_day":b=toa.glossary({id:11467});break;case "copy_week_to_week":b=toa.glossary({id:11468});break;case "shift_forward":case "shift_backward":b=toa.glossary({id:5855})}return b},getSourceDateValues:function(c){var b="";switch(c){case "shift_forward":b=
this.getShiftedDatesLabel(-1);break;case "shift_backward":b=this.getShiftedDatesLabel(1)}return b},getAdditionalLabel:function(c){return""},getAdditionalValue:function(c,b){var d="";switch(c){case "close_work_zone":case "open_work_zone":d=this.makeWorkZoneList(c)}return d},makeWorkZoneList:function(c){c=['<select aria-labelledby="descr__'+c+'" class="toa-view-control-select" data-id="work-zone-id">'];for(var b=[],d=0;d<this.workZones.length;d++){var g=this.workZones[d].id,k=this.workZones[d].name;
-1<$.inArray(g,b)||(c.push('<option value="'+hs(g)+'">'+hs(k)+"</option>"),b.push(g))}c.push("</select>");return c.join("")},createCalendar:function(){this.calendar=new toa.view.calendar.Calendar;this.calendar.setToday(toa.app.get("today"))},renderCalendar:function(){var c=this.dialogContent.find("[data-id='source-date-calendar-container']");this.calendar.renderTo(c);this.calendar.addListener("changeDate",this.onCalendarApplied.bind(this));c.find(".prev").hide();c.find(".next").hide();this.fillSourceDate(this.calendar.getDate())},
onCalendarApplied:function(c,b){this.fillSourceDate(b)},fillSourceDate:function(c){var b="";this.sourceDate="";var d=!!this.dialogContent.find("#copy_day_to_day").prop("checked"),g=!!this.dialogContent.find("#copy_week_to_week").prop("checked");d?(this.sourceDate=c,b+=this.capacityDateStr(toa.date.parseDate("iso",c))):g&&(c=this.getWeekDaysByDate(c),b+=this.capacityDateStr(c[0])+" - "+this.capacityDateStr(c[6]),this.sourceDate=toa.date.formatDate("iso",c[0]));this.dialogContent.find('[data-id="source-date-calendar-container"]').find(".date").empty().html(b)},
capacityDateStr:function(c){return toa.date.formatDate("D, M jS",c)},makePopup:function(){var c=[{text:toa.glossary({id:6413}),click:this.hide.bind(this)}];this.error||c.push({type:"submit",text:toa.glossary({id:99}),click:this.save.bind(this)});this.dialogPopup=new toa.ui.Popup({title:toa.glossary({id:5845}),modal:!0,html:this.content,onClose:this.hide.bind(this),buttons:c});this.dialogContent=$(this.dialogPopup.getDomContent())},getWeekDaysByDate:function(c){c=toa.date.parseDate("iso",c);var b=
toa.date.firstDay,b=c.getDay()-(b>c.getDay()?b-7:b);c.setTime(c.getTime()-b*this.msPerDay);for(var b=[],d=0;7>d;d++){var g=new Date;g.setTime(c.getTime()+d*this.msPerDay);b.push(g)}return b},isDiscontinuousInterval:function(c){if(2>c.length)return!1;for(var b=1;b<c.length;b++)if(new Date(c[b])-new Date(c[b-1])>this.msPerDay)return!0;return!1},setError:function(c,b){b&&(c=c.replace("{FIELD_NAME}",this.errorFieldNames[b]?"'"+this.errorFieldNames[b]+"'":""));this.dialogPopup.setErrors([{id:"someErrorWhileSaving",
message:c}])},toString:function(){return"Popup Mass populate"}});toa.mixin(d.prototype,toa.mixins.EventEmitter);return d}());READ_WRITE=2;
toa.ns("toa.views.quota.PopupAutoPopulate",function(){var d=toa.define(null,function(c){this.model=c;this.fields=this.model.getMassPopulateOptions();this.fieldTranslations={used:this.model.getFieldNameByLabel("used"),quota:this.model.getFieldNameByLabel("quota")};this.coord=null;this.errorFieldNames={source_offset:toa.glossary({id:11467}),source_count:toa.glossary({id:11473}),target_offset:toa.glossary({id:5854}),target_count:toa.glossary({id:5854}),within:toa.glossary({id:8680})};this.isReadWriteAccess=this.model.access===
READ_WRITE},{init:function(){},show:function(){this.coord&&(this.createContent(),this.makePopup(),this.operationSelected(this.selectedOperation),this.dialogPopup.show(),this.bindEvents())},hide:function(){this.dialogPopup&&this.dialogPopup.destroy();this.dialogPopup=null},setRecurrenceCheckboxValue:function(c){this.recurrenceCheckboxValue=c},save:function(){var c={field:this.field,operation:this.selectedOperation,time_slot_id:this.timeSlot,category_id:this.category,level:"category"};this.category||
(c.level="time_slot",this.timeSlot||(c.level="day"));this.dialogContent.find("input[name=recurrence-auto-populate-status]").prop("checked")?c.status="active":c.status="inactive";var b=this.dialogContent.find("select[data-id=recurrence_hour]").val(),d=this.dialogContent.find("input[data-id=recurrence_minutes]").val();if(!$.isNumeric(b)||0>b||23<b)b=0;if(!$.isNumeric(d)||0>d||59<d)d=0;c.start_time=b+":"+d;b=this.dialogContent.find("input[data-id=recurrence_within]").val();if(!$.isNumeric(b)||0>b)b=
60;c.within=b;b=this.dialogContent.find("input[data-id=recurrence_target_dates]").val();$.isNumeric(b)||(b=7);c.target_count=b;b=this.dialogContent.find("input[data-id=recurrence_target_dates_plus]").val();$.isNumeric(b)||(b=7);c.target_offset=b;b=this.dialogContent.find("select[data-id=recurrence_day]").val();d="day"==b?"daily":"weekly";c.recurrence=d;"weekly"==d&&$.isNumeric(b)&&0<=b&&7>b&&(c.day_of_week=b);c.source_field="quota"==this.field?this.dialogContent.find("select[data-id=extrapolate-source-field]").val():
this.field;switch(this.selectedOperation){case "copy_day_to_day":case "copy_week_to_week":b=this.dialogContent.find("select[data-id=source-date_plus_minus]").val();d=this.dialogContent.find("input[data-id=recurrence_source_days_plus]").val();$.isNumeric(d)||(d=1);"-"==b&&(d=-d);c.source_offset=d;break;case "percent_shift":b=this.dialogContent.find("input[data-id=recurrence_multiply]").val();$.isNumeric(b)||(b=98);c.multiply_by=b/100;break;case "extrapolate_day_to_day":case "extrapolate_week_to_week":b=
this.dialogContent.find("input[data-id=source-estimation]").val(),$.isNumeric(b)||(b=10),c.source_count=b}this.notify("saveAutoPopulate",c)},destroy:function(){this.hide();for(var c in this._events_uids)this.removeListener(parseInt(c))},setCoord:function(c){this.coord=c;this.field=this.coord.field||"";this.timeSlot=this.coord.timeSlot||0;this.category=this.coord.category||0;this.data=this.model.getAutoPopulateData(this.field,this.timeSlot,this.category);this.content="";this.dialogPopup=null;this.selectedOperation=
this.dialogContent=""},processSaveResult:function(c){c.error?this.setError(c.error,c.errorFieldName):(this.hide(),c.autoPopulateData&&this.model.setAutoPopulateData(c.autoPopulateData))},setError:function(c,b){b&&(c=c.replace("{FIELD_NAME}",this.errorFieldNames[b]?"'"+this.errorFieldNames[b]+"'":""));this.dialogPopup.setErrors([{id:"someErrorWhileSaving",message:c}])},createContent:function(){if(this.fields&&this.fields.length&&this.field){var c=this.getOperationsByFieldLabel(this.field,this.fields);
if(c&&c[0]){this.selectedOperation=this.data.operation||this.getDefaultOperationLabel(this.field,this.fields);var c=this.data.last_run?['<tr><td class="mass-populate-field-name">',toa.glossary({id:5427}),'</td><td class="mass-populate-read-only capacity-mass-populate-padded"><span data-id="last-run-container">',toa.date.formatDate("date_time",toa.date.parseDate("iso_long",this.data.last_run)),"</span></td></tr>"].join(""):"",b=this.data.next_run?['<tr><td class="mass-populate-field-name">',toa.glossary({id:5428}),
'</td><td class="mass-populate-read-only capacity-mass-populate-padded"><span data-id="last-run-container">',toa.date.formatDate("date_time",toa.date.parseDate("iso_long",this.data.next_run)),"</span></td></tr>"].join(""):"";this.content=['<form action="" name="autoPopulate"><table class="capacity-mass-populate"><tr><td class="mass-populate-field-name"><label id="lbl__mass-populate-field-name">',toa.glossary({id:99}),'</label></td><td class="capacity-mass-populate-padded">',this.getApplyHtml(),"</td></tr>",
c,b,'<tr><td class="mass-populate-field-name">','<label for="recurrence_operations_'+this.field+'">',toa.glossary({id:11474}),'</label></td><td id="mass-populate-operation-field">',this.getOperationsHtml(this.field,this.fields),'</td></tr><tr data-id="auto-populate-target-dates"><td class="mass-populate-field-name"><label id="lbl__auto-populate-target-dates">',toa.glossary({id:5854}),'</label></td><td class="capacity-mass-populate-padded" data-id="auto-populate-target-dates-value">',this.getTargetDatesHtml(this.selectedOperation,
this.data.target_count,this.data.target_offset),'</td></tr><tr data-id="auto-populate-source-date" style="display: none;"><td class="mass-populate-field-name"><label id="lbl__auto-populate-source-date">',toa.glossary({id:11467}),'</label></td><td class="capacity-mass-populate-padded" data-id="auto-populate-source-date-value">',this.getSourceDateHtml(this.selectedOperation),'</td></tr><tr data-id="auto-populate-source" style="display: none;" ><td class="mass-populate-field-name">',toa.glossary({id:11473}),
'</td><td class="mass-populate-read-only" data-id="auto-populate-source-value">',this.getSourceHtml(),'</td></tr><tr data-id="auto-populate-multiply" style="display: none;"><td class="mass-populate-field-name"><label id="lbl__auto-populate-multiply">',toa.glossary({id:11469}),'</label></td><td class="capacity-mass-populate-padded" data-id="auto-populate-multiply-value">',this.getMultiplyHtml(),'</td></tr><tr data-id="auto-populate-source-estimation" style="display: none;"><td class="mass-populate-field-name"><label id="lbl__auto-populate-source-estimation">',
toa.glossary({id:11473}),'</label></td><td class="capacity-mass-populate-padded" data-id="auto-populate-source-estimation-value">',this.getSourceEstimationHtml(this.selectedOperation),'</td></tr><tr data-id="auto-populate-status"><td class="mass-populate-field-name"><label for="auto-populate-status-input" >',toa.glossary({id:11477}),'</label></td><td data-id="auto-populate-status-value"><input type="checkbox" name="recurrence-auto-populate-status" id="auto-populate-status-input" ',!1==this.recurrenceCheckboxValue?
"":'checked="checked" '," ",this.isReadWriteAccess?"":"disabled ","></td></tr></table></form>"].join("")}else this.content=toa.glossary({id:11476}),this.error=toa.glossary({id:11476})}else this.content=toa.glossary({id:11475}),this.error=toa.glossary({id:11475})},makePopup:function(){var c=[{text:toa.glossary({id:6413}),click:this.hide.bind(this)}];!this.error&&this.isReadWriteAccess&&c.push({type:"submit",text:toa.glossary({id:12}),click:this.save.bind(this)});this.dialogPopup=new toa.ui.Popup({title:toa.glossary({id:11478}),
modal:!0,html:this.content,onClose:this.hide.bind(this),buttons:c});this.dialogContent=$(this.dialogPopup.getDomContent())},getOperationsHtml:function(c,b){var d=this.getOperationsByFieldLabel(c,b),g='<select id="recurrence_operations_'+c+'" data-id="recurrence_operations" class="toa-view-control-select" '+(this.isReadWriteAccess?"":"disabled ")+">",k;for(k in d)var l=d[k],g=g+('<option value="'+l.label+'" '+(this.data.operation==l.label?'selected="selected" ':"")+" >"+l.name+"</option>");return g+
"</select>"},getApplyHtml:function(){for(var c="",b="weekly"==this.data.recurrence?this.data.day_of_week||0:"day",d=[toa.glossary({id:11480,translations:{"{DAY_NAME}":toa.glossary({id:331})}}),toa.glossary({id:11480,translations:{"{DAY_NAME}":toa.glossary({id:332})}}),toa.glossary({id:11480,translations:{"{DAY_NAME}":toa.glossary({id:333})}}),toa.glossary({id:11480,translations:{"{DAY_NAME}":toa.glossary({id:334})}}),toa.glossary({id:11480,translations:{"{DAY_NAME}":toa.glossary({id:335})}}),toa.glossary({id:11480,
translations:{"{DAY_NAME}":toa.glossary({id:336})}}),toa.glossary({id:11480,translations:{"{DAY_NAME}":toa.glossary({id:337})}})],g='<select aria-labelledby="lbl__mass-populate-field-name" data-id="recurrence_day" class="toa-view-control-select" '+(this.isReadWriteAccess?"":"disabled ")+">",g=g+('<option value="day" '+("daily"==b?'selected="selected" ':"")+" >"+toa.glossary({id:6912})+"</option>"),k=0;k<d.length;k++)g+='<option value="'+k+'" '+(b==k?'selected="selected" ':"")+">"+d[k]+"</option>";
g+="</select>";d=this.data.start_time||"00:00:00";d=d.split(/:/);b='<select aria-labelledby="lbl__mass-populate-field-name" data-id="recurrence_hour" class="toa-view-control-select" '+(this.isReadWriteAccess?"":"disabled ")+">";for(k=0;24>k;k++)var l=this.timeToUserFormat(k+":00"),l=l.replace(":00",""),b=b+('<option value="'+k+'" '+(k==d[0]?'selected="selected" ':"")+">"+l+"</option>");b+="</select>";d='<input aria-labelledby="lbl__mass-populate-field-name" size="2" maxlength="2" data-id="recurrence_minutes" value="'+
(d[1]||"00")+'" '+(this.isReadWriteAccess?"":"disabled ")+">";k=' <input aria-labelledby="lbl__mass-populate-field-name" type="text" size="4" maxlength="5" data-id="recurrence_within" value="'+(this.data.within||60)+'" '+(this.isReadWriteAccess?"":"disabled ")+">";return c+=toa.glossary({id:17519}).replace("{DAY}",g).replace("{HOUR}",b).replace("{MINUTE}",d).replace("{WITHIN}",k)},getTargetDatesHtml:function(c,b,d){var g=18130,k="";switch(c){case "copy_day_to_day":k='<input aria-labelledby="lbl__auto-populate-target-dates" size="3" maxlength="4" data-id="recurrence_target_dates" value="'+
(b||24)+'" '+(this.isReadWriteAccess?"":"disabled ")+"> ";d=d||0===d?d:15;break;case "copy_week_to_week":b=b||4;k='<input aria-labelledby="lbl__auto-populate-target-dates" size="2" maxlength="3" data-id="recurrence_target_dates" value="'+b+'" '+(this.isReadWriteAccess?"":"disabled ")+"> ";g=18131;d=d||0===d?d:1;break;case "extrapolate_week_to_week":b=b||7;k='<input aria-labelledby="lbl__auto-populate-target-dates" size="2" maxlength="3" data-id="recurrence_target_dates" value="'+b+'" '+(this.isReadWriteAccess?
"":"disabled ")+"> ";g=18131;d=d||0===d?d:1;break;default:b=b||7,k='<input aria-labelledby="lbl__auto-populate-target-dates" size="3" maxlength="4" data-id="recurrence_target_dates" value="'+b+'" '+(this.isReadWriteAccess?"":"disabled ")+"> ",d=d||0===d?d:1}return toa.glossary({id:g,type:"htmlExceptPlaceholder",translations:{"{INPUTBOX1}":k,"{INPUTBOX2}":'<input aria-labelledby="lbl__auto-populate-target-dates" size="3" maxlength="4" class="capacity-mass-populate-input-margin" data-id="recurrence_target_dates_plus" value="'+
d+'" '+(this.isReadWriteAccess?"":"disabled ")+">"}})},getSourceDateHtml:function(c){var b=this.data.source_offset,b=b||0===b?b:1,d=0>b?"-":"+",g='<select aria-labelledby="lbl__auto-populate-source-date" class="capacity-mass-populate-input-margin" data-id="source-date_plus_minus" '+(this.isReadWriteAccess?"":"disabled ")+">",g=g+'<option value="+">+</option>'+('<option value="-" '+("-"==d?" selected ":"")+" >-</option>"),g=g+"</select>";return toa.glossary({id:"copy_day_to_day"==c?18133:18134,type:"htmlExceptPlaceholder",
translations:{"{SELECT}":g,"{INPUT}":'<input aria-labelledby="lbl__auto-populate-source-date" size="3" maxlength="4" data-id="recurrence_source_days_plus" value="'+(0>b?-b:b)+'" '+(this.isReadWriteAccess?"":"disabled ")+">"}})},getSourceHtml:function(){var c=this.data.source_field;return'<select class="toa-view-control-select" data-id="extrapolate-source-field" '+(this.isReadWriteAccess?"":"disabled ")+'><option value="quota" '+("quota"==c?'selected="selected" ':"")+"> "+this.fieldTranslations.quota+
'</option><option value="used" '+("used"==c?'selected="selected" ':"")+">"+this.fieldTranslations.used+"</option></select>"},getSourceEstimationHtml:function(c){return toa.glossary({id:"extrapolate_day_to_day"==c?18135:18136,type:"htmlExceptPlaceholder",translations:{"{INPUT}":'<input aria-labelledby="lbl__auto-populate-source-estimation" size="3" maxlength="4" data-id="source-estimation" value="'+(this.data.source_count||10)+'" '+(this.isReadWriteAccess?"":"disabled ")+"> "}})},getMultiplyHtml:function(){return toa.glossary({id:18132,
type:"htmlExceptPlaceholder",translations:{"{INPUTBOX}":'<input aria-labelledby="lbl__auto-populate-multiply" size="3" maxlength="4" data-id="recurrence_multiply" value="'+(this.data.multiply_by?100*this.data.multiply_by:98)+'" '+(this.isReadWriteAccess?"":"disabled ")+">"}})},bindEvents:function(){var c=this;this.dialogContent.find("select[data-id=recurrence_operations]").on("change",function(){c.operationSelected($(this).val())})},operationSelected:function(c){this.selectedOperation=c;this.dialogContent.find("tr[data-id=auto-populate-target-dates]").show().find("td[data-id=auto-populate-target-dates-value]").html(this.getTargetDatesHtml(this.selectedOperation,
this.data.target_count,this.data.target_offset));this.dialogContent.find("tr[data-id=auto-populate-source-date]").hide();this.dialogContent.find("tr[data-id=auto-populate-source]").hide();this.dialogContent.find("tr[data-id=auto-populate-multiply]").hide();this.dialogContent.find("tr[data-id=auto-populate-source-estimation]").hide();switch(c){case "copy_day_to_day":case "copy_week_to_week":this.dialogContent.find("tr[data-id=auto-populate-source-date]").show().find("td[data-id=auto-populate-source-date-value]").html(this.getSourceDateHtml(this.selectedOperation));
"quota"==this.field&&this.dialogContent.find("tr[data-id=auto-populate-source]").show().find("td[data-id=auto-populate-source-value]").html(this.getSourceHtml());break;case "percent_shift":this.dialogContent.find("tr[data-id=auto-populate-multiply]").show().find("td[data-id=auto-populate-multiply-value]").html(this.getMultiplyHtml());break;case "extrapolate_day_to_day":case "extrapolate_week_to_week":this.dialogContent.find("tr[data-id=auto-populate-source-estimation]").show().find("td[data-id=auto-populate-source-estimation-value]").html(this.getSourceEstimationHtml(this.selectedOperation))}},
getOperationsByFieldLabel:function(c,b){for(var d=0;d<b.length;d++){var g=b[d];if(g.label==c)return g.operations}return[]},getDefaultOperationLabel:function(c,b){var d=this.getOperationsByFieldLabel(c,b),g;for(g in d)return d[g].label;return""},timeToUserFormat:function(c){return""===c?"":toa.date.formatDate("time",toa.date.parseDate("H:i",c))},toString:function(){return"Popup Auto populate"}});toa.mixin(d.prototype,toa.mixins.EventEmitter);return d}());READ_WRITE=2;
toa.ns("toa.views.quota.PopupAutoPopulateNew",function(){var d=toa.define(null,function(c){this.model=c;this.fields=this.model.getMassPopulateOptions();this.coord=null;this.errorFieldNames={source_offset:toa.glossary({id:11467}),source_count:toa.glossary({id:11473}),target_offset:toa.glossary({id:5854}),target_count:toa.glossary({id:5854}),within:toa.glossary({id:8680})};this.validateRules={source_offset:{minVal:-1E3,maxVal:1E3},source_day_count:{minVal:1,maxVal:1E3},source_week_count:{minVal:1,maxVal:150},
target_offset:{minVal:-100,maxVal:100},target_day_count:{minVal:1,maxVal:1E3},target_week_count:{minVal:1,maxVal:150},within:{minVal:5,maxVal:65535}};this.isReadWriteAccess=this.model.access===READ_WRITE},{init:function(){},show:function(){this.coord&&(this.createContent(),this.makePopup(),this.operationSelected(this.selectedOperation),this.dialogPopup.show(),this.bindEvents())},hide:function(){this.dialogPopup&&this.dialogPopup.destroy();this.dialogPopup=null},setRecurrenceCheckboxValue:function(c){this.recurrenceCheckboxValue=
c},validateRangeParams:function(c){var b=this,d=!1;Object.keys(c).forEach(function(g){Object.keys(b.validateRules).forEach(function(k){var l="";if("source_count"==g||"target_count"==g)l=-1!==c.operation.indexOf("day")?g.split("_")[0]+"_day_count":g.split("_")[0]+"_week_count";k!=g&&k!=l||c[g]>=b.validateRules[k].minVal&&c[g]<=b.validateRules[k].maxVal||(b.setError(toa.glossary({id:11488}),g),d=!0)})});return d?!1:!0},save:function(){var c={field:this.field,operation:this.selectedOperation,category_id:this.category};
this.dialogContent.find("input[name=recurrence-auto-populate-status]").prop("checked")?c.status="active":c.status="inactive";var b=this.dialogContent.find("select[data-id=recurrence_hour]").val(),d=this.dialogContent.find("input[data-id=recurrence_minutes]").val();if(!$.isNumeric(b)||0>b||23<b)b=0;if(!$.isNumeric(d)||0>d||59<d)d=0;c.start_time=b+":"+d;b=this.dialogContent.find("input[data-id=recurrence_within]").val();if(!$.isNumeric(b)||0>b)b=60;c.within=b;b=this.dialogContent.find("input[data-id=recurrence_target_dates]").val();
$.isNumeric(b)||(b=7);c.target_count=b;b=this.dialogContent.find("input[data-id=recurrence_target_dates_plus]").val();$.isNumeric(b)||(b=7);c.target_offset=b;b=this.dialogContent.find("select[data-id=recurrence_day]").val();d="day"==b?"daily":"weekly";c.recurrence=d;"weekly"==d&&$.isNumeric(b)&&0<=b&&7>b&&(c.day_of_week=b);c.source_field="quota"==this.field?this.dialogContent.find("select[data-id=extrapolate-source-field]").val():this.field;switch(this.selectedOperation){case "copy_day_to_day":case "copy_week_to_week":b=
this.dialogContent.find("select[data-id=source-date_plus_minus]").val();d=this.dialogContent.find("input[data-id=recurrence_source_days_plus]").val();$.isNumeric(d)||(d=1);"-"==b&&(d=-d);c.source_offset=d;break;case "percent_shift":b=this.dialogContent.find("input[data-id=recurrence_multiply]").val();$.isNumeric(b)||(b=98);c.multiply_by=b/100;break;case "extrapolate_day_to_day":case "extrapolate_week_to_week":b=this.dialogContent.find("input[data-id=source-estimation]").val(),$.isNumeric(b)||(b=10),
c.source_count=b}this.validateRangeParams(c)&&this.notify("saveAutoPopulate",c)},destroy:function(){this.hide();for(var c in this._events_uids)this.removeListener(parseInt(c))},setCoord:function(c){this.coord=c;this.field=this.coord.field||"";this.category=this.coord.category||0;this.data=this.model.getAutoPopulateData(this.field,this.category);this.content="";this.dialogPopup=null;this.selectedOperation=this.dialogContent=""},processSaveResult:function(c){c.error?this.setError(c.error,c.errorFieldName):
(this.hide(),c.autoPopulateData&&this.model.setAutoPopulateData(c.autoPopulateData))},setError:function(c,b){b&&(c=c.replace("{FIELD_NAME}",this.errorFieldNames[b]?"'"+this.errorFieldNames[b]+"'":""));this.dialogPopup.setErrors([{id:"someErrorWhileSaving",message:c}])},createContent:function(){if(this.fields&&this.fields.length&&this.field){var c=this.getOperationsByFieldLabel(this.field,this.fields);if(c&&c[0]){this.selectedOperation=this.data.operation||this.getDefaultOperationLabel(this.field,
this.fields);var c=this.data.last_run?['<tr><td class="mass-populate-field-name">',toa.glossary({id:5427}),'</td><td class="mass-populate-read-only capacity-mass-populate-padded"><span data-id="last-run-container">',toa.date.formatDate("date_time",toa.date.parseDate("iso_long",this.data.last_run)),"</span></td></tr>"].join(""):"",b=this.data.next_run?['<tr><td class="mass-populate-field-name">',toa.glossary({id:5428}),'</td><td class="mass-populate-read-only capacity-mass-populate-padded"><span data-id="last-run-container">',
toa.date.formatDate("date_time",toa.date.parseDate("iso_long",this.data.next_run)),"</span></td></tr>"].join(""):"";this.content=['<form action="" name="autoPopulate"><table class="capacity-mass-populate"><tr><td class="mass-populate-field-name">',toa.glossary({id:99}),'</td><td class="capacity-mass-populate-padded">',this.getApplyHtml(),"</td></tr>",c,b,'<tr><td class="mass-populate-field-name">',toa.glossary({id:11474}),'</td><td id="mass-populate-operation-field">',this.getOperationsHtml(this.field,
this.fields),'</td></tr><tr data-id="auto-populate-target-dates"><td class="mass-populate-field-name">',toa.glossary({id:5854}),'</td><td class="capacity-mass-populate-padded" data-id="auto-populate-target-dates-value">',this.getTargetDatesHtml(this.selectedOperation,this.data.target_count,this.data.target_offset),'</td></tr><tr data-id="auto-populate-source-date" style="display: none;"><td class="mass-populate-field-name">',toa.glossary({id:11467}),'</td><td class="capacity-mass-populate-padded" data-id="auto-populate-source-date-value">',
this.getSourceDateHtml(this.selectedOperation),'</td></tr><tr data-id="auto-populate-multiply" style="display: none;"><td class="mass-populate-field-name">',toa.glossary({id:11469}),'</td><td class="capacity-mass-populate-padded" data-id="auto-populate-multiply-value">',this.getMultiplyHtml(),'</td></tr><tr data-id="auto-populate-source-estimation" style="display: none;"><td class="mass-populate-field-name">',toa.glossary({id:11473}),'</td><td class="capacity-mass-populate-padded" data-id="auto-populate-source-estimation-value">',
this.getSourceEstimationHtml(this.selectedOperation),'</td></tr><tr data-id="auto-populate-status"><td class="mass-populate-field-name"><label for="auto-populate-status-input" >',toa.glossary({id:11477}),'</label></td><td data-id="auto-populate-status-value"><input type="checkbox" name="recurrence-auto-populate-status" id="auto-populate-status-input" ',!1==this.recurrenceCheckboxValue?"":'checked="checked" '," ",this.isReadWriteAccess?"":"disabled ","></td></tr></table></form>"].join("")}else this.content=
toa.glossary({id:11476}),this.error=toa.glossary({id:11476})}else this.content=toa.glossary({id:11475}),this.error=toa.glossary({id:11475})},makePopup:function(){var c=[{text:toa.glossary({id:6413}),click:this.hide.bind(this)}];!this.error&&this.isReadWriteAccess&&c.push({type:"submit",text:toa.glossary({id:12}),click:this.save.bind(this)});this.dialogPopup=new toa.ui.Popup({title:toa.glossary({id:11478}),modal:!0,html:this.content,onClose:this.hide.bind(this),buttons:c});this.dialogContent=$(this.dialogPopup.getDomContent())},
getOperationsHtml:function(c,b){var d=this.getOperationsByFieldLabel(c,b),g='<select data-id="recurrence_operations" class="toa-view-control-select" '+(this.isReadWriteAccess?"":"disabled ")+">",k;for(k in d)var l=d[k],g=g+('<option value="'+l.label+'" '+(this.data.operation==l.label?'selected="selected" ':"")+" >"+l.name+"</option>");return g+"</select>"},getApplyHtml:function(){for(var c="",b="weekly"==this.data.recurrence?this.data.day_of_week||0:"day",d=[toa.glossary({id:11480,translations:{"{DAY_NAME}":toa.glossary({id:331})}}),
toa.glossary({id:11480,translations:{"{DAY_NAME}":toa.glossary({id:332})}}),toa.glossary({id:11480,translations:{"{DAY_NAME}":toa.glossary({id:333})}}),toa.glossary({id:11480,translations:{"{DAY_NAME}":toa.glossary({id:334})}}),toa.glossary({id:11480,translations:{"{DAY_NAME}":toa.glossary({id:335})}}),toa.glossary({id:11480,translations:{"{DAY_NAME}":toa.glossary({id:336})}}),toa.glossary({id:11480,translations:{"{DAY_NAME}":toa.glossary({id:337})}})],g='<select data-id="recurrence_day" class="toa-view-control-select" '+
(this.isReadWriteAccess?"":"disabled ")+">",g=g+('<option value="day" '+("daily"==b?'selected="selected" ':"")+" >"+toa.glossary({id:6912})+"</option>"),k=0;k<d.length;k++)g+='<option value="'+k+'" '+(b==k?'selected="selected" ':"")+">"+d[k]+"</option>";g+="</select>";d=this.data.start_time||"00:00:00";d=d.split(/:/);b='<select data-id="recurrence_hour" class="toa-view-control-select" '+(this.isReadWriteAccess?"":"disabled ")+">";for(k=0;24>k;k++)var l=this.timeToUserFormat(k+":00"),l=l.replace(":00",
""),b=b+('<option value="'+k+'" '+(k==d[0]?'selected="selected" ':"")+">"+l+"</option>");b+="</select>";d='<input size="2" maxlength="2" data-id="recurrence_minutes" value="'+(d[1]||"00")+'" '+(this.isReadWriteAccess?"":"disabled ")+">";k=' <input type="text" size="4" maxlength="5" data-id="recurrence_within" value="'+(this.data.within||60)+'" '+(this.isReadWriteAccess?"":"disabled ")+">";return c+=toa.glossary({id:17519}).replace("{DAY}",g).replace("{HOUR}",b).replace("{MINUTE}",d).replace("{WITHIN}",
k)},getTargetDatesHtml:function(c,b,d){var g=18130,k="";switch(c){case "copy_day_to_day":k='<input size="3" maxlength="4" data-id="recurrence_target_dates" value="'+(b||24)+'" '+(this.isReadWriteAccess?"":"disabled ")+"> ";d=d||0===d?d:15;break;case "copy_week_to_week":b=b||4;k='<input size="2" maxlength="3" data-id="recurrence_target_dates" value="'+b+'" '+(this.isReadWriteAccess?"":"disabled ")+"> ";g=18131;d=d||0===d?d:1;break;case "extrapolate_week_to_week":b=b||7;k='<input size="2" maxlength="3" data-id="recurrence_target_dates" value="'+
b+'" '+(this.isReadWriteAccess?"":"disabled ")+"> ";g=18131;d=d||0===d?d:1;break;default:b=b||7,k='<input size="3" maxlength="4" data-id="recurrence_target_dates" value="'+b+'" '+(this.isReadWriteAccess?"":"disabled ")+"> ",d=d||0===d?d:1}return toa.glossary({id:g,type:"htmlExceptPlaceholder",translations:{"{INPUTBOX1}":k,"{INPUTBOX2}":'<input size="3" maxlength="4" class="capacity-mass-populate-input-margin" data-id="recurrence_target_dates_plus" value="'+d+'" '+(this.isReadWriteAccess?"":"disabled ")+
">"}})},getSourceDateHtml:function(c){var b=this.data.source_offset,b=b||0===b?b:1,d=0>b?"-":"+",g='<select class="capacity-mass-populate-input-margin" data-id="source-date_plus_minus" '+(this.isReadWriteAccess?"":"disabled ")+">",g=g+'<option value="+">+</option>'+('<option value="-" '+("-"==d?" selected ":"")+" >-</option>"),g=g+"</select>";return toa.glossary({id:"copy_day_to_day"==c?18133:18134,type:"htmlExceptPlaceholder",translations:{"{SELECT}":g,"{INPUT}":'<input size="3" maxlength="4" data-id="recurrence_source_days_plus" value="'+
(0>b?-b:b)+'" '+(this.isReadWriteAccess?"":"disabled ")+">"}})},getSourceEstimationHtml:function(c){return toa.glossary({id:"extrapolate_day_to_day"==c?18135:18136,type:"htmlExceptPlaceholder",translations:{"{INPUT}":'<input size="3" maxlength="4" data-id="source-estimation" value="'+(this.data.source_count||10)+'" '+(this.isReadWriteAccess?"":"disabled ")+"> "}})},getMultiplyHtml:function(){return toa.glossary({id:18132,type:"htmlExceptPlaceholder",translations:{"{INPUTBOX}":'<input size="3" maxlength="4" data-id="recurrence_multiply" value="'+
(this.data.multiply_by?100*this.data.multiply_by:98)+'" '+(this.isReadWriteAccess?"":"disabled ")+">"}})},bindEvents:function(){var c=this;this.dialogContent.find("select[data-id=recurrence_operations]").on("change",function(){c.operationSelected($(this).val())})},operationSelected:function(c){this.selectedOperation=c;this.dialogContent.find("tr[data-id=auto-populate-target-dates]").show().find("td[data-id=auto-populate-target-dates-value]").html(this.getTargetDatesHtml(this.selectedOperation,this.data.target_count,
this.data.target_offset));this.dialogContent.find("tr[data-id=auto-populate-source-date]").hide();this.dialogContent.find("tr[data-id=auto-populate-source]").hide();this.dialogContent.find("tr[data-id=auto-populate-multiply]").hide();this.dialogContent.find("tr[data-id=auto-populate-source-estimation]").hide();switch(c){case "copy_day_to_day":case "copy_week_to_week":this.dialogContent.find("tr[data-id=auto-populate-source-date]").show().find("td[data-id=auto-populate-source-date-value]").html(this.getSourceDateHtml(this.selectedOperation));
break;case "percent_shift":this.dialogContent.find("tr[data-id=auto-populate-multiply]").show().find("td[data-id=auto-populate-multiply-value]").html(this.getMultiplyHtml());break;case "extrapolate_day_to_day":case "extrapolate_week_to_week":this.dialogContent.find("tr[data-id=auto-populate-source-estimation]").show().find("td[data-id=auto-populate-source-estimation-value]").html(this.getSourceEstimationHtml(this.selectedOperation))}},getOperationsByFieldLabel:function(c,b){for(var d=0;d<b.length;d++){var g=
b[d];if(g.label==c)return g.operations}return[]},getDefaultOperationLabel:function(c,b){var d=this.getOperationsByFieldLabel(c,b),g;for(g in d)return d[g].label;return""},timeToUserFormat:function(c){return""===c?"":toa.date.formatDate("time",toa.date.parseDate("H:i",c))},toString:function(){return"Popup Auto populate"}});toa.mixin(d.prototype,toa.mixins.EventEmitter);return d}());toa.ns("toa.views.quota.ResourceSettings",function(){return toa.define(null,function(d){if(!d||!d.form)throw'An option "form" requared for toa.views.quota.ResourceSettings';this.options=d;this.elements=null;this.init()},{init:function(){var d=this.options.form,c=d.find("[name='p[pcapacity_bucket]']");if(!c.length)return!1;c.on("click",this.onChange.bind(this));this.elements=this.getElements(d)},getElements:function(d){var c={};d.find("[name]").each(function(b,d){var g=d.getAttribute("name").replace("p[",
"").replace("]","");c[g]=c[g]?c[g].add(d):$(d)});return c},onChange:function(){if(!this.elements)return!1;var d=this.elements,c=this.options.form.find("[name='p[resource_capacity_categories]']");toa.ResourcesTree.getCurrent().isTechnician()&&1==this.options.first&&(this.options.first=0,1==c.attr("data-access")&&c.attr("data-access",0));d.pcapacity_bucket.filter("input").is(":checked")?toa.ResourcesTree.getCurrent().isTechnician()&&0==this.options.first&&c.attr("data-access",1):toa.ResourcesTree.getCurrent().isTechnician()&&
0==this.options.first&&c.attr("data-access",0)}})}());toa.ns("toa.views.quota.ViewPlannedCapacity",function(){var d=toa.define(null,function(c,b,d){this.setModel(c);this.cellValueContainer=b;this.csvLink=d;this.eventHandlers={};this.plansValuesErrors=[]},{getTemplate:function(){var c=this.cellValueContainer.dataset.date,b=this.model.resourceCapacityPlans[c],d=this.model.isReadOnly?"pchContainerReadOnly":"",g=this.cellValueContainer.dataset.maxvalue;if("undefined"===typeof b||"undefined"===typeof b[this.model.getCurrentArea().providerId]||"undefined"===
typeof b[this.model.getCurrentArea().providerId].bucketInfo[this.model.capacityType])return new toa.Template(this.csvLink);b[this.model.getCurrentArea().providerId].bucketInfo[this.model.capacityType]=g;return new toa.Template('<div class="pchContainer '+d+'">   <form onsubmit="return false;" class="pchForm">       <table class="pchTable" cellspacing="0">           <tr>               <th></th>               <th width="70">'+h(23404)+'</th>               <th class="toa-hidden" width="70">'+h(23405)+
'</th>               <th class="toa-hidden" width="70">'+h(23406)+"</th>           </tr>"+this.plannedCapacityHintRows()+'       </table>       <div class="pchMessagesContainer">           <table class="pchMessagesTable pchMessagesHidden" cellspacing="0">               <tr class="pchMessagesErrors pchMessagesHidden">                   <td><div class="pchMessagesIcon" role="icon error">&nbsp;</div></td>                   <td class="pchMessagesList" role="alert" tabindex="0"></td>               </tr>               <tr class="pchMessagesNotices pchMessagesHidden">                   <td><div class="pchMessagesIcon" role="icon note">&nbsp;</div></td>                   <td class="pchMessagesList" role="note" tabindex="0"></td>               </tr>           </table>       </div>       <div class="pchBottomMenu">          <div class="pchButtonsLeft">'+
this.csvLink+'          </div>          <div class="pchButtonsRight">             <input  type="hidden" value="'+c+'" name="plansDate"        >             <button type="button"                      onclick="return false;"                      class="toa-button toa-view-control-button toa-submit pchSavePlansBtn">'+h(23407)+"</button>          </div>       </div>   </form></div>")},plannedCapacityHintRows:function(){var c=this.model.resourceCapacityPlans[this.cellValueContainer.dataset.date],b=this.model.getCurrentArea().providerId,
d=this.plannedCapacityHintRow(c[b],b,"pchArea"),g;for(g in c)g==b||this.model.isCapacityArea(g)||(d+=this.plannedCapacityHintRow(c[g],g,"pchBucket"));return d},plannedCapacityHintRow:function(c,b,d){var g=this.model.getOrgUnitPlannedValue(c,!1),k="availableTime"===this.model.capacityType?c.bucketInfo.availableTime:c.bucketInfo.availableCount,l=" plannedVariance ",n=this.model.calcVariance(g,k),p=this.model.isReadOnly?' readonly="readonly" ':"",g=this.model.decorateValue(g),k=this.model.decorateValue(k),
s=this.model.decorateValue(n);""!==s&&(l+=0!==s?" plannedVarianceWarning ":" plannedVarianceOk ",n=0===s?"0":0<s?"+"+s:s);return'<tr>   <td class="'+d+'">       <label for="bucket_id_'+b+'" id="label_bucket_id_'+b+'">'+c.bucketInfo.name+'       </label>   </td>   <td>       <input  type="text"                value="'+g+'"                aria-labelledby="label_bucket_id_'+b+'"                name="bucket_id_'+b+'"                id="bucket_id_'+b+'"                tabindex="0" '+p+'>   </td>   <td class="pchAvailable toa-hidden"         tabindex="0">'+
k+'</td>   <td class="'+l+' toa-hidden"  tabindex="0">'+n+"</td></tr>"},setModel:function(c){this.model=c},showErrors:function(c){var b=[],d=null;$(".pchContainer .pchTable input").removeClass("errorInputElm");for(var g in c)if(c.hasOwnProperty(g)){(d=-1!==g.indexOf("bucket_id_")?$(".pchContainer input[name="+g+"]"):$(".pchContainer input[name=bucket_id_"+g+"]"))&&d.addClass("errorInputElm");for(var k in c[g])b.push(c[g][k])}if(0<b.length)return $(".pchMessagesErrors .pchMessagesList").html("<div>"+
b.join("</div><div>")+"</div>"),$(".pchMessagesTable, .pchMessagesErrors").removeClass("pchMessagesHidden"),this.resizeHint(),!0;$(".pchMessagesErrors .pchMessagesList").html("");$(".pchMessagesErrors").addClass("pchMessagesHidden");this.resizeHint();return!1},render:function(c){this.container=$(c);c=this.getTemplate().apply();this.container.html(c);this.addHandler("change",this.onChangePlannedValue.bind(this));this.setEvents();this.checkNotices(this.container)},setEvents:function(){this.container.find(".pchSavePlansBtn").on("click",
function(c){this.callHandler("save",c)}.bind(this));this.container.find(".pchTable input").on("change",function(c){this.callHandler("change",c)}.bind(this)).on("keyup",function(c){this.callHandler("change",c)}.bind(this)).on("mouseup",function(c){this.callHandler("change",c)}.bind(this))},addHandler:function(c,b){if(-1===this.getAvailableEvents().indexOf(c))return!1;this.eventHandlers[c]||(this.eventHandlers[c]=[]);this.eventHandlers[c].push(b)},getAvailableEvents:function(){return["save","change"]},
callHandler:function(c,b){if(this.eventHandlers[c]&&Array.isArray(this.eventHandlers[c]))for(var d=0;d<this.eventHandlers[c].length;d++)this.eventHandlers[c][d](b)},onChangePlannedValue:function(c){var b=$(c.target).val().trim(),d=$(c.target).closest("tr").find("td.plannedVariance"),g=$(c.target).attr("name"),k;k=[];k[g]=b;k=this.model.validatePlansValues(k);0<Object.keys(k).length?(this.plansValuesErrors[g]=k,d.text("")):delete this.plansValuesErrors[g];this.showErrors(this.plansValuesErrors);if(0<
Object.keys(k).length)return!1;c=$(c.target).closest("tr").find("td.pchAvailable").text();b=this.model.calcVariance(b,c);d.removeClass("plannedVarianceOk");d.removeClass("plannedVarianceWarning");""!==b&&0===b?d.addClass("plannedVarianceOk"):""!==b&&0!==b&&d.addClass("plannedVarianceWarning");c="";""!==b&&(c=0===b?"0":0<b?"+"+b:b);d.text(c)},setErrorMessage:function(c){$("#capacity_save_label").css("color","red").html(c)},setMessage:function(c){$("#capacity_save_label").css("color","blue").html(c)},
removeMessage:function(){$("#capacity_save_label").css("color","").empty()},checkNotices:function(c){var b=this.cellValueContainer.parentNode.parentNode.firstElementChild.textContent,d=this.cellValueContainer.dataset.date,g=this.model.resourceCapacityPlans[d],k=[],l=this.getNotice_capacityAreaFieldResources(d,b);""!==l?k.push(l):!1;l=this.getNotice_orgUnitsPlannedMore(g,b);""!==l?k.push(l):!1;l=this.getNotice_TAR(d);""!==l?k.push(l):!1;0<k.length&&+new Date(d)<+new Date(this.model.pceNoDataDate)&&
(c.find(".pchMessagesNotices .pchMessagesList").html("<div>"+k.join("</div><div>")+"</div>"),c.find(".pchMessagesTable, .pchMessagesNotices").removeClass("pchMessagesHidden"))},getNotice_capacityAreaFieldResources:function(c,b){var d="undefined"!==typeof this.model.capacityAreaFieldResources[c]?this.model.capacityAreaFieldResources[c]:0;return 0<d?r(23408,{"{AREA_NAME}":b,"{AREA_FIELD_RESOURCES_COUNT}":d}):""},getNotice_TAR:function(c){c="undefined"!==typeof this.model.tarCount[c]?this.model.tarCount[c]:
0;return 0<c?r(23409,{"{TAR_COUNT}":c}):""},getNotice_orgUnitsPlannedMore:function(c,b){var d=this.model.getTotalOrgUnitsPlannedValue(c);if(!1===d)return"";var g=this.model.getOrgUnitPlannedValue(c[this.model.getCurrentArea().providerId],!0),d=Math.round(100*(d-g))/100;return 0!=d?(d=this.model.decorateValue(d),r(23410,{"{AREA_NAME}":b,"{PLANNED_MORE_COUNT}":d})):""},destroy:function(){this.container.empty()},resizeHint:function(){$(window).trigger("resize");setTimeout(function(){$(window).trigger("resize")},
100)}});toa.mixin(d.prototype,toa.mixins.EventEmitter);return d}());toa.ns("toa.views.quota.ViewMap",function(){var d=toa.views.quota.View;return toa.define(d,function(){this.workzoneLayer=this.container=this.map=null;this.workZoneColors={0:"#ffffff",1:"#999999",2:"#696969",3:"#00b300",4:"#008000",5:"#ee9a00",6:"#ff0000"};this.init()},{_hintTemplate:new toa.Template('<div class="mobility_hint"><span><%- content %></span></div>'),init:function(){},destroy:function(){this.workzoneLayer.destroy();this.workzoneLayer=null;this.map.destroy();this.map=null;this._hintTemplate.destroy();
this._hintTemplate=null;this.refresher&&clearTimeout(this.refresher);d.prototype.destroy.apply(this,arguments)},clearRefreshTimer:function(){this.refresher&&clearTimeout(this.refresher)},render:function(c,b){this.container=$(c);var d=$('<div id="capacity_map_canvas"></div>');$("#capacity_save_container input").hide();this.removeMessage();d.width("100%").height(this.calculateHeight());this.container.html(d);this.map=new app.map.oracle.MapContainer({initOnDemand:!0,zoomLevel:5,container:d,legend:[{color:"#00b300",
text:toa.glossary({id:11494})},{color:"#008000",text:toa.glossary({id:11495})},{color:"#ee9a00",text:toa.glossary({id:11496})},{color:"#ff0000",text:toa.glossary({id:11497})},{color:"#999999",text:toa.glossary({id:11498})},{color:"#696969",text:toa.glossary({id:11499})}],scaleBar:!0});d=toa.app.model("companySettings").getMapBounds();this.map.fitDefaultBound(d);this.map.initInstance(!1);this.getZones()},getZones:function(){this.notify("getQuotaWorkzones")},_assignColors:function(c){var b={};c.forEach(function(c){b[c.WZID]=
{fill:this.getWorkZoneColor(c.STATUS)}}.bind(this));return b},drawZoneLayer:function(c,b){b?this.setError(b):(this.removeError(),$.map(c.workzones,function(b,c){return{WZID:b.WZID}}),this.workzoneLayer=new app.map.oracle.WorkzoneLayer("workzones",{joinData:this._assignColors(c.workzones),workZonesInfo:c.workzones,zoomToTheme:!0,infoWindow:!0,selectByClick:!1,selectedColor:"#ffa500"}),this.workzoneLayer.instance.on(OM.event.MouseEvent.MOUSE_DOWN,function(b){b.feature.setInfoWindowContent(this._getHint(b.feature.attributes.NAME))}.bind(this)),
this.map.addLayer(this.workzoneLayer),this.workzoneLayer.disableSelection())},calculateHeight:function(){return $("#content_content").height()-$("#footer").height()-$("#capacity_locked").height()-$("#capacity_msg").height()-$("#capacity_save_container").outerHeight()-parseInt($("#capacity_table_container").css("paddingTop"))-parseInt($("#capacity_content").css("paddingTop"))-2},getWorkZoneColor:function(c){return this.workZoneColors[c]||this.workZoneColors[1]},setError:function(c){$('[data-id="map-error-container"]').html(c)},
removeError:function(){$('[data-id="map-error-container"]').empty()},_getHint:function(c,b){return this._hintTemplate.apply({content:c,activity:b||0})}})}());(function(d,c){var b=c.toaUi.ResourceTree.prototype;c.widget("toaUi.AddAreaResourceTree",c.toaUi.ResourceTree,{areaRestrictedIds:{},setRestricted:function(b){var c=b.getId();"undefined"===typeof this.areaRestrictedIds[c]&&b.get("children")&&(this.areaRestrictedIds[c]=c)},isCanBeArea:function(b){var c=b.get("parent");if("undefined"!==typeof this.areaRestrictedIds[c]||!0===this.options.areaTreeModel.isCapacityArea(c)&&(c=this.options.areaTreeModel.getAreaByProviderId(c))&&c.type&&"area"===c.type)return this.setRestricted(b),
!1;b=b.settings.getResourceFeaturesByType(b.get("type"));return parseInt(b,10)&512?!0:!1},updateElement:function(c){b.updateElement.apply(this,arguments);this.updateItemIcon(c)},updateItemIcon:function(b){var c=b.getId(),d=this.getEl(this.elements[c],".edt-icon");d.attr("class","edt-icon res-ic");var l=!0;"field_resource"!==b.settings.getResourceRole(b.get("type"))&&(l=!1);l="pt"+(l?1:2);l=this.options.areaTreeModel.isCapacityArea(c)?l+"_32_1024_0":this.isCanBeArea(b)?l+"_32_256_0":l+"_128_256_0";
d.addClass(l)},renderLabel:function(b,c){var k=['<span class="rtl-text rtl-prov-name">',d.toHtml(c.getName()),"</span>"];this.options.searchKey&&k.push('<span class="rtl-external-id"> [',d.toHtml(c.get("EXTERNAL_ID")),"]</span>");b.html(k.join(""));0<c.get("TOTAL")?b.removeClass("edt-empty"):b.addClass("edt-empty")},clear:function(){b.clear.apply(this,arguments);this.areaRestrictedIds={}}})})(toa,$);(function(d,c){var b=d.view.ResourceTreePanel;d.ns("toa.views.quota.AddAreaResourceTreePanel",d.define(b,function(c,d){b.apply(this,arguments)},{render:function(){this.container.empty();this.content=c("<div>").addClass("toa-tree-panel add-area-tree-panel").appendTo(this.container);this.caption=d.view.control.create({xtype:"ResourceTreeCaption",addClass:"toa-panel-title",withCloseButton:!1,widthFilter:!1,listeners:{search:function(b,c){""===c.key?this.state.clearSearch():this.state.search(c.key)}.bind(this)}});
this.caption.render(this.content);this.renderTree()},renderTree:function(){this.treeWidget=c("<div/>").addClass("toa-panel-content").appendTo(this.content).AddAreaResourceTree({areaTreeModel:this.options.areaTreeModel,state:this.state,select:this.onResourceTreeSelect.bind(this),openFolder:this.onResourceTreeOpenFolder.bind(this),closeFolder:this.onResourceTreeCloseFolder.bind(this),filter:function(b,c){if(!(c.get("FLAGS")&c.ACTIVE_PROVIDER))return!1}});this.state.addListener("changed",this.rerender.bind(this));
this.state.addListener("dynamicRemoved",this.onDynamicRemoved.bind(this));this.state.addListener("provider selected",this.onProviderSelected.bind(this));this.state.addListener("provider opened",this.onProviderOpened.bind(this));this.state.addListener("provider closed",this.onProviderClosed.bind(this));this.state.addListener("provider search",this.onProviderSearch.bind(this));this.state.addListener("scroll offset updated",this.onScrollOffsetUpdated.bind(this));this.state.addListener("treeModeUpdated",
this.onTreeModeUpdated.bind(this));this.state.notify("treeModeUpdated",this.state.getTreeMode());this.treeWidget.AddAreaResourceTree("update")},onResourceTreeSelect:function(b,c){this.notify("provider.selected",c);this.state.selectProvider(c);return!1},onResourceTreeOpenFolder:function(b,c){this.state.openFolder(c)},onResourceTreeCloseFolder:function(b,c){this.state.closeFolder(c)},onDynamicRemoved:function(b,c){this.treeWidget.AddAreaResourceTree("deleteElementById",c.resourceId)},onProviderSelected:function(b,
c){this.noResourceTreeInstance()||this.treeWidget.AddAreaResourceTree("select",c)},onProviderOpened:function(b,c){this.noResourceTreeInstance()||this.treeWidget.AddAreaResourceTree("openFolder",c)},onProviderClosed:function(b,c){this.noResourceTreeInstance()||this.treeWidget.AddAreaResourceTree("closeFolder",c)},onProviderSearch:function(b,c){this.caption.setOption("searchText",c);this.noResourceTreeInstance()||this.treeWidget.AddAreaResourceTree("option","searchKey",c)},onScrollOffsetUpdated:function(b,
c){this.setScrollOffset(this.state.getScrollOffset())},onTreeModeUpdated:function(b,c){this.caption.getFilter().setMode(c)},noResourceTreeInstance:function(){return void 0===this.treeWidget.AddAreaResourceTree("instance")},rerender:function(){if(!this.noResourceTreeInstance()){var b=this.getScrollOffset();this.treeWidget.AddAreaResourceTree("clear");this.treeWidget.AddAreaResourceTree("update");this.setScrollOffset(b)}},getScrollOffset:function(){return{top:this.treeWidget.scrollTop(),left:this.treeWidget.scrollLeft()}},
setScrollOffset:function(b){this.treeWidget.scrollTop(b.top);this.treeWidget.scrollLeft(b.left)},scrollToShow:function(b){this.treeWidget.AddAreaResourceTree("scrollToShow",b)},getSearchKey:function(){return this.treeWidget.AddAreaResourceTree("option","searchKey")},getSelectedProviderId:function(){return this.state.currentlySelected}}))})(toa,$);toa.ns("toa.controlers.ViewQuota.AddAreaPopup",function(){var d=toa.define(null,function(c){this.options=c;this._init()},{options:{},areaTreeModel:null,treeState:null,treePopup:null,selectedResource:null,treeState:null,_init:function(){this.areaTreeModel=this.options.areaTreeModel;this.resizeEventId=null;this.treeState=this.options.treeState},openTreePopup:function(){this.notify("lockAddAreaButton",!0);this.popupContent=$('<div class="add-area-tree-popup-content">');this.resourceTreePanel=new toa.views.quota.AddAreaResourceTreePanel(this.popupContent,
{state:this.treeState,draggable:!1,areaTreeModel:this.options.areaTreeModel});this.resourceTreePanel.addListener("provider.selected",this.treeSelected.bind(this));this.treePopup=new toa.ui.Popup({title:h(23443),autoOpen:!0,html:this.popupContent,width:500,modal:!0,onClose:this.hidePopup.bind(this),buttons:[{text:h(22),position:"left",id:"cancelButton",click:this.hidePopup.bind(this)},{text:h(445),type:"submit",position:"right",id:"okButton",click:this.setCapacityArea.bind(this)}]});$(this.treePopup._dom.contentMarginTop).height(10);
this.treePopup.disableButton("okButton");this.resizeEventId||(this.resizeEventId=toa.app.reflowManager.addListener("resize",function(){this.resizeTreeContainer()}.bind(this)));this.resizeTreeContainer();this.treePopup.setPositionCenter()},hidePopup:function(){this.notify("lockAddAreaButton",!1);toa.app.reflowManager.removeListener(this.resizeEventId);this.resizeEventId=null;this.treePopup&&(this.treePopup.destroy(),this.treePopup=null)},resizeTreeContainer:function(){if(this.treePopup){var c=$(this.treePopup._dom.errors).is(":visible")?
205:180,c=$(window).height()-c;this.popupContent.find(".edtree").css({"max-height":c+"px"})}else toa.app.reflowManager.removeListener(this.resizeEventId),this.resizeEventId=null},setCapacityArea:function(){var c=this.selectedResource;c&&c.getId()&&(this.treePopup.disableButton("okButton"),toa.app.trigger("global.data.get",{controller:"QuotaSettings",method:"setResourceAsCapacityArea",params:{pid:c.getId()},responseHandler:this.setResourceAsCapacityAreaResponse.bind(this),errorHandler:this.setResourceAsCapacityAreaError.bind(this)}))},
setResourceAsCapacityAreaResponse:function(c,b){this.isNoPermissionResponse(b)||(b&&b.status&&"ERR"!==b.status?(this.notify("addArea",b),this.hidePopup()):this.setResourceAsCapacityAreaError(b))},setResourceAsCapacityAreaError:function(c){if(!this.isNoPermissionResponse(c)){this.treePopup.enableButton("okButton");var b=h(23144);c&&"ERR"===c.status&&c.error_code&&c.error_code.tid&&(b=h(c.error_code.tid));this.treePopup.setErrors([{id:"setCarError",message:b}])}},treeSelected:function(c,b){var d=this.treeState.get(b);
if(!d)return!1;this.selectedResource=d;this.isResourceCanBeCapacityArea(d);return!0},isResourceCanBeCapacityArea:function(c){this.treePopup.disableButton("okButton");this.clearNotify();this.treePopup.removeErrors();toa.app.trigger("global.data.get",{controller:"QuotaSettings",method:"isResourceCanBeCapacityArea",params:{pid:c.get("pid")},responseHandler:this.isResourceCanBeCapacityAreaResponse.bind(this),errorHandler:this.isResourceCanBeCapacityAreaError.bind(this)});return!1},isNoPermissionResponse:function(c){return c&&
c.operation_is_not_permited?(this.hidePopup(),!0):!1},isResourceCanBeCapacityAreaResponse:function(c,b){this.isNoPermissionResponse(b)||(b&&b.status&&"ERR"!==b.status?this.treePopup.enableButton("okButton"):this.showTreeWidgetError(b))},isResourceCanBeCapacityAreaError:function(c){this.isNoPermissionResponse(c)||this.showTreeWidgetError(c)},showTreeWidgetError:function(c){var b=h(21351),d=[23441,23442];c&&c.error_code&&c.error_code.tid&&-1!==$.inArray(parseInt(c.error_code.tid,10),d)&&(b=h(c.error_code.tid));
this.showNotify(b)},openFolder:function(c){this.resourceTreePanel.treeWidget.AddAreaResourceTree("openParents",c)},select:function(c){c?this.treeState.getAsync([c],function(){this.treeState.selectProvider(c);this.treeSelected(null,c)}.bind(this)):this.clear()},clear:function(){this.selectedResource=null},showNotify:function(c){this.resourceTreePanel.treeWidget.AddAreaResourceTree("showNotify",c)},clearNotify:function(){this.resourceTreePanel.treeWidget.AddAreaResourceTree("clearNotify")},destroy:function(){this.resizeEventId&&
(toa.app.reflowManager.removeListener(this.resizeEventId),this.resizeEventId=null)}});toa.mixin(d.prototype,toa.mixins.EventEmitter);return d}());toa.ns("toa.controllers.ViewQuota",function(){var d=["WORK_ZONE_IS_NOT_SUPPORTED"],c=toa.Controller;return toa.define(c,function(b){c.prototype._create.call(this,b);this.initModel();this.initLayout();this.initPanel();this.initPopup();this.initNewQuota();this.capCatLookup={};this.defaultIntervals={};this.currentViewState="quota";this.settingsModel=b.model("companySettings");this.availableCapacityFilter=this.oldQuotaMenuVisibility=null;this.listenerTreeResized=this.listenerTreePin=!1;this.lookups={capacityCategories:[],
timeSlots:[],timeIntervals:{availableCapacity:[],bookingStatus:[]}};this.resume(b.options,!0)},{toString:function(){return"ViewQuota"},initModel:function(){this.uom=new toa.models.QuotaUnitsOfMeasurement;this.model=new toa.models.quota.DataStorage(this.uom);this.calculator=new toa.models.quota.Calculator(this.model,this.uom);this.model.addListener("all",function(b,c){this.calculator.calculate(c.coord,c.field,c.oldValue)},this);this.model.addListener("all",this.updateSaveButton.bind(this))},updateUOM:function(){var b=
this.sandbox.model("companySettings").settings;this.uom.setUom(b.quota_uom);this.uom.setHoursInManDay(b.quota_hours_per_man_day)},initPanel:function(){this.panel=new toa.controlers.ViewQuota.Panel(this.layout);this.panel.addListener("changed",this.onPanelChanged,this);this.panel.addListener("openTree",this.onOpenTree,this);this.panel.addListener("filterChanged",this.onFilterChanged,this);this.panel.addListener("showQuotaLog",this.onShowQuotaLog.bind(this));this.panel.addListener("showQuotaNewLog",
this.onShowQuotaNewLog.bind(this));this.panel.addListener("showScheduleLog",this.onShowScheduleLog.bind(this));this.panel.addListener("showScheduleNewLog",this.onShowScheduleNewLog.bind(this));this.panel.addListener("showMassPopulate",this.onShowMassPopulate.bind(this));this.panel.addListener("showQuotaSettings",this.onShowQuotaSettings.bind(this));this.panel.addListener("doOtherAction",this.doOtherAction.bind(this))},initNewQuota:function(){this.newManageQuotaCtrl=new toa.controllers.NewViewQuota(this.sandbox,
this)},initPopup:function(){this.popup=new toa.views.quota.Popup(this.model)},initLayout:function(){this.layout=$('<div class="toa-layout-fit"></div>');this.layout.append('<div id="content_content" class="toa-panel-content"><div class="sub_content"><div id="inner_content"></div></div><div id="footer" class="footer">'+toa.toHtml(this.sandbox.model("companySettings").settings.copyright)+"</div></div>");this.content=this.layout.find("#inner_content");this.content.append('<div id="capacity_content" class="capacity_font" style="padding-left:10px; padding-right:10px; padding-top:5px;"><div id="capacity_locked">&nbsp;</div><div id="quota_settings_container">&nbsp;</div><div id="capacity_table_container">&nbsp;</div><div id="capacity_save_container"><span id="capacity_save_label">&nbsp;</span><input id="capacity_discard_button" type="button" value="'+
toa.glossary({id:6351})+'" class="toa-button"><input id="capacity_save_button" type="button" value="'+toa.glossary({id:12})+'" class="toa-button toa-button-active"></div></div><div id="capacity_msg"></div>');this.viewContainer=this.content.find("#capacity_table_container");this.quotaSettingContainer=this.content.find("#quota_settings_container");this.msgContainer=this.content.find("#capacity_save_label");this.buttonesContainer=this.content.find("#capacity_save_container");this.saveButton=this.content.find("#capacity_save_button");
this.saveButton.hide().on("click",this.saveDelta.bind(this));this.discardButton=this.content.find("#capacity_discard_button");this.discardButton.hide().on("click",this.onDiscardButtonClick.bind(this));this.mapView=this.view=null},suspend:function(b){this.viewContainer.empty();$("#tab5_content_quota").hide();this.mapView&&this.mapView.destroy();this.mapView=null;this.newManageQuotaCtrl.destroy();this.newManageQuotaCtrl=null;this.saveButton.remove();this.saveButton=null;this.discardButton.remove();
this.discardButton=null;this.buttonesContainer.empty();this.buttonesContainer=null;this.msgContainer.empty();this.msgContainer=null;this.viewContainer.empty();this.viewContainer=null;this.layout.empty();this.content.empty();this.lookups={};this.panel.destroy();this.panel=null;$(".quota-title-panel").remove();this.setResourceTreeHeight();c.prototype.suspend.call(this,b);this.mapSelected&&"undefined"!==typeof this.view.clearRefreshTimer&&this.view.clearRefreshTimer()},resume:function(b,d){d||(this.initLayout(),
this.initPopup(),this.initNewQuota(),this.initPanel(),this.refreshTree());b.content.append(this.layout);c.prototype.resume.call(this,b);this.bucketId=this.sandbox.get("pid");this.getLookups();this.getDefaultTimeIntervals();$("#tab5_content_quota").show();this.panel.attachTitle();this.renderTitle();this.setResourceTreeHeight();this.panel.refreshResourceTreeButton(4)},refreshTree:function(){toa.widgets.HangTree.getHangTree().refresh(SCREEN_MAPPINGS.quota,!1)},reloadLookups:function(){this.getLookups();
this.getDefaultTimeIntervals()},getLookups:function(){this.sandbox.trigger("global.data.get",{controller:"Quota",method:"getLookups",params:{bucket:this.bucketId,dates:[this.sandbox.get("date")]},responseHandler:this.setLookups.bind(this)})},setLookups:function(b,c){this.updateUOM();this.panel.setUom(this.uom.getUom());"undefined"!==typeof c.capacityCategories&&this.fillCapacityCategoriesLookups(c.capacityCategories);"undefined"!==typeof c.timeSlots&&this.fillTimeSlotsLookups(c.timeSlots);if("undefined"!==
typeof c.filterData){var d=c.filterData;"undefined"!==typeof d.filter.columns&&("quota"===d.view&&(d.filter.fields=this.newManageQuotaCtrl.manageQuotaFilter.getFields()),this.panel.setPreviusFiltesValues(d),this.panel.setFilter(d))}this.newManageQuotaCtrl.initQuotaCarList(!0)},fillCapacityCategoriesLookups:function(b){this.lookups.capacityCategories=[];for(var c in b)this.lookups.capacityCategories.push(b[c])},fillTimeSlotsLookups:function(b){this.lookups.timeSlots=[];var c={},d;for(d in b)"undefined"===
typeof c[b[d].text]&&(c[b[d].text]=0),c[b[d].text]+=1;for(d in b){var k=b[d];1<c[k.text]&&(k.text=k.text+" ["+k.label+"]");this.lookups.timeSlots.push(k)}},getDefaultTimeIntervals:function(){this.sandbox.trigger("global.data.get",{controller:"Quota",method:"getIntervals",params:{bucket:this.bucketId},responseHandler:this.setTimeIntervals.bind(this)})},setTimeIntervals:function(b,c){this.defaultIntervals=c.defaultIntervals},getViewStateParams:function(){var b=this.panel.options;return{bucket:this.bucketId,
get_tree:!0,dates:b.calendar.dates,view:b.view,filter:b.filterValues}},getBookingStatusDefaultFiler:function(){return{fields:[{value:1,label:this.model.FIELDS_TO_MASK.close_time},{value:1,label:this.model.FIELDS_TO_MASK.status}]}},getCapacity:function(b){"view_booking"===_DATA.page_label&&this.setViewState("quota_settings");this.newManageQuotaCtrl.updateScreenTitle();this.showHideButtons("hide");this.newManageQuotaCtrl.setSaveSectionDisplay();$("#quota_settings_container").empty();this.layout.find("#footer").show();
this.panel.setLookups(this.lookups);this.panel.setCalendarMultiDayMode();this.panel.isCalendarAvailable(this.getViewState());this.panel.setPanelToolbarActiveButton(this.getViewState());this.panel.setPanelFilterButton(this.getViewState());toa.currentInterface===INTERFACE.MOBILITY&&toa.widgets.HangTree.getHangTree().refresh(SCREEN_MAPPINGS.quota,!0);"configuration_settings"!==this.getViewState()&&this.newManageQuotaCtrl.showAddAreaButton(!1);switch(this.getViewState()){case "booking_status":this.panel.options.filterValues=
this.getBookingStatusDefaultFiler();this.sandbox.trigger("global.data.get",{controller:"Quota",method:"get",params:this.getViewStateParams(),responseHandler:this.processBookingStatus.bind(this)});break;case "available_capacity":this.newManageQuotaCtrl.showAvailableCapacity();"undefined"!==typeof b&&b&&this.sandbox.trigger("global.data.get",{controller:"Quota",method:"get",params:this.getViewStateParams(),responseHandler:this.proccessAvailableCapacity.bind(this)});break;case "quota":this.panel.options.filterValues=
this.panel.previousQuotaFilterState;this.newManageQuotaCtrl.getNewQuotaCapacity();break;case "configuration_settings":this.newManageQuotaCtrl.showConfigurationSettings();break;default:this.sandbox.trigger("global.data.get",{controller:"Quota",method:b?"index":"get",params:this.getViewStateParams(),responseHandler:this.showCapacity.bind(this)})}},proccessAvailableCapacity:function(b,c){c&&"undefined"!==typeof c.isDirectEnabled&&c.isDirectEnabled?(this.setViewState("quota_settings"),this.getCapacity()):
c&&c.filter?this.fillFilter(c):(this.availableCapacityFilter.oldQuotaMenuVisibility=c.oldQuotaMenuVisibility,this.fillFilter(this.availableCapacityFilter))},processBookingStatus:function(b,c){if(c&&"undefined"!==typeof c.isDirectEnabled&&c.isDirectEnabled)this.setViewState("quota_settings"),this.getCapacity();else{if(!c||!c.days||"booking_status"!==this.getViewState())return this.showCapacity(b,c);for(var g=[],k=c&&c.errors?c.errors:[],l=0;l<k.length;l++)if(-1===d.indexOf(k[l].errorDetail.code)){var n=
h(21351)+": "+(k[l].errorDetail.message||h(21368));g.push(n)}0<g.length?(g=g.join("<br>"),c.error=g):c.targ_el&&"capacity_save_button"===c.targ_el&&(c.saveMessage=h(21369));this.fillFilter(c);this.prepareToDraw(c)}},showCapacity:function(b,c){if(!this.isSuspended){c.capacityCategories&&(this.capCatLookup=c.capacityCategories);this.viewContainer.empty();this.clearMsg();var d=["time_slot","category","day","map"];"undefined"===typeof c.oldQuotaMenuVisibility||c.oldQuotaMenuVisibility||-1===d.indexOf(this.getViewState())?
(c.filter&&this.fillFilter(c),c.buckets&&c.buckets.length?this.prepareToDraw(c):(this.panel.setActions([]),c.error?this.showError(c.error):this.showError(toa.glossary({id:6342,type:"raw"}))),set_indicator(0)):(this.panel.options.previousView=this.panel.options.view="quota",this.oldQuotaMenuVisibility=c.oldQuotaMenuVisibility,!1!==this.panel.panel.getFilterPopup().findChild("view")&&(this.panel.panel.getFilterPopup().findChild("view").setOption("selected",this.panel.options.view),this.panel.panel.getFilterPopup().findChild("view").setOption("value",
this.panel.options.view)),this.panel.options.filterValues.view=this.panel.options.view,this.newManageQuotaCtrl.refreshFilters(),this.getCapacity())}},prepareToDraw:function(b){this.dayOffsetOptions=b.day_offset_options||[];this.visibilities=b.visibilities;this.drawView(b);this.updateSaveButton();b.saveMessage&&this.showMsg(b.saveMessage);b.error&&this.showError(b.error)},showError:function(b){this.isSuspended||(this.msgContainer.html(b).removeClass("info").addClass("error_msg"),$("#capacity_div_scrollable").length||
this.msgContainer.parent().width("50%"))},showMsg:function(b){this.isSuspended||(this.msgContainer.html(toa.toHtml(b)).removeClass("error_msg").addClass("info"),$("#capacity_div_scrollable").length||this.msgContainer.parent().width("50%"))},clearMsg:function(){this.msgContainer.empty().removeClass("error_msg").removeClass("info")},renderTitle:function(){var b=this,c=$("#tab4 .toa-panel-title").empty(),d=toa.view.control.create({xtype:"CapacityAreaTreeCaption",screenName:SCREEN_MAPPINGS.quota,widthFilter:!1,
withCloseButton:!0,hiddenAddAreaButton:!0,listeners:{search:function(c,d){b.newManageQuotaCtrl.searchInAreaTree(c,d)},close:function(){_DATA.tabs.hide(4);b.panel.showTreeButton()},addArea:function(){this.newManageQuotaCtrl.addAreaPopup.openTreePopup()}.bind(this)}});this.newManageQuotaCtrl.initAddAreaWidget(d);b.newManageQuotaCtrl.searchInAreaTree({},{key:""});d.render(c)},setResourceTreeHeight:function(){if(toa.currentInterface===INTERFACE.MOBILITY){var b=$("#content-manage-container div.quota-title-panel").outerHeight()||
0;$("#tab4.toa-panel").css("top",b+"px")}},onFilterChanged:function(b,c){this.requestFilter(c)},requestFilter:function(b){var c=this.getViewState();"quota"===c||"available_capacity"===c?this.newManageQuotaCtrl.setFilters():(b={bucket:this.bucketId,dates:this.panel.options.calendar.dates,view:this.getViewState(),filter:b},this.sandbox.trigger("global.data.get",{controller:"Quota",method:"filter",params:b,responseHandler:function(b,c){this.fillFilter(c);set_indicator(0)}.bind(this)}))},fillFilter:function(b){var c;
this.oldQuotaMenuVisibility=c=0<Object.keys(b).length?b.oldQuotaMenuVisibility:null!=this.oldQuotaMenuVisibility?this.oldQuotaMenuVisibility:!1;this.panel.setOldQuotaMenuVisibility(c);this.panel.setFilter(b)},drawView:function(b){this.updateUOM();this.model.load(b);"booking_status"!==this.getViewState()&&this.view&&this.view.destroy();!1!=this.panel.panel.getFilterPopup().findChild("view")&&this.panel.panel.getFilterPopup().findChild("view").setOption("value",this.getViewState());switch(this.getViewState()){case "day":this.view=
new toa.views.quota.ViewTableDay(this.model,this.lookups);break;case "time_slot":this.view=new toa.views.quota.ViewTableTimeSlots(this.model,this.lookups);break;case "booking_status":this.model.setCurrentArea({name:this.currentAreaName});this.model.setTimeSlotLookup(b.filter&&b.filter.timeslots_lookup?b.filter.timeslots_lookup:[]);var c=this.model.getQuotaTimeslots();if(!c||!c.length){this.viewContainer.empty();this.clearMsg();b.error=toa.glossary({id:6342,type:"raw"});return}this.view=new toa.views.quota.ViewTableBookingStatus(this.model,
this.lookups);break;default:this.view=new toa.views.quota.ViewTableCategory(this.model,this.lookups),this.panel.options.filterValues.aggregated=this.panel.isAggregatedMode()}this.view.addListener("readonlyStatusClicked",this.onViewClicked,this);this.view.addListener("statusClicked",this.onViewClicked,this);this.view.addListener("closeTimeClicked",this.onViewClicked,this);this.view.addListener("scroll",this.popup.hide,this.popup);this.view.addListener("saveAutoPopulatePopup",this.onSaveAutoPopulate,
this);this.view.setVisibleColumnsMask(this.panel.getColumnsMask());this.view.setFilterValues(this.panel.options.filterValues);this.view.setMultiBucket(!this.panel.isAggregatedMode());b.access&&2==b.access?this.view.setToReadWriteMode():this.view.setToReadOnlyMode();this.view.render(this.viewContainer);"day"===this.getViewState()&&(this.panel.isAggregatedMode()&&!0!=this.panel.isCalendarMultiDayMode?$("table.day #capacity_div_scrollable").css({"margin-left":"-60px"}):($("table.day #capacity_div_horiz_scrolled_header").css({"margin-left":"0px"}),
$("table.day td").css({"min-width":"auto"}),$("table.day table#capacity_vert_scrolled_table").css({height:"100%"}),$("table.day table#capacity_vert_scrolled_table").css({"float":"right"}),$("table.day table#capacity_vert_scroll").css({"margin-left":"0px"}),$("table.day #capacity_div_horiz_scrolled_header").css({display:"none"})));"booking_status"===this.getViewState()&&("undefined"!==typeof b.allowMap&&!0==b.allowMap?(this.mapSelected=!0,!0==this.oldQuotaMenuVisibility&&1==this.panel.getCalendar().selectedDates.length&&
(this.drawMap(),this.setMapDimensions(),this.startHangTreeSizeListening())):($("#quota_settings_container").empty(),$("#quota_settings_container").append('<div class="info not_allowed_map">'+h(18251)+"</div>")))},setMapDimensions:function(b){var c=$("#content_content").height(),d=$("#capacity_table_container").height();b=parseInt($("#content_content").width())-200;var k=parseInt(b/3),l=parseInt(c/2-80),c=c-d-80;c<l&&(c=l);c>k&&(k=c);$("#capacity_map_canvas").css({height:k+"px",width:b+"px"});$(".workzone-map-legend").css({left:parseInt(b+
10)+"px",top:"0px"})},startHangTreeSizeListening:function(){this.listenerTreePin||this.listenerTreeResized||(toa.app.bind("hang.tree.pin",this.setMapDimensions.bind(this),this),this.listenerTreePin=!0,toa.app.bind("layout.panels.resized",this.setMapDimensions.bind(this),this),this.listenerTreeResized=!0)},drawMap:function(){$("#quota_settings_container").empty();this.clearMsg();this.sandbox.trigger("global.data.get",{controller:"Mapviewer",method:"prepareWorkZoneLayer"});this.mapView=new toa.views.quota.ViewMap;
this.mapView.addListener("getQuotaWorkzones",this.onGetQuotaWorkzones,this);this.mapView.render(this.quotaSettingContainer)},processMenuConfigurationItem:function(){var b=this;this.sandbox.trigger("global.data.get",{controller:"Quota",method:"get",params:this.getViewStateParams(),responseHandler:function(c,d){b.fillFilter({oldQuotaMenuVisibility:d.oldQuotaMenuVisibility})}})},onGetQuotaWorkzones:function(b){b=this.getViewStateParams();this.sandbox.trigger("global.data.get",{controller:"Quotaworkzones",
method:"getQuotaWorkzones",get_tree:!0,params:{bucketId:this.bucketId,date:this.panel.getEarliestDateForCalendar(),timeslotId:b.filter.timeslots||0,categoryId:b.filter.categories||0},responseHandler:this.showWorkZones.bind(this)})},showWorkZones:function(b,c){this.isSuspended||(this.mapView.drawZoneLayer(c.mapContent,c.error),c.error&&this.showError(c.error),set_indicator(0))},onViewClicked:function(b,c,d){this.popup.show({type:{statusClicked:"status",readonlyStatusClicked:"readonly",closeTimeClicked:"closeTime"}[b],
target:c,coord:d,dayOffsetOptions:this.dayOffsetOptions,visibilities:this.visibilities})},onPanelChanged:function(b,c){"undefined"===typeof c.view||"undefined"===typeof c.currentViewState&&"undefined"===typeof c.view?this.setViewState(c.previousView):this.setViewState(c.view);this.getCapacity()},onDiscardButtonClick:function(b){this.getCapacity()},onOpenTree:function(){_DATA.tabs.show(4);this.panel.hideTreeButton()},updateSaveButton:function(b,c){this.clearMsg();this.model.isDeltaChanged()?(this.view.updateSaveButtonContainer(),
this.showHideButtons("show")):this.showHideButtons("hide")},showHideButtons:function(b){switch(b){case "hide":this.saveButton.hide();this.discardButton.hide();break;case "show":this.saveButton.show(),this.discardButton.show()}},saveDelta:function(){var b=this.getViewStateParams(),c={data:{buckets:this.model.getAllDelta()},close_time:this.model.getDeltaCloseTime()};b.delta=toa.utils.json.encode(c);this.showMsg(h(5515));this.sandbox.trigger("global.data.get",{controller:"Quota",method:"save",params:b,
responseHandler:this.processBookingStatus.bind(this),errorHandler:this.clearMsg.bind(this)})},onShowQuotaLog:function(){var b=this.getViewStateParams();this.sandbox.trigger("log.quota.show",{parameters:{bucketId:b.bucket,bucketName:this.currentAreaName,datesRange:b.dates,datesRangeLabel:this.panel.options.calendar.label,viewType:b.view,filters:{time_slot_id:b.filter.timeslots,category_id:b.filter.categories}},logType:"quotaHistory"})},onShowQuotaNewLog:function(){var b=this.getViewStateParams();this.sandbox.trigger("log.quotaNew.show",
{parameters:{bucketId:b.bucket,bucketName:this.currentAreaName,datesRange:b.dates,datesRangeLabel:this.panel.options.calendar.label,viewType:b.view,filters:{category_id:b.filter.categories}},logType:"quotaNewHistory"})},onShowScheduleLog:function(){var b=this.getViewStateParams();this.sandbox.trigger("log.closeSchedule.show",{parameters:{bucketId:b.bucket,bucketName:this.currentAreaName,isOldQuotaMenuVisible:this.panel.isOldQuotaMenuVisible,datesRange:b.dates,datesRangeLabel:this.panel.options.calendar.label,
viewType:b.view},logType:"closeScheduleHistory"})},onShowScheduleNewLog:function(){var b=this.getViewStateParams();this.sandbox.trigger("log.closeScheduleNew.show",{parameters:{bucketId:b.bucket,bucketName:this.currentAreaName,isOldQuotaMenuVisible:this.panel.isOldQuotaMenuVisible,datesRange:b.dates,datesRangeLabel:this.panel.options.calendar.label,viewType:b.view,filters:{time_slot_id:b.filter.timeslots,category_id:b.filter.categories}},logType:"closeScheduleNewHistory"})},isCategoryFiltered:function(b,
c){return c&&c.selectedCategory?b==c.selectedCategory:!0},isFilterApplied:function(b){return b&&b.selectedCategory?!0:!1},massPopulateTimeSlotBasedDelta:function(b,c,d,k){this.isFilterApplied(k)||this.setBookingMassPopulatedResult(d,c,b);for(var l in d){var n=d[l];this.isFilterApplied(k)||this.setBookingMassPopulatedResult(n,c,b,l);var n=n.categories,p;for(p in n)if(this.isCategoryFiltered(p,k)){var s=n[p];this.setBookingMassPopulatedResult(s,c,b,l,p);var s=s.workzones,t;for(t in s)this.setBookingMassPopulatedResult(s[t],
c,b,l,p,t)}}},massPopulateTimeIntervalBasedDelta:function(b,c,d,k){for(var l in d){var n=d[l];this.isFilterApplied(k)||this.setBookingMassPopulatedResult(n,c,b,l);var n=n.categories,p;for(p in n)if(this.isCategoryFiltered(p,k)){var s=n[p];this.setBookingMassPopulatedResult(s,c,b,l,p);var s=s.workzones,t;for(t in s)this.setBookingMassPopulatedResult(s[t],c,b,l,p,t)}}},showBookingMassPopulatedResult:function(b,c){set_indicator(0);if(c.error)this.massPopulatePopup.setError(c.error,c.errorFieldName);
else{this.massPopulatePopup.hide();var d=c.massPopulate;if(d){var k=c.bucketId,l=this.panel.options.filterValues.categories;this.view.pauseRender();this.calculator.startTransaction();switch("undefined"!==typeof d.operation?d.operation:null){case "copy_day_to_day":case "copy_week_to_week":case "shift_forward":case "shift_backward":case "open":this.model.openAll()}var n=["ti","ts-by-category","ts-by-time-slot","ts-by-day"],p=["ti","ts-by-day","ts-by-time-slot","ts-by-category"],n=d.operation&&"open"===
d.operation?p:n,s;for(s in d)for(var p=d[s],t=0,u=n.length;t<u;t++)if(k=n[t],p.hasOwnProperty(k)){var v=p[k];switch(k){case "ts-by-category":this.massPopulateTimeSlotBasedDelta(s,"ts",v.timeslots||{},{selectedCategory:l});break;case "ts-by-time-slot":this.massPopulateTimeSlotBasedDelta(s,"ts",v.timeslots||{},{selectedCategory:l});break;case "ts-by-day":this.massPopulateTimeSlotBasedDelta(s,"ts",v||{},{selectedCategory:l});break;case "ti":this.massPopulateTimeIntervalBasedDelta(s,"ti",v.intervals||
{},{selectedCategory:l})}}this.calculator.stopTransaction();this.view.isFilterByEntityApplied()||this.recalculateDependentValues(d,k);this.view.resumeRender()}}},onApplyBookingMassPopulate:function(b,c){var d=this.getViewStateParams(),k=this.model.getAllWorkzones("ts"),l=this.model.getAllWorkzones("ti");d.populateData=c;d.dayWorkZones=k&&k.length?k:l;this.sandbox.trigger("global.data.get",{controller:"Quota",method:"q2masspopulatebooking",params:d,responseHandler:this.showBookingMassPopulatedResult.bind(this)})},
onShowMassPopulateBooking:function(){var b=this.panel.getSortedCalendarDates(),c=this.model.getMassPopulateOptions(),d=[],k=this.model.maskToFieldsLabels(this.panel.getColumnsMask());-1!=$.inArray("quota",k)&&k.push("is_readonly");for(var l=0;l<c.length;l++){var n=c[l];-1!=$.inArray(n.label,k)&&d.push(n)}c={status:this.model.getFieldNameByLabel("status")};for(l=0;l<d.length;l++)n=d[l],c[n.label]=n.name;l=this.model.getAllWorkzones("ts");n=this.model.getAllWorkzones("ti");this.massPopulatePopup=new toa.views.quota.PopupMassPopulateBookingStatus({dates:b,
fields:d,fieldTranslations:c,workZones:l&&l.length?l:n});this.massPopulatePopup.show();this.massPopulatePopup.addListener("applyMassPopulate",this.onApplyBookingMassPopulate.bind(this))},onShowMassPopulate:function(){if("quota"==this.getViewState())this.newManageQuotaCtrl.onShowMassPopulate();else if("booking_status"==this.getViewState())this.onShowMassPopulateBooking();else{var b=this.model.get(new toa.models.quota.Coordinate({bucket:this.bucketId}),"ids",[]),c=this.model.getMassPopulateOptions(),
d=[],k=this.model.maskToFieldsLabels(this.panel.getColumnsMask());-1!=$.inArray("quota",k)&&k.push("is_readonly");for(var l=0;l<c.length;l++){var n=c[l];-1!=$.inArray(n.label,k)&&d.push(n)}c={used:this.model.getFieldNameByLabel("used"),quota:this.model.getFieldNameByLabel("quota")};for(l=0;l<d.length;l++)n=d[l],c[n.label]=n.name;b={dates:b,fields:d,fieldTranslations:c,workZones:this.model.getAllWorkzones(this.bucketId)};this.massPopulatePopup=new toa.views.quota.PopupMassPopulate(b);this.massPopulatePopup.show();
this.massPopulatePopup.addListener("applyMassPopulate",this.onApplyMassPopulate.bind(this))}},onShowQuotaSettings:function(b,c){this.mapSelected=null;"quota"==c&&!0==this.oldQuotaMenuVisibility&&"undefined"!==typeof this.panel.previousQuotaViewState?(this.setQuotaViewState(this.panel.previousQuotaViewState),this.setViewState(this.getQuotaViewState()),this.panel.setFilter({filter:this.panel.previousQuotaFilterState})):this.setViewState(c);this.getCapacity()},onApplyMassPopulate:function(b,c){var d=
this.getViewStateParams();d.populateData=c;this.sandbox.trigger("global.data.get",{controller:"Quota",method:"masspopulate",params:d,responseHandler:this.showMassPopulatedResult.bind(this)})},beforeBookingStatusMassPopulate:function(b){if("status"===b.massPopulateField)switch(b=b.massPopulateOperation,"undefined"!==typeof b?b:null){case "copy_day_to_day":case "copy_week_to_week":case "shift_forward":case "shift_backward":case "open":this.model.openAll()}},showMassPopulatedResult:function(b,c){set_indicator(0);
if(c.error)this.massPopulatePopup.setError(c.error,c.errorFieldName);else{this.massPopulatePopup.hide();var d=c.massPopulate;if(d){var k=c.bucketId,l=this.panel.options.filterValues.timeslots,n=this.panel.options.filterValues.categories;this.view.pauseRender();this.calculator.startTransaction();this.beforeBookingStatusMassPopulate(c);for(var p in d){var s=d[p].timeslots;this.setMassPopulatedResult(d[p],k,p);for(var t in s)if(!l||l==t){var u=s[t].categories;this.setMassPopulatedResult(s[t],k,p,t);
for(var v in u)n&&n!=v||this.setMassPopulatedResult(u[v],k,p,t,v)}}this.calculator.stopTransaction();this.view.isFilterByEntityApplied()||this.recalculateDependentValues(d,k);this.view.resumeRender()}}},setBookingMassPopulatedResult:function(b,c,d,k,l,n){c={bucket:c,day:d};k&&(c.timeSlot=k);l&&(c.category=l);n&&(c.workzone=n);c=new toa.models.quota.Coordinate(c);for(var p in b)toa.isArray(b[p])||toa.isObject(b[p])||(k=b[p],k=this.model.convertMinutesToUnits(p,k),"is_readonly"==p?this.model.setLockedStatusBit(c,
k):"quota"==p||"quota_percent"==p?this.model.isLocked(c)||this.view.isCellReadOnly(c,p)||this.model.set(c,p,k):"status_mask"!=p&&("status"==p&&(l=this.model.getOld(c,"status",null),n=b.status_mask,void 0!==n&&"ts"===c.bucket&&null!==l&&(k|=l-(l&n))),this.model.set(c,p,k)))},setMassPopulatedResult:function(b,c,d,k,l){c={bucket:c,day:d};k&&(c.timeSlot=k);l&&(c.category=l);c=new toa.models.quota.Coordinate(c);for(var n in b)if(!toa.isArray(b[n])&&!toa.isObject(b[n]))if(k=b[n],k=this.model.convertMinutesToUnits(n,
k),"is_readonly"==n)this.model.setLockedStatusBit(c,k);else if("quota"==n||"quota_percent"==n)this.model.isLocked(c)||this.view.isCellReadOnly(c,n)||this.model.set(c,n,k);else{if("status_mask"!=n){if("status"==n){l=this.model.get(c,"status",null);if(null!==l&&l&this.model.STATUS.CLOSED_ON_TOP_LEVEL)continue;d=b.status_mask;void 0!==d&&null!==l&&(k|=l-(l&d))}this.model.set(c,n,k)}}else if("workzones"==n&&(k={},l=this.model.getDayWorkzones(c),d=this.model.get(c,"status",this.model.STATUS.OPEN),!(d&
this.model.STATUS.CLOSED_ON_TOP_LEVEL))){d=0===(d&(this.model.STATUS.CLOSED|this.model.STATUS.CLOSED_ON_TOP_LEVEL));for(var p in l){var s=l[p],t=b.workzones[s.id];void 0!==t&&(t=t.status);0===t?k[s.id]=d:t&this.model.STATUS.CLOSED?k[s.id]=!1:t&this.model.STATUS.OPEN?k[s.id]=!0:(c.workzone=s.id,t=this.model.get(c,"status",0),k[s.id]=t&this.model.STATUS.CLOSED?!1:t&this.model.STATUS.CLOSED_ON_TOP_LEVEL?!1:t&this.model.STATUS.OPEN?!0:d,c.workzone=null)}this.model.setWorkzonesStatus(c,null,k)}},recalculateDependentValues:function(b,
c){var d={bucket:c},d=new toa.models.quota.Coordinate(d),k=this.panel.options.filterValues.timeslots,l=this.panel.options.filterValues.categories,n;for(n in b){d.day=n;var p=b[n],s;for(s in p)"timeslots"!=s&&this.calculator.calculateOnMassPopulate(d,s);var p=p.timeslots,t;for(t in p)if(!k||k==t){d.timeSlot=t;var u=p[t];for(s in u)"categories"!=s&&this.calculator.calculateOnMassPopulate(d,s);var u=u.categories,v;for(v in u)if(!l||l==v){d.category=v;var w=u[v];for(s in w)"workzones"!=s&&this.calculator.calculateOnMassPopulate(d,
s)}d.category=null}d.timeSlot=null}},onSaveAutoPopulate:function(b,c){var d=this.getViewStateParams();d.autoPopulateData=c;this.sandbox.trigger("global.data.get",{controller:"Quota",method:"autopopulate",params:d,responseHandler:this.processAutoPopulateResult.bind(this)})},processAutoPopulateResult:function(b,c){set_indicator(0);this.view.processAutoPopulateSaveResult(c)},doOtherAction:function(b,c){var d=this.getViewStateParams();this.sandbox.trigger("interface.actions.click",{action:c.name,aid:c.name,
pid:d.bucket,date:null})},getViewState:function(){return this.panel.options.view||null},setViewState:function(b){"quota_settings"===b&&(b="configuration_settings");this.panel.options.view=this.currentViewState=b},getQuotaViewState:function(){return this.panel.previousQuotaViewState||null},setQuotaViewState:function(b){"undefined"!==typeof this.previusFilters&&"quota"!==this.previusFilters.view&&(b=this.previusFilters.view);this.panel.previousQuotaViewState=b}})}());toa.ns("toa.controllers.NewViewQuota",function(){return toa.define(toa.Controller,function(d,c){this.mainCtrl=c;this.sandbox=d;this.init()},{quotaSettingsController:!1,toString:function(){return"NewViewQuota"},init:function(){this.providerIdsMap={};this.areaTreeModel=new toa.models.quota.AreaTreeModel;this.treeVersion=0;this.getViewState=this.mainCtrl.getViewState.bind(this.mainCtrl);this.defaultAreasRequestData={fields:["type","label","name","providerId"],expand:["parent"],status:["active"]};this.modelQuotaManage=
new toa.models.quota.DataStorageQuotaManage(this.mainCtrl.uom);this.modelQuotaManage.addListener("all",this.updateSaveSection.bind(this));this.manageQuotaFilter=new toa.controlers.ViewQuota.ViewQuotaManageFilters;this.capacityFilter=new toa.controlers.ViewQuota.ViewCapacityFilters;this.currentView=this.currentModel=null;this.manageQuotaApiConnector=new toa.controlers.ViewQuota.QuotaManageApiConnector;this.capCatLookup={};this.createTree();$("#tab5_content_quota").show();this.saveContainer=this.mainCtrl.content.find("#capacity_save_container");
this.saveContainer.append('<input id="new_capacity_discard_button" type="button" value="'+toa.glossary({id:6351})+'" class="toa-button"><input id="new_capacity_save_button" type="button" value="'+toa.glossary({id:12})+'" class="toa-button toa-button-active">');this.saveButton=this.mainCtrl.content.find("#new_capacity_save_button");this.saveButton.hide().on("click",this.saveDelta.bind(this));this.discardButton=this.mainCtrl.content.find("#new_capacity_discard_button");this.discardButton.hide().on("click",
this.onDiscardButtonClick.bind(this))},initQuotaCarList:function(d){this.showTree();this.initFlag=d;this.sandbox.trigger("global.data.get",{controller:"Quota",method:"getCapacityAreaTree",params:{fields:"name,label,type,providerId,providerTypeId",expand:"parent",status:"active"},responseHandler:this.loadCarList.bind(this),errorHandler:this.showError.bind(this)})},refreshTree:function(){this.initQuotaCarList(!1)},loadCarList:function(d,c){this.noCapacityAreas=!1;if("undefiend"===typeof c||"undefined"===
typeof c.items||0===c.items.length)this.updateTree(null),this.areaTreeModel.resetTreeData(),c&&c.items&&0===c.items.length&&(this.noCapacityAreas=!0,this.tree.ResourceTree("clear"),this.tree.ResourceTree("unselect"),this.showTree(),"configuration_settings"===this.mainCtrl.currentViewState&&(this.clearContainer(),this.quotaSettingsController=this.initQuotaSettings(this.sandbox,!1),this.quotaSettingsController.setQuotaController(this),this.quotaSettingsController.showNoBucket()));else{var b=this.areaTreeModel.getTreeUpdates(c.items||
{}),e=this.areaTreeModel.getNodesToRemove(),g=this.getAreaByPid(this.getPid());this.bucketId=g&&g.label?g.label:null;this.bucketId&&null!==this.areaTreeModel.getArea(this.bucketId)&&-1===e.indexOf(this.bucketId)||(this.bucketId=c.items[0].label||0,this.bucketName=c.items[0].name||0);this.tree.ResourceTree("select",this.bucketId);if(0<Object.keys(b).length||0<e.length){for(g=0;g<e.length;g++)"undefined"!==typeof b[e[g]]&&delete b[e[g]];this.treeVersion++;this.updateTree(b,this.bucketId,e)}this.selectArea(this.bucketId)}},
getAreaByPid:function(d){var c=this.areaTreeModel.getAreaByProviderId(d);return!c&&(d=this.getProvider(d),!1!==d&&d.getParent())?this.getAreaByPid(d.getParent()):c},getProvider:function(d){return toa.ResourcesTree.getResource(d)},getPid:function(){return this.sandbox.get("pid")},searchInAreaTree:function(d,c){var b=$("#tab5_content_quota");this.treeModel.search(c.key);b.ResourceTree("option","searchKey",c.key);var e=b.scrollTop(),g=b.scrollLeft();b.ResourceTree("clear");b.ResourceTree("update");b.ResourceTree("select",
this.bucketId);b.scrollTop(e);b.scrollLeft(g)},sendRequestForCapacity:function(d){this.mainCtrl.panel.panel.getFilterPopup().findChild("view")&&this.mainCtrl.panel.panel.getFilterPopup().findChild("view").setOption("selected",this.mainCtrl.getViewState());this.selectArea(d)},createTree:function(){var d=this,c=$("#tab4 .toa-tree-panel"),c=0<c.length?c:$(".tip_container_quota .toa-tree-panel");this.treeModel=new toa.models.quota.AreaTree;$("#tab5_content_quota").remove();d.tree=$('<div id="tab5_content_quota" class="toa-panel-content quota-car-tree" style="overflow: auto; "></div>').ResourceTree({state:this.treeModel,
select:function(b,c){d.sendRequestForCapacity(c);"configuration_settings"!==d.mainCtrl.getViewState()&&d.sendRequestForCapacity(c);d.treeModel.notify("provider.selected")},itemUpdated:this.updateTreeItem.bind(this)}).ResourceTree("select",d.bucketId).appendTo("#tab4");this.treeModel.addListener("removeTreeNode",function(b,c){this.tree.ResourceTree("deleteElementById",c.resourceId)}.bind(this));if(toa.currentInterface===INTERFACE.MOBILITY){d.tree.appendTo(c);var b=toa.widgets.HangTree.getHangTree();
this.treeModel.addListener("panel.hide",function(){_DATA.tabs.hide(4);this.mainCtrl.panel.showTreeButton()}.bind(this));this.treeModel.addListener("panel.show",function(){_DATA.tabs.show(4);this.mainCtrl.panel.hideTreeButton()}.bind(this));b.registerTree({screen:SCREEN_MAPPINGS.quota,content:c,container:$("#tab4"),tree:this.treeModel})}return!0},updateTreeItem:function(d,c){if(c&&c.item&&c.element){var b=this.areaTreeModel.getArea(c.item.getId());null!=b&&"field_resource"!==c.item.settings.getResourceRole(b.providerTypeId)&&
$(c.element[0].childNodes[0].childNodes[1]).addClass("group-icon")}},initAddAreaWidget:function(d){var c=new toa.models.ResourceTree("user main resource",{treeDate:_DATA.tree_date,structure:_DATA.p_tree,treeUpdatesFor:_DATA.tree_updates_for,version:_DATA.tree_version,structChangeTime:_DATA.struct_change_time,treeRoots:_DATA.tree_roots,treeMode:_DATA.tree_mode});c.enableAutoUpdate();c.requestUpdate();this.addAreaPopup=new toa.controlers.ViewQuota.AddAreaPopup({areaTreeModel:this.areaTreeModel,treeState:c});
this.addAreaPopup.addListener("addArea",this.addCapacityArea.bind(this));this.addAreaPopup.addListener("lockAddAreaButton",this.lockAddAreaButton.bind(this));this.addAreaButton=d.getChild("addCapacityArea")},lockAddAreaButton:function(d,c){this.addAreaButton.applyOptionDisabled("disabled",c)},addCapacityArea:function(d,c){this.sandbox.trigger("global.provider.select",{pid:c.pid});this.noCapacityAreas?this.mainCtrl.reloadLookups():this.refreshTree();return!0},isArea:function(d){return d&&d.type&&"area"===
d.type},showTree:function(){this.sandbox.trigger("layout.tabs.set",{tabs:4,show:4})},updateScreenTitle:function(){var d=this.bucketName||"";this.mainCtrl.panel.setTitle(this.mainCtrl.getViewState(),d)},selectArea:function(d){var c=this.areaTreeModel.getArea(d);this.bucketId=c?d:null;this.bucketName=c?c.name:"";this.mainCtrl.bucketId=c.providerId;this.mainCtrl.currentAreaName=this.bucketName;this.tree.ResourceTree("select",this.bucketId);this.sandbox.trigger("global.provider.select",{pid:c.providerId});
"quota"==this.mainCtrl.getViewState()&&!0==this.mainCtrl.oldQuotaMenuVisibility&&"undefined"!==typeof this.mainCtrl.panel.previousQuotaViewState?(this.mainCtrl.setQuotaViewState(this.mainCtrl.panel.previousQuotaViewState),this.mainCtrl.setViewState(this.mainCtrl.getQuotaViewState()),this.mainCtrl.panel.setPanelToolbarActiveButton(this.mainCtrl.getQuotaViewState())):(d=["time_slot","category","day","map"],"quota"==this.mainCtrl.getViewState()||-1!==d.indexOf(this.mainCtrl.getViewState())?this.mainCtrl.setQuotaViewState(this.mainCtrl.getViewState()):
(this.mainCtrl.setViewState(this.mainCtrl.getViewState()),this.mainCtrl.panel.setPanelToolbarActiveButton(this.mainCtrl.getViewState())));this.mainCtrl.getCapacity(this.initFlag);this.initFlag=!1},updateTree:function(d,c,b){null===d||"no tree"===d?(this.showError(toa.glossary({id:6308,type:"raw"})),toa.app.trigger("layout.tabs.set",{tabs:0,tabs_show:0}),this.treeModel.clear(),set_indicator(0)):(this.showTree(),d={tree_updates:d,tree_updates_for:Object.keys(d),tree_version:this.treeVersion},b&&b.length&&
0<b.length&&this.treeModel.clearInvisible(b),this.treeModel.update(d),null!==c&&(this.bucketId=c,this.bucketName=(b=this.treeModel.getResource(this.bucketId))?b.getName():"",this.mainCtrl.currentAreaName=this.bucketName),this.updateScreenTitle(),this.sandbox.trigger("system.title.setResource",{resourceName:this.bucketName}),this.tree.ResourceTree("clear"),this.tree.ResourceTree("update"),this.tree.ResourceTree("unselect"),null!==c&&this.tree.ResourceTree("select",this.bucketId))},getNewQuotaCapacity:function(d){d||
(this.setSaveSectionDisplay(),this.clearContainer());d=this.mainCtrl.panel.options.filterValues;var c=this.areaTreeModel.getArea(this.bucketId);null==c?this.showError(toa.glossary({id:23115,type:"raw"})):(d={quota:this.__getDataForNewQuota(),providerId:c.providerId,view:this.mainCtrl.getViewState(),filter:d},this.initFlag&&(d.init=this.initFlag),this.sandbox.trigger("global.data.get",{controller:"Quota",method:"getQuotaData",params:d,responseHandler:this.processQuotaResponse.bind(this),errorHandler:this.showError.bind(this)}))},
processQuotaResponse:function(d,c){c&&("undefined"!==typeof c.isDirectEnabled&&c.isDirectEnabled?(this.mainCtrl.setViewState("quota_settings"),this.mainCtrl.getCapacity()):(c.capacityCategories&&(this.capCatLookup=c.capacityCategories),c.quota&&(this.mainCtrl.oldQuotaMenuVisibility=c.oldQuotaMenuVisibility,this.showCapacity(d,c))))},__getDataForNewQuota:function(){var d={};d.dates=this.mainCtrl.panel.options.calendar.dates;var c=this.mainCtrl.panel.options.filterValues.categories||"";"undefined"!==
typeof c&&c&&(d.categories=this.convertToCsv([c]));c=this.areaTreeModel.getArea(this.bucketId);"undefined"!==typeof c&&c&&(d.areas=this.convertToCsv([c.label]),"group"==c.type&&(d.aggregateResults=!0));this.manageQuotaFilter.setSelectedFields(this.mainCtrl.panel.options.filterValues.columns||{},d.aggregateResults);c=this.manageQuotaFilter.getRequestFields();d.fields=c.concat(this.modelQuotaManage.getRequestedRequiredFields());d.fields=d.fields.filter(function(b,c,d){return d.indexOf(b)===c});return d},
convertToCsv:function(d){for(var c=[],b,e=0;e<d.length;++e)b=d[e],c.push(this.encodeCsvSpecialChars(b));return c},encodeCsvSpecialChars:function(d){return d.indexOf&&(-1<d.indexOf(",")||-1<d.indexOf('"')||-1<d.indexOf(" "))?'"'+d.replace(/"/g,'""')+'"':d},initQuotaSettings:function(d,c){return new toa.controllers.QuotaSettings(d,c)},initAvailableCapacity:function(d){"undefined"!==typeof this.capacityController&&this.capacityController&&this.capacityController.destroy();this.capacityController=new toa.controllers.ViewAvailableCapacity(d,
this.mainCtrl,this.areaTreeModel,this.capacityFilter)},clearContainer:function(){this.quotaSettingsController&&(this.quotaSettingsController.destroy(),this.quotaSettingsController=null);this.mainCtrl.viewContainer.empty();this.mainCtrl.clearMsg()},destroy:function(){this.modelQuotaManage.destroy();this.view&&this.view.destroy();this.manageQuotaFilter=null;this.capacityController&&(this.capacityController.destroy(),this.capacityController=null);this.clearContainer()},showAvailableCapacity:function(){this.setFilters();
this.initAvailableCapacity(this.sandbox)},showMap:function(){this.setFilters()},getBookingStatus:function(){this.sandbox.trigger("global.data.get",{controller:"Quota",method:"getBoockingStatus",params:this.mainCtrl.getViewStateParams(),responseHandler:this.showBookingStatus.bind(this)})},showConfigurationSettings:function(){this.clearContainer();this.sandbox.trigger("global.data.get",{controller:"Quota",method:"get",params:this.mainCtrl.getViewStateParams(),responseHandler:this.proccessConfigurationSettings.bind(this)})},
proccessConfigurationSettings:function(d,c){this.mainCtrl.oldQuotaMenuVisibility=c.oldQuotaMenuVisibility;this.mainCtrl.layout.find("#footer").hide();var b=this.areaTreeModel.getArea(this.bucketId);this.quotaSettingsController=this.initQuotaSettings(this.sandbox,this.isArea(b));this.quotaSettingsController.setQuotaController(this);this.isArea(b)?this.quotaSettingsController.getQuotaSettings():this.quotaSettingsController.showNoBucket()},showAddAreaButton:function(d){!0===d?this.addAreaButton.applyOptionHidden("hidden",
!1):this.addAreaButton.applyOptionHidden("hidden",!0)},showCapacity:function(d,c){this.clearContainer();null!==c.quota.items&&0===c.quota.items[0].areas.length?this.mainCtrl.showError(toa.glossary({id:6342,type:"raw"})):(this.currentModel=this.modelQuotaManage,this.currentView="ViewTableQuota",this.drawView(c.quota,c.settings,c.access),this.setSaveSectionDisplay(),this.setFilters(),c.filter&&c.filter.actions?this.mainCtrl.panel.setActions(c.filter.actions):this.mainCtrl.panel.setActions([]))},setFilters:function(){if("available_capacity"===
this.mainCtrl.getViewState()){var d=this.capacityFilter.getSelectedViewFilters();d.oldQuotaMenuVisibility=this.mainCtrl.oldQuotaMenuVisibility;this.mainCtrl.fillFilter(d)}else(d=this.mainCtrl.panel.options.filterValues.categories)&&0!==d.length||this.manageQuotaFilter.setCategoriesToFilter(this.modelQuotaManage.getAllCategories()),this.mainCtrl.panel.setUom(this.modelQuotaManage.settings.quota_uom),this.mainCtrl.panel.setFieldsLookup(this.extractFilterFieldsLookup()),this.mainCtrl.fillFilter(this.extractFilterSelectedFilters())},
extractFilterFieldsLookup:function(){var d=[],c;for(c in this.manageQuotaFilter.filters.fields){var b=this.manageQuotaFilter.filters.fields[c];("maxAvailableByPlans"!==b.label||this.isMaxAvailableByPlansEligible())&&d.push(b)}return d},extractFilterSelectedFilters:function(){var d=this.manageQuotaFilter.getSelectedViewFilters();d.oldQuotaMenuVisibility=this.mainCtrl.oldQuotaMenuVisibility;var c=[],b;for(b in d.filter.fields){var e=d.filter.fields[b];("maxAvailableByPlans"!==e.label||this.isMaxAvailableByPlansEligible())&&
c.push(e)}d.filter.fields=c;return d},isMaxAvailableByPlansEligible:function(){if("undefined"!==this.modelQuotaManage.settings.oldQuotaMenuVisibility&&!0===this.modelQuotaManage.settings.oldQuotaMenuVisibility)return!1;var d=["DAY_QUOTA_IS_CALCULATED_BASED_PLANS","DAY_QUOTA_IS_CALCULATED_BASED_PLANS_AFTER_NEXT_N_DAYS"];return this.modelQuotaManage.settings.hasOwnProperty("quota_settings")&&-1!==d.indexOf(this.modelQuotaManage.settings.quota_settings.day_settings.DAY_QUOTA_FLAG_DEFINED)?!0:!1},refreshFilters:function(){var d=
this.manageQuotaFilter.getViewFilterData();d.oldQuotaMenuVisibility=this.mainCtrl.oldQuotaMenuVisibility;if("configuration_settings"==this.mainCtrl.panel.options.view||"map"==this.mainCtrl.panel.options.view)d=[];this.mainCtrl.panel.refreshFilters(d)},onShowMassPopulate:function(){for(var d=this.mainCtrl.panel.getSortedCalendarDates(),c=this.currentModel.getMassPopulateOptions(),b=[],e=0;e<c.length;e++){var g=c[e];"status"!=g.label&&(g.name=this.currentModel.getFieldName(g.label),"quota"==g.label&&
(g.name=this.currentModel.getFieldName("quota")+"; "+this.currentModel.getFieldName("quotaPercent")+"; "+this.currentModel.getFieldName("quotaPercentDay")+"; "+this.currentModel.getFieldName("minQuota")),b.push(g))}c={quota:this.currentModel.getFieldName("quota")};for(e=0;e<b.length;e++)g=b[e],"status"!=g.label&&(c[g.label]=this.currentModel.getFieldName(g.label));this.massPopulatePopup=new toa.views.quota.PopupMassPopulateQuota({dates:d,fields:b,fieldTranslations:c});this.massPopulatePopup.show();
this.massPopulatePopup.addListener("applyMassPopulate",this.onApplyMassPopulate.bind(this))},onApplyMassPopulate:function(d,c){var b=this.mainCtrl.getViewStateParams();b.populateData=c;this.sandbox.trigger("global.data.get",{controller:"Quota",method:"q2masspopulate",params:b,responseHandler:this.showMassPopulatedResult.bind(this)})},showMassPopulatedResult:function(d,c){set_indicator(0);if(c.error)this.massPopulatePopup.setError(c.error,c.errorFieldName);else{this.massPopulatePopup.hide();var b=
c.massPopulate;if(b&&0!=$("#capacity_table_scrollable").find(".readwriteCell").length){var e=c.bucketId;this.capacityCategory=c.capacityCategory;for(var g in b)this.setMassPopulatedResult(b[g],e,g)}}},setMassPopulatedResult:function(d,c,b){for(var e=this.currentModel.data,g=0;g<e.length;g++)e[g].date==b&&this.setMassPopulatedAreas(e[g].areas,d,c,b)},setMassPopulatedAreas:function(d,c,b,e){var g=this;for(b=0;b<d.length;b++){var k=d[b];Object.keys(c).forEach(function(b){var d=k.getId()+"__"+b;"categories"===
b?g.setMassPopulatedCategories(k.categories,c[b]):0!=$("#"+d).length&&g.currentModel.set(d,c[b],b,b)})}},setMassPopulatedCategories:function(d,c){for(var b,e=this.mainCtrl.panel.options.filterValues.categories,g=0;g<d.length;g++)for(b in c)if(d[g].label==this.capacityCategory[b].label&&(!e||e==this.capacityCategory[b].label)){var k=c[b],l;for(l in k){var n=d[g].__namespace+"__"+l;0!=$("#"+n).length&&this.currentModel.set(n,k[l],l,l)}}},showError:function(d){if(!this.mainCtrl.isSuspended){var c;try{c=
JSON.parse(d.responseText).detail}catch(b){c="undefined"!==typeof d.responseText?d.responseText:d}if("undefined"!==typeof d.status&&503==d.status)return toa.ui.Alert({text:h(20556)}),!1;var e="",e=0===d.status?"":"undefined"!==typeof d.status?toa.toHtml("Error: Status:"+d.status+" "+d.statusText+" Detail: "+c):c;""!=e&&this.clearContainer();this.mainCtrl.msgContainer.html(e).removeClass("info").addClass("error_msg");$("#capacity_div_scrollable").length||this.mainCtrl.msgContainer.parent().width("50%")}},
getViewFilterData:function(d,c){return this.manageQuotaFilter.getViewFilterData()},drawView:function(d,c,b){this.view&&"undefined"!==typeof this.view.destroy&&this.view.destroy();var e=this.areaTreeModel.getArea(this.bucketId);this.currentModel.setCurrentArea(e);d.access=b;c&&this.currentModel.setSettings(c);this.currentModel.load(d,this.manageQuotaFilter.getSelectedFields(),c);this.currentModel.setCategoriesLookup(this.capCatLookup);this.view=new toa.views.quota[this.currentView](this.currentModel,
this.mainCtrl.lookups);this.view.addListener("saveAutoPopulatePopup",this.onSaveAutoPopulate,this);this.setViewAccess(b);this.view.render(this.mainCtrl.viewContainer)},onSaveAutoPopulate:function(d,c){var b=this.mainCtrl.getViewStateParams();b.autoPopulateData=c;this.sandbox.trigger("global.data.get",{controller:"Quota",method:"q2autopopulate",params:b,responseHandler:this.processAutoPopulateResult.bind(this)})},processAutoPopulateResult:function(d,c){set_indicator(0);this.view.processAutoPopulateSaveResult(c)},
setViewAccess:function(d){d&&2==d?this.view.setToReadWriteMode():this.view.setToReadOnlyMode()},updateSaveSection:function(d,c){this.mainCtrl.clearMsg();this.currentModel.isDeltaChanged()?(this.view.updateSaveButtonContainer(),this.setSaveSectionDisplay(!0)):this.setSaveSectionDisplay()},setSaveSectionDisplay:function(d){!0===d?(this.saveButton.show(),this.discardButton.show()):(this.saveButton.hide(),this.discardButton.hide())},saveDelta:function(){var d=this.mainCtrl.getViewStateParams(),c={data:{items:this.currentModel.getDelta(),
action:"setNewQuota"}};d.delta=toa.utils.json.encode(c);this.sandbox.trigger("global.data.get",{controller:"Quota",method:"save",params:d,responseHandler:this.responseProcess.bind(this),errorHandler:this.showError.bind(this)})},responseProcess:function(d,c){c&&this.getNewQuotaCapacity(this.processErrors(d,c))},processErrors:function(d,c){if(c){for(var b=[],e=c.results&&c.results.errors?c.results.errors:[],g=0;g<e.length;g++)if(e[g].operation){var k="",l;for(l in e[g].operation)e[g].operation.hasOwnProperty(l)&&
(k+=l+": "+e[g].operation[l]+"; ");k+=h(21351)+": "+this.manageQuotaFilter.getErrorMesageByCode(e[g].errorDetail.code);b.push(k)}0<b.length?(b=b.join("<br>"),this.mainCtrl.showError(b)):(b=h(21369),this.mainCtrl.showMsg(b));return b}},onDiscardButtonClick:function(){this.getNewQuotaCapacity()}})}());(function(d){d.ns("toa.controllers.ViewAvailableCapacity",d.define(d.Controller,function(c,b,e,g){this.sandbox=c;this.mainCtrl=b;this.bucketId=this.sandbox.get("pid");this.areaTreeModel=e;this.area=this.areaTreeModel.getAreaByProviderId(this.bucketId);this.filter=g;this.plansModel=new d.models.quota.PlannedCapacity(this.areaTreeModel);this.resume()},{toString:function(){return"ViewAvailableCapacity screen controller"},resume:function(){this.model=new d.models.quota.DataStorageCapacity;this.model.setSettings(this.sandbox.model("companySettings").settings);
this.setFilters();this.filter.setSelectedFields({maxAvailable:1});var c=$.isEmptyObject(this.filter.getSelectedFields())?!1:!0;this.model.setCategoriesLookup(this.getCapacityCategoriesLookup());this.model.setFilter(c);this.model.setIntervals(this.mainCtrl.defaultIntervals.available);this.model.setCurrentArea(this.area);this.plansModel.setCurrentArea(this.area);this.plansModel.setSettings(this.sandbox.model("companySettings").settings);this.getResourceCapacityPlans()},getCapacityCategoriesLookup:function(){$.isEmptyObject(this.mainCtrl.newManageQuotaCtrl.capCatLookup)&&
$.each(this.mainCtrl.lookups.capacityCategories,function(c,b){this.mainCtrl.newManageQuotaCtrl.capCatLookup[b.label]=$.extend({},b);delete this.mainCtrl.newManageQuotaCtrl.capCatLookup[b.label].id}.bind(this));return this.mainCtrl.newManageQuotaCtrl.capCatLookup},setFilters:function(){var c=this.filter.getSelectedViewFilters();this.mainCtrl.availableCapacityFilter=c;c.oldQuotaMenuVisibility=this.mainCtrl.oldQuotaMenuVisibility;this.mainCtrl.fillFilter(c)},convertToCsv:function(c){for(var b=[],d,g=
0;g<c.length;++g)d=c[g],!d.indexOf||-1===d.indexOf(",")&&-1===d.indexOf('"')||(d='"'+d.replace(/"/g,'""')+'"'),b.push(d);return b},__getRequestData:function(){var c={};c.dates=this.mainCtrl.panel.options.calendar.dates;"undefined"!==typeof this.area&&this.area&&(c.areas=this.convertToCsv([this.area.label]),"group"===this.area.type&&(c.aggregateResults=!0));var b=this.filter.getRequestFields();c.fields=b.concat(this.model.getRequestFields());c.fields=c.fields.filter(function(b,c,d){return d.indexOf(b)===
c});c.calendarTimeIntervals=this.model.getTimeIntervalString();c.availableTimeIntervals=this.model.getTimeIntervalString();return c},getAvailableCapacity:function(){var c=this.mainCtrl.panel.options.filterValues||{},c={available_capacity:this.__getRequestData(),view:this.mainCtrl.getViewState(),providerId:this.bucketId,filter:c};this.sandbox.trigger("global.data.get",{controller:"Quota",method:"getAvailableCapacity",params:c,responseHandler:this.drawView.bind(this),errorHandler:this.showError.bind(this)})},
getResourceCapacityPlans:function(){if("area"!==this.area.type)this.getAvailableCapacity();else{var c={};c.dates=this.mainCtrl.panel.options.calendar.dates;c.bucketId=this.sandbox.get("pid");c.data=this.__getRequestData();this.sandbox.trigger("global.data.get",{controller:"Quota",method:"getResourceCapacityPlans",params:c,responseHandler:function(b,c){this.plansModel.setAccess(c.access);this.plansModel.setResourceCapacityPlans(c.resourceCapacityPlans);this.plansModel.setPceNoDataDate(c.pceNoDataDate);
this.plansModel.setCapacityAreaFieldResources(c.capacityAreaFieldResources);this.plansModel.setTarCount(c.tarCount);this.getAvailableCapacity()}.bind(this),errorHandler:this.showError.bind(this)})}},drawView:function(c,b){this.mainCtrl.viewContainer.empty();this.mainCtrl.clearMsg();this.mainCtrl.panel.setActions([]);this.view&&"undefined"!==typeof this.view.destroy&&this.view.destroy();b&&"undefined"!==typeof b.isDirectEnabled&&b.isDirectEnabled?(this.mainCtrl.setViewState("quota_settings"),this.mainCtrl.getCapacity()):
(this.model.load(b),this.model.setSettings(this.sandbox.model("companySettings").settings),this.model.setAreaSettings(b.area_settings),this.view=new d.views.quota.ViewTableAvailableCapacity(this.model,this.mainCtrl.lookups),this.view.setPlannsModel(this.plansModel),this.view.render(this.mainCtrl.viewContainer),$(".csv_resource, .planned_capacity_count_hint").on("click",this.openTipCsvResources.bind(this)),$(".csv_activity, .planned_capacity_hours_hint").on("click",this.openTipCsvActivities.bind(this)))},
getCellValueContainer:function(c){$(c).is(".planned_capacity_count_hint, .csv_resource, .planned_capacity_hours_hint, .csv_activity")||(c=$(c).parents(".planned_capacity_count_hint, .csv_resource, .planned_capacity_hours_hint, .csv_activity")[0]);return c},openTipCsvResources:function(c){this.clearContainerHint();var b="",e="",g=this.getCellValueContainer(c.target),b='<a href="javascript:void(0);" class="csv_resource_link toa-hidden">'+h(18110)+"</a>";this.containerHint=$("<div></div>");$(g).hasClass("planned_capacity_count_hint")?
(this.plansModel.setCapacityTypeAsCount(),this.viewPlansPopup=new d.views.quota.ViewPlannedCapacity(this.plansModel,g,b),this.viewPlansPopup.addHandler("save",this.plannedCapacitySavePlansValues.bind(this,c.target)),this.viewPlansPopup.render(this.containerHint),e="pchTipContainer"):this.containerHint=$("<div></div>").html(b);this.containerHint.Tip({className:e,closable:!1,callout:{side:"top",position:"center"},windowMarginHorizontal:60,windowMarginVertical:20});this.containerHint.Tip("showAt",g,
"bottom");$("#capacity_div_scrollable").scroll(function(){this.containerHint.Tip("isOpen")&&this.containerHint.Tip("hide")}.bind(this));if("undefined"===typeof g.dataset.date||+new Date(g.dataset.date)<+new Date(this.plansModel.pceNoDataDate))$(".pchTable th, .pchTable td").removeClass("toa-hidden"),("undefined"===typeof g.dataset.maxvalue||0<parseInt(g.dataset.maxvalue))&&$(".csv_resource_link").removeClass("toa-hidden");$(this.containerHint).find(".csv_resource_link").on("click",this.downloadCsvResources.bind(this,
c.target));$(this.containerHint).find(".pchTable td.pchArea + td input").focus()},plannedCapacitySavePlansValues:function(c){var b={},d=$(this.viewPlansPopup.container).find("form.pchForm")[0],g=this.getCellValueContainer(c),k=$(d).find(".pchTable tr").eq(1).find("td.plannedVariance").text(),l=$(d).find("button.pchSavePlansBtn"),n=this;c=null;$(d.elements).each(function(){var c=$(this).attr("name");"undefined"!==typeof c&&-1!=c.indexOf("bucket_id_")&&(b[c]=this.value.trim())});if(this.viewPlansPopup.showErrors(this.plansModel.validatePlansValues(b)))return!1;
c="availableTime"===this.plansModel.capacityType?"man_hours":"scheduled";l.prop("disabled",!0);n=this;this.sandbox.trigger("global.data.get",{controller:"Quota",method:"savePlansValues",params:{plansValues:n.plansModel.convertPlannedValueForDb(b),bucketId:this.bucketId,plansUnitMeasure:c,dates:[d.plansDate.value]},responseHandler:function(b,c){l.prop("disabled",!1);if(c&&c.errors)return this.viewPlansPopup.showErrors(c.errors),!1;var d=$(g).find(".capacityPlannedVariance");d.text(k);d.removeClass("capacityPlannedVarianceWarning");
d.removeClass("capacityPlannedVarianceOk");d.addClass("capacityPlannedVarianceHidden");""!==k?(d.removeClass("capacityPlannedVarianceHidden"),$(g).removeClass("center_value"),"0"===k?(d.addClass("capacityPlannedVarianceOk"),d.html("&nbsp;")):"0"!==k&&d.addClass("capacityPlannedVarianceWarning")):$(g).addClass("center_value");this.clearContainerHint();d=Object.keys(c.resourceCapacityPlans)[0];this.plansModel.setResourceCapacityPlansOnDate(d,c.resourceCapacityPlans[d]);n.view.gridResize()}.bind(this),
errorHandler:this.showError.bind(this)});return!1},clearContainerHint:function(){this.containerHint&&"function"===typeof this.containerHint.remove&&this.containerHint.remove()},selectedRowDate:function(c){c=c.id.split("__");return"object"===typeof c&&"undefined"!==typeof c[1]?c[1]:""},downloadCsvResources:function(c){c=c.parentNode.parentNode;var b;b=c.firstElementChild.hasAttribute("id")?c.firstElementChild:c.parentNode.firstElementChild;c={bucketId:this.bucketId,categoryId:b.id,categoryName:b.textContent,
data:this.__getRequestData(),currentDate:this.selectedRowDate(c)};b=$.param(c);exportRequest({params:b,controller:"Quota",method:"getCsvResources"},c)},openTipCsvActivities:function(c){this.clearContainerHint();var b="",e="",g=this.getCellValueContainer(c.target);this.containerHint=$("<div></div>");$(g).hasClass("csv_activity")&&(b='<a href="javascript:void(0);" class="csv_activity_link toa-hidden">'+h(18109)+"</a>");$(g).hasClass("planned_capacity_hours_hint")?(this.plansModel.setCapacityTypeAsTime(),
this.viewPlansPopup=new d.views.quota.ViewPlannedCapacity(this.plansModel,g,b),this.viewPlansPopup.addHandler("save",this.plannedCapacitySavePlansValues.bind(this,c.target)),this.viewPlansPopup.render(this.containerHint),e="pchTipContainer"):this.containerHint=$("<div></div>").html(b);this.containerHint.Tip({className:e,closable:!1,callout:{side:"top",position:"center"},windowMarginHorizontal:60,windowMarginVertical:20});this.containerHint.Tip("showAt",g,"bottom");$("#capacity_div_scrollable").scroll(function(){this.containerHint&&
this.containerHint.Tip("isOpen")&&this.containerHint.Tip("hide")});if("undefined"===typeof g.dataset.date||+new Date(g.dataset.date)<+new Date(this.plansModel.pceNoDataDate))$(".pchTable th, .pchTable td").removeClass("toa-hidden"),$(".csv_activity_link").removeClass("toa-hidden");$(this.containerHint).find(".csv_activity_link").on("click",this.downloadCsvActivities.bind(this,c.target));$(this.containerHint).find(".pchTable td.pchArea + td input").focus()},downloadCsvActivities:function(c){c=$(c).closest("tr").children()[0];
c={bucketId:this.bucketId,categoryId:c.id,categoryName:c.textContent,data:this.__getRequestData()};var b=$.param(c);exportRequest({params:b,controller:"Quota",method:"getCsvActivities"},c)},showError:function(c){if(!this.mainCtrl.isSuspended){var b;try{b=JSON.parse(c.responseText).detail}catch(e){b=c.responseText}var g="",g=0===c.status?"":"undefined"!==typeof c.status?d.toHtml("Error: Status:"+c.status+" "+c.statusText+" Detail: "+b):b;""!=g&&(this.mainCtrl.viewContainer.empty(),this.mainCtrl.clearMsg());
this.mainCtrl.msgContainer.html(g).removeClass("info").addClass("error_msg");$("#capacity_div_scrollable").length||this.mainCtrl.msgContainer.parent().width("50%")}}}))})(toa);toa.ns("toa.controlers.ViewQuota.Panel",function(){var d=toa.define(null,function(c){this.screenNames={configuration_settings:h(18044),available_capacity:h(18043),quota:h(18045),day:h(18039),time_slot:h(18040),category:h(18041),map:h(8055),booking_status:h(18042)};this.fieldsLookup={};this.options={filterValues:{categories:"",timeslots:"",columns:null,aggregated:1},calendar:{mode:"day",dates:[toa.app.get("today")]},filter:{categories:[],timeslots:[],fields:[]},defaults:{aggregated:1,fields:12952},
view:"quota",previousView:"quota"};this.isOldQuotaMenuVisible=null;this.currentFilterValues={};this.userChangedColumns=null;this.lookups={};this.listItems=[];this.previousQuotaViewState="quota";this.previousQuotaFilterState={};this.isCalendarMultiDayMode=!1;this._panelTitleTarget=this.getPanelTitleTarget(c);this.initPanel(this._panelTitleTarget);this.options.calendar.label=this.panel.findChild("calendar").getLabel();this.setPanelToolbarActiveButton("quota")},{toString:function(){return"Panel title with filters"},
getPanelTitleTarget:function(c){_DATA.is_mobility_app&&($("#content-manage-container").append('<div class="quota-title-panel"></div>'),c=$(".quota-title-panel"));return c},attachTitle:function(){if(_DATA.is_mobility_app){var c=$("#content-manage-container");this._panelTitleTarget.appendTo(c)}},detachTitle:function(){_DATA.is_mobility_app&&this._panelTitleTarget.detach()},destroy:function(){for(var c in this._events_uids)this.removeListener(parseInt(c));this.lookups=null;this.panel.destroy();this.panel=
null},initPanel:function(c){this.panel=toa.view.control.create({xtype:"PanelTitle",addClass:"toa-panel-title toa-panel-title-quota",titleText:h(5514),screenName:SCREEN_MAPPINGS.quota,headerResponsive:_DATA.is_mobility_app?_DATA.page_label:"",calendar:!0,backButton:!1,resourceTreeButton:!1,filterDesc:this.getFilter(),actions:[],listeners:{actionClick:this.onActionClick.bind(this),filterApply:this.onFilterApply.bind(this),changeDates:this.onChangeDates.bind(this),selectMode:this.onSelectMode.bind(this),
openTree:this.onOpenTree.bind(this)}});this.panel.getChild("actionPanel").getOption("cell").addClass="";this.setCalendarMultiDayMode();this.panel.render(c);this.panel.replaceChild("viewsPanel",{xtype:"panel.Toolbar",id:"quota_toolbar",layoutCellWidth:1,name:"viewsPanel",addClass:"toa-layout-left-separator"+("view_quota"==_DATA.page_label?"":" toa-hidden"),items:[{xtype:"button.Icon",name:"booking_status",id:"booking_status",icon:"icon-booking_status",iconText:h(18042),addClass:"quota-buttons",attr:{title:h(18042),
alt:h(18042),"aria-label":h(18042)+"_18042"},pressed:!1},{xtype:"button.Icon",name:"quota",id:"quota",icon:"icon-quota",iconText:h(18045),addClass:"quota-buttons",attr:{title:h(18045),alt:h(18045),"aria-label":h(18045)+"_18045"},pressed:!1},{xtype:"button.Icon",name:"available_capacity",id:"available_capacity",icon:"icon-available_capacity",iconText:h(18043),addClass:"quota-buttons",attr:{title:h(18043),alt:h(18043),"aria-label":h(18043)+"_18043"},pressed:!1}],listeners:{menuItemClick:this.onActionClick.bind(this)}});
c="view_quota"==_DATA.page_label?"":" toa-hidden";this.panel.replaceChild("clone",{xtype:"button.Icon",name:"quota_settings",id:"configuration",icon:"icon-quota_settings",iconText:h(18044),addClass:"quota-buttons"+c,attr:{title:h(18044),alt:h(18044),"aria-label":h(18044)+"_18044"},layoutCellWidth:1,pressed:!1,listeners:{click:this.onActionClick.bind(this)}})},setFieldsLookup:function(c){this.fieldsLookup={};for(var b in c){var d=c[b];this.fieldsLookup[d.value]=d}},setLookups:function(c){this.lookups=
c},getCalendar:function(){return{xtype:"calendar.Extended",name:"calendar",layoutCellWidth:1,today:toa.app.get("today"),selected:toa.app.get("today"),modes:{day:h(11801),week:h(11802),month:h(11804),custom:h(11805)},addClass:"toa-layout-left-separator",selectedDates:this.options.calendar.dates,defaultMode:this.options.calendar.mode}},setCalendarOneDayMode:function(){if(this.isCalendarMultiDayMode){var c=this.getCalendar();c.modes={day:h(11801)};c.defaultMode="day";c.selectedDates=[this.getEarliestDateForCalendar()];
this.options.calendar.mode="day";this.options.calendar.dates=c.selectedDates;this.panel.replaceChild("calendar",c);this.isCalendarMultiDayMode=!1}},setCalendarMultiDayMode:function(){if(!this.isCalendarMultiDayMode){var c=this.getCalendar();this.panel.replaceChild("calendar",c);this.isCalendarMultiDayMode=!0}},getEarliestDateForCalendar:function(){var c=this.options.calendar.dates;c.sort(function(b,c){return Date.parse(b)-Date.parse(c)});return c[0]},setOldQuotaMenuVisibility:function(c){this.isOldQuotaMenuVisible=
c},getViews:function(){var c=this;this.listItems=[{label:this.getScreenName("quota"),value:"quota"},{label:h(18046),items:[{label:this.getScreenName("day"),value:"day"},{label:this.getScreenName("time_slot"),value:"time_slot"},{label:this.getScreenName("category"),value:"category"}]}];return!1==this.isOldQuotaMenuVisible?{}:{xtype:"Select",name:"view",value:this.options.view||"quota",addClass:"topSelect",formLabel:h(8047),withEmpty:!1,optionItems:this.listItems,listeners:{change:function(b,d){c.options.view=
d.value;c.onSelectorsChange(b,d);c.sendNotifyFilterChanges()}}}},refreshFilters:function(c){this.userChangedColumns=null;this.setFilter(c)},setFilter:function(c){if(this.isQuotaView(this.options.view)&&(!c||!c.filter))throw"Filter data is empty.";c.view&&(this.options.view=c.view);this.options.filter=c.filter;this.options.defaults=c.defaults;var b=this.getFilter();this.panel.setOption("filterDesc",b);this.panel.getFilterPopup().element.parent().addClass("viewFilter_"+_DATA.page_label);$(this.panel.getChild("filterButton").getElement()).attr("data-filter-screen",
"viewFilter_"+_DATA.page_label);b=["time_slot","category","day"];this.previusFilters&&-1===b.indexOf(this.options.view)||(b=this.extractFilterValues(),this.panel.getFilterPopup().findChild("filterForm").setValues(b));this.enableFilter();null===this.options.filterValues.columns&&(this.options.filterValues=this.panel.getFilterPopup().findChild("filterForm").getValues());this.isQuotaView(this.options.view)&&c.filter.actions&&this.setActions(c.filter.actions)},setActions:function(c){this.panel.setOption("actions",
c)},extractFilterValues:function(){var c;if(this.currentFilterValues)return c=this.currentFilterValues,this.currentFilterValues=null,c;c=this.options.filterValues;c.columns=this.userChangedColumns;return c},isQuotaView:function(c){switch(c){case "configuration_settings":case "available_capacity":case "map":return!1}return!0},getFiltersLookups:function(c,b,d,g){if("undefined"===typeof b[d]||!c.length)return c;for(var k=[],l=0,n=c.length;l<n;l++)k.push(c[l].id);for(var p=[],l=0,n=b[d].length;l<n;l++){var s=
k.indexOf(b[d][l][g]);-1!==s&&(c[s].name=b[d][l].text,p.push(c[s]))}return p},getFilter:function(){if("configuration_settings"==this.options.view||"map"==this.options.view)return[this.getViews()];var c=[];c.push({xtype:"Checkbox",name:"aggregated",value:this.options.filterValues.aggregated||this.options.filter.show_aggregated,formLabel:this.options.filter.show_aggregated?h(8188):"",hidden:!this.options.filter.show_aggregated});c.push(this.getViews());if(!0==this.isOldQuotaMenuVisible&&"quota"!=this.options.view){if(this.options.filter.categories){var b=
[{label:h(3509),value:"",disabled:!1,selected:!0}];this.addItemsToSelectOptions(b,this.getFiltersLookups(this.options.filter.categories,this.lookups,"capacityCategories","quota"===this.options.view?"label":"id"));c.push({xtype:"Select",name:"categories",withEmpty:!1,value:"",addClass:"topSelect",formLabel:h(207),optionItems:b,listeners:{change:this.onSelectorsChange.bind(this)}})}this.options.filter.timeslots&&(b=[{label:h(3509),value:"",disabled:!1,selected:!0}],this.addItemsToSelectOptions(b,this.getFiltersLookups(this.options.filter.timeslots,
this.lookups,"timeSlots","id")),c.push({xtype:"Select",name:"timeslots",withEmpty:!1,value:"",addClass:"topSelect",formLabel:h(3448),optionItems:b,listeners:{change:this.onSelectorsChange.bind(this)}}))}var b=[],d=this.getItemList(this.options.view);if(d&&d.defaultsFields){this.options.filter.fields=d.defaultsFields;for(var g=0;g<d.defaultsFields.length;g++){var k=d.defaultsFields[g];b.push({xtype:"Checkbox",name:k.mask,id:l+"__"+generate_id(),formLabel:null,class:"toa-hidden",value:k.value})}}else if("undefined"!==
typeof this.options.filter.fields)for(g=0;g<this.options.filter.fields.length;g++)if(k=this.options.filter.fields[g],"undefined"!==typeof k.label)l=k.label,d=this.getUomFieldName(k),b.push({xtype:"Checkbox",name:l,id:l+"__"+generate_id(),formLabel:d,value:this.getFilterValue(l,k.value)});else{var l=this.options.defaults&&!!(+this.options.defaults.fields&+k.mask),d=this.getUomFieldName(k);b.push({xtype:"Checkbox",name:k.mask,id:l+"__"+generate_id(),formLabel:d,value:this.getFilterValue(k.mask,l)})}c.push({xtype:"Form",
name:"columns",checkboxPosition:"left",items:b});return c},setUom:function(c){this.options.uom=c},getUomFieldName:function(c){var b=this.options.uom?this.options.uom:null,d="undefined"!==typeof c.name?c.name:null,g=c.value;b&&c&&c.uomNames&&c.uomNames[b]&&(d=c.uomNames[b]);c="undefined"!==typeof this.fieldsLookup[g]?this.fieldsLookup[g]:null;b&&c&&c.uomNames&&c.uomNames[b]&&(d=c.uomNames[b]);return d},isAggregatedMode:function(){return this.options.filter.show_aggregated?this.options.filterValues.aggregated:
!0},addItemsToSelectOptions:function(c,b){for(var d=[],g=0;g<b.length;g++){var k=b[g],l=k.id;-1===d.indexOf(l)&&(d.push(l),c.push({label:k.name||"",value:k.id||"",disabled:!1,selected:!1}))}return c},getScreenName:function(c){return this.screenNames[c]||""},setTitle:function(c,b){var d='<span class="screenHeading">'+this.getScreenName(c)+" | </span>"+b;this.panel.setOption("titleText",d)},isCalendarAvailable:function(c){"configuration_settings"==c?(this.panel.setOption("calendar",!1),this.panel.setOption("actions",
!1)):this.panel.setOption("calendar",this.getCalendar())},onActionClick:function(c,b){"undefined"===typeof b.name&&(b.name=b.source.getName());switch(b.name){case "quota_history":this.notify("showQuotaLog");break;case "quota_close_time_history":"byTimeIntervals"==_DATA.activeCloseTimeHistoryTab||!1==this.isOldQuotaMenuVisible?this.notify("showScheduleNewLog"):this.notify("showScheduleLog");break;case "quota_mass_populate":this.notify("showMassPopulate");break;case "map":case "quota_settings":case "quota":case "available_capacity":case "booking_status":this.options.currentViewState=
b.name;this.setPanelToolbarActiveButton(b.name);this.setPanelFilterButton(b.name);this.notify("showQuotaSettings",b.name);break;case "quota_new_history":this.notify("showQuotaNewLog");break;default:this.notify("doOtherAction",b)}},onFilterApply:function(c,b){this.options.currentViewState=b.values.view;this.options.previousView=b.values.view||"quota";this.options.view=b.values.view;this.panel.setOption("calendar",this.getCalendar());this.options.filterValues=b.values;this.setSelectedColumns(b.values.columns||
{});this.previousQuotaFilterState=b.values;this.previousQuotaViewState=b.values.view;this.previusFilters||(this.previusFilters={});this.previusFilters.filter={columns:this.options.filterValues.columns};this.notify("changed",this.options);this.panel.closeFilter()},setSelectedColumns:function(c){this.userChangedColumns=this.userChangedColumns||{};$.extend(this.userChangedColumns,c||{})},setPreviusFiltesValues:function(c){this.previusFilters=c},getFilterValue:function(c,b){return this.previusFilters&&
this.previusFilters.filter&&this.previusFilters.filter.columns&&"undefined"!==typeof this.previusFilters.filter.columns[c]?parseInt(this.previusFilters.filter.columns[c]):b},getColumnsMask:function(){"booking_status"==this.options.view&&(this.options.filterValues=this.panel.getFilterPopup().findChild("filterForm").getValues());var c=this.options.filterValues.columns,b=this.options.defaults&&this.options.defaults.fields?+this.options.defaults.fields:0,d;for(d in c)b=c[d]?b|d:b&~d;return b},onChangeDates:function(c,
b){this.options.calendar.dates=b.date;this.options.calendar.label=b.label;this.notify("changed",this.options)},onSelectMode:function(c,b){this.options.calendar.mode=b.date},onOpenTree:function(c,b){this.notify("openTree")},onSelectorsChange:function(c,b){this.currentFilterValues=this.panel.getFilterPopup().findChild("filterForm").getValues()},sendNotifyFilterChanges:function(){this.notify("filterChanged",{categories:this.currentFilterValues.categories,timeslots:this.currentFilterValues.timeslots,
aggregated:this.currentFilterValues.aggregated})},disableFilter:function(){this.panel.getFilterPopup().eachChild(function(c){c.setOption("disabled",!0)},!0)},enableFilter:function(){this.panel.getFilterPopup().eachChild(function(c){c.setOption("disabled",!1)},!0)},showTreeButton:function(){this.panel.setOption("resourceTreeButton",!0)},hideTreeButton:function(){this.panel.setOption("resourceTreeButton",!1)},refreshResourceTreeButton:function(c){c=_DATA.tabs.isVisible(c)&&!_DATA.tabs.isOpened(c);this.panel.setOption("resourceTreeButton",
c);return c},getItemList:function(c){for(var b=0;b<this.listItems.length;b++)if(this.listItems[b].value==c)return this.listItems[b]},getSortedCalendarDates:function(){var c=this.options.calendar.dates,b=[],d;for(d in c)b.push(c[d]);b.sort(function(b,c){return b===c?0:b<c?-1:1});return b},setPanelToolbarActiveButton:function(c){var b=this.panel.getChild("viewsPanel").children;-1!==["time_slot","category","day"].indexOf(c)&&(c="quota");for(var d=0;d<b.length;d++)b[d].setOption("pressed",b[d].options.name==
c?!0:!1);this.panel.getChild("viewsPanel").rerender();this.panel.getChild("quota_settings").setOption("pressed",!1);-1!==c.indexOf("settings")&&(this.panel.getChild("quota_settings").setOption("pressed",!0),this.panel.getChild("quota_settings").rerender())},setPanelFilterButton:function(c){this.panel.getChild("filterButton").setOption("hidden",!0);-1!==["quota","time_slot","category","day"].indexOf(c)&&this.panel.getChild("filterButton").setOption("hidden",!1);this.panel.getChild("filterButton").rerender()}});
toa.mixin(d.prototype,toa.mixins.EventEmitter);return d}());toa.ns("toa.controlers.ViewQuota.ViewQuotaManageFilters",function(){var d=toa.define(null,function(){this.updateQuotaErrorsMapping={MISSING_MANDATORY_ITEM:21352,EMPTY_LABEL:21353,UNKNOWN_CATEGORY:21354,INACTIVE_CATEGORY:21355,CATEGORY_IS_NOT_SUPPORTED:21356,NOT_PERMITTED:21357,INVALID_DATE:21358,DATE_IS_IN_PAST:21359,NO_TIME_ZONE_DIFF:21360,UNKNOWN_CAPACITY_AREA:21361,INACTIVE_CAPACITY_AREA:21362,INVALID_QUOTA_PERCENT_VALUE:21363,INVALID_MIN_QUOTA_VALUE:21364,INVALID_QUOTA_VALUE:21365,INVALID_STOP_BOOKING_AT_VALUE:21366,
INVALID_STATUS_VALUE:21367,UNKNOW_ERROR:21368};this.selectedFields={};this.selectedFilters=[];this.requestFields=[];this.isGroup=!1;this.groupFields=["maxAvailable","otherActivities","quota","used","usedQuotaPercent"];this.filters={fields:[{value:1,label:"maxAvailable",decorateValue:"uom",requestFields:["area.maxAvailable","area.category.maxAvailable"],mapEntityField:{area:"maxAvailable",category:"maxAvailable"},name:h(18030)},{value:1,label:"maxAvailableByPlans",visibility:!1,decorateValue:"uom",
requestFields:["area.maxAvailableByPlans","area.category.maxAvailableByPlans"],mapEntityField:{area:"maxAvailableByPlans",category:"maxAvailableByPlans"},name:h(20561)},{value:1,label:"otherActivities",decorateValue:"uom",requestFields:["area.otherActivities"],mapEntityField:{area:"otherActivities"},name:h(20480)},{value:1,label:"quotaPercent",requestFields:["area.quotaPercent","area.category.quotaPercentCategory"],mapEntityField:{area:"quotaPercent",category:"quotaPercentCategory"},decorateValue:"percent",
name:h(20481)},{value:1,label:"quotaPercentDay",requestFields:["area.category.quotaPercentDay"],mapEntityField:{category:"quotaPercentDay"},decorateValue:"percent",name:h(20482)},{value:1,label:"minQuota",decorateValue:"uom",revertDecorate:"uom",requestFields:["area.minQuota","area.category.minQuota"],mapEntityField:{area:"minQuota",category:"minQuota"},name:h(18035)},{value:1,label:"quota",visibility:!0,decorateValue:"uom",revertDecorate:"uom",requestFields:["area.quota","area.category.quota"],mapEntityField:{area:"quota",
category:"quota",interval:"quota"},name:h(18033),uomNames:{hours:h(18033),minutes:h(20476),"man-days":h(20477)}},{value:1,label:"used",decorateValue:"uom",requestFields:["area.used","area.category.used"],mapEntityField:{area:"used",category:"used"},name:h(18036),uomNames:{hours:h(18036),minutes:h(20478),"man-days":h(20479)}},{value:1,label:"usedQuotaPercent",decorateValue:"percent",requestFields:["area.usedQuotaPercent","area.category.usedQuotaPercent"],mapEntityField:{area:"usedQuotaPercent",category:"usedQuotaPercent"},
name:h(18037)},{value:1,label:"stopBookingAt",decorateValue:"percent",requestFields:["area.category.stopBookingAt"],mapEntityField:{area:"stopBookingAt",category:"stopBookingAt"},name:h(18038)},{value:1,label:"count",decorateValue:"count",requestFields:["area.count","area.category.count"],mapEntityField:{area:"count",category:"count"},name:h(18063)}],categories:[],modes:[{label:h(18043),value:"available_capacity"},{label:h(18039),value:"quota"},{label:h(18040),value:"time_slot"},{label:h(18041),value:"category"},
{label:h(18042),value:"booking_status"},{label:h(18044),value:"configuration_settings"}]}},{getFilters:function(){return this.filters},getViewFilterData:function(){return{filter:this.filters,defaults:{fields:this.filters.fields}}},setSelectedFields:function(c,b){this.isGroup=!0===b?!0:!1;this.selectedFields=[];this.selectedFilters=[];this.columns=c;for(var d=Object.values(c).indexOf(1),g=this.filters.fields,k=0;k<g.length;k++){var l=g[k].label;this.isGroup&&0>this.groupFields.indexOf(l)||(this.selectedFilters.push(g[k]),
"undefined"!==typeof g[k].visibility&&!0===g[k].visibility&&-1===d&&(this.selectedFields[l]=g[k]),c.hasOwnProperty(l)&&0===c[l]||(g[k].requestFields&&(this.requestFields=this.requestFields.concat(g[k].requestFields)),this.selectedFields[l]=g[k]))}return this.selectedFields},getSelectedFields:function(){return this.selectedFields},getSelectedViewFilters:function(){return{filter:{categories:this.filters.categories,mode:this.filters.modes,fields:this.isGroup?this.selectedFilters:this.filters.fields,
columns:this.columns||[]},defaults:{fields:this.selectedFields}}},setCategoriesToFilter:function(c){this.filters.categories=c&&0<c.length?c:[]},getRequestFields:function(){return this.requestFields},getFields:function(){return this.filters.fields},getErrorMesageByCode:function(c){return h(this.updateQuotaErrorsMapping[c])||h(this.updateQuotaErrorsMapping.UNKNOW_ERROR)}});toa.mixin(d.prototype,toa.mixins.EventEmitter);return d}());toa.ns("toa.controlers.ViewQuota.ViewCapacityFilters",function(){var d=toa.define(null,function(){this.selectedFields={};this.selectedFilters=[];this.requestFields=[];this.filters={fields:[{value:1,label:"maxAvailable",requestFields:["area.calendar.minutes","area.category.calendar.minutes","area.calendar.count","area.category.calendar.count"],name:h(18030)}]}},{getFilters:function(){return this.filters},getViewFilterData:function(){return{filter:this.filters,defaults:{fields:this.filters.fields}}},
setSelectedFields:function(c,b){this.isGroup=!0===b?!0:!1;this.selectedFields=[];this.selectedFilters=[];this.columns=c;for(var d=this.filters.fields,g=0;g<d.length;g++){var k=d[g].label;this.isGroup&&0>this.groupFields.indexOf(k)||(this.selectedFilters.push(d[g]),c.hasOwnProperty(k)&&0===c[k])||(d[g].requestFields&&(this.requestFields=this.requestFields.concat(d[g].requestFields)),"undefined"!==typeof d[g].visibility&&!1===d[g].visibility)||(this.selectedFields[k]=d[g])}return this.selectedFields},
getSelectedFields:function(){return this.selectedFields},getSelectedViewFilters:function(){return{filter:{fields:this.filters.fields,columns:this.columns||[]},defaults:{fields:this.selectedFilters}}},getRequestFields:function(){return this.requestFields},getFields:function(){return this.filters.fields}});toa.mixin(d.prototype,toa.mixins.EventEmitter);return d}());toa.ns("toa.controlers.ViewQuota.QuotaManageApiConnector",function(){return toa.define(null,function(){this.apis={capacity:{url:"rest/ofscCapacity/v1/"},metadata:{url:"rest/ofscMetadata/v1/"}};this.host=window.location.protocol+"//"+window.location.host+":"+window.location.port+window.location.pathname},{getApiUrl:function(d,c){if("undefined"===typeof this.apis[d])throw'Use of unsupported api "'+d+'"';if(!c)throw"Source is not provided";return(!0===_DATA.is_mobility_app?this.host+"../":this.host)+
this.apis[d].url+c},sendRequestToApi:function(d,c,b,e){d=this.getApiUrl(d,c);!0!==_DATA.is_mobility_app&&(d+="?SID="+this.getSid());c=e.data||{};c=this.prepareRequestParams(b,c);$.ajax({type:b,url:d,data:c,dataType:"json",success:function(b,c){e.responseHandler&&e.responseHandler({},b)},error:e.errorHandler||function(){}})},getSid:function(){var d=GetSessId();return d.substr(d.indexOf("=")+1,d.length-d.indexOf("="))},prepareRequestParams:function(d,c){var b;switch(d){case "GET":case "DELETE":b=this.prepareObjectRequestParams(c);
break;default:b=JSON.stringify(c)}return b},prepareObjectRequestParams:function(d){var c="",b;for(b in d)if(d.hasOwnProperty(b)){var e=d[b];Array.isArray(e)&&(e=e.join());c+="&"+b+"="+encodeURIComponent(e)}return c}})}());var widget={options:{mobilityPopupTopRatio:1.7,filterClass:"toa-widget-grid-filter",fieldValues:[],singleChoiceFilter:0,sort:1,translations:{Ok:toa.glossary({id:445}),Cancel:toa.glossary({id:290}),SortAZ:toa.glossary({id:18137}),SortZA:toa.glossary({id:18138}),SelectAll:toa.glossary({id:12033}),ClearAll:toa.glossary({id:12034}),Filter:toa.glossary({id:3412})}},previousSort:"",previousFilter:[],_create:function(){var d=this.element,c=this.options.filterClass,b=$("<div/>");b.addClass(this.options.filterClass+
"-button");b.attr({role:"button"});b.appendTo(d);this.button=b;this.popup=this._createPopup(this.options.fieldValues);this._setButtonStatus(c+"-"+this._calculateButtonStatus()+"-closed");this._setButtonEvent()},_createPopup:function(){var d=this.options.translations,c=this.options.filterClass,b=!1,e=$('<div class="'+c+'-popup"/>');this._setPopupEvents(e);if(this.options.sort){var b=$("<div/>").addClass(c+"-sort ").addClass(c+"-sortdown").html(d.SortAZ),g=$("<div/>").addClass(c+"-sort ").addClass(c+
"-sortup").html(d.SortZA),b=$('<div class="'+c+'-sort-container"/>').append(b).append(g);b.appendTo(e);this._setPopupEventsSort(b)}if(this.options.fieldValues&&this.options.fieldValues.length){b&&!this.options.singleChoiceFilter&&e.append('<div class="'+c+'-separate"/>');this.options.singleChoiceFilter||(b=$('<a href="#"/>').addClass(c+"-select-all").text(d.SelectAll),g=$('<a href="#"/>').addClass(c+"-clear-all").text(d.ClearAll),b=$('<div class="'+c+'-actions"/>').append(d.Filter+": ").append(b).append(" - ").append(g),
b.appendTo(e));b=$('<div class="'+c+'-list-container"/>');for(g=0;g<this.options.fieldValues.length;g++)$('<div class="'+c+'-item"/>').append('<input class="'+c+'-fields" type="checkbox" value="'+hs(this.options.fieldValues[g].value)+'">').append('<label class="'+c+'-label">'+hs(this.options.fieldValues[g].name)+"</label>").appendTo(b);this.options.singleChoiceFilter?this._setSingleChoiceFilter(b):this._setPopupEventsFilter(e,b);e.append(b)}d=$('<div class="'+c+'-buttons">').append('<input type="button" class="'+
c+'-cancel toa-button" value="'+d.Cancel+'">').append('<input type="button" class="'+c+'-ok toa-button" value="'+d.Ok+'">');this._setButtonsEvent(d);e.append(d);e.appendTo(_DATA.popup_container);return e},_setButtonsEvent:function(d){var c=this,b=c.options.filterClass,e=c.element;d.find("."+b+"-ok").bind("click",function(){e.trigger("sortFilterChangeFilter",c.getSort());c._hide()});d.find("."+b+"-cancel").bind("click",function(){c._restore();c._hide()})},_setPopupEvents:function(d){d.bind("click",
function(c){c.stopPropagation()})},_setPopupEventsSort:function(d){var c=this.options.filterClass;d.find("div."+c+"-sort").bind("click",function(){$(this).hasClass(c+"-sort-active")?$(this).removeClass(c+"-sort-active"):$(this).addClass(c+"-sort-active");d.find("div."+c+"-sort").not($(this)).removeClass(c+"-sort-active")})},_setSingleChoiceFilter:function(d){var c=this.options.filterClass;d.find("label."+c+"-label").bind("click",function(b){$(this).parent("div").find('[type="checkbox"].'+c+"-fields").trigger("click")});
d.find('[type="checkbox"].'+c+"-fields").bind("click",function(){d.find('[type="checkbox"].'+c+"-fields").not($(this)).removeAttr("checked")})},_setPopupEventsFilter:function(d,c){var b=this.options.filterClass;d.find("."+b+"-select-all").bind("click",function(c){c.preventDefault();c=d.find('[type="checkbox"].'+b+"-fields");if(0<c.length)for(var g=0;g<c.length;g++)c[g].checked=!0});d.find("."+b+"-clear-all").bind("click",function(c){c.preventDefault();c=d.find('[type="checkbox"].'+b+"-fields");if(0<
c.length)for(var g=0;g<c.length;g++)c[g].checked=!1});c.find("label."+b+"-label").bind("click",function(c){$(this).parent("div").find('[type="checkbox"].'+b+"-fields").trigger("click")})},_calculateButtonStatus:function(){var d=this.options.filterClass;return this.options.singleChoiceFilter&&this.popup.find("."+d+"-list-container :checked").length||this.popup.find("."+d+"-list-container :checked").length&&!this.options.singleChoiceFilter&&this.popup.find("."+d+"-list-container :checked").length!=
this.options.fieldValues.length?"filtered":this.popup.find("div."+d+"-sortup").hasClass(d+"-sort-active")?"sortup":this.popup.find("div."+d+"-sortdown").hasClass(d+"-sort-active")?"sortdown":"default"},_setButtonStatus:function(d){var c=this.options.filterClass;this.button.removeAttr("class");this.button.addClass(c+"-button");this.button.addClass(d)},_setButtonEvent:function(){var d=this,c=d.options.filterClass;d.button.bind("click",function(b){d.popup.is(":hidden")?(d._setButtonStatus(c+"-"+d._calculateButtonStatus()+
"-opened"),d._openPopup()):(d._restore(),d._hide());b.stopPropagation()})},_openPopup:function(){var d=this.element;this.popup.css({left:-1E3,top:-1E3});d.trigger("showFilter");this.popup.show();var d=this.popup.width()>this.button.offset().left?this.button.offset().left:this.button.offset().left+this.button.outerWidth()-this.popup.outerWidth(),c=toa.currentInterface!==INTERFACE.MOBILITY?this.button.offset().top+this.button.height():this.button.offset().top-this.button.height()*this.options.mobilityPopupTopRatio;
this._setHeights();this.popup.css({left:d,top:c});this.previousFilter=this.getFilter();this.previousSort=this.getSort()},_hide:function(){this._setButtonStatus(this.options.filterClass+"-"+this._calculateButtonStatus()+"-closed");this.popup.hide()},hide:function(){this._hide()},getFilter:function(){var d=[];this.popup.find("."+this.options.filterClass+"-fields:checked").each(function(c,b){d.push($(b).val())});return this.options.fieldValues.length==d.length?"*":d},getSort:function(){var d=this.options.filterClass;
return this.popup.find("div."+d+"-sortup").hasClass(d+"-sort-active")?"desc":this.popup.find("div."+d+"-sortdown").hasClass(d+"-sort-active")?"asc":0},_setFilter:function(d){var c=this.options.filterClass;if("*"==d){if(!this.options.singleChoiceFilter&&(c=this.popup.find("."+c+"-fields"),0<c.length))for(var b=0;b<c.length;b++)c[b].checked=!0}else if(c=this.popup.find("."+c+"-fields"),0<c.length)for(b=0;b<c.length;b++)-1!==$.inArray(c[b].value,d)?c[b].checked=!0:c[b].checked=!1},_setSort:function(d){var c=
this.options.filterClass;this.popup.find("div."+c+"-sort").removeClass(c+"-sort-active");"desc"==d?this.popup.find("div."+c+"-sortup").addClass(c+"-sort-active"):"asc"==d&&this.popup.find("."+c+"-sortdown").addClass(c+"-sort-active")},_restore:function(){this._setSort(this.previousSort);this._setFilter(this.previousFilter)},restoreFilter:function(d){var c=this.options.filterClass;this._setFilter(d);this._setButtonStatus(c+"-"+this._calculateButtonStatus()+"-closed")},restoreSort:function(d){var c=
this.options.filterClass;this._setSort(d);this._setButtonStatus(c+"-"+this._calculateButtonStatus()+"-closed")},resetSort:function(){var d=this.options.filterClass;this.popup.find("div."+d+"-sort").removeClass(d+"-sort-active");this._setButtonStatus(d+"-"+this._calculateButtonStatus()+"-closed")},deleteFilter:function(){this.button.detach();this.popup.detach()},_setHeights:function(){var d=this.popup,c=this.options.filterClass,b=d.find("."+c+"-list-container"),d=d.innerHeight()-(isNaN(parseInt(d.css("padding-top"),
10))?0:parseInt(d.css("padding-top"),10))-(isNaN(parseInt(d.css("padding-bottom"),10))?0:parseInt(d.css("padding-bottom"),10))-d.find("."+c+"-sort-container").outerHeight(!0)-d.find("."+c+"-separate").outerHeight(!0)-d.find("."+c+"-actions").outerHeight(!0)-d.find("."+c+"-buttons").outerHeight(!0)-(isNaN(parseInt(b.css("padding-top"),10))?0:parseInt(b.css("padding-top"),10))-(isNaN(parseInt(b.css("padding-bottom"),10))?0:parseInt(b.css("padding-bottom"),10))-(isNaN(parseInt(b.css("margin-top"),10))?
0:parseInt(b.css("margin-top"),10))-(isNaN(parseInt(b.css("margin-bottom"),10))?0:parseInt(b.css("margin-bottom"),10))-(isNaN(parseInt(b.css("border-top"),10))?0:parseInt(b.css("border-top"),10))-(isNaN(parseInt(b.css("border-bottom"),10))?0:parseInt(b.css("border-bottom"),10));b.height()>d&&b.height(d)},setFilterHeight:function(d){this.parentGridHeight=d}};$.widget("toaUi.GridFilter",widget);widget={options:{title:"",exportLinkTitle:"",bucketName:"",dateRange:new Date},windowOldHeight:0,windowOldWidth:0,etalonDialogWidth:0,_create:function(){this.dialogWindow=this.createDialogWindow();this.etalonDialogWidth=this.dialogWindow.input.dialog("option","width");this._saveDialogWindowParameters(this.dialogWindow.input.width(),this.dialogWindow.input.height());this.dialogCaption=this._createDialogCaption();this.dateRange=this.createDateRange();this.exportLink=this.createExportLink();this.gridDiv=
$("<div/>");this.gridDiv.addClass("log_container");this.gridDiv.appendTo(this.dialogWindow.input);this.gridDiv.LogGrid({parent:this.gridDiv});this.setExportEvent()},createDialogWindow:function(){var d={xtype:"window",layout:"none",name:"dialog_content",width:790,css:{overflow:"hidden",margin:"0 auto","max-height":"auto"},jqdialog:{minWidth:700,minHeight:300},listeners:{dialogclose:this._onClose.bind(this),dialogdragstart:this._onMove.bind(this),dialogresizestop:this._onResizeStop.bind(this),dialogresize:this._onResize.bind(this),
dialogresizestart:this._onResizeStart.bind(this)}},d=toa.formBuilder(d);d.renderTo(this.element);return d},_saveDialogWindowParameters:function(d,c){this.windowOldHeight=c;this.windowOldWidth=d},_createDialogCaption:function(){var d=$("<div/>").attr("id","log_caption");d.addClass("log_caption");d.appendTo(this.dialogWindow.input);return d},createDateRange:function(){var d=$("<div/>").attr("id","date_range");d.addClass("date_range");d.appendTo(this.dialogCaption);return d},createExportLink:function(){var d=
$('<div role="link" class="log_export" id="export_data"/>'),c=this.options.exportLinkTitle;c||(c=h(12015));d.text(c);d.appendTo(this.dialogCaption);return d},setExportEvent:function(){var d=this;d.exportLink.bind("click",function(){d.element.trigger("clickExport")})},setTabsEvent:function(){var d=this;d.byTimeSlots.bind("click",function(){_DATA.activeCloseTimeHistoryTab="byTimeSlots";d.li1.addClass("active");d.li2.removeClass("active");d.element.trigger("clickByTimeSlots");d.gridDiv.LogGrid("closeAllFilters")});
d.byTimeIntervals.bind("click",function(){_DATA.activeCloseTimeHistoryTab="byTimeIntervals";d.li1.removeClass("active");d.li2.addClass("active");d.element.trigger("clickByTimeIntervals");d.gridDiv.LogGrid("closeAllFilters")})},setPanelText:function(d){this.dateRange.text(d)},open:function(){this._calculateContainerHeights();this._setContainerWidth();this.dialogWindow.open();this.gridDiv.LogGrid("setContainerHeight");this.gridDiv.LogGrid("setGridWidth")},_setContainerWidth:function(){this.dialogWindow.input.dialog("option",
"width",this.etalonDialogWidth)},_calculateContainerHeights:function(){var d=this.dialogCaption,c=$(window).height()-120;this.dialogWindow.input.dialog("option","height",c);this.dialogWindow.input.dialog("option","maxHeight",$(window).height());this.dialogWindow.input.css("max-height","none");this.dialogHeight=c;var c=this.dialogWindow.input.height(),b=(isNaN(parseInt(d.css("padding-top"),10))?0:parseInt(d.css("padding-top"),10))+(isNaN(parseInt(d.css("padding-bottom"),10))?0:parseInt(d.css("padding-bottom"),
10))+d.height(),e=isNaN(parseInt(this.gridDiv.css("border-top-width"),10))?0:parseInt(this.gridDiv.css("border-top-width"),10),c=c-b-e;1<=d.find(".tabs").length&&(c-=30);this.gridDiv.height(c)},setTitle:function(d){this.dialogWindow.setTitle(d)},setWidth:function(d){d&&(this.etalonDialogWidth=d,this._setContainerWidth())},setExportLinkTitle:function(d){d&&this.exportLink.text(d)},setTable:function(d,c,b,e){this.gridDiv.LogGrid({cols:d});this.gridDiv.LogGrid("createHeadBodyTable",{from:b,rows:c,filters:e});
this.setTableEvent();0==c.length?this.exportLink.hide():this.exportLink.show()},clearTabs:function(){var d=this.dialogCaption;1<=d.find(".tabs").length&&d.find(".tabs")[0].remove()},setTabs:function(d){var c=this.dialogCaption;if("QuotaCloseScheduleLog"!=d&&"QuotaCloseScheduleNewLog"!=d||!(1<=c.find(".tabs").length))if("QuotaCloseScheduleLog"!=d&&"QuotaCloseScheduleNewLog"!=d)1<=c.find(".tabs").length&&c.find(".tabs")[0].remove();else{d=$('<div class="tabs" />');var b=$("<ul />");this.li1=$("<li/>");
this.li2=$("<li/>");"byTimeIntervals"==_DATA.activeCloseTimeHistoryTab?this.li2.addClass("active"):this.li1.addClass("active");this.byTimeSlots=$('<a href="#" onclick="return false;">'+h(18080)+"</a>");this.byTimeIntervals=$('<a href="#" onclick="return false;">'+h(18081)+"</a>");this.byTimeSlots.appendTo(this.li1);this.li1.appendTo(b);this.byTimeIntervals.appendTo(this.li2);this.li2.appendTo(b);b.appendTo(d);d.appendTo(c);this.setTabsEvent();return d}},setTableEvent:function(){var d=this;d.gridDiv.unbind();
d.gridDiv.bind("showMoreRecordsGrid",function(){d.element.trigger("showMoreRecordsDialog")});d.gridDiv.bind("sortFilterChangeGrid",function(c,b){d.element.trigger("sortFilterChangeDialog",b)})},addTableRows:function(d,c){this.gridDiv.LogGrid("addPage",{from:c,rows:d})},_onClose:function(){this.gridDiv.LogGrid("deleteAllFilters")},_onMove:function(){this.gridDiv.LogGrid("closeAllFilters")},_onResizeStart:function(){this.gridDiv.LogGrid("closeAllFilters")},_onResize:function(){this.windowOldWidth!=
this.dialogWindow.input.width()&&this.gridDiv.LogGrid("setGridWidth");this.windowOldHeight!=this.dialogWindow.input.height()&&(this._calculateResizeHeight(),this.gridDiv.LogGrid("setContainerHeight"))},_onResizeStop:function(){this.gridDiv.LogGrid("setGridWidth");this._saveDialogWindowParameters(this.dialogWindow.input.width(),this.dialogWindow.input.height())},_calculateResizeHeight:function(){var d=this.dialogCaption,c=this.dialogWindow.input.height(),b=(isNaN(parseInt(d.css("padding-top"),10))?
0:parseInt(d.css("padding-top"),10))+(isNaN(parseInt(d.css("padding-bottom"),10))?0:parseInt(d.css("padding-bottom"),10))+d.height(),e=isNaN(parseInt(this.gridDiv.css("border-top-width"),10))?0:parseInt(this.gridDiv.css("border-top-width"),10),c=c-b-e;1<=d.find(".tabs").length&&(c-=30);this.gridDiv.height(c)}};$.widget("toaUi.LogDialog",widget);widget={options:{gridClass:"log-grid",cols:!1},page:{},_create:function(){var d=this.element;this.firstLoading=!1;this.selectedFilterData={};var c=$("<thead/>");this.head=$("<tr/>").appendTo(c);this.headContainer=$("<div/>").addClass(this.options.gridClass+"-head-container");$("<table/>").addClass(this.options.gridClass+"-head").append(c).appendTo(this.headContainer);this.headContainer.appendTo(d);this.body=$("<tbody/>");c=$("<table/>").addClass(this.options.gridClass).append(this.body);this.gridContainer=
$("<div/>").addClass(this.options.gridClass+"-container").append(c).appendTo(d);this.nameToId={};this.filters=[];this._setScrollEvent(c)},_calculateFakeRowHeight:function(){var d=$("<table/>").addClass(this.options.gridClass).css("position",-1E3);$("<tbody/>").append("<tr/>").appendTo(d);var c=$("<td/>").appendTo(d.find("tr")),c=$("<table/>").addClass(this.options.gridClass+"-inner-head-table").appendTo(c);$("<tbody/>").append("<tr/>").appendTo(c);$("<td/>").addClass(this.options.gridClass+"-fake-inner-cell").appendTo(c.find("tr"));
d.appendTo(_DATA.dispatcher_container);this.fakeRowHeight=d.innerHeight();d.remove()},_setScrollEvent:function(d){var c=this;c.gridContainer.bind("scroll",function(){c.firstLoading?(c.gridContainer.scrollTop(0),c.firstLoading=!1):c.hasScrollReachedTheEnd(d)&&c._requestRecord()})},_requestRecord:function(){0!=this.page.rows.length&&this.element.trigger("showMoreRecordsGrid")},hasScrollReachedTheEnd:function(d){var c=this.gridContainer.scrollTop();d=d.height();var b=this.gridContainer.height();return 1>=
d-c-this.fakeRowHeight-b},createHeadBodyTable:function(d){this.firstLoading=!0;this.setHeader();this.setPage(d);0==d.rows.length&&this.addRowEmptyResult();this.selectedFilterData=d.filters?d.filters:{};$.isEmptyObject(this.selectedFilterData)||this._setAllDataFilters()},setHeader:function(){var d=this,c,b,e,g,k;d.head.empty();d.nameToId={};d.filters=[];$.map(d.options.cols,function(l,n){b=l.headerWidth?' width="'+l.headerWidth+'"':"";c=$("<th  "+b+'data-name="'+l.name+'"></th>');k=$("<table/>").addClass(d.options.gridClass+
"-inner-head-table");k.appendTo(c);e=$("<td/>").text(l.title);$("<tr/>").append(e).appendTo(k);l.colClass&&e.addClass(l.colClass);l.colFilter&&(g=d._createFilter(l.colFilter),g.insertAfter(e),d.filters.push(g),d._setHeaderEvents(g));d.head.append(c);d.nameToId[l.name]=n});c=$("<th/>").addClass("non-scroll-cell");d.head.append(c)},_createFilter:function(d){var c;c=$("<td/>").toggleClass().addClass(this.options.gridClass+"-filter-cell");d.fieldValues?c.data("searchAttr",d.searchAttr):c.data("searchAttr",
0);d.sort?c.data("sortAttr",d.sortAttr):c.data("sortAttr",0);c.GridFilter(d);return c},_setHeaderEvents:function(d){var c=this;d.bind("showFilter",function(){c.closeAllFilters()});d.bind("sortFilterChangeFilter",function(b,e){e&&c._resetPreviousSortFilters(d);c.selectedFilterData=c._getAllDataFilters();c.element.trigger("sortFilterChangeGrid",c.selectedFilterData)})},closeAllFilters:function(){for(var d in this.filters)$(this.filters[d]).GridFilter("hide")},_resetPreviousSortFilters:function(d){for(var c in this.filters)$(this.filters[c]).not(d).GridFilter("resetSort")},
_getAllDataFilters:function(){var d="",c=d="",b={},e={},g={},k;for(k in this.filters)(d=$(this.filters[k]).data("searchAttr"))&&(e[d]=$(this.filters[k]).GridFilter("getFilter")),(d=$(this.filters[k]).data("sortAttr"))&&(c=$(this.filters[k]).GridFilter("getSort"))&&(g[d]=c);$.isEmptyObject(e)||(b.filterVals=e);$.isEmptyObject(g)||(b.sortVal=g);return b},_setAllDataFilters:function(){var d={},d={};if(!$.isEmptyObject(this.selectedFilterData.filterVals)){var d=this.selectedFilterData.filterVals,c;for(c in this.filters)this.filters[c].data("searchAttr")in
d&&$(this.filters[c]).GridFilter("restoreFilter",d[this.filters[c].data("searchAttr")])}if(!$.isEmptyObject(this.selectedFilterData.sortVal))for(c in d=this.selectedFilterData.sortVal,this.filters)this.filters[c].data("sortAttr")in d&&$(this.filters[c]).GridFilter("restoreSort",d[this.filters[c].data("sortAttr")])},_addHeaderRowIntoTable:function(){var d=this,c,b,e,g,k=$("<tr/>").addClass("fake-row");$.map(d.options.cols,function(l,n){c=l.headerWidth?' width="'+l.headerWidth+'"':"";e=$("<td  "+c+
"></td>").attr("data-col",n).addClass(d.options.gridClass+"-fake-outer-cell");g=$("<table/>").addClass(d.options.gridClass+"-inner-head-table");g.appendTo(e);b=$("<td/>").text(l.title).addClass(d.options.gridClass+"-fake-inner-cell");$("<tr/>").append(b).appendTo(g);l.colFilter&&$("<td/>").toggleClass().addClass(d.options.gridClass+"-filter-cell").width($("td."+d.options.gridClass+"-filter-cell").width()).insertAfter(b);e.appendTo(k)});d.body.append(k)},_hideHeaderRowInTable:function(){this.fakeRowHeight||
this._calculateFakeRowHeight();this.gridContainer.find("table."+this.options.gridClass).css("margin-top",0-Math.abs(this.fakeRowHeight))},setPage:function(d){d&&(this.page=d);this.body.empty();this.rowCount=0;this._addHeaderRowIntoTable();this._hideHeaderRowInTable();for(var c in d.rows)this.addRow(d.rows[c])},addRow:function(d){var c=this,b=$('<tr data-row="'+c.rowCount+'"/>');c.colIndex=0;$.map(c.options.cols,function(e,g){c.addCell(b,d,e,g)});b.appendTo(c.body);c.rowCount++;return b},addRowEmptyResult:function(){var d=
$("<tr/>").appendTo(this.body).addClass("empty-row");$('<td align="center"/>').text(h(12018)).attr("colspan",this.options.cols.length).appendTo(d)},addCell:function(d,c,b,e){c=c[b.name]||"";c=$("<td "+(b.width?' width="'+b.width+'"':"")+"/>").attr("data-col",this.colIndex).text(c);this.colIndex++;b.colClass&&c.addClass(b.colClass);c.appendTo(d)},_calculateColumnWidth:function(d,c){return d.width()+(isNaN(parseInt(d.css("padding-left"),10))?0:parseInt(d.css("padding-left"),10))+(isNaN(parseInt(d.css("padding-right"),
10))?0:parseInt(d.css("padding-right"),10))+(isNaN(parseInt(d.css("border-left-width"),10))?0:parseInt(d.css("border-left-width"),10))+(isNaN(parseInt(d.css("border-right-width"),10))?0:parseInt(d.css("border-right-width"),10))-(isNaN(parseInt(c.css("padding-left"),10))?0:parseInt(c.css("padding-left"),10))-(isNaN(parseInt(c.css("padding-right"),10))?0:parseInt(c.css("padding-right"),10))-(isNaN(parseInt(c.css("border-left-width"),10))?0:parseInt(c.css("border-left-width"),10))-(isNaN(parseInt(c.css("border-right-width"),
10))?0:parseInt(c.css("border-right-width"),10))},_setHeaderColumnsWidth:function(){var d=this;d.body.find("td."+d.options.gridClass+"-fake-outer-cell").each(function(c,b){var e=$(b).attr("data-col"),e=d.head.find("th:eq("+e+")"),g=d._calculateColumnWidth($(b),e);e.width(g)})},setPillars:function(){var d=this;d.body.find("td."+d.options.gridClass+"-fake-outer-cell").each(function(c,b){var e=$(b).attr("data-col"),e=d.head.find("th:eq("+e+")"),g=d._calculateColumnWidth($(b),e);$("<div/>").text(" ").height(1).width(g).appendTo($(b));
$("<div/>").text(" ").height(1).width(g).appendTo(e)})},_setScrollCellWidth:function(){var d=this.head.find("th:last-child");d.toggleClass();var c=this.gridContainer[0].offsetWidth-this.gridContainer[0].clientWidth;0<c?(d.addClass("scroll-cell"),d.width(c),d.css("min-width",c)):(d.addClass("non-scroll-cell"),d.width(0),d.css("min-width",0));return c},_calculateContainerHeight:function(){return this.element.height()-this.head.height()},setContainerHeight:function(){var d=this._calculateContainerHeight();
this.gridContainer.height(d);this.gridContainer.find("table."+this.options.gridClass).outerHeight()-this.fakeRowHeight<=d+this.fakeRowHeight&&this._requestRecord();for(var c in this.filters)$(this.filters[c]).GridFilter("setFilterHeight",d)},setGridWidth:function(){var d=this.element,c=this.options.gridClass;this._setHeaderColumnsWidth();var b=this._setScrollCellWidth(),e=this.gridContainer.find("table."+c);this.headContainer.find("table."+c+"-head").width(e.width()+b);e.width()+b>d.width()?this.gridContainer.width(e.width()+
b):this.gridContainer.width("auto")},addPage:function(d){d&&(this.page=d);for(var c in d.rows)this.addRow(d.rows[c]);this.setGridWidth()},deleteAllFilters:function(){for(var d in this.filters)$(this.filters[d]).GridFilter("deleteFilter")}};$.widget("toaUi.LogGrid",widget);(function(d){d.controllers.LogViewer=d.define(d.Controller,function(){this.limit=20;this.firstLimit=14;this.offset=0;this.filters={};this._create.apply(this,arguments)},{toString:function(){return this.sandbox.name||"Log controller"},_create:function(b){this.sandbox=b;this.logDiv=$("<div/>");this.sandbox.bind("log.quota.show log.quotaNew.show log.closeSchedule.show log.closeScheduleNew.show log.resource.show log.session.show",this.showLog,this)},showLog:function(b,d){this.logDiv.appendTo($(_DATA.dispatcher_container));
this.logDiv.LogDialog();var e=c.getInstance(d.logType);e.init(this.sandbox);var k=e.getParameters(d),g=e.toString(),l=d.parameters;this.logDiv.LogDialog("setTitle",e.getTitle());this.logDiv.LogDialog("setPanelText",e.getLabel(l));this.logDiv.LogDialog("setExportLinkTitle",e.getExportLinkTitle());this.logDiv.LogDialog("setWidth",e.dialogWidth);this.setNewOffset(0,!0);if(e=e.getFilters(l.filters,this.filters[g]))this.filters[g]={},this.filters[g].filterVals=e;this.isOldQuotaMenuVisible=null;this.createTable(k,
g);this.setEvents(k,g)},setNewOffset:function(b,c){this.offset=c?b:this.offset+b},createTable:function(b,c){var e=this,k={};e.isOldQuotaMenuVisible=b.isOldQuotaMenuVisible;$.extend(k,b,{limit:e.limit,offset:e.offset,filters:e.filters[c]});d.app.trigger("global.data.get",{controller:"LogViewer",method:"initTable",params:{params:k,logType:c},responseHandler:function(b,d){e.setNewOffset(e.limit,!0);!0==e.isOldQuotaMenuVisible?e.logDiv.LogDialog("setTabs",c):e.logDiv.LogDialog("clearTabs");e.logDiv.LogDialog("setTable",
d.initData.cols,d.initData.rows,e.offset,e.filters[c]);e.logDiv.LogDialog("open")}})},setEvents:function(b,c){var d=this;d.logDiv.unbind();d.logDiv.bind("clickExport",function(){d.exportData(b,c)});d.logDiv.bind("clickByTimeSlots",function(){d.sandbox.trigger("log.closeScheduleNew.show",{parameters:{bucketId:b.bucketId,bucketName:b.bucketName,datesRange:b.datesRange,datesRangeLabel:b.datesRangeLabel,isOldQuotaMenuVisible:d.isOldQuotaMenuVisible,viewType:b.viewType,filters:{time_slot_id:"",category_id:""}},
logType:"closeScheduleHistory"})});d.logDiv.bind("clickByTimeIntervals",function(){d.sandbox.trigger("log.closeScheduleNew.show",{parameters:{bucketId:b.bucketId,bucketName:b.bucketName,datesRange:b.datesRange,datesRangeLabel:b.datesRangeLabel,isOldQuotaMenuVisible:d.isOldQuotaMenuVisible,viewType:b.viewType,filters:{time_slot_id:"",category_id:""}},logType:"closeScheduleNewHistory"})});d.logDiv.bind("showMoreRecordsDialog",function(){d.getAdditionalRecords(b,c)});d.logDiv.bind("sortFilterChangeDialog",
function(e,k){d.setNewOffset(0,!0);d.filters[c]=k;d.createTable(b,c)})},exportData:function(b,c){$.extend(b,{filters:this.filters[c]});var d=$.param(b);post({params:d,logType:c,controller:"LogViewer",method:"exportData"})},getAdditionalRecords:function(b,c){var e=this,k={};$.extend(k,b,{limit:e.limit,offset:e.offset,filters:e.filters[c]});d.app.trigger("global.data.get",{controller:"LogViewer",method:"getPart",params:{params:k,logType:c},responseHandler:function(b,c){e.setNewOffset(e.limit);e.logDiv.LogDialog("addTableRows",
c.additionalRecords.rows,e.offset)}})}});var c={getInstance:function(c){switch(c){case "quotaHistory":return b;case "quotaNewHistory":return e;case "closeScheduleHistory":return k;case "closeScheduleNewHistory":return l;case "resourceHistory":return g;case "sessionList":return n}}},b={sandbox:null,dialogWidth:1100,bucketName:"",toString:function(){return"QuotaLog"},init:function(b){this.sandbox=b},getTitle:function(){return h(17990).replace("{NAME}",hs(this.bucketName))},getExportLinkTitle:function(){return h(21370)},
getLabel:function(b){return h(17988).replace("{DATE}",b.datesRangeLabel)},getParameters:function(b){b=b.parameters;this.bucketName=b.bucketName;var c=[],d;for(d in b.datesRange)c.push(b.datesRange[d].v);d={};$.extend(d,b,{dates:c});return d},getFilters:function(b,c){var d={},e;for(e in b)""!==b[e]&&(d[e]=[b[e]]);return $.isEmptyObject(d)?!1:d}},e={sandbox:null,dialogWidth:1100,bucketName:"",toString:function(){return"QuotaNewLog"},init:function(b){this.sandbox=b},getTitle:function(){return h(17990).replace("{NAME}",
hs(this.bucketName))},getExportLinkTitle:function(){return h(21370)},getLabel:function(b){return h(17988).replace("{DATE}",b.datesRangeLabel)},getParameters:function(b){b=b.parameters;this.bucketName=b.bucketName;var c=[],d;for(d in b.datesRange)c.push(b.datesRange[d].v);d={};$.extend(d,b,{dates:c});return d},getFilters:function(b,c){var d={},e;for(e in b)""!==b[e]&&(d[e]=[b[e]]);return $.isEmptyObject(d)?!1:d}},g={sandbox:null,resourcePid:null,toString:function(){return"ResourceLog"},init:function(b){this.sandbox=
b},getTitle:function(){var b=d.ResourcesTree.getResource(this.resourcePid).getName();return h(17986).replace("{NAME}",hs(b))},getExportLinkTitle:function(){return h(12015)},getLabel:function(b){return""},getParameters:function(b){var c=b.parameters;this.resourcePid=b.pid;if($.isEmptyObject(c))return{resourceId:b.pid,layout:b.context_layout,label:b.action};$.extend(c,{resourceId:b.pid,layout:b.context_layout,label:b.action});return c},getFilters:function(b,c){return $.isEmptyObject(c)||"*"===c.filterVals.time?
{time:["1"]}:!1}},k={sandbox:null,bucketName:"",toString:function(){return"QuotaCloseScheduleLog"},init:function(b){this.sandbox=b},getTitle:function(){return h(17989).replace("{NAME}",hs(this.bucketName))},getExportLinkTitle:function(){return h(21370)},getLabel:function(b){return h(17987).replace("{DATE}",b.datesRangeLabel)},getParameters:function(b){b=b.parameters;this.bucketName=b.bucketName;var c=[],d;for(d in b.datesRange)c.push(b.datesRange[d].v);d={};$.extend(d,b,{dates:c});return d},getFilters:function(b,
c){var d={},e;for(e in b)""!==b[e]&&(d[e]=[b[e]]);return $.isEmptyObject(d)?!1:d}},l={sandbox:null,bucketName:"",toString:function(){return"QuotaCloseScheduleNewLog"},init:function(b){this.sandbox=b},getTitle:function(){return h(17989).replace("{NAME}",hs(this.bucketName))},getExportLinkTitle:function(){return h(21370)},getLabel:function(b){return h(17987).replace("{DATE}",b.datesRangeLabel)},getParameters:function(b){b=b.parameters;this.bucketName=b.bucketName;var c=[],d;for(d in b.datesRange)c.push(b.datesRange[d].v);
d={};$.extend(d,b,{dates:c});return d},getFilters:function(b,c){var d={},e;for(e in b)""!==b[e]&&(d[e]=[b[e]]);return $.isEmptyObject(d)?!1:d}},n={sandbox:null,dialogWidth:900,bucketName:"",toString:function(){return"SessionList"},init:function(b){this.sandbox=b},getTitle:function(){return h(11865)},getExportLinkTitle:function(){return h(12015)},getLabel:function(b){return h(11866)},getParameters:function(b){return b.parameters},getFilters:function(b,c){return!1}}})(toa);(function(d){var c=d.models.ObservableModel;d.ns("toa.models.quotaSettings.BaseModel",d.define(c,function(b){c.apply(this,arguments)},{subscribeOnChild:function(b){b.addListener("all",function(){this.notify.apply(this,arguments)},this)},toJSON:function(){var b=c.prototype.toJSON.apply(this,arguments);this.idField in this.attributes||delete b[this.idField];return b}}))})(toa);(function(d){d.ns("toa.views.quotaSettings.BaseView",d.define(null,function(c){this.options=c||{};this.model=this.options.model;this.collectionModel=this.options.collectionModel;this._tpl=new d.Template(this.template)},$.extend({},d.mixins.EventEmitter,{template:"",regions:{},events:{},tag:"",render:function(c,b){b||c.empty();var d=$(this.getHtml());this._container=c;this._$el=0<d.length?d:c;c.append(d);this.initEvents();return this},getData:function(){return this.model&&this.model.toJSON()||{}},
getHtml:function(){return this._tpl.apply(this.getData())},initEvents:function(){$.each(this.events,function(c,b){var d=this._$el,g=c.split(" ");if(1!==g.length&&2!==g.length||!g[0].length)throw Error("Incorrect description of event selector ("+c+")");var k=b;"string"===typeof b&&(k=this[b]);if(!k||"function"!==typeof k)throw Error('Incorrect event handler for selector "'+c+'"');2===g.length&&(d=g[1],d=this._$el.find(d).addBack().filter(d));d.on(g[0],k.bind(this))}.bind(this))},showRegion:function(c,
b){var d=this._container.find(this.regions[c]).first();b.render(d)},hide:function(){this._$el.hide()},show:function(){this._$el.show()},_notifyOnChild:function(c,b){var d=Array.prototype.slice.call(arguments);d[0]=b;d[1]=c;this.notify.apply(this,d)},_subscribeChildView:function(c){c.addListener("all",$.proxy(this._notifyOnChild,this,c))},destroy:function(){$.isEmptyObject(this._childViews)||($.each(this._childViews,function(b,c){c.destroy.apply(c)}.bind(this)),this._childViews=[]);for(var c in this._events_uids)this.removeListener(parseInt(c));
if(this.widgets){for(c in this.widgets){try{this.widgets[c].destroy()}catch(b){}delete this.widgets[c]}this.widgets=null}this._tpl&&this._tpl.destroy();this.template&&(this.template=null);this._$el&&(this._$el.remove(),this._$el=null);this.notify("destroy",this)}})))})(toa);(function(d){var c=d.views.quotaSettings.BaseView;d.ns("toa.views.quotaSettings.BaseForm",d.define(c,function(b){c.apply(this,arguments)},{validate:function(){this.hideErrors();var b=!1;$.each(this.validators,function(c,d){var k=this._container.find(d.selector);$.each(k,function(c,e){var k=this.validateField(e,d.rules);k&&k.length&&(this.showError(e,k),b=!0)}.bind(this))}.bind(this));return!b},validateField:function(b,c){var d="";$.each(c,function(c,e){var n=this[e+"FieldValidate"];if(n)return d=
n.apply(this,[b])}.bind(this));return d},mandatoryFieldValidate:function(b){b=$(b).val();var c="";""===$.trim(b)&&(c=h(15905));return c},showError:function(b,c){var d=$("<div>").addClass("infoError").text(c);h(15905)===c&&d.addClass("errorMandatory");$(b).parent().find(":last-child").after(d);$(b).parent().parent().addClass("invalid")},hideErrors:function(){this._container.find(".infoError").remove();this._container.find(".invalid").removeClass("invalid")},hideError:function(b){b=b.target;$(b).nextAll(".infoError").remove();
$(b).parent().parent().removeClass("invalid")}}))})(toa);(function(d){var c=d.views.quotaSettings.BaseForm;d.ns("toa.views.quotaSettings.FormSections",d.define(c,function(b){c.apply(this,arguments)},{events:{"change #time_slot_based":"toggleTimeslot","change #QUOTA_FLAG_DEFINE_FOR_CATEGORY":"toggleCategory"},widgets:[],toggleTimeslot:function(){this.showIf(this.getElm("#time_slot_section"),this.isOn(this.getElm("#QUOTA_FLAG_DEFINE_FOR_TIME_SLOT"))&&this.isOn(this.getElm("#time_slot_based")));this.showIf(this.getElm("#time_based_section"),this.isOn(this.getElm("#time_slot_based")));
this.togglePercentOfDayQuota()},toggleCategory:function(){this.showIf(this.getElm("#category_section_bottom"),this.isOn(this.getElm("#QUOTA_FLAG_DEFINE_FOR_CATEGORY"))&&this.isOn(this.getElm("#QUOTA_FLAG_DEFINE_FOR_DAY"))&&this.isOn(this.getElm("#CATEGORY_QUOTA_IS_PERCENT_OF_DAY_QUOTA")))},render:function(b,e){c.prototype.render.apply(this,arguments);this.bindCapacityCategoriesWidget();this.bindTimeSlotsWidget();this.bindTimeIntervalsWidget();this._$el.on("click",".formField",d.utils.func.debounce(this.changeHandler.bind(this),
300));this.changeHandler()},togglePercentOfDayQuota:function(){this.showIf(this.getElm("#time_slot_quota_flag_defined_as_percent_of_day_quota"),this.isOn(this.getElm("#QUOTA_FLAG_DEFINE_FOR_TIME_SLOT"))&&this.isOn(this.getElm("#time_slot_based")))},bindCapacityCategoriesWidget:function(){var b=new d.widgets.MultiselectFieldDialog({input:this._$el.find("#resource_capacity_categories"),dialogTarget:$(_DATA.content),lookup:this.model.get("possible_capacity_categories"),title:d.glossary({id:6319})});
this.widgets.push(b)},bindTimeSlotsWidget:function(){var b=new d.widgets.MultiselectFieldDialog({input:this._$el.find("#resource_time_slots"),dialogTarget:$(_DATA.content),lookup:this.model.get("possible_time_slots"),title:d.glossary({id:6318})});this.widgets.push(b)},bindTimeIntervalsWidget:function(){var b=new d.widgets.TimeIntervalsEditor(this.getElm("#time_intervals"),{title:h(18050),intervals:this.model.get("time_intervals",""),isReadOnlyMode:2>this.model.get("access",0),default_intervals:this.model.get("defaultTimeIntervals",
"all")});this.widgets.push(b)},getElm:function(b){return this._$el.find(b)},getElmRow:function(b){return this.getElm(b).closest("tr")},getElmSectionLine:function(b){return this.getElm(b).closest("div.sectionLine")},changeHandler:function(){this.removeGeneralError();"view_booking"===_DATA.page_label?(this.setOn(this.getElm("#QUOTA_FLAG_USE_DIRECT_ASSIGNMENT")),this.hideIf(this.getElm("#QUOTA_FLAG_USE_DIRECT_ASSIGNMENT"),this.isOn(this.getElm("#QUOTA_FLAG_USE_DIRECT_ASSIGNMENT"))),this.hideIf(this.getElm("#quota_management_functionality"),
this.isOn(this.getElm("#QUOTA_FLAG_USE_DIRECT_ASSIGNMENT")))):($("#quota_toolbar").removeClass("toa-hidden"),$("#configuration").removeClass("toa-hidden"));this.showIf(this.getElm("#time_slot_section"),this.isOn(this.getElm("#QUOTA_FLAG_DEFINE_FOR_TIME_SLOT")));this.showIf(this.getElm("#time_based_section"),this.isOn(this.getElm("#time_slot_based")));this.showIf(this.getElm("#category_section_bottom"),this.isOn(this.getElm("#QUOTA_FLAG_DEFINE_FOR_CATEGORY"))&&this.isOn(this.getElm("#QUOTA_FLAG_DEFINE_FOR_DAY"))&&
this.isOn(this.getElm("#CATEGORY_QUOTA_IS_PERCENT_OF_DAY_QUOTA")));this.togglePercentOfDayQuota();this.showIf(this.getElmSectionLine("#TIME_SLOT_QUOTA_FLAG_NORMALIZE_PERCENTS"),this.isOn(this.getElm("#TIME_SLOT_QUOTA_FLAG_DEFINED_AS_PERCENT_OF_DAY_QUOTA")));var b=this.isOn(this.getElm("#CATEGORY_QUOTA_IS_PERCENT_OF_DAY_QUOTA"))&&this.isOn(this.getElm("#time_slot_based"));this.showIf(this.getElmSectionLine("#CATEGORY_QUOTA_FLAG_AUTOPOPULATE_QUOTA"),b);this.showIf(this.getElm("#historical_data_group"),
b&&this.isOn(this.getElm("#CATEGORY_QUOTA_FLAG_AUTOPOPULATE_QUOTA")));this.showIf(this.getElm("#historical_data_period"),b&&this.isOn(this.getElm("#CATEGORY_QUOTA_FLAG_AUTOPOPULATE_QUOTA")));this.showIf(this.getElmSectionLine("#CATEGORY_QUOTA_FLAG_NORMALIZE_PERCENTS"),b);this.showIf(this.getElm("#time_slot_based_quota_section"),this.isOn(this.getElm("#time_slot_based")));this.showIf(this.getElm("#quota_definition_level"),this.isOn(this.getElm("#time_slot_based")));this.showIf(this.getElm("#booking_intervals"),
this.isOn(this.getElm("#booking_interval_based"))&&this.isOff(this.getElm("#QUOTA_FLAG_USE_DIRECT_ASSIGNMENT")));this.showIf(this.getElm("#allow_limiting_capacity"),this.isOff(this.getElm("#time_slot_based")));this.showIf(this.getElm("#day_quota_is_calculated_based_plans_after_next_days"),this.isOff(this.getElm("#time_slot_based")));this.showIf(this.getElm("#day_quota_is_calculated_based_plans"),this.isOff(this.getElm("#time_slot_based")));this.showIf(this.getElm("#manage_quota_notice"),this.isOn(this.getElm("#CATEGORY_QUOTA_FLAG_QUOTA_TIMEINTERVALS_ENABLED")));
this.enableIf(this.getElm("#day_quota_exclude_other_activities"),this.isOff(this.getElm("#DAY_QUOTA_FLAG_DEFINED_IN_MINUTES")),!0);this.enableIf(this.getElm("#time_slot_based"),this.isOff(this.getElm("#QUOTA_FLAG_USE_DIRECT_ASSIGNMENT")),!1);this.enableIf(this.getElm("#booking_interval_based"),this.isOff(this.getElm("#QUOTA_FLAG_USE_DIRECT_ASSIGNMENT")),!1);this.showIf(this.getElm("#capacity_management"),this.isOff(this.getElm("#QUOTA_FLAG_USE_DIRECT_ASSIGNMENT")));this.hideIf($("#quota_toolbar"),
this.isOn(this.getElm("#QUOTA_FLAG_USE_DIRECT_ASSIGNMENT")));this.hideIf($(".headerResponsiveMenuOptions"),this.isOn(this.getElm("#QUOTA_FLAG_USE_DIRECT_ASSIGNMENT")));this.showIf($("#manage_quota_as"),this.isOff(this.getElm("#QUOTA_FLAG_USE_DIRECT_ASSIGNMENT")));this.enableIf($("#headerResponsiveMenu"),this.isOff(this.getElm("#QUOTA_FLAG_USE_DIRECT_ASSIGNMENT")));this.hideIf($("#configuration"),this.isOn(this.getElm("#QUOTA_FLAG_USE_DIRECT_ASSIGNMENT")));this.showIf(this.getElm("#quota_management"),
this.isOff(this.getElm("#QUOTA_FLAG_USE_DIRECT_ASSIGNMENT")));this.showIf(this.getElm("#allow_to_close_booking"),this.isOff(this.getElm("#QUOTA_FLAG_USE_DIRECT_ASSIGNMENT")));this.enableIf(this.getElm("#time_slot_quota_exclude_other_activities"),this.isOn(this.getElm("#TIME_SLOT_QUOTA_FLAG_DEFINED_AS_PERCENT_OF_CAPACITY")),!0);this.enableIf(this.getElm("#switch_to_plans_days"),this.isOn(this.getElm("#DAY_QUOTA_IS_CALCULATED_BASED_PLANS_AFTER_NEXT_N_DAYS")),!0);this.enableIf(this.getElm("#CATEGORY_QUOTA_FLAG_QUOTA_TIMEINTERVALS_ENABLED"),
this.isOn(this.getElm("#DAY_QUOTA_IS_CALCULATED_BASED_PLANS_AFTER_NEXT_N_DAYS"))||this.isOn(this.getElm("#DAY_QUOTA_IS_CALCULATED_BASED_PLANS")),!0);this.showIf(this.getElm("#time_slot_based_quota_section"),this.isOff(this.getElm("#DAY_QUOTA_FLAG_DEFINED_IN_MINUTES"))&&this.isOn(this.getElm("#time_slot_based"))&&this.setOn(this.getElm("#DAY_QUOTA_IS_PERCENT_OF_CAPACITY")))},isOn:function(b){return b.is(":checked")},isOff:function(b){return!this.isOn(b)},setOn:function(b){b.attr("checked","checked")},
setOff:function(b){b.removeAttr("checked")},enableIf:function(b,c,d){!0===c?b.removeAttr("disabled"):(b.attr("disabled","disabled"),!0===d&&b.removeAttr("checked"))},showIf:function(b,c){!0===c?(b.removeClass("toa-hidden"),setTimeout(function(){b.removeClass("toa-animated-hidden")},1)):(b.addClass("toa-animated-hidden"),setTimeout(function(){b.hasClass("toa-animated-hidden")&&b.addClass("toa-hidden")},300))},hideIf:function(b,c){this.showIf(b,!c)},getFormData:function(){var b={};$.each(this.getElm("input.formField:checked"),
function(c,d){var k=$(d);b[k.attr("name")]=k.val()});b.resource_time_slots=this.getElm("#resource_time_slots").val();b.resource_capacity_categories=this.getElm("#resource_capacity_categories").val();b.time_intervals=this.getElm("#time_intervals").val();b.time_intervals=this.getElm("#time_intervals").val();b.PLANNED_CAPACITY_IS_MANDAYS_ENABLED=this.getElm("#PLANNED_CAPACITY_IS_MANDAYS_ENABLED").val();b.CATEGORY_QUOTA_FLAG_QUOTA_TIMEINTERVALS_ENABLED=this.getElm("#CATEGORY_QUOTA_FLAG_QUOTA_TIMEINTERVALS_ENABLED").is(":checked")?
1:0;b.switch_to_plans_days=this.getElm("#switch_to_plans_days").val();return b},showGeneralError:function(b){this.removeGeneralError();b=(new d.Template(this.generalErrorTemplate)).apply({errorMessage:b});$(b).insertAfter("#time_slot_based_quota_section")},removeGeneralError:function(){this.getElm("#time_slot_based_quota_section").next(".errorLine").remove()},inlineErrorTemplate:'<tr class="sectionBlockLine errorLine"><td></td><td><div class="error"><%- errorMessage %></div></td></tr>',generalErrorTemplate:'<div class="errorLine" style="margin-left:34px;"><div class="error"><%- errorMessage %></div></div>',
template:'<ul class="listing"><li><h1><%= h(18207/* Booking*/) %></h1><div class="body"><table class="generalInfo" cellpadding="0" cellspacing="0"><tr><td class="infoMandatory"></td><% elmIdUse = elmNameUse = \'QUOTA_FLAG_USE_DIRECT_ASSIGNMENT\'; %><% elmUseChecked = (general_settings[elmNameUse] !== -1 ? \'checked="checked"\' : \'\'); %><td colspan="2"><div><input type="radio" value="1" aria-label="<%- elmIdUse %>" class="formField quotaDirectInput" id="<%- elmIdUse %>" name="<%- elmNameUse %>" <%- elmUseChecked %> /><label class="quotaDirectInfoLabel" for="<%- elmIdUse %>"><%= h(18236/* Use Direct assignment */) %></label></div><br /></td></tr><tr id="quota_management_functionality"><td class="infoMandatory"></td><% elmId = elmName = \'QUOTA_FLAG_DISABLED\'; %><% elmUseChecked = (general_settings[elmNameUse] === -1 ? \'checked="checked"\' : \'\'); %><% elmTimeChecked = (general_settings.closing_level[elmName] !== -1 ? \'checked="checked"\' : \'\'); %><% elmBookingChecked = ((elmTimeChecked == \'\') ? \'checked="checked"\' : \'\'); %><td colspan="2"><div><input type="radio" value="0" aria-label="<%- elmId %>" class="formField quotaDirectInput" id="use_quota_management" name="<%- elmNameUse %>" <%- elmUseChecked %> /><label class="quotaDirectInfoLabel" for="use_quota_management"><%= h(18214/* Use Quota management */) %></label></div><table cellpadding="0" cellspacing="0" border="0" style="width:100%; margin-left:20px;" id="manage_quota_as" class="toa-hidden"><tr class="sectionBlockLine"><td><input type="radio" id="booking_interval_based" value="" class="formField" name="<%- elmName %>" <%- elmBookingChecked %> /></td><td><div style="margin-top: 10px;"><label for="booking_interval_based"><%= h(18208/* Booking interval based */) %></label></div><div class="notice"><%= h(18209/* Recommended in case of overlapping time slots or significant variety of work duration */) %></div></td></tr><tr class="sectionBlockLine"><td><input type="radio" value="<%- elmId %>" class="formField" id="time_slot_based" name="<%- elmName %>" <%- elmTimeChecked %> /></td><td><div style="margin-top: 10px;"><label for="time_slot_based"><%= h(18210/* Time slot based */) %></label></div><div class="notice"><%= h(18211/* Recommended in case of wide non-overlapping time slots with short duration work */) %></div></td></tr></table></td></tr><tr class="toa-hidden" id="booking_intervals"><td class="infoMandatory"></td><td class="infoLabel" colspan="2"><div style="margin-top: 10px;"><label for="time_intervals"><%= h(18050/* Booking intervals */) %></label></div><div class="notice"><%= h(20474/* This value is used to show Booking status. If no values are defined, the default Capacity intervals configured on Business rules level are used. */) %></div><input type="hidden" id="time_intervals" data-access="1" value="<%- time_intervals %>" /></td></tr><tr><td class="infoMandatory"></td><td class="infoLabel"><label for="resource_time_slots"><%= h(18055/* Available time slots */) %></label></td><td class="infoValue"><table cellpadding="3" cellspacing="1" border="0" style="width:100%; margin-top:20px; max-width: 300px;"><tr><td style="border: 1px solid #eee; height:24px;padding-right:3px;padding-bottom: 0;"><% var timeslotValues = JSON.stringify(resource_time_slots); %><input type="hidden" id="resource_time_slots" data-access="1" value="<%- timeslotValues %>"></td></tr></table></td></tr><tr id="allow_to_close_booking" class="toa-hidden"><td class="infoMandatory"></td><% elmId = elmName = \'ALLOW_TO_CLOSE_BOOKING_ON_WORK_ZONE_LEVEL\'; %><% elmChecked = (general_settings.closing_level[elmName] !== -1 ? \'checked="checked"\' : \'\'); %><td colspan="2"><div style="padding: 10px 0; width: 30px; float:left;"><input type="checkbox" value="1" class="formField" id="<%- elmId %>" name="<%- elmName %>" <%- elmChecked %> /></div><div style="font-weight: bold;padding: 12px 0;"><label for="<%- elmId %>"><%= h(18052/* Allow closing booking on work zone level */) %></label></div></td></tr><tr><td class="infoMandatory"></td><% elmId = elmName = \'DAY_QUOTA_FLAG_SHOW_BOOKING_RECOMMENDATIONS\'; %><% elmChecked = (general_settings[elmName] !== -1 ? \'checked="checked"\' : \'\'); %><td colspan="2"><div style="padding: 10px 0; width: 30px; float:left;"><input type="checkbox" aria-label="<%- elmName %>" class="formField" value="1" id="<%- elmId %>" name="<%- elmName %>" <%- elmChecked %> /></div><div style="font-weight: bold;padding: 12px 0;"><label for="<%- elmId %>"><%= h(226558 /* Show recommendations in activity booking screen */) %></label></div></td></tr></table></div><div id="capacity_management" class="toa-hidden"><h1><%= h(18200/* Capacity management */) %></h1><div class="body" style="margin-top:15px; margin-bottom:15px;"><table class="generalInfo" cellpadding="0" cellspacing="0"><tr><td class="infoMandatory"></td><td class="infoLabel"><%= h(18061/* Capacity category */) %></td><td class="infoValue"><table cellpadding="3" cellspacing="1" border="0" style="width:100%; max-width: 300px;"><tr><td style="border: 1px solid #eee; height:24px;padding-right:3px;padding-bottom: 0;"><% var capacityCategoryValues = JSON.stringify(resource_capacity_categories); %><% var capacityCategoryAccess = \'field_resource\' === resourceRole ? 0 : 1; %><input type="hidden" id="resource_capacity_categories" data-access="<%- capacityCategoryAccess %>" value="<%- capacityCategoryValues %>"></td></tr></table></td></tr><tr><% elmName = \'PLANNED_CAPACITY_IS_MANDAYS_ENABLED\'; %><td class="infoMandatory"></td><td class="infoLabel"><div style="margin-top: 10px;"><label for="<%= elmName %>"><%= h(18201/* Unit of working time plans */) %></label></div></td><td class="infoValue" ><% selectedManHours = !capacity_settings[elmName] ? \'selected\' : null; %><% selectedScheduled = capacity_settings[elmName] ? \'selected\' : null; %><select id="<%= elmName %>" name="<%= elmName %>" style="margin-top:13px; border: 1px solid #eee; height: 24px;padding-right: 3px;padding-bottom: 0; background:#fff;color: #333;"><option <%= selectedManHours %> value="man_hours"><%= quota_uom %></option><option <%= selectedScheduled %> value="scheduled"><%= h(18213/* resources */) %></option></select></td></tr><tr><% elmId = elmName = \'DAY_QUOTA_FLAG_INCLUDE_START_TRAVEL\'; %><% elmChecked = (general_settings[elmName] !== -1 ? \'checked="checked"\' : \'\'); %><td class="infoMandatory"></td><td colspan="2"><div style="padding: 10px 0; width: 30px; float:left;"><input type="checkbox" aria-label="<%- elmName %>" class="formField" value="1" id="<%- elmId %>" name="<%- elmName %>" <%- elmChecked %> /></div><div style="font-weight: bold;padding: 12px 0;"><label for="<%- elmId %>"><%= h(18234/* Start of day travel time is included in the Used time */) %></label></div></td></tr><tr><% elmId = elmName = \'DAY_QUOTA_FLAG_INCLUDE_FINAL_TRAVEL\'; %><% elmChecked = (general_settings[elmName] !== -1 ? \'checked="checked"\' : \'\'); %><td class="infoMandatory"></td><td colspan="2"><div style="padding: 10px 0; width: 30px; float:left;"><input type="checkbox" aria-label="<%- elmName %>" class="formField" value="1" id="<%- elmId %>" name="<%- elmName %>" <%- elmChecked %> /></div><div style="font-weight: bold;padding: 12px 0;"><label for="<%- elmId %>"><%= h(18235/* End of day travel time is included in the Used time */) %></label></div></td></tr></table></div></li><li><div id="quota_management" class="toa-hidden"><h1><%= h(18202/* Quota management */) %></h1><div class="body"><table class="generalInfo toa-hidden" id="quota_definition_level" cellpadding="0" cellspacing="0"><tr><td class="infoMandatory"></td><td class="infoLabel"><%= h(8151/* Quota Definition level */) %></td><td class="infoValue"><table><tr><% elmId = elmName = \'QUOTA_FLAG_DEFINE_FOR_DAY\'; %><% elmChecked = (general_settings.definition_level[elmName] !== -1 ? \'checked="checked"\' : \'\'); %><td><input type="checkbox" value="1" class="formField" id="<%- elmId %>" name="<%- elmName %>" <%- elmChecked %> /></td><td><label for="<%- elmId %>"><%= h(2400/* day */) %></label></td><td width="20"></td><% elmId = elmName = \'QUOTA_FLAG_DEFINE_FOR_TIME_SLOT\'; %><% elmChecked = (general_settings.definition_level[elmName] !== -1 ? \'checked="checked"\' : \'\'); %><td><input type="checkbox" value="1" class="formField" id="<%- elmId %>" name="<%- elmName %>" <%- elmChecked %>  /></td><td><label for="<%- elmId %>"><%= h(8152/* time slot */) %></label></td><td width="20"></td><% elmId = elmName = \'QUOTA_FLAG_DEFINE_FOR_CATEGORY\'; %><% elmChecked = (general_settings.definition_level[elmName] !== -1 ? \'checked="checked"\' : \'\'); %><td><input type="checkbox" value="1" class="formField" id="<%- elmId %>" name="<%- elmName %>" <%- elmChecked %> /></td><td><label for="<%- elmId %>"><%= h(18060/* capacity category */) %></label></td></tr></table></td></tr></table><div class="section" id="day_section" style="margin-left:10px; margin-top:15px;"><div class="sectionTitle"><b><%= h(18057/* Quota by day */) %></b></div><div class="sectionContent"><div class="sectionBlock" id="day_quota_flag_defined"><div class="sectionBlockContent"><% elmName = \'DAY_QUOTA_FLAG_DEFINED\'; %><table cellspacing="0" cellpadding="0" border="0" style="margin-left:20px"><tr class="sectionBlockLine toa-hidden" id="day_quota_is_calculated_based_plans_after_next_days"><% elmId = \'DAY_QUOTA_IS_CALCULATED_BASED_PLANS_AFTER_NEXT_N_DAYS\'; %><% fieldDaysName = \'switch_to_plans_days\'; %><% fieldDaysDisbled = (day_settings[elmName] !== elmId ? \'disabled\' : \'\'); %><% inp = \'<input id="switch_to_plans_days" type="number" min="1"  name="\'+fieldDaysName+\'" oninput="validity.valid || (value=null);" value="\'+bucket[fieldDaysName] +\'" \'+fieldDaysDisbled +\' class="pwi5"> \';  %><% elmChecked = (day_settings[elmName] === elmId ? \'checked="checked"\' : \'\'); %><td><input type="radio" value="<%- elmId %>" class="formField" id="<%- elmId %>" name="<%- elmName %>" <%- elmChecked %> /></td><td><label for="<%- elmId %>"><%= r(20558, {\'{NUMBER} \': inp}/* Enter quota as % of capacity available by calendar for {NUMBER} next days and switch to the plans*/) %></label></td></tr><tr class="sectionBlockLine"><% elmId = \'DAY_QUOTA_IS_PERCENT_OF_CAPACITY\'; %><% elmChecked = ((day_settings[elmName] === elmId) ? \'checked="checked"\' : \'\'); %><td><input type="radio" value="<%- elmId %>" class="formField" id="<%- elmId %>" name="<%- elmName %>" <%- elmChecked %> /></td><td><label for="<%- elmId %>"><%= h(18204/* Quota is entered as % of capacity available by calendar */) %></label></td></tr><tr class="sectionBlockLine toa-hidden" id="day_quota_is_calculated_based_plans"><% elmId = \'DAY_QUOTA_IS_CALCULATED_BASED_PLANS\'; %><% elmChecked = (day_settings[elmName] === elmId ? \'checked="checked"\' : \'\'); %><td><input type="radio" value="<%- elmId %>" class="formField" id="<%- elmId %>" name="<%- elmName %>" <%- elmChecked %> /></td><td><label for="<%- elmId %>"><%= h(20557/* Quota is entered as % of working time plans  */) %></label></td></tr><tr class="sectionBlockLine"><% elmId = \'DAY_QUOTA_FLAG_DEFINED_IN_MINUTES\'; %><% elmChecked = (day_settings[elmName] === elmId ? \'checked="checked"\' : \'\'); %><td><input type="radio" aria-label="<%- elmId %>" value="<%- elmId %>" class="formField" id="<%- elmId %>" name="<%- elmName %>" <%- elmChecked %> /></td><td><label for="<%- elmId %>"><%= h(17501/* Quota is entered in minutes */) %></label></td></tr><tr class="sectionBlockLine"  style="height:50px;"><% elmId = elmName = \'DAY_QUOTA_FLAG_EXCLUDE_OTHER_ACTIVITIES\'; %><% elmChecked = (day_settings[elmName] === elmId ? \'checked="checked"\' : \'\'); %><td colspan="2" ><div style="padding: 10px 0; width: 30px; float:left;"><input id="day_quota_exclude_other_activities" type="checkbox" aria-label="<%- elmId %>" value="<%- elmId %>"  class="formField" name="<%- elmName %>" <%- elmChecked %> /></div><div style="padding: 12px 0;"><label for="day_quota_exclude_other_activities"><%= h(18206/*Reduce quota by volume of activities not assigned to any capacity category*/) %></label></div></td></tr></table></div></div></div></div><div class="section" id="category_section" style="margin-left:10px;"><div class="sectionTitle"><b><%= h(18058/* Quota by capacity category */) %></b></div><div class="sectionContent"><div class="sectionBlock"><div class="sectionBlockContent"><% elmName = \'CATEGORY_QUOTA_FLAG_DEFINED\'; %><table cellspacing="0" cellpadding="0" border="0" style="margin-left:20px"><tr class="sectionBlockLine"><% elmId = \'CATEGORY_QUOTA_IS_PERCENT_OF_CAPACITY\'; %><% elmChecked = (capacity_settings[elmName] === elmId ? \'checked="checked"\' : \'\'); %><td><input type="radio" aria-label="<%- elmId %>" value="<%- elmId %>" class="formField" id="<%- elmId %>" name="<%- elmName %>" <%- elmChecked %> /></td><td><label for="<%- elmId %>"><%= h(17505/* Quota is entered as % of maximum capacity available in this category */) %></label></td></tr><tr class="sectionBlockLine" id="category_quota_is_percent_of_day_quota"><% elmId = \'CATEGORY_QUOTA_IS_PERCENT_OF_DAY_QUOTA\'; %><% elmChecked = (capacity_settings[elmName] === elmId ? \'checked="checked"\' : \'\'); %><td><input aria-label="<%= h(18058) %> <%= h(18051) %>" type="radio" value="<%- elmId %>" class="formField" id="<%- elmId %>" name="<%- elmName %>" <%- elmChecked %> /></td><td><label for="<%- elmId %>"><%= h(18051/* Quota is entered as % of quota defined on parent level */) %></label></td></tr><tr class="ro toa-hidden" id="category_quota_is_entered_in_minutes_read_only"><td colspan="2"><span style="font-weight:bold;" class="ro"><%= h(17501/* Quota is entered in minutes */) %></span></td></tr><tr class="sectionBlockLine"><% elmId = \'CATEGORY_QUOTA_FLAG_DEFINED_IN_MINUTES\'; %><% elmChecked = (capacity_settings[elmName] === elmId ? \'checked="checked"\' : \'\'); %><td><input aria-label="<%= h(18058) %> <%= h(17501) %>" type="radio" value="<%- elmId %>" class="formField" id="<%- elmId %>" name="<%- elmName %>" <%- elmChecked %> /></td><td><label for="<%- elmId %>"><%= h(17501/* Quota is entered in minutes */) %></label></td></tr></table></div><div class="section toa-hidden" id="category_section_bottom"><div class="sectionContent" style="margin-top:10px"><div class="sectionLine toa-hidden"><table cellspacing="0" cellpadding="0" border="0" style="margin-left:20px"><tr class="sectionBlockLine"><% elmId = elmName = \'CATEGORY_QUOTA_FLAG_AUTOPOPULATE_QUOTA\'; %><% elmChecked = (capacity_settings[elmName] !== 0 ? \'checked="checked"\' : \'\'); %><td><input type="checkbox" value="1" class="formField" id="<%- elmId %>" name="<%- elmName %>" <%- elmChecked %> /></td><td><label for="<%- elmId %>"><%= h(8172/* Estimate quota based on historical data */) %></label></td></tr></table></div><div class="sectionBlock toa-hidden" id="historical_data_group" style="margin-left:20px"><div class="sectionBlockTitle"><%= h(8173/* Historical values to be used */) %></div><div class="sectionBlockContent"><% elmName = \'CATEGORY_QUOTA_FLAG_USE\'; %><table cellspacing="0" cellpadding="0" border="0" style="margin-left:20px"><tr class="sectionBlockLine"><% elmId = \'CATEGORY_QUOTA_FLAG_USE_QUOTA_TO_CALCULATE_WEIGHT\'; %><% elmChecked = (capacity_settings[elmName] === elmId ? \'checked="checked"\' : \'\'); %><td><input type="radio" value="<%- elmId %>" class="formField" id="<%- elmId %>" name="<%- elmName %>" <%- elmChecked %> /></td><td><label for="<%- elmId %>"><%= h(8174/* Quota % */) %></label></td></tr><tr class="sectionBlockLine"><% elmId = \'CATEGORY_QUOTA_FLAG_USE_USED_TO_CALCULATE_WEIGHT\'; %><% elmChecked = (capacity_settings[elmName] === elmId ? \'checked="checked"\' : \'\'); %><td><input type="radio" value="<%- elmId %>" class="formField" id="<%- elmId %>" name="<%- elmName %>" <%- elmChecked %> /></td><td><label for="<%- elmId %>"><%= h(8175/* Used quota % */) %></label></td></tr></table></div></div><div class="sectionBlock toa-hidden" id="historical_data_period" style="margin-left:20px"><div class="sectionBlockTitle"><%= h(8176/* Process historical data (same weekdays) for period of */) %></div><div class="sectionBlockContent"><% elmName = \'historical_data_period\'; %><table cellspacing="0" cellpadding="0" border="0" style="margin-left:20px"><tr class="sectionBlockLine"><% elmId = \'week\'; %><% elmChecked = (capacity_settings[elmName] === elmId ? \'checked="checked"\' : \'\'); %><td><input type="radio" value="<%- elmId %>" class="formField" id="<%- elmId %>" name="<%- elmName %>" <%- elmChecked %> /></td><td><label for="<%- elmId %>"><%= h(8177/* one week */) %></label></td></tr><tr class="sectionBlockLine"><% elmId = \'month\'; %><% elmChecked = (capacity_settings[elmName] === elmId ? \'checked="checked"\' : \'\'); %><td><input type="radio" value="<%- elmId %>" class="formField" id="<%- elmId %>" name="<%- elmName %>" <%- elmChecked %> /></td><td><label for="<%- elmId %>"><%= h(8178/* one month */) %></label></td></tr><tr class="sectionBlockLine"><% elmId = \'two months\'; %><% elmChecked = (capacity_settings[elmName] === elmId ? \'checked="checked"\' : \'\'); %><td><input type="radio" value="<%- elmId %>" class="formField" id="<%- elmId %>" name="<%- elmName %>" <%- elmChecked %> /></td><td><label for="<%- elmId %>"><%= h(8179/* two months */) %></label></td></tr></table></div></div><div class="sectionLine toa-hidden"><table cellspacing="0" cellpadding="0" border="0" style="margin-left:20px"><tr class="sectionBlockLine"><% elmId = elmName = \'CATEGORY_QUOTA_FLAG_NORMALIZE_PERCENTS\'; %><% elmChecked = (capacity_settings[elmName] !== 0 ? \'checked="checked"\' : \'\'); %><td><input type="checkbox" aria-label="<%- elmId %>" value="1" class="formField" id="<%- elmId %>" name="<%- elmName %>" <%- elmChecked %> /></td><td><label for="<%- elmId %>"><%= h(8168/* Automatically adjust \'% Quota\' values to keep their total equal to 100% */) %></label></td></tr></table></div></div></div></div></div></div><div class="section toa-hidden" id="allow_limiting_capacity"><div class="body"><table class="generalInfo" cellspacing="0" cellpadding="0" border="0" style="margin-left:30px"><tr class="sectionBlockLine"  style="height:50px;"><% elmId = \'CATEGORY_QUOTA_FLAG_QUOTA_TIMEINTERVALS_ENABLED\'; %><% elmChecked = (capacity_settings[elmId] == 1) ? \'checked="checked"\' : \'\'; %><td class="infoLabel" colspan="2" ><div style="padding: 10px 0; width: 30px; float:left;"><input id="CATEGORY_QUOTA_FLAG_QUOTA_TIMEINTERVALS_ENABLED" type="checkbox" value="<%- elmId %>"  class="formField" id="<%- elmId %>" name="<%- elmId %>" <%- elmChecked %> /></div><div style="padding: 12px 0;"><label for="<%- elmId %>"><%= h(20559/* Manage quota on booking interval level*/) %></label></div><div id="manage_quota_notice" class="notice toa-hidden"><%= h(20560/* Please ensure that limits are entered for all the booking intervals and capacity categories. Missing values are interpreted as "zero quota limit", ie booking is prohibited for those categories and intervals */) %></div></td></tr></table></div></div></div><div class="section toa-hidden" id="time_slot_based_quota_section" ><div class="body"><div class="section toa-hidden" id="time_slot_section" style="margin-left:10px;"><div class="sectionTitle"><b><%= h(18059/* Quota by time slot */) %></b></div><div class="sectionContent"><div class="sectionBlock"><div class="sectionBlockContent"><% elmName = \'TIME_SLOT_QUOTA_FLAG_DEFINED\'; %><table cellspacing="0" cellpadding="0" border="0" style="margin-left:20px"><tr class="ro toa-hidden" id="time_slot_quota_is_entered_in_minutes_read_only"><td colspan="2"><span style="font-weight:bold;" class="ro"><%= h(17501/* Quota is entered in minutes */) %></span></td></tr><tr class="sectionBlockLine"><% elmId = \'TIME_SLOT_QUOTA_FLAG_DEFINED_AS_PERCENT_OF_CAPACITY\'; %><% elmChecked =  ((time_slot_settings[elmName] === elmId || time_slot_settings[elmName] === \'TIME_SLOT_QUOTA_FLAG_EXCLUDE_OTHER_ACTIVITIES\') ? \'checked="checked"\' : \'\'); %><td><input type="radio" value="<%- elmId %>" class="formField" id="<%- elmId %>" name="<%- elmName %>" <%- elmChecked %> /></td><td><label for="<%- elmId %>"><%= h(18056/* Quota is entered as % of capacity available by calendar */) %></label></td></tr><tr class="sectionBlockLine toa-hidden" id="time_slot_quota_flag_defined_as_percent_of_day_quota"><% elmId = \'TIME_SLOT_QUOTA_FLAG_DEFINED_AS_PERCENT_OF_DAY_QUOTA\'; %><% elmChecked = (time_slot_settings[elmName] === elmId ? \'checked="checked"\' : \'\'); %><td><input type="radio" aria-label="<%- elmId %>" value="<%- elmId %>" class="formField" id="<%- elmId %>" name="<%- elmName %>" <%- elmChecked %> /></td><td><label for="<%- elmId %>"><%= h(18051/* Quota is entered as % of quota defined on parent level */) %></label></td></tr><tr class="sectionBlockLine"><% elmId = \'TIME_SLOT_QUOTA_FLAG_DEFINED_IN_MINUTES\'; %><% elmChecked = (time_slot_settings[elmName] === elmId ? \'checked="checked"\' : \'\'); %><td><input type="radio" aria-label="<%- elmId %>" value="<%- elmId %>" class="formField" id="<%- elmId %>" name="<%- elmName %>" <%- elmChecked %> /></td><td><label for="<%- elmId %>"><%= h(17501/* Quota is entered in minutes */) %></label></td></tr><tr class="sectionBlockLine"  style="height:50px;"><% elmId = \'TIME_SLOT_QUOTA_FLAG_EXCLUDE_OTHER_ACTIVITIES\'; %><% elmChecked = (time_slot_settings[elmName] === elmId ? \'checked="checked"\' : \'\'); %><td colspan="2" ><div style="padding: 10px 0; width: 30px; float:left;"><input id="time_slot_quota_exclude_other_activities" aria-label="<%- elmId %>" type="checkbox" value="<%- elmId %>"  class="formField" id="<%- elmId %>" name="<%- elmName %>" <%- elmChecked %> /></div><div style="padding: 12px 0;"><label for="time_slot_quota_exclude_other_activities"><%= h(18048/* Reduce quota by volume of activities not assigned to any capacity category*/) %></label></div></td></tr></table></div></div></div><div class="sectionLine"><table cellspacing="0" cellpadding="0" border="0" style="margin-left:20px"><tr class="sectionBlockLine"><% elmId = elmName = \'TIME_SLOT_QUOTA_FLAG_NORMALIZE_PERCENTS\'; %><% elmChecked = (time_slot_settings[elmName] !== 0 ? \'checked="checked"\' : \'\'); %><td><input type="checkbox" value="1" aria-label="<%- elmId %>" class="formField" id="<%- elmId %>" name="<%- elmName %>" <%- elmChecked %> /></td><td><label for="<%- elmId %>"><%= h(8168/* Automatically adjust \'% Quota\' values to keep their total equal to 100% */) %></label></td></tr></table></div></div></div></div></div></li></ul>'}))})(toa);(function(d){var c=d.views.quotaSettings.BaseView;d.ns("toa.views.quotaSettings.FormButtons",d.define(c,function(){c.apply(this,arguments)},{events:{"click .btnSaveForm":"onClickSave"},template:'<table class="footerTable"><tr><td><div class="leftSideBar"></div></td><td width="100%"><div class="info"></div></td><td><div class="formButtons"><button type="submit" aria-label="<%= h(12) /*Save*/ %>_'+generate_id()+' " class="toa-button toa-button-active pullRight btnSaveForm"><%= h(12) /*Save*/ %></button></div></td></tr></table>',
showNotification:function(b){if(!this._container)return!1;this._container.find(".info").text(b)},clearNotification:function(){this.showNotification("")},setBtnDisabled:function(b,c){if(!this._container)return!1;this._container.find(".btn"+b+"Form").toggleClass("toa-button-disable",c)},setBtnVisible:function(b,c){if(!this._container)return!1;this._container.find(".btn"+b+"Form").toggleClass("hide",!c)},onClickSave:function(b){if($(b.target).hasClass("toa-button-disable"))return!1;this.notify("save:clicked",
this)}}))})(toa);(function(d){var c=d.views.quotaSettings.BaseView;d.ns("toa.views.quotaSettings.SettingsForm",d.define(c,function(){c.apply(this,arguments)},{events:{"click #stopUsingCapacityAreaLink":"stopUsingCapacityArea"},regions:{sections:".formSections",statusBar:".statusBar"},hideRegion:function(b){$(".formContainer").find(b).empty().hide()},showSelectBucketNotification:function(b){b?(this.hideRegion(this.regions.sections),this.hideRegion(this.regions.statusBar),$(".formContainer").find("#selectBucketNotification").show()):
($(".formContainer").find("#selectBucketNotification").hide(),$(".formContainer").find(this.regions.sections).show(),$(".formContainer").find(this.regions.statusBar).show());$(".statusBar").css({left:document.getElementById("tab4").offsetWidth+"px"})},showStopUsingCapacityAreaLink:function(){this._$el.find("#stopUsingCapacityAreaLink").removeClass("hidden")},stopUsingCapacityArea:function(b){this.notify("stopCapacityAreaClick")},template:'<div class="formContainer"><div class="formContainerInner"><div class="formContent"><div id="selectBucketNotification" class="hidden"><%= h(23115/* Please select a Capacity Area */) %></div><div id="stopUsingCapacityAreaLink" class="hidden"><%= h(23141/*Stop using as a Capacity Area*/) %></div><div class="formSections"></div><div class="statusBar"></div></div></div></div>'}))})(toa);(function(d,c){d.ns("toa.quotaSettings.ServerConnector",d.define(null,function(b,c){this._triggerFunction=b;this._controller=c},{_triggerFunction:function(){},_controller:"",request:function(b,d){var g=c.Deferred();this._triggerFunction("global.data.get",{controller:this._controller,method:b,params:d||{},responseHandler:function(b,c){c.status&&"OK"===c.status?g.resolve(c):g.reject(c.error_code||0)}.bind(this)});return g.promise()}}))})(toa,$);(function(d,c){d.ns("toa.quotaSettings.DataMapper",d.define(null,function(b){this._serverConnector=b},{_modelConstructor:function(){},_serverGetMethod:"",_serverSaveMethod:"",_serverRemoveMethod:"",_serverGetField:"",_serverIdField:"",load:function(b,d){d=d||{};this._serverIdField&&(d[this._serverIdField]=b.id);var g=c.Deferred(),k=this._serverConnector.request(this._serverGetMethod,d);k.done(function(c){c&&c[this._serverGetField]||g.reject('Field "'+this._serverGetField+'" is not available');try{this._fillModel(b,
c[this._serverGetField]),g.resolve(b)}catch(d){g.reject("Unable to fill model with given data ("+d.message+")")}}.bind(this));k.fail(function(b){g.reject(b,"Server error ("+b+") has occurred")});return g.promise()},create:function(b){var c=new this._modelConstructor;this._fillModel(c,b||{});return c},save:function(b){return this._serverConnector.request(this._serverSaveMethod,this.serialize(b))},remove:function(b){var c={};this._serverIdField&&(c[this._serverIdField]=b.id);return this._serverConnector.request(this._serverRemoveMethod,
c)},_fillModel:function(b,c){b.reset({},{silent:!0});b.set(c,{silent:!0})},serialize:function(b){return b.toJSON()}}))})(toa,$);(function(d){var c=d.quotaSettings.DataMapper;d.ns("toa.quotaSettings.dataMappers.BaseDataMapper",d.define(c,function(b){c.apply(this,arguments)},{_modelConstructor:d.models.quotaSettings.BaseModel}))})(toa);(function(d,c){var b=d.quotaSettings.DataMapper;d.ns("toa.quotaSettings.dataMappers.FormDataMapper",d.define(b,function(c){b.apply(this,arguments)},{_modelConstructor:d.models.quotaSettings.BaseModel,_serverGetMethod:"get",_serverSaveMethod:"save",_serverGetField:"quota_settings",_serverIdField:"bucketId"}))})(toa,$);(function(d){d.ns("toa.controllers.QuotaSettings",d.define(d.Controller,function(c,b){this.sandbox=c;this.pageLabel=this.sandbox.name;this.quotaPageLabel="view_quota";this.content=c.options.content;this.triggerFunction=c.trigger.bind(c);this.bucketId=this.sandbox.controller.bucketId;this.setDefaultState();this.isArea=b||!1;this.resume()},{treeTab:4,toString:function(){return"QuotaSettings screen controller"},setQuotaController:function(c){this.quotaController=c||null},resume:function(){this.initLayout();
this.initModels();this.initViews();this.showInitialViews(this.layout)},initModels:function(){var c=new d.quotaSettings.ServerConnector(this.triggerFunction,"quotasettings");new d.quotaSettings.dataMappers.BaseDataMapper(c);this.treeModel=new d.models.BucketTree;this.formMapper=new d.quotaSettings.dataMappers.FormDataMapper(c);this.formModel=this.formMapper.create();c=function(){this.formButtonsView.clearNotification()}.bind(this);this.formModel.addListener("all",c)},initViews:function(){this.settingsFormView=
new d.views.quotaSettings.SettingsForm;this.formSectionsView=new d.views.quotaSettings.FormSections({model:this.formModel});this.formButtonsView=new d.views.quotaSettings.FormButtons;this.formButtonsView.addListener("save:clicked",this.onClickSave.bind(this));this.settingsFormView.addListener("stopCapacityAreaClick",this.onStopCapacityAreaClick.bind(this))},initLayout:function(){this.content.find("#inner_content #quota_settings_container").empty();this.layout=this.content.find("#inner_content #quota_settings_container")},
showInitialViews:function(c){this.screen=$('<div id="toa-quotasettings-screen"></div>');c.append(this.screen);this.settingsFormView.render(this.screen)},showNoBucket:function(){this.settingsFormView=new d.views.quotaSettings.SettingsForm;this.settingsFormView.showSelectBucketNotification(!0);this.checkAccess()},checkAccess:function(){this.triggerFunction("global.data.get",{controller:"quotasettings",method:"getConfigurationAccess",params:{pid:this.bucketId},responseHandler:function(c,b){b&&b.status&&
b.status===this.constructor.RESPONSE_STATUS_OK&&b.access===this.constructor.ACCESS_READWRITE?this.quotaController.showAddAreaButton(!0):this.quotaController.showAddAreaButton(!1)}.bind(this)})},getQuotaSettings:function(c){c=c||!1;var b=this.formModel;b.set({id:this.bucketId},{silent:!0});return this.formMapper.load(b).done(function(){this.showQuotaSettings(b);c&&this.formButtonsView.showNotification(h(20455))}.bind(this)).fail(function(b,c){this.sandbox.error(c);this.showError(h(20452))}.bind(this))},
showQuotaSettings:function(c){var b=c.get("tree",null);c.get("bucketId",null);this.setState("tree",b);this.settingsFormView.showSelectBucketNotification(!1);this.settingsFormView.showRegion("sections",this.formSectionsView);this.settingsFormView.showRegion("statusBar",this.formButtonsView);c.get("access",null)===this.constructor.ACCESS_READWRITE?(this.setState("allowModify",!0),this.quotaController.showAddAreaButton(!0),this.isArea&&this.settingsFormView.showStopUsingCapacityAreaLink()):(this.setState("allowModify",
!1),this.quotaController.showAddAreaButton(!1),this.formSectionsView._$el.find("input").attr("disabled","disabled"),this.formSectionsView._$el.find("select").attr("disabled","disabled"),this.formSectionsView._$el.find(".editTimeIntervals").hide(),this.formSectionsView._$el.find(".ui-icon-modify").map(function(b,c){c.parentElement.style.display="none";c.parentElement.parentElement.style.opacity="0.5"}),this.formButtonsView.setBtnDisabled("Save",!0));set_indicator(0)},validateFormData:function(c){var b=
0;"0"===c.QUOTA_FLAG_USE_DIRECT_ASSIGNMENT&&""===c.QUOTA_FLAG_DISABLED&&"DAY_QUOTA_IS_CALCULATED_BASED_PLANS_AFTER_NEXT_N_DAYS"===c.DAY_QUOTA_FLAG_DEFINED&&(!1===!!parseInt(c.switch_to_plans_days,10)||1>c.switch_to_plans_days)&&(c=h(23116),this.formSectionsView.showGeneralError(c),b++);return b?!1:!0},onClickSave:function(){var c=this.formSectionsView.getFormData();!1!==this.validateFormData(c)&&this.saveForm(c).done(this.getQuotaSettings.bind(this))},saveForm:function(c){var b=$.Deferred(),d=this.formSectionsView;
this.formButtonsView.clearNotification();var g=this.formMapper.create({id:this.bucketId,quota_settings:c});this.formButtonsView.setBtnDisabled("Save",!0);this.formMapper.save(g).done(function(c){d.notify("action:save",d);b.resolve(d,!0);g.remove()}.bind(this)).fail(function(c){c=null!==c&&"undefined"!==typeof c?c:20454;c="object"===typeof c?h(c.tid,c.placeholders):h(c);this.formSectionsView.showGeneralError(c);this.formButtonsView.setBtnDisabled("Save",!1);b.reject(d,!1);g.remove()}.bind(this));return b.promise()},
onStopCapacityAreaClick:function(c){if(this.quotaController&&this.quotaController instanceof d.controllers.NewViewQuota&&this.getState("allowModify")){c=r(23142,{"{RESOURCE_NAME}":this.quotaController.bucketName});var b=new d.ui.Popup({title:h(13294),autoOpen:!0,html:c,modal:!0,buttons:[{text:h(14621),position:"left",click:function(){b.destroy()}},{text:h(12252),type:"submit",position:"right",click:function(c){this.stopUsingCapacityArea().done(function(b){this.quotaController.refreshTree();this.quotaController.showAddAreaButton(!0)}.bind(this)).fail(function(b){b=
b&&b.tid?h(b.tid):h(23143);this.showError(b)}.bind(this));b.destroy()}.bind(this)}]})}},stopUsingCapacityArea:function(){var c=$.Deferred();this.triggerFunction("global.data.get",{controller:"quotasettings",method:"stopUsingCapacityArea",params:{pid:this.bucketId},responseHandler:function(b,d){d.status&&d.status===this.constructor.RESPONSE_STATUS_OK?c.resolve(d):c.reject(d.error_code||0)}.bind(this)});return c.promise()},suspend:function(c){this.destroy()},destroy:function(){this.settingsFormView.destroy();
this.formButtonsView.destroy();this.formSectionsView.destroy();this.layout.empty()},setState:function(c,b){d.isString(c)?this.state[c]=b:d.isObject(c)?$.extend(this.state,c):!1===c&&this.setDefaultState()},getState:function(c){return this.state[c]},setDefaultState:function(){this.state=$.extend(this.state,{selectedBucketId:null,allowModify:!1,tree:null})},showError:function(c,b){c=c||h(3057);b=b||h(5651);return this.showPopup(b,c)},showPopup:function(c,b,e){c=c||"";b=b||"";var g=$.Deferred();e&&$.isArray(e)&&
e.length?$.each(e,function(b,c){if("function"===typeof c.click){var d=c.click;c.click=function(){var b=Array.prototype.slice.call(arguments);b.unshift(g);d.apply(this,b)}}}.bind(this)):e=[{text:h(445),position:"right",tpl:'<button class="popup-button toa-button"></button>',click:function(){g.reject()}}];g.always(function(){k.destroy()});var k=new d.ui.Popup({title:c,autoOpen:!0,html:b,modal:!0,onClose:function(){k.destroy();g.reject()},buttons:e});k._dom.base.id="toa-quotasettings-popup";return g}},
{ACCESS_READWRITE:2,ACCESS_READONLY:1,RESPONSE_STATUS_OK:"OK",RESPONSE_STATUS_ERROR:"ERR"}))})(toa);(function(d){var c=d.Controller;d.ns("toa.ActivitiesScreen.View",d.define(c,function(b){this.options={serverControllerName:"",view:"list",panel:"top",state:null};this.showNonScheduled=!1;c.apply(this,arguments);this.setOptions(this.sandbox.options);this.viewManager=this.options.viewManager;this.currentState=JSON.parse(JSON.stringify(this.options.state))},{toString:function(){return"ControllerWindow"},resume:function(b){if("undefined"!==typeof this.currentState.filter&&"undefined"!==typeof b.state.filter){var d=
this.currentState.filter,g=b.state.filter;"undefined"!==typeof g.recursively&&g.recursively||delete d.recursively}b.forceFilterUpdate&&(this.isFirstRequest=!0);this.currentState=$.extend(this.currentState,JSON.parse(JSON.stringify(b.state||{})));c.prototype.resume.apply(this,arguments)},suspend:function(){this.hideError();c.prototype.suspend.apply(this,arguments)},destroy:function(){this.hide();c.prototype.destroy.call(this)},updateState:function(b){$.extend(this.currentState,JSON.parse(JSON.stringify(b)));
return this},changeRatio:function(b){this.currentState.ratio=b;return this},setFilter:function(b){var c=this.viewManager.activitiesPanel.titlePanel.findChild("filterButton");c.getElement().attr("data-filter-screen","viewFilter_"+_DATA.page_label+this.options.panel);this.viewManager.activitiesPanel.titlePanel.setOption("filter",!1);""!=b.filter_content&&this.viewManager.activitiesPanel.titlePanel.setOption("filter",!0);$.isEmptyObject(b)||c.getOption("content")===b.filter_content||(c.setOption("content",
b.filter_content),c.getPopup().element.parent().addClass("viewFilter_"+_DATA.page_label+this.options.panel),b.filter_params.zoom&&(b.filter_params.zoom.ratio=this.getOption("ratio")||1),b.filter_params.position=this.options.panel,$.extend(this.viewManager.currentState.filter,filterPanelFormToValues(c.getForm())),initFilter(c.getForm(),b.filter_params))},hideFilterElements:function(b){this.viewManager.activitiesPanel.titlePanel.findChild("filterButton").getPopup().element.find(b).hide()},showFilterElements:function(b){this.viewManager.activitiesPanel.titlePanel.findChild("filterButton").getPopup().element.find(b).show()},
updateProviderId:function(b){this.viewManager.activitiesPanel.updateState({providerId:b})},updateTitle:function(b,c){this.viewManager.activitiesPanel.changeCaption(hs(b.getName()));this.viewManager.activitiesPanel.titlePanel.setOption("actions",c);return this},getSelectedResourceId:function(){var b=this.viewManager.activitiesPanel.treeState.currentlySelected;b||(b=this.viewManager.activitiesPanel.options.provider);return b},getSelectedResourceGroupId:function(){return!this.viewManager.activitiesPanel.treeState.resourceGroups||
this.viewManager.activitiesPanel.treeState.resourceGroups.selection.selectedPid?0:this.viewManager.activitiesPanel.treeState.resourceGroups.selection.groupId},getTreeRequestParameters:function(){var b=this.viewManager.activitiesPanel.treeState;return d.app.model("resourceTreeManager").retreiveTreeRequestParams(b)},showError:function(b){this.clearRefreshTimer();clearTimeout(this._refreshOnErrorTimer);this._refreshOnErrorTimer=null;this.viewManager.activitiesPanel.viewContainer.ScreenCover().ScreenCover("show",
b);b=this.settingsModel.getUser().refresh_rate_onerror;"number"==typeof b&&0<b&&(clearTimeout(this._refreshOnErrorTimer),this._refreshOnErrorTimer=setTimeout(this.refresh.bind(this),6E4*b))},hideError:function(){this._refreshOnErrorTimer&&clearTimeout(this._refreshOnErrorTimer);this.viewManager.activitiesPanel.viewContainer.ScreenCover().ScreenCover("hide")},setRefreshTimer:function(){this.clearRefreshTimer();var b=this.settingsModel.getUser().refresh_rate||0;0<b&&(this._refreshTimer=setTimeout(this.refresh.bind(this),
6E4*b))},clearRefreshTimer:function(){this._refreshTimer&&(clearTimeout(this._refreshTimer),this._refreshTimer=null)},resizeWindow:function(b){this.winResizeTimer&&clearTimeout(this.winResizeTimer);this.winResizeTimer=setTimeout(function(){this.resize(d.isUndefined(b)?!0:b);this.winResizeTimer=null}.bind(this),1)},resize:function(b){this.viewManager.activitiesPanel.adjustViewContainerSize(b)},setOptions:function(b){for(var c in b)this.setOption(c,b[c])},setOption:function(b,c){this.options[b]=c},
getOption:function(b,c){var g=this.options[b];d.isUndefined(g)&&(g=c);return g},refresh:function(){},onChange:function(){}}))})(toa);(function(){var d=toa.view.VerticalTwoPanelView,c=toa.views.routingRuns.Layout,b=toa.view.ResourceTreePanel,e=toa.helper.resourceTree.Droppable;toa.ns("toa.ActivitiesScreen.ActivitiesPanel",toa.define(null,function(b,c,d){this.options=$.extend({screenController:null,provider:0,resourceTreeSelection:{groupId:0,rootPid:0,selectedPid:0},date:"",dates:[],ratio:1,filter:null},d);this.screenController=this.options.screenController;this.position=b;this.treeState=c;this.options.maxDate=this.options.maxDate||
toa.date.formatDate("iso",this.screenController.sandbox.get("userMaxDate"));this._currentState={providerId:this.options.provider||this.options.resourceTreeSelection.selectedPid,resourceTreeSelection:this.options.resourceTreeSelection,date:this.options.date,dates:this.options.dates,previousDate:this.options.date,ratio:this.options.ratio,filter:this.options.filter||{}};this._syncedState=$.extend({},this._currentState);this._resourceTreePanelListenerUid=this._resourceGroupsListenerUid=this._resourceTreeListenerUid=
null;this.screenController.sandbox.bind("global.filter.changed",this.onFilterChange.bind(this));this.screenController.sandbox.bind("interface.durationRatio.set",function(b,c){this.position===c.position&&this.setRatio(c.ratio)}.bind(this));this.screenController.sandbox.bind("global.filter.zoomfit",function(b,c){if("time"===this.getCurrentViewName()&&this.position===c.position){var d=1<this._currentState.dates.length?this.viewManager.getViewController().multiGantt.MultiGantt("getFitRatio"):this.viewManager.getViewController().gantt.Gantt("getFitRatio");
this.setRatio(d)}}.bind(this));this.screenController.sandbox.bind("model.companySettings.reload",function(b){this.options.maxDate=toa.date.formatDate("iso",this.screenController.sandbox.get("userMaxDate"));this._showCalendar(this.getCurrentViewName())},this)},{_stateTransaction:!1,keepNonScheduled:!1,render:function(g){this.container=g;this.layout=new d(this.container,{});this.tree=new b(this.layout.firstPanel.content,{state:this.treeState,draggable:!0,withCloseButton:!0,position:this.position,screenName:SCREEN_MAPPINGS["activity_"+
this.position],groups:!0});this.treeState.selectProvider(this.options.resourceTreeSelection);this.screenController.sandbox.trigger("global.hint.assign",{elements:[this.layout.firstPanel.content],location:this.position+"ActivitiesPanel",getDate:function(){return this.tree.state.treeDate}.bind(this)});new e(this.screenController.sandbox,this.tree);this.tree.addListener("panel.hide",this.hideTree.bind(this));this.tree.addListener("panel.show",this.showTree.bind(this));this.tree.addListener("panel.filter.hide",
this.hideTreePanelFilter.bind(this));this.titlePanel=toa.view.control.create({name:"title",xtype:"PanelTitle",viewSelector:!0,screenName:SCREEN_MAPPINGS["activity_"+this.position],headerResponsive:_DATA.is_mobility_app?_DATA.page_label+this.position:"",resourceTreeButton:!1,routingPlans:!0,routingPlansWidget:new toa.views.routingRuns.widgets.RoutingPlansWidget(this.screenController.sandbox,new c(this.screenController.sandbox)),selectedDate:this.options.date,maxDate:this.options.maxDate,listeners:{beforeChangeOptionActions:function(b,
c){isMobilityApp()&&(c&&c.value||[]).forEach(function(b){this._hasDisabledForm(b)}.bind(this))}.bind(this),openTree:function(b,c){this.showTree();return!1}.bind(this),changeDate:function(b,c){this.changeDate(c.date);this._stateTransaction||this.syncState()}.bind(this),changeDates:function(b,c){this.changeDates(c);this.refresh(!this._stateTransaction)}.bind(this),onShowRoutingWidget:function(b,c){var d=c.context,e=c.btn,g=d.getOption("routingPlansWidget");if(g&&(g.updateState(this.tree.getSelectedProviderId(),
this._currentState.date),g=g.getTip()))if(g.getContent())g.remove();else{g.render(_DATA.dispatcher_container,d.element);var d=e.getBoundingClientRect(),t=d.left-$("#content-manage-container").position().left;$(g._content[0]).css({top:d.top-$(_DATA.dispatcher_container)[0].getBoundingClientRect().top+e.offsetHeight,left:t-11});toa.currentInterface!==INTERFACE.MOBILITY&&768>=$(document).width()&&(e=$(g._content[0]).find("span.before"),e.length||(e=document.createElement("span"),e.className="before",
$(e).css("left",d.left-1),$(g._content[0]).append(e)));e=g.getContent();$(e).addClass("on-activities-screen")}}.bind(this),viewChange:function(b,c){c.name==this.getCurrentViewName()?this.viewManager.refreshCurrentView():(this.switchView(c.name,!0),this.syncState())}.bind(this),backButtonClick:function(b,c){this.notify("toggle")}.bind(this),actionClick:function(b,c){var d=this.getCurrentState();"start_chat"==c.name?toa.community&&toa.community.transport&&this.screenController.sandbox.trigger("global.data.get",
{controller:"Chat",method:"startChat",params:{pid:d.providerId},responseHandler:function(b,c){c&&c.contactData&&c.contactData.address&&toa.app.model("Contacts").requestContactWithAddress(c.contactData.address,{success:function(b){toa.app.trigger("sn.chat.create",b.result)}})}}):isMobilityAction(c.name,c.targetItem&&c.targetItem||{})?(invokeMobilityScreen(Object.assign({},c.targetItem&&c.targetItem||{},{action:c.name,pid:d.providerId,date:d.date,dates:d.dates,panel:this.position,currentView:this.getCurrentViewName()})),
hide_hint()):this.screenController.sandbox.trigger("interface.actions.click",{action:c.name,pid:d.providerId,date:d.date,dates:d.dates,panel:this.position,view:this.getCurrentViewName()})}.bind(this)}});_DATA.is_mobility_app?this.titlePanel.render(this.layout.titlePanel.content):this.titlePanel.render(this.layout.secondPanel.content);this.titlePanel.replaceChild("calendar",{xtype:"calendar.Extended",name:"calendar",selected:this._currentState.date!=toa.date.DAY_WITHOUT_DATE?1<this._currentState.dates.length?
this._currentState.dates:[this._currentState.date]:[this._currentState.previousDate],maxDate:this.options.maxDate,addClass:"toa-layout-left-separator",layoutCellWidth:1,modes:{day:h(11801),twoDays:h(15326),threeDays:h(15327),week:h(11802),month:h(11804)}});this.viewContainer=$("<div>").addClass("toa-layout-fit").appendTo(this.layout.secondPanel.content);this.viewManager=new toa.ActivitiesScreen.ActivitiesViewManager({activitiesPanel:this,label:this.position,description:this.screenController.viewsConfigIndex,
state:this.getCurrentState(),sandbox:this.screenController.sandbox});this.layout.addListener("resize",function(b,c,d){this.viewManager.resize(d)}.bind(this));return this},_hasDisabledForm:function(b){if(b&&Array.isArray(b.menuItems))return b.menuItems.forEach(function(b){this._hasDisabledForm(b)}.bind(this));b&&b.actionOptions&&"form_link"===b.actionOptions.type&&!app.getFormCollection().has(b.name)&&(b.disabled=!0)},switchView:function(b,c,d){if(b===this.getCurrentViewName())return this.updateKeepNonScheduled(),
this.viewManager.currentViewController&&!d&&(this.viewManager.currentViewController.isFirstRequest=!0),!1;"time"!==b&&this.tree.notify("panel.filter.hide",{show:!1});this._showCalendar(b);d=this.titlePanel.getChild("viewsPanel");d.getChild(this.getCurrentViewName()).setOption("pressed",!1);d.getChild(b).setOption("pressed",!0);this.viewManager.switchView(b,c);this.updateKeepNonScheduled();return this},_showCalendar:function(b){a("allow_non_scheduled")?"list"===b?this._showNonScheduledCalendar():this._showExtendedCalendar(b):
this._showExtendedCalendar(b)},_updateStateData:function(b){this._currentState=$.extend(this._currentState,b);this.viewManager.updateCurrentState(this.getCurrentState());this.viewManager.updateRoutingRunsButtonVisibility();return this},updateState:function(b,c){b.providerId&&this.treeState.selectProvider(b.providerId);b.date&&b.previousDate&&(b.date!==toa.date.DAY_WITHOUT_DATE||"list"==this.getCurrentViewName()||c?this.changeDates(1<b.dates.length?b.dates:b.date):this.changeDates([b.previousDate]));
if(b.filter){this.changeFilter(b.filter);var d=this.titlePanel.findChild("filterButton");b.filter.queue_filter&&"0"!=b.filter.queue_filter||b.filter.include_non_working||b.filter.show_tech_trace||b.filter.recursively?d.setState("filtered"):d.setState("filterEmpty")}this._updateStateData(b);return this},syncState:function(){if(!this.checkIfStateChanged())return!1;this._updateStateData({providerId:this.tree.getSelectedProviderId()});this.viewManager.updateCurrentView();this._syncedState=$.extend({},
this._currentState);return!0},bindResourceSelected:function(){this._resourceTreePanelListenerUid||(this._resourceTreePanelListenerUid=this.tree.addListener("provider.selected",this._onSameResourceSelected.bind(this)));this._resourceTreeListenerUid||(this._resourceTreeListenerUid=this.tree.state.addListener("provider selected",this._onResourceSelected.bind(this)));this._resourceGroupsListenerUid||(this._resourceGroupsListenerUid=this.tree.state.addListener("group selected",this._onGroupSelected.bind(this)));
this.refresh(!0);return this},unbindResourceSelected:function(){this._resourceTreeListenerUid&&(this.tree.state.removeListener(this._resourceTreeListenerUid),this._resourceTreeListenerUid=null);this._resourceGroupsListenerUid&&(this.tree.state.removeListener(this._resourceGroupsListenerUid),this._resourceGroupsListenerUid=null);this._resourceTreePanelListenerUid&&(this.tree.removeListener(this._resourceTreePanelListenerUid),this._resourceTreePanelListenerUid=null);return this},_onResourceSelected:function(b,
c,d){this._updateStateData({providerId:c,groupId:d});this._stateTransaction||this.refresh(!0)},_onGroupSelected:function(b,c){this._updateStateData({providerId:c,groupId:c});this._stateTransaction||this.refresh(!0)},refresh:function(b){b&&this.syncState();b=this.titlePanel.getOption("routingPlansWidget");b.setResourceId(this.getCurrentState().providerId);b.setDate(this.getCurrentState().date)},_onSameResourceSelected:function(b,c){c===this.tree.getSelectedProviderId()&&this.viewManager.refreshCurrentView()},
enableTreeUpdates:function(){this.treeState.enableAutoUpdate();return this},disableTreeUpdates:function(){this.treeState.disableAutoUpdate();return this},showTree:function(){this.layout.showFirstPanel();this.titlePanel.setOption("resourceTreeButton",!1);this.viewManager.resize();return this},hideTree:function(){this.layout.hideFirstPanel();this.titlePanel.setOption("resourceTreeButton",!0);this.viewManager.resize();return this},hideTreePanelFilter:function(b,c){c.show?this.tree.enableMultidayMode():
this.tree.disableMultidayMode()},updateKeepNonScheduled:function(){"list"==this.getCurrentViewName()&&(this.keepNonScheduled=this.getCurrentState().date==toa.date.DAY_WITHOUT_DATE?!0:!1)},changeDates:function(b){var c=this.getCurrentState().date,d={};if(toa.isArray(b)){if(d.date=b,toa.isUndefined(b.mode))switch(d.date.length){default:d.mode="day";break;case 2:d.mode="twoDays";break;case 3:d.mode="threeDays";break;case 7:d.mode="week";break;case 28:case 29:case 30:case 31:d.mode="month"}}else if(toa.isString(b))d.date=
[b],d.mode="day";else switch(d=b,d.date.length){default:d.mode="day";break;case 2:d.mode="twoDays";break;case 3:d.mode="threeDays";break;case 7:d.mode="week";break;case 28:case 29:case 30:case 31:d.mode="month"}this.titlePanel.getChild("calendar").setOption("setMode",d.mode);this.tree.notify("panel.filter.hide",{show:"day"!==d.mode});this._updateStateData({date:d.date[0],dates:d.date,previousDate:c});this.titlePanel.setOption("selectedDates",d.date);this.treeState.setDate(d.date[0]);this.notify("date.changed",
d.date);this._stateTransaction||this.syncState();return!0},changeDate:function(b){if("string"!=typeof b)throw Error("ActivitiesPanel.changeDate: argument must be a string");var c=this.getCurrentState().date;if(b==c)return!1;this._updateStateData({date:b,dates:[b],previousDate:c});this.titlePanel.setOption("selectedDate",b);this.treeState.setDate(b);this.notify("date.changed",b);this.updateKeepNonScheduled();this._stateTransaction||this.syncState();return!0},setRatio:function(b){b=b||1;0.2>b?b=0.2:
6<b&&(b=6);this.changeRatio(b);toa.app.trigger("interface.durationRatio.changed",{ratio:b,position:this.position});return!0},changeRatio:function(b){this._updateStateData({ratio:b});return this.viewManager.changeRatio(b)},resize:function(b){this.layout.resize(b)},hideScreenHeader:function(b){905>=b&&$(".toa-view-control-paneltitle").addClass("collaboration-title-hide-heading")},removeCollaborationTitleClass:function(){$("[class*=collaboration-title-]").each(function(b,c){c.className=c.className.replace(/collaboration-title-\w*/g,
"")})},shiftDropdown:function(b){b<=RESPONSIVE_WIDTH.DESKTOP&&($("div.headerResponsiveMenu").addClass("collaboration-title-dropdown"),$("div.toa-dropdown.viewFilter_view_activities").addClass("collaboration-title-dropdown"))},changeCalendar:function(b){b<RESPONSIVE_WIDTH.TAB&&$("div.toa-calendar").addClass("collaboration-title-calendar")},adjustHeaderSize:function(b){this.hideScreenHeader(b);this.shiftDropdown(b);this.changeCalendar(b)},isFullScreen:function(b){this.removeCollaborationTitleClass();
$(".toa-view-control-paneltitle").css("width",b);return b===window.innerWidth||1024>=window.innerWidth},adjustViewContainerSize:function(){var b=this.titlePanel.getElement().outerHeight(),c=this.titlePanel.getElement().parent().find(".header-stripe"),d=this.container.width();c&&0<c.length&&c.is(":visible")&&(b+=c.outerHeight());3===toa.currentInterface&&!this.isFullScreen(d)&&this.adjustHeaderSize(d);this.viewContainer.css({top:b})},changeCaption:function(b){this.titlePanel.setOption("titleText",
b);return this},getCurrentState:function(){return $.extend({},this._currentState)},getSyncedState:function(){return $.extend({},this._syncedState)},getCurrentViewName:function(){return this.viewManager.currentViewName},getKeepNonScheduled:function(){return this.keepNonScheduled},setKeepNonScheduled:function(b){this.keepNonScheduled=!!b;return this},checkIfStateChanged:function(){var b=this._syncedState,c=this._currentState;if(1===c.dates.length&&1===b.dates.length){if(toa.isDefined(c.date)&&c.date!==
b.date)return!0}else{if(c.dates.length!==b.dates.length)return!0;if(c.dates.length>=b.dates.length)for(var d in c.dates){if(c.dates[d]!==b.dates[d])return!0}else for(d in b.dates)if(c.dates[d]!==b.dates[d])return!0}return c.providerId&&c.providerId!==b.providerId||c.providerId!==this.tree.getSelectedProviderId()?!0:c.filter instanceof Object&&!toa.isDeepEquals(c.filter,b.filter)},_showNonScheduledCalendar:function(){var b=this.keepNonScheduled?toa.date.DAY_WITHOUT_DATE:this._currentState.date;this.titlePanel.replaceChild("calendar",
{xtype:"calendar.Single",name:"calendar",today:this.screenController.sandbox.get("today"),selected:b,maxDate:this.options.maxDate,addClass:"toa-layout-left-separator",modes:{day:h(8213),nonscheduled:h(8203)},cell:{align:"left",width:"100px"}});this.changeDate(b);return this},_showExtendedCalendar:function(b){"time"===b?(b=this._currentState.date!=toa.date.DAY_WITHOUT_DATE?1<this._currentState.dates.length?this._currentState.dates:[this._currentState.date]:[this._currentState.previousDate],this.titlePanel.replaceChild("calendar",
{xtype:"calendar.Extended",name:"calendar",selected:b,maxDate:this.options.maxDate,addClass:"toa-layout-left-separator",layoutCellWidth:1,modes:{day:h(11801),twoDays:h(15326),threeDays:h(15327),week:h(11802),month:h(11804)}}),this.changeDates(b)):(b=this._currentState.date!=toa.date.DAY_WITHOUT_DATE?this._currentState.date:this._currentState.previousDate,this.titlePanel.replaceChild("calendar",{xtype:"calendar.Single",name:"calendar",selected:b,layoutCellWidth:1,addClass:"toa-layout-left-separator",
cell:{id:"calendarContainer"}}),this.changeDate(b));return this},changeFilter:function(b){this._updateStateData({filter:$.extend({},b)});return this},resetFilter:function(){this._updateStateData({filter:{}});return this},copyState:function(b){this._stateTransaction=!0;this.treeState.copyState(b.treeState);this.updateState(b.getCurrentState(),"list"===b.getCurrentViewName());this.switchView(b.getCurrentViewName(),!0,!0);this.setKeepNonScheduled(b.getKeepNonScheduled());this.layout.splitterPosition=
b.layout.splitterPosition;this.layout.splitterPercentage=b.layout.splitterPercentage;null!==b.layout.isFirstPanelVisible&&!1===b.layout.isFirstPanelVisible?this.hideTree():this.showTree();this._syncedState=$.extend({},this._currentState);this._stateTransaction=!1},onFilterChange:function(b,c){var d=this.titlePanel.findChild("filterButton");if(d.getForm()===c.form){_DATA.globalFilterVersion=++_DATA.globalFilterVersion||0;d.close();0!=c.values.queue_filter||c.values.include_non_working||c.values.show_tech_trace||
c.values.recursively?d.setState("filtered"):d.setState("filterEmpty");c.values.slider&&this.setRatio(c.values.slider/10);d=this.viewManager.getViewController();if("undefined"!==typeof d.currentState.filter&&"undefined"!==typeof c.values){var e=d.currentState.filter,p=c.values;"undefined"!==typeof p.recursively&&p.recursively||delete e.recursively;p=$.extend(e,p)}d.setOption("filter",c.values);this.changeFilter(p)}},hideGroupMenuElements:function(b){b=b&&0<b;this.titlePanel.findChild("actionPanel").setOption("hidden",
b)}}));toa.mixin(toa.ActivitiesScreen.ActivitiesPanel.prototype,toa.mixins.EventEmitter)})();(function(d){d.ns("toa.ActivitiesScreen.ActivitiesViewManager",d.define(null,function(c){this.options=$.extend({activitiesPanel:null,sandbox:null,label:"top",content:null,opened:!0,view:"time",height:0,state:null,description:{}},c);this.activitiesPanel=this.options.activitiesPanel;this.sandbox=this.options.sandbox;this.currentViewName=this.options.view;this.states={};this.access={};this.setPermissions();this.currentState=this.options.state},{currentState:null,currentViewName:null,currentViewController:null,
toString:function(){return"Activities view manager"},setPermissions:function(c){this.access=$.extend({routing_run_list:0},this.access,c);this.updateRoutingRunsButtonVisibility()},enable:function(c){null===this.currentViewController?this.switchView(this.currentViewName):(c=this.options.label+"_"+this.currentViewName,"suspend"==this.getState(c)&&(this.sandbox.trigger("app.controller.resume",{instance:c,params:{state:this.currentState}}),this.setState(c,"run")))},disable:function(){var c=this.options.label+
"_"+this.currentViewName;"run"==this.getState(c)&&(this.sandbox.trigger("app.controller.suspend",{instance:c}),this.setState(c,"suspend"))},getDesc:function(c){return this.options.description[c]},getState:function(c){return this.states[c]},setState:function(c,b){this.states[c]=b},getOption:function(c){return this.options[c]},setOption:function(c,b){this.options[c]=b;return this},getViewController:function(){return this.currentViewController},switchView:function(c,b){if(null!==this.currentViewController){if(c===
this.currentViewName)return this.currentViewController.isFirstRequest=!0,!1;this.disable()}var e=this.getDesc(c),g=this.options.label+"_"+c;switch(this.getState(g)){case "run":return;case "suspend":this.sandbox.trigger("app.controller.resume",{instance:g,params:{state:this.currentState,forceFilterUpdate:b}});break;default:this.sandbox.trigger("app.controller.register",{instance:g,controller:e.controller,params:{viewManager:this,panel:this.options.label,view:c,state:this.currentState}})}this.setState(g,
"run");this.currentViewName=c;this.currentViewController=d.app.getInstance(g);return!0},refreshCurrentView:function(){var c=this.getViewController();c&&(c.viewManager&&"map"===c.viewManager.currentViewName?c.refresh("refresh"):c.refresh());return this},updateCurrentState:function(c){this.currentState=$.extend(this.currentState,c);return(c=this.getViewController())?(c.updateState(this.currentState),!0):!1},updateCurrentView:function(){var c=this.getViewController();return c&&!c.isFirstRequest?(c.onChange(this.currentState),
!0):!1},resize:function(c){var b=this.getViewController();b&&b.resizeWindow(c);return this},changeRatio:function(c){var b=this.getViewController();return b?(b.changeRatio(c),!0):!1},updateRoutingRunsButtonVisibility:function(){var c=this.activitiesPanel.treeState.getSelectedProvider();!1===c||!1===c.isBucket()||this.activitiesPanel._currentState.date===d.date.DAY_WITHOUT_DATE||!d.date.isDateNotArchived(this.activitiesPanel._currentState.date,d.app.model("User").get("tz_diff"))||2>this.access.routing_run_list||
2>this.access.routing_execution_summary_widget?this.activitiesPanel.titlePanel.setOption("routingPlans",!1):this.activitiesPanel.titlePanel.setOption("routingPlans",!0)}}))})(toa);(function(d,c){var b=d.ActivitiesScreen.View;d.ns("toa.ActivitiesScreen.views.List",d.define(b,function(e){b.apply(this,arguments);this.selectedActivity={};this.page=1;this.rows=this.total=0;this.NUMBER_REQUESTED_ACTIVITY_BY_DEFAULT=200;this.filterInitialData={};this.currentFilterVersion=_DATA.globalFilterVersion=_DATA.globalFilterVersion||0;this.isFirstRequest=!0;this.ACTIVITY_FEATURE_ALLOW_MOVE_BETWEEN_RESOURCES=2;this.ACTIVITY_FEATURE_ALLOW_RESCHEDULE=8;this.ACTIVITY_FEATURE_ALLOW_NON_SCHEDULED=
4194304;this.colModel=e.model("activitiesListColumns");this.contentContainer=c("<div>").addClass("toa-layout-fit").appendTo(this.viewManager.activitiesPanel.viewContainer);this.grid=d.view.control.create({xtype:"grid.Grid",columns:this.colModel,translation:{preferencesTitle:h(8145),preferencesHeader:h(8146),preferencesDescription:h(8147)},listeners:{scrollBottom:this.onScroll.bind(this),formatCell:this.onFormatCell.bind(this),cellClick:this.onCellClick.bind(this),titleClick:this.onTitleClick.bind(this),
selectMode:this.onSelectMode.bind(this),groupActionClick:this.onGroupActionClick.bind(this),dragOver:this.onDragOver.bind(this),dragDrop:this.onDragDrop.bind(this)}});this.grid.render(this.contentContainer);this.paging=c("<div/>").addClass("activity-views-paging").mouseover(function(){c(this).css("opacity",1)}).mouseout(function(){c(this).css("opacity",0)}).click(function(){c(this).css("opacity",0)}).appendTo(this.contentContainer);this.grid.getElement().delegate("div.toaGantt-tb","mousedown touchstart",
d.helper.activity.makeDraggable);this.sandbox.trigger("global.hint.assign",{elements:this.grid.getElement(),add_links:["select_provider"]});this.settingsModel=e.model("companySettings");e.bind("global.interface.refresh",function(b,c){this.refresh(c)}.bind(this));this.onUpdate("internal",{init:this.colModel.isLoaded()?0:1})},{toString:function(){return"Activities list - "+this.getOption("panel")+" panel"},suspend:function(c){this.clearRefreshTimer();b.prototype.suspend.apply(this,arguments);this.contentContainer.detach()},
resume:function(c){this.clearRefreshTimer();b.prototype.resume.apply(this,arguments);this.contentContainer.appendTo(this.viewManager.activitiesPanel.viewContainer);this.resize();this.onChange();this.setFilter(this.filterInitialData)},onChange:function(b){this.page=1;this.total=0;this.onUpdate("internal",b)},onUpdate:function(b,d){var k=!1;d=d||{};d.response&&(d.response.trigger&&"global.interface.refresh"==d.response.trigger&&(k=!0),d={},k&&this.rows>this.NUMBER_REQUESTED_ACTIVITY_BY_DEFAULT&&(d.rows=
this.rows));"undefined"==typeof d.init&&(d.init=this.colModel.isLoaded()?0:1);var k=this.getTreeRequestParameters(),l={};l[k.tree_identifier]=k;k=c.extend({trees:l,page:this.page,sortBy:this.sortBy,sortDir:this.sortDir,parent:this.getSelectedResourceId(),selectedGroup:this.getSelectedResourceGroupId(),qdate:this.currentState.date,dates:this.currentState.dates,filter:this.currentState.filter,doNeedFilterContent:this._isNeedFilterContent(),panel:this.getOption("panel"),controller_name:this.sandbox.name},
d);this.sandbox.trigger("global.data.get",{controller:"Grid",method:"get",params:k,responseHandler:this.onResponse.bind(this)});this.isFirstRequest=!1},_isNeedFilterContent:function(){return this.isFirstRequest||this.currentFilterVersion!==_DATA.globalFilterVersion?1:0},createList:function(b){this.colModel.setAll(b.cols)},onResponse:function(b,g){if("undefined"!=typeof g.error)this.showError(g.error);else if(this.hideError(),g.access&&this.viewManager.setPermissions(g.access),this.setRefreshTimer(),
g.cols&&this.createList(g),g.p&&(this.showedResource=new d.Resource(g.p),this.updateTitle(this.showedResource,g.actions)),g.filter_content&&g.filter_params?(this.currentFilterVersion=_DATA.globalFilterVersion,this.setFilter(g),this.filterInitialData={filter_content:g.filter_content,filter_params:g.filter_params}):this.setFilter(this.filterInitialData),g.p.c?this.showFilterElements(".recursive_filter"):this.hideFilterElements(".recursive_filter"),g.grid){this.sortBy=g.grid.sortBy;this.sortDir=g.grid.sortDir;
this.page=g.grid.page||1;this.total=g.grid.total;this.rows=g.paging&&g.paging.to;this.grid.setSort(this.sortBy,this.sortDir);g.grid.groupActions&&this.grid.setOption("groupActions",g.grid.groupActions);this.grid.setSort(this.sortBy,this.sortDir);this.grid.setOption("total",g.paging.total);this.grid.setOption("filters",this.currentState.filter);this.grid.setOption("date",g.p.D);this.grid.setOption("pid",g.p.z);this.grid.setOption("isResourceQueueOwner",g.isResourceQueueOwner);this.updatePager(g.paging);
var k=this.colModel.getAll();c.each(k,function(b,c){"pname"===c.name&&(c.hidden=0==g.gid&&(!g.recursively||g.isResourceQueueOwner))});1==this.page?this.grid.setRows(g.grid.rows||[]):this.grid.appendRows(g.grid.rows||[]);this.isRequested=!1;g.p&&this.showedResource.isTechnician();this.viewManager.activitiesPanel.hideGroupMenuElements(g.gid?g.gid:0)}},updatePager:function(b){if(b){var c="",c=b.time===d.date.DAY_WITHOUT_DATE?0===b.to?h(13610):b.to===b.total?h(13611,{"{TOTAL}":b.total}):h(14604,{"{FOUND}":b.to,
"{TOTAL}":b.total}):0===b.to?h(20961,{"{DATE_OR_TIME}":b.time,"{TIMEZONE}":b.tz}):b.to===b.total?h(20962,{"{TOTAL}":b.total,"{DATE_OR_TIME}":b.time,"{TIMEZONE}":b.tz}):h(20963,{"{FOUND}":b.to,"{TOTAL}":b.total,"{DATE_OR_TIME}":b.time,"{TIMEZONE}":b.tz});this.paging.text(c).css("opacity",1).delay(5E3).animate({opacity:0},"fast")}},refresh:function(b){this.onChange(b)},resize:function(){b.prototype.resize.call(this);this.grid&&this.grid.resize()},onSelectMode:function(b,c){var d=c.element;c.mode?(this.viewManager.activitiesPanel.titlePanel.layout.table.hide(),
this.viewManager.activitiesPanel.titlePanel.element.append(d)):(this.viewManager.activitiesPanel.titlePanel.layout.table.show(),d.detach())},onScroll:function(b,c){!this.isRequested&&200>c.bottom&&this.page<this.total&&(this.isRequested=!0,this.rows>this.NUMBER_REQUESTED_ACTIVITY_BY_DEFAULT&&2>this.page&&(this.page=-Math.floor(-this.rows/this.NUMBER_REQUESTED_ACTIVITY_BY_DEFAULT)),this.onUpdate("internal",{page:this.page+1}))},onFormatCell:function(b,c){switch(c.col.name){case "act_bar":return d.helper.activity.createActivityBar(new d.Activity(c.row._v),
0,this.currentState.ratio,0,1)}},onCellClick:function(b,c){if("check"!==c.col.name&&"act_bar"!==c.col.name){var d={action:"change_activity",aid:c.row._v.z,pid:c.row._v.p,date:c.row._v.D};isMobilityAction("change_activity",d)?invokeMobilityScreen(d):this.sandbox.trigger("interface.actions.click",d)}},onTitleClick:function(b,c){var d=c.col.name,l="+";this.sortBy==d&&(l="+"==this.sortDir?"-":"+");this.page=1;this.total=0;this.onUpdate("internal",{sortBy:d,sortDir:l,rows:this.rows>this.NUMBER_REQUESTED_ACTIVITY_BY_DEFAULT?
this.rows:this.NUMBER_REQUESTED_ACTIVITY_BY_DEFAULT})},onGroupActionClick:function(b,c){var d={},l={};if(-1!==c.action.indexOf("move"))for(l=0;l<c.selected.length;l++){var n=c.selected[l];d[n._v.z]={date:n._v.D,pid:n._v.p}}else for(d=[],l=0;l<c.selected.length;l++)n=c.selected[l],d[l]={date:n._v.D,pid:n._v.p,aid:n._v.z};l="undefined"==typeof c.external?{content_url:_DATA.content_url,action:c.action,params:{aid:d,pid:this.currentState.providerId,date:this.currentState.date}}:{content_url:_DATA.content_url,
action:c.action,params:{aid:d,filters:c.external.filters,action_type:"exclude",selectedCount:c.external.selectedCount,pid:this.currentState.providerId,date:this.currentState.date}};this.sandbox.trigger("interface.actions.click",l)},onDragOver:function(b,c){var k=this.showedResource,l=c.helper.data("selfController");if(!k)return!1;var k=d.helper.activity.getActivityFromElement(c.helper).checkMove(c.helper,k,this.currentState.date),n=c.helper.attr("aid");if(!k||l==this.grid)return!1;if(("undefined"!=
typeof l&&1!=l.currentItem&&1<l.selectedCount&&null==l.currentItem||-1!==n.search(","))&&k.groupResult){k=!1;if("undefined"!=typeof l&&"undefined"!=typeof l.selected)for(var p in l.selected)if("multiday_activity_segment"==l.selected[p]._v.T){k=!0;break}k=k||c.helper[0].hasAttribute("has-multiday-activity")?{result:!1,message:h(15083)}:{result:!0,message:h(5579)}}c.helper.data("hint").setAccept(k.result,k.message,this.grid.getChild("body").getElement());return!1},onDragDrop:function(b,g){var k="undefined"!=
typeof g.helper&&"undefined"!=typeof g.helper.data("selfController")?g.helper.data("selfController"):{currentItem:1},l=this.showedResource;if(!l)return!1;var n=d.helper.activity.getActivityFromElement(g.helper),p=n.checkMove(g.helper,l,this.currentState.date),s=g.helper.attr("aid");if(!p||g.helper.data("selfController")==this.grid)return!1;if((s="undefined"!=typeof k&&1!=k.currentItem&&1<k.selectedCount&&null==k.currentItem||-1!==s.search(","))&&!p.groupResult||!p.result&&!s)return d.app.trigger("global.hint.hide"),
d.ui.Alert({text:hs(p.message)}),!1;if(s&&"undefined"!=typeof k&&"undefined"!=typeof k.selected)for(var t in k.selected)if("multiday_activity_segment"==k.selected[t]._v.T)return!1;if(s&&g.helper[0].hasAttribute("has-multiday-activity"))return!1;var u=d.helper.activity.prepareAidsToMove(n.get("aid"),n.get("pid"),n.get("date"),g.helper);if(this.currentState.providerId==n.get("pid")&&this.currentState.date==n.get("date"))return!1;var v=["controller=ActivitiesGroup","method=move","target_pid="+this.currentState.providerId,
"target_date="+this.currentState.date];!!l.get("FLAGS")&d.Resource.prototype.ON_CALL_PROVIDER&&!l.isFlagSet(l.get("FLAGS"),d.Resource.prototype.REGULAR_PROVIDER)||v.push("move_immediately=true");u.fromDate=this.currentState.fromDate;u.targetDate=this.currentState.date;this.moveMultidayActivity=new d.ActivitiesScreen.views.MoveMultidayActivity;var w=d.app.model("routeService");w.moveActivity(v,u).then(function(b){b.hasOwnProperty("multidayActivity")&&(u=c.extend(!0,u,b),this.moveMultidayActivity.render(u))}.bind(this),
function(b){console.log("error promise (check for move activity)",arguments)}.bind(this));this.moveMultidayActivity.addListener("move.multiday.activity",function(b,e){u=c.extend(!0,u,e);w.moveActivity(v,u).then(function(b){b.multidayActivity.hasOwnProperty("moveResult")&&!0!==b.multidayActivity.moveResult?d.ui.Alert({text:d.glossary({id:15343})}):d.app.trigger("global.interface.refresh",{forceReload:1})}.bind(this),function(b){console.log("error promise (move activity)",arguments)}.bind(this))}.bind(this))},
changeRatio:function(c){b.prototype.changeRatio.apply(this,arguments);this.grid.resize();return this},destroy:function(){this.clearRefreshTimer();this.grid.destroy();b.prototype.destroy.call(this)}}))})(toa,jQuery);(function(d){var c=d.ActivitiesScreen.View;d.ns("toa.ActivitiesScreen.views.Time",d.define(c,function(b){this.sandbox=b;c.apply(this,arguments);this.monthGanttVScroll=this.monthGanttHScroll=this.multiGanttVScroll=this.multiGanttHScroll=this.ganttVScroll=this.ganttHScroll=this.lockRequests=0;this.filterInitialData={};this.isFirstRequest=!0;this.countOfRunningRequests=0;this.handlerUpdatePagerOnMouseover=function(){0==$(".DnDHint").length?$(this).css({opacity:1,display:"block"}):$(this).css({opacity:0,
display:"none"})};this.handlerUpdatePagerOnMouseout=function(){0==$(".DnDHint").length&&$(this).css({opacity:0,display:"block"})};this.handlerToCheckMove=function(){0<$(this.gantt).find(".activity-views-paging").length&&$(this.gantt).find(".activity-views-paging").css({opacity:0,display:"block"})};this.handlerUpdatePagerOnClick=function(b){$(this).css({opacity:0,display:"block"});var c=$(".toaGantt .toaGantt-body .toaGantt-notOrdered .toaGantt-tl"),d=$(".toaGantt .toaGantt-body .toaGantt-withoutDate .toaGantt-tl"),
l=c.last(),n=d.last();if(l.length&&n.length){var p=Math.ceil(l.outerHeight()),s=Math.ceil(n.offset().left-l.offset().left),t=null,l=c.filter(function(){return b.clientY>=$(this).offset().top&&b.clientY<$(this).offset().top+p}),n=d.filter(function(){return b.clientY>=$(this).offset().top&&b.clientY<$(this).offset().top+p});l.length&&n.length&&(c=b.clientY>=l.offset().top&&b.clientY<l.offset().top+p,d=b.clientX>=l.offset().left&&b.clientX<l.offset().left+s,s=b.clientX>l.offset().left+s&&b.clientX<l.offset().left+
2*s,c&&(d&&(t=l),s&&(t=n),d||s))&&(l=t.parent().parent(),t=t.find(".toaGantt-label").get(0),b.target=t,b.type="mousedown",l.trigger(b))}};this.currentFilterVersion=_DATA.globalFilterVersion=_DATA.globalFilterVersion||0;this.settingsModel=this.sandbox.model("companySettings");this.sandbox.bind("global.interface.refresh",this.refresh.bind(this));this.sandbox.bind("model.companySettings.reload",this.onUpdateSettings,this);this.initGantt();this.initMultiGantt();this.initMonthGantt();this.resize(!0)},
{shifts:null,multiCount:0,monthCount:0,time:null,initGantt:function(){this.gantt=$("<div/>").Gantt({settings:this.settingsModel,enableWithoutDate:a("allow_non_scheduled"),withoutRequest:this.isMultiDayMode()||this.isMonthMode()}).appendTo(this.viewManager.activitiesPanel.viewContainer);this.sandbox.trigger("global.hint.assign",{elements:this.gantt,add_links:["select_provider"],location:this.viewManager.activitiesPanel.position+"ActivitiesPanel",getDate:function(){return this.options.state.date}.bind(this)});
this.gantt.Gantt("setTimeRatio",this.currentState.ratio||1);this.gantt.bind("ganttupdatepage",function(b,c){this.onUpdate("needUpdateGantt",c)}.bind(this));this.gantt.bind("ganttclickcounterlabel",function(b,c){"withoutDate"===c.group?this.sandbox.trigger("app.interface.showin",{pid:c.pid,date:d.date.DAY_WITHOUT_DATE}):this.sandbox.trigger("app.interface.showin",{pid:c.pid,date:this.currentState.date})}.bind(this));this.gantt.bind("ganttdropactivity",this.onMoveActivity.bind(this));this.gantt.bind("mouseup",
this.handlerToCheckMove.bind(this));this.gantt.bind("ganttresourcechanged",function(){this.resourceChanged=!0;this.storeChartScroll()}.bind(this))},initMultiGantt:function(){this.multiGantt=$('<div class="multiGantt"/>').MultiGantt({settings:this.settingsModel,enableWithoutDate:a("allow_non_scheduled"),withoutRequest:!this.isMultiDayMode()||!this.isMonthMode()}).appendTo(this.viewManager.activitiesPanel.viewContainer);this.sandbox.trigger("global.hint.assign",{elements:this.multiGantt,add_links:["select_provider"],
location:this.viewManager.activitiesPanel.position+"ActivitiesPanel"});this.multiGantt.bind("multiganttupdatepage",function(b,c){this.onUpdate("needUpdateMultiGantt",c)}.bind(this));this.multiGantt.bind("multiganttclickcounterlabel",function(b,c){"withoutDate"===c.group&&this.sandbox.trigger("app.interface.showin",{pid:c.pid,date:d.date.DAY_WITHOUT_DATE})}.bind(this));this.multiGantt.bind("multiganttdropactivity",this.onMoveActivity.bind(this));this.multiGantt.bind("multiganttresourcechanged",function(){this.resourceChanged=
!0;this.storeChartScroll()}.bind(this))},initMonthGantt:function(){this.monthGantt=$('<div class="monthGantt"/>').MonthGantt({settings:this.settingsModel,enableWithoutDate:a("allow_non_scheduled"),withoutRequest:!this.isMonthMode()}).appendTo(this.viewManager.activitiesPanel.viewContainer);this.sandbox.trigger("global.hint.assign",{elements:this.monthGantt,add_links:["select_provider"],location:this.viewManager.activitiesPanel.position+"ActivitiesPanel"});this.monthGantt.bind("monthganttupdatepage",
function(b,c){this.onUpdate("needUpdateMultiMonthGantt",c)}.bind(this));this.monthGantt.bind("monthganttclickcounterlabel",function(b,c){"withoutDate"===c.group&&this.sandbox.trigger("app.interface.showin",{pid:c.pid,date:d.date.DAY_WITHOUT_DATE})}.bind(this));this.monthGantt.bind("monthganttdropactivity",this.onMoveActivity.bind(this))},toString:function(){return"Activities Time view"},_clearTimers:function(){this.clearRefreshTimer();clearTimeout(this.winResizeTimer)},isMultiDayMode:function(){return 1<
this.currentState.dates.length&&8>this.currentState.dates.length},isMonthMode:function(){return 27<this.currentState.dates.length},suspend:function(b){this._clearTimers();this.lockRequests++;c.prototype.suspend.call(this,b);this.gantt.detach();this.multiGantt.detach();this.monthGantt.detach()},resume:function(b){this.clearRefreshTimer();c.prototype.resume.call(this,b);this.gantt.appendTo(this.viewManager.activitiesPanel.viewContainer);this.gantt.Gantt("setTimeRatio",this.currentState.ratio||1);this.gantt.Gantt("clear",
!0);this.multiGantt.appendTo(this.viewManager.activitiesPanel.viewContainer);this.multiGantt.MultiGantt("setTimeRatio",this.currentState.ratio||1);this.multiGantt.MultiGantt("clear",!0);this.monthGantt.appendTo(this.viewManager.activitiesPanel.viewContainer);this.monthGantt.MonthGantt("setTimeRatio",1);this.monthGantt.MonthGantt("clear",!0);this.setFilter(this.filterInitialData);this.lockRequests--;this.resize()},destroy:function(){this._clearTimers();this.gantt.remove();this.gantt=null;this.multiGantt.remove();
this.multiGantt=null;this.monthGantt.remove();this.monthGantt=null;c.prototype.destroy.call(this)},onChange:function(){this.clearOnResponse=!0;this.isMultiDayMode()?(this.multiGantt.MultiGantt("reload"),this.monthGantt.MonthGantt("clearLines"),this.gantt.Gantt("clearLines")):this.isMonthMode()?(this.monthGantt.MonthGantt("reload"),this.multiGantt.MultiGantt("clearLines"),this.gantt.Gantt("clearLines")):(this.gantt.Gantt("reload"),this.multiGantt.MultiGantt("clearLines"),this.monthGantt.MonthGantt("clearLines"))},
refresh:function(b,c){if(c&&c.forceReload)this.onChange();else this.isMultiDayMode()?this.multiGantt.MultiGantt("update"):this.isMonthMode()?this.monthGantt.MonthGantt("update"):this.gantt.Gantt("update")},onUpdate:function(b,c){d.isDefined(c.from)?this.versions=c:this.versions={};if(!this.lockRequests){c.forceClear&&(this.clearOnResponse=!0);var g=this.getTreeRequestParameters(),k={},l={};k[g.tree_identifier]=g;this.countOfRunningRequests++;g=this.time==this.currentState.date?!0:!1;this.time=this.currentState.date;
this.storeChartScroll();this.isMonthMode()?(l={trees:k,parent:this.getSelectedResourceId(),selectedGroup:this.getSelectedResourceGroupId(),qdate:this.currentState.date,dates:this.currentState.dates,versions:this.versions,previousDate:g,doNeedFilterContent:this._isNeedFilterContent(),panel:this.getOption("panel"),filter:this.currentState.filter,return_shifts:null===this.shifts?"1":"0"},this.sendRequest("MultidayMonthTime",l,this.handlerOnUpdateMonthResponse.bind(this),this.countOfRunningRequests)):
this.isMultiDayMode()?(l={trees:k,parent:this.getSelectedResourceId(),selectedGroup:this.getSelectedResourceGroupId(),qdate:this.currentState.date,dates:this.currentState.dates,versions:this.versions,previousDate:g,doNeedFilterContent:this._isNeedFilterContent(),panel:this.getOption("panel"),filter:this.currentState.filter},this.sendRequest("MultidayTime",l,this.handlerOnUpdateMultiResponse.bind(this),this.countOfRunningRequests)):(l={trees:k,parent:this.getSelectedResourceId(),selectedGroup:this.getSelectedResourceGroupId(),
qdate:this.currentState.date,dates:this.currentState.dates,versions:this.versions,filter:this.currentState.filter,doNeedFilterContent:this._isNeedFilterContent(),panel:this.getOption("panel"),return_shifts:null===this.shifts?"1":"0"},this.sendRequest("Time",l,this.handlerOnUpdateResponse.bind(this),this.countOfRunningRequests));this.isFirstRequest=!1;this.setRefreshTimer()}},_isNeedFilterContent:function(){return this.isFirstRequest||this.currentFilterVersion!==_DATA.globalFilterVersion?1:0},sendRequest:function(b,
c,d,k,l){this.sandbox.trigger("global.data.get",{controller:b,method:l||"get",params:c,responseHandler:function(b,c){k===this.countOfRunningRequests&&d(b,c,k)}.bind(this)})},onUpdateSettings:function(b,c){this.isMultiDayMode()?this.multiGantt.MultiGantt("clear"):this.isMonthMode()?this.monthGantt.MonthGantt("clear"):this.gantt.Gantt("clear")},updatePager:function(b){if(b.delta&&b.delta.totals){var c=b.delta.totals,d="",d=1!==c.from||c.to!==c.count?h(20963,{"{FOUND}":c.to,"{TOTAL}":c.count,"{DATE_OR_TIME}":b.paging_time||
"","{TIMEZONE}":b.paging_tz||""}):h(20962,{"{TOTAL}":c.count,"{DATE_OR_TIME}":b.paging_time||"","{TIMEZONE}":b.paging_tz||""});$($("div.activity-views-paging",this.gantt).get(0)||$(this.gantt).append("<div class='activity-views-paging'></div>").find("div.activity-views-paging").get(0)).unbind().css("opacity",1).mouseover(this.handlerUpdatePagerOnMouseover).mouseout(this.handlerUpdatePagerOnMouseout).click(this.handlerUpdatePagerOnClick).text(d).delay(5E3).animate({opacity:0},0)}},updateMultiGanttPager:function(b){if(b&&
b.data.totals){b.data.totals.count&&this.multiCount!==b.data.totals.count&&(this.multiCount=b.data.totals.count);var c=b.data.totals,d=c.from,c=c.to,k=this.multiCount,l=h(1752).toLowerCase(),n=h(6713).toLowerCase(),p=b.paging_time||"";b=b.paging_tz||"";var s="";if(1!==d||c!==k)s=[d,"-",c," ",l," "].join("");d=[s,k," ",n," ",p," ",b].join("");$($("div.activity-views-paging",this.multiGantt).get(0)||$(this.multiGantt).append("<div class='activity-views-paging'></div>").find("div.activity-views-paging").get(0)).unbind().css("opacity",
1).mouseover(this.handlerUpdatePagerOnMouseover).mouseout(this.handlerUpdatePagerOnMouseout).click(this.handlerUpdatePagerOnClick).text(d).delay(5E3).animate({opacity:0},0)}},updateMonthGanttPager:function(b){if(b&&b.data.totals){b.data.totals.count&&this.monthCount!==b.data.totals.count&&(this.monthCount=b.data.totals.count);var c=b.data.totals,d=c.from,c=c.to,k=this.monthCount,l=h(1752).toLowerCase(),n=h(6713).toLowerCase(),p=b.paging_time||"";b=b.paging_tz||"";var s="";if(1!==d||c!==k)s=[d,"-",
c," ",l," "].join("");d=[s,k," ",n," ",p," ",b].join("");$($("div.activity-views-paging",this.monthGantt).get(0)||$(this.monthGantt).append("<div class='activity-views-paging'></div>").find("div.activity-views-paging").get(0)).unbind().css("opacity",1).mouseover(this.handlerUpdatePagerOnMouseover).mouseout(this.handlerUpdatePagerOnMouseout).click(this.handlerUpdatePagerOnClick).text(d).delay(5E3).animate({opacity:0},0)}},changeRatio:function(b){c.prototype.changeRatio.apply(this,arguments);this.isMultiDayMode()?
this.multiGantt.MultiGantt("setTimeRatio",this.currentState.ratio):this.isMultiDayMode()||this.isMonthMode()||this.gantt.Gantt("setTimeRatio",this.currentState.ratio);return this},onMoveActivity:function(b,c){var g=c.aid,k;"string"!=typeof c.targetDate&&(c.targetDate=this.currentState.date);switch(c.group){case "ordered":k=c.nextTo;break;case "notOrdered":k=-1;break;case "withoutDate":c.targetDate=d.date.DAY_WITHOUT_DATE}_DATA.content_url="doRefresh";var l=d.helper.activity.prepareAidsToMove(g,c.fromPid,
c.fromDate,c.helper);"undefined"!==typeof k&&(l.prev=k);var n=["controller=ActivitiesGroup","method=move","target_pid="+c.toPid,"target_date="+c.targetDate],g=this.isMonthMode()?this.monthGantt.MonthGantt("getMonthViewData").getResource(c.toPid):this.isMultiDayMode()?this.multiGantt.MultiGantt("getMultidayTimeViewData").getResource(c.toPid):this.gantt.Gantt("getTimeViewData").getResource(c.toPid);if("object"===typeof g){this.isMultiDayMode()||this.isMonthMode()||!!g.get("FLAGS")&d.Resource.prototype.ON_CALL_PROVIDER&&
!g.isFlagSet(g.get("FLAGS"),d.Resource.prototype.REGULAR_PROVIDER)||n.push("move_immediately=true");l.fromDate=c.fromDate;l.targetDate=c.targetDate;this.moveMultidayActivity=new d.ActivitiesScreen.views.MoveMultidayActivity;var p=d.app.model("routeService");p.moveActivity(n,l).then(function(b){b.hasOwnProperty("multidayActivity")&&(l=$.extend(!0,l,b),this.moveMultidayActivity.render(l))}.bind(this),function(b){console.log("error promise (check for move activity)",arguments)}.bind(this));this.moveMultidayActivity.addListener("move.multiday.activity",
function(b,c){l=$.extend(!0,l,c);p.moveActivity(n,l).then(function(b){b.multidayActivity.hasOwnProperty("moveResult")&&!0!==b.multidayActivity.moveResult?d.ui.Alert({text:d.glossary({id:15343})}):d.app.trigger("global.interface.refresh",{forceReload:1})}.bind(this),function(b){console.log("error promise (move activity)",arguments)}.bind(this))}.bind(this))}},resize:function(b){if(this.gantt&&this.multiGantt&&this.monthGantt){c.prototype.resize.call(this);var d=this.viewManager.activitiesPanel.viewContainer;
this.isMultiDayMode()?this.multiGantt.MultiGantt("resize",{height:d.height(),width:d.width(),withoutRequest:b}):this.isMonthMode()?this.monthGantt.MonthGantt("resize",{height:d.height(),width:d.width(),withoutRequest:b}):this.gantt.Gantt("resize",{height:d.height(),width:d.width(),withoutRequest:b})}},handlerOnUpdateResponse:function(b,c,g){c.access&&this.viewManager.setPermissions(c.access);this.gantt.removeClass("toa-hidden");this.multiGantt.addClass("toa-hidden");this.monthGantt.addClass("toa-hidden");
this.resize(!0);c.shifts instanceof Object&&(this.shifts=c.shifts,this.gantt.Gantt("setShifts",c.shifts),this.multiGantt.MultiGantt("setShifts",c.shifts),this.monthGantt.MonthGantt("setShifts",c.shifts),this.monthGantt.MonthGantt("setNonWorkingReasons",c.non_working_reasons));if(!c.p)return!1;var k=new d.Resource(c.p);this.selectedResource=k;this.updateTitle(k,c.actions);"undefined"!==typeof c.filter_content?(this.currentFilterVersion=_DATA.globalFilterVersion,this.setFilter(c),this.filterInitialData=
{filter_content:c.filter_content,filter_params:c.filter_params,gid:c.gid?c.gid:0}):this.setFilter(this.filterInitialData);c.p.c?this.showFilterElements(".recursive_filter"):this.hideFilterElements(".recursive_filter");if("undefined"!=typeof c.error)return this.showError(c.error),!1;this.hideError();this.showFilterElements(".toa-panel-filter-zoom");this.showFilterElements(".show_tech_trace");this.gantt.Gantt("setCurrentTime",c.server_resource_time);this.clearOnResponse&&(this.clearOnResponse=!1,this.gantt.Gantt("clear",
!0),this.multiGantt.MultiGantt("clear",!0),this.monthGantt.MonthGantt("clear",!0));this.gantt.Gantt("load",k.getId(),k.get("date"),c.delta);this.getTracks(c,g);this.updatePager(c);this.restoreChartScroll(b);this.viewManager.activitiesPanel.hideGroupMenuElements(c.gid?c.gid:0)},handlerOnUpdateMultiResponse:function(b,c,g){if("undefined"!=typeof c.error)return this.showError(c.error),!1;this.hideError();c.access&&this.viewManager.setPermissions(c.access);this.gantt.addClass("toa-hidden");this.multiGantt.removeClass("toa-hidden");
this.monthGantt.addClass("toa-hidden");this.resize(!0);if(!c.p)return!1;this.selectedResource=g=new d.Resource(c.p);this.updateTitle(g,c.actions);"undefined"!==typeof c.filter_content&&(this.currentFilterVersion=_DATA.globalFilterVersion,this.setFilter(c),this.filterInitialData={filter_content:c.filter_content,filter_params:c.filter_params});c.p.c?this.showFilterElements(".recursive_filter"):this.hideFilterElements(".recursive_filter");this.showFilterElements(".toa-panel-filter-zoom");this.hideFilterElements(".show_tech_trace");
this.clearOnResponse&&(this.clearOnResponse=!1,this.gantt.Gantt("clear",!0),this.multiGantt.MultiGantt("clear",!0),this.monthGantt.MonthGantt("clear",!0));this.multiGantt.MultiGantt("load",this.selectedResource,c);this.updateMultiGanttPager(c);this.restoreChartScroll(b);this.viewManager.activitiesPanel.hideGroupMenuElements(c.gid?c.gid:0)},handlerOnUpdateMonthResponse:function(b,c,g){if("undefined"!=typeof c.error)return this.showError(c.error),!1;this.hideError();c.access&&this.viewManager.setPermissions(c.access);
c.shifts instanceof Object&&(this.shifts=c.shifts,this.gantt.Gantt("setShifts",c.shifts),this.multiGantt.MultiGantt("setShifts",c.shifts),this.monthGantt.MonthGantt("setShifts",c.shifts));this.gantt.addClass("toa-hidden");this.multiGantt.addClass("toa-hidden");this.monthGantt.removeClass("toa-hidden");this.resize(!0);this.hideFilterElements(".toa-panel-filter-zoom");this.hideFilterElements(".show_tech_trace");if(!c.p)return!1;this.selectedResource=b=new d.Resource(c.p);this.updateTitle(b,c.actions);
var k=this.viewManager.activitiesPanel.titlePanel.findChild("filterButton"),k=k.getPopup().element.find("[name=include_on_call]");b=k.prop("checked");"undefined"!==typeof c.filter_content&&(this.currentFilterVersion=_DATA.globalFilterVersion,this.setFilter(c),this.filterInitialData={filter_content:c.filter_content,filter_params:c.filter_params});this.isMonthMode()?this.hideFilterElements(".toa-panel-filter-zoom"):this.showFilterElements(".toa-panel-filter-zoom");k=this.viewManager.activitiesPanel.titlePanel.findChild("filterButton");
g=k.getPopup().element.find("[name=include_non_working]");k=k.getPopup().element.find("[name=include_on_call]");c.p.c?(this.showFilterElements(".recursive_filter"),g.prop("checked")&&(k.attr("disabled","disabled"),k.attr("checked"),k.prop("checked",!0))):(this.hideFilterElements(".recursive_filter"),k.removeAttr("disabled"),b?k.attr("checked"):k.removeAttr("checked"));this.clearOnResponse&&(this.clearOnResponse=!1,this.gantt.Gantt("clear",!0),this.multiGantt.MultiGantt("clear",!0),this.monthGantt.MonthGantt("clear",
!0));this.monthGantt.MonthGantt("load",this.selectedResource,c);this.updateMonthGanttPager(c);this.notify("toa.ActivitiesScreen.views.Time.triggerRestoreScroll",this.sandbox.name);this.showFilterElements(".month_view_mode");this.viewManager.activitiesPanel.hideGroupMenuElements(c.gid?c.gid:0)},storeChartScroll:function(b,c){this.isMultiDayMode()?(this.multiGanttHScroll=this.multiGantt.MultiGantt("getHScroll")||0,this.multiGanttVScroll=this.multiGantt.MultiGantt("getVScroll")||0):this.isMonthMode()?
(this.monthGanttHScroll=this.monthGantt.MonthGantt("getHScroll")||0,this.monthGanttVScroll=this.monthGantt.MonthGantt("getVScroll")||0):(this.ganttHScroll=this.gantt.Gantt("getHScroll")||0,this.ganttVScroll=this.gantt.Gantt("getVScroll")||0)},restoreChartScroll:function(b,c){this.isMultiDayMode()?("number"==typeof this.multiGanttHScroll&&0<this.multiGanttHScroll&&(this.multiGantt.MultiGantt("setHScroll",this.multiGanttHScroll),this.multiGanttHScroll=0),"number"==typeof this.multiGanttVScroll&&0<this.multiGanttVScroll&&
this.multiGanttVScroll!=this.multiGantt.MultiGantt("getVScroll")&&(this.multiGantt.MultiGantt("setVScroll",this.multiGanttVScroll),this.multiGanttVScroll=0)):this.isMonthMode()?("number"==typeof this.monthGanttHScroll&&0<this.monthGanttHScroll&&(this.monthGantt.MultiGantt("setHScroll",this.monthGanttHScroll),this.monthGanttHScroll=0),"number"==typeof this.monthGanttVScroll&&0<this.monthGanttVScroll&&(this.monthGantt.MultiGantt("setVScroll",this.monthGanttVScroll),this.monthGanttVScroll=0)):("number"==
typeof this.ganttHScroll&&0<this.ganttHScroll&&this.gantt.Gantt("setHScroll",this.ganttHScroll),"number"==typeof this.ganttVScroll&&0<this.ganttVScroll&&this.ganttVScroll!=this.gantt.Gantt("getVScroll")&&this.gantt.Gantt("setVScroll",this.ganttVScroll))},triggerRestoreScroll:function(b,c){return this.sandbox.trigger("toa.ActivitiesScreen.views.Time.restoreChartScroll",null,this.sandbox.name,this)},getTracks:function(b,c){if(b&&b.delta){var d=Object.keys(b.delta.providers||{});this.currentState.filter.show_tech_trace&&
0!==d.length&&(d={parent:b.pid||null,gid:b.gid||null,qdate:this.currentState.date,filter:this.currentState.filter,panel:this.getOption("panel"),providers:d},this.sendRequest("Time",d,this.handlerGetTracksResponse.bind(this),c,"getTracks"))}},handlerGetTracksResponse:function(b,c,d){c.tracks&&this.gantt.Gantt("updateTracks",c.tracks)}}));d.mixin(d.ActivitiesScreen.views.Time.prototype,d.mixins.EventEmitter)})(toa);(function(d){var c=d.ActivitiesScreen.View;d.ns("toa.ActivitiesScreen.views.ActivitiesMap",d.define(c,function(b){c.apply(this,arguments);$.extend(this.options,{serverControllerName:"Map",areaPreloadDistance:2E3,areaPreloadTtl:3E4});this.isFirstRequest=!0;this.filterInitialData=null;this.currentFilterVersion=_DATA.globalFilterVersion=_DATA.globalFilterVersion||0;this.settingsModel=this.sandbox.model("companySettings");this.mapData=new d.MapData({companySettings:this.settingsModel});this.loadConfig()},
{toString:function(){return"Map view"},suspend:function(b){this.clearRefreshTimer();c.prototype.suspend.call(this,b);this.view.page.hide();this.view.destroyMap();this.clearRefreshTimer()},resume:function(b){c.prototype.resume.call(this,b);this.clearRefreshTimer();this.view.page.show();this.view.renderMap();this.nextStepInit();this.onUpdate("internal");null!==this.filterInitialData&&this.setFilter(this.filterInitialData)},destroy:function(){this.clearRefreshTimer();this.view.destroy();this.view=null},
onChange:function(b){this.onUpdate("internal")},onChanged:function(b,c,d){this.onUpdate("internal")},refresh:function(b){this.onUpdate("internal","refresh"!==b)},onUpdate:function(b,c){var d=this.getTreeRequestParameters(),k={};k[d.tree_identifier]=d;d={trees:k,parent:this.getSelectedResourceId(),selectedGroup:this.getSelectedResourceGroupId(),qdate:this.currentState.date,dates:this.currentState.dates,filter:this.currentState.filter,doNeedFilterContent:this._isNeedFilterContent(),panel:this.getOption("panel"),
windowHeight:this.view.map.height(),windowWidth:this.view.map.width()};c||(d.initialLoad=1);"internal"===b&&(this.sandbox.trigger("global.data.get",{controller:"Map",method:"get",params:d,responseHandler:function(b,d){this.onResponse(b,d,c)}.bind(this)}),this.isFirstRequest=!1)},_isNeedFilterContent:function(){return this.isFirstRequest||this.currentFilterVersion!==_DATA.globalFilterVersion?1:0},onResponse:function(b,c,g){"undefined"!=typeof c.error?this.showError(c.error):this.hideError();this.setRefreshTimer();
if(!c.p)return!1;c.access&&this.viewManager.setPermissions(c.access);var k=new d.Resource(c.p);this.showedResource=k;this.updateTitle(k,c.actions);if(!this.view)return!1;"undefined"!==typeof c.filter_content?(this.currentFilterVersion=_DATA.globalFilterVersion,this.setFilter(c),this.filterInitialData={filter_content:c.filter_content,filter_params:c.filter_params}):this.setFilter(this.filterInitialData);c.p.c?(this.showFilterElements(".recursive_filter"),this.hideFilterElements(".single_operation")):
(this.hideFilterElements(".recursive_filter"),(k.isRoleFieldResource()||k.isRoleVehicle()||k.isTechnician())&&this.showFilterElements(".single_operation"));!1===c.is_past&&!1===c.is_future?(this.showFilterElements(".show_tech_position_filter"),this.showFilterElements(".show_techs_in_area_filter"),this.showFilterElements(".show_traffic_filter")):(this.hideFilterElements(".show_tech_position_filter"),this.hideFilterElements(".show_techs_in_area_filter"),this.hideFilterElements(".show_traffic_filter"));
!c.is_past&&a("allow_non_scheduled")?this.showFilterElements(".show_non_scheduled_filter"):this.hideFilterElements(".show_non_scheduled_filter");this.mapData.setRootResource(k);this.mapData.load(c);this.view.setOption("showDirections",c.directions);this.view.setOption("showTrack",!!c.track);this.view.setOption("showNonScheduled",!!this.currentState.filter.show_non_scheduled);this.view.setOption("filter",this.currentState.filter);this.view.setOption("date",this.currentState.date);this.view.setOption("pid",
this.currentState.providerId);this.view.setOption("gid",this.currentState.groupId);this._area=void 0;this.render(g);"disabled"!=this.cgeo_type&&this.startGeocodeAutoupdate();c.track&&this.onTrackResponse.call(this,b,c,!g);this.viewManager.activitiesPanel.hideGroupMenuElements(c.gid?c.gid:0)},loadConfig:function(){var b={parent:this.getSelectedResourceId(),qdate:this.currentState.date};this.sandbox.trigger("global.data.get",{controller:this.options.serverControllerName,method:"getconf",params:b,responseHandler:this.onConfigLoaded.bind(this)})},
onConfigLoaded:function(b,c){this.distanceUnits=c.distance_units||"km";this.startEndRadius=c.smartgps_start_end_radius||100;this.idleTimeout=c.smartgps_idle_timeout||30;this.fadeResources=!!c.map_fade_resources;this.fadeResourcesThreshold=c.map_fade_res_threshold||10;this.hideResourcesThreshold=c.map_hide_res_threshold||30;this.cgeo_type=c.cgeo_type;this.isSuspended||this.renderLoading();this.mapData.setCompanyBounds(c.company_bounds);this.auth=c.auth;this.nextStepInit()},renderLoading:function(){var b=
this.viewManager.activitiesPanel.viewContainer,c=$('<div class="toa-map-loading-page"><div class="loading"></div><br /><div>'+h(5514)+"</div></div>");b.empty().append(c)},clearLoading:function(){$(".toa-map-loading-page",this.viewManager.activitiesPanel.viewContainer).remove()},nextStepInit:function(){this.isSuspended||("undefined"===typeof OM?this.loadOracleMap():this.view||this.initView())},loadOracleMap:function(){return $.getScript("https://elocation.oracle.com/mapviewer/jslib/v2/oraclemapsv2.js").done(function(b,
c){this.nextStepInit()}.bind(this)).fail(function(b,c,d){setTimeout(this.nextStepInit.bind(this),5E3)}.bind(this))},initView:function(){this.clearLoading();this.view=new d.MapView({content:this.viewManager.activitiesPanel.viewContainer,model:this.mapData,panel:this.getOption("panel"),pid:this.currentState.providerId,date:this.currentState.date,resourceFolder:this.settingsModel.getResourceFolder(),onShowActivityDetails:this.onShowActivityDetails.bind(this),onGetHintResource:this.onGetHintResource.bind(this),
onGetActivityTrack:this.onGetActivityTrack.bind(this),onGetResourcesNearby:this.onGetResourcesNearby.bind(this),distanceUnits:this.distanceUnits,startEndRadius:this.startEndRadius,fadeResources:this.fadeResources,fadeResourcesThreshold:this.fadeResourcesThreshold,hideResourcesThreshold:this.hideResourcesThreshold,cgeo_type:this.cgeo_type,idleTimeout:this.idleTimeout,onActivityMove:this.onActivityMove.bind(this),getAssignHintParams:this.getAssignHintParams.bind(this)},this.sandbox);this.sandbox.trigger("global.hint.assign",
this.getAssignHintParams());this.sandbox.bind("model.companySettings.reload",this.onChanged.bind(this));this.sandbox.bind("global.interface.refresh",this.refresh.bind(this));this.view.init();this.isSuspended||(this.resume(this.options||this.sandbox.options),this.onUpdate("init"));this.resize()},getAssignHintParams:function(b){return{elements:b||this.view.getTwoPanelList(),add_links:["select_provider","hide_nonsheduled_links"],location:this.viewManager.activitiesPanel.position+"ActivitiesPanel"}},
onShowActivityDetails:function(b){this.sandbox.trigger("interface.actions.click",{action:"change_activity",aid:b.aid,pid:b.pid,date:b.date})},onGetHintResource:function(b,c){this.sandbox.trigger("global.data.get",{controller:"Hint",method:"provider",params:{id:c.pid,date:c.date||self.currentState.date},responseHandler:function(b,c){var d=this.mapData.getResource(c.hint_pid);d&&c["short"]&&(d.set("hints",{"short":c["short"],detailed:c.detailed,addActions:c.hint_addActions,actions:c.hint_actions}),
this.view.showHintResource("internal",{id:"pid"+c.hint_pid}))}.bind(this)})},onClearTrack:function(b,c){this.view.clearAllTracks()},onActivityMove:function(b,c){this.moveMultidayActivity=new d.ActivitiesScreen.views.MoveMultidayActivity;var g=d.app.model("routeService");g.moveActivity(b,c).then(function(b){b.hasOwnProperty("multidayActivity")&&(c=$.extend(!0,c,b),this.moveMultidayActivity.render(c))}.bind(this),function(b){app.DebugLogger.log("error promise (check for move activity)");app.DebugLogger.log(arguments)}.bind(this));
this.moveMultidayActivity.addListener("move.multiday.activity",function(k,l){c=$.extend(!0,c,l);g.moveActivity(b,c).then(function(b){b.multidayActivity.hasOwnProperty("moveResult")&&!0!==b.multidayActivity.moveResult?d.ui.Alert({text:d.glossary({id:15343})}):d.app.trigger("global.interface.refresh")}.bind(this),function(b){console.log("error promise (move activity)",arguments)}.bind(this))}.bind(this))},onGetResourcesNearby:function(b,c){function g(){clearTimeout(k._areaTimeout);k._areaTimeout=setTimeout(function(){k._area=
void 0},k.options.areaPreloadTtl)}var k=this;if(this.currentState.filter.show_techs_in_area&&!this.isSuspended&&c.center){var l={radius:c.radius,center:c.center};if(this._area){var n=this._area.center,n=d.utils.geo.distance(n.lat,n.lng,l.center.lat,l.center.lng);l.radius+n>this._area.radius+this.options.areaPreloadDistance&&(this._area=l,this.loadResourcesNearby(),g())}else this._area=l,this.loadResourcesNearby(),g()}},loadResourcesNearby:function(){var b=this.mapData.getRootResource().getId();b&&
this.sandbox.trigger("global.data.get",{controller:"Map",method:"getResourcesNearby",params:{pid:b,qdate:this.currentState.date,radius:this._area.radius,lat:this._area.center.lat,lon:this._area.center.lng},responseHandler:this.onResourcesNearbyLoaded.bind(this)})},onResourcesNearbyLoaded:function(b,c){c.resources_nearby&&(this.view.clearResourcesNearby(),this.mapData.setNearbyResources(c.resources_nearby),this.view.renderResourcesNearby(c.resources_nearby))},onGetActivityTrack:function(b,c){var d,
k,l=this.mapData.getPreviousPoint(c.aid),n=c.zoom||50,p=this.mapData.getRootResource();if(p&&(p=p.getId())){var s=this.mapData.getResource(p);c.aid?(d=(d=this.mapData.getActivity(l))?d.end_time?d.end_time:d.ETA:this.mapData.queueActivated,k=this.mapData.getActivity(c.aid),k=k.end_time?k.end_time:k.ETA):s&&(d=s.get("trackStartDate"),k=s.get("trackEndDate"));d&&this.sandbox.trigger("global.data.get",{controller:"Map",method:"getResourceTrack",params:{pid:p,qdate:this.currentState.date,dateTimeStart:d,
dateTimeEnd:k,idleTimeout:this.idleTimeout,zoom:n},responseHandler:this.onTrackResponse.bind(this)})}},onTrackResponse:function(b,c,d){c&&c.track&&c.track.pid&&c.track.points&&(this.view.clearAllTracks(),this.view.setOption("smartLocationEnabled",!!c.smartlocation_enabled),this.view.setOption("smartgps_idle_timeout",c.smartgps_idle_timeout||0),this.view.renderResourceTrack(c.track,d))},startGeocodeAutoupdate:function(){this.doGeocodeRequest()},doGeocodeRequest:function(){var b=this,c=b.mapData,g=
c.getResolvingIds();$.isEmptyObject(g)||this.sandbox.trigger("global.data.get",{controller:"Map",method:"geocode",params:{ids:d.utils.json.encode(g),pid:this.currentState.providerId,date:this.currentState.date,filter:this.currentState.filter,panel:this.getOption("panel")},responseHandler:function(d,g){if(g&&g.result)for(var n in g.result)if(g.result.hasOwnProperty(n)){c.updateActivities(g.result);b.render();if(g.track)b.onTrackResponse(d,g,!0);break}}})},render:function(b){b=b||!1;if(this.mapData.hasResolved()||
this.mapData.hasResources()||this.mapData.hasLocations())this.hideError(),this.view.setOption("defaultBound",null),this.view.render(b);else{var c=this.mapData.getDefaultBound();c?(this.view.setOption("defaultBound",c),this.view.render(b)):(this.view.clearLayers(),this.showError(h(1451)))}},resizeWindow:function(){this.winResizeTimer&&clearTimeout(this.winResizeTimer);this.winResizeTimer=setTimeout(function(){this.view&&this.view.resize()}.bind(this),500)},updateState:function(){this.view&&this.view.scheduledList&&
(this.view.setOption("date",this.currentState.date),this.view.setOption("showNearbyResources",!!this.currentState.filter.show_techs_in_area),this.view.scheduledList.setOption("date",this.currentState.date));return c.prototype.updateState.apply(this,arguments)}}))})(toa);toa.MapView=toa.define(null,function(d,c){this.sandbox=c;this.options=$.extend({showDirections:!1,showNonScheduled:!1,filter:null,date:null,startEndRadius:100,fadeResources:!0,resourceFolder:"resource",showTrack:!0,distanceUnits:"km",smartLocationEnabled:!1,showNearbyResources:!1,onActivityMove:function(){}},d);this.model=this.options.model;this.createLayout()},{mapContainer:null,panelCaption:null,isFeatureEventsInited:!1,selectedList:null,init:function(){var d=new toa.Template(["<%var f = this.format(obj);%>",
"<tr>",'<td><span class="cap"><%-f.key%></span></td>','<td><span class="text"><%-f.value%></span></td>',"</tr>"]);d.format=this._formatField.bind(this);this.trackHintTpl=new toa.Template('<div><table>;<%=this.kv.apply({key:"time", value:{start:point.t, duration: point.i, status: point.s}})%>;<%=this.kv.apply({key:"coordinates", value:[point.y,point.x]})%>;<%if(point.i && point.s == 8) {%>;<%=this.kv.apply({key:"idletime", value:point.i})%>;<%}%>;</table></div>;<%if (point.a) {%>;<div><table>;<%for(atr in point.a) {%>;<%=this.kv.apply({key:atr, value:point.a[atr]})%>;<%}%>;</table></div>;<%}%>;<% if(obj.message) { %>;<div class="line"></div>;<div><%-obj.message%></div>;<% } %>'.split(";"));
this.trackHintTpl.kv=d;this.cssIconTpl=new toa.Template('<div, par_date="<%-date%>", par_pid="<%-pid%>", aid="<%-aid%>", data-activity-status="<%-status%>", data-activity-worktype="<%-worktype%>", class="map-icon-activity<%isAlert ? " map-icon-activity-alert" : ""%>", style="background-color:#<%-color%>">,<div, par_date="<%-date%>", par_pid="<%-pid%>", aid="<%-aid%>", data-activity-status="<%-status%>", data-activity-worktype="<%-worktype%>", class="map-icon-activity-text map-icon-activity-text-length-<%-length%><%if(inverted) {print(" map-icon-activity-text-inverted")}%>">,<%if(label) {%>,<%-label%>,<%} else {%>,&nbsp;,<%}%>,</div>,</div>'.split(","));
this.scheduledList=toa.view.control.create({xtype:"ActivitiesSortableList",name:"activity-drop-target",restrict:!1,connectWith:'[name="activity-drop-target"]',rows:[],movingDisabled:!1,resourceFolder:this.options.resourceFolder,addClass:"map-list",listeners:{rowDoubleClick:function(c,b){this.showActivityDetails(b.row)}.bind(this),rowClick:function(c,b){var d=b.row;$(b.originalEvent.target).closest(".toa-activities-sortablelist-icon-cell").length?this.closeHint():d.x&&d.y&&(d=this.model.getActivity(d.aid),
this.onActivityClick(d))}.bind(this),move:this._onActivityListMove.bind(this)}});this.renderMap()},_onActivityListMove:function(d,c){var b=c.prevAct,e=c.movingAct,g=c.resource,k=c.date;g.get("pid");var l=["controller=ActivitiesGroup","method=move","target_pid="+g.get("pid"),"target_date="+k];!!g.get("FLAGS")&toa.Resource.prototype.ON_CALL_PROVIDER&&!g.isFlagSet(g.get("FLAGS"),toa.Resource.prototype.REGULAR_PROVIDER)||l.push("move_immediately=true");g.isBucket()||(e.prev=b&&!b.isStarted()?b.get("aid"):
0);e.targetDate=k;this.options.onActivityMove(l,e)},_formatField:function(d){var c=d.key,b=d.value,e={time:function(b){var c=toa.date.parseDate("Y-m-d h:i:s",b.start).getTime(),d=toa.date.formatDate("time",new Date(c));b.duration&&(b=toa.date.formatDate("time",new Date(c+1E3*b.duration)),d=d===b?d:d+"-"+b);return d},speed:function(b){b=parseFloat(b)||0;switch(this.options.distanceUnits){case "km":b=Math.round(b/1E3*36E4)/100;b=h(12603,{"{SPEED}":b});break;case "miles":b=Math.round(b/1609.344*36E4)/
100;b=h(12604,{"{SPEED}":b});break;default:throw"distance_units not set";}return b},accuracy:function(b){b=Math.round(10*parseFloat(b))/10;return h(12605,{"{DISTANCE}":b?b:0})},idletime:function(b){return this.formatInterval(b)},coordinates:function(b){return Array.prototype.join.call(b,",")}};d={time:h(12601),idletime:h("track_hint_duration"),latitude:h(5813),longitude:h(5814),coordinates:h(12612),speed:h(12606),accuracy:h(12607)}[c]||c;c=e[c]?e[c].bind(this,b)():b;return{key:d,value:c}},createLayout:function(){var d=
this.options.content.width();this.map=$("<div>").addClass("toa-map-map").css({position:"absolute",left:0,top:0,bottom:0,width:d-252});this.splitter=$("<div>").addClass("toa-sidebar-resizer").css({position:"absolute",left:d-252,top:0,bottom:0,cursor:"col-resize",zIndex:1E3}).draggable({containment:"parent",axis:"x",stop:function(){var c=this.splitter.position().left;this.prevListWidth=this.page.width()-c-4;this.resize()}.bind(this)});this.multiSelectPanel=$('<div class="multi-select-panel"></div>');
this.tplActivityList=(new toa.Template('<ul>,<% for(var i=0;i<rows.length;i++){ var r=rows[i] %>,<li aid="<%-r.aid%>" class="<%-r.unresolved ? "toa-map-unresolved":""%>">,<div class="toa-map-act-icon toa-map-list-noselect">,<%=r.icon%>,</div>,<div class="toa-map-act-label">,<%-r.label%>,</div>,</li>,<% } %>,</ul>'.split(","))).compile();this.activityList=$('<div class="toa-map-list-activities" />');this.activityList.on("click","li:not(.toa-map-unresolved)",function(c){c=$(c.target);c=c.parentsUntil(this.activityList).add(c);
$(this).attr("aid");c.is(".toa-map-list-noselect")||(c=this.model.getActivity(row.aid),this.onActivityClick(c))}.bind(this));this.activityList.on("mousedown",".map-icon-activity",function(c,b){this.makeDraggable($(this),$(this).closest("li"),c,b);c.preventDefault()}.bind(this));this.list=$("<div>").addClass("toa-map-list").css({left:d-250}).append(this.activityList).append(this.multiSelectPanel);this.queueView=$("<div>").addClass("toa-map-queue-view").css({position:"absolute",top:0,left:0,right:0,
bottom:0}).append(this.map).append(this.splitter).append(this.list);this.page=$("<div>").addClass("toa-map-content").css({position:"absolute",top:0,left:0,right:0,bottom:0,width:"100%",height:"100%"}).append(this.queueView);this.tpList=$("<div>").css({position:"absolute",top:0,bottom:0,width:"100%"}).appendTo(this.list);this.options.content.append(this.page);this.layout=new toa.view.HorizontalTwoPanelView(this.tpList,{bottomOpen:!0,secondPanelVisible:!1,titlePanelVisible:!1});d=new toa.Template(['<div class="toa-map-list-container-title">',
'<div class="toa-map-list-container-title-caption"></div>','<div class="toa-map-list-container-title-counter"></div>',"</div>",'<div class="toa-map-list-container-list"></div>']);this.layout.firstPanel.content.html(d.apply());this.panelCaption=$(".toa-map-list-container-title-caption",this.layout.firstPanel.content);this.layout.resetPanels()},createSelectedList:function(){this.selectedList=toa.view.control.create({xtype:"SelectActivitiesSortableList",name:"activity-drop-target",restrict:!1,connectWith:'[name="activity-drop-target"]',
rows:[],movingDisabled:!1,receiveDisabled:!0,resourceFolder:this.options.resourceFolder,addClass:"map-selected-list sortable-list",moveActionClass:'.toa-map-list-title-actions span[data-action="move_activity_group"]',header:$('<div class="toa-map-list-container-title header-multi-select"><div class="toa-map-list-title-header"><div class="toa-map-list-container-checkbox"><input type="checkbox" class="toa-grid-checkbox" aria-label="'+h(12033)+'"/></div><div class="toa-map-list-container-title-caption"></div><div class="close-button"></div></div><div class="toa-map-list-title-actions"><span role="link" class="action-link" data-action="move_activity_group"></span></div></div>'),
container:$('<div class="toa-map-list-container-list"></div>'),title:h(17110),listeners:{rowDoubleClick:function(d,c){return!1}.bind(this),rowClick:function(d,c){return!1}.bind(this),select:function(d,c){var b="",e=c.selected.length,g=this.getOption("rows"),k=this.getOption("header"),b=$(this.getOption("moveActionClass"),k),l=$.map(c.selected,function(b){return b.draggable?b:null});b.text(h(12664)+" ("+l.length+")");k.parent().toggleClass("toa-map-list-visible-actions",0<l.length);0===e?b=this.getOption("title").replace("{N}",
g.length):(b=c.selected.reduce(function(b,c){return b+c.length},0),b=h("title_activities_selected").replace("{M}",e).replace("{DURATION}",toa.utils.time.minutesToTime(b)));$(".toa-map-list-container-title-caption",k).text(b);c.originalEvent&&(b=$(".toa-grid-checkbox",k).prop("checked"),e<g.length&&b?$(".toa-grid-checkbox",k).prop("checked",!1):e!==g.length||b||$(".toa-grid-checkbox",k).prop("checked",!0))},move:this._onActivityListMove.bind(this),rendered:this.onSelectedListRendered.bind(this)}})},
makeDraggable:function(d,c,b,e){if(!d.data("draggable")){var g=d.clone(!0);$htmlCopy=c.clone(!0);$("#dnd-draggable-save-container").empty().append(g).append($htmlCopy);g.draggable({helper:function(b,c){return(new toa.DnDHint(g,$htmlCopy,h(5579))).getHint()},revert:!1,appendTo:_DATA.dispatcher_container,dragmove:!0,dropIntoUpper:!0,cursorAt:{cursor:"hand",top:-5,left:0}});"repeated"!=e&&g.trigger(b,["repeated"],g.get(0))}},onAreaChange:function(d){clearTimeout(this.areaTimeout);this.areaTimeout=setTimeout(function(){this.options.onGetResourcesNearby("internal",
{center:d.center,radius:d.radius})}.bind(this),650)},destroyMap:function(){this.isFeatureEventsInited&&this.sandbox.off("assignhint.click",this.assignHintClickHandler,"MapView");if(!this.mapContainer||this.mapContainer&&!this.mapContainer.getInstance().$containerDiv)return!1;this.mapContainer.getRoutesLayer().destroy();this.markerLayer&&this.markerLayer.destroy();this.trackLayer&&this.trackLayer.destroy();this.nonScheduledLayer&&this.nonScheduledLayer.destroy();this.mapContainer.destroy();this.nonScheduledLayer=
this.trackLayer=this.markerLayer=this.mapContainer=null;this.isFeatureEventsInited=!1},renderMap:function(){if(this.mapContainer)return!0;this.mapContainer=new app.map.oracle.MapContainer({container:this.map,initOnDemand:!0,markerLayer:!1,infoWindow:new app.map.oracle.InfoWindow({infoWindowStyle:{padding:"0px",height:"31px"},titleStyle:{"border-bottom":"none"},contentStyle:{background:"#FBFBFB","overflow-x":"hidden"}}),modeSwitcher:{visible:!0,offsetX:18,offsetY:68},scaleBar:!0});this.tileLayer=this.mapContainer.getBaseLayer();
this.routesLayer=this.mapContainer.getRoutesLayer();this.nearbyLayer=this.mapContainer.createVectorLayer("nearbyLayer");this.trackLayer=new app.map.oracle.TrackLayer("trackLayer");this.markerLayer=new app.map.oracle.HoverLayer("markerLayer");this.markerCollection=new toa.utils.Collection;this.resourceCollection=new toa.utils.Collection;this.nearbyCollection=new toa.utils.Collection;this.mapContainer.addLayer(this.markerLayer);this.mapContainer.addLayer(this.nearbyLayer);this.mapContainer.addLayer(this.trackLayer);
this.mapContainer.enableDragAndDrop();this.mapContainer.getInstance().$topLayerDIV.on("click touchstart",".hint_link",this.onClickHintAction.bind(this));this.model.isMobilityInterface&&(this.nonScheduledLayer=new app.map.oracle.NonScheduledLayer("non-scheduled",{pid:this.options.pid,qdate:this.options.date,panel:this.options.panel,filter:this.options.filter,sandbox:this.sandbox}),this.nonScheduledLayer.getLayer().addListener("feature.click",this.onNearbyClick,this),this.mapContainer.addLayer(this.nonScheduledLayer.getLayer()),
this.nonScheduledLayer.getLayer().addListener("tool.finish",function(d,c,b){"draw-polygon"===c&&(this.nonScheduledLayer.selectFeatures(b),this.getMultiHintNearby(b).then(this.displayNearbyMultiHint.bind(this)))}.bind(this)))},clearLayers:function(){var d=this.mapContainer&&this.mapContainer.getCircleLayer&&this.mapContainer.getCircleLayer(),c=this.mapContainer&&this.mapContainer.getInstance&&this.mapContainer.getInstance();d&&d.removeAllFeatures&&d.removeAllFeatures();c&&c.closeInfoWindows&&c.closeInfoWindows();
this.trackLayer&&this.trackLayer.removeAllFeatures&&this.trackLayer.removeAllFeatures();this.routesLayer&&this.routesLayer.removeAllFeatures&&this.routesLayer.removeAllFeatures();this.nearbyLayer&&this.nearbyLayer.removeAllFeatures&&this.nearbyLayer.removeAllFeatures();this.markerLayer&&this.markerLayer.removeAllFeatures&&this.markerLayer.removeAllFeatures();this.tileLayer.newUid();this.markerCollection&&this.markerCollection.clear();this.resourceCollection&&this.resourceCollection.clear()},render:function(d){d=
d||!1;this.mapContainer||this.renderMap();this.clearLayers();if(this.tileLayer&&this.tileLayer.displayTraffic){var c=this.mapContainer.dataConfig,b=!!this.sandbox.options.state.filter.show_traffic&&toa.app.get("today")===toa.app.get("date"),c=c&&c.get("map_provider_config");this.tileLayer.displayTraffic(b,c)}this.queueView.show();b=this.getOption("defaultBound",null);this.prevListWidth=250;this.renderScheduledList();!this.model.isRecursively()&&this.model.getRootResource().isTechnician()&&this.renderRoute();
this.renderPoints();this.renderResources();this.resize();!this.isFeatureEventsInited&&this.options.showTrack&&this.initFeatureEvents();this.mapContainer.isInited()||(this.mapContainer.fitDefaultBound(b),this.mapContainer.initInstance());c=this.mapContainer&&this.mapContainer.instance;this.nonScheduledLayer&&this.nonScheduledLayer.deactivate&&this.nonScheduledLayer.deactivate(c);d||(b?this.mapContainer.fitDefaultBound(b):this.mapContainer.fitBoundlayers());this.options.showNearbyResources?(c.addListener(OM.event.MapEvent.MAP_INITIALIZED,
this.onChangeBound,this),c.addListener(OM.event.MapEvent.MAP_RECENTERED,this.onChangeBound,this),c.addListener(OM.event.MapEvent.MAP_AFTER_ZOOM,this.onChangeBound,this)):(c.deleteListener(OM.event.MapEvent.MAP_INITIALIZED,this.onChangeBound,this),c.deleteListener(OM.event.MapEvent.MAP_RECENTERED,this.onChangeBound,this),c.deleteListener(OM.event.MapEvent.MAP_AFTER_ZOOM,this.onChangeBound,this));isMobilityApp()&&(this.model.isBucketGroup()||this.options.showNonScheduled?this.nonScheduledLayer.showToolBar():
this.nonScheduledLayer.hideToolBar());if(!this.options.showNonScheduled&&!this.model.hasShapedMarkers())return!0;this.nonScheduledLayer.setOptions({pid:this.options.pid,gid:this.options.gid,qdate:this.options.date,filter:this.options.filter});this.mapContainer.isInited()?this.activateNonScheduledLayer(c,!d):this.mapContainer.addListenerOnce("map.init",this.activateNonScheduledLayer.bind(this,c,!d))},activateNonScheduledLayer:function(d,c){this.model.hasShapedMarkers()&&c?(this.nonScheduledLayer.refresh(),
this.nonScheduledLayer._layer.removeAllFeatures(),this.nonScheduledLayer._layer.setVisible(!0),this.nonScheduledLayer.setActivities(this.model.shapedMarkers),this.mapContainer.fitBoundlayers(),this.refreshNearbyMultiHint(this.model.shapedMarkers)):(this.nonScheduledLayer.render().done(function(b){this.refreshNearbyMultiHint(b)}.bind(this)),this.nonScheduledLayer._layer.setVisible(!0));this.nonScheduledLayer.initListeners(d)},initFeatureEvents:function(){this.markerLayer.addListener("feature.over",
function(d,c,b){c instanceof app.map.oracle.ActivityMarker&&this.highlightQueue(c.entity.aid);return!1},this);this.assignHintClickHandler=this.onAssignHintClick.bind(this);this.sandbox.on({event:"assignhint.click",owner:"MapView",handler:this.assignHintClickHandler});this.markerLayer.addListener("feature.out",this.unhighlightQueue,this);this.mapContainer.getInstance().addListener(OM.event.MapEvent.MAP_BEFORE_ZOOM,this.unhighlightQueue,this);this.trackLayer&&(this.trackLayer.addListener("feature.out",
this.unhighlightQueue,this),this.trackLayer.addListener("feature.over",function(d,c,b){this.highlightQueue(c.level)},this));this.isFeatureEventsInited=!0},onChangeBound:function(d){d=this.mapContainer.getInstance().getMapWindowBoundingBox();var c=this.mapContainer.transform(d,8307);d=c.getCenter();c=c.getOrdinates();c=toa.utils.geo.distance(c[1],c[0],c[3],c[2]);this.onAreaChange({radius:c/2,center:{lng:d.coordinates[0],lat:d.coordinates[1]}})},getLongitudeDegreeLength:function(){var d=this.mapContainer.getInstance().getMapContext().getCenterPoint(),
d=this.mapContainer.transform(d,8307).getY();return 111E3*Math.cos(d*Math.PI/180)},getAngularResolution:function(){return{width:20/this.getLongitudeDegreeLength(),height:20/111E3}},renderPoints:function(){var d=this.model.isMobilityInterface||!1,c=[],b=[];this.renderLocation("start");this.model.eachPoint(function(c){d&&1===c.unassigned||b.push(c)});b=b.sort(function(b,c){return b.priority>c.priority?1:-1});b.forEach(function(b){var d=new app.map.oracle.ActivityMarker(b.x,b.y,{aid:b.aid,order:b.show_order,
textColor:3==b.resolve_status?"EE0000":"000000",text:b.label,color:b.color,isAlert:3==b.resolve_status?1:0,draggable:!!b.draggable},{content:b.hints&&b.hints.ident||""});d.draggable&&d.setDraggableAttr({aid:b.aid,par_pid:b.pid,par_date:b.date,"data-activity-status":b.astatus,"data-activity-worktype":b.aworktype});d.getInstance().addListener(OM.event.MouseEvent.MOUSE_CLICK,function(c){c.evt.preventDefault();c.evt.stopPropagation();this.model.isMobilityInterface&&this.checkSmallScreen(c.evt);this.onActivityClick(b,
!0)},this);d.getInstance().addListener(OM.event.MouseEvent.TOUCH_TAP,function(c){c.evt.preventDefault();c.evt.stopPropagation();this.onActivityClick(b,!0)},this);c.push({lng:b.x,lat:b.y});this.markerLayer.addFeature(d);this.markerCollection.add(b.aid,d)}.bind(this));this.renderLocation("end")},checkSmallScreen:function(d){try{if($(".toa-map-content").removeClass("small-screen"),d){var c,b,e=$(".toa-map-content").width(),g=d.userX,k=$(".toa-map-map").width();g<k/2?(c=g,b=c+350):(c=d.clientX-350,b=
d.clientX);(0>c||b>e)&&$(".toa-map-content").addClass("small-screen")}}catch(l){console.error(l)}},onAssignHintClick:function(d,c,b){if(d=c.attr("aid"))this.unhighlightQueue(),this.highlightQueue(d),setTimeout(this.unhighlightQueue.bind(this),800)},highlightQueue:function(d){var c=this.markerCollection.getAll(),b=c[d],e=b&&"undefined"!==typeof b.entity.order?b.entity.order:-1;this.markerLayer.highlighted=$.map(c,function(b){var c=null,c=b.entity.order;if("start"===b.entity.type&&0===e||c===e||c===
e-1)return null;c=b.instance.getRenderingStyle();b.fade(0.3);return{instance:b.instance,style:c}}.bind(this));this.trackLayer.highlight(d)},unhighlightQueue:function(){var d=this.markerLayer;d.highlighted&&0<d.highlighted.length&&($.each(d.highlighted,function(c,b){b.instance.setRenderingStyle(b.style)}),d.highlighted=[]);this.trackLayer.unhighlight()},showActivityArea:function(d,c){var b=this.mapContainer.getCircleLayer();b||(this.mapContainer._initCircleLayer(),b=this.mapContainer.getCircleLayer());
b.removeAllFeatures();var e=this.createActivityArea(d.x,d.y,c);b.addFeature(e)},createActivityArea:function(d,c,b){b=b||this.options.startEndRadius;return new app.map.oracle.Circle(d,c,b,{stroke:"#0786e8",strokeOpacity:0.7,strokeWeight:1,fill:"#33bdf7",fillOpacity:0.2})},getStartChatAddress:function(d){for(var c="",b=0;b<d.length;b++)if("sn.chat.create"===d[b].event){c=d[b].params.address;break}return c},onNearbyClick:function(d,c){var b=this.model.getActivity(c.getUID())||{};if(c instanceof app.map.oracle.NearbyVectorMarker){b.aid&&
b.unassigned&&this.selectInList(b.aid);c.entity.date=b.date||toa.date.DAY_WITHOUT_DATE;c.draggable&&c.destroyHtmlCopy();if(c.isMultiMarker())return this.getMultiHintNearby(c).then(this.displayNearbyMultiHint.bind(this)),!1;this.getActivityHint(c.entity,!0).then(this.prepareActivityHint.bind(this))}else if(b.aid)this.onActivityClick(b,!0)},onActivityClick:function(d,c){this.selectInList(d.aid);if(c){var b=this.getAngularResolution(),b=this.model.getAppointmentsNear(d.aid,b),e=this.markerCollection.get(d.aid);
if(1<b.length)return this.getMultiHint(b).then(this.displayActivityMultiHint.bind(this,e)),!1}this.showActivityArea(d);if(d.unassigned&&d.resolve_status===this.model.RESOLVED&&this.model.hasShapedMarkers()){var b=this.nonScheduledLayer.getLayer(),g=b.getFeature(d.aid);g||($.each(this.model.shapedMarkers,function(b,c){c.aid==d.aid?g=c:c.other&&$.each(c.other,function(b,e){$.each(e,function(b,e){if(e.aid==d.aid)return g=c,!1});return!g});return!g}),g&&this.nonScheduledLayer.insertActivities([g],b))}this.getActivityHint(d).then(this.prepareActivityHint.bind(this))},
getActivityHint:function(d,c){var b=new $.Deferred;if(d.short)return b.resolve(d);var e={id:d.aid,par_date:d.date,par_pid:d.pid,add_links:["select_provider"]};c&&(e.nearby=1);this.sandbox.trigger("global.data.get",{controller:"Hint",method:"activity",params:e,errorHandler:b.reject,responseHandler:function(c,e){d=$.extend(d,e);!d.color&&d.at&&d.astatus&&(d.color=this.model.getActivityColor(d.at,d.astatus));if(e.hint_actions)for(var l=0;l<e.hint_actions.length;++l)e.hint_actions[l].label&&"start_chat_with_resource"===
e.hint_actions[l].label&&(e.hint_actions[l].params.aid=d.aid);this.nearbyCollection.add(d.aid,d);return b.resolve(d)}.bind(this)});return b.promise()},getMultiHintNearby:function(d){var c=new $.Deferred,b=[],e={};Array.isArray(d)||(d=[d]);d.forEach(function(c){c.getMarkerAids&&c.getMarkerGrades&&(b=b.concat(c.getMarkerAids()),e=$.extend(e,c.getMarkerGrades()))});this.sandbox.trigger("global.data.get",{controller:"Map",method:"getActivities",params:{aids:b.slice(0,toa.MapView.hintNearbyLimit).join(","),
pid:this.getOption("pid"),date:this.getOption("date")},errorHandler:c.reject,responseHandler:function(b,d){var l=$.map(d.result,function(b){var c=e[b.aid]||{gradeId:"1"};return $.extend(b,{color:app.map.oracle.NearbyVectorMarker.getColorByGrade(c.gradeId),grade:c.gradeId,shape:c.shape||2,rank:c.rank||0,selected:!1,element:null})}.bind(this));return c.resolve(l)}.bind(this)});return c.promise()},getMultiHint:function(d){d=d||[];var c=new $.Deferred,b=$.map(d,function(b){return b.hints["short"]?null:
b.aid});if(!b.length)return c.resolve(d);this.sandbox.trigger("global.data.get",{controller:"Hint",method:"multiactivity",params:{aids:b,par_date:d[0].date,par_pid:d[0].pid,add_links:["select_provider"]},errorHandler:c.reject,responseHandler:function(b,g){$.each(d,function(b,c){!c.color&&c.at&&c.astatus&&(c.color=this.model.getActivityColor(c.at,c.astatus));c.hints["short"]||$.extend(!0,c,g.hints[c.aid])}.bind(this));return c.resolve(d)}.bind(this)});return c.promise()},prepareActivityHint:function(d){var c=
d.hint_actions||[],b=this.getStartChatAddress(c);toa.community&&toa.community.transport||""===b||this.model.isMobilityInterface?""!==b&&this.model.isMobilityInterface?(this.checkCommunityAccess(d.hint_uid,b),this.showActivityHint(d)):""===b?this.showActivityHint(d):this.getUserVisibilty(d,b,"activity").then(this.showActivityHint.bind(this)):(c=this.removeStartChatAction(c),d.hint_actions=c,this.showActivityHint(d));this.hideTip()},hideTip:function(){var d=$(".ui-tip.resource_hint_tip_container");
0<d.length&&d.hide()},showActivityHint:function(d){if(!d)return!1;var c=null,b=this.markerCollection.get(d.aid);!b&&this.nonScheduledLayer&&(b=this.nonScheduledLayer.getLayer()||{},(b=b.getFeature&&b.getFeature(d.aid))&&(c={src:b.getInstance().getRenderingStyle().src}));b&&([].concat.call([],d.hint_actions||[],d.hint_addActions||[]),d=this.formatHint(d,c),d=$('<div class="toa-map-hint toa-hint resource_hint_tip_container"></div>').append(d).prop("outerHTML"),b.showTooltip&&b.showTooltip(d));$("button.hint-back-btn").on("click touchstart",
this.closeHint.bind(this))},displayActivityMultiHint:function(d,c){var b=$.map(c,function(b){if(!b.hasOwnProperty("aid"))return null;b.hint_actions&&b.hint_actions.forEach(function(c){"start_chat_with_resource"===c.label&&(c.params.aid=b.aid)});return this.formatHint(b).get(0)}.bind(this));this.displayMultiHint(d,b)},refreshNearbyMultiHint:function(d){if(this.selectedList&&!this.multiSelectPanel.is(":empty")){var c=[];$.each(d,function(b,d){c.push(d.aid);d.other&&$.each(d.other,function(b,d){$.each(d,
function(b,d){c.push(d.aid)})})});d=this.selectedList.getOption("rows").filter(function(b){return 0<=c.indexOf(b.aid)});if(d.length){var b=[],e=this.nonScheduledLayer.getLayer();d.forEach(function(c){(c=e.getFeature(c.aid))&&0>b.indexOf(c)&&b.push(c)}.bind(this));this.nonScheduledLayer.selectFeatures(b);this.displayNearbyMultiHint(d)}else $(".close-button",this.multiSelectPanel).trigger("click")}},displayNearbyMultiHint:function(d){this.selectedList||this.createSelectedList();var c=this.selectedList.getOption("header"),
b=this.selectedList.getOption("container"),e=this.selectedList.getOption("title").replace("{N}",d.length),g=this.selectedList.getOption("moveActionClass");$(".toa-map-list-container-title-caption",c).text(e);this.multiSelectPanel.removeClass("toa-map-list-visible-actions").empty().append(c).append(b);this.layout.container.hide();$(".close-button",c).on("click",function(b){this.multiSelectPanel.empty();this.layout.container.show();this.nonScheduledLayer.refresh()}.bind(this));toa.fastClick.addHandler($(g,
c).get(0),function(b){var c=[];b=this.selectedList.getSelectedRows();$.each(b,function(b,d){d.draggable&&c.push({aid:d.aid,date:d.date,pid:d.pid})});this.options.onActivityMove(["controller=ActivitiesGroup","method=move","target_date="+this.options.date],{moving_activities:c})},this);$(".toa-grid-checkbox",c).prop("checked",!1).on("change",function(b){this.selectedList.setSelected(b.target.checked)}.bind(this));this.layout.container.hide();this.selectedList.setOption("rows",d.sort(function(b,c){var d=
+b.grade,e=+c.grade;return d!==e?d>e?1:-1:0>b.rank?1:0>c.rank?-1:b.rank!==c.rank?b.rank>c.rank?1:-1:0}));this.selectedList.setOption("selectEnabled",d&&1<d.length);this.selectedList.setOption("softClear",!0);this.selectedList.render(b)},onSelectedListRendered:function(d,c){if(c&&c.source&&c.source.getElement){var b=c.source.getElement();this.sandbox.trigger("global.hint.assign",this.options.getAssignHintParams(b))}},displayMultiHint:function(d,c){var b=null,b=this.mapContainer.getInstance(),e=new toa.HScroller({mapWidth:this.map.width(),
disableButtons:!!this.model.isMobilityInterface}),g=e.init(c);b.closeInfoWindows();d.showTooltip(g.prop("outerHTML"));b=b.infoLayer&&b.infoLayer.$infoWindow;!this.model.isMobilityInterface&&b&&e.initEvents(b)},renderDrivingDirections:function(d,c){var b=new toa.views.directions.DirectionsView(c.route,c.params),e=new toa.ui.Popup({title:h(5806),view:b,autoOpen:!0,width:700});e.setPositionCenter();b.renderAll(e)},getInputDataForDirections:function(d){toa.app.trigger("global.data.get",{controller:"Map",
method:"drivingDirections",params:d,responseHandler:this.renderDrivingDirections.bind(this)})},onClickHintAction:function(d){d.preventDefault();d.stopPropagation();var c=$(d.target).data("name");d=this.getHintActions(d);d=(c=this.getActiveAction(d,c))&&c.params&&c.params.actionOptions?c.params.actionOptions:null;c&&"interface.actions.click.del_from_group"===c.event&&(c.params.gid=$(".resource-groups").first().find(".edt-selected").closest(".resource-groups-item").attr("data-group-id"));if(c&&"cluster.click"===
c.event)return this.trackLayer.zoomToCluster(c.featureId),!1;c&&(isMobilityAction(c.params.action,c.params)?invokeMobilityScreen({action:c.params.action,pid:c.params.pid,aid:c.params.aid,date:c.params.date,actionOptions:c.params.actionOptions||{}}):this.model.isMobilityInterface||"sn.chat.create"!=c.event?this.model.isMobilityInterface&&"sn.chat.create"==c.event?this.startChat(null,c.params.address):d&&"view_directions"===d.baseLabel?this.getInputDataForDirections(c.params):!d||"global.provider.select"!==
d.baseLabel&&"select_provider"!==d.baseLabel?toa.app.trigger(c.event,c.params):toa.app.trigger("global.provider.select",c.params):toa.app.model("Contacts").requestContactWithAddress(c.params.address,{success:function(b){toa.app.trigger("sn.chat.create",b.result)}}),this.closeHint())},getHintActions:function(d){var c,b=$(d.target).data("id");d=$(d.target).data("type");if("activity"===d)(c=this.model.getActivity(b))&&c.hint_actions||(c=this.nearbyCollection.get(b)),c=[].concat.call([],c.hint_actions||
[],c.hint_addActions||[]);else if("resource"===d)b=this.model.getResource(b).get("hints"),c=[].concat.call([],b.actions||[],b.addActions||[]);else if("provider"===d)c=[{event:"global.provider.select",params:{pid:b}}];else if("trace"===d)return[{event:"cluster.click",featureId:b}];return c},getActiveAction:function(d,c){var b=null;$.each(d,function(d,g){g.name===c&&(b=g);if("global.provider.select"===g.event||"cluster.click"===g.event)b=g;return null===b});return b},renderLocation:function(d){var c=
null,b="notActivated";this.model.isDeactivated()?b="deactivated":this.model.isActivated()&&(b="activated");var e=this.model.getLocation(d);e&&"undefined"!=typeof e.x&&"undefined"!=typeof e.y&&(c=new app.map.oracle.LocationMarker(e.x,e.y,{type:d,queueState:b}),c.instance.addListener(OM.event.MouseEvent.MOUSE_CLICK,function(b){b.evt.preventDefault();b.evt.stopPropagation();c.showTooltip(e.hint)},this),this.markerLayer.addFeature(c),this.markerCollection.add(d,c));return c},renderRoute:function(){var d=
[],c=this.model.getRoute();if("google"===toa.app.model("companySettings").getMapProvider())return this.drawRoute(c),!0;for(var b=0;b<c.length-1;b++)d.push([c[b],c[b+1]]);$.each(d,function(b,c){this.drawRoute(c)}.bind(this))},drawRoute:function(d){this.tileLayer.getRoute(d).done(function(c,b){var d=new app.map.oracle.Polyline(c);if(!b||this.tileLayer.uid!=b)return!1;this.routesLayer.addFeature(d)}.bind(this))},renderResourceTrack:function(d,c){if(!d||!d.points)return!1;var b=60*this.getOption("smartgps_idle_timeout",
0);$.each(toa.Gantt.processIdlePoints(d.points,b,!0),function(b,c){this.renderTrackPoint(c)}.bind(this));this.trackLayer.getInstance().redraw();c&&this.markerLayer.fitBounds()},renderTrackPoint:function(d){var c=new app.map.oracle.TrackMarker(d.x,d.y,null,{state:d.s,message:d.s,level:d.ta,time:toa.date.parseDate("Y-m-d h:i:s",d.t)}),b=this.trackHintTpl.apply({point:d,alert:c.getGpsStateToAlert(),message:c.getGpsMessageToMessage()});c.instance.addListener(OM.event.MouseEvent.MOUSE_CLICK,function(d){d.evt.preventDefault();
d.evt.stopPropagation();c.showTooltip(b)},this);this.trackLayer.addFeature(c)},clearAllTracks:function(){var d=this.markerLayer.getFeaturesByType("TrackMarker");$.each(d,function(c,b){b.destroy()})},_timeDiffToVisibility:function(d){return this.options.fadeResources?d>=60*this.options.hideResourcesThreshold?"hidden":d>=60*this.options.fadeResourcesThreshold?"half":"visible":"visible"},renderResources:function(){var d=0.001*toa.date.currentDate().getTimestamp();this.model.eachResource(function(c){var b=
c.get("pos");if(!b)return!1;c.getId();var e=c.icon();if(b.t){var g=this._timeDiffToVisibility(d-b.t);if("hidden"==g)return!1;"half"==g&&(e+="_trans")}b=new app.map.oracle.Marker(b.x,b.y,{src:this.getIconPathByClass(e),width:27,height:37,yOffset:-19});b.getInstance().addListener(OM.event.MouseEvent.MOUSE_CLICK,function(b){b.evt.preventDefault();b.evt.stopPropagation();this.getResourceHint(c).then(this.prepareResourceHint.bind(this))},this);this.markerLayer.addFeature(b);this.resourceCollection.add(c.get("pid"),
b)},this)},checkCommunityAccess:function(d,c){$app.model().communityService().communityContact().searchByAddress(c,1).then(function(b){b.total&&$app.model().user().getId()!==d?$("a.community").removeClass("community-hide"):$("span.start-chat-link").attr("disabled",!0)}).catch(function(b){}.bind(this))},prepareResourceHint:function(d){var c=d.get("hints"),b=c.actions||[],e=this.getStartChatAddress(b);$(".resource-groups").first().find(".edt-selected").closest(".resource-groups-item").attr("data-group-id")||
this.removeDeleteFromGroupAction(b);this.model.isMobilityInterface&&!e&&c.login&&(e=$app.model().communityService().getLoginForCommunity(c.login));toa.community&&toa.community.transport||""===e||this.model.isMobilityInterface?""!=e&&this.model.isMobilityInterface?(this.checkCommunityAccess(c.uid,e),this.showResourceHint(d)):""===e?this.showResourceHint(d):this.getUserVisibilty(d,e,"resource").then(this.showResourceHint.bind(this)):(b=this.removeStartChatAction(b),c.actions=b,d.set("hints",c),this.showResourceHint(d));
this.hideTip()},removeDeleteFromGroupAction:function(d){for(var c=0;c<d.length;c++)if("interface.actions.click.del_from_group"===d[c].event){d.splice(c,1);break}return d},startChat:function(d,c){c||(c=$app.model().communityService().getLoginForCommunity(d));this.sandbox.trigger("sn.chat.create",{address:c});this.closeHint()},logActionLinkEvents:function(d){(d||$app.eventLoggingService)&&$app.eventLoggingService().pushEvent(new app.eventLogging.EventLogging(app.eventLogging.EventLoggingConstants.EVENT_RESOURCE_HINT_ACTION_LINK,
{p:d}))},goToResourceInfo:function(){this.options.pid&&(this.logActionLinkEvents("r"),$app.navigation().redirect("resource-info/"+this.options.pid))},goToResourceCalendar:function(){this.options.pid&&(this.logActionLinkEvents("rc"),$app.navigation().redirect("resource-calendar/"+this.options.pid))},goToResourceWorkZones:function(){this.options.pid&&(this.logActionLinkEvents("rz"),$app.navigation().redirect("resource-work-zones/"+this.options.pid))},goToResourceLocations:function(){this.options.pid&&
(this.logActionLinkEvents("rl"),$app.navigation().redirect("resource-locations/"+this.options.pid))},goToResourceWorkSkills:function(){this.options.pid&&(this.logActionLinkEvents("rs"),$app.navigation().redirect("resource-work-skills/"+this.options.pid))},goToResourceInventory:function(){this.options.pid&&(this.logActionLinkEvents("ri"),$app.navigation().redirect($app.model().urlService().generateUrl("#grid/inventory?no-date=true&__pid=")+this.options.pid))},goToRoute:function(){if(this.options.pid){var d=
$app.model().providerService(),c=$app.storage(),b=toa.app.model("companySettings").settings.user.tz_diff,b=toa.date.formatDate("iso",toa.date.currentDate(b));d.changeProviderAndDate(this.options.pid,b).then(function(b){c.removeMetaData("a_teamid");c.removeMetaData("providerList");c.setMetaData("pname",d.getCurrentProvider().get("pname"));c.setMetaData("holdState",{activity:{},inventory:{},request:{}});b.delta&&$app.controller().redirect("#"+app.context.getResourceHomeScreen(),!0)}.bind(this)).catch(function(b){$app.errorHandler().handleErrorEvent(b)})}},
closeHint:function(){try{this.mapContainer.getInstance().closeInfoWindows()}catch(d){$app.errorHandler().handleErrorEvent(d)}},showResourceHintActionsBar:function(d){d=d.get("hints").login;$(".toa-hint-resource-action-header .toa-resource-hint-actions-bar").removeClass("toa-resource-hint-actions-bar-hide");$("a.community").on("click touchstart",this.startChat.bind(this,d,null));$("a.info").on("click touchstart",this.goToResourceInfo.bind(this));$("a.route").on("click touchstart",this.goToRoute.bind(this));
$("button.hint-back-btn").on("click touchstart",this.closeHint.bind(this));$("span.resource_calendar").on("click touchstart",this.goToResourceCalendar.bind(this));$("span.resource_work_zones").on("click touchstart",this.goToResourceWorkZones.bind(this));$("span.resource_locations").on("click touchstart",this.goToResourceLocations.bind(this));$("span.resource_work_skills").on("click touchstart",this.goToResourceWorkSkills.bind(this));$("span.resource_inventory").on("click touchstart",this.goToResourceInventory.bind(this))},
showResourceHint:function(d){if(!d)return!1;var c=this.resourceCollection.get(d.get("pid"));if(!c)return!1;var b=this.formatHint(d.get("hints"),"resource"),b=$('<div class="toa-map-hint toa-hint resource_hint_tip_container"></div>').append(b);c.showTooltip(b.prop("outerHTML"));this.mapContainer.enableHideHint();this.showResourceHintActionsBar(d)},getResourceHint:function(d){var c=new $.Deferred,b={id:d.get("pid"),date:d.date||this.sandbox.options.state.date};this.sandbox.trigger("global.data.get",
{controller:"Hint",method:"provider",params:b,responseHandler:function(b,g){d&&g["short"]&&d.set("hints",{short:g["short"],detailed:g.detailed,addActions:g.hint_addActions,actions:g.hint_actions,uid:g.hint_uid,login:g.hint_ulogin});return c.resolve(d)}});return c.promise()},getIconPathByClass:function(d,c){d=d.match(/pt\w+/i)[0];c=c?c+"-":"";return toa.app.get("resource_folder")+"/map/resource-icons/"+c+d+".png"},clearResourcesNearby:function(){var d=this.model.getNearbyResources();$.each(d,function(c){if(!this.resourceCollection.has(c))return!0;
this.resourceCollection.remove(c)}.bind(this));this.nearbyLayer.removeAllFeatures()},renderResourcesNearby:function(){var d=this.model.getNearbyResources(),c=0.001*toa.date.currentDate().getTimestamp();$.each(d,function(b,e){if(!d.hasOwnProperty(b))return!0;var g=e.get("pos"),k=e.icon();if(g.t){var l=this._timeDiffToVisibility(c-g.t);if("hidden"==l)return!0;"half"==l&&(k+="_trans")}g&&(g=new app.map.oracle.Marker(g.x,g.y,{src:this.getIconPathByClass(k,"nearby"),width:27,height:37,yOffset:-19}),g.getInstance().addListener(OM.event.MouseEvent.MOUSE_CLICK,
function(b){b.evt.preventDefault();b.evt.stopPropagation();this.getResourceHint(e).then(this.prepareResourceHint.bind(this))},this),this.nearbyLayer.addFeature(g),this.resourceCollection.add(e.get("pid"),g))}.bind(this))},getTwoPanelList:function(){return this.tpList},updatePanelTitle:function(){if(this.panelCaption&&this.panelCaption.html){var d=this.model.isBucketGroup()?h("19323"):h(12648);this.panelCaption.html(d)}},renderScheduledList:function(){var d=this.layout.firstPanel.content,c=d.find(".toa-map-list-container-list"),
d=d.find(".toa-map-list-container-title-counter"),b=this.scheduledList.getOption("resource"),e=this.model.getRootResource(),g=this.model.isBucketGroup(),k=this.model.isRecursively()&&g?this.model.getNotAssignedList():this.model.getScheduledList();this.updatePanelTitle();this.scheduledList.setOption("movingDisabled",!a("allow_reorder_inside_the_route")&&!g);this.scheduledList.setOption("rows",k);this.scheduledList.setOption("resource",e);this.scheduledList.setOption("date",this.sandbox.options.state.date);
this.scheduledList.setOption("softClear",!0);this.scheduledList.render(c);this.layout.resetPanels();b&&b.getId()!==e.getId()&&$(".close-button",this.multiSelectPanel).trigger("click");this.multiSelectPanel.is(":empty")&&this.layout.container.show();d.text(k.length)},getListIcon:function(d){var c=this.cssIconTpl,b=d.label||"",e=d.color.substring("#"===d.color[0]?1:0);return c.apply({isAlert:3==d.resolve_status?1:0,label:b,color:e,date:d.date,pid:d.pid,aid:d.aid,status:d.astatus,worktype:d.aworktype||
d.at,inverted:toa.utils.color.isDark("#"+e),length:2<b.length?"long":""+b.length})},getActivityList:function(){return this.activityList},getContainer:function(){return this.page},resize:function(){this.checkSmallScreen();if(null!==this.prevListWidth&&this.page.is(":visible")){var d=this.page.width();this.prevListWidth>=d&&(this.prevListWidth=250);600<=this.prevListWidth&&(this.prevListWidth=600);this.splitter.css("left",d-this.prevListWidth-2);this.list.css({width:this.prevListWidth,left:d-this.prevListWidth});
this.map.css("width",d-this.prevListWidth-2);this.prevListWidth=this.list.width()}this.layout.resize()},destroy:function(){this.clearLayers();this.destroyMap();this.page.remove()},showActivityDetails:function(d){this.options.onShowActivityDetails(d)},getUserVisibilty:function(d,c,b){var e=new $.Deferred,g=this;toa.app.model("Contacts").requestContactWithAddress(c,{success:function(b){return e.resolve(d)},error:function(){var c;if("activity"===b)c=d.hint_actions||[],c=g.removeStartChatAction(c),d.hint_actions=
c;else{var l=d.get("hints");c=l.actions||[];c=g.removeStartChatAction(c);l.actions=c;d.set("hints",l)}return e.resolve(d)}});return e.promise()},removeStartChatAction:function(d){for(var c=0;c<d.length;c++)if("sn.chat.create"===d[c].event){d.splice(c,1);break}return d},calculateWidthForSmallScreen:function(){var d=$(window).width();if(375>=d)return d-10},formatHint:function(d,c){var b=d.short||d.hints.short,e=[].concat.call([],d.hint_actions||d.actions||[],d.hint_addActions||d.addActions||[]),g=$("<div />"),
k=$("<div />").append(b).appendTo("body");k.css({position:"absolute",left:"-100000px",top:"0"});var l=this.calculateWidthForSmallScreen()||k.width(),e=this.createActions(e,l);k.remove();c&&"activity"!==c?c&&c.src&&(k=$("<span>").css("background-image","url("+c.src+")"),k=$('<div class="toa-map-icon-inline">').html(k),g.append(k)):(k=this.getListIcon(d),k=$('<div class="toa-map-icon-inline">').html(k),g.append(k));g.append(b).append(e).width(Math.min(l,350));return g},createActions:function(d,c){var b,
e,g,k,l=$('<div class="toa-map-hint toa-hint"></div>').appendTo("body");l.css({position:"absolute",left:"-100000px",top:"0",padding:"10px"});var n=$('<div class="hint_links"></div>').appendTo(l),p=$('<div class="hint_links hint_links_mobility"></div>');d=$.isArray(d)?d:[d];for(var s in d){b=d[s].params.aid||d[s].params.pid;g=d[s].params.aid?"activity":"resource";k="";"global.provider.select"===d[s].event&&(g="provider");if("sn.chat.create"===d[s].event&&(b="activity"===g?d[s].params.aid:d[s].params.pid,
k="  start-chat-link",!b))continue;b=$('<span role="link" class="hint_link span_link'+k+'" data-type="'+g+'" data-id="'+b+'" data-name="'+d[s].name+'"></span>').append($.trim(d[s].name));g=$('<span role="link" class="hint_link span_link"></span>').append($.trim(d[s].name));k=$('<span role="separator"></span>').append(" &nbsp; ");n.append(g).append(k);l.width()>c&&(e&&e.detach(),n.empty(),n.append(g).append(k),p.append($("<br/>")));e=$('<span role="separator"></span>').append(" &nbsp; ");p.append(b);
p.append(e)}e.detach();l.remove();return p},showLocationHint:function(d){var c=this.map.Map("getMarkerById","aid"+d);this.map.Map("showHint",c,'<div class="normal_" style="border:none">'+this.model.getLocation(d).hint||d+"</div>")},selectInList:function(d){var c=this.scheduledList,b=c.getOption("rows"),e,g=null;for(e=0;e<b.length;e++)if(1*b[e].aid===1*d){g=e;break}if(null===g)return c.clearSelection(),null;c.select(g)},formatInterval:function(d){function c(b,c){for(b=b.toString();b.length<c;)b="0"+
b;return b}var b=Math.floor(d/60)%60,e=Math.floor(d/3600)%24,g=Math.floor(d/3600/24),b=c(0<d%60?b+1:b,2),e=c(e,2);d="";g&&(d+=g+" ");return d+=[e,b].join(":")},setOption:function(d,c){this.options[d]=c},getOption:function(d,c){var b=this.options[d];return"undefined"===typeof b?c:b}},{hintNearbyLimit:1E3});toa.MapData=toa.define(null,function(){this._create.apply(this,arguments);this.isMobilityInterface=toa.currentInterface===INTERFACE.MOBILITY},{RESOLVING:1,RESOLVED:2,RESOLVED_INVALID:3,isCompanyBoundsSet:!1,isServerInReadOnlyMode:!1,isMobilityInterface:!1,nonScheduledBound:null,isRootBucketGroup:null,oneFeatureZoom:14,recursively:!1,resolvedCount:0,resolvingCount:0,queueIndex:[],queue:{},queueActivated:null,queueDeactivated:null,resources:{},resourcesCount:0,shapedMarkers:[],toString:function(){return"MapData"},
options:{letters:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",companySettings:null},_create:function(d){$.extend(this.options,d);this.initQueueSpatialIndex()},clear:function(){this.recursively=!1;this.resolvingCount=this.resolvedCount=0;this.queueIndex=[];this.queue={};this.queueDeactivated=this.queueActivated=null;this.resources={};this.resourcesCount=0;this.nonScheduledBound=null},load:function(d){this.clear();this.recursively=d.recursively;this.resolvingCount=this.resolvedCount=0;d.read_only_mode&&(this.isServerInReadOnlyMode=
!0);d.queue&&this.setQueue(d.queue);d.queue_activated&&this.setQueueActivated(d.queue_activated);d.queue_deactivated&&(this.queueDeactivated=d.queue_deactivated);d.locations&&this.setLocations(d.locations);d.res&&this.setResources(d.res);d.permissions&&this.setPermissions(d.permissions);this.shapedMarkers=$.isArray(d.markers)?d.markers:[];this.setNonScheduledBound(d.nonScheduledBound||null);this.setCompanyBounds(d.company_bounds)},getCompanyBoundsBoundingBox:function(){var d,c,b,e,g,k,l=this.getCompanyBounds();
if(!l||!l.length)return this.isCompanyBoundsSet=!1,{x1:0,x2:0,y1:0,y2:0};d=l[0];b=Math.max(d.x1,d.x2);e=Math.min(d.x1,d.x2);g=Math.max(d.y1,d.y2);k=Math.min(d.y1,d.y2);for(var n=1;n<l.length;n++)d=l[n],c=Math.max(d.x1,d.x2),c>b&&(b=c),c=Math.min(d.x1,d.x2),c<e&&(e=c),c=Math.max(d.y1,d.y2),c>g&&(g=c),c=Math.min(d.y1,d.y2),c<k&&(k=c);return{x1:e,y1:k,x2:b,y2:g}},getCompanyBounds:function(){return this._companyBounds},isActivated:function(){return!!this.queueActivated},isDeactivated:function(){return!!this.queueDeactivated},
setNonScheduledBound:function(d){d&&$.isNumeric(d.nex)&&$.isNumeric(d.ney)&&$.isNumeric(d.swx)&&$.isNumeric(d.swy)?this.nonScheduledBound={min:{lng:d.swx,lat:d.swy},max:{lng:d.nex,lat:d.ney}}:this.nonScheduledBound=d&&d.x&&d.y?{lng:d.x,lat:d.y,zoom:this.oneFeatureZoom}:null},setCompanyBounds:function(d){this._companyBounds=d},getPermissions:function(d){return this._permissions},setPermissions:function(d){this._permissions=d},setQueue:function(d){this.queue=d;this._prepareActivities(d,"queueIndex",
this.getRootResource().get("date"));this.createQueueSpatialIndex()},updateActivities:function(d){var c,b,e,g,k,l;for(c in d)d.hasOwnProperty(c)&&(e=d[c],b=this.getActivity(c))&&(g=b.resolve_status,$.extend(b,e),b.unresolved=this.getUnresolved(b),e=g===this.RESOLVING,g=g>=this.RESOLVED,k=b.resolve_status===this.RESOLVING,l=b.resolve_status>=this.RESOLVED,!e&&k&&this.resolvingCount++,e&&!k&&this.resolvingCount--,!g&&l&&this.resolvedCount++,g&&!l&&this.resolvedCount--,1===b.unassigned&&this.updateShapedMarker(b));
this._updateActivitiesLetters("queueIndex")},updateShapedMarker:function(d){if(!d||!d.aid||1!==d.unassigned)return null;for(var c={lng:d.x,lat:d.y,grade:d.grade,shape:d.shape,owz:!1,pid:d.pid,at:d.aworktype},b=0;b<this.shapedMarkers.length;b++)if(+this.shapedMarkers[b].aid===+d.aid)return $.extend(this.shapedMarkers[b],c),null;c.aid=+d.aid;this.shapedMarkers.push(c)},initQueueSpatialIndex:function(){this._zoneTree=new ZoneTree},createQueueSpatialIndex:function(){var d=this;d._zoneTree.clear();d.eachPoint(function(c){d._zoneTree.insert(c)})},
getAppointmentsNear:function(d,c){var b=this.getActivity(d);if(b.x&&b.x){var e={};e.x=b.x-c.width/2;e.y=b.y-c.height/2;e.width=c.width;e.height=c.height}return this._zoneTree.retrieveByRegion(e)},setQueueActivated:function(d){this.queueActivated=d},setLocations:function(d){this.locations=d},setResources:function(d){this.resources={};this.resourcesCount=0;var c=this.getRootResource().get("date"),b;for(b in d)this.resources[b]=new toa.Resource(d[b]),this.resources[b].setId(b),this.resources[b].get("date",
c),this.resourcesCount++},setNearbyResources:function(d){this.nearbyResources={};var c=this.getRootResource().get("date"),b;for(b in d)d.hasOwnProperty(b)&&(this.nearbyResources[b]=new toa.Resource(d[b]),this.nearbyResources[b].setId(b).get("date",c))},getNearbyResources:function(){return this.nearbyResources},setRootResource:function(d){if(this.resourceData=d)this.isRootBucketGroup=this.resourceData.isBucket()||this.resourceData.isRoleOrganizationUnit()||this.resourceData.isRoleBucket()},getRootResource:function(){return this.resourceData},
getResource:function(d){return this.resources[d]?this.resources[d]:this.nearbyResources?this.nearbyResources[d]:void 0},eachResource:function(d,c){for(var b in this.resources)d.apply(c||this,[this.resources[b]])},_prepareActivities:function(d,c,b){c&&(this[c]=[]);for(var e in d){var g=d[e];g.aid=e;c&&(this[c][g.show_order]=e);var k=g.astatus;"pending"!=k&&"enroute"!=k||!g.alerts?g.ETA||"cancelled"==g.astatus||(k="not_ordered"):k="warning";g.color=this.getActivityColor(g.aworktype,k);g.priority=this.getShowPriority(g);
g.pid=g.pid||this.getRootResource().getId();g.date=g.date||b;g.label="";g.unresolved=this.getUnresolved(g);b!==toa.date.DAY_WITHOUT_DATE&&(g.resolve_status>=this.RESOLVED&&this.resolvedCount++,g.resolve_status===this.RESOLVING&&this.resolvingCount++)}c&&this._updateActivitiesLetters("queueIndex")},getUnresolved:function(d){return this.isMobilityInterface&&d?0===d.resolve_status||1===d.resolve_status:!1},getActivityColor:function(d,c){return this.options.companySettings?this.options.companySettings.getActivityColorById(d,
c):""},_updateActivitiesLetters:function(d){var c=0;d=this[d]||[];for(var b=0,e;b<d.length;b++)e=this.getActivity(d[b]),!(e.resolve_status>=this.RESOLVED)||this.isMobilityInterface&&e.unassigned||(e.label=this.indexToLiteral(c++))},eachPoint:function(d,c){for(var b in this.queueIndex){var e=this.queue[this.queueIndex[b]];e.resolve_status<this.RESOLVED||d.apply(c||this,[e])}},getPreviousPoint:function(d){d=this.getActivity(d);var c;if(!d)return!1;d=d.show_order;var b;if(!d)return!1;do if(c=this.queueIndex[--d],
b=this.getActivity(c),!c)break;while(c&&!(b.x&&b.y&&b.ETA&&b.end_time)&&0<=d);return c?c:!1},indexToLiteral:function(d){var c="",b=this.options.letters.length,c=this.options.letters.substring(d%b,d%b+1)+c;for(d=parseInt(d/b,10);d;)c=this.options.letters.substring(d%b-1,d%b)+c,d=parseInt(d/b,10);return c},getShowPriority:function(d){var c={complete:1E4,suspended:2E4,cancelled:3E4,notdone:4E4,pending:5E4,started:6E4}[d.astatus]||0,c=c+(1E4-d.show_order);0<=$.inArray(d.astatus,["complete","suspended",
"cancelled","notdone"])&&(c+=d.show_order);d.ETA||(c-=5E3);return c},getRoute:function(){var d=[];this.locations.start&&d.push({lat:this.locations.start.y,lng:this.locations.start.x});for(var c in this.queueIndex){var b=this.queue[this.queueIndex[c]];2!=b.resolve_status&&3!=b.resolve_status||!b.ETA||b.y&&d.push({lat:b.y,lng:b.x})}this.locations.end&&d.push({lat:this.locations.end.y,lng:this.locations.end.x});return d},getResolvingIds:function(){var d={},c,b;for(b in this.queue)this.queue.hasOwnProperty(b)&&
(c=this.queue[b],1===c.resolve_status&&(d[b]={id:b}));return d},hasResolving:function(){return!!this.resolvingCount},hasResolved:function(){return!!this.resolvedCount},hasResources:function(){return!!this.resourcesCount},hasLocations:function(){return this.locations&&(this.locations.start||this.locations.end)?!0:!1},hasShapedMarkers:function(){return 0<this.shapedMarkers.length},getActivity:function(d){return this.queue[d]},getActivityByIndex:function(d){return(d=this.queueIndex[d])?this.getActivity(d):
!1},getLocation:function(d){return this.locations[d]},getActivityTotal:function(){return this.queueIndex.length},isRecursively:function(){return this.recursively},distanceBetween:function(d,c,b,e){var g=(b-d)*Math.PI/180;c=(e-c)*Math.PI/180;d=d*Math.PI/180;b=b*Math.PI/180;d=Math.sin(g/2)*Math.sin(g/2)+Math.sin(c/2)*Math.sin(c/2)*Math.cos(d)*Math.cos(b);return 12742E3*Math.atan2(Math.sqrt(d),Math.sqrt(1-d))},getDefaultBound:function(){var d=this.getLocation("home");return d&&parseFloat(d.x)===d.x&&
parseFloat(d.y)===d.y?{lat:d.y,lng:d.x,zoom:this.oneFeatureZoom}:this.nonScheduledBound},isBucketGroup:function(){return this.isRootBucketGroup},eachActivity:function(d,c){for(var b,e=0;e<this.getActivityTotal();e++){b=this.getActivityByIndex(e);if(!b)break;d.call(c||this,b)}},getScheduledList:function(){var d=[];this.eachActivity(d.push.bind(d),this);return d},getNotAssignedList:function(){var d=[];this.eachActivity(function(c){c.unassigned&&d.push(c)},this);return d}});(function(d){d.ZoneTree=toa.define(null,function(){this.root=new c},{insert:function(b){for(var d=String(1E6+Math.floor(Math.abs(Number(b.x))%10*1E5)).substr(1),g=String(1E6+Math.floor(Math.abs(Number(b.y))%10*1E5)).substr(1),k=[],l=0;6>l;l++)k.push(d.substr(l,1)+g.substr(l,1));d=this.root;p=n="";for(g=0;g<k.length;g++){var l=k[g],n=n+l[0],p=p+l[1];if(null==d.children[l]){d.children[l]=new c;var s=Math.pow(10,-g);d.children[l].bounds={x:Number(n)*s,y:Number(p)*s,width:s,height:s}}d=d.children[l]}null==
d.leaves&&(d.leaves=[]);d.leaves.push(b)},clear:function(){this.root=new c},retrieveByRegion:function(b){var c={x:Math.abs(b.x)%10,y:Math.abs(b.y)%10,width:b.width,height:b.height};0>b.x&&(c.x-=c.width);0>b.y&&(c.y-=c.height);for(var d=[],c=this.root.retrieveByRegion(c),k=0;k<c.length;k++){var l=c[k];l.x>=b.x&&l.x<=b.x+b.width&&l.y>=b.y&&l.y<=b.y+b.height&&d.push(l)}return d}});var c=toa.define(null,function(){this.bounds=!1;this.children={}},{collidesBounds:function(b){var c=this.bounds;return c?
!(c.x>b.x+b.width||b.x>c.x+c.width||c.y>b.y+b.height||b.y>c.y+c.height):!0},retrieveByRegion:function(b){var c=this.children;if(this.leaves)return this.leaves;out=[];for(var d in c)c.hasOwnProperty(d)&&(child=c[d],child.collidesBounds(b)&&(out=out.concat(child.retrieveByRegion(b))));return out}})})(this);(function(d){d.Activity=d.define(d.ModelEntity,function(){this._create.apply(this,arguments)},{idField:"AID",entityDefault:{AID:0,TYPE:"regular",TEMPLATE_ID:0,PID:0,STATUS:"pending",WORKTYPE:0,LABEL:"",GROUP:0,ETA:null,DURATION:0,TRAVEL:0,ALERTS:0,INDEX:0,OVERFLOW:0,DATE:"",X:null,Y:null,ORDERED:!1},fieldName:{AID:"z",TYPE:"T",TEMPLATE_ID:"P",PID:"p",STATUS:"s",WORKTYPE:"t",LABEL:"L",GROUP:"g",ETA:"S",DURATION:"d",TRAVEL:"G",ALERTS:"a",INDEX:"i",OVERFLOW:"o",ORDERED:"O",DATE:"D",X:"x",Y:"y",MASTER_ID:"M"},
fieldKey:{empty:!0},update:function(c){if("object"==typeof c)for(var b in c)null!==c[b]?this.set(b,c[b]):this.setDefault(b)},getStatus:function(){return this.get("STATUS")},isMovable:function(){return!(!this.settings.hasActivityFeature(this.get("worktype"),this.ACTIVITY_FEATURE_ALLOW_MOVE_BETWEEN_RESOURCES)||!this.isPendingGroup())},isAllowReschedule:function(){return!(!this.settings.hasActivityFeature(this.get("worktype"),this.ACTIVITY_FEATURE_ALLOW_RESCHEDULE)||!this.isPendingGroup())},isTravelActivity:function(){return!!this.settings.hasActivityFeature(this.get("worktype"),
this.ACTIVITY_FEATURE_CALCULATE_TRAVEL)},isTeamwork:function(){return!!this.settings.hasActivityFeature(this.get("worktype"),this.ACTIVITY_FEATURE_TEAMWORK)},isNotScheduledSupport:function(){return!(!this.settings.hasActivityFeature(this.get("worktype"),this.ACTIVITY_FEATURE_NOT_SCHEDULED_SUPPORT)||!this.isPendingGroup())},isNotOrderedSupport:function(){return!(!this.settings.hasActivityFeature(this.get("worktype"),this.ACTIVITY_FEATURE_NOT_ORDERED_SUPPORT)||!this.isPendingGroup())},isStartedGroup:function(){return"started"==
this.getStatus()},isPendingGroup:function(){return"pending"==this.getStatus()},isClosedGroup:function(){return-1!=$.inArray(this.getStatus(),["complete","suspended","notdone"])},isCanceledGroup:function(){return-1!=$.inArray(this.getStatus(),["cancelled","deleted"])},isOrdered:function(){return!0==this.get("ordered")||"true"==this.get("ordered")},isNotOrdered:function(){return!this.isOrdered()},isNonScheduled:function(){return d.date.DAY_WITHOUT_DATE==this.get("date")},isCancelled:function(){return"cancelled"==
this.getStatus()},isCompleted:function(){return"complete"==this.getStatus()},isSuspended:function(){return"suspended"==this.getStatus()},isStarted:function(){return"started"==this.getStatus()},isPending:function(){return"pending"==this.getStatus()},isNotdone:function(){return"notdone"==this.getStatus()},isRegular:function(){return"regular"==this.get("type")},isReopened:function(){return"reopened"==this.get("type")},isPrework:function(){return"prework"==this.get("type")},isMultidayActivity:function(){this.get("type");
return"multiday_activity"==this.get("type")},isTemplateWithoutAid:function(){var c=this.getId();isNaN(c)&&"string"===typeof c&&0<=c.indexOf("|")&&(c=c.split("|")[0]);return!isNaN(c)&&0>c},fullDuration:function(){return this.get("duration",0)+this.get("travel",0)},duration:function(){return this.get("duration",0)},getEnd:function(){return this.get("ETA")+this.duration()},getTravelStart:function(){return this.isOrdered()?this.get("ETA")-this.travelTime():0},travelTime:function(){return this.get("travel",
0)},color:function(){var c=this.getStatusToBeHighlighted();return"#"+this.settings.getActivityColorById(this.get("WORKTYPE"),c)},getStatusToBeHighlighted:function(){var c=this.getStatus();this.isNotOrdered()&&!this.isCanceledGroup()&&(c="not_ordered");this.get("ALERTS")&&this.isAlertMoreImportantThanStatus(c)&&(c="warning");return c},isAlertMoreImportantThanStatus:function(c){return 0<=["pending","enroute","not_ordered"].indexOf(c)},isChangeCategory:function(c,b){var e="withoutDate"==c||b==d.date.DAY_WITHOUT_DATE,
g="notOrdered"==c,k=this.get("date")!=d.date.DAY_WITHOUT_DATE,l=this.isOrdered(),n=!1,p="provider"!==c&&"undefined"!==typeof c;p&&g&&g==l&&(n=!0);p&&e&&e==k&&(n=!0);!p||!l&&!k||e||g||(n=!0);return n},checkMoveInternal:function(c,b,e,g){var k="notOrdered"==b;b=this.isChangeCategory(b,c);var l=this.get("pid"),n=this.get("date");return e!=l||c!=n||b?e==l||a("allow_move_between_resources")?e==l||this.isMovable()?n==d.date.DAY_WITHOUT_DATE||c==d.date.DAY_WITHOUT_DATE||c==n||a("allow_reschedule_and_move_to_non_scheduled")?
n==d.date.DAY_WITHOUT_DATE||c!=d.date.DAY_WITHOUT_DATE||a("allow_reschedule_and_move_to_non_scheduled")?n!=d.date.DAY_WITHOUT_DATE||c==d.date.DAY_WITHOUT_DATE||a("allow_move_from_non_scheduled_to_scheduled")?!this.isAllowReschedule()&&(n!=d.date.DAY_WITHOUT_DATE&&c!=d.date.DAY_WITHOUT_DATE&&c!=n||n!=d.date.DAY_WITHOUT_DATE&&c==d.date.DAY_WITHOUT_DATE)?[!1,!0,12208]:!a("allow_non_scheduled")&&g?[!1,!1,6330]:!this.isNotScheduledSupport()&&g?[!1,!0,12209]:!this.isNotOrderedSupport()&&k?[!1,!0,13215]:
e!=l||a("allow_reorder_inside_the_route")||c!=n?this.isTemplateWithoutAid()?[!1,!0,16312]:!0:[!1,!0,15311]:[!1,!1,6322]:[!1,!1,6321]:[!1,!1,6329]:[!1,!0,12207]:[!1,!1,6328]:[!1,!0,12206]},checkBlockMoveInternal:function(c,b,e,g){b=this.get("pid");var k=this.get("date");return e==b||a("allow_move_between_resources")?k==d.date.DAY_WITHOUT_DATE||c==d.date.DAY_WITHOUT_DATE||c==k||a("allow_reschedule_and_move_to_non_scheduled")?k==d.date.DAY_WITHOUT_DATE||c!=d.date.DAY_WITHOUT_DATE||a("allow_reschedule_and_move_to_non_scheduled")?
k!=d.date.DAY_WITHOUT_DATE||c==d.date.DAY_WITHOUT_DATE||a("allow_move_from_non_scheduled_to_scheduled")?!a("allow_non_scheduled")&&g?[!1,!1,6330]:e!=b||a("allow_reorder_inside_the_route")||c!=k?!0:[!1,!0,15311]:[!1,!1,6322]:[!1,!1,6321]:[!1,!1,6329]:[!1,!1,6328]},checkMoveDependingResource:function(c,b,e,g,k){var l=this.get("date"),n=this.get("pid"),n=d.ResourcesTree.getResource(n);if(!b.isActive())return[!1,!1,22201];var p;if(b.hasMultidayData()){if(p=b.getFromMultiday(c,"ZONE_DIFF"),null===p)return[!1,
!1,5570]}else p=b.get("ZONE_DIFF",null);if(!d.date.isDateNotArchived(c,p))return[!1,!1,5572];n=n?n.get("ZONE_DIFF",null):p;if(!d.date.isDateNotArchived(l,n))return[!1,!1,19658];l=b.isAcceptActivity(e,this.isTeamwork());if(5569==l)return[!1,!1,5569];if(b.hasMultidayData()&&!e){if(null===b.getFromMultiday(c,"REGULAR_TIME_FROM")&&null===b.getFromMultiday(c,"ONCALL_TIME_FROM"))return[!1,!1,5570]}else if(5570==l)return[!1,!1,5570];return 16802==l?[!1,!1,16802]:16803==l?[!1,!1,16803]:5571!=l||b.hasMultidayData()&&
null===b.getFromMultiday(c,"DEACTIVATED")?5579!=l||"ordered"!=k||!g||g.isPendingGroup()||g.isSuspended()?!0:[!1,!0,5572]:[!1,!1,5571]},checkMoveForMultidayActivity:function(){if(this.isMultidayActivity()){if(!this.isPendingGroup()&&!this.isStartedGroup())return[!1,!1,10777]}else if(!this.isPendingGroup())return[!1,!1,10777];return!0},checkMoveReturn:function(c,b,d){d=h(d);return{result:c,groupResult:b,message:d,groupMessage:d}},checkMove:function(c,b,e,g,k){if(c&&c.attr("data-date"))return this.checkBlockMove(b,
e,g,k);c=b.getId();e||(e=this.get("date"));var l="withoutDate"==g||e==d.date.DAY_WITHOUT_DATE;l&&(e=d.date.DAY_WITHOUT_DATE);var n=this.checkMoveForMultidayActivity();if(!0!==n)return this.checkMoveReturn(n[0],n[1],n[2]);n=this.checkMoveInternal(e,g,c,l);if(!0!==n)return this.checkMoveReturn(n[0],n[1],n[2]);n=this.checkMoveDependingResource(e,b,l,k,g);return!0!==n?this.checkMoveReturn(n[0],n[1],n[2]):this.checkMoveReturn(!0,!0,5579)},checkBlockMove:function(c,b,e,g){var k;k=c.getId();b||(b=this.get("date"));
var l="withoutDate"==e||b==d.date.DAY_WITHOUT_DATE;l&&(b=d.date.DAY_WITHOUT_DATE);k=this.checkBlockMoveInternal(b,e,k,l);if(!0!==k)return this.checkMoveReturn(k[0],k[1],k[2]);k=this.checkMoveDependingResource(b,c,l,g,e);return!0!==k?this.checkMoveReturn(k[0],k[1],k[2]):this.checkMoveReturn(!0,!0,5579)},toString:function(){return"Activity model"},PREVIOUS_NOT_ORDERED:-1,PREVIOUS_SCHEDULE_START:0,PREVIOUS_SCHEDULE_END:-100,PREVIOUS_ORDER_BY_SWE_SWS_AID:-101,PREVIOUS_IGNORE:-200,PREVIOUS_UNDEFINED:-999,
ENTITY_ACTIVITY:1,ENTITY_ACTIVITY_TEMPLATE:6,ENTITY_VISIT:8,WARNING_SUCC_MISSCHEDULED:1,APPT_WARNING_SUCC_WRONG_START_ORDER:2,APPT_WARNING_PRED_MISSCHEDULED:4,APPT_WARNING_PRED_IS_CANCELED:8,APPT_HINT_PRED_IS_COMPLETE:16,APPT_HINT_PRED_IS_DONE:32,APPT_WARNING_SYNC_MISSCHEDULED:64,APPT_WARNING_SYNC_IS_CANCELED:128,APPT_WARNING_SYNC_WRONG_COMPLETE_ORDER:256,APPT_HINT_SYNC_TIME_TO_START:512,APPT_HINT_SYNC_IS_STARTED:1024,APPT_WARNING_SW:2048,APPT_WARNING_WORKZONE_MISMATCH:4096,APPT_WARNING_WORKSKILL_MISMATCH:8192,
APPT_WARNING_SLA:16384,MOVE_OPTION_INGORE_WORKZONE_MISMATCH:1,MOVE_OPTION_INGORE_WORKSKILL_MISMATCH:2,ACTIVITY_FEATURE_ALLOW_MOVE_BETWEEN_RESOURCES:2,ACTIVITY_FEATURE_ALLOW_CREATE_IN_BUCKETS:4,ACTIVITY_FEATURE_ALLOW_RESCHEDULE:8,ACTIVITY_FEATURE_NOT_ORDERED_SUPPORT:16,ACTIVITY_FEATURE_WORK_ZONE_SUPPORT:32,ACTIVITY_FEATURE_WORK_SKILL_SUPPORT:64,ACTIVITY_FEATURE_TIME_SLOT_SUPPORT:128,ACTIVITY_FEATURE_INVENTORY_SUPPORT:256,ACTIVITY_FEATURE_LINK_SUPPORT:512,ACTIVITY_FEATURE_ALLOW_MASSIVE:1024,ACTIVITY_FEATURE_ALLOW_RECURRENT:2048,
ACTIVITY_FEATURE_CALCULATE_TRAVEL:4096,ACTIVITY_FEATURE_PREDEFINED_DURATION:8192,ACTIVITY_FEATURE_CALCULATE_DELIVERY_WINDOW:16384,ACTIVITY_FEATURE_ALLOW_SEARCH:32768,ACTIVITY_FEATURE_ALLOW_CREATE_BY_I2:65536,ACTIVITY_FEATURE_ENABLE_DAY_BEFORE:131072,ACTIVITY_FEATURE_ENABLE_REMINDER_AND_CHANGE:262144,ACTIVITY_FEATURE_ENABLE_NOT_STARTED:524288,ACTIVITY_FEATURE_ENABLE_SW_WARNING:1048576,ACTIVITY_FEATURE_TEAMWORK:2097152,ACTIVITY_FEATURE_NOT_SCHEDULED_SUPPORT:4194304,APPT_WARNING_SUCC_MISSCHEDULED:1,
APPT_WARNING_MAX_DELAY:2097152,APPT_WARNING_DAY_MISMATCH:4194304,APPT_WARNING_WRONG_DAY:8388608,APPT_WARNING_RESOURCE_MISMATCH:16777216,APPT_WARNING_WRONG_RESOURCE:33554432,GROUP_ORDERED:0,GROUP_NOT_ORDERED:1,GROUP_NOT_SCHEDULED:2})})(toa);window.toa||(window.toa={});var currentTipElement=null;
toa.Gantt={options:{settings:null,lines:[],width:1200,height:300,timeRatio:1,timePadding:100,hidden:!1,minColWidth:40,lineHeight:27,animate:!0,responceDelay:100,showPageSize:50,gpsStatusToClass:{0:"gps-status-normal",1:"gps-status-alert",2:"gps-status-alert",3:"gps-status-none",4:"gps-status-alert",8:"gps-status-idle"},daysInCache:250},_create:function(){var d=this.options,c=this.element;toa.browser.msie&&(d.animate=!1);navigator.userAgent.toLowerCase();this.oldData={};this.canvasMargin=1440;this.offset=
0;this.lastTotals={};this.lblSeeActions=generate_id();this.gantLblId=generate_id();this.featureToggler=toa.app.model("featureToggler");this.dropOnDivAllowed=!0;c.addClass("toaGantt");c.html(['<table role="none">            <tr class="toaGantt-head">            <td><div class="toaGantt-provTree">                <div class="toaGantt-canvas">',h(8214),'</div></div>                <span id="',this.lblSeeActions,'" class="hidden">',h(8074),'</span>                </td>            <td>            <div class="toaGantt-timeChart oj-scrollbar-force">                <div class="toaGantt-canvas">&nbsp;</div></div></td>            <td><div class="toaGantt-notOrdered">                <div class="toaGantt-canvas">                    <span title="',
h(8087),'" role="img" aria-label="',h(8087),'" class=\'toaGantt-notOrdered-icon\'>&nbsp;</span>                    </div></div></td>            <td><div class="toaGantt-withoutDate">                <div class="toaGantt-canvas">                <span title="',h(8203),'" role="img" aria-label="',h(8203),'" class=\'toaGantt-withoutDate-icon\'>&nbsp;</span>                </div></div></td>            <td><div class="toaGantt-vScroll oj-scrollbar-force">                <div class="toaGantt-canvas">&nbsp;</div></div></td>            </tr>            <tr class="toaGantt-body">            <td><div class="toaGantt-provTree">                <div class="toaGantt-canvas"></div>                </div></td>            <td><div class="toaGantt-timeChart oj-scrollbar-force">                <div class="toaGantt-canvas"></div></div></td>            <td><div class="toaGantt-notOrdered">                <div class="toaGantt-canvas"></div></div></td>            <td><div class="toaGantt-withoutDate">                <div class="toaGantt-canvas"></div></div></td>            <td><div class="toaGantt-vScroll oj-scrollbar-force">                <div class="toaGantt-canvas"></div></div></td>            </tr>            <tr class="toaGantt-bottom">            <td><div class="toaGantt-provTree">                <div class="toaGantt-canvas"></div></div></td>            <td><div class="toaGantt-timeChart oj-scrollbar-force">                <div class="toaGantt-canvas"></div></div></td>            <td><div class="toaGantt-notOrdered">                <div class="toaGantt-canvas"></div></div></td>            <td><div class="toaGantt-withoutDate">                <div class="toaGantt-canvas"></div></div></td>            <td><div class="toaGantt-vScroll oj-scrollbar-force">                <div class="toaGantt-canvas"></div></div></td>            </tr>            </table>'].join(""));
this.options.enableWithoutDate||c.find(".toaGantt-withoutDate").closest("td").hide();this.divs={};this.canvases={};this.colsName=["provTree","timeChart","notOrdered","withoutDate","vScroll"];this.rowName=["head","body","bottom"];this.dragable=[1,2];this.dropable=[1,2];this.lines=[];this.vScrollPos=this.hScrollPos=0;this.timeMouseLine=this.timeLine=null;this.hourLine=[];this.hourLineLabel=[];this.defaultMinTime=0;this.defaultMaxTime=1920;this.minTime=this.defaultMinTime;this.maxTime=this.defaultMaxTime;
this.lastHeight=this.lastWidth=this.dtime=0;this.lastShow=this.firstShow=1;this.loading=null;this.scrollWidth=this.getScrollWidth();this.timerUpdateLabels={notOrdered:null,withoutDate:null};this.data=new toa.TimeViewData;this.shifts={};this._cachingDivs()},_init:function(){this._setupDivs();this.setHeight();this.setWidth(0,this.options.withoutRequest);this.setHScroll();this._createMouseLine();this._createTimeLine();this._createHourLine();this._createHint()},_setupDivs:function(){var d=this;d.element.delegate("div.toaGantt-tb",
"mouseenter",function(b,c){var d=$(this).data("master-id");""!=d&&$('div.toaGantt-tb[data-master-id="'+d+'"]').addClass("toaGantt-multiday-segment");$(this).addClass("toaGantt-tb-hover")});d.element.delegate("div.toaGantt-tb","mouseout",function(b,c){var d=$(this).data("master-id");""!=d&&$('div.toaGantt-tb[data-master-id="'+d+'"]').removeClass("toaGantt-multiday-segment");$(this).removeClass("toaGantt-tb-hover")});d.element.delegate("div.toaGantt-tb","mousedown touchstart",toa.helper.activity.makeDraggable);
var c={parent:d,settings:d.options.settings},b=new toa.GanttTargetDivsProvider(c);d.divs.provTree.body.css("zIndex",100).droppable({tolerance:"pointer",accept:"[aid][movable!=false]",dragmove:b.handlerOnDragMove,drop:b.handlerOnDrop});var e=new toa.GanttTargetDivsOrdered(c);d.divs.timeChart.body.css("zIndex",101);toa.dom.isTouch?d.divs.timeChart.body.droppable({tolerance:"pointer",accept:"[aid][movable!=false]",dragmove:function(c,k){c.originalEvent.target=c.target=document.elementFromPoint(c.originalEvent.clientX,
c.originalEvent.clientY);var g=d.ipad.provTree;c.originalEvent.clientX>=g.left&&c.originalEvent.clientX<=g.left+g.width&&c.originalEvent.clientY>=g.top&&c.originalEvent.clientY<=g.top+g.height?b.dragmove(c,k):e.dragmove(c,k)},drop:function(c,k){c.originalEvent.target=c.target=document.elementFromPoint(c.originalEvent.clientX,c.originalEvent.clientY);var g=d.ipad.provTree;c.originalEvent.clientX>=g.left&&c.originalEvent.clientX<=g.left+g.width&&c.originalEvent.clientY>=g.top&&c.originalEvent.clientY<=
g.top+g.height?b.drop(c,k):e.drop(c,k)}}):d.divs.timeChart.body.droppable({tolerance:"pointer",accept:"[aid][movable!=false]",dragmove:e.handlerOnDragMove,drop:e.handlerOnDrop});var g=new toa.GanttTargetDivsNotOrdered(c);d.divs.notOrdered.body.css("zIndex",102).droppable({tolerance:"pointer",accept:"[aid][movable!=false]",dragmove:g.handlerOnDragMove,drop:g.handlerOnDrop});c=new toa.GanttDropActionWithoutDate(c);d.divs.withoutDate.body.css("zIndex",103).droppable({tolerance:"pointer",accept:"[aid][movable!=false]",
dragmove:c.handlerOnDragMove,drop:c.handlerOnDrop});for(g=c=0;2>=g;g++){var k=d.colsName[g],l=d.divs[k],c=c+l.body.parent().width();if(d.options.enableWithoutDate||"withoutDate"!=d.colsName[g+1])l.resizer=$("<div/>").addClass("toaGantt-resize-helper").data("colName",k).data("colNameNext",d.colsName[g+1]).css("left",c).draggable({axis:"x",cursor:"col-resize",zIndex:5E3,scope:"timeviewtable",start:function(b,c){$(this).data("start",c.position.left);var e=$(this).next(".toaGantt-resize-helper"),e=e.length?
e.position().left:d.element.width()-30,k=$(this).prev(".toaGantt-resize-helper"),k=k.length?k.position().left:30;$(this).data("max",e-30);$(this).data("min",k+30)},drag:function(b,c){var d=$(this).data("max");c.position.left>d?c.position.left=d:(d=$(this).data("min"),c.position.left<d&&(c.position.left=d))},stop:function(b,c){var e=$(this).data("colName"),k=$(this).data("colNameNext"),g=c.position.left-$(this).data("start"),l=d.divs;d.setColWidth(e,l[e].body.width()+g);d.setColWidth(k,l[k].body.width()-
g);d._recalculateResizers();d.setHScroll();d._updateLabels()}}).appendTo(d.element)}d.divs.timeChart.bottom.css({"overflow-x":"auto",height:d.scrollWidth}).scroll(function(){d.setHScroll()});d.canvases.timeChart.bottom.css({height:"1px"});d.divs.vScroll.body.css({"overflow-y":"auto"}).scroll(function(){d.setVScroll(d.divs.vScroll.body.scrollTop())});d.setColWidth("vScroll",d.scrollWidth);d.divs.notOrdered.body.delegate(".toaGantt-label","mousedown",function(b,c){var e=$(this).parent().attr("par_pid");
d._trigger("clickCounterLabel",null,{pid:e,group:"notOrdered"})});d.divs.withoutDate.body.delegate(".toaGantt-label","mousedown",function(b,c){var e=$(this).parent().attr("par_pid");d._trigger("clickCounterLabel",null,{pid:e,group:"withoutDate"})});d.element.bind("mousewheel",function(b,c,e,k){c=40;var g=1;"MacIntel"==window.navigator.platform&&(c=2,g=-1);b.shiftKey?0===e&&(b=d.divs.timeChart.bottom,k=b.scrollLeft()-k*c,b.scrollLeft(k)):(b=d.divs.vScroll.body,k=b.scrollTop()-k*c,b.scrollTop(k));0!==
e&&(b=d.divs.timeChart.bottom,k=b.scrollLeft()-e*c*g,b.scrollLeft(k))});d._initTouch()},_initTouch:function(){var d=this;d.touch={lastX:0,lastY:0,moved:!1};d.element.bind("touchstart",function(c){c=c.originalEvent.changedTouches[0];d.touch.lastX=c.clientX;d.touch.lastY=c.clientY;d.touch.moved=!1});d.element.bind("touchend touchcancel",function(c){if(!_DATA||!_DATA.ipadDrag){if(d.touch.moved)return c.preventDefault(),!1;c=c.originalEvent.changedTouches[0];touchTrigger("mousedown",c);touchTrigger("click",
c)}});d.element.bind("touchmove",function(c){if(!_DATA||!_DATA.ipadDrag){d.touch.moved=!0;var b=c.originalEvent.changedTouches[0],e=b.clientX,g=d.touch.lastX-e;d.touch.lastX=e;e=b.clientY;b=d.touch.lastY-e;d.touch.lastY=e;e=d.divs.timeChart.bottom;g=e.scrollLeft()+g;e.scrollLeft(g);e=d.divs.vScroll.body;g=e.scrollTop()+b;e.scrollTop(g);if(!toa.dom.isTouch)return c.preventDefault(),!1}})},_initTouchData:function(){if(!toa.dom.isTouch)return!1;void 0==this.ipad&&(this.ipad={});var d=this.divs.provTree.body,
c=d.offset();this.ipad.provTree={top:c.top,left:c.left,width:d.width(),height:d.height()};return!0},_createMouseLine:function(){var d=this;d.timeMouseLine=$('<div class="toaGantt-mouse-line"/>');d.timeMouseLine.appendTo(d.divs.timeChart.body);d.timeMouseLineHead=$('<div class="toaGantt-mouse-line-head"/>').appendTo(d.canvases.timeChart.head);d.divs.timeChart.head.mousemove(function(c,b){if($(c.originalEvent.target||c.target).hasClass("ui-icon"))d.timeMouseLine.css({display:"none"}),d.timeMouseLineHead.css({display:"none"});
else{var e=d.absoluteToBody(c.pageX),g=d.viewToTime(e,!0);d.timeMouseLineHead.html(d.formatTime(g)).css({left:e-17+d.getElementOffset()+"px",height:d.lastHeight+"px",display:"block"});d.timeMouseLine.css({left:e+"px",top:"0px",display:"block"})}});d.divs.timeChart.head.mouseleave(function(c){d.timeMouseLine.css({display:"none"});d.timeMouseLineHead.css({display:"none"})})},_createTimeLine:function(){this.timeLine=$('<div class="toaGantt-time-line"/>');this.timeLine.appendTo(this.canvases.timeChart.body);
this.timeLine.css({top:"0px"});this.timeLineHead=$('<div class="toaGantt-time-line-head"/>');this.timeLineHead.appendTo(this.canvases.timeChart.head);this._updateTimeLine()},_updateTimeLine:function(){if(this.timeLine){var d=this.getTime(),c=0;"undefined"===typeof d?this.timeLineHead.hide():(c=this._timeToView(d,!0),this.timeLineHead.css({left:c+this.getElementOffset()-17+"px",display:"block"}).text(this.formatTime(d)));this.timeLine.css({left:c+this.getElementOffset()+"px",display:"block"})}},setCurrentTime:function(d){this.dtime=
d;this._updateTimeLine()},_createHourLine:function(){for(var d,c=0;168>c;c++)d=$('<div class="toaGantt-hour-line"/>'),d.css({top:"0px",left:this._timeToView(60*c,!0)-this.getCanvasOffset()+"px",height:this.lastHeight+"px",display:"block"}),this.canvases.timeChart.body.append(d),this.hourLine.push(d),d=24>c?c:c%24,d=$('<div class="toaGantt-hour-line-head"/>').css("left",this._timeToView(60*c,!0)-this.getCanvasOffset()+"px").html(d).appendTo(this.canvases.timeChart.head),this.hourLineLabel.push(d)},
_updateHourLine:function(){for(var d in this.hourLine){var c=this._timeToView(60*d,!0)-this.offset;this.hourLine[d].css({left:c+"px"});this.hourLineLabel[d].css("left",c+"px")}},_createHint:function(){this.hint=$('<div class="toaGantt-hint"></div>')},_cachingDivs:function(){var d=this.colsName,c;for(c in d){var b=d[c];this.divs[b]={prevColName:d[c-1],nextColName:d[+c+1]};this.canvases[b]={};for(var e in this.rowName){var g=this.rowName[e];this.divs[b][g]=this.element.find("tr.toaGantt-"+g+" div.toaGantt-"+
b);this.canvases[b][g]=this.element.find("tr.toaGantt-"+g+" div.toaGantt-"+b+" div.toaGantt-canvas")}}this.canvases.timeChart.head.css("left",-this.getCanvasOffset());this.canvases.timeChart.body.css("left",-this.getCanvasOffset());this.canvases.provTree.body.css("left",-this.getCanvasOffset());this.timeScaleDiv=this.divs.timeChart.head.children("div.toaGantt-time-scale")},formatTime:function(d){var c=new Date;c.setHours(0,d,0,0);return toa.date.formatDate("time",c)},_timeToView:function(d,c){return Math.ceil(c?
(d-this.minTime)*this.options.timeRatio:d*this.options.timeRatio)},viewToTime:function(d,c){return parseInt(c?d/this.options.timeRatio+this.minTime:d/this.options.timeRatio,10)},absoluteToBody:function(d){return d-this.divs.timeChart.body.offset().left+this.hScrollPos-0},setTimeRatio:function(d){d!==this.options.timeRatio&&(this.options.timeRatio=d&&!isNaN(d)?d:1,this.canvases.timeChart.bottom.width(this._timeToView(this.maxTime-this.minTime)),this.canvases.timeChart.body.css("left",-this.getElementOffset()),
this.canvases.timeChart.head.css("left",-this.getElementOffset()),this._updateView(!0),this._updateHourLine(),this._updateTimeLine(),this._updateLabels(),this._trigger("ratioChanged",null,{ratio:this.options.timeRatio}),d=this._timeToView(this.lastTotals.min_time-this.minTime-this.options.timePadding),this.setHScroll(d))},resize:function(d){this.scrollWidth=this.getScrollWidth();this.setWidth(d.width,d.withoutRequest);this.setHeight(d.height)},getScrollWidth:function(){if(this.cachedScrollWidth)return this.cachedScrollWidth;
var d=$('<div class="oj-scrollbar-force" style="position:absolute;left:-1000px;width:100px;height:100px;overflow:scroll"><div style="width:200px;height:200px">Test</div></div>');d.appendTo("body");var c=d[0].offsetWidth-d[0].clientWidth+1;d.remove();return this.cachedScrollWidth=c},setVScroll:function(d,c){var b=this;b.vScrollPos=d;b.divs.timeChart.body.scrollTop(d);b.divs.provTree.body.scrollTop(d);b.divs.notOrdered.body.scrollTop(d);b.divs.withoutDate.body.scrollTop(d);b.divs.vScroll.body.scrollTop(d);
clearTimeout(b.vSrollTimer);clearTimeout(b.timeOutUpdate);clearTimeout(b.timeOutPaging);c||(b.vSrollTimer=setTimeout(function(){b._updateView()},b.options.responceDelay),b.timeOutPaging=setTimeout(function(){for(var c=b.data.getVisibleProviders(b.firstShow,b.lastShow+b.options.showPageSize),d=b.firstShow;d<b.lastShow;d++)if(!c[d]){b.showWait((d-1)*b.options.lineHeight);b._trigger("updatePage",null,b.data.getCachedRange(b.firstShow,b.lastShow,b.options.showPageSize));break}},3*b.options.responceDelay))},
getVScroll:function(){return this.vScrollPos},setHScroll:function(d){"number"!=typeof d||isNaN(d)?d=this.divs.timeChart.bottom.scrollLeft():this.divs.timeChart.bottom.scrollLeft(d);this.hScrollPos=d;this.divs.timeChart.head.scrollLeft(d);this.divs.timeChart.body.scrollLeft(d);this.timeScaleDiv.css({left:d+"px"});this._updateTimeLine()},getHScroll:function(d){return this.hScrollPos},setHeight:function(d,c){var b=this.divs,e=this.element.height()?this.element.height():$(window).height(),e=d?d:e;this.element.height(e);
b.timeChart.bottom.height(this.scrollWidth);var e=this.lastHeight=e-b.timeChart.head.parent().outerHeight()-b.timeChart.bottom.parent().outerHeight(),g;for(g in b)b[g].body.height(e);(b=b.timeChart.body.children(".toaGantt-canvas").first())&&b.height&&0<b.height()&&b.height()<e&&(b.height(e),b.children(".toaGantt-hour-line").height("inherit"),b.children(".toaGantt-time-line").height("inherit"));this._updateHourLine();this._updateTimeLine();this._updateView()},setWidth:function(d,c){var b=this,e=d?
d:b.element.width();!0!==c&&clearTimeout(b.resizeTimeOut);b.element.width(e);b.setColWidth("vScroll",b.scrollWidth);b.lastWidth=e;b._resizeCol("timeChart");b._recalculateResizers();!0!==c&&(b.resizeTimeOut=setTimeout(function(){b.update()},5*b.options.responceDelay))},setColWidth:function(d,c){if(!(0>=c)){var b=this.divs[d];b.head.width(c);b.body.width(c);b.bottom.width(c);b.width=c}},_recalculateResizers:function(){var d=this.divs,c;for(c in d){var b=d[c];b.width=b.body.width();if(b.resizer){var e=
d[b.nextColName];e&&e.body.is(":visible")&&b.resizer.css("left",e.body.position().left)}}},_updateLabels:function(d,c){var b=this;if(!d)setTimeout(function(){b._updateLabels("notOrdered");b._updateLabels("withoutDate")},1);else if("notOrdered"===d||"withoutDate"===d)for(var e in b.lines){var g=b.lines[e];g&&(g[d].remove(),delete g[d],g[d]=b._createNoWtQueueLine(e,d),b.canvases[d].body.append(g[d]))}},_resizeCol:function(d){var c=this.divs,c=this.lastWidth-c.provTree.body.parent().outerWidth()-c.timeChart.body.parent().outerWidth()-
c.notOrdered.body.parent().outerWidth()-(this.options.enableWithoutDate?c.withoutDate.body.parent().outerWidth():0)-(20<c.vScroll.body.parent().outerWidth()?c.vScroll.body.parent().outerWidth():20)+c[d].body.parent().outerWidth();this.setColWidth(d,c)},createProviderBar:function(d){return toa.TemplateCache.create("views/gantt/Gantt.createProviderBar",'<div class="toaGantt-tb toaGantt-tb-name" id="<%- labelForProviderBar %>">,<div role="button",aria-haspopup="true",aria-labelledby="<%- labelForProviderBar %>",aria-describedby="<%- describeForProviderBar %>",aria-dropeffect="popup",pid="<%= p.getId() %>",class="<%= p.icon() %>">,&nbsp;,</div>,<span class="none-core" id="<%- describeForProviderBar %>"><%- h(8074)/*Click to view actions*/%></span>,&nbsp;<%- p.getName() %>,</label>,</div>'.split(",")).apply({p:d,
labelForProviderBar:generate_id(),describeForProviderBar:generate_id()})},createShifts:function(d){var c=toa.TemplateCache.create("views/gantt/Gantt.createShifts.oncall",'<div class="toaGantt-oncall-shift<% if (typeof(decoration) !== "undefined") { %> decoration-<%= decoration %>" aria-label="<%= h(app.constants.ON_CALL_DECORATION_ARIA_LABELS[decoration]) %><% } %>",style="left: <%= left %>px; width: <%= width %>px;">,<% if (text) { %>,<span class="toaGantt-oncall-shift-name">,<%- text %>,</span>,<% } %>,</div>'.split(",")),
b=toa.TemplateCache.create("views/gantt/Gantt.createShifts.regular",['<div class="toaGantt-tl-shift" start="<%= provider.get("REGULAR_TIME_FROM") %>" dur="<%= dur %>"','style="left: <%= left %>px; width: <%= width %>px;"></div>']),e="",g=this.shifts[d.get("ONCALL_SHIFT")]instanceof Object?this.shifts[d.get("ONCALL_SHIFT")].name:!1,k=d.get("ONCALL_DECORATION"),l=d.get("REGULAR_TIME_FROM"),n=d.get("REGULAR_TIME_TO"),p=d.get("ONCALL_TIME_FROM"),s=d.get("ONCALL_TIME_TO");if(!l&&0!==l||!n&&0!==n)!p&&0!==
p||!s&&0!==s||(e+=c.apply({provider:d,width:this._timeToView(s-p),left:this._timeToView(p,!0)+this.getElementOffset(),text:g,decoration:k}));else if(e+=b.apply({provider:d,width:this._timeToView(n-l),left:this._timeToView(l,!0)+this.getElementOffset(),dur:n-l}),(p||0===p)&&(s||0===s)&&(l>p&&l<=s&&(e+=c.apply({provider:d,width:this._timeToView(l-p),left:this._timeToView(p,!0)+this.getElementOffset(),text:g,decoration:k})),s>n&&n>=p&&(e+=c.apply({provider:d,width:this._timeToView(s-n),left:this._timeToView(n,
!0)+this.getElementOffset(),text:g,decoration:k})),n<=p||l>=s||l==p&&n==s))e+=c.apply({provider:d,width:this._timeToView(s-p),left:this._timeToView(p,!0)+this.getElementOffset(),text:g,decoration:k});return e},createFinalTravelBar:function(d,c){if("undefined"==typeof d)return"";var b=d.get("FINAL_TRAVEL",!1),e=d.get("FINAL_TRAVEL_TOTAL",!1);return toa.TemplateCache.create("views/gantt/Gantt.createFinalTravelBar",['<div class="toaGantt-tb final" dur="<%= finalTravel %>" data-final=\'{"title": "<%- h(12408) %>", "duration": "<%= finalTravel %>"}\' ',
'style="left: <%= left %>px; width: <%= width %>px; background-color: #<%= color %>;">',"</div>"]).apply({self:this,p:d,finalTravel:b,left:c,width:this._timeToView(e)-1,color:this.options.settings.getTravelTimeColor()})},_createNoWtQueueLine:function(d,c){var b=5,e=0,g=[],k=this.data.getProviderFromLine(d);if(!k)return $("");for(var l,n=k.getQueue(c),p=this.divs[c].width-30-20,s=1;l=n[s];s++)b<p?(l=this.data.activities[l],g.push(toa.helper.activity.createActivityBar(l,b,this.options.timeRatio)),b+=
this._timeToView(l.fullDuration())+5):e++;e&&g.push('<div class="toaGantt-label" ','title="'+h(15920)+'" style="left:',p+20-10,'px">',e?" +"+e:"","</div>");b=g.join("");return this.createQueueLine(d,k.getId(),b,c)},createQueueLine:function(d,c,b,e){var g=this;d=['<div class="toaGantt-tl toaGantt-tl-',this.gantLblId,'" par_pid="',c,'" style="top:',(d-1)*this.options.lineHeight,'px">',b,"</div>"].join("");d=$(d);"provTree"==e&&(d.css("left",g.canvasMargin+"px"),d.hover(function(b){g.element.find(["div.toaGantt-tl[par_pid=",
c,"]"].join("")).addClass("toaGantt-tl-hover")},function(b){g.element.find(["div.toaGantt-tl[par_pid=",c,"]"].join("")).removeClass("toaGantt-tl-hover")}));if("timeChart"==e){var k=d.find(".final");if(0<k.length){e=k.data("final");var l,n;b=e.duration/60;1>b&&(l="00",n=b<1/6?"0"+e.duration:e.duration);1==b&&(l="01",n="00");1<b&&(l=Math.floor(b),l=9<l?l:"0"+l,n=e.duration-60*l,n=9<n?e.duration-60*l:"0"+n);var p,s={minWidth:250,minHeight:50,maxWidth:400,className:"toa-hint-tip toa-hint final-travel-tip",
closable:!1,closeOnOutsideClick:!0},t='<div class="toa-hint-field hintFinal">'+e.title+'</div><br /><div><span class="capFinal cap">'+h(15313)+':&nbsp;</span><span class="capFinal_value">'+l+":"+n+"</span></div>",u=null,v='<div class="toa-hint-field hintFinalLarge">'+e.title+'</div><br /><div><span class="capFinalLarge cap">'+h(15313)+':&nbsp;</span><span class="capFinalLarge_value">'+l+":"+n+"</span></div>";k.off().on("mouseover",function(b){u=setTimeout(function(){p=1024>window.screen.width?$("<div/>").html(t):
$("<div/>").html(v);currentTipElement&&currentTipElement.Tip&&currentTipElement.Tip("destroy");currentTipElement=p;p.Tip(s);p.Tip("showAt",k)},800)}).on("mouseleave",function(b){clearTimeout(u);currentTipElement&&(currentTipElement.Tip("destroy"),currentTipElement=null)})}}return d},setShifts:function(d){this.shifts=d},createGpsMarks:function(d){if(!d)return"";var c=[];d=this.processIdlePoints(d,this.data.smartgps_idle_timeout||0,!1);for(var b=0;b<d.length;b++){var e=d[b];e.backgroundDuration&&c.push(this.createGpsSegment(e.start,
e.backgroundDuration,this.options.gpsStatusToClass[app.map.oracle.TrackMarker.states.normal]||"gps-status-normal"));c.push(this.createGpsSegment(e.start,e.duration,this.options.gpsStatusToClass[e.status]||"gps-status-none"))}return c.join("")},processIdlePoints:function(d,c,b){var e=[],g=null,k=!1,l=b?"s":"status",n=b?"i":"originalDuration",p=app.map.oracle.TrackMarker.states;$.each(d,function(s,t){var u=s===d.length-1;t[l]===p.idle&&t[n]?(g=null===g?s:g,t[l]=t[n]>=c?p.idle:p.normal):k=null!==g;e.push(t);
if(k||g&&u){var u=k?s-1:s,v=b?toa.date.parseDate("Y-m-d h:i:s",d[g].t):d[g].start,v=(b?toa.date.parseDate("Y-m-d h:i:s",d[u].t):d[u].start)-v,v=b?v/1E3:v,v=v+d[u][n];if(v>c)for(v=g;v<=u;v++)e[v][l]=p.idle;k=!1;g=null}});return e},createGpsSegment:function(d,c,b){return toa.TemplateCache.create("views/gantt/Gantt.createGpsSegment",'<div class="toaGantt-tl-gpsmark <%= statusClass%>", start="<%= start %>", dur="<%= duration %>", style="left: <%= left %>px;, width: <%= width %>px;,"></div>'.split(",")).apply({start:d,
duration:c,statusClass:b,width:this._timeToView(c),left:this._timeToView(d,!0)+this.getElementOffset()})},createProviderLine:function(d){var c=this,b=c.data.getProviderFromLine(d);if(b){var e={},g=b.getQueue("ordered"),k=b.get("FINAL_TRAVEL",!1);c._timeToView(b.get("DEACTIVATED")||-99999,!0);c.getElementOffset();var l=c.createProviderBar(b);e.provTree=c.createQueueLine(d,b.getId(),l,"provTree");b.decoration="green";var n=[c.createShifts(b)],p,s=null,t=null;$.each(g,function(b,d){p=c.data.activities[d];
p.isTravelActivity()&&(s=c.data.activities[d]);var e=c._timeToView(p.getTravelStart(),!0)+c.getElementOffset(),k=p.getTravelStart();if(null===t||t>k)t=k;n.push(toa.helper.activity.createActivityBar(p,e,c.options.timeRatio))});n.reverse();0<k&&(s||b.get("REGULAR_TIME_FROM"))&&(l=s?Math.round(c._timeToView(s.get("DURATION")+s.get("TRAVEL"))):0,g=s?s.getTravelStart():b.get("REGULAR_TIME_FROM"),g=c._timeToView(g,!0)+c.getElementOffset(),n.push(c.createFinalTravelBar(b,g+l)));l=n.join("");g=0;g=b.get("REGULAR_TIME_FROM")&&
b.get("ONCALL_TIME_FROM")?b.get("ONCALL_TIME_FROM")<b.get("REGULAR_TIME_FROM")?b.get("ONCALL_TIME_FROM"):b.get("REGULAR_TIME_FROM"):b.get("REGULAR_TIME_FROM")||b.get("ONCALL_TIME_FROM");g=b.get("ACTIVATED")&&(!g||b.get("ACTIVATED")<g)?b.get("ACTIVATED"):g;g=t>g?g:t;l=[l,'<div class="toaGantt-tw travel-warning-alert " style="display:',b.get("TRAVEL_ESTIMATION_WRANING")?"block":"none","; left:",c._timeToView(g||0,!0)+c.getElementOffset()-29,'px;" data-travel-estimation-alert="true" par_pid="',b.get("PID"),
'" data-date="',c.data.date,'"></div><div class="toaGantt-queue toaGantt-queue-start" style="left:',c._timeToView(b.get("ACTIVATED")||-99999,!0)+c.getElementOffset(),'px;" start="',b.get("ACTIVATED")||-99999,'"></div><div class="toaGantt-queue toaGantt-queue-reactivated" style="left:',c._timeToView(b.get("REACTIVATION_TIME")||-99999,!0)+c.getElementOffset(),'px;" start="',b.get("REACTIVATION_TIME")||-99999,'"></div><div class="toaGantt-queue toaGantt-queue-end" style="left:',c._timeToView(b.get("DEACTIVATED")||
-99999,!0)+c.getElementOffset(),'px;" start="',b.get("DEACTIVATED")||-99999,'"></div>',c.createGpsMarks(b.get("GPSSTATS"))].join("");e.timeChart=c.createQueueLine(d,b.getId(),l,"timeChart");e.notOrdered=c._createNoWtQueueLine(d,"notOrdered");e.withoutDate=c._createNoWtQueueLine(d,"withoutDate");return e}},_updateView:function(d){var c=this;c.firstShow=1+parseInt(c.vScrollPos/c.options.lineHeight,10);c.lastShow=1+parseInt(c.firstShow+c.lastHeight/c.options.lineHeight,10);var b=c.firstShow-c.options.showPageSize;
1>b&&(b=0);var e=c.lastShow+c.options.showPageSize,g=(this.options.daysInCache-e+b)/2,k=b-g;c.temp={from:0<k?k:0,to:e+g};c.lines.forEach(function(b,d){(d<c.temp.from||d>c.temp.to)&&c._hideLine(d)});for(delete c.temp;b<=c.lastShow+c.options.showPageSize;b++)d&&c._hideLine(b),c._showLine(b)},_showLine:function(d){var c=this.data.changedLines[d],b=this.lines[d];if(!b||c)if(this.data.changedLines[d]=!1,b&&this._hideLine(d),b=this.createProviderLine(d),this.lines[d]=b)this.canvases.provTree.body.append(b.provTree),
this.canvases.timeChart.body.append(b.timeChart),this.canvases.notOrdered.body.append(b.notOrdered),this.canvases.withoutDate.body.append(b.withoutDate),d=this.data.getProviderFromLine(d).getQueue("ordered"),toa.helper.activity.createParallelTravel(d,this.canvases.timeChart.body,this)},_hideLine:function(d){var c=this.lines[d];c&&(c.provTree.remove(),delete c.provTree,c.timeChart.remove(),delete c.timeChart,c.notOrdered.remove(),delete c.notOrdered,c.withoutDate.remove(),delete c.withoutDate,delete this.lines[d])},
clearLines:function(){for(var d in this.lines)this._hideLine(d);$(".toaGantt-tl-"+this.gantLblId).remove();this.data.clear();this.lines=[]},_isLineNumVisible:function(d){return d>=this.firstShow-this.options.showPageSize&&d<=this.lastShow+this.options.showPageSize},showWait:function(d){var c=this;c.loadingTimeOut||c.loadingTimeOut||(c.loadingTimeOut=setTimeout(function(){c.loading=d?$('<div class="toaGantt-wait"></div>').css({top:d+"px",left:"0px"}).appendTo(c.divs.timeChart.body):$('<div class="toaGantt-wait"></div>').appendTo(c.element)},
200))},hideWait:function(){this.loadingTimeOut&&(clearTimeout(this.loadingTimeOut),this.loadingTimeOut=null);this.loading&&(this.loading.remove(),this.loading=null)},_initData:function(){var d=this.canvases.provTree.body,c=this.canvases.timeChart.body,b=this.canvases.notOrdered.body,e=this.canvases.withoutDate.body,g=this.data.totals.count*this.options.lineHeight,k=g>this.lastHeight?g:this.lastHeight;if(this.canvasHeight!=k){this.canvasHeight=k;d.height(k);c.height(k);b.height(k);e.height(k);this.timeLine.height(k);
this.timeMouseLine.height(k);for(var l in this.hourLine)d=this.hourLine[l],d.height(k)}this.canvases.vScroll.body.height(g);this.data.totals.max_time==this.data.totals.min_time?this.setHScroll(0):(this.lastTotals=this.data.totals,this._isNewPidOrDate()?(this._initForFirstLoad(),this._scrollToCurrentTime()):(this.maxTime<this.data.totals.max_time+this.options.timePadding&&(this.maxTime=this.data.totals.max_time+this.options.timePadding),this.minTime>this.data.totals.min_time-this.options.timePadding&&
(g=this._timeToView(this.minTime-(this.data.totals.min_time-this.options.timePadding)),k=g+this.getHScroll(),this.offset+=g,this.minTime=this.data.totals.min_time-this.options.timePadding,this.canvases.timeChart.bottom.width(this._timeToView(this.maxTime-this.minTime)),this.canvases.timeChart.body.css("left",-this.getElementOffset()),this.canvases.timeChart.head.css("left",-this.getElementOffset()),this.setHScroll(k))),this.hideWait())},_scrollToCurrentTime:function(){var d=this.element.get(0).querySelector(".toaGantt-time-line-head");
if(d){var d=d.getBoundingClientRect().left+this.options.timePadding-document.documentElement.clientWidth,c=this.getTime(),b=this.data.totals.max_time,e=this.data.totals.min_time;0<=d&&c<b&&c>e&&this.data.totals.count&&this.setHScroll(d+1.5*this.options.timePadding)}},_isNewPidOrDate:function(){var d=this.oldData.pid!=this.data.pid||this.oldData.date!=this.data.date;d&&(this._trigger("resourcechanged"),this.oldData.pid=this.data.pid,this.oldData.date=this.data.date);return d},_initForFirstLoad:function(){this.offset=
0;var d=this.getTime();this.minTime=0<d&&this.data.totals.min_time>d?d-this.options.timePadding:this.data.totals.min_time-this.options.timePadding;this.setHScroll(0);1920<this.data.totals.max_time+this.options.timePadding&&(this.maxTime=this.data.totals.max_time+this.options.timePadding);this.canvases.timeChart.bottom.width(this._timeToView(this.maxTime-this.minTime));this.canvases.timeChart.body.css("left",-this.getElementOffset());this.canvases.timeChart.head.css("left",-this.getElementOffset());
this._updateHourLine()},clear:function(d){this.data.clear();this.setVScroll(0,!0);this._initData();this._updateView(!0);d||this._trigger("updatePage",null,{from:this.firstShow,to:this.lastShow+this.options.showPageSize,visible:{}})},getTime:function(){return this.dtime},getCanvasOffset:function(){return this._timeToView(this.canvasMargin)},getElementOffset:function(){return this._timeToView(this.canvasMargin)-this.offset},getFitRatio:function(){return Math.pow(1.2,Math.round(Math.log(this.divs.timeChart.width/
(this.lastTotals.max_time-this.lastTotals.min_time+2*this.options.timePadding))/Math.log(1.2)))},getTimeViewData:function(){return this.data},load:function(d,c,b){this.data.pid==d&&this.data.date==c||this.clearLines();this.data.pid=d;this.data.date=c;this.data.addDelta(b);this._initData();this._updateView();this.hideWait();this._initTouchData()},update:function(){this._trigger("updatePage",null,this.data.getCachedRange(this.firstShow,this.lastShow,this.options.showPageSize))},reload:function(){this._trigger("updatePage",
null,{from:1,to:parseInt(1+this.lastHeight/this.options.lineHeight,10)+this.options.showPageSize,visible:{}})},destroy:function(){$.Widget.prototype.destroy.apply(this,arguments);delete this.options.lines},updateTracks:function(d){this.data.updateTracks(d,!0);this._updateView()}};$.widget("toa.Gantt",toa.Gantt);$.extend(toa.Gantt,{version:"0.0.2",getter:"getVScroll getHScroll"});window.toa||(window.toa={});
toa.GanttDropActionBase=toa.define(null,function(){this._create.apply(this,arguments)},{group:"",_create:function(d){this.options={parent:d.parent||null,group:d.group||this.group,multiday:d.multiday||!1};this.lastMessagae="default";this.settings=d.settings||null;navigator.userAgent.toLowerCase();this.handlerOnDragMove=this.dragmove.bind(this);this.handlerOnDrop=this.drop.bind(this)},_getTargetLine:function(d){d=toa.dom.isTouch?$(document.elementFromPoint(d.originalEvent.clientX,d.originalEvent.clientY)).closest("div.toaGantt-tl",
this._getContext()):$(d.originalEvent.target||d.target).closest("div.toaGantt-tl",this._getContext());return d.length?d:!1},dragmove:function(d,c){var b=this.options.parent.data,e=this._getTargetLine(d);if(!e)return c.helper.data("hint").setDefault(),this.lastProvLine=!1;if(this.lastProvLine===e)return!1;var g=this._getTargetPid(e),k=b.getResource(g),g=c.helper.data("selfController"),b=toa.helper.activity.getActivityFromElement(c.helper).checkMove(c.helper,k,b.date,this.group),g="undefined"!=typeof g&&
1<g.selectedCount&&null==g.currentItem;if(!b)return!1;!g&&!b.result||g&&!b.groupResult?g?c.helper.data("hint").setAccept(b.groupResult,b.groupMessage,e):c.helper.data("hint").setAccept(b.result,b.message,e):c.helper.data("hint").setAccept(!0,h(5579),e);return!1},drop:function(d,c){var b=c.helper.data("selfController"),e=this.options.parent.data,g=this._getTargetLine(d);if(!g)return!1;var k=this._getTargetPid(g);if(!k)return!1;var l=e.getResource(k);if(!l)return!1;e=e.date;if(this.options.multiday){e=
g.closest(".toaGantt-day");if(0===e.length||"string"!==typeof e.attr("line-day"))return!1;e=e.attr("line-day")}g=toa.helper.activity.getActivityFromElement(c.helper);if(!g)return!1;var n=c.helper.attr("aid"),n="undefined"!=typeof b&&1<b.selectedCount&&null==b.currentItem||-1!==n.search(","),l=g.checkMove(c.helper,l,e,this.group);if(!n&&!l.result||n&&!l.groupResult)return toa.app.trigger("global.hint.hide"),toa.ui.Alert({text:hs(l.message)}),!1;if(n&&"undefined"!=typeof b&&"undefined"!=typeof b.selected)for(var p in b.selected)if("multiday_activity_segment"==
b.selected[p]._v.T)return!1;if(n&&c.helper[0].hasAttribute("has-multiday-activity"))return!1;b=this._getTime(c);this.options.parent._trigger("dropActivity",null,{aid:g.getId(),fromPid:g.get("pid"),fromDate:g.get("date")||c.helper.attr("data-date"),toPid:k,targetDate:e,group:this.options.group,atTime:b,nextTo:this._getNext(c,k,b,e),helper:c.helper});return!1},queueNameToCanvasName:{provider:"provTree",ordered:"timeChart",notOrdered:"notOrdered",withoutDate:"withoutDate"},_getContext:function(){return this.options.parent.canvases[this.queueNameToCanvasName[this.options.group]].body},
_getFromPid:function(d,c){return d.helper.attr("par_pid")||this.options.parent.data.activities[c].get("pid")},_getTargetPid:function(d){return d.attr("par_pid")},_getTime:function(d){return null},_getNext:function(d,c,b){return null}});toa.GanttTargetDivsProvider=toa.define(toa.GanttDropActionBase,null,{group:"provider"});toa.GanttTargetDivsNotOrdered=toa.define(toa.GanttDropActionBase,null,{group:"notOrdered"});
toa.GanttDropActionWithoutDate=toa.define(toa.GanttDropActionBase,null,{group:"withoutDate",drop:function(d,c){var b=c.helper.data("selfController"),b="undefined"!=typeof b&&1<b.selectedCount&&null==b.currentItem,e=this.options.parent.data,g=this._getTargetLine(d);if(!g)return!1;g=this._getTargetPid(g);if(!g)return!1;var k=e.getResource(g);if(!k)return!1;var e=toa.datetime.DAY_WITHOUT_DATE,l=toa.helper.activity.getActivityFromElement(c.helper);if(!l)return!1;k=l.checkMove(c.helper,k,e,this.group);
if(!b&&!k.result||b&&!k.groupResult)return toa.app.trigger("global.hint.hide"),toa.ui.Alert({text:hs(k.message)}),!1;b=this._getTime(c);this.options.parent._trigger("dropActivity",null,{aid:l.getId(),fromPid:l.get("pid"),fromDate:l.get("date")||c.helper.attr("data-date"),toPid:g,targetDate:e,group:this.options.group,atTime:b,nextTo:this._getNext(c,g,b),helper:c.helper});return!1}});
toa.GanttTargetDivsOrdered=toa.define(toa.GanttDropActionBase,null,{group:"ordered",_getTime:function(d){return this.options.parent.viewToTime(this.options.parent.absoluteToBody(d.position.left),!0)},_getNext:function(d,c,b,e){d=this.options.multiday?this.options.parent.data.getClosest(c,b,e):this.options.parent.data.getClosest(c,b);return d.pre&&d.pre.isPendingGroup()?(d=String(d.pre.getId()),0<d.indexOf("|")?d.substr(0,d.indexOf("|")):d):d.pre||d.post?0:-101},clearClosest:function(d){(d=d.helper.data("lastHover"))&&
d.removeClass("toaGantt-tl-hover-dragtarget")},dragmove:function(d,c){var b=this,e=b.options.parent,g=b.options.parent.data,k=b._getTargetLine(d);if(!k)return c.helper.data("hint").setDefault(),!1;var l=e.viewToTime(e.absoluteToBody(c.position.left),!0),n=b._getTargetPid(k),e=c.helper.attr("aid"),p,s=g.getResource(n);if(!s)return!1;var t=toa.helper.activity.getActivityFromElement(c.helper);if(!t)return!1;var u=g.date;if(this.options.multiday){u=k.closest(".toaGantt-day");if(0===u.length||"string"!==
typeof u.attr("line-day"))return!1;u=u.attr("line-day");g=g.getClosest(n,l,u)}else g=g.getClosest(n,l);s=t.checkMove(c.helper,s,u,b.group,g.post);t=c.helper.data("selfController");if(e="undefined"!=typeof t&&1<t.selectedCount&&null==t.currentItem||-1!==e.search(",")){u=!1;if("undefined"!=typeof selfController&&"undefined"!=typeof selfController.selected)for(p in t.selected)if("multiday_activity_segment"==t.selected[p]._v.T){u=!0;break}u||c.helper[0].hasAttribute("has-multiday-activity")?(p=h(15083),
s.groupResult=!1):p=s.groupResult?h(5579):p=s.message;c.helper.data("hint").setAccept(s.groupResult,p,k)}else c.helper.data("hint").setAccept(s.result,s.message,k);s.result&&!e?g.pre&&(p=String(g.pre.getId()).replace(/\|/g,"\\|"),p=k.find('div.toaGantt-tb[aid="'+p+'"]'),p.length&&(b.clearClosest(c),c.helper.data("lastHover",p),p.addClass("toaGantt-tl-hover-dragtarget"),k.one("mouseout mouseup",function(){b.clearClosest(c)}))):b.clearClosest(c);return!1}});(function(d,c,b){d("toa.ActivitiesScreen.views.CurrentTimeLine",c(null,function(b){if(!b.containers)throw Error("CurrentTimeLine: containers are not specified");this._isRendered=!1;this._initTemplates();this.setContainer(b.containers);b.model&&b.model instanceof toa.models.ObservableModel&&(this.model=b.model,this.model.addListener("change",this.update,this))},{templates:{},_initTemplates:function(){this.templates.head=(new b(["<div class='toaGantt-time-line-head'><%- timeString %></div>"])).compile();
this.templates.line=(new b(["<div class='toaGantt-time-line'/>"])).compile()},render:function(){this.isRendered()||this._createElements();this.line.css({top:"0px",left:this.model.get("baseOffset")+this.model.get("offset")});this.head.css({left:this.model.get("baseOffset")+this.model.get("offset")-17}).text(this.model.get("timeString"))},isRendered:function(){return this._isRendered},hide:function(){this.isRendered()&&(this.head.hide(),this.line.hide())},show:function(){this.render();this.head.show();
this.line.show()},_createElements:function(){this.head=$(this.templates.head.apply({timeString:this.model.get("timeString")})).appendTo(this.getContainer("head"));this.line=$(this.templates.line.apply()).appendTo(this.getContainer("line"));this._isRendered=!0},update:function(b){b=this.model.changes||b;(b.offset||b.baseOffset||b.timeString)&&this.render()},setContainer:function(b){this.container=b},getContainer:function(b){return this.container[b]}}))})(toa.ns,toa.define,toa.Template);(function(d,c,b,e,g,k,l){var n={options:{settings:null,lines:[],width:1200,height:300,timeRatio:0.25,timePadding:100,minColWidth:200,lineHeight:27,animate:!0,responceDelay:100,showPageSize:10,daysInCache:400},clear:function(b){this.data.clear();this.clearLines();this.setVScroll(0,!0);this._initData();this._updateView(!0);b||this._trigger("updatePage",null,{from:this.firstShow,to:this.lastShow+this.options.showPageSize,visible:{}})},clearLines:function(){for(var b in this.lines)this._hideLine(b);d(".toaGantt-tl-"+
this.gantLblId).remove();this.lines=[]},load:function(b,c){var k=d.extend(!0,{},c.data);k.days=this._excludeNotVisibleDays(k);this._fillProviderTimezones(k);this.selectedResource=b;this.data.pid=b.getId();this.previousDate=c.previousDate;for(var g in k.days)k.days[g].date!==e.DAY_WITHOUT_DATE&&("undefined"===typeof k.days[g].min_time&&(k.days[g].min_time=this.timeBorder),"undefined"===typeof k.days[g].max_time&&(k.days[g].max_time=e.MINUTES_IN_DAY-this.timeBorder));this.data.addData(k);this.setCurrentTime(c.server_resource_time);
(k="true"==this.previousDate&&!this._isNewPidOrDate()&&1<initFilterRatioValue?initFilterRatioValue:this._calculateTimeRatioToFit(k.width||this.canvases.timeChart.body.parent().width()))&&this.setTimeRatio(k);this._initData();this._updateView();this._createDayLine();this._createTimeLine();this._initIpadData();this._hideWait();this._updateTimeLine()},setCurrentTime:function(b){this.dtime=b},setTimeRatio:function(b){"number"==typeof b&&b!==this.options.timeRatio&&(this.options.timeRatio=b,this.canvases.timeChart.body.css("left",
0),this.canvases.timeChart.head.css("left",0),this._updateView(!0),this._updateTimeLine(),this._updateLabels(),b=this._timeToView(this.lastTotals.min_time-this.minTime-this.options.timePadding),this.setHScroll(b))},getTimeRatio:function(){return this.options.timeRatio},resize:function(b){var c="true"==this.previousDate&&!this._isNewPidOrDate()&&1<initFilterRatioValue?initFilterRatioValue:this._calculateTimeRatioToFit(b.width||this.canvases.timeChart.body.parent().width());c&&this.setTimeRatio(c);
this.scrollWidth=this._getScrollWidth();this._setWidth(b.width,b.withoutRequest);this._setHeight(b.height)},setShifts:function(b){this.shifts=b},getMultidayTimeViewData:function(){return this.data},update:function(b,c){this._trigger("updatePage",null,{from:this.firstShow,to:this.lastShow+this.options.showPageSize,visible:b?{}:this.data.getVisibleProviders(this.firstShow,this.lastShow+this.options.showPageSize),forceClear:c})},reload:function(){this._trigger("updatePage",null,{from:1,to:parseInt(1+
this.lastHeight/this.options.lineHeight,10)+this.options.showPageSize,visible:{}})},destroy:function(){d.Widget.prototype.destroy.apply(this,arguments);delete this.options.lines},getVScroll:function(){return this.vScrollPos},getHScroll:function(b){return this.hScrollPos},_create:function(){var b=this.options,c=this.element,d=navigator.userAgent.toLowerCase();toa.browser.msie&&(b.animate=!1);this.isIPad=0<=d.indexOf("iphone")||0<=d.indexOf("ipad");this.oldData={};this.offset=this.canvasMargin=0;this.lastTotals=
{};this.dropOnDivAllowed=!0;this.gantLblId=generate_id();this.featureToggler=toa.app.model("featureToggler");c.addClass("toaGantt");c.html(['            <table>                <tr class="toaGantt-head">                    <td><div class="toaGantt-provTree">                        <div class="toaGantt-canvas">',h(8214),'</div></div></td>                    <td>                        <div class="toaGantt-timeChart oj-scrollbar-force">                        <div class="toaGantt-canvas"></div></div></td>                    <td><div class="toaGantt-withoutDate">                        <div class="toaGantt-canvas">                        <span title="',
h(8203),'" class=\'toaGantt-withoutDate-icon\'>&nbsp;</span>                        </div></div></td>                    <td><div class="toaGantt-vScroll oj-scrollbar-force">                        <div class="toaGantt-canvas">&nbsp;</div></div></td>                </tr>                <tr class="toaGantt-body">                    <td><div class="toaGantt-provTree">                        <div class="toaGantt-canvas"></div>                        </div></td>                    <td><div class="toaGantt-timeChart oj-scrollbar-force">                        <div class="toaGantt-canvas"></div></div></td>                    <td><div class="toaGantt-withoutDate">                        <div class="toaGantt-canvas"></div></div></td>                    <td><div class="toaGantt-vScroll oj-scrollbar-force">                        <div class="toaGantt-canvas"></div></div></td>                </tr>                <tr class="toaGantt-bottom">                    <td><div class="toaGantt-provTree">                        <div class="toaGantt-canvas"></div></div></td>                    <td><div class="toaGantt-timeChart oj-scrollbar-force">                        <div class="toaGantt-canvas"></div></div></td>                    <td><div class="toaGantt-withoutDate">                        <div class="toaGantt-canvas"></div></div></td>                    <td><div class="toaGantt-vScroll oj-scrollbar-force">                        <div class="toaGantt-canvas"></div></div></td>                </tr>            </table>'].join(""));
this.options.enableWithoutDate||c.find("div.toaGantt-withoutDate").closest("td").hide();this.divs={};this.canvases={};this.colsName=["provTree","timeChart","withoutDate","vScroll"];this.rowName=["head","body","bottom"];this.dragable=[1,2];this.dropable=[1,2];this.lines=[];this.vScrollPos=this.hScrollPos=0;this.timeLineHead=this.timeLine=null;this.dayLine=[];this.minTime=0;this.maxTime=1920;this.timeBorder=120;this.minTimeRatio=0.2;this.lastHeight=this.lastWidth=this.dtime=0;this.lastShow=this.firstShow=
1;this.loading=null;this.scrollWidth=this._getScrollWidth();this.timerUpdateLabels={withoutDate:null};this.data=new toa.MultidaytimeViewData;this.shifts={};this._cachingDivs()},_init:function(){this._setupDivs();this._setHeight();this._setWidth(0,this.options.withoutRequest);this.setHScroll();this._createHint()},_initData:function(){var b=this.canvases.provTree.body,c=this.canvases.timeChart.body,d=this.canvases.withoutDate.body,e=this.data.getTotalsCount()*this.options.lineHeight,k=e>this.lastHeight?
e:this.lastHeight;this.canvasHeight!=k&&(this.canvasHeight=k,b.height(k),c.height(k),d.height(k));this.canvases.vScroll.body.height(e);this.data.totals.max_time!=this.data.totals.min_time&&(this.lastTotals=this.data.totals,this.maxTime<this.data.totals.max_time+this.options.timePadding&&(this.maxTime=this.data.totals.max_time+this.options.timePadding),this.minTime>this.data.totals.min_time-this.options.timePadding&&(b=this._timeToView(this.minTime-(this.data.totals.min_time-this.options.timePadding)),
c=b+this.getHScroll(),this.offset+=b,this.minTime=this.data.totals.min_time-this.options.timePadding,this.canvases.timeChart.head.css("left",0),this.canvases.timeChart.body.css("left",0),this.canvases.timeChart.bottom.width(this._timeToView(this.maxTime-this.minTime)),this.setHScroll(c)),this._hideWait())},getDaysViews:function(){var b=[];this.canvases.timeChart.body.find("div.toaGantt-day").each(function(){var c=d(this);b.push({element:c,date:c.attr("line-day")})});return b.length&&b.sort(function(b,
c){return b.date===c.date?0:b.date>c.date?1:-1})||!1},_calculateTimeRatioToFit:function(b){var c=0,d=!1,e;for(e in this.data.days)c+=this._getDayVisibleMinutes(e);c&&b&&(d=b/c,d<this.minTimeRatio&&(d=this.minTimeRatio));return Math.round(1E4*d)/1E4},_updateView:function(b){var c=this;c.firstShow=1+parseInt(c.vScrollPos/c.options.lineHeight,10);c.lastShow=1+parseInt(c.firstShow+c.lastHeight/c.options.lineHeight,10);var e=c.firstShow-c.options.showPageSize;1>e&&(e=0);c._isNewPidOrDate()?c.canvases.provTree.body.empty():
c.canvases.timeChart.body.find("div.toaGantt-day").hide();var k=0,g=0;c._recalculateTimeRatio(c.data.days);for(var l in c.data.days){for(var n=this.getDaysViews(),y=c._calculateColWidth(l,!0),k=k+(y+1),g=g+y,z=c.data.days[l].date,A=!1,B=0;B<n.length;B+=1)if(z===n[B].date){A=n[B].element;break}if(!1===A)if(A=d('<div class="toaGantt-day day-'+z+'" line-day="'+z+'"></div>').css({width:y+"px"}),!1===n)A.appendTo(c.canvases.timeChart.body);else{y=!1;for(B=0;B<n.length;B+=1)if(z<n[B].date){A.insertBefore(n[B].element);
y=!0;break}!1===y&&A.insertAfter(n[n.length-1].element)}else A.css({width:y+"px","border-right":"1px solid #A6A5A2"}).show()}A&&A.css({border:"none"});c.canvases.timeChart.body.width(k+"px");c.canvases.timeChart.bottom.width(g+"px");0!==c.canvases.timeChart.bottom.outerWidth()&&c.divs.timeChart.bottom.outerWidth()===c.canvases.timeChart.bottom.outerWidth()?(c.divs.timeChart.bottom.height(0),B=c.lastHeight=c.element.height()-c.divs.timeChart.head.parent().outerHeight()):(c.divs.timeChart.bottom.height(c.scrollWidth),
B=c.lastHeight=c.element.height()-c.divs.timeChart.head.parent().outerHeight()-c.divs.timeChart.bottom.parent().outerHeight());for(var D in c.divs)c.divs[D].body.height(B);D=c.lastShow+c.options.showPageSize;B=(this.options.daysInCache-(D-e)*Object.keys(c.data.days).length)/2;k=e-B;c.temp={from:0<k?k:0,to:D+B};c.lines.forEach(function(b,d){(d<c.temp.from||d>c.temp.to)&&c._hideLine(d)});delete c.temp;for(B=e;B<=D;B++)b&&c._hideLine(B),c._showLine(B);c._createDayLine()},_setupDivs:function(){var b=
this;b.element.delegate("div.toaGantt-tb","mouseenter",function(b,c){var e=d(this).data("master-id");""!=e&&d('div.toaGantt-tb[data-master-id="'+e+'"]').addClass("toaGantt-multiday-segment");d(this).addClass("toaGantt-tb-hover")});b.element.delegate("div.toaGantt-tb","mouseout",function(b,c){var e=d(this).data("master-id");""!=e&&d('div.toaGantt-tb[data-master-id="'+e+'"]').removeClass("toaGantt-multiday-segment");d(this).removeClass("toaGantt-tb-hover")});b.isIPad||b.element.delegate("div.toaGantt-tb",
"mousedown touchstart",g);var c={parent:b,settings:b.options.settings,multiday:!0},e=new toa.GanttTargetDivsProvider(c);b.divs.provTree.body.css("zIndex",100).droppable({tolerance:"pointer",accept:"[aid][movable!=false]",dragmove:e.handlerOnDragMove,drop:e.handlerOnDrop});var k=new toa.GanttTargetDivsOrdered(c);b.divs.timeChart.body.css("zIndex",101);b.isIPad?b.divs.timeChart.body.droppable({tolerance:"pointer",accept:"[aid][movable!=false]",dragmove:function(c,d){c.originalEvent.target=c.target=
document.elementFromPoint(c.originalEvent.clientX,c.originalEvent.clientY);var g=b.ipad.provTree;c.originalEvent.clientX>=g.left&&c.originalEvent.clientX<=g.left+g.width&&c.originalEvent.clientY>=g.top&&c.originalEvent.clientY<=g.top+g.height?e.dragmove(c,d):k.dragmove(c,d)},drop:function(c,d){c.originalEvent.target=c.target=document.elementFromPoint(c.originalEvent.clientX,c.originalEvent.clientY);var g=b.ipad.provTree;c.originalEvent.clientX>=g.left&&c.originalEvent.clientX<=g.left+g.width&&c.originalEvent.clientY>=
g.top&&c.originalEvent.clientY<=g.top+g.height?e.drop(c,d):k.drop(c,d)}}):b.divs.timeChart.body.droppable({tolerance:"pointer",accept:"[aid][movable!=false]",dragmove:k.handlerOnDragMove,drop:k.handlerOnDrop});c=new toa.GanttDropActionWithoutDate(c);b.divs.withoutDate.body.css("zIndex",103).droppable({tolerance:"pointer",accept:"[aid][movable!=false]",dragmove:c.handlerOnDragMove,drop:c.handlerOnDrop});for(var l=c=0;2>=l;l++){var n=b.colsName[l],x=b.divs[n],c=c+x.body.parent().width();if(b.options.enableWithoutDate||
"withoutDate"!=b.colsName[l+1])x.resizer=d("<div/>").addClass("toaGantt-resize-helper").data("colName",n).data("colNameNext",b.colsName[l+1]).css("left",c).draggable({axis:"x",cursor:"col-resize",zIndex:5E3,scope:"timeviewtable",start:function(c,e){d(this).data("start",e.position.left);var k=d(this).next(".toaGantt-resize-helper"),k=k.length?k.position().left:b.element.width()-30,g=d(this).prev(".toaGantt-resize-helper"),g=g.length?g.position().left:30;d(this).data("max",k-30);d(this).data("min",
g+30)},drag:function(b,c){var e=d(this).data("max");c.position.left>e?c.position.left=e:(e=d(this).data("min"),c.position.left<e&&(c.position.left=e))},stop:function(c,e){var k=d(this).data("colName"),g=d(this).data("colNameNext"),l=e.position.left-d(this).data("start"),n=b.divs;b._setColWidth(k,n[k].body.width()+l);b._setColWidth(g,n[g].body.width()-l);b._recalculateResizers();b.setHScroll();b._updateLabels();b._setWidth()}}).appendTo(b.element)}b.divs.timeChart.bottom.css({height:b.scrollWidth}).scroll(function(){b.setHScroll()});
b.canvases.timeChart.bottom.css({height:"1px"});b.divs.vScroll.body.css({"overflow-y":"auto"}).scroll(function(){b.setVScroll(b.divs.vScroll.body.scrollTop())});b._setColWidth("vScroll",b.scrollWidth);b.divs.withoutDate.body.delegate(".toaGantt-label","mousedown",function(c,e){var k=d(this).parent().attr("par_pid");b._trigger("clickCounterLabel",null,{pid:k,group:"withoutDate"})});b.element.bind("mousewheel",function(c,d,e,k){d=40;var g=1;"MacIntel"==window.navigator.platform&&(d=2,g=-1);c.shiftKey?
0===e&&(c=b.divs.timeChart.bottom,k=c.scrollLeft()-k*d,c.scrollLeft(k)):(c=b.divs.vScroll.body,k=c.scrollTop()-k*d,c.scrollTop(k));0!==e&&(c=b.divs.timeChart.bottom,k=c.scrollLeft()-e*d*g,c.scrollLeft(k))});b._initTouch()},viewToTime:function(b,c){for(var d=b,e=Object.keys(this.data.days),k,g,l=0;l<e.length;l++){g=e[l];k=this._getDayColumn(g).width();if(d<k)break;d-=k}d=d/this.options.timeRatio+this.data.days[g].min_time-this.timeBorder;return parseInt(c?d+this.minTime:d,10)},absoluteToBody:function(b){return b-
this.divs.timeChart.body.offset().left+this.hScrollPos-0},getFitRatio:function(){return this._calculateTimeRatioToFit(this.divs.timeChart.width||this.canvases.timeChart.body.parent().width())},_initTouch:function(){var b=this;b.touch={lastX:0,lastY:0,moved:!1};b.element.bind("touchstart",function(c){var d=c.originalEvent.changedTouches[0];b.touch.lastX=d.clientX;b.touch.lastY=d.clientY;b.touch.moved=!1;c.preventDefault();return!1});b.element.bind("touchend touchcancel",function(c){if(!_DATA||!_DATA.ipadDrag){if(b.touch.moved)return c.preventDefault(),
!1;c=c.originalEvent.changedTouches[0];touchTrigger("mousedown",c);touchTrigger("click",c);return!1}});b.element.bind("touchmove",function(c){if(!_DATA||!_DATA.ipadDrag){b.touch.moved=!0;var d=c.originalEvent.changedTouches[0],e=d.clientX,k=b.touch.lastX-e;b.touch.lastX=e;e=d.clientY;d=b.touch.lastY-e;b.touch.lastY=e;e=b.divs.timeChart.bottom;k=e.scrollLeft()+k;e.scrollLeft(k);e=b.divs.vScroll.body;k=e.scrollTop()+d;e.scrollTop(k);c.preventDefault();return!1}})},_fillProviderTimezones:function(b){for(var c in b.providers)for(var d in b.providers[c].days){var e=
b.providers[c].days[d];"undefined"===typeof e.S&&(e.S=b.default_diff)}},_initIpadData:function(){if(!this.isIPad)return!1;"undefined"===typeof this.ipad&&(this.ipad={});var b=this.divs.provTree.body,c=b.offset();this.ipad.provTree={top:c.top,left:c.left,width:b.width(),height:b.height()};return!0},_createDayLine:function(){var b=0;this.canvases.timeChart.head.find("div.toaGantt-day-line-head").remove();this._recalculateTimeRatio(this.data.days);for(var c in this.data.days){var k=this._calculateColWidth(c,
!0),b=b+(k+1),g=e.formatDate("date_long",e.parseDate("iso",this.data.days[c].date)),l=d('<div class="toaGantt-day-line-head" line-day="'+g+'"></div>');l.css({width:k+"px"}).html(g).append(this._createHoursPoints(c,k)).appendTo(this.canvases.timeChart.head)}l&&l.css({border:"none"});this.canvases.timeChart.head.width(b+"px")},_createHoursPoints:function(b,c){var d=this.data.days[b].max_time+this.timeBorder,e=this.data.days[b].min_time-this.timeBorder,k=this.options.timeRatio,g=60*k,l=1;30>g&&(l=Math.ceil(Math.floor((d-
e)/60)/Math.floor(c/30)));for(var n=Math.floor(e/60),k=(60-e%60)*k-g,z=['<div class = "toaGantt-hour-points">'];e<d;e+=60*l)23<n&&(n%=24),0===k||0>k?z.push('<div class="toaGantt-hour-point" style="left:'+k+'px">&nbsp;<div></div></div>'):(0>n&&(n=24+n),24<=n&&(n-=24),z.push('<div class="toaGantt-hour-point" style="left:'+k+'px">'+n+"<div></div></div>")),n+=l,k+=g*l;z.push("</div>");return z.join("")},_excludeNotVisibleDays:function(b){var c={};if(b.days)for(var d in b.days)b.exclude_first_day&&b.previous_date===
b.days[d].date||b.days[d].date!==e.DAY_WITHOUT_DATE&&(c[d]=b.days[d]);return c},_createTimeLine:function(){this.timeLine||(this.currentTimeModel=new b({timeString:"",offset:0,baseOffset:0}),this.timeLine=new l({containers:{head:this.canvases.timeChart.head,line:this.canvases.timeChart.body},model:this.currentTimeModel}))},_updateTimeLine:function(){if(this.timeLine&&this.selectedResource){var b=this.getCurrentTime();if(0>b||"undefined"===typeof b)this.timeLine.hide();else{var c=e.currentDate(this.selectedResource.get("ZONE_DIFF")),
k=e.toDateSystemString(c),g=this.data.days[k];if("undefined"===typeof g)this.timeLine.hide();else if(c=b%1440,c=0<=c&&c<g.min_time-this.timeBorder?0:c>g.max_time+this.timeBorder?2*this.timeBorder+g.max_time-g.min_time:c+this.timeBorder-g.min_time,c*=this.getTimeRatio(),!g||0>c)this.timeLine.hide();else{var g=0,l=1E5;d.each(this.data.days,function(b){b<k&&l>this._getDayColumn(b).offset().left&&(l=this._getDayColumn(b).offset().left)}.bind(this));1E5!==l&&(g=this._getDayColumn(k).offset().left-l);this.currentTimeModel.set({timeString:this._formatTime(b),
baseOffset:g,offset:c});this.timeLine.show()}}}},_formatTime:function(b){var c=new Date;c.setHours(0,b,0,0);return e.formatDate("time",c)},_createHint:function(){this.hint=d('<div class="toaGantt-hint"></div>')},_cachingDivs:function(){var b=this.colsName,c;for(c in b){var d=b[c];this.divs[d]={prevColName:b[c-1],nextColName:b[+c+1]};this.canvases[d]={};for(var e in this.rowName){var k=this.rowName[e];this.divs[d][k]=this.element.find("tr.toaGantt-"+k+" div.toaGantt-"+d);this.canvases[d][k]=this.element.find("tr.toaGantt-"+
k+" div.toaGantt-"+d+" div.toaGantt-canvas")}}this.canvases.timeChart.head.css("left",-this._getCanvasOffset());this.canvases.timeChart.body.css("left",-this._getCanvasOffset());this.canvases.provTree.body.css("left",-this._getCanvasOffset());this.timeScaleDiv=this.divs.timeChart.head.children("div.toaGantt-time-scale")},_timeToView:function(b,c){return parseInt(c?(b-this.minTime)*this.options.timeRatio:b*this.options.timeRatio,10)},_getScrollWidth:function(){if(this.cachedScrollWidth)return this.cachedScrollWidth;
var b=d('<div style="position:absolute;left:-1000px;width:100px;height:100px;overflow:scroll"><div style="width:200px;height:200px">Test</div></div>');b.appendTo("body");var c=b[0].offsetWidth-b[0].clientWidth+1;b.remove();return this.cachedScrollWidth=c},setVScroll:function(b,c){var d=this;d.vScrollPos=b;d.divs.timeChart.body.scrollTop(b);d.divs.provTree.body.scrollTop(b);d.divs.withoutDate.body.scrollTop(b);d.divs.vScroll.body.scrollTop(b);clearTimeout(d.vSrollTimer);clearTimeout(d.timeOutUpdate);
clearTimeout(d.timeOutPaging);c||(d.vSrollTimer=setTimeout(function(){d._updateView()},3*d.options.responceDelay),d.timeOutPaging=setTimeout(function(){for(var b=d.data.getVisibleProviders(d.firstShow,d.lastShow),c=d.firstShow;c<d.lastShow+d.options.showPageSize;c++)if(!b[c]){d._showWait((c-1)*d.options.lineHeight);break}d._trigger("updatePage",null,{from:d.firstShow,to:d.lastShow+d.options.showPageSize,visible:b})},3*d.options.responceDelay))},setHScroll:function(b){"number"!=typeof b||isNaN(b)?
b=this.divs.timeChart.bottom.scrollLeft():this.divs.timeChart.bottom.scrollLeft(b);this.hScrollPos=b;this.divs.timeChart.head.scrollLeft(b);this.divs.timeChart.body.scrollLeft(b);this.timeScaleDiv.css({left:b+"px"})},_setHeight:function(b){var c=this.element.height()?this.element.height():d(window).height();b=b?b:c;this.element.height(b);(c=this.divs.timeChart.body.children(".toaGantt-canvas").first())&&c.height&&0<c.height()&&c.height()<b&&(c.height(b),c.children(".toaGantt-hour-line").height("inherit"),
c.children(".toaGantt-time-line").height("inherit"));this._updateView()},_setWidth:function(b,c){var d=this,e=b?b:d.element.width();!0!==c&&clearTimeout(d.resizeTimeOut);d.element.width(e);d._setColWidth("vScroll",d.scrollWidth);d.lastWidth=e;d._resizeCol("timeChart");d._recalculateResizers();!0!==c&&(d.resizeTimeOut=setTimeout(function(){d.update(!0,!0)},5*d.options.responceDelay))},_setColWidth:function(b,c){if(!(0>=c)){var d=this.divs[b];d.head.width(c);d.body.width(c);d.bottom.width(c);d.width=
c}},_recalculateTimeRatio:function(b){if(b&&"object"===typeof b){var c=this.timeBorder,d,e;for(e in b)if(b.hasOwnProperty(e)){var k=b[e].max_time+c-(b[e].min_time-c);if(!d||k<d)d=k}"undefined"!==d&&(b=d*this.options.timeRatio,b<this.options.minColWidth&&0<b&&(this.options.timeRatio=this.options.minColWidth/d))}},_calculateColWidth:function(b,c){var d=this.data.days[b].max_time+this.timeBorder-(this.data.days[b].min_time-this.timeBorder),d=parseInt(d?d:this.options.minColWidth,10);c&&(d*=this.options.timeRatio);
d<this.options.minColWidth&&(d=this.options.minColWidth);return d},_getDayVisibleMinutes:function(b){if("string"!=typeof b)throw Error("_getDayVisibleMinutes: argument dateString is not a string");b=this.data.days[b];return"object"!=typeof b||"number"!=typeof b.min_time||"number"!=typeof b.max_time?0:b.max_time-b.min_time+2*this.timeBorder},_recalculateResizers:function(){var b=this.divs,c;for(c in b){var d=b[c];d.width=d.body.width();if(d.resizer){var e=b[d.nextColName];e&&e.body.is(":visible")&&
d.resizer.css("left",e.body.position().left)}}},_updateLabels:function(b,c){var d=this;if(!b)setTimeout(function(){d._updateLabels("withoutDate")},1);else if("withoutDate"===b)for(var e in d.lines){var k=d.lines[e];k&&(k[b].remove(),delete k[b],k[b]=d._createWtQueueLine(e),d.canvases[b].body.append(k[b]))}},_resizeCol:function(b){var c=this.divs,c=this.lastWidth-c.provTree.body.parent().outerWidth()-c.timeChart.body.parent().outerWidth()-(this.options.enableWithoutDate?c.withoutDate.body.parent().outerWidth():
0)-(20<c.vScroll.body.parent().outerWidth()?c.vScroll.body.parent().outerWidth():20)+c[b].body.parent().outerWidth();this._setColWidth(b,c)},_createProviderBar:function(b){return toa.TemplateCache.create("views/gantt/MultiGantt.createProviderBar",'<div class="toaGantt-tb toaGantt-tb-name">,<div role="button" aria-dropeffect="popup" pid="<%= id %>" class="<%= icon %>">,&nbsp;,</div>,&nbsp;<%- name %>,</div>'.split(",")).apply({id:b.getId(),icon:this._getResourceIconClassName(b),name:b.getName()})},
_getResourceIconClassName:function(b){return b.getIconPrefix()+" pt"+b.getResourceTypeIcon()+"_64_1024_0"},_createFinalTravelBar:function(b,c){if("undefined"==typeof b)return"";var d=b.get("FINAL_TRAVEL",!1),e=b.get("FINAL_TRAVEL_TOTAL",!1);c-=1;return toa.TemplateCache.create("views/gantt/MultiGantt.createFinalTravelBar",['<div class="toaGantt-tb final" dur="<%= finalTravel %>" data-final=\'{"title": "<%- h(12408) %>", "duration": "<%= finalTravel %>"}\' ','style="left: <%= left %>px; width: <%= width %>px; background-color: #<%= color %>;">',
"</div>"]).apply({finalTravel:d,left:c,width:this._timeToView(e)-1,color:this.options.settings.getTravelTimeColor()})},_createWtQueueLine:function(b){var c=5,g=0,l=[],n=this.data.getProviderFromLine(b);if(!n)return d("");for(var w=this._getLineQueue(b,e.DAY_WITHOUT_DATE),x=this.divs.withoutDate.width-30-20,y,z=0;y=w[z];z++)c<x?(y=this.data.activities[y.I],l.push(k(y,c,this.options.timeRatio,!0)),c+=this._timeToView(y.fullDuration())+5):g++;g&&l.push('<div class="toaGantt-label" ','title="'+h(15920)+
'" style="left:',x+20-10,'px">',g?" +"+g:"","</div>");c=l.join("");return this._createQueueLine(b,n.getId(),c,"withoutDate",e.DAY_WITHOUT_DATE)},_createQueueLine:function(b,c,e,k,g){var l=this,n=("q-"+g+"-"+k+"-"+c).toLowerCase();b=['<div class="toaGantt-tl ',n," toaGantt-tl-",this.gantLblId,'" num="',b,'" par_pid="',c,'" style="top:',(b-1)*this.options.lineHeight,'px">',e,"</div>"].join("");b=d(b);"provTree"==k&&(b.css("left",l.canvasMargin+"px"),b.hover(function(b){l.element.find("."+n).addClass("toaGantt-tl-hover")},
function(b){l.element.find("."+n).removeClass("toaGantt-tl-hover")}));if("timeChart"==k&&(k=b.find(".final"),0<k.length)){c=k.data("final");var y,z;e=c.duration/60;1>e&&(y="00",z=e<1/6?"0"+c.duration:c.duration);1==e&&(y="01",z="00");1<e&&(y=Math.floor(e),y=9<y?y:"0"+y,z=c.duration-60*y,z=9<z?c.duration-60*y:"0"+z);var A={},B={defaultTipOptions:{minWidth:250,minHeight:50,maxWidth:400,className:"toa-hint-tip toa-hint final-travel-tip",closable:!1,closeOnOutsideClick:!0},data:{target:k,html:'<div class="toa-hint-field">'+
c.title+'<br /><br /><span class="cap">'+h(15313)+":&nbsp;</span>"+y+":"+z+"</div>"},timer:{delay:800,id:null}},D=function(b,c){b.finalTravel||(b.finalTravel=d("<div/>").html(c.data.html),b.finalTravel.Tip(c.defaultTipOptions))};k.off().on("mouseover",function(b){D(A,B);B.timer.id=setTimeout(function(){A.finalTravel.Tip("showAt",B.data.target)},B.timer.delay)}).on("mouseleave",function(b){D(A,B);clearTimeout(B.timer.id);A.finalTravel.Tip("hide")})}return b},_createProviderLine:function(b){var c=this,
e=c.data.getProviderFromLine(b);if(e){var g={},l=c._createProviderBar(e);g.provTree=c._createQueueLine(b,e.getId(),l,"provTree","alldays");g.timeChart={};for(var n in c.data.days)if("days"in e.entity&&"undefined"!=typeof e.entity.days[n]){e.set("DATE",n);"FR"in e.entity.days[n]?e.set("REGULAR_TIME_FROM",e.entity.days[n].FR):e.unset("REGULAR_TIME_FROM");"TR"in e.entity.days[n]?e.set("REGULAR_TIME_TO",e.entity.days[n].TR):e.unset("REGULAR_TIME_TO");"FO"in e.entity.days[n]?e.set("ONCALL_TIME_FROM",e.entity.days[n].FO):
e.unset("ONCALL_TIME_FROM");"TO"in e.entity.days[n]?e.set("ONCALL_TIME_TO",e.entity.days[n].TO):e.unset("ONCALL_TIME_TO");"a"in e.entity.days[n]?e.set("ACTIVATED",e.entity.days[n].a):e.unset("ACTIVATED");"rt"in e.entity.days[n]?e.set("REACTIVATION_TIME",e.entity.days[n].rt):e.unset("REACTIVATION_TIME");"d"in e.entity.days[n]?e.set("DEACTIVATED",e.entity.days[n].d):e.unset("DEACTIVATED");"L"in e.entity.days[n]?e.set("FINAL_TRAVEL",e.entity.days[n].LD):e.unset("FINAL_TRAVEL");"LD"in e.entity.days[n]?
e.set("FINAL_TRAVEL_TOTAL",e.entity.days[n].LD):e.unset("FINAL_TRAVEL_TOTAL");"S"in e.entity.days[n]?e.set("ZONE_DIFF",e.entity.days[n].S):e.unset("ZONE_DIFF");"SO"in e.entity.days[n]?e.set("ONCALL_SHIFT",e.entity.days[n].SO):e.unset("ONCALL_SHIFT");"SR"in e.entity.days[n]?e.set("REGULAR_SHIFTID",e.entity.days[n].SR):e.unset("REGULAR_SHIFTID");"N"in e.entity.days[n]?e.set("NOT_ORDERED_COUNT",e.entity.days[n].N):e.unset("NOT_ORDERED_COUNT");var l=e.get("FINAL_TRAVEL",!1),x=e.getFromMultiday(n,"DEACTIVATED"),
x=null===x?0:x,x=c._timeToView(x-c.data.days[n].min_time+c.timeBorder),y=[c._createShifts(e,n)],z,x=c._getLineQueue(b,n),A=null;d.each(x,function(b,d){z=c.data.activities[d.I];var g=c._timeToView(z.getTravelStart()-c.data.days[n].min_time+c.timeBorder,!0);z.isTravelActivity()&&(A=c.data.activities[d.I]);y.push(k(z,g,c.options.timeRatio,!0));c.canvases.timeChart.body.find(".q-"+n+"-timeChart-"+e.getId()).remove()});0<l&&(A||e.get("REGULAR_TIME_FROM"))&&(l=A?A.getEnd():e.get("REGULAR_TIME_FROM"),l=
c._timeToView(l-c.data.days[n].min_time+c.timeBorder,!0),y[y.length]=c._createFinalTravelBar(e,l));z=null;var l=y.join(""),x=e.get("ACTIVATED"),B=e.get("REACTIVATION_TIME"),D=e.get("DEACTIVATED"),C=e.get("NOT_ORDERED_COUNT")||0,F=x-c.data.days[n].min_time+c.timeBorder,J=B-c.data.days[n].min_time+c.timeBorder,H=D-c.data.days[n].min_time+c.timeBorder;e.get("REGULAR_TIME_FROM");e.get("REGULAR_TIME_TO");l=[l,'<div class="toaGantt-tw travel-warning-alert " style="display:',e.get("days")[n].TW?"block":
"none",'; left:10px;" data-travel-estimation-alert="true" par_pid="',e.get("PID"),'" data-date="',n,'"></div><div class="toaGantt-queue toaGantt-queue-start" style="left:',c._timeToView(F||-99999,!0),'px;" start="',x||-99999,'"></div><div class="toaGantt-queue toaGantt-queue-reactivated" style="left:',c._timeToView(J||-99999,!0),'px;" start="',B||-99999,'"></div><div class="toaGantt-queue toaGantt-queue-end" style="left:',c._timeToView(H||-99999,!0),'px;" start="',D||-99999,'"></div><div class="toaGantt-not-ordered ',
0<C?"":"toa-hidden",'">+',C,"</div>"].join("");g.timeChart[n]=c._createQueueLine(b,e.getId(),l,"timeChart",n)}else e.unset("DATE"),e.unset("REGULAR_TIME_FROM"),e.unset("REGULAR_TIME_TO"),e.unset("ONCALL_TIME_FROM"),e.unset("ONCALL_TIME_TO"),e.unset("ACTIVATED"),e.unset("REACTIVATION_TIME"),e.unset("DEACTIVATED"),e.unset("FINAL_TRAVEL"),e.unset("ZONE_DIFF"),e.unset("ONCALL_SHIFT"),e.unset("REGULAR_SHIFTID"),e.unset("NOT_ORDERED_COUNT"),g.timeChart[n]=c._createQueueLine(b,e.getId(),"","timeChart",n);
g.withoutDate=c._createWtQueueLine(b);return g}},_createShifts:function(b,c){var d=toa.TemplateCache.create("views/gantt/MultiGantt.createShifts.oncall",'<div class="toaGantt-oncall-shift<% if (typeof(decoration) !== "undefined") { %> decoration-<%= decoration %>" aria-label="<%= h(app.constants.ON_CALL_DECORATION_ARIA_LABELS[decoration]) %><% } %>",style="left: <%= left %>px; width: <%= width %>px;">,<% if (text) { %>,<span class="toaGantt-oncall-shift-name">,<%- text %>,</span>,<% } %>,</div>'.split(",")),
e=toa.TemplateCache.create("views/gantt/MultiGantt.createShifts.regular",['<div class="toaGantt-tl-shift" start="<%= time_from %>" dur="<%= dur %>"','style="left: <%= left %>px; width: <%= width %>px;"></div>']),k="",g=b.get("REGULAR_TIME_FROM"),l=b.get("REGULAR_TIME_TO"),n=this.shifts[b.get("ONCALL_SHIFT")]instanceof Object?this.shifts[b.get("ONCALL_SHIFT")].name:!1,z=b.getFromMultiday(c,"ONCALL_DECORATION");if((g||0===g)&&(l||0===l)&&"min_time"in this.data.days[c]){var A=g-this.data.days[c].min_time+
this.timeBorder,k=k+e.apply({time_from:g,width:this._timeToView(l-g),left:this._timeToView(A,!0),dur:l-g}),e=b.get("ONCALL_TIME_FROM"),A=b.get("ONCALL_TIME_TO");if(isInt(e)&&isInt(A)){var B=[];g>e&&g<=A&&B.push({oncallLeftMinutes:e,oncallWidthMinutes:g-e});l<A&&l>=e&&B.push({oncallLeftMinutes:l,oncallWidthMinutes:A-l});(l<e||g>A||l==A&&g==e)&&B.push({oncallLeftMinutes:e,oncallWidthMinutes:A-e});B.forEach(function(b){k+=d.apply({width:this._timeToView(b.oncallWidthMinutes),left:this._timeToView(b.oncallLeftMinutes-
this.data.days[c].min_time+this.timeBorder,!0),text:n,decoration:z})}.bind(this))}}else isInt(b.get("ONCALL_TIME_FROM"))&&isInt(b.get("ONCALL_TIME_TO"))&&"min_time"in this.data.days[c]&&(A=b.get("ONCALL_TIME_FROM")-this.data.days[c].min_time+this.timeBorder,k+=d.apply({width:this._timeToView(b.get("ONCALL_TIME_TO")-b.get("ONCALL_TIME_FROM")),left:this._timeToView(A,!0),text:n,decoration:z}));return k},_getLineQueue:function(b,c){var d=[];"undefined"!==typeof this.data.originalData.providers[b]&&"undefined"!==
typeof this.data.originalData.providers[b].days[c]&&"undefined"!==typeof this.data.originalData.providers[b].days[c].activities&&(d=this.data.originalData.providers[b].days[c].activities);return d},_showLine:function(b){var c=this.data.changedLines[b],e=this.lines[b];if(!e||c)if(this.data.changedLines[b]=!1,e&&this._hideLine(b),e=this._createProviderLine(b),this.lines[b]=e){for(var k in this.data.days)if(c=this._getDayColumn(k),!1!==c){c.append(e.timeChart[k]);var c=this._getLineQueue(b,k),g=[];d.each(c,
function(b,c){g.push(c.I)});toa.helper.activity.createParallelTravel(g,e.timeChart[k],this,k)}k=this.canvases.provTree.body;0===k.find("div.toaGantt-tl[num="+b+"]").length&&k.append(e.provTree);this.canvases.withoutDate.body.append(e.withoutDate)}},_getDayColumn:function(b){b=this.canvases.timeChart.body.find(".day-"+b);return 1==b.length?b:!1},_hideLine:function(b){var c=this.lines[b];if(c){for(var d in c.timeChart)c.timeChart[d].remove();delete c.timeChart;c.provTree.remove();delete c.provTree;
c.withoutDate.remove();delete c.withoutDate;delete this.lines[b];this.lines.length-=1}},_showWait:function(b){var c=this;c.loadingTimeOut||c.loadingTimeOut||(c.loadingTimeOut=setTimeout(function(){c.loading=b?d('<div class="toaGantt-wait"></div>').css({top:b+"px",left:0}).appendTo(c.divs.timeChart.body):d('<div class="toaGantt-wait"></div>').appendTo(c.element)},200))},_hideWait:function(){this.loadingTimeOut&&(clearTimeout(this.loadingTimeOut),this.loadingTimeOut=null);this.loading&&(this.loading.remove(),
this.loading=null)},_isNewPidOrDate:function(){var b=this.oldData.pid!=this.data.pid||this.oldData.date!=this.data.date;b&&(this._trigger("resourcechanged"),this.oldData.pid=this.data.pid,this.oldData.date=this.data.date);return b},getCurrentTime:function(){return this.dtime},_getCanvasOffset:function(){return this._timeToView(this.canvasMargin)}};c("toa.MultiGantt",n);d.widget("toa.MultiGantt",n);d.extend(n,{version:"0.0.3",getter:"getVScroll getHScroll"})})($,toa.ns,toa.models.ObservableModel,toa.date,
toa.helper.activity.makeDraggable,toa.helper.activity.createActivityBar,toa.ActivitiesScreen.views.CurrentTimeLine);(function(d,c,b,e,g,k){b={options:{settings:null,lines:[],width:1200,height:300,timeRatio:0.25,timePadding:100,minColWidth:100,lineHeight:27,animate:!0,responseDelay:100,showPageSize:10,daysInCache:1600},clear:function(b){this.data.clear();this.clearLines();this.setVScroll(0,!0);this._initData();this._updateView(!0);b||this._trigger("updatePage",null,{from:this.firstShow,to:this.lastShow+this.options.showPageSize,visible:{}})},clearLines:function(){for(var b in this.lines)this._hideLine(b);d(".toaGantt-tl-"+
this.gantLblId).remove();this.lines=[];d(".label-text",this.divs.timeChart.body[0]).remove()},load:function(b,c){var k=d.extend(!0,{},c.data);k.days=this._excludeNotVisibleDays(k);this._fillProviderTimezones(k);this.selectedResource=b;this.data.pid=b.getId();this.previousDate=c.previousDate;for(var g in k.days)k.days.hasOwnProperty(g)&&(k.days[g]===e.DAY_WITHOUT_DATE?k.days[g]={date:k.days[g]}:(k.days[g]={date:k.days[g],min_time:void 0,max_time:void 0},"undefined"===typeof k.days[g].min_time&&(k.days[g].min_time=
this.timeBorder),"undefined"===typeof k.days[g].max_time&&(k.days[g].max_time=e.MINUTES_IN_DAY-this.timeBorder)));this.data.addData(k);this.setCurrentTime(c.server_resource_time);(k="true"==this.previousDate&&!this._isNewPidOrDate()&&1<initFilterRatioValue?initFilterRatioValue:this._calculateTimeRatioToFit(k.width||this.canvases.timeChart.body.parent().width()))&&this.setTimeRatio(k);this._initData();this._createDayLine();this._updateView();this._initIpadData();this._hideWait();this._updateTimeLine();
this._createMultiDayActivityLabel()},setShifts:function(b){this.shifts=b},setNonWorkingReasons:function(b){this.nonWorkingReasons=b},setCurrentTime:function(b){this.dtime=b},setTimeRatio:function(b){"number"===typeof b&&b!==this.options.timeRatio&&(this.options.timeRatio=b,this.canvases.timeChart.body.css("left",0),this.canvases.timeChart.head.css("left",0),this._updateView(!0),this._updateTimeLine(),this._updateLabels(),b=this._timeToView(this.lastTotals.min_time-this.minTime-this.options.timePadding),
this.setHScroll(b))},getTimeRatio:function(){return this.options.timeRatio},resize:function(b){var c="true"==this.previousDate&&!this._isNewPidOrDate()&&1<initFilterRatioValue?initFilterRatioValue:this._calculateTimeRatioToFit(b.width||this.canvases.timeChart.body.parent().width());c&&this.setTimeRatio(c);this.scrollWidth=this._getScrollWidth();this._setWidth(b.width,b.withoutRequest);this._setHeight(b.height)},update:function(b){this._trigger("updatePage",null,{from:this.firstShow,to:this.lastShow+
this.options.showPageSize,visible:b?{}:this.data.getVisibleProviders(this.firstShow,this.lastShow+this.options.showPageSize)})},reload:function(){this._trigger("updatePage",null,{from:1,to:parseInt(1+this.lastHeight/this.options.lineHeight,10)+this.options.showPageSize,visible:{}})},destroy:function(){d.Widget.prototype.destroy.apply(this,arguments);delete this.options.lines},getMonthViewData:function(){return this.data},getVScroll:function(){return this.vScrollPos},getHScroll:function(){return this.hScrollPos},
absoluteToBody:function(){return 0},viewToTime:function(){return 0},_create:function(){var b=this.options,c=this.element,d=navigator.userAgent.toLowerCase();toa.browser.msie&&(b.animate=!1);this.isIPad=0<=d.indexOf("iphone")||0<=d.indexOf("ipad");this.oldData={};this.offset=this.canvasMargin=0;this.lastTotals={};this.dropOnDivAllowed=!0;this.gantLblId=generate_id();this.featureToggler=toa.app.model("featureToggler");c.addClass("toaGantt");c.html(['                <table>                    <tr class="toaGantt-head">                        <td><div class="toaGantt-provTree">                            <div class="toaGantt-canvas">',
h(8214),'</div></div></td>                        <td>                            <div class="toaGantt-timeChart oj-scrollbar-force">                            <div class="toaGantt-canvas"></div></div></td>                        <td><div class="toaGantt-withoutDate">                            <div class="toaGantt-canvas">                            <span title="',h(8203),'" class=\'toaGantt-withoutDate-icon\'>&nbsp;</span>                            </div></div></td>                        <td><div class="toaGantt-vScroll oj-scrollbar-force">                            <div class="toaGantt-canvas">&nbsp;</div></div></td>                    </tr>                    <tr class="toaGantt-body">                        <td><div class="toaGantt-provTree">                            <div class="toaGantt-canvas"></div>                            </div></td>                        <td><div class="toaGantt-timeChart oj-scrollbar-force">                            <div class="toaGantt-canvas"></div></div></td>                        <td><div class="toaGantt-withoutDate">                            <div class="toaGantt-canvas"></div></div></td>                        <td><div class="toaGantt-vScroll oj-scrollbar-force">                            <div class="toaGantt-canvas"></div></div></td>                    </tr>                    <tr class="toaGantt-bottom">                        <td><div class="toaGantt-provTree">                            <div class="toaGantt-canvas"></div></div></td>                        <td><div class="toaGantt-timeChart oj-scrollbar-force">                            <div class="toaGantt-canvas"></div></div></td>                        <td><div class="toaGantt-withoutDate">                            <div class="toaGantt-canvas"></div></div></td>                        <td><div class="toaGantt-vScroll oj-scrollbar-force">                            <div class="toaGantt-canvas"></div></div></td>                    </tr>                </table>'].join(""));
this.options.enableWithoutDate||c.find("div.toaGantt-withoutDate").closest("td").hide();this.divs={};this.canvases={};this.colsName=["provTree","timeChart","withoutDate","vScroll"];this.rowName=["head","body","bottom"];this.dragable=[1,2];this.dropable=[1,2];this.lines=[];this.vScrollPos=this.hScrollPos=0;this.timeLine=null;this.dayLine=[];this.minTime=0;this.maxTime=1920;this.timeBorder=0;this.minTimeRatio=0.2;this.lastHeight=this.lastWidth=this.dtime=0;this.lastShow=this.firstShow=1;this.loading=
null;this.scrollWidth=this._getScrollWidth();this.timerUpdateLabels={withoutDate:null};this.multiDayActivity={};this.data=new toa.MonthViewData;this._cachingDivs()},_init:function(){this._setupDivs();this._setHeight();this._setWidth(0,this.options.withoutRequest);this.setHScroll();this._createHint()},_initData:function(){var b=this.canvases.provTree.body,c=this.canvases.timeChart.body,d=this.canvases.withoutDate.body,e=this.data.getTotalsCount()*this.options.lineHeight,k=e>this.lastHeight?e:this.lastHeight;
this.canvasHeight!=k&&(this.canvasHeight=k,b.height(k),c.height(k),d.height(k),this.canvases.vScroll.body.height(e));this.data.totals.max_time!=this.data.totals.min_time&&(this.lastTotals=this.data.totals,this.maxTime<this.data.totals.max_time+this.options.timePadding&&(this.maxTime=this.data.totals.max_time+this.options.timePadding),this.minTime>this.data.totals.min_time-this.options.timePadding&&(b=this._timeToView(this.minTime-(this.data.totals.min_time-this.options.timePadding)),c=b+this.getHScroll(),
this.offset+=b,this.minTime=this.data.totals.min_time-this.options.timePadding,this.canvases.timeChart.head.css("left",0),this.canvases.timeChart.body.css("left",0),this.canvases.timeChart.bottom.width(this._timeToView(this.maxTime-this.minTime)),this.setHScroll(c)),this._hideWait())},getDaysViews:function(){var b=[];this.canvases.timeChart.body.find("div.toaGantt-day").each(function(){var c=d(this);b.push({element:c,date:c.attr("line-day")})});return b.length&&b.sort(function(b,c){return b.date===
c.date?0:b.date>c.date?1:-1})||!1},_calculateTimeRatioToFit:function(b){var c=0,d=!1,e;for(e in this.data.days)c+=this._getDayVisibleMinutes(e);c&&b&&(d=b/c,d<this.minTimeRatio&&(d=this.minTimeRatio));return Math.round(1E4*d)/1E4},_updateView:function(b){var c=this;c.firstShow=1+parseInt(c.vScrollPos/c.options.lineHeight,10);c.lastShow=1+parseInt(c.firstShow+c.lastHeight/c.options.lineHeight,10);var k=c.firstShow-c.options.showPageSize;1>k&&(k=0);c._isNewPidOrDate()?c.canvases.provTree.body.empty():
c.canvases.timeChart.body.find("div.toaGantt-day").hide();var g=0;c._recalculateTimeRatio(c.data.days);for(var t in c.data.days)if(c.data.days.hasOwnProperty(t)){for(var u=this.getDaysViews(),v=c.options.minColWidth,g=g+(v+1),w=c.data.days[t].date,x=!1,y=0;y<u.length;y+=1)if(w===u[y].date){x=u[y].element;break}if(!1===x)if(x=d('<div class="toaGantt-day day-'+w+'" line-day="'+w+'"></div>').css({width:v+"px"}),!1===u)x.appendTo(c.canvases.timeChart.body);else{v=!1;for(y=0;y<u.length;y+=1)if(w<u[y].date){x.insertBefore(u[y].element);
v=!0;break}!1===v&&x.insertAfter(u[u.length-1].element)}else{y={width:v+"px","border-right":"1px solid #A6A5A2"};if(e.formatDate("Y-m-01",e.parseDate("iso",w))===w||e.formatDate("N",e.parseDate("iso",w))==toa.app.model("companySettings").getUser().week_start+1)v-=1,y=d.extend(y,{width:v+"px","border-left":"1px solid #A6A5A2"});x.css({"border-right":0,"border-left":0}).css(y).show()}}x&&x.css({border:"none"});c.canvases.timeChart.body.width(g+"px");c.canvases.timeChart.bottom.width(g+"px");0!==c.canvases.timeChart.bottom.outerWidth()&&
c.divs.timeChart.bottom.outerWidth()===c.canvases.timeChart.bottom.outerWidth()?(c.divs.timeChart.bottom.height(0),g=c.lastHeight=c.element.height()-c.divs.timeChart.head.parent().outerHeight()):(c.divs.timeChart.bottom.height(c.scrollWidth),g=c.lastHeight=c.element.height()-c.divs.timeChart.head.parent().outerHeight()-c.divs.timeChart.bottom.parent().outerHeight());for(var z in c.divs)c.divs[z].body.height(g);z=c.lastShow+c.options.showPageSize;g=(this.options.daysInCache-(z-k)*Object.keys(c.data.days).length)/
2;t=k-g;c.temp={from:0<t?t:0,to:z+g};c.lines.forEach(function(b,d){(d<c.temp.from||d>c.temp.to)&&c._hideLine(d)});delete c.temp;for(y=k;y<=z;y++)b&&c._hideLine(y),c._showLine(y);c._createDayLine()},_setupDivs:function(){var b=this;b.element.delegate(".monthGantt-tb","mouseenter",function(b,c){var e=d(this).data("master-id");""!=e&&d('.monthGantt-tb[data-master-id="'+e+'"]').addClass("toaGantt-multiday-segment");d(this).addClass("monthGantt-tb-hover")});b.element.delegate(".monthGantt-tb","mouseout",
function(b,c){var e=d(this).data("master-id");""!=e&&d('.monthGantt-tb[data-master-id="'+e+'"]').removeClass("toaGantt-multiday-segment");d(this).removeClass("monthGantt-tb-hover")});b.element.delegate(".monthGantt-tb","mousedown touchstart",g);b.element.delegate(".toaGantt-tb","mousedown touchstart",g);var c={parent:b,settings:b.options.settings,multiday:!0},e=new toa.GanttTargetDivsProvider(c);b.divs.provTree.body.css("zIndex",100).droppable({tolerance:"pointer",accept:"[aid][movable!=false]",dragmove:e.handlerOnDragMove,
drop:e.handlerOnDrop});var k=new toa.GanttTargetDivsOrdered(c);b.divs.timeChart.body.css("zIndex",101);b.isIPad?b.divs.timeChart.body.droppable({tolerance:"pointer",accept:"[aid][movable!=false]",dragmove:function(c,d){c.originalEvent.target=c.target=document.elementFromPoint(c.originalEvent.clientX,c.originalEvent.clientY);var g=b.ipad.provTree;c.originalEvent.clientX>=g.left&&c.originalEvent.clientX<=g.left+g.width&&c.originalEvent.clientY>=g.top&&c.originalEvent.clientY<=g.top+g.height?e.dragmove(c,
d):k.dragmove(c,d)},drop:function(c,d){c.originalEvent.target=c.target=document.elementFromPoint(c.originalEvent.clientX,c.originalEvent.clientY);var g=b.ipad.provTree;c.originalEvent.clientX>=g.left&&c.originalEvent.clientX<=g.left+g.width&&c.originalEvent.clientY>=g.top&&c.originalEvent.clientY<=g.top+g.height?e.drop(c,d):k.drop(c,d)}}):b.divs.timeChart.body.droppable({tolerance:"pointer",accept:"[aid][movable!=false]",dragmove:k.handlerOnDragMove,drop:k.handlerOnDrop});c=new toa.GanttDropActionWithoutDate(c);
b.divs.withoutDate.body.css("zIndex",103).droppable({tolerance:"pointer",accept:"[aid][movable!=false]",dragmove:c.handlerOnDragMove,drop:c.handlerOnDrop});for(var t=c=0;2>=t;t++){var u=b.colsName[t],v=b.divs[u],c=c+v.body.parent().width();if(b.options.enableWithoutDate||"withoutDate"!=b.colsName[t+1])v.resizer=d("<div/>").addClass("toaGantt-resize-helper").data("colName",u).data("colNameNext",b.colsName[t+1]).css("left",c).draggable({axis:"x",cursor:"col-resize",zIndex:5E3,scope:"timeviewtable",
start:function(c,e){d(this).data("start",e.position.left);var k=d(this).next(".toaGantt-resize-helper"),k=k.length?k.position().left:b.element.width()-30,g=d(this).prev(".toaGantt-resize-helper"),g=g.length?g.position().left:30;d(this).data("max",k-30);d(this).data("min",g+30)},drag:function(b,c){var e=d(this).data("max");c.position.left>e?c.position.left=e:(e=d(this).data("min"),c.position.left<e&&(c.position.left=e))},stop:function(c,e){var k=d(this).data("colName"),g=d(this).data("colNameNext"),
n=e.position.left-d(this).data("start"),p=b.divs;b._setColWidth(k,p[k].body.width()+n);b._setColWidth(g,p[g].body.width()-n);b._recalculateResizers();b.setHScroll();b._updateLabels();b._setWidth()}}).appendTo(b.element)}b.divs.timeChart.bottom.css({height:b.scrollWidth}).scroll(function(){b.setHScroll();b._calculationMonthLine()});b.canvases.timeChart.bottom.css({height:"1px"});b.divs.vScroll.body.css({"overflow-y":"auto"}).scroll(function(){b.setVScroll(b.divs.vScroll.body.scrollTop())});b._setColWidth("vScroll",
b.scrollWidth);b.divs.withoutDate.body.delegate(".toaGantt-label","mousedown",function(c,e){var k=d(this).parent().attr("par_pid");b._trigger("clickCounterLabel",null,{pid:k,group:"withoutDate"})});b.element.bind("mousewheel",function(c,d,e,k){d=40;var g=1;"MacIntel"==window.navigator.platform&&(d=2,g=-1);c.shiftKey?0===e&&(c=b.divs.timeChart.bottom,k=c.scrollLeft()-k*d,c.scrollLeft(k)):(c=b.divs.vScroll.body,k=c.scrollTop()-k*d,c.scrollTop(k));0!==e&&(c=b.divs.timeChart.bottom,k=c.scrollLeft()-e*
d*g,c.scrollLeft(k))});b._initTouch()},_initTouch:function(){var b=this;b.touch={lastX:0,lastY:0,moved:!1};b.element.bind("touchstart",function(c){var d=c.originalEvent.changedTouches[0];b.touch.lastX=d.clientX;b.touch.lastY=d.clientY;b.touch.moved=!1;c.preventDefault();return!1});b.element.bind("touchend touchcancel",function(c){if(!_DATA||!_DATA.ipadDrag){if(b.touch.moved)return c.preventDefault(),!1;c=c.originalEvent.changedTouches[0];touchTrigger("mousedown",c);touchTrigger("click",c);return!1}});
b.element.bind("touchmove",function(c){if(!_DATA||!_DATA.ipadDrag){b.touch.moved=!0;var d=c.originalEvent.changedTouches[0],e=d.clientX,k=b.touch.lastX-e;b.touch.lastX=e;e=d.clientY;d=b.touch.lastY-e;b.touch.lastY=e;e=b.divs.timeChart.bottom;k=e.scrollLeft()+k;e.scrollLeft(k);e=b.divs.vScroll.body;k=e.scrollTop()+d;e.scrollTop(k);c.preventDefault();return!1}})},_fillProviderTimezones:function(b){for(var c in b.providers)if(b.providers.hasOwnProperty(c))for(var d in b.providers[c].days)if(b.providers[c].days.hasOwnProperty(d)){var e=
b.providers[c].days[d];"undefined"===typeof e.S&&(e.S=b.default_diff)}},_createMultiDayActivityLabel:function(){if(0!==Object.keys(this.multiDayActivity).length){this.divs.timeChart.body.find(".label-text").remove();for(var b=Object.keys(this.multiDayActivity),c=this.divs.timeChart.body[0],e="",k=0;k<b.length;k++)for(var g=d('a.monthGantt-tb[data-master-id="'+b[k]+'"]',c).filter(function(b,c){return d(c).hasClass("monthGantt-tb-open-start")&&d(c).hasClass("monthGantt-tb-open-end")?!1:c}),u=null,v=
null,w=null,x=null,y=0;y<g.length;y++){var z=g[y];if(d(z).hasClass("monthGantt-tb-open-end")||d(z).hasClass("monthGantt-tb-open-start"))d(z).hasClass("monthGantt-tb-open-end")?(u=z.parentElement.offsetTop,v=z.parentElement.parentElement.offsetLeft,w=z.getAttribute("data-label")||"",x=z.offsetWidth):(d(z).hasClass("monthGantt-tb-open-start")&&(x=z.parentElement.parentElement.offsetLeft+z.offsetWidth-v),e+='<span class="label-text" style="top: '+u+"px; left: "+v+"px; width: "+x+'px;">'+w+"</span>");
else{var A=z.getAttribute("data-label")||"";z.text="";e+='<span class="label-text" style="top: '+z.parentElement.offsetTop+"px; left: "+(z.parentElement.parentElement.offsetLeft+z.offsetLeft)+"px; width: "+z.offsetWidth+'px;">'+A+"</span>"}}this.divs.timeChart.body.append(e)}},_initIpadData:function(){if(!this.isIPad)return!1;"undefined"===typeof this.ipad&&(this.ipad={});var b=this.divs.provTree.body,c=b.offset();this.ipad.provTree={top:c.top,left:c.left,width:b.width(),height:b.height()};return!0},
_createDayLine:function(){var b=0,c=0,k=[];this.canvases.timeChart.head.find("div.toaGantt-day-line-head").remove();this._recalculateTimeRatio(this.data.days);for(var g in this.data.days)if(this.data.days.hasOwnProperty(g)){var t=this.options.minColWidth,b=b+(t+1),u="",v="",w="mark",x=e.formatDate("Y-m-d",e.currentDate(this.selectedResource.get("ZONE_DIFF"))),y=e.formatDate("j,F,D,Y",e.parseDate("iso",this.data.days[g].date)).split(","),z=y[2],A=parseInt(y[0],10);0===c&&(t-=1);x===this.data.days[g].date&&
(v=" current-day");1===A&&(u=" start-new-month",t-=2);e.formatDate("N",e.parseDate("iso",this.data.days[g].date))==toa.app.model("companySettings").getUser().week_start+1&&(w="mark-start-week");v=['<div class="month-name">&nbsp;</div><div class="day-with-weekday-short-name">','   <span class="'+v+'">'+z+" "+A+"</span>",'   <div class="'+w+'"></div>',"</div>"].join("");1!==parseInt(y[0],10)&&0!==c||k.push({idx:c,width:b,monthFullName:y[1]+" "+y[3]});d('<div class="toaGantt-day-line-head'+u+'" line-day="'+
this.data.days[g].date+'"></div>').css({width:t+1+"px"}).html(v).appendTo(this.canvases.timeChart.head);c++}this._createMonthLine(k,b);this.canvases.timeChart.head.width(b+"px")},_createMonthLine:function(b,c){this.canvases.timeChart.head.find(".month-names").remove();var e=d('<div class="month-names"></div>'),k=[],g;for(g in b)if(b[g]){var u=void 0!==b[parseInt(g,10)+1]?b[parseInt(g,10)+1].width-b[g].width-10:c-b[g].width-10,u=0>u?"auto":u+"px";k.push(['<div class="month-name-first-body" style="width: '+
u+'">','<div class="month-name-first">',b[g].monthFullName,"</div></div>"].join(""))}e.html(k.join("")).prependTo(this.canvases.timeChart.head)},_calculationMonthLine:function(){var b=this.canvases.timeChart.head.find(".month-name-first:eq(0)"),c=this.canvases.timeChart.head.find(".month-name-first:eq(1)"),d=parseInt(b.width(),10);this.getHScroll()<=d&&(b.css({transform:"translateX("+this.getHScroll()+"px) translateZ(0)"}),c.css({transform:"translateX(0) translateZ(0)"}));this.getHScroll()>d&&(b=
0>this.getHScroll()-d-10?0:this.getHScroll()-d-10+"px",c.css({transform:"translateX("+b+") translateZ(0)"}))},_excludeNotVisibleDays:function(b){var c={};if(b.days)for(var d in b.days)b.days.hasOwnProperty(d)&&(b.exclude_first_day&&b.previous_date===b.days[d].date||b.days[d]!==e.DAY_WITHOUT_DATE&&(c[d]=b.days[d]));return c},_updateTimeLine:function(){if(this.timeLine&&this.selectedResource){var b=this.getCurrentTime();if(0>b)this.timeLine.hide();else{var c=e.currentDate(this.selectedResource.get("ZONE_DIFF")),
k=e.toDateSystemString(c),g=this.data.days[k];if("undefined"===typeof g)this.timeLine.hide();else if(c=(b%1440-g.min_time+this.timeBorder)*this.getTimeRatio(),!g||0>c)this.timeLine.hide();else{var g=0,t=1E5;d.each(this.data.days,function(b){b<k&&t>this._getDayColumn(b).offset().left&&(t=this._getDayColumn(b).offset().left)}.bind(this));1E5!==t&&(g=this._getDayColumn(k).offset().left-t);this.currentTimeModel.set({timeString:this._formatTime(b),baseOffset:g,offset:c});this.timeLine.show()}}}},_formatTime:function(b){var c=
new Date;c.setHours(0,b,0,0);return e.formatDate("time",c)},_createHint:function(){this.hint=d('<div class="toaGantt-hint"></div>')},_cachingDivs:function(){var b=this.colsName,c;for(c in b){var d=b[c];this.divs[d]={prevColName:b[c-1],nextColName:b[+c+1]};this.canvases[d]={};for(var e in this.rowName){var k=this.rowName[e];this.divs[d][k]=this.element.find("tr.toaGantt-"+k+" div.toaGantt-"+d);this.canvases[d][k]=this.element.find("tr.toaGantt-"+k+" div.toaGantt-"+d+" div.toaGantt-canvas")}}this.canvases.timeChart.head.css("left",
-this._getCanvasOffset());this.canvases.timeChart.body.css("left",-this._getCanvasOffset());this.canvases.provTree.body.css("left",-this._getCanvasOffset());this.timeScaleDiv=this.divs.timeChart.head.children("div.toaGantt-time-scale")},_timeToView:function(b,c){return parseInt(c?(b-this.minTime)*this.options.timeRatio:b*this.options.timeRatio,10)},_getScrollWidth:function(){if(this.cachedScrollWidth)return this.cachedScrollWidth;var b=d('<div style="position:absolute;left:-1000px;width:100px;height:100px;overflow:scroll"><div style="width:200px;height:200px">Test</div></div>');
b.appendTo("body");var c=b[0].offsetWidth-b[0].clientWidth+1;b.remove();return this.cachedScrollWidth=c},setVScroll:function(b,c){var d=this;d.vScrollPos=b;d.divs.timeChart.body.scrollTop(b);d.divs.provTree.body.scrollTop(b);d.divs.withoutDate.body.scrollTop(b);d.divs.vScroll.body.scrollTop(b);clearTimeout(d.vSrollTimer);clearTimeout(d.timeOutUpdate);clearTimeout(d.timeOutPaging);c||(d.vSrollTimer=setTimeout(function(){d._updateView()},3*d.options.responseDelay),d.timeOutPaging=setTimeout(function(){for(var b=
d.data.getVisibleProviders(d.firstShow,d.lastShow),c=d.firstShow;c<d.lastShow+d.options.showPageSize;c++)if(!b[c]){d._showWait((c-1)*d.options.lineHeight);break}d._trigger("updatePage",null,{from:d.firstShow,to:d.lastShow+d.options.showPageSize,visible:b})},3*d.options.responseDelay))},setHScroll:function(b){"number"!=typeof b||isNaN(b)?b=this.divs.timeChart.bottom.scrollLeft():this.divs.timeChart.bottom.scrollLeft(b);this.hScrollPos=b;this.divs.timeChart.head.scrollLeft(b);this.divs.timeChart.body.scrollLeft(b);
this.timeScaleDiv.css({left:b+"px"})},_setHeight:function(b){var c=this.element.height()?this.element.height():d(window).height();b=b?b:c;this.element.height(b);(c=this.divs.timeChart.body.children(".toaGantt-canvas").first())&&c.height&&0<c.height()&&c.height()<b&&(c.height(b),c.children(".toaGantt-hour-line").height("inherit"),c.children(".toaGantt-time-line").height("inherit"));this._updateView()},_setWidth:function(b,c){var d=this,e=b?b:d.element.width();!0!==c&&clearTimeout(d.resizeTimeOut);
d.element.width(e);d._setColWidth("vScroll",d.scrollWidth);d.lastWidth=e;d._resizeCol("timeChart");d._recalculateResizers();!0!==c&&(d.resizeTimeOut=setTimeout(function(){d.update(!0)},5*d.options.responseDelay))},_setColWidth:function(b,c){if(!(0>=c)){var d=this.divs[b];d.head.width(c);d.body.width(c);d.bottom.width(c);d.width=c}},_recalculateTimeRatio:function(b){if(b&&"object"===typeof b){var c=this.timeBorder,d,e;for(e in b)if(b.hasOwnProperty(e)){var k=b[e].max_time+c-(b[e].min_time-c);if(!d||
k<d)d=k}"undefined"!==d&&(b=d*this.options.timeRatio,b<this.options.minColWidth&&0<b&&(this.options.timeRatio=this.options.minColWidth/d))}},_getDayVisibleMinutes:function(b){if("string"!=typeof b)throw Error("_getDayVisibleMinutes: argument dateString is not a string");b=this.data.days[b];return"object"!=typeof b||"number"!=typeof b.min_time||"number"!=typeof b.max_time?0:b.max_time-b.min_time+2*this.timeBorder},_recalculateResizers:function(){var b=this.divs,c;for(c in b){var d=b[c];d.width=d.body.width();
if(d.resizer){var e=b[d.nextColName];e&&e.body.is(":visible")&&d.resizer.css("left",e.body.position().left)}}},_updateLabels:function(b,c){var d=this;if(!b)setTimeout(function(){d._updateLabels("withoutDate")},1);else if("withoutDate"===b)for(var e in d.lines){var k=d.lines[e];k&&(k[b].remove(),delete k[b],k[b]=d._createWtQueueLine(e),d.canvases[b].body.append(k[b]))}},_resizeCol:function(b){var c=this.divs,c=this.lastWidth-c.provTree.body.parent().outerWidth()-c.timeChart.body.parent().outerWidth()-
(this.options.enableWithoutDate?c.withoutDate.body.parent().outerWidth():0)-(20<c.vScroll.body.parent().outerWidth()?c.vScroll.body.parent().outerWidth():20)+c[b].body.parent().outerWidth();this._setColWidth(b,c)},_createProviderBar:function(b){return toa.TemplateCache.create("views/gantt/MonthGantt.createProviderBar",'<div class="monthGantt-tb monthGantt-tb-name">,<button role="button" aria-dropeffect="popup" pid="<%= id %>" class="<%= icon %>">,&nbsp;,</button>,&nbsp;<%- name %>,</div>'.split(",")).apply({id:b.getId(),
icon:this._getResourceIconClassName(b),name:b.getName()})},_getResourceIconClassName:function(b){return b.getIconPrefix()+" pt"+b.getResourceTypeIcon()+"_64_1024_0"},_createWtQueueLine:function(b){var c=5,g=0,s=[],t=this.data.getProviderFromLine(b);if(!t)return d("");var u=this._getLineWDQueue(b),v=this.divs.withoutDate.width-30-20,w;for(w in u)if(c<v){var x=u[w];x.aid=x.I;x.date="3000-01-01";x.pid=t.getId();x.ordered="undefined"!==typeof x.S;x=new toa.Activity(x);s.push(k(x,c,1,!0));c+=x.fullDuration()+
5}else g++;g&&s.push('<div class="toaGantt-label" ','title="'+h(15920)+'" style="left:',v+20-10,'px">',g?" +"+g:"","</div>");c=s.join("");return this._createQueueLine(b,t.getId(),c,"withoutDate",e.DAY_WITHOUT_DATE)},_createQueueLine:function(b,c,e,k,g){var u=this,v=("q-"+g+"-"+k+"-"+c).toLowerCase();b=['<div class="toaGantt-tl ',v," toaGantt-tl-",this.gantLblId,'" num="',b,'" par_pid="',c,'" style="top:',(b-1)*this.options.lineHeight,'px">',e,"</div>"].join("");b=d(b);"provTree"==k&&(b.css("left",
u.canvasMargin+"px"),b.hover(function(b){u.element.find("."+v).addClass("toaGantt-tl-hover")},function(b){u.element.find("."+v).removeClass("toaGantt-tl-hover")}));return b},_createProviderLine:function(b){var c=this,d=c.data.getProviderFromLine(b);if(d){var e={},k=c._createProviderBar(d);e.provTree=c._createQueueLine(b,d.getId(),k,"provTree","alldays");e.timeChart={};var k=Object.keys(c.data.days).map(function(b){return c.data.days[b]}),g;for(g in k){var v=void 0!==k[parseInt(g,10)+1]?k[parseInt(g,
10)+1].date:null,w=k[parseInt(g,10)].date;e.timeChart[w]=c._createQueueLine(b,d.getId(),c._createProviderDensity(d,w,v),"timeChart",w)}e.withoutDate=c._createWtQueueLine(b);return e}},_createProviderDensity:function(b,c,e){if(!b.get("days")[c])return"";var k=b.get("days")[c],g=k.blocks,u="",v="",w="",x="",y="",z=!1,A=!1,B=!1,D="";if(void 0===g||void 0===g[0]&&void 0===k.SO)return"";if(0<d('.filter_form input[name="include_on_call"]').length){var C=1;d(this.canvases.timeChart.body[0]).parents().hasClass("toa-twopanel-first-panel")&&
(C=0);B=d('.filter_form input[name="include_on_call"]')[C].checked}"SO"in k&&(z=!0,"undefined"!=typeof k.FO&&((A=parseInt(k.TO,10)<=parseInt(k.TR,10)||parseInt(k.FO,10)<=parseInt(k.FR,10))||(y="is-last")),D="undefined"!=typeof k.DO?k.DO:"",v=this.shifts[k.SO]instanceof Object?this.shifts[k.SO]:null,k.rc&&(null===v&&(v={name:h(16212)}),v.reason=this.nonWorkingReasons[k.rc].text));k='<div class="toaGantt-tl-shift" style="width: '+this.options.minColWidth+'px;"></div>';null!==v&&(x="<div role='status' class='toa-hint-field'><span class='cap'>"+
h(11126)+": </span>"+v.name+"</div>",v.time_from&&(C=v.time_from.split(":"),x+="<dv role='status' class='toa-hint-field'><span class='cap'>"+h(11193)+": </span>"+(12<parseInt(C[0])?parseInt(C[0])-12+":"+C[1]+" PM":parseInt(C[0])+":"+C[1]+" AM")+"</dv>"),v.time_to&&(C=v.time_to.split(":"),x+="<div role='status' class='toa-hint-field'><span class='cap'>"+h(11194)+": </span>"+(12<parseInt(C[0])?parseInt(C[0])-12+":"+C[1]+" PM":parseInt(C[0])+":"+C[1]+" AM")+"</div>"),v.reason&&(x+="<div role='reason' class='toa-hint-field'><span class='cap'>"+
h(15845)+": </span>"+v.reason+"</div>"));var F=toa.TemplateCache.create("views/gantt/MonthGantt.onCallTemplate",['<button class="on-call-shift <%=smallShiftClass%> <%=isOnCallFirstClass%><% if (typeof(decoration) !== "undefined") { %> decoration-<%= decoration %>" aria-label="<%= h(app.constants.ON_CALL_DECORATION_ARIA_LABELS[decoration]) %><% } %>" data-on-call="true" data-short_hint="<%=onCallHintTemplate%>">',"&nbsp;","</button>"]),C=toa.TemplateCache.create("views/gantt/MonthGantt.workDay",'<a title="<%=labelText%>" <%=params%> class="monthGantt-tb toaGantt-tl-density monthGantt-tb-thirty-day-view <%=aditional%>",style="width: <%=width%>px; left: <%=left%>px;,background-color: <%=color%>;,<%=zebraStyle%>,">,<%=labelText%>,</a>'.split(",")),
J=0,H=0,K="",G=0,L=0,I="",G=null,M="",N=0,O={},E;for(E in g)M="",void 0!==g.hasOwnProperty(E)&&"S"!==E&&(g[E].activity&&g[E].activity.L&&(M=g[E].activity.L,u="small-on-call-shift"),g[E].multipleActivities&&0<g[E].multipleActivities.length&&(u="small-on-call-shift"),J+=parseInt(g[E].duration,10),H++,G=E,g[E].activity&&g[E].activity.I&&(O[g[E].activity.I]=M));z&&B?(N=J/(this.options.minColWidth-22),A&&(L+=24),w+=F.apply({currentShift:v,onCallHintTemplate:x,smallShiftClass:u,isOnCallFirstClass:y,decoration:D})):
N=J/this.options.minColWidth;null!==e&&g[G]&&g[G].activity&&g[G].activity.M&&(E=b.get("days")[e])&&E.blocks&&E.blocks[0]&&E.blocks[0].activity&&E.blocks[0].activity.M&&E.blocks[0].activity.M===g[G].activity.M&&(E.blocks[0].activity.openStart=!0,g[G].activity.openEnd=!0);for(E=0;E<H;E++)if(M="",void 0!==g.hasOwnProperty(E)&&(G=Math.round(g[E].duration/N),v=x="",e=[],L+=G,void 0!==g[E].multipleActivities||void 0!==g[E].activity))void 0!==g[E].multipleActivities&&(v="#cccccc",M="",I=toa.utils.color.darken(toa.utils.color.hexToRgb(v),
0.4,"grey"),x=["background: repeating-linear-gradient(   to right,   #FFFFFF 0,   #FFFFFF 3px,","   "+v+" 2px,","   "+v+" 5px",");","border: 1px solid "+I+";"].join(""),I=['data-date="'+c+'"','par_date="'+c+'"','data-offset="'+g[E].start+'"','data-limit="'+g[E].duration+'"','data-activity-duration="'+G+'"','aid="'+g[E].multipleActivities.join(",")+'"','par_pid="'+b.getId()+'"'],g[E].hasMultidayActivities&&I.push("has-multiday-activity='true'"),I=I.join(" ")),void 0!==g[E].activity&&(I=g[E].activity.s||
"pending",u=g[E].activity.t,I=g[E].activity.a&&"pending"===I?"warning":I,v="#"+toa.app.model("companySettings").getActivityColorById(u,I),I=toa.utils.color.darken(toa.utils.color.hexToRgb(v),0.2,"grey"),x="border: 1px solid "+I+";",I=[],g[E].activity.I&&I.push("aid='"+g[E].activity.I+"'"),g[E].activity.P&&I.push("aid='-"+g[E].activity.P+"|"+b.getId()+"|"+c+"'"),g[E].activity.openStart&&e.push("monthGantt-tb-open-start"),g[E].activity.M&&(y=g[E].activity.M,1===H&&g[E].activity.M&&g[E].duration===J&&
(I.push("data-full-day-segment "),void 0!==typeof this.multiDayActivity[y]&&(this.multiDayActivity[y]={})),I.push("data-master-id='"+y+"'"),I.push("data-label='"+g[E].activity.L+"'")),g[E].activity.openEnd&&e.push("monthGantt-tb-open-end"),I.push('data-activity-duration="'+g[E].duration+'"'),I.push('data-activity-worktype="'+u+'"'),I.push('par_pid="'+b.getId()+'"'),I.push('data-date="'+c+'"'),I.push('par_date="'+c+'"'),I.push('data-offset="'+g[E].start+'"'),I.push('data-limit="'+g[E].duration+'"'),
I=I.join("")),g[E].activity&&g[E].activity.I&&O[g[E].activity.I]&&(M=O[g[E].activity.I]),K+=C.apply({width:G-6,left:L-G,color:v,params:I,aditional:e.join(" "),zebraStyle:x,labelText:M});return k+K+w},_getLineWDQueue:function(b){var c=[],d=e.DAY_WITHOUT_DATE;"undefined"!==typeof this.data.originalData.providers[b]&&"undefined"!==typeof this.data.originalData.providers[b].days[d]&&"undefined"!==typeof this.data.originalData.providers[b].days[d].activities&&(c=this.data.originalData.providers[b].days[d].activities);
return c},_showLine:function(b){var c=this.data.changedLines[b],d=this.lines[b];if(!d||c)if(this.data.changedLines[b]=!1,d&&this._hideLine(b),d=this._createProviderLine(b),this.lines[b]=d){for(var e in this.data.days)c=this._getDayColumn(e),!1!==c&&c.append(d.timeChart[e]);e=this.canvases.provTree.body;0===e.find("div.toaGantt-tl[num="+b+"]").length&&e.append(d.provTree);this.canvases.withoutDate.body.append(d.withoutDate)}},_getDayColumn:function(b){b=this.canvases.timeChart.body.find(".day-"+b);
return 1==b.length?b:!1},_hideLine:function(b){var c=this.lines[b];if(c){for(var d in c.timeChart)c.timeChart[d].remove();delete c.timeChart;c.provTree.remove();delete c.provTree;c.withoutDate.remove();delete c.withoutDate;delete this.lines[b]}},_showWait:function(b){var c=this;c.loadingTimeOut||c.loadingTimeOut||(c.loadingTimeOut=setTimeout(function(){c.loading=b?d('<div class="toaGantt-wait"></div>').css({top:b+"px",left:0}).appendTo(c.divs.timeChart.body):d('<div class="toaGantt-wait"></div>').appendTo(c.element)},
200))},_hideWait:function(){this.loadingTimeOut&&(clearTimeout(this.loadingTimeOut),this.loadingTimeOut=null);this.loading&&(this.loading.remove(),this.loading=null)},_isNewPidOrDate:function(){var b=this.oldData.pid!=this.data.pid||this.oldData.date!=this.data.date;b&&(this.oldData.pid=this.data.pid,this.oldData.date=this.data.date);return b},getCurrentTime:function(){return this.dtime},_getCanvasOffset:function(){return this._timeToView(this.canvasMargin)}};c("toa.MonthGantt",b);d.widget("toa.MonthGantt",
b);d.extend(b,{version:"0.0.3",getter:"getVScroll getHScroll"})})($,toa.ns,toa.models.ObservableModel,toa.date,toa.helper.activity.makeDraggable,toa.helper.activity.createActivityBar);(function(d){d.TimeViewData=d.define(null,function(){this._create.apply(this,arguments)},{GROUP_ORDERED:0,GROUP_NOT_ORDERED:1,GROUP_NOT_SCHEDULED:2,toString:function(){return"TimeViewData"},_create:function(){this.clear()},clear:function(){$.extend(this,{version:0,timestamp:"20100617122351",providers:{},activities:{},alerts:{},team:{},provider_alerts:{},totals:{count:0,from:0,max_time:0,min_time:0,to:0},lines:{},changedLines:{}})},addDelta:function(c){var b=this;b.timestamp!=c.timestamp&&(b.clear(),
b.timestamp=c.timestamp);b.version=c.version;b.totals=c.totals||b.totals;b.smartgps_idle_timeout=c.smartgps_idle_timeout||0;$.each(this.activities,function(c){var d=c.split("|");2==d.length&&0>parseInt(d[0])&&b.deleteAct(c)});if(c.activities)for(var d in c.activities){var g=c.activities[d],k=b.activities[d];!1==g||null==g?b.deleteAct(d):(k||(k=b.addAct(d)),b.updateAct(k,g))}if(c.providers)for(var l in c.providers)d=c.providers[l],g=b.providers[l],!1===d||null===d?b.deleteProvider(l):(g||(g=b.addProvider(l)),
!0===d?g.set("version",b.version):b.updateProvider(g,d));b.updateAlerts(c.activity_alerts||{});b.updateTracks(c.provider_tracks||{});l=b.totals.to;for(g=b.totals.from;g<=l;g++)if(d=b.getProviderFromLine(g))d.set("version",b.version),k=c.provider_flags[d.getId()]||0,d.get("flags")!=k&&(d.set("flags",k),b.updateLine(d))},updateAlerts:function(c){var b,d;for(b in this.alerts)if(d=this.activities[b]){if(c[b])this.alerts[b]=c[b],d.set("alerts",c[b]),delete c[b];else{var g=this.getProviderByAct(b);g&&(g=
g.get("index"),g>=this.totals.from&&g<=this.totals.to&&d.set("alerts",0))}this.updateLine(d)}else delete this.alerts[b],c[b]||delete c[b];for(b in c)if(d=this.activities[b])d.set("alerts",c[b]),this.alerts[b]=c[b],this.updateLine(d)},updateTracks:function(c,b){b=b||!1;for(var d in c){var g=this.providers[d],k=c[d];g&&k&&(g.set("GPSSTATS",this.calulateTrack(k)),b&&this.updateLine(g))}},calulateTrack:function(c){c=$.map(c||[],function(b){return{status:b.s,start:Math.round(this.isoTimeToMinutes(b.t)),
idleTime:b.i?Math.floor(b.i/60):0}}.bind(this));return this.calculateTrackDurations(c)},calculateTrackDurations:function(c){return $.map(c,function(b,d){var g=c[d+1]||{},k=c[d-1]||{},l=b.start,n=b.idleTime||0;g&&g.start&&10>g.start-(b.start+n)&&(n=g.start-b.start);n||(n=g.start-l||2,10<n&&(l=k&&0<k.duration?l-2:l,n=k&&0<k.duration?4:2),k&&10<l-k.start&&(l-=2,n+=2));return{start:l,duration:n,originalDuration:b.idleTime||0,status:b.status}})},isoTimeToMinutes:function(c){return(d.date.parseDate("iso_long",
c)-d.date.parseDate("iso",this.date))/6E4},addAct:function(c){return this.activities[c]=new d.Activity({aid:c,date:this.date})},deleteAct:function(c){this.unlinkAct(c);delete this.activities[c]},updateAct:function(c,b){var e=c.getId();d.isDefined(b.p)||d.isDefined(b.i)||d.isDefined(b.g)?(this.unlinkAct(e),c.update(b),this.linkAct(e)):c.update(b)},unlinkAct:function(c){var b=this.activities[c];this.updateLine(b);if(d.isDefined(b)&&b.has("pid")&&0<b.get("pid")&&b.has("group")&&b.has("index")){var e=
b.get("group"),g=this.providers[b.get("pid")];g&&g.getQueue(e)[b.get("index")]===c&&delete g.getQueue(e)[b.get("index")]}},updateLine:function(c){c instanceof d.Activity&&(c=this.getProviderByAct(c));c instanceof d.Resource&&(c=c.get("index"),d.isDefined(c)&&(this.changedLines[c]=!0))},linkAct:function(c){var b=this.activities[c];if(d.isDefined(b)&&b.has("pid")&&0<b.get("pid")&&b.has("group")&&b.has("index")){var e=this.providers[b.get("pid")];e||(e=this.addProvider(b.get("pid")));e.getQueue(b.get("group"))[b.get("index")]=
c;b.get("group")==this.GROUP_NOT_SCHEDULED?b.set("date",d.date.DAY_WITHOUT_DATE):b.set("date",this.date);this.updateLine(e)}},addProvider:function(c){c=this.providers[c]=new d.Resource({pid:c});c.set("version",this.version);return c},deleteProvider:function(c){var b=d.isDefined,e=this.providers[c];if(e)for(this.updateLine(e),b(e)&&0<=e.get("index")&&delete this.lines[e.get("index")],delete this.providers[c],c=0;2>=c;c++){q=e.getQueue(c);for(var g in q)this.deleteAct(q[g])}else console.log('Imposible situation "TimeViewData.deleteProvider" pid='+
c+" not found in this.providers")},updateProvider:function(c,b){var e=d.isDefined;if(e(b)&&0<=b.i){var e=c.get("index"),g=c.getId();this.lines[e]==g&&(this.updateLine(c),delete this.lines[e]);c.update(b);e=c.get("index");this.lines[e]=g}else c.update(b);this.updateLine(c);c.set("version",this.version)},getProviderFromLine:function(c){return(c=this.lines[c])?this.providers[c]:null},getProviderByAct:function(c){c="object"==typeof c?c:this.activities[c];return c?(c=c.get("pid"))&&this.providers[c]?this.providers[c]:
null:null},getVisibleProviders:function(c,b){for(var d={},g=c;g<=b;g++){var k=this.getProviderFromLine(g);k&&(d[g]={pid:k.getId(),version:k.get("version")})}return d},getCachedProviders:function(){var c={};Object.keys(this.lines).forEach(function(b){var d=this.getProviderFromLine(b);d&&(c[b]={pid:d.getId(),version:d.get("version")})}.bind(this));return c},getClosest:function(c,b){var d=this.providers[c];if(!d)return{pre:!1,post:!1};for(var d=d.getQueue("ordered"),g=1;d[g];g++){var k=this.activities[d[g]];
if(k.get("ETA")>b){var l=k;break}var n=k}return{pre:n,post:l}},getActivity:function(c){return this.activities[c]||!1},getResource:function(c){return this.providers[c]||!1},isNotEmpty:function(){return 0<this.totals.to},getCachedRange:function(c,b,d){return{from:1>c-d?1:c-d,to:b+d,visible:this.getCachedProviders()}}})})(toa);(function(d){d.MultidaytimeViewData=d.define(null,function(){this.clear()},{GROUP_ORDERED:0,GROUP_NOT_ORDERED:1,GROUP_NOT_SCHEDULED:2,count:0,toString:function(){return"MultidaytimeViewData"},clear:function(){$.extend(this,{days:{},providers:{},activities:{},totals:{from:0,to:0,count:0},lines:{},changedLines:{}})},addData:function(c){this.setTotalsCount(c.totals.count);this.originalData=c;this.totals=c.totals||this.totals;if(c.days)for(var b in c.days)c.days[b].idx=parseInt(b),this.addDay(c.days[b]);
if(c.providers)for(b in c.providers){var d=c.providers[b];d.i=parseInt(b);d.f=33929;myProvider=this.addProvider(d.z);this.updateProvider(myProvider,d);for(var g in d.days){var k=d.days[g],l;for(l in k.activities){var n=k.activities[l];n.O=!0;n.p=d.z;n.i=parseInt(l);n.I=n.I?n.I:"-"+n.P+"|"+n.p+"|"+g;n.z=n.I;var p=this.addAct(n.I,g);this.activities[n.I]=p;this.updateAct(p,n,g)}}}},addDay:function(c){this.days[c.date]=c},addProvider:function(c){return this.providers[c]=new d.Resource({pid:c})},updateProvider:function(c,
b){var e=d.isDefined;if(e(b)&&0<=b.i){var e=c.get("index"),g=c.getId();this.lines[e]==g&&(this.updateLine(c),delete this.lines[e]);c.update(b);e=c.get("index");this.lines[e]=g}else c.update(b);this.updateLine(c);c.set("version",this.version)},addAct:function(c,b){return new d.Activity({aid:c,date:b})},updateAct:function(c,b,d){var g=c.getId();c.update(b);this.linkAct(g,d)},updateLine:function(c){c instanceof d.Activity&&(c=this.getProviderByAct(c));c instanceof d.Resource&&(c=c.get("index"),d.isDefined(c)&&
(this.changedLines[c]=!0))},linkAct:function(c,b){var d=this.activities[c];this.providers[d.get("pid")].getQueueForMultiDay(d.get("group"),b)[d.get("index")]=c;d.set("date",b)},getProviderFromLine:function(c){return(c=this.lines[c])?this.providers[c]:null},getProviderByAct:function(c){c="object"==typeof c?c:this.activities[c];return c?(c=c.get("pid"))&&this.providers[c]?this.providers[c]:null:null},getVisibleProviders:function(c,b){for(var d={},g=c;g<=b;g++){var k=this.getProviderFromLine(g);k&&(d[g]=
{pid:k.getId(),version:k.get("version")})}return d},getClosest:function(c,b,d){var g,k;c=this.providers[c].getQueueForMultiDay("ordered",d);for(var l in c)if(c.hasOwnProperty(l)){d=this.activities[c[l]];if(d.get("ETA")>b){g=d;break}k=d}return{pre:k,post:g}},getActivity:function(c){return this.activities[c]||!1},getResource:function(c){return this.providers[c]||!1},getTotalsCount:function(){return this.count},setTotalsCount:function(c){"undefined"!=typeof c&&(this.count=c)},isNotEmpty:function(){return 0<
this.totals.to}})})(toa);(function(d){d.MonthViewData=d.define(null,function(){this.clear();this.originalData=""},{count:0,toString:function(){return"MonthViewData"},clear:function(){$.extend(this,{days:{},providers:{},totals:{from:0,to:0,count:0},lines:{},changedLines:{}})},addData:function(c){this.setTotalsCount(c.totals.count);this.originalData=c;this.totals=c.totals||this.totals;if(c.days)for(var b in c.days)c.days.hasOwnProperty(b)&&(c.days[b].idx=parseInt(b),this.addDay(c.days[b]));if(c.providers)for(var d in c.providers)c.providers.hasOwnProperty(d)&&
(b=c.providers[d],b.i=parseInt(d),b.f=33929,this.updateProvider(this.addProvider(b.z),b))},addDay:function(c){this.days[c.date]=c},addProvider:function(c){return this.providers[c]=new d.Resource({pid:c})},getProviderFromLine:function(c){return(c=this.lines[c])?this.providers[c]:null},getVisibleProviders:function(c,b){for(var d={},g=c;g<=b;g++){var k=this.getProviderFromLine(g);k&&(d[g]={pid:k.getId(),version:k.get("version")})}return d},updateProvider:function(c,b){var e=d.isDefined;if(e(b)&&0<=b.i){var e=
c.get("index"),g=c.getId();this.lines[e]==g&&(this.updateLine(c),delete this.lines[e]);c.update(b);e=c.get("index");this.lines[e]=g}else c.update(b);this.updateLine(c);c.set("version",this.version)},updateLine:function(c){c instanceof d.Resource&&(c=c.get("index"),d.isDefined(c)&&(this.changedLines[c]=!0))},getClosest:function(c,b,d){var g,k;c=this.providers[c].getQueueForMultiDay("ordered",d);for(var l in c)if(c.hasOwnProperty(l)){d=this.activities[c[l]];if(d.get("ETA")>b){g=d;break}k=d}return{pre:k,
post:g}},getActivity:function(c){return this.activities[c]||!1},getResource:function(c){return this.providers[c]||!1},getTotalsCount:function(){return this.count},setTotalsCount:function(c){"undefined"!=typeof c&&(this.count=c)}})})(toa);(function(d){var c=d.view.HorizontalTwoPanelView,b=d.ActivitiesScreen.ActivitiesPanel,e=d.Controller;d.ns("toa.ActivitiesScreen.ScreenController",d.define(e,function(g){this.options={};e.apply(this,arguments);$.extend(!0,this.options,this.sandbox.options);this.initDescriptions(this.options.options.items);this.container=$("<div/>").addClass("toa-layout-fit").appendTo(this.options.content);this.sandbox.trigger("interface.resourcesTree.updateScroll");this.sandbox.trigger("layout.tabs.set",{tabs:0,show:0});
this.layout=new c(this.container,{secondPanelVisible:!1});this.layout.addListener("resize",function(b,c,d){this.adjustPanelsSizes(d)}.bind(this));var k={screenController:this,resourceTreeSelection:this.sandbox.get("resourceTreeSelection"),provider:this.sandbox.get("pid"),date:this.sandbox.get("date"),dates:[this.sandbox.get("date")]},l={treeDate:this.options.date,version:0};d.currentInterface===INTERFACE.MANAGE&&(l.resourceFavorites=new d.models.ResourceFavorites("main-favorites",_DATA.p_favorites,
_DATA.is_favorite_pid?_DATA.resourceTreeSelection.selectedPid:0));var n=new d.models.ResourceTree(BOTTOM_PANEL_MAIN_TREE,$.extend(l,this.options.options.treeInitialData));d.currentInterface===INTERFACE.MOBILITY&&n.setResourceGroups(_DATA.resource_groups,_DATA.resourceTreeSelection||{});this.panels={top:(new b("top",this.options.options.mainTreeState,k)).render(this.layout.firstPanel.content),bottom:(new b("bottom",n,k)).render(this.layout.secondPanel.content)};d.currentInterface===INTERFACE.MOBILITY&&
(k=d.widgets.HangTree.getHangTree(),k.registerTree({screen:SCREEN_MAPPINGS.activity_top,content:this.panels.top.tree.content,container:this.panels.top.tree.container,tree:this.panels.top.tree,droppable:this.sandbox}),k.registerTree({screen:SCREEN_MAPPINGS.activity_bottom,content:this.panels.bottom.tree.content,container:this.panels.bottom.tree.container,tree:this.panels.bottom.tree,droppable:this.sandbox}),k.refresh(SCREEN_MAPPINGS.activity_top));this.panels.top.disableTreeUpdates();this._addToggleListener("top");
this._addToggleListener("bottom");this.panels.top.addListener("date.changed",function(b,c){this.sandbox.trigger("global.date.set",{date:d.isObject(c)?c[c.length-1]:c,dates:d.isObject(c)?c:[c]})}.bind(this));this.resume(this.options);this.sandbox.bind({"interface.activitiesScreen.showInPanel":function(b,c){var d="",d=c.open_in_current_panel?c.hint_location&&"bottomActivitiesPanel"==c.hint_location?"bottom":"top":c.hint_location&&"bottomActivitiesPanel"==c.hint_location?"top":"bottom";this.showInPanel(d,
c.pid,c.date)}.bind(this),"interface.activitiesScreen.bottomProviderSelect":function(b,c){this.panels.bottom.treeState.selectProvider(c.pid)},"interface.favorite.applyFavoriteList":function(b,c){n.getResourceFavorites()&&n.getResourceFavorites().update(c)}})},{toString:function(){return"Activities screen controller"},suspend:function(b){e.prototype.suspend.call(this,b);d.app.reflowManager.removeListener(this.resizeEventId);this.sandbox.trigger("layout.tabs.set",{tabs:2,show:0});this.panels.top.treeState.setScrollOffset(this.panels.top.tree.getScrollOffset());
this.panels.top.viewManager.disable();this.panels.bottom.viewManager.disable();this.panels.top.unbindResourceSelected();this.panels.bottom.unbindResourceSelected();this.container.detach()},resume:function(b){e.prototype.resume.call(this,b);this.container.appendTo(b.content);this.sandbox.trigger("interface.resourcesTree.updateScroll");this.sandbox.trigger("layout.tabs.set",{tabs:0,show:0});this.resizeEventId=d.app.reflowManager.addListener("resize",function(){if(d.currentInterface!==INTERFACE.MOBILITY||
-1!==$app.request().getPathInfo().indexOf("view_activities"))this.layout.resize(),this.adjustPanelsSizes()}.bind(this));this.layout.isFirstPanelVisible&&this.panels.top.viewManager.enable();this.layout.isSecondPanelVisible&&this.panels.bottom.viewManager.enable();this.panels.top.bindResourceSelected();this.panels.bottom.bindResourceSelected();_DATA.temporaryActivityViewData&&(this.showInPanel("top",_DATA.temporaryActivityViewData.pid,_DATA.temporaryActivityViewData.date),delete _DATA.temporaryActivityViewData);
"list"==this.panels.top.getCurrentViewName()&&this.panels.top.getKeepNonScheduled()||(this.panels.top.changeDates(this.sandbox.get("dates")),this.panels.top.syncState());this.layout.resize();this.adjustPanelsSizes();this.scrollIntoView()},scrollIntoView:function(){var b=$(".edt-selected").get(0);b&&b.scrollIntoView(!1);(b=$(".toa-twopanel-second-panel .edt-selected").get(0))&&b.scrollIntoView(!1)},_addToggleListener:function(b){this.panels[b].addListener("toggle",function(){var c=this.panels[b],e=
"bottom"==b?"top":"bottom",n=this.panels[e];this.isTwoPanelsVisible()?("top"==b?(c.copyState(n),d.currentInterface===INTERFACE.MOBILITY&&(c=d.widgets.HangTree.getHangTree(),n=c.getTreeState(SCREEN_MAPPINGS.activity_bottom),c.setTreeState(SCREEN_MAPPINGS.activity_top,n)),this.hidePanel(e)):this.hidePanel(b),"time"!==this.panels.top.getCurrentViewName()&&this.panels.top.viewManager.refreshCurrentView()):(n.copyState(c),this.showPanel(e))}.bind(this))},adjustPanelsSizes:function(b){this.panels.top.resize(b);
this.panels.bottom.resize(b);return this},initDescriptions:function(b){this.viewsConfig=b;this.viewsConfigIndex={};for(b=0;b<this.viewsConfig.length;b++){var c=this.viewsConfig[b];this.viewsConfigIndex[c.label]=c}},hidePanel:function(b){if("top"==b&&!this.layout.isFirstPanelVisible||"bottom"==b&&!this.layout.isSecondPanelVisible)return this;for(var c in this.panels)this.panels.hasOwnProperty(c)&&(this.panels[c].titlePanel.setOption("backButtonIcon","icon-plus"),this.panels[c].titlePanel.setOption("backButtonHint",
h(22715)));"top"==b?(this.layout.hideFirstPanel(),this.panels.top.viewManager.disable()):(this.layout.hideSecondPanel(),this.panels.bottom.viewManager.disable(),this.panels.bottom.disableTreeUpdates());return this},showPanel:function(b){if("top"==b&&this.layout.isFirstPanelVisible||"bottom"==b&&this.layout.isSecondPanelVisible)return this;for(var c in this.panels)this.panels.hasOwnProperty(c)&&(this.panels[c].titlePanel.setOption("backButtonIcon","icon-close"),this.panels[c].titlePanel.setOption("backButtonHint",
h(22721)));"top"==b?(this.layout.showFirstPanel(),this.panels.top.viewManager.enable()):(this.layout.showSecondPanel(),this.panels.bottom.disableTreeUpdates(),this.panels.bottom.viewManager.enable());return this},isTwoPanelsVisible:function(){return this.layout.isFirstPanelVisible&&this.layout.isSecondPanelVisible},showInPanel:function(b,c,d){var e=this.panels[b];e.treeState.setSearchKey("");var p=e.getKeepNonScheduled()?e.getCurrentState().previousDate:e.getCurrentState().date;e.changeDate(d||p);
e.resetFilter();e.switchView("list",!1,!0);e.treeState.selectProvider(c);this.isTwoPanelsVisible()?e.syncState():this.showPanel(b)}}))})(toa);(function(d){var c='<div>,<div role="search" class="toa-search">,<div class="toa-search-form">,<table><tr>,<td>,<button class="toa-button toa-button-active left-arrow toa-search-button-back"><%=BACK_TO_SEARCH%></button>,<div class="toa-search-category-name"></div>,<div class="toa-search-text">,<div role="button" class="toa-search-icon">&nbsp;</div>,<input type="text" name="search_value" aria-valuemax="<%=LIMIT_OF_SEARCH_STRING%>" maxlength="<%=LIMIT_OF_SEARCH_STRING%>"/>,<div role="button" class="toa-search-clear">&nbsp;</div>,</div>,</td>,<td class="toa-search-form-last-column"><div role="button" class="toa-search-preferences-button">,<div class="toa-search-preferences-icon">&nbsp;</div>,</div></td>,</tr></table>,</div>,<div class="toa-search-data" style="overflow:auto;">,<div style="clear:both;"></div>,<div class="toa-search-empty">,<div class="toa-search-empty-title"><%=EMPTY_TITLE%></div>,<div class="toa-search-empty-msg"><%=EMPTY_MSG%></div>,</div>,<div class="toa-search-warning">,<div class="toa-search-warning-title"><%=WARNING_TITLE%></div>,<div class="toa-search-warning-msg"><%=WARNING_TEXT%></div>,</div>,<div class="toa-search-error">,<div class="toa-search-error-title"><div class="icon-warning">!</div><%=ERROR_TITLE%></div>,<div class="toa-search-error-text"><%=ERROR_TEXT%></div>,<div class="toa-search-error-msg"><%=ERROR_MSG%></div>,</div>,<div class="toa-search-empty-checkbox">,<div class="toa-search-empty-title"><%=NO_FIELDS_TITLE%></div>,<div class="toa-search-empty-msg"><%=NO_FIELDS_MSG%></div>,</div>,</div>,</div>,<div class="toa-search-preferences">,<div class="toa-search-preferences-title">,<div class="toa-search-preferences-name"><%=PREFERENCES_NAME%></div>,<button class="toa-button toa-button-active left-arrow toa-search-button-back"><%=BACK_TO_SEARCH%></button>,</div>,<div class="toa-search-border-container">,<div class="toa-search-preferences-container" >,<div class="toa-search-preferences-container-in" >,<div class="toa-search-preferences-header">,<div class="toa-search-preferences-header1"><%=PREFERENCES_CATEGORIES_HEADER%></div>,<div class="toa-search-preferences-header2"><%=PREFERENCES_CATEGORIES_TEXT%></div>,</div>,<div class="toa-search-preferences-fields"></div>,<div class="toa-search-preferences-header">,<div class="toa-search-preferences-header1"><%=PREFERENCES_DATE_HEADER%></div>,<div class="toa-search-preferences-header2"><%=PREFERENCES_DATE_TEXT%></div>,</div>,<div class="toa-search-preferences-date jet-css-only">,<select>,<%for(searchDate in searchDates) {%>,<option value="<%=searchDates[searchDate]%>"><%=h(searchDate)%></option>,<%}%>,</select>,</div>,<div style="clear:both;"></div>,</div>,</div>,</div>,</div>,</div>'.split(","),
b='<div class="<%=nameBlock%>">,<div class="toa-search-result-table-header-border"></div>,<div class="toa-search-result-table-header"><div class="toa-search-result-table-title"><%=titleBlock%></div><div class="toa-search-result-table-counter">30 of 10000</div></div>,<table class="toa-search-grid">,</table>,<div class="toa-search-show-more"><p><div class="toa-search-more-icon">&nbsp;</div>&nbsp;<%=SHOW_MORE%></p></div>,<div class="toa-search-clearing"></div>,</div>,<div class="toa-search-clearing"></div>'.split(","),
e='<div class="toa-search-preferences-field">;<div class="toa-search-preferences-index"><%=index%></div>;<div class="toa-search-preferences-checkbox"><input <%if (checked) {%>checked="checked"<%}%> type="checkbox" name="<%=typeName%>"></div>;<div class="toa-search-preferences-fieldname"><%=name%></div>;<div class="toa-search-preferences-drag"></div>;</div>'.split(";"),g=d.Controller;d.controllers.SearchActivity=d.define(g,function(){this._create.apply(this,arguments)},{activityGrids:{},searchFields:{},
searchFieldNames:{},recordsShowing:{actual:{},showing:{}},fieldsList:null,activityEmpty:null,searchError:null,searchIcon:null,partsCatalogSearchResult:[],search:null,searchText:"",oldSearchText:"",isCategoriesCahnged:!1,waitNextRequest:!1,padding:114,minResults:3,isAssigned:0,debounceTimeLimit:1E3,isChangeWorking:!1,currentSearchDate:"today",searchDates:{2287:"today",2288:"last_2_days",2289:"last_week",2290:"last_month",2291:"at_all"},countRows:30,limitOfSearchString:100,search_activity_date:"",toString:function(){return"SearchActivity controller"},
interface_mobile:3,_enable:1,_create:function(b){var e=this;g.prototype._create.call(this,b);e.search=$((new d.Template(c)).apply({PREFERENCES_NAME:h(11858),BACK_TO_SEARCH:h(11859),PREFERENCES_CATEGORIES_HEADER:h(11860),PREFERENCES_CATEGORIES_TEXT:h(11861),PREFERENCES_DATE_HEADER:h(11862),PREFERENCES_DATE_TEXT:h(11863),EMPTY_TITLE:h(11850),EMPTY_MSG:h(11851),ERROR_TITLE:h(11852),ERROR_TEXT:h(11853),ERROR_MSG:h(11854),WARNING_TITLE:h(14603),WARNING_TEXT:h(1737),NO_FIELDS_TITLE:h(13213),NO_FIELDS_MSG:h(13214),
LIMIT_OF_SEARCH_STRING:e.limitOfSearchString,searchDates:e.searchDates}));e.handlerOnChangeErrorHandler=function(b,c){this.isChangeWorking=!1}.bind(e);e.handlerSearchItemOnClick=e.onActivityRowsClick.bind(e);e.handlerSearchPCItemOnClick=e.onPartsCatalogRowsClick.bind(e);e.handlerSearchItemOnDbclick=function(){this.search.Tip("hide")}.bind(e);e.handlerOnChangeResponseHandler=function(b,c){if(this.waitNextRequest)this.isChangeWorking=!1;else{this.hideAllInnerBlocks();this.partsCatalogSearchResult=[];
this.searchData.show();var e=0,k=!1;this.search.find("toa-search-container").detach();if(null==c.data)k=!0;else{var g=[],l;for(l in c.data){var n=c.data[l].key,p=c.data[l].value;n&&p&&p instanceof Object&&void 0!=typeof this.activityGrids[n].value&&p.rows instanceof Object&&(this.searchData.prepend(this.activityGrids[n]),g[n]=p)}c.data=g;for(var A in this.searchFields)if("1"==this.searchFields[A]&&(g=this.formatingRecordTableResult(c.data[A],A),""!=g)){e++;l=this.activityGrids[A];n=l.find("table");
p=l.find(".toa-search-show-more");l.find(".toa-search-result-table-title").html(this.searchFieldNames[A]);var B=d.glossary({id:14604,type:"htmlExceptPlaceholder",translations:{"{FOUND}":'<span class="toa-search-result-visible"></span>',"{TOTAL}":c.data[A].total}});l.find(".toa-search-result-table-counter").html(B);n.empty();n.append(g);l.show();c.data[A].total>c.data[A].from+c.data[A].count?(p.attr("nextStartFrom",c.data[A].from+c.data[A].count+1),p.show()):(p.attr("nextStartFrom",-1),p.hide());this.activityGrids[A].off();
this.activityGrids[A].on("click","tr.sa-activity-item",this.handlerSearchItemOnClick);this.activityGrids[A].on("click","tr.sa-pc-item",this.handlerSearchPCItemOnClick);this.activityGrids[A].on("dblclick",".toa-search-color",this.handlerSearchItemOnDbclick)}}this.searchError.hide();this.activityEmpty.hide();k?this.searchError.show():e||this.activityEmpty.show();this.isChangeWorking=!1;this.changeSizeOfSearch(1)}}.bind(e);e.handlerTouchScrollTouchstart=function(b){b=b.originalEvent.changedTouches[0];
this.touch.lastX=b.clientX;this.touch.lastY=b.clientY;this.touch.moved=!1}.bind(e);e.handlerTouchScrollTouchmove=function(b){if(!_DATA||!_DATA.ipadDrag){this.touch.moved=!0;b=b.originalEvent.changedTouches[0].clientY;var c=this.touch.lastY-b;this.touch.lastY=b;b=el.scrollTop()+c;el.scrollTop(b);return!1}}.bind(e);e.appendTip();e.toaSearch=$(".toa-search-activity .toa-search");e.activityEmpty=e.toaSearch.find(".toa-search-empty");e.searchError=e.toaSearch.find(".toa-search-error");e.searchData=e.toaSearch.find(".toa-search-data");
e.searchWarning=e.toaSearch.find(".toa-search-warning");e.searchIcon=e.toaSearch.find(".toa-search-icon");e.searchForm=e.toaSearch.find(".toa-search-form");e.searchClear=e.toaSearch.find(".toa-search-clear");e.searchPreferencesButton=e.toaSearch.find(".toa-search-preferences-button");e.activityEmptyCheckbox=e.toaSearch.find(".toa-search-empty-checkbox");e.searchPreferences=e.search.find(".toa-search-preferences");e.searchPreferencesSroller=e.searchPreferences.find(".toa-search-preferences-container");
e.searchPreferencesIn=e.searchPreferencesSroller.find(".toa-search-preferences-container-in");e.searchPreferencesBack=e.searchPreferences.find(".toa-search-button-back");e.toaSearchForm=e.toaSearch.find(".toa-search-form");e.searchInputContainer=e.toaSearchForm.find(".toa-search-text");e.searchCategotyName=e.toaSearchForm.find(".toa-search-category-name");e.searchInput=e.searchInputContainer.find("input");e.searchData.off();d.currentInterface===e.interface_mobile?(e.searchMenu=$(".toa-header-search"),
b=function(b,c){e.searchMenu=$(".toa-header-search");c&&(e.searchMenu=c);e.search.Tip("isOpen")?e.search.Tip("hide"):(e.search.Tip("showAt",e.searchMenu,"bottom"),e.searchInput.focus(),e.changeSizeOfSearch(1),e.touchScroll(e.searchData))},$("body").on("click",".toa-header-search",b),$("body").on("openSearch",b)):(e.searchMenu=d.view.Header.getSearchIcon(),e.searchMenu.click(function(){e.isEnable()&&(e.search.Tip("isOpen")?e.search.Tip("hide"):(e.search.Tip("showAt",e.searchMenu,"bottom"),e.searchInput.focus(),
e.changeSizeOfSearch(1),e.touchScroll(e.searchData)))}));e.search.Tip("option","notOutsideElements",e.searchMenu);var n=null,p=!1;e.searchInput.on("keyup input",function(b){n&&clearTimeout(n);e.searchText=this.value;n=setTimeout(function(){if(e.oldSearchText!=e.searchText||13==b.keyCode)e.onChange()},e.debounceTimeLimit)});e.searchIcon.click(function(b){p||(p=!0,e.onChange(),setTimeout(function(){p=!1},e.debounceTimeLimit))});e.searchClear.on("click",function(){e.hideAllInnerBlocks();e.searchClear.css("visibility",
"hidden");e.searchInputContainer.find("input").val("");e.searchText="";e.searchData.hide();e.toaSearch.find(".toa-search-container .toa-search-grid").empty();e.toaSearch.find(".toa-search-container").hide();e.search.Tip("showAt",e.searchMenu,"bottom");e.calculateHeightData()});e.searchPreferencesButton.on("click",function(){e.toaSearch.hide();e.searchPreferences.show();e.search.Tip("showAt",e.searchMenu,"bottom");e.renewPreferencesHeight(e.searchPreferencesSroller,e.searchPreferencesIn);e.touchScroll(e.searchPreferencesSroller)});
e.searchPreferencesBack.on("click",function(){e.searchPreferences.hide();e.toaSearch.show();e.search.Tip("showAt",e.searchMenu,"bottom");!0==e.isCategoriesCahnged&&(e.onChange(),e.isCategoriesCahnged=!1)});$(".toa-search-preferences .toa-search-preferences-date select").on("change",function(b){e.isCategoriesCahnged=!0;e.currentSearchDate=this.value;e.sandbox.trigger("global.data.get",{controller:"SearchActivity",method:"setSearchDate",params:{date:e.currentSearchDate}})});_DATA.search_activity_date&&
($(".toa-search-preferences option[value="+_DATA.search_activity_date+"]").attr("selected","selected"),e.currentSearchDate=_DATA.search_activity_date);e.createSortableList();e.sandbox.bind("search.activity_fields.refresh",e.refreshSortableList,e);e.sandbox.bind("search.provider.load",e.loadProvider,e);e.setEnable()},renewPreferencesHeight:function(b,c){c=b||c;var d=$(window).height()-this.padding,e=c.innerHeight();b.height(e>d?d:e)},renewPreferencesHeight2:function(){var b=$(window).height()-this.padding,
c=this.searchPreferencesIn.innerHeight();this.searchPreferencesSroller.height(c>b?b:c)},initTablesForResult:function(){for(var c in this.searchFields){this.activityGrids[c]=$((new d.Template(b)).apply({nameBlock:"toa-search-container "+c,titleBlock:"",SHOW_MORE:h(10924)}));var e=this.activityGrids[c].find(".toa-search-show-more");e.on("mousedown",this.showMoreResults.bind(this,e,c))}},showMoreResults:function(b,c){this.activityGrids[c].find("tr:hidden:lt(10)").show();var d=this.activityGrids[c].find("tr:hidden").length;
30>=d&&this.loadMoreContent(b,c);d||"-1"!=this.activityGrids[c].find(".toa-search-show-more").attr("nextStartFrom")?this.activityGrids[c].find(".toa-search-show-more").show():this.activityGrids[c].find(".toa-search-show-more").hide();this.activityGrids[c].find(".toa-search-result-visible").html(this.activityGrids[c].find("tr:visible").length)},makeVisibleShowMore:function(b){this.activityGrids[b].find("tr:hidden").length||"-1"!=this.activityGrids[b].find(".toa-search-show-more").attr("nextStartFrom")?
this.activityGrids[b].find(".toa-search-show-more").show():this.activityGrids[b].find(".toa-search-show-more").hide()},loadMoreContent:function(b,c){var d=this;-1!=b.attr("nextStartFrom")&&d.sandbox.trigger("global.data.get",{controller:"SearchActivity",method:"search",params:{date:d.currentSearchDate,from:b.attr("nextStartFrom")-1||null,size:d.countRows||null,searchValue:d.searchText,searchOnlyby:c},responseHandler:function(b,e){var k=0,g=!1,v=d._getCategoryIdByKey(e.data,c);if(-1!=v&&(v=e.data[v].value,
"1"==d.searchFields[c])){var w=d.formatingRecordTableResult(v,c,!0);w||"boolean"!=typeof w?""!=w&&(k++,d.activityGrids[c].find("table").append(w),w=d.activityGrids[c].find(".toa-search-show-more"),v.total>v.from+v.count?(w.attr("nextStartFrom",v.from+v.count+1),w.show(),w.removeAttr("disabled")):(w.attr("nextStartFrom",-1),d.makeVisibleShowMore(c))):g=!0}d.searchError.hide();d.activityEmpty.hide();g?d.searchError.show():k||d.activityEmpty.show();d.search.Tip("showAt",d.searchMenu,"bottom");d.calculateHeightData()}})},
formatingRecordTableResult:function(b,c,e){e=e||!1;c="";if("undefined"==typeof b||"undefined"!=typeof b.error||"undefined"==typeof b)return!1;if("undefined"!=typeof b.rows||b.rows){var g=1,s;for(s in b.rows){var t=g>this.countRows||e?' style="display:none;"':"";g++;if("undefined"===typeof b.rows[s].data)c+="<tr"+t+' class="sa-activity-item"><td class="toa-search-color" data-col="0">'+this.formatColor(b.rows[s])+'</td><td class="toa-search-identifier" data-col="1">'+b.rows[s].identifier.replace(/([|])/g,
"$1&#8203;")+'</td><td class="toa-search-date" data-col="2">'+this.formatDate(b.rows[s])+"</td></tr>";else{var u=new d.partsCatalog.classes.ManageSearchStorageAdapter,v=jQuery.parseJSON(b.rows[s].data),u=u.itemDataToModel(v);this.partsCatalogSearchResult[u.id]=u;c+="<tr"+t+' class="sa-pc-item" pc_item_id="'+u.id+'"><td data-col="0" collspan = "3" class="sa-pc-item-td">'+this.formatPartsCatalogItem(u)+"</td></tr>"}}}return c},formatPartsCatalogItem:function(b){var c=b.getPreviewFields().map(function(b){return b.getValue()});
return $('<div class="pc-search-containier">').prepend($('<span class="pc-search-header">').text(b.getModelId())).append($("<span>").text(" - "+c.join(" - "))).html()},appendTip:function(){var b=this,c=null;this.search.Tip({className:"toa-search-activity",onResizeWindow:function(){c&&clearTimeout(c);c=setTimeout(function(){b.changeSizeOfSearch(1)},300)},zIndex:2999,windowMarginVertical:20,windowMarginHorizontal:3,callout:{side:"top",position:388}})},refreshSortableList:function(){var b=_DATA.search_activity_fields,
c;for(c in b)b[c].checked="0"==b[c].checked?"0":"1",this.searchFields[b[c].key]=b[c].checked,this.searchFieldNames[b[c].key]=b[c].value,b[c].value=h(19428).replace("{PROPERTY_NAME}",b[c].value);this.fieldsList.setOption("rows",b);this.fieldsList.render(".toa-search-activity .toa-search-preferences-fields");this.initTablesForResult()},createSortableList:function(){var b=this,c;c=new d.Template(e);b.fieldsList=d.view.control.create({xtype:"SortableList",name:"search-activity-sort",rows:[],disabled:!1,
sortableOptions:{zIndex:3001,handle:".toa-search-preferences-drag"},listeners:{rowClick:function(c,d){"INPUT"===d.originalEvent.target.nodeName&&(b.searchFields[d.row.key]=d.row.checked=d.originalEvent.target.checked,d.row.checked=d.originalEvent.target.checked,b.isCategoriesCahnged=!0,b.sandbox.trigger("global.data.get",{controller:"SearchActivity",method:"setFields",params:{fields:this.getOption("rows")}}))},formatRow:function(b,d){return c.apply({index:d.index+1,typeName:d.row.key,name:d.row.value,
checked:"1"==d.row.checked?1:0})},formatHelper:function(b,c){var d=c.originalElement.clone();d.addClass("toa-search-activity-drag-helper");return d},reorder:function(c,d){b.isCategoriesCahnged=!0;b.sandbox.trigger("global.data.get",{controller:"SearchActivity",method:"setFields",params:{fields:this.getOption("rows")}})}}});var g=_DATA.search_activity_fields,p;for(p in g)g[p].checked="0"==g[p].checked?"0":"1",b.searchFields[g[p].key]=g[p].checked,b.searchFieldNames[g[p].key]=g[p].value,g[p].value=
h(19428).replace("{PROPERTY_NAME}",g[p].value);b.fieldsList.setOption("rows",g);b.fieldsList.render(".toa-search-activity .toa-search-preferences-fields");b.initTablesForResult()},showActivityGrids:function(b){var c=0,d=0,e={},g=this.padding;if(!this.isChangeWorking&&!this.search.is(":hidden")){this.isChangeWorking=!0;g=$(window).height()-g;if(this.searchPreferences.is(":hidden")){for(var t in this.activityGrids){var u=this.activityGrids[t].find("tr");u.length?(c++,u.hide(),this.activityGrids[t].find("tr:lt("+
this.minResults+")").show(),(this.activityGrids[t].find("tr:hidden").length||"-1"!=this.activityGrids[t].find(".toa-search-show-more").attr("nextStartFrom"))&&this.activityGrids[t].find(".toa-search-show-more").show(),u=this.activityGrids[t].innerHeight(),d+=u,e[t]=u,this.activityGrids[t].find(".toa-search-result-visible").html(this.activityGrids[t].find("tr:visible").length)):e[t]=0}a:for(;c;)for(t in c=0,this.activityGrids){var v=this.activityGrids[t].find("tr:hidden:lt(1)");if(v.length){c++;v.show();
this.activityGrids[t].find("tr:hidden").length||"-1"!=this.activityGrids[t].find(".toa-search-show-more").attr("nextStartFrom")?this.activityGrids[t].find(".toa-search-show-more").show():this.activityGrids[t].find(".toa-search-show-more").hide();u=this.activityGrids[t].innerHeight();d+=u-e[t];e[t]=u;if(d>g){v.hide();this.activityGrids[t].find(".toa-search-show-more").show();break a}this.activityGrids[t].find(".toa-search-result-visible").html(this.activityGrids[t].find("tr:visible").length)}}}b&&
this.changeSizeOfSearch();this.isChangeWorking=!1;this.isAssigned||(this.isAssigned=1,this.sandbox.trigger("global.hint.assign",{elements:$(".toa-search-data"),add_links:["select_provider"]}))}},_isTooSmalForSearch:function(b){return 3<=b.length||9<=encodeURI(b).length?!1:!0},onChange:function(b,c){var d=this,e,g;d.oldSearchText=d.searchText;if(d.isChangeWorking)d.waitNextRequest&&(clearTimeout(d.waitNextRequest),d.waitNextRequest=!1),d.waitNextRequest=setTimeout(function(){d.waitNextRequest=!1;d.onChange()},
d.debounceTimeLimit);else{d.isChangeWorking=!0;d.searchText&&(d.searchText=d.searchText.substr(0,d.limitOfSearchString));for(var t in d.activityGrids)d.activityGrids[t].hide(),d.activityGrids[t].find("table").empty();d.searchInputContainer.show();d.searchText?d.searchClear.css("visibility","visible"):d.searchClear.css("visibility","hidden");d.isAnyFieldsSelected()?!d.searchText||d._isTooSmalForSearch($.trim(d.searchText))?(d.hideAllInnerBlocks(),$.trim(d.searchText).length&&(d.searchData.show(),d.searchWarning.show()),
d.changeSizeOfSearch(),d.isChangeWorking=!1):(c&&(e=c.from,g=c.size),d.sandbox.trigger("global.data.get",{controller:"SearchActivity",method:"search",params:{date:d.currentSearchDate,from:e||null,size:2*d.countRows||g||null,searchFields:d.searchFields,searchValue:d.searchText},errorHandler:d.handlerOnChangeErrorHandler,responseHandler:d.handlerOnChangeResponseHandler})):(d.hideAllInnerBlocks(),d.searchData.show(),d.activityEmptyCheckbox.show(),d.changeSizeOfSearch(),d.isChangeWorking=!1)}},changeSizeOfSearch:function(b){600>=
$(window).width()?this.search.Tip("option","callout",{side:"top",position:288}):this.search.Tip("option","callout",{side:"top",position:388});b?this.showActivityGrids(1):(this.searchData.is(":visible")&&(this.searchData.height("auto"),this.renewPreferencesHeight(this.searchData)),this.searchPreferencesSroller.is(":visible")&&(this.searchPreferencesSroller.height("auto"),this.renewPreferencesHeight(this.searchPreferencesSroller,this.searchPreferencesIn)),this.search.Tip("showAt",this.searchMenu,"bottom"),
this.calculateHeightData())},onActivityRowsClick:function(b){var c;b=$(b.target);c=b.attr("data-col");if(!c||0==c)return!0;if(b=b.parent().find(".toa-search-color div"))b={action:"change_activity",aid:b.attr("aid"),pid:b.attr("par_pid"),date:b.attr("par_date")},isMobilityAction(b.action,b)&&d.currentInterface===this.interface_mobile?invokeMobilityScreen(b,!0):this.sandbox.trigger("interface.actions.click",b);this.search.Tip("hide")},onPartsCatalogRowsClick:function(b){b=$(b.target).closest("tr.sa-pc-item");
b.attr("pc_catalog_id");b.attr("pc_item_id");b=this.partsCatalogSearchResult[b.attr("pc_item_id")];var c=b.getFields(),e=$('<table cellpadding="0" cellspacing="0" class="pc-item-fields">'),g=$('<tr class="pc-row">').append($('<td class="pc-label">').text(h(12259)+": ")).append($('<td class="pc-value">').text(b.getModelId()));e.append(g);for(g=0;g<c.length;g++)e.append($('<tr class="pc-row">').append($('<td class="pc-label">').text(c[g].getName()+": ")).append($('<td class="pc-value">').text(c[g].getValue())));
new d.ui.Popup({title:"Item details: "+b.getModelId(),html:$('<div class="pc-item-details">').append($('<div class="pc-item-details">').append(e)).html(),modal:!0,autoOpen:!0});this.search.Tip("hide")},formatDate:function(b){var c=d.date.parseDate("iso",b.date);if(this.isActivityNonScheduled(b))return h(8203);b.ETA||(b.astatus="not_ordered");return'<span class="toa-search-activity-day">'+d.date.formatDate("D,",c)+"</span>"+d.date.formatDate(" j M ",c)},formatColor:function(b){var c,e;c=b.astatus;
b.ETA||"cancelled"===c||(c="not_ordered");c=!b.alerts||"pending"!==c&&"not_ordered"!==c?c:"warning";c="#"+this.sandbox.model("companySettings").getActivityColorById(b.aworktype,c);e=d.utils.color.darken(d.utils.color.hexToRgb(c),0.2,"grey");return'<div style = "background-color: '+c+"; border: 1px solid "+e+'" par_date = "'+b.date+'" par_pid = "'+b.pid+'" aid = "'+b.aid+'">&nbsp;</div>'},calculateHeightData:function(){var b=this.search.innerHeight()-this.searchForm.innerHeight()-6;this.searchData.height(b)},
hideAllInnerBlocks:function(){for(var b in this.activityGrids)this.activityGrids[b].hide();this.activityEmpty.hide();this.searchError.hide();this.searchWarning.hide();this.activityEmptyCheckbox.hide();this.searchData.hide()},isAnyFieldsSelected:function(){var b=!1,c;for(c in this.searchFields)if(!0==this.searchFields[c]||"1"==this.searchFields[c]||1==this.searchFields[c]){b=!0;break}return b},loadProvider:function(b,c){this.sandbox.trigger("search.provider.highlight",c)},touchScroll:function(b){this.touch=
{lastX:0,lastY:0,moved:!1};b.on("touchstart",this.handlerTouchScrollTouchstart);b.on("touchmove",this.handlerTouchScrollTouchmove)},isActivityNonScheduled:function(b){return b.ETA==d.date.DAY_WITHOUT_DATE||b.date==d.date.DAY_WITHOUT_DATE},setDisable:function(){this._enable=0},setEnable:function(){this._enable=1},isEnable:function(){return this._enable},_getCategoryIdByKey:function(b,c){var d=-1,e=b.length||0;if(!e)return d;for(i=0;i<e;i++)"key"in b[i]&&b[i].key===c&&(d=i);return d}})})(toa);(function(d){function c(b){return d.date.formatDate("date",d.date.parseDate("iso",b))}d.ns("toa.ActivitiesScreen.views.MoveMultidayActivity",d.define(d.ActivitiesScreen.View,function(b){this.sandbox=b;this.dialogPopup=null;this.templateTpl=["<% if (errors){%>",'<ul data="id-errors" class="multiday-activity-errors">',"<li><b>"+d.glossary({id:15341})+"</b></li>","<%= errors %>","</ul>","<%} else {%>","   <% if (warnings){%>",'<ul data="id-warnings" class="multiday-activity-warnings">',"<li><b>"+d.glossary({id:15342})+
"</b></li>","<%= warnings %>","</ul>","   <%}%>",'<ul data="id-options" class="multiday-activity-options">',"<%= options %>","</ul>","<%}%>"]},$.extend({},d.mixins.EventEmitter,{render:function(b){var e=[],g=[],k=[],l=c(b.targetDate),n=c(b.fromDate),p=b.moveFromAid,s;b.multidayActivity.hasOwnProperty("alerts")&&$.each(b.multidayActivity.alerts,function(b,c){k.push("<li>"+c.message+"</li>")});b.multidayActivity.hasOwnProperty("errors")&&$.each(b.multidayActivity.errors,function(b,c){g.push("<li>"+
c.message+"</li>")});$.each(b.multidayActivity.options,function(k,g){var v="";switch(k){default:case "one_segment":v=d.glossary({id:15337});break;case "all_in_route":v=d.glossary({id:15338}).replace("{DATE}",n);break;case "all_further":p&&b.aid[p]?(s=b.aid[p].date,s=c(s)):s=n;v=d.glossary({id:15339}).replace("{DATE}",s);break;case "assign_sequence":v=d.glossary({id:13172}).replace("{DATE}",l);break;case "assign_one_route":v=d.glossary({id:13173}).replace("{DATE}",l);break;case "reassign_not_scheduled":v=
d.glossary({id:13174});break;case "generate_current_route":v=d.glossary({id:13176})}e.push("<li>"+('<label for="option-'+k+'">'+('<input id="option-'+k+'" type="radio" name="option" value="'+k+'" />')+v+"</label>")+"</li>")});this.template=$((new d.Template(this.templateTpl)).apply({options:e.join(""),errors:g.join(""),warnings:k.join("")}));this.options=$("<div />").html(this.template).find("ul.multiday-activity-options li");1==this.options.length&&$(this.options[0]).find("input").attr("checked",
"checked");this.dialogPopup=new d.ui.Popup({title:b.multidayActivity.title||d.glossary({id:15334}),autoOpen:!1,html:this.template,modal:!0,onClose:function(){this.destroy()},buttons:[{position:"left",text:d.glossary({id:15335}),click:function(){this.dialogPopup.destroy();this.dialogPopup=null}.bind(this)},{position:"right",text:d.glossary({id:15336}),disable:b.multidayActivity.hasOwnProperty("errors"),click:function(){var b="",c=!1;$.each(this.options,function(d,e){var k=$(e).find("input");k.prop("checked")&&
(c=!0,b=k.val())});c?(this.dialogPopup.destroy(),this.dialogPopup=null,this.notify("move.multiday.activity",{option:b})):d.ui.Alert({text:d.glossary({id:15340})})}.bind(this)}]});this.dialogPopup.show()}})))})(toa);(function(){var d=toa.views.routingRuns.InfoArea,c=toa.views.routingRuns.RunDetailsBase,b=toa.glossary,e=toa.views.routingRuns.utils,g=(new toa.Template('<div class="routing-vsl-row" ;   rel="<%- timestamp %>" ;   id="r<%- run_id %>" ;   data-type="<%- type %>" ;   data-bucket-name="<%- bucket_name %>" ;   data-plan-id="<%- plan_id %>" ;   data-plan-name="<%- plan_name %>" ;   data-status="<%- status %>" ;   data-bucket-time-zone-diff="<%- bucket_time_zone_diff %>" ;   data-start-time="<%- start_time %>" ;   data-end-time="<%- end_time %>" ;   data-bucket-id="<%- bucket_id %>" ;   data-rollback-id="<%- rollback_id %>" ;   data-undorollback-id="<%- undorollback_id %>" ;   data-timestamp="<%- timestamp %>" ;   data-immediate-algorithm="<%- immediateAlgorithm %>" ;>;   <div class="p15 time"><%-time %></div>;   <div class="p15"><%-bucket_name %></div>;   <div class="p20"><% if(plan_name_after != "") {%><%-plan_name_after%><%} else {%><%-plan_name%><%}%></div>;   <div class="p15 type-<%-subType %>"><% if(subType=="manual" || subType=="recurrent"){%><%-userName%><%}%></div>;   <div class="p10" data-name="activities_estimation"><%=activities%></div>;   <div class="p10" data-name="resources_estimation"><%=resources%></div>;   <div class="p12 state-<%-status%>"><%-statusText%></div>;</div>'.split(";"))).compile();
toa.ns("toa.views.routingRuns.infoArea.RoutingRunsList",toa.define(d,function(e,g){this.baseClass=d;this.baseClass.apply(this,arguments);this.onPartLoaded=this.onPartLoaded.bind(this);this._loadLatest=this._loadLatest.bind(this);this.routingRunsOrderToUpdate=[];this.routingRunsPreOrderToUpdate=[];this.sizePreOrderToUpdate=5;this.doCancelRoutingRunsActivitiesInfoUpdate=this.isRoutingRunsOrderUpdateRequested=!1;this.linksToexecutionRows=[];this.scrollDebounceTimer=null;this.addListener("load the latest run routing list",
function(){this._loadLatest()}.bind(this));e.bind("plans_execution_summary_dashboard_widget_request_data",function(b,c){this._loadLatest()}.bind(this));this.addListener("end reached",function(b,c){this._isLoading||this._loadPart(c)}.bind(this));this.addListener("row details requested",function(d,p,s){this._popUpIsOpen||(this._popUpIsOpen=this._isLoading=!0,this._sandbox.bind("routing.run.popup.has.been.closed",function(){this._popUpIsOpen=this._isLoading=!1}.bind(this)),this._sandbox.trigger("global.data.get",
{controller:"Routingvisualization",method:"getRoutingRunInfo",params:{runId:p,pid:Number(s.pid)||0},responseHandler:function(b,d){this.setAccess(d.access);var n=new c(e,g);$.extend(d.routing_details,{plan_name:s.plan_name});n.show("summary-details",p,d,this.getDate())}.bind(this),errorHandler:function(c){if(!toa.date.isDateNotArchived(s.end_time,toa.app.model("User").get("tz_diff")))return Object.assign(c,{popup_extra_css_class:"redwood-styles-popup"}),this.showAlert(c),this._popUpIsOpen=this._isLoading=
!1;Object.assign(c,{popup_extra_css_class:"redwood-styles-popup"});var d=JSON.parse(c.responseText);d.smart_routing_exception.message=b({id:15443,translations:{}});c.responseText=JSON.stringify(d);this.showAlert(c);return this._popUpIsOpen=this._isLoading=!1}.bind(this)}))}.bind(this));e.bind("routing.runs.update.all.widgets",function(){this._popUpIsOpen=!1;this.cancelRoutingRunsActivitiesInfoUpdate()}.bind(this))},{_popUpIsOpen:!1,cellHeight:27,_loadLatest:function(){var b=this;require(["loader",
"SignalEmitter"],function(c,d){b._content?"none"===b._content.css("display")&&(b.remove(),b._content.show()):(b.remove(),b._content=$(b.getInfoAreaTemplate()),b._layout.getInfoAreaContainer().append(b._content),console.debug("RoutingExecutionSummary: INIT"),c.run({name:"RoutingExecutionSummary",label:"routing_run_list",title:"routing_run_list",selector:"#routing-execution-summary"}));console.debug("RoutingExecutionSummary: Dispatch signal - addRoutingRunData");c.jetCssHack(!0);d.dispatch("addRoutingRunData",
{context:b},!0)})},_loadPart:function(b){this._isLoading=!0;this._sandbox.trigger("global.data.get",{controller:"Routingvisualization",method:"loadPart",params:{pid:this.getResourceId(),date:this.getDate(),last_id:b,limit:50},responseHandler:this.onPartLoaded,errorHandler:function(b){Object.assign(b,{popup_extra_css_class:"redwood-styles-popup"});this.showAlert(b);return!1}.bind(this)})},updateRoutingRunsActivitiesInfo:function(b,c){this.isRoutingRunsOrderUpdateRequested=!0;for(var d=[],e=0;e<b.length;e++)d.push([b[e].bucket_id,
b[e].plan_id]);this._sandbox.trigger("global.data.get",{controller:"Routingvisualization",method:"loadRoutingRunActivities",params:{plans_info:d,date:this.getDate()},responseHandler:this.onRoutingRunsUpdate.bind(this,c),errorHandler:function(b){this.isRoutingRunsOrderUpdateRequested=!1;Object.assign(b,{popup_extra_css_class:"redwood-styles-popup"});this.showAlert(b);return!1}.bind(this)})},refreshPreOrderForRoutingRunsActivitiesInfo:function(){var b=this.routingRunsOrderToUpdate.length,c=[];this.routingRunsPreOrderToUpdate=
[];for(var d=0;d<b&&!(this.checkIsRowVisible(this.routingRunsOrderToUpdate[d])&&(this.routingRunsPreOrderToUpdate.push(this.routingRunsOrderToUpdate[d]),c.push(d),this.routingRunsPreOrderToUpdate.length>=this.sizePreOrderToUpdate||d==b-1));d++);!this.isRoutingRunsOrderUpdateRequested&&this.routingRunsPreOrderToUpdate.length&&this.updateRoutingRunsActivitiesInfo(this.routingRunsPreOrderToUpdate,c)},onRoutingRunsUpdate:function(b,c,d){this.isRoutingRunsOrderUpdateRequested=!1;if(!this.doCancelRoutingRunsActivitiesInfoUpdate){for(c=
0;c<d.routing_runs_activity_info.length;c++){var e=d.routing_runs_activity_info[c];this._updateEstimationForRow(e.bucket_id,e.plan_id,e.activities,e.resources)}for(c=b.length-1;0<=c;c--)this.routingRunsOrderToUpdate.splice(b[c],1);this.refreshPreOrderForRoutingRunsActivitiesInfo()}},_updateEstimationForRow:function(c,d,e,g){c=this.linksToexecutionRows[this._getLinkName(c,d)]||[];for(d=0;d<c.length;d++)$(c[d]).find("[data-name='activities_estimation']").html(b({id:12240,translations:{"{ITEM1}":0,"{ITEM2}":e},
type:"raw"})),$(c[d]).find("[data-name='resources_estimation']").html(b({id:12240,translations:{"{ITEM1}":0,"{ITEM2}":g},type:"raw"}))},checkIsRowVisible:function(b){var c=!1;b=this.linksToexecutionRows[this._getLinkName(b.bucket_id,b.plan_id)]||[];for(var d=0;d<b.length;d++)this.hasVisibleScheduledPlans(b[d])&&(c=!0);return c},hasVisibleScheduledPlans:function(b){var c=$(window).height(),d=$(document).scrollTop(),e=b.offset();b=b.height();return e.top>d-25&&e.top+b<d+c+25?!0:!1},cancelRoutingRunsActivitiesInfoUpdate:function(){this.routingRunsOrderToUpdate=
[];this.routingRunsPreOrderToUpdate=[];this.doCancelRoutingRunsActivitiesInfoUpdate=!0},onLatestLoaded:function(b,c){this.setAccess(c.access);var e=c.routing_runs_list||[],g=this;this._sandbox.trigger("routing.no.runs",1);if(e.length){d.prototype.render.apply(this,arguments);for(var s=!1,t=0;t<e.length;t++)-1==e[t].activities&&this.routingRunsOrderToUpdate.push(e[t]),"failed"!=e[t].status||s||(s=!0,this._sandbox.trigger("routing.no.runs"));require(["loader","SignalEmitter"],function(b,c){b.run({name:"RoutingExecutionSummary",
label:"routing_run_list",title:"routing_run_list",selector:"#routing-execution-summary"});console.debug("RoutingExecutionSummary: loader run");c.dispatch("addRoutingRunData",{context:g},!0);console.debug("RoutingExecutionSummary: Dispatch signal - addRoutingRunData")});this._isLoading=!1}else this.remove(),this._content=c.is_bucket?$(this._templateNoruns):$(this._templateNoBucket),this._content.addClass(this._className).appendTo(this._layout.getInfoAreaContainer());this._layout.getInfoAreaContainer().prepend($(this._templateTimeLeft));
this._sandbox.trigger("routing.runs.set.priority.time")},onPartLoaded:function(b,c){this.setAccess(c.access);this.popRows(c.routing_runs_list||[]);this._isLoading=!1},render:function(){this.notify("load the latest run routing list")},getInfoAreaClassName:function(){return"routing-runs-list"},getInfoAreaTemplate:function(){return'<div id="routing-execution-summary" class="oracle-jet routing-runs-list"></div>'},_getRow:function(c,d){var n=e.getUserDateTimeFormat(),p=toa.date.parseDate("iso_long",c.start_time),
s=c.bucket_time_zone_diff||0,t=toa.datetime.currentDate(s).toDateString(),u=n.date_time,p=p.getTime()+6E4*s,p=new Date(p);t===p.toDateString()&&(u=n.time);n=e.getTranslatedRoutingStatus(c.status);t=e.determineTypeOfPlan(c);0!=c.sequence_id&&c.sequence_id!=c.run_id||!c.predecessor_id&&!c.successor_id||(t="manual");s=b({id:15502,translations:{"{CURRENT_PLAN_NAME}":c.plan_name,"{PREDECESSOR_PLAN_NAME}":c.plan_name_after},type:"raw"});u=g.apply({run_id:c.run_id||"scheduled",plan_id:c.plan_id,status:c.status,
statusText:n,bucket_time_zone_diff:c.bucket_time_zone_diff,start_time:c.start_time,end_time:c.end_time,timestamp:c.start_time,time:toa.date.formatDate(u,p),plan_name:c.plan_name||"",plan_name_after:0==c.sequence_id||null===c.plan_name_after?"":s,bucket_name:c.bucket_name||"",bucket_id:c.bucket_id,rollback_id:c.rollback_action_id,undorollback_id:c.undo_rollback_action_id,type:c.run_type,subType:t,userName:c.user_name,immediateAlgorithm:c.immediate_algorithm||"",activities:-1!=c.activities?b({id:12240,
translations:{"{ITEM1}":c.used_activities,"{ITEM2}":c.activities},type:"raw"}):"\x3c!-- {scheduled_activities} --\x3e",resources:-1!=c.resources?b({id:12240,translations:{"{ITEM1}":c.used_resources,"{ITEM2}":c.resources},type:"raw"}):"\x3c!-- {scheduled_resources} --\x3e"});return d?$(u):$(u)[0]},setRows:function(b){var c,d=document.createDocumentFragment();this.linksToexecutionRows={};for(var e=0;e<b.length;e++)c=this._getRow(b[e]),d.appendChild(c),this._saveLinkToScheduleRow(b[e],c);this._table.html(d);
this._wrap.scrollTop(0);this._fillScreen(b)},_saveLinkToScheduleRow:function(b,c){var d=this._getLinkName(b.bucket_id,b.plan_id),e=$(c);"rscheduled"===e.attr("id")&&(this.linksToexecutionRows.hasOwnProperty(d)||(this.linksToexecutionRows[d]=[]),this.linksToexecutionRows[d].push(e))},_getLinkName:function(b,c){return b+"_"+c},popRows:function(b){var c,d=document.createDocumentFragment();this.linksToexecutionRows={};for(var e=0;e<b.length;e++)c=this._getRow(b[e]),d.appendChild(c),this._saveLinkToScheduleRow(b[e],
c);this._table.find(".routing-vsl-row:last").after(d);this._fillScreen(b)},_fillScreen:function(b){if(50===b.length&&$(".routing-vsl-body")[0].scrollHeight<=$(".routing-vsl-body").height()){b=this._table.find(".routing-vsl-row:last");var c=parseInt(b.attr("id").replace(/[^\d]/g,""),10)||-1;if(b&&"rscheduled"!==b.attr("id")&&-1!=c)this.notify("end reached",c);else if("rscheduled"===b.attr("id")){b=b.siblings().get().reverse();for(var d in b)if("rscheduled"!==b[d].id){c=parseInt(b[d].id.replace(/[^\d]/g,
""),10);this.notify("end reached",c);break}}}},updateRows:function(b){for(var c,d,e=this._table,g=document.createDocumentFragment(),t=0,u=[],v=b.length-1;0<=v;v--)d=[],c=this._getRow(b[v],!0),"scheduled"!==b[v].status&&b[v].run_id?(d=e.find("#r"+b[v].run_id),d&&0!==d.length||(d=$('*[data-bucket-id="'+b[v].bucket_id+'"][data-plan-name="'+b[v].plan_name+'"][id="rscheduled"]'),1<d.length&&(d=$(d[d.length-1]))),d.length?d.attr("data-status")!=b[v].status&&d.replaceWith(c):(t+=this.cellHeight,g.insertBefore(c[0],
g.firstChild))):u.push(c);b=$('*[id="rscheduled"]').toArray();if(u.length&&u.length!=b.length)for(v=0;v<u.length;v++)b.length?$(b.pop()).replaceWith(u[v]):(t+=this.cellHeight,g.insertBefore(u[v][0],g.firstChild));e.prepend(g);e.css("top","-"+t+"px");e.animate({top:0},1E3,function(){})},toString:function(){return"routing_runs_list_infoarea"}}));toa.mixin(toa.views.routingRuns.infoArea.RoutingRunsList.prototype,toa.mixins.EventEmitter)})();(function(){var d=toa.views.routingRuns.InfoArea,c=toa.glossary,b=function(b,c){c.text(null!==b?b:"--")};toa.ns("toa.views.routingRuns.infoArea.AutoroutingList",toa.define(d,function(b,c){d.apply(this,arguments)},{_templateError:['<div class="no-runs">',c({id:15458}),"</div>"].join(""),_setters:{total_processed:b,manually_processed:function(b,c){c.text(null!==b?b:"--");0<b?c.css("color","red"):c.css("color","")},assigned:b,reassigned:b,unassigned:b,reordered:b,assigned_by_technician:b,reassigned_by_technician:b,
unassigned_by_technician:b},render:function(){if(!1==this._data.is_bucket)return d.prototype.renderNoBucketTemplate.apply(this,arguments);d.prototype.render.apply(this,arguments)},getInfoAreaClassName:function(){return"autorouting-list"},getInfoAreaTemplate:function(){return['<div>   <div class="info-content" data-marker="info-content">       <div class="info-section-content">           <div class="left-section">               <div class="section-title">',c({id:13147}),"</div>                   <div>                       <table>                           <tbody>                               <tr>                                   <td>",
c({id:13149}),'</td>                                   <td class="data" data-marker="assigned"></td>                               </tr>                               <tr>                                   <td>',c({id:13150}),'</td>                                   <td class="data" data-marker="reassigned"></td>                               </tr>                               <tr>                                   <td>',c({id:13151}),'</td>                                   <td class="data" data-marker="unassigned"></td>                               </tr>                               <tr>                                   <td>',
c({id:13152}),'</td>                                   <td class="data" data-marker="reordered"></td>                               </tr>                           </tbody>                       </table>                   </div>               </div>               <div class="right-section">                   <div class="section-title">',c({id:13148}),"</div>                       <div>                           <table>                               <tbody>                                   <tr>                                       <td>",
c({id:13149}),'</td>                                       <td class="data" data-marker="assigned_by_technician"></td>                                   </tr>                                   <tr>                                       <td>',c({id:13150}),'</td>                                       <td class="data" data-marker="reassigned_by_technician"></td>                                   </tr>                                   <tr>                                       <td>',c({id:13151}),'</td>                                       <td class="data" data-marker="unassigned_by_technician"></td>                                   </tr>                               </tbody>                           </table>                       </div>                   </div>                   <div class="total-wraper"><div class="autorouting-total">',
r(15454,{"{COUNT_MANUALY_PROCESSED}":'<span  data-marker="manually_processed"></span>',"{TOTAL_PROCESSED}":'<span data-marker="total_processed"></span>'}),"                   </div></div>               </div>           </div>       </div></div>"].join("")},toString:function(){return"autorouting_list_infoarea"}}));toa.mixin(toa.views.routingRuns.infoArea.AutoroutingList.prototype,toa.mixins.EventEmitter)})();(function(){var d=toa.views.routingRuns.InfoArea,c=toa.views.routingRuns.utils,b=toa.glossary,e=function(b,d){d.text(c.secondsToString(60*b,"HH h MM min","00 "+toa.glossary({id:15457,type:"raw"})))};toa.ns("toa.views.routingRuns.infoArea.ResourceUtilizationList",toa.define(d,function(b,c){d.apply(this,arguments)},{_setters:{useful_time:e,working_time:e,overtime:e,travel_time:e,idle_time:e,total_idle_time:e},render:function(){if(!1==this._data.is_bucket)return d.prototype.renderNoBucketTemplate.apply(this,
arguments);d.prototype.render.apply(this,arguments)},getInfoAreaClassName:function(){return"resource-utilization-list"},getInfoAreaTemplate:function(){return['<div>   <div class="info-content" data-marker="info-content">        <div class="info-section-content">            <div class="left-section">                <div class="section-title">',b({id:13154}),"                </div>                <div>                    <table><tbody>                        <tr>                            <td>",b({id:13156}),
'</td>                            <td class="data" data-marker="working_time"></td>                        </tr>                        <tr>                            <td>',b({id:13157}),'</td>                            <td class="data" data-marker="overtime"></td>                        </tr>                        <tr>                            <td>',b({id:13158}),'</td>                            <td class="data" data-marker="travel_time"></td>                        </tr>                    </tbody></table>                </div>                <div class="total">                    <span>',
b({id:1521}),'</span>                    <span class="data" data-marker="useful_time">0</span>                </div>            </div>            <div class="right-section">                <div class="section-title">',b({id:13159}),"</div>                    <div>                        <table><tbody>                            <tr>                                <td>",b({id:13159}),'</td>                                <td class="data" data-marker="idle_time"></td>                            </tr>                        </tbody></table>                    </div>                    <div class="total" style="margin-top: 68px;">                        <span>',
b({id:1521}),'</span>                        <span class="data" data-marker="total_idle_time"></span>                    </div>                </div>            </div>        </div>    </div></div>'].join("")},toString:function(){return"resource_utilization_list_infoarea"}}));toa.mixin(toa.views.routingRuns.infoArea.ResourceUtilizationList.prototype,toa.mixins.EventEmitter)})();(function(){var d=toa.views.routingRuns.InfoArea,c=toa.views.routingRuns.utils,b=toa.glossary,e=function(b,d){d.text(c.moneyToString(b))},g=function(b,d){d.text(c.secondsToString(60*b,"HH h MM min","00 "+toa.glossary({id:15457})))};toa.ns("toa.views.routingRuns.infoArea.SavingsList",toa.define(d,function(b,c){d.apply(this,arguments);this.addListener("switched to cost",function(){$(".routing-vsl-widget.savings").removeClass("savings-time")}.bind(this));this.addListener("switched to time",function(){$(".routing-vsl-widget.savings").addClass("savings-time")}.bind(this))},
{_setters:{savings_service_cost:e,savings_travel_cost:e,savings_overtime_cost:e,savings_total_cost:e,savings_service_time:g,savings_travel_time:g,savings_overtime_time:g,savings_total_time:g},_switchedTo:"cost",render:function(){if(!1==this._data.is_bucket)return d.prototype.renderNoBucketTemplate.apply(this,arguments);if(0==this._data.savings_total_cost&&0==this._data.savings_total_time)return this.remove(),this._content=$(this._templateNoSavings),this._content.appendTo(this.getLayout().getInfoAreaContainer()),
this;d.prototype.render.apply(this,arguments)},getInfoAreaClassName:function(){return"savings-info"},getInfoAreaTemplate:function(){return['<div>   <div class="info-content" data-marker="info-content">        <div class="info-section-content">            <div class="left-section">                <div class="section-title">',b({id:15460}),"                </div>                <div>                    <table><tbody>                        <tr>                            <td>",b({id:13126}),'</td>                            <td class="data" data-marker="savings_service_cost">',
toa.glossary({id:13132}),"--</td>                        </tr>                        <tr>                            <td>",b({id:13127}),'</td>                            <td class="data" data-marker="savings_travel_cost">',toa.glossary({id:13132}),"--</td>                        </tr>                        <tr>                            <td>",b({id:13128}),'</td>                            <td class="data" data-marker="savings_overtime_cost">',toa.glossary({id:13132}),'--</td>                        </tr>                    </tbody></table>                </div>                <div class="total">                    <span>',
b({id:1521}),'</span>                    <span class="data" data-marker="savings_total_cost">',toa.glossary({id:13132}),'--</span>                </div>            </div>            <div class="right-section">                <div class="section-title">',b({id:15459}),"                </div>                <div>                    <table><tbody>                        <tr>                            <td>",b({id:13126}),'</td>                            <td class="data" data-marker="savings_service_time">-- h -- min</td>                        </tr>                        <tr>                            <td>',
b({id:13127}),'</td>                            <td class="data" data-marker="savings_travel_time">-- h -- min</td>                        </tr>                        <tr>                            <td>',b({id:13128}),'</td>                            <td class="data" data-marker="savings_overtime_time">-- h -- min</td>                        </tr>                    </tbody></table>                </div>                <div class="total">                    <span>',b({id:1521}),'</span>                    <span class="data" data-marker="savings_total_time">-- h -- min</span>                </div>            </div>        </div>    </div></div>'].join("")},
_createMapping:function(){var b={};this._content.find("[data-marker]").each(function(c,d){var e=$(d);b[e.attr("data-marker")]=e});return b},_preRender:function(){this._mapping=this._createMapping();for(var b in this._setters)this._setters.hasOwnProperty(b)&&this._mapping.hasOwnProperty(b)&&this._setters[b].call(this,void 0,this._mapping[b])}}))})();(function(){var d=toa.views.routingRuns.InfoArea,c=toa.glossary;toa.ns("toa.views.routingRuns.infoArea.BaselineSettings",toa.define(d,function(b,c){d.apply(this,arguments);this.addListener("switched to cost",function(){$(".routing-vsl-widget.savings").removeClass("savings-time")}.bind(this));this.addListener("switched to time",function(){$(".routing-vsl-widget.savings").addClass("savings-time")}.bind(this));this.addListener("settings save requested",function(c,d){b.trigger("global.data.get",{controller:"Routingvisualization",
method:"saveSavingsSettings",params:{pid:this.getResourceId(),date:this.getDate(),settings:d},responseHandler:function(c,d){this.setAccess(d.access);this.showSuccessSavingMessage();b.trigger("routing.runs.update.all.widgets")}.bind(this),errorHandler:function(b){Object.assign(b,{popup_extra_css_class:"redwood-styles-popup"});this.showAlert(b);return!1}.bind(this)})}.bind(this));b.bind("routing.runs.set.baseline.settings.widget.in.denied.mode",function(b,c){this.getContent()&&this.getContent().hide()}.bind(this));
b.bind("routing.runs.set.baseline.settings.widget.in.read.only.mode",function(b,c){this.getContent()&&(this.getContent().find("#vsl-messages-for-user").html("").hide(),this.getContent().find(".buttons-row").hide(),this.getContent().find('input[type="text"]').attr("readonly","readonly"))}.bind(this));b.bind("routing.runs.set.baseline.settings.widget.in.read.write.mode",function(b,c){this.getContent()&&(this.getContent().find("#vsl-messages-for-user").html("").show(),this.getContent().find(".buttons-row").show(),
this.getContent().find('input[type="text"]').removeAttr("readonly"))}.bind(this))},{_inputTranslations:{"savings-settings-fully-loaded-tech-cost":c({id:13117}),"savings-settings-cost-per-mile":c({id:13118}),"savings-settings-overtime-increase":c({id:13119}),"savings-settings-average-daily-worktime":c({id:13120}),"savings-settings-average-travel-time":c({id:13121}),"savings-settings-average-tech-overtime":c({id:13122}),"savings-settings-travel-speed":c({id:13123})},_setters:{savings_view:function(b,
c){if("t"===b){if("1"!==$("#savings-switch-to-time",c).attr("data-initial-value")&&"0"!==$("#savings-switch-to-time",c).attr("data-initial-value")){$(".savings").addClass("savings-time");var d=c.find("#savings-switch-to-time");d.prop("checked",!0);d.attr("data-initial-value",1)}}else"c"===b&&"1"!==$("#savings-switch-to-cost",c).attr("data-initial-value")&&"0"!==$("#savings-switch-to-cost",c).attr("data-initial-value")&&($(".savings").removeClass("savings-time"),d=c.find("#savings-switch-to-cost"),
d.prop("checked",!0),d.attr("data-initial-value",0))}},_switchedTo:"cost",_settingsEditEnabled:!0,render:function(){d.prototype.render.apply(this,arguments);this.switcherCost=this.getContent().find("#savings-switch-to-cost");this.switcherTime=this.getContent().find("#savings-switch-to-time");"t"===this._data.savings_view?this._switchedTo="time":"c"===this._data.savings_view&&(this._switchedTo="cost");"time"===this._switchedTo?this._setViewToTime():"cost"===this._switchedTo&&this._setViewToCost();
this.messagePanel=this.getContent().find("#vsl-messages-for-user");this.switcherCost.on("change",this._setViewToCost.bind(this));this.switcherTime.on("change",this._setViewToTime.bind(this));var b=this.getContent().find("[data-marker=buttons-dismiss]"),c=this.getContent().find("[data-marker=buttons-save]");b.on("click",this.onDismiss.bind(this));c.on("click",this.onSave.bind(this));this.getContent().find('[for="savings-settings-cost-per-mile"]').html(this._inputTranslations["savings-settings-cost-per-mile"]);
this.getContent().find('[for="savings-settings-travel-speed"]').html(this._inputTranslations["savings-settings-travel-speed"])},getInfoAreaClassName:function(){return"baseline-settings-info"},getInfoAreaTemplate:function(){return['<div>    <div class="settings-form">        <div class="right-section" data-marker="savings_view">            <div class="section-title">',c({id:13114}),'            </div>            <div>                <div class="switch-section">                    <div class="switch-to-cost">                        <input type="radio" name="savings_view" id="savings-switch-to-cost" value="c" />                        <label for="savings-switch-to-cost" title="',
c({id:13115}),'">',c({id:13115}),'</label>                    </div>                    <div class="switch-to-time">                        <input type="radio" name="savings_view" id="savings-switch-to-time" value="t" />                        <label for="savings-switch-to-time" title="',c({id:13116}),'">',c({id:13116}),'</label>                    </div>                </div>                <table><tbody>                    <tr>                        <td>                            <label for="savings-settings-fully-loaded-tech-cost">',
c({id:13117}),'                            </label>                        </td>                        <td class="data">                            <input type="text" id="savings-settings-fully-loaded-tech-cost" name="provider_cost" value="" data-marker="provider_cost" />                        </td>                    </tr>                    <tr>                        <td>                            <label for="savings-settings-cost-per-mile">',c({id:13118}),'                            </label>                        </td>                        <td class="data">                            <input type="text" id="savings-settings-cost-per-mile" name="cost_per_mile" value="" data-marker="cost_per_mile" />                        </td>                    </tr>                    <tr>                        <td>                            <label for="savings-settings-overtime-increase">',
c({id:13119}),'                            </label>                        </td>                        <td class="data">                            <input type="text" id="savings-settings-overtime-increase" name="overtime_cost" value="" data-marker="overtime_cost" />                        </td>                    </tr>                    <tr>                        <td>                            <label for="savings-settings-average-daily-worktime">',c({id:13120}),'                            </label>                        </td>                        <td class="data">                            <input type="text" id="savings-settings-average-daily-worktime" name="tech_work_time" value="" data-marker="tech_work_time" />                        </td>                    </tr>                    <tr>                        <td>                            <label for="savings-settings-average-travel-time">',
c({id:13121}),'                            </label>                        </td>                        <td class="data">                            <input type="text" id="savings-settings-average-travel-time" name="tech_travel_time" value="" data-marker="tech_travel_time" />                        </td>                    </tr>                    <tr>                        <td>                            <label for="savings-settings-average-tech-overtime">',c({id:13122}),'                            </label>                        </td>                        <td class="data">                            <input type="text" id="savings-settings-average-tech-overtime" name="tech_overtime" value="" data-marker="tech_overtime" />                        </td>                    </tr>                    <tr>                        <td>                            <label for="savings-settings-travel-speed">',
c({id:13123}),'                            </label>                        </td>                        <td class="data">                            <input type="text" id="savings-settings-travel-speed" name="travel_speed_mph" value="" data-marker="travel_speed_mph" />                        </td>                    </tr>                </tbody></table>                <span id="vsl-messages-for-user" class="info"></span>            </div>            <div class="buttons-row">                <button class="toa-button" data-marker="buttons-dismiss">',
c({id:13124}),'</button>                <button class="toa-button toa-button-active" data-marker="buttons-save">',c({id:13125}),"</button>            </div>        </div>    </div></div>"].join("")},setData:function(b){if("undefined"!==typeof b)for(var d in b)b.hasOwnProperty(d)&&(this._data[d]=b[d]);"km"===b.distance_units?(this._inputTranslations["savings-settings-cost-per-mile"]=c({id:19654}),this._inputTranslations["savings-settings-travel-speed"]=c({id:19655})):(this._inputTranslations["savings-settings-cost-per-mile"]=
c({id:13118}),this._inputTranslations["savings-settings-travel-speed"]=c({id:13123}))},onSave:function(){if(this._settingsEditEnabled){for(var b=this.getContent().find(".settings-form"),d=b.find("input[type=text]"),g,k,l,n={},p=0;p<d.length;p++){g=$(d[p]);k=g.val();l=g.attr("id");if(!this._isFieldValid(l,k)){this.showErrorMessage(toa.glossary({id:8038,translations:{"{FIELD}":this._inputTranslations[l]}}));return}n[g.attr("name")]=k}b=b.find("input[type=radio]:checked");d=b.val();n[b.attr("name")]=
d;this._data.savings_view=d;this.notify("settings save requested",n);"t"==d?this._switchedTo="time":"c"==d&&(this._switchedTo="cost");this.showMessage(c({id:13129}))}},onDismiss:function(){this.getAccess("routing_savings_widget")&&(this._sandbox.trigger("set.current.routing.widget",{widgetName:"saving_dashboard_widget"}),this._sandbox.trigger("saving_dashboard_widget_request_data"))},showSuccessSavingMessage:function(){this.showMessage(c({id:13131}))},showMessage:function(b){this.messagePanel.html(b).removeClass("error")},
showErrorMessage:function(b){this.messagePanel.html(b).addClass("error")},hideMessage:function(){this.messagePanel.html("").removeClass("error")},_setViewToTime:function(){this.switcherCost.removeAttr("checked");this.switcherTime.attr("checked","checked");$("#savings-settings-fully-loaded-tech-cost").prop("disabled",!0);$("#savings-settings-cost-per-mile").prop("disabled",!0);this.notify("switched to time")},_setViewToCost:function(){this.switcherTime.removeAttr("checked");this.switcherCost.attr("checked",
"checked");$("#savings-settings-fully-loaded-tech-cost").prop("disabled",!1);$("#savings-settings-cost-per-mile").prop("disabled",!1);this.notify("switched to cost")},_isFieldValid:function(b,c){if(isNaN(c))return!1;switch(b){case "savings-settings-fully-loaded-tech-cost":case "savings-settings-cost-per-mile":case "savings-settings-average-daily-worktime":case "savings-settings-average-travel-time":case "savings-settings-average-tech-overtime":if(0>=c)return!1;break;case "savings-settings-overtime-increase":case "savings-settings-travel-speed":if(0>
c)return!1}return!0}}))})();(function(){var d=toa.views.routingRuns.InfoArea,c=toa.views.routingRuns.widgets.RoutingPlansWidget,b=toa.ui.Popup,e=toa.glossary,g=toa.views.routingRuns.utils,k={limit:10,offset:0,status:"all",find:""},l={offset:0,limit:10},n=!0,p=(new toa.Template(['<div class="profile-body<% if(plans && showPlansInfo){%> block-expand<%} else ','if (plans) {%> block-collapse<%} else {%> block-empty<%}%>" ','     data-pid="<%-pid%>" data-profile-id="<%-profileId%>">','   <div class="profile-head <% if (noProvider) { %> no-provider <% } %>">',
'     <div class="routing-profile-head-info">','       <div class="profile-name" title="<%-profileName%>">','           <button role="button"  class="profile-<% if(showPlansInfo){%>expand<%}else{%>collapse<%}%><%if (!plans){%> hide<%}%>"<% if(showPlansInfo){%>                        ',' aria-label="',e({id:20960}),'" ',"<% } else { %>",' aria-label="',e({id:20959}),'" ',"<% } %>",">","           </button>","           <% if (noProvider) { %>","               <i><%-inactivePrefix%></i><%-profileName%>",
"           <% } else { %>",'               <span class="link" role="link" aria-dropeffect="popup" title="<%-inactivePrefix%><%-profileName%>">',"                   <i><%-inactivePrefix%></i><%-profileName%>","               </span>","           <% } %>","       </div>",'       <div class="profile-plans <% if(plans && showPlansInfo){%> hide<%}%>">',"<%if (!plans){%> ",e({id:15452}),": ","<span>",e({id:3602}),"</span>","<%}else{%>",e({id:15452}),": ",'<span title="<%-plans%>"><%-plans%></span>',"<%}%>",
"         </div>",'         <div class="assigned-providers">',"             <%=assignedProviders%>","         </div>","       </div>",'       <div class="menu-actions<%if (!plans){%> show<%}%>"></div>',"   </div>",'   <div class="profile-content<% if(plans && showPlansInfo){%> show<%}%>"></div>',"</div>"])).compile(),s=(new toa.Template(['<div class="plan-body" data-plan-id="<%-planId%>">',' <div class="plan-data-wrapper short">','     <div class="plan-name" title="<%-planName%>">','        <div role="img" aria-label="<%-planType%>" class="plan-type type-<%-planType%>">&nbsp;</div>',
"        <%-planName%>","       <% if (hasWarning) {%>",'       <span class="oj-component-icon oj-message-status-icon oj-message-warning-icon routing-list-alert" title="'+e({id:24026})+'" role="img"></span>',"       <%}%>","     </div>",'     <div class="plan-name-type-wraper">','        <div class="plan-info"><%=planInfo%></div>',"     </div>","<% if (!noProvider) {%>",'     <div class="plan-counters-wraper">','       <div class="plan-activities"></div>','       <div class="plan-resources"></div>',
"     </div>","<%}%>","<% if (noProvider) { %>",'     <div class="plan-info more">','         <div data-name="dynamic-routing">','             <div class="label">',e({id:5207}),"&nbsp;</div>",'             <div class="value"><%=dynamicRoutingInfo%></div>',"         </div>",'         <div data-name="automatic-ordering">','             <div class="label">',e({id:5210}),"&nbsp;</div>",'             <div class="value"><%=autoOrderingInfo%></div>',"         </div>","     </div>","<% } %>"," </div>",'   <div class="plan-actions"></div>',
"</div>"])).compile(),t=(new toa.Template(['<div data-name="run-schedule">','   <div class="label">',e({id:7083}),"&nbsp;</div>",'   <div class="value"><%=scheduledInfo%></div>',"</div>",'<div class="additional-info">',"<% if (description) { %>",'<div data-name="time-limit">','   <div class="label">',e({id:1811}),"&nbsp;</div>",'   <div class="value"><%-description%></div>',"</div>","<% } %>",'<div data-name="time-limit">','   <div class="label">',e({id:13230}),"&nbsp;</div>",'   <div class="value"><%-gbo%></div>',
"</div>",'<% if (planType !== "immediately") { %>','<div data-name="time-limit">','   <div class="label">',e({id:3731}),"&nbsp;</div>",'   <div class="value"><%-timeLimit%></div>',"</div>",'<div data-name="assignment-parameters">','   <div class="label">',e({id:7121}),"&nbsp;</div>",'   <div class="value"><%=assignmentParametersInfo%></div>',"</div>","<% if (isCenterPointEnable) { %>",'<div data-name="center-point-home-zone">','   <div class="label">',e({id:7021}),"&nbsp;</div>",'   <div class="value"><%=centerPointHomeZoneInfo%></div>',
"</div>",'<div data-name="home-zone-radius">','   <div class="label">',e({id:7022})," ",e({id:7025}),"&nbsp;</div>",'   <div class="value"><%=homeZoneRadiusInfo%></div>',"</div>","<% } %>","<% if (!noProvider) { %>",'   <div data-name="dynamic-routing">','       <div class="label">',e({id:5207}),"&nbsp;</div>",'       <div class="value"><%=dynamicRoutingInfo%></div>',"   </div>","<% } %>",'<div data-name="resource-overtime">','   <div class="label">',e({id:7100}),"&nbsp;</div>",'   <div class="value"><%=providerOvertimeInfo%></div>',
"</div>","<% if (isSLR) { %>",'<div data-name="optimization">','   <div class="label">',e({id:21719}),"&nbsp;</div>",'   <div class="value"><%=optimization%></div>',"</div>","<% } %>","<% if (travelTimeInfo) { %>",'<div data-name="travel-time">','   <div class="label">',e({id:7112}),"&nbsp;</div>",'   <div class="value"><%=travelTimeInfo%></div>',"</div>","<% } %>",'<div data-name="filters">','   <div class="label">',e({id:3633}),"&nbsp;</div>",'   <div class="value"><%=filtersInfo%></div>',"</div>",
'<div data-name="reoptimization">','   <div class="label">',e({id:13806}),"&nbsp;</div>",'   <div class="value"><%=reoptimizationInfo%></div>',"</div>","<% } else { %>",'<div data-name="routing-subtype-assignment">','   <div class="label">',e({id:20159}),"&nbsp;</div>",'   <div class="value"><%=subTypeText%></div>',"</div>","<% } %>",'<button role="link" class="show-more-less">',e({id:20960}),"</button>","</div>",'<div class="short-info">','<div class="label"><%=shortInfo%></div>','<button role="link" class="show-more-less">',
e({id:20959}),"</button>","</div>"])).compile(),u=(new toa.Template(['<div class="plans-panel-wrapper">','<div class="flex-wrapper plans-counter-panel-wrapper">','<div class="part-wrapper"><span class="plans-counter">',"<%=label%>","</span>",'<button class="list-display-switcher-show">(',e({id:15560}),")</button>",'<button class="list-display-switcher-hide" style="display: none;">(',e({id:15621}),")</button></div>",'<div class="part-wrapper">','<span id="add-new-routing-profile" class="add-new-routing-profile"></span>',
'<span id="routing-profile-filters"></span>',"</div>","</div>","</div>",'<div id="all-routing-profiles"></div>'])).compile(),v=$('<button class="show-more toa-button toa-button-active">'+e({id:10818})+"</button>");toa.ns("toa.views.routingRuns.infoArea.RoutingPlansList",toa.define(d,function(c,g){d.apply(this,arguments);this.showMore=!0;this.pager=jQuery.extend({filters:this._getFiltersData()},l);this.routingProfiles=[];this.routingPlansAlerts=[];this.lookup={shortWeekdays:toa.datetime.shortWeekdays,
daysList:toa.datetime.getListDay()};this.filterApply=this.filterApply.bind(this);this.filterButton=toa.view.control.create({xtype:"button.Filter",name:"filterButton",label:e({id:8047}),layoutCellWidth:1,listeners:{filterApply:this.filterApply}});this.get=function(b){b.suppressErrors=/503|403|302/;this._sandbox.trigger("global.data.get",b)}.bind(this);this.addListener("create routing profile",function(){this._createRoutingProfile()}.bind(this));this.addListener("rename routing profile",function(b,
c,d){this._renameCloneRoutingProfile(c,d)}.bind(this));this.addListener("clone routing profile",function(b,c,d){this._renameCloneRoutingProfile(c,d)}.bind(this));this.addListener("deactivate routing profile",function(b,c,d){this._deleteActivateDeactivateRoutingProfile(c,d)}.bind(this));this.addListener("activate routing profile",function(b,c,d){this._deleteActivateDeactivateRoutingProfile(c,d)}.bind(this));this.addListener("delete routing profile",function(b,c,d){this._deleteActivateDeactivateRoutingProfile(c,
d)}.bind(this));this.addListener("check routing profile",function(){var b={},b=!0===n?this.pager:{offset:0,limit:this.pager.offset+this.pager.limit};this.get({controller:"Routingvisualization",method:"getRoutingProfileAndPlansForCurrentBucket",params:{currentPid:this.currentPid,pid:this.getResourceId(),date:this.getDate(),pager:b},responseHandler:function(b,c){this.setAccess(c.access);var e="";this.routingPlansAlerts=c.plans_with_alert&&c.plans_with_alert.routing_profiles&&c.plans_with_alert.routing_profiles.length&&
c.plans_with_alert.routing_profiles[0].routing_plans_with_alerts?c.plans_with_alert.routing_profiles[0].routing_plans_with_alerts:[];this.routingProfiles=c.routing_profiles||[];this._layout._wrap.removeClass("vsl-plans-content");c.is_bucket||(this.remove(),this._content=$(this._templateNoBucket),this._content.addClass(this._className).appendTo(this._layout.getInfoAreaContainer()));c.is_bucket&&!c.is_provider_has_routing_profile&&(e=$(this._templateNoRoutingProfile),2==this.getAccess("routing_plans_widget")?
(e.find("span.select-routing-profile").removeClass("ro"),e.on("click",".select-routing-profile",function(b){this.notify("change routing profile",{currentProfileId:0,selectedPid:this.getResourceId()});b.preventDefault()}.bind(this))):e.find("span.select-routing-profile").addClass("ro"));c.is_bucket&&(this.lookup=$.extend(this.lookup,c.lookup),d.prototype.render.apply(this,arguments),""!==e&&this._content.append(e),this._content.append('<div id="bucket-routing-profile" />'),this._content.find("#bucket-routing-profile").empty().append(this._renderProfileTemplate(c.providers_collection,
!1)),this.renderRoutingProfilePanel(),this._statuses.show_all_routing_profiles||$(".routing-plans-list").scrollTop(this._statuses.scrollTop));if(c.is_bucket&&c.is_provider_has_routing_profile){var e=c.providers_collection,g=[],k;for(k in e)if(e.hasOwnProperty(k)){var l=e[k].profile.plans,p;for(p in l)l.hasOwnProperty(p)&&g.push([e[k].pid,l[p].routing_plan_id])}this._loadCounts(g)}n=!1}.bind(this),errorHandler:function(b){Object.assign(b,{popup_extra_css_class:"redwood-styles-popup"});this.showAlert(b);
return!1}.bind(this)})}.bind(this));this.addListener("change routing profile",function(c,d){var g=$(this._templateChangeRoutingProfile),k=d.currentProfileId,l=d.selectedPid,n='<option value="0">&nbsp;</option>',p;for(p in this.routingProfiles)this.routingProfiles.hasOwnProperty(p)&&(this.routingProfiles[p].active||!1==this.routingProfiles[p].active&&this.routingProfiles[p].id==d.currentProfileId)&&(n+='<option    value="'+this.routingProfiles[p].id+'"'+(d.currentProfileId==this.routingProfiles[p].id?
' selected="selected" ':"")+">"+hs(this.routingProfiles[p].profileName)+"</option>");g.find("select").append(n).addClass("select-routing-profile-select");g.find("select").on("change",function(){k=parseInt($(this).val());l=d.selectedPid});var s=new b({title:e({id:5452,type:"raw"}),width:400,height:180,html:g,popup_extra_css_class:"select-routing-profile redwood-styles-popup",onClose:function(){s.destroy()},buttons:[{text:e({id:405,type:"raw"}),position:"left",type:"submit",click:function(){this.updateProviderRoutingProfile(s,
l,k)}.bind(this)},{text:e({id:16226,type:"raw"}),click:function(){s.destroy();s=null}}]});s.setPositionCenter();s.show()}.bind(this));this.addListener("add routing plan to routing profile",function(b,c){toa.app.trigger("app.controller.suspend",{instance:"routing_run_list",params:{}});toa.app.trigger("app.controller.resume",{instance:"RoutingPlan",params:{options:{action:"add_plan",profileId:c.id}}})}.bind(this));this.addListener("modify routing plan",function(b,c){toa.app.trigger("app.controller.suspend",
{instance:"routing_run_list",params:{}});toa.app.trigger("app.controller.resume",{instance:"RoutingPlan",params:{options:{action:"edit_plan",planId:c.routing_plan_id}}})}.bind(this));this.addListener("clone routing plan",function(b,c){toa.app.trigger("app.controller.suspend",{instance:"routing_run_list",params:{}});toa.app.trigger("app.controller.resume",{instance:"RoutingPlan",params:{options:{action:"clone_plan",planId:c.routing_plan_id,profileId:c.plan_full_info.profile_id}}})}.bind(this));this.addListener("deactivate routing plan",
function(b,c,d){this._deleteActivateDeactivateRoutingPlan(c,d)}.bind(this));this.addListener("activate routing plan",function(b,c,d){this._deleteActivateDeactivateRoutingPlan(c,d)}.bind(this));this.addListener("delete routing plan",function(b,c,d){this._deleteActivateDeactivateRoutingPlan(c,d)}.bind(this));this.addListener("show provider plans",function(b,c){var d=!0!==c.noProvider?$(this._content).find("#bucket-routing-profile"):$(this._content).find("#all-routing-profiles"),g=d.find(".profile-expand"),
k=g.closest(".profile-body").data("pid"),l=d.find('div[data-pid="'+k+'"]');l.find(".profile-content").empty().removeClass("show");!0===c.noProvider&&(this.currentPid=c.pid);l.hasClass("block-empty")||l.removeClass("block-expand").addClass("block-collapse");g.hasClass("block-empty")||g.removeClass("profile-expand").addClass("profile-collapse").attr("aria-label",e({id:20959}));l.find(".profile-plans").removeClass("hide");k!=c.pid?(g={},c.reload?(g=c.noProvider?this._statuses.noProviderPager:this._statuses.providerPager,
g.limit+=g.offset,g.offset=0):(this._resetPager(),g=this.pager),k=d.find('div[data-pid="'+c.pid+'"]'),k.hasClass("block-empty")||k.removeClass("block-collapse").addClass("block-expand"),k.find(".profile-collapse").removeClass("profile-collapse").addClass("profile-expand").attr("aria-label",e({id:20960})),k.find(".profile-plans").addClass("hide"),k.find(".profile-content").addClass("show"),d.find('div[data-pid="'+this.currentPid+'"] .profile-content').append('<div class="routing-plans-empty">'+e({id:13171})+
"</div>"),this._getRoutingPlansForCurrentProvider(c.noProvider,c.pid,g)):c.noProvider&&(this.currentPid=null)}.bind(this));this.addListener("show all routing profiles",function(b,c){$(".list-display-switcher-show").hide();$(".list-display-switcher-hide").show();$("#all-routing-profiles div").remove();this.get({controller:"Routingprofilesandplans",method:"getAllRoutingProfilesAndPlans",params:{filter:this.allPlansFilter},responseHandler:function(b,d){this.setAccess(d.access);this._content.find("#all-routing-profiles").empty().append(this._renderProfileTemplate(d.routing_profiles_collection,
!0));c&&c.currentPid?this.notify("show provider plans",{pid:c.currentPid,event:null,noProvider:!0,reload:!0}):$(".routing-plans-list").scrollTop(this._statuses.scrollTop)}.bind(this),errorHandler:function(b){Object.assign(b,{popup_extra_css_class:"redwood-styles-popup"});this.showAlert(b);return!1}.bind(this)})}.bind(this));this.addListener("change assigned providers",function(c,d){var g=$(this._templateChangeAssignedProviders).attr("rprid",d.currentProfileId);this.get({controller:"Routingvisualization",
method:"getProvidersList",params:{p_rprid:d.currentProfileId},responseHandler:function(b,c){this.setAccess(c.access);var d=c.providers_collection,e;for(e in d)g.append($("<div>"+toa.toHtml(d[e].providerName)+"</div>").attr("pid",d[e].pid))}.bind(this),errorHandler:function(b){Object.assign(b,{popup_extra_css_class:"redwood-styles-popup"});this.showAlert(b);return!1}.bind(this)});var k=new b({title:e({id:21703,type:"raw",translations:{"{NAME}":d.name}}),width:400,height:400,html:g,popup_extra_css_class:"select-assigned-providers",
onClose:function(){k.destroy()},buttons:[{text:e({id:16226,type:"raw"}),position:"left",click:function(){k.destroy();k=null}},{text:e({id:12411,type:"raw"}),type:"submit",click:function(){k.destroy();k=null}.bind(this)}]});k.setPositionCenter();k.show()}.bind(this));c.bind("routing_run.provider.changed",function(b,c){n="undefined"!==c._normalPager?c._normalPager:this._noProvider?this.currentPid!==c.pid:!1;this._statuses.returnToPage?this._statuses.returnToPage=!1:(this._statuses.scrollTop=0,this._statuses.show_all_routing_profiles=
!1,this._statuses.noProviderPager=jQuery.extend({},l),this._statuses.providerPager=jQuery.extend({},l),this._resetPager())}.bind(this));c.bind("routing_plans_dashboard_widget_request_data",function(b,c){this.requestData()}.bind(this))},{currentPid:null,allPlansFilter:jQuery.extend({},k),_statuses:{show_all_routing_profiles:!1,scrollEvent:!1,scrollTop:null,noProviderPager:jQuery.extend({},l),providerPager:jQuery.extend({},l),returnToPage:!1},_noProvider:!1,_templateChangeRoutingProfile:['<div class="toa-formrow">',
'<div id="'+g.getUniqId("rp5412")+'" class="formLabel">'+e({id:5412})+"</div>",'<div class="formField"><div class="select"><select aria-labelledby="'+g.getUniqId("rp5412")+'"></select></div></div>',"</div>"].join(""),_templateNoRoutingProfile:['<div class="no-runs no-routing-profile">',e({id:15449})+"<br /><br />",'   <button class="select-routing-profile">'+e({id:15455})+"</button><br /><br />","</div>"].join(""),_templateRenameCloneRoutingProfile:['<div><div class="toa-formrow">','    <div class="formLabel"><label for="'+
g.getUniqId("rprname")+'">'+e({id:5399})+'<sup class="ofsc-abbr-mandatory" title="'+e({id:22351})+'"></sup></label></div>','    <div class="formField"><input id="'+g.getUniqId("rprname")+'" required type="text" class="pwi4 focus-first" maxlength="40" value="" name="rprname"></div>','</div><div class="toa-formrow">    <div class="formLabel"></div>','    <div class="formField checkboxField">       <input type="checkbox" value="1" id="'+g.getUniqId("rpractive")+'" name="rpractive">','       <label for="'+
g.getUniqId("rpractive")+'">'+e({id:30})+"</label>",'       </div></div><div class="toa-formrow"><span name="error" class="fb fb-span fb-invalid"></span></div></div>'].join(""),_templateNoBucket:['<div class="no-runs no-bucket">',e({id:3652}),"</div>"].join(""),_templateChangeAssignedProviders:"<div></div>",_getRoutingPlansForCurrentProvider:function(b,c,d){d="undefined"!==typeof d?d:this.pager;b="undefined"!==typeof b?b:this._noProvider;this.get({controller:"Routingvisualization",method:b?"getRoutingPlansForCurrentRoutingProfile":
"getRoutingPlansForCurrentProvider",params:{pid:c?c:this.currentPid,date:this.getDate(),pager:d},responseHandler:function(c,e){this.setAccess(e.access);var g=(!0!==b?$(this._content).find("#bucket-routing-profile"):$(this._content).find("#all-routing-profiles")).find('div[data-pid="'+e.pid+'"] .profile-content');g.find(".routing-plans-empty").remove();var k=this.renderPlansList({pid:e.pid,timeZone:e.providerTZ},e.profile_plans,b),l;for(l in k)k.hasOwnProperty(l)&&g.append(k[l]);var n=0;for(l in this.routingProfiles)if(e.profile_plans[0].plan_full_info.profile_id==
this.routingProfiles[l].id){n=this.routingProfiles[l].totalPlansCount;break}k=Object.keys(k).length;this._checkShowMoreButton(g,k,n,e.pid,d,b);$(".routing-plans-list").scrollTop(this._statuses.scrollTop);b?this._statuses.noProviderPager=d:this._statuses.providerPager=d;g=[];for(l in e.profile_plans)e.profile_plans.hasOwnProperty(l)&&g.push([e.pid,e.profile_plans[l].routing_plan_id]);this._loadCounts(g)}.bind(this),errorHandler:function(b){Object.assign(b,{popup_extra_css_class:"redwood-styles-popup"});
this.showAlert(b);return!1}.bind(this)})},_renameCloneRoutingProfile:function(c,d){if(1==this.getAccess("routing_plans_widget"))return toa.alert(e({id:5516})),!1;var k=$(this._templateRenameCloneRoutingProfile).attr("pid",c.id),l,n,p,s;switch(d){case "rename":l=e({id:5403,type:"raw"});n=e({id:462,type:"raw"});p=e({id:16226,type:"raw"});s="updateRoutingProfile";break;case "clone":l=e({id:5405,type:"raw"}),n=e({id:5387,type:"raw"}),p=e({id:16226,type:"raw"}),s="cloneRoutingProfile"}k.find('input[name="rprname"]').val(c.profileName);
!0===c.active&&k.find("#"+g.getUniqId("rpractive")).prop("checked",!0);var t=new b({title:l,width:400,html:k,popup_extra_css_class:"redwood-styles-popup rename-clone-add-routing-profile "+d,onClose:function(){t.destroy()},buttons:[{text:p||e({id:6266,type:"raw"}),click:function(){t.destroy();t=null}},{text:n,type:"submit",click:function(){var b=$.trim($(t.getDomContent()).find('input[name="rprname"]').val()),d=$(t.getDomContent()).find('span[name="error"]');if(""===b)return d.text(e({id:5406,translations:{"%s":e({id:5399})}})),
!1;d.text("");d=$(t.getDomContent()).find("#"+g.getUniqId("rpractive")).prop("checked");this.doRoutingProfileAndPlan(t,s,{profile_id:c.id,profile_name:b,active:d,do_activation:d!==c.active})}.bind(this)}]});t.setPositionCenter();t.show()},_createRoutingProfile:function(){if(1==this.getAccess("routing_plans_widget"))return toa.alert(e({id:5516})),!1;var c=$(this._templateRenameCloneRoutingProfile),d=new b({title:e({id:226431,type:"raw"}),width:400,html:c,popup_extra_css_class:"redwood-styles-popup rename-clone-add-routing-profile",
onClose:function(){d.destroy()},buttons:[{text:e({id:16226,type:"raw"}),click:function(){d.destroy();d=null}},{text:e({id:222,type:"raw"}),type:"submit",click:function(){var b=$.trim($(d.getDomContent()).find('input[name="rprname"]').val()),c=$(d.getDomContent()).find('span[name="error"]');if(""===b)return c.text(e({id:5406,translations:{"%s":e({id:5399})}})),!1;c.text("");c=$(d.getDomContent()).find('input[name="rpractive"]').prop("checked");this.doRoutingProfileAndPlan(d,"createRoutingProfile",
{profile_name:b,active:c})}.bind(this)}]});d.setPositionCenter();d.show()},_deleteActivateDeactivateRoutingProfile:function(c,d){if(1==this.getAccess("routing_plans_widget"))return toa.alert(e({id:5516})),!1;var g,k,l,n,p;switch(d){case "delete":g=e({id:226438});k=e({id:226441});l=e({id:11990,type:"raw"});n=e({id:16226,type:"raw"});p="deleteRoutingProfile";break;case "activate":g=e({id:226433});k=e({id:226437});l=e({id:15474,type:"raw"});n=e({id:16226,type:"raw"});p="activateDeactivateRoutingProfile";
break;case "deactivate":g=e({id:226436}),k=e({id:226443}),l=e({id:15464,type:"raw"}),n=e({id:16226,type:"raw"}),p="activateDeactivateRoutingProfile"}var s=new b({title:g||e({id:13294,type:"raw"}),width:400,height:180,html:k,popup_extra_css_class:"delete-activate-deactivate-routing-profile redwood-styles-popup",onClose:function(){s.destroy()},buttons:[{text:n||e({id:6266,type:"raw"}),click:function(){s.destroy();s=null}},{text:l||e({id:12411,type:"raw"}),type:"submit",click:function(){this.doRoutingProfileAndPlan(s,
p,{profile_id:c.id,active:c.active})}.bind(this)}]});s.setPositionCenter();s.show()},_deleteActivateDeactivateRoutingPlan:function(c,d){if(1==this.getAccess("routing_plans_widget"))return toa.alert(e({id:5516})),!1;var g,k,l,n,p;switch(d){case "delete":g=e({id:226442});k=e({id:226441});l=e({id:11990,type:"raw"});n=e({id:16226,type:"raw"});p="deleteRoutingPlan";break;case "activate":g=e({id:226434});k=e({id:226440});l=e({id:15474,type:"raw"});n=e({id:16226,type:"raw"});p="activateDeactivateRoutingPlan";
break;case "deactivate":g=e({id:226444}),k=e({id:226443}),l=e({id:15464,type:"raw"}),n=e({id:16226,type:"raw"}),p="activateDeactivateRoutingPlan"}var s=new b({title:g||e({id:13294,type:"raw"}),width:400,height:180,html:k,popup_extra_css_class:"delete-activate-deactivate-routing-plan redwood-styles-popup",onClose:function(){s.destroy()},buttons:[{text:n||e({id:6266,type:"raw"}),click:function(){s.destroy();s=null}},{text:l||e({id:12411,type:"raw"}),type:"submit",click:function(){this.doRoutingProfileAndPlan(s,
p,{plan_id:c.routing_plan_id,active:c.plan_full_info.active})}.bind(this)}]});s.setPositionCenter();s.show()},doRoutingProfileAndPlan:function(b,c,d){this.get({controller:"Routingprofilesandplans",method:c,params:d,responseHandler:function(e,g){this.setAccess(g.access);b.destroy();b=null;"deleteRoutingProfile"===c&&this.currentPid===d.profile_id&&(this.currentPid=null);this._sandbox.trigger("routing.runs.update.all.widgets")}.bind(this),errorHandler:function(c){b.destroy();b=null;Object.assign(c,
{popup_extra_css_class:"redwood-styles-popup"});this.showAlert(c);return!1}.bind(this)})},updateProviderRoutingProfile:function(b,c,d){this.get({controller:"Routingvisualization",method:"updateProviderRoutingProfile",params:{pid:c,profile_id:d},responseHandler:function(c,d){this.setAccess(d.access);d.is_success_update_routing_profile&&(b.destroy(),b=null,this.notify("check routing profile"),this._sandbox.trigger("routing.runs.update.all.widgets"))}.bind(this),errorHandler:function(c){b.destroy();
b=null;Object.assign(c,{popup_extra_css_class:"redwood-styles-popup"});this.showAlert(c);return!1}.bind(this)})},_checkShowMoreButton:function(b,c,d,e,g,k){g="undefined"!==typeof g?g:this.pager;k="undefined"!==typeof k?k:this._noProvider;var l=$("button[show-more-id='"+e+"']");if(0==c||d<=g.limit+g.offset)return this.showMore=!1,l.css("display","none"),!1;this.showMore=!0;l.length||(l=v.clone());l.attr("show-more-id",e);b.append(l);l.off().on("click",{pid:e,pager:g,noProvider:k},function(b){g.offset+=
g.limit;this._getRoutingPlansForCurrentProvider(b.data.noProvider,b.data.pid,g)}.bind(this));l.css("display","inline-block");return!0},_resetPager:function(){this.showMore=!0;this.pager=jQuery.extend({filters:this._getFiltersData()},l)},render:function(){this.notify("check routing profile")},getInfoAreaClassName:function(){this._statuses.scrollEvent=!1;return"routing-plans-list"},getInfoAreaTemplate:function(){return"<div />"},requestData:function(){this.notify("check routing profile")},_renderProfileTemplate:function(b,
c){var d=this;this._noProvider="undefined"!==typeof c?c:!1;var g=this.getAccess("routing_plans_widget"),k=this.getAccess("routing_plans_widget");this._layout._wrap.addClass("vsl-plans-content");var l=[],n;for(n in b)if(b.hasOwnProperty(n)){var s=[],t;for(t in b[n].profile.plans)b[n].profile.plans.hasOwnProperty(t)&&s.push(b[n].profile.plans[t].routing_plan_name);s=s.length?s.slice(0,10):[];s=s.length?s.join(", "):"";b[n].planNames&&(s=b[n].planNames);var u=b[n].profile.profileName?b[n].profile.profileName:
e({id:15450}),v='<button class="link"  aria-dropeffect="popup" title="'+b[n].assignedProviderNames+'">'+e({id:21702,translations:{"{COUNT}":b[n].assignedProvidersCount}})+"</button>",v=e({id:21701,type:"raw",translations:{"{BUCKETS_LINK}":v,"{BUCKETS_LIST}":toa.toHtml(b[n].assignedProviderNames)}}),K=!1===b[n].profile.active?e({id:31})+" ":"",u=$(p.apply({pid:b[n].pid,profileActive:b[n].profile.active,profileId:b[n].profile.id,inactivePrefix:K,profileName:u,plans:s,showPlansInfo:this._noProvider?
!1:!0,assignedProviders:v,noProvider:this._noProvider}));2<=g&&2<=k?(u.find(".profile-name .link").removeClass("read-only-profile"),u.on("click",".profile-name .link",{pid:b[n].pid,profileId:b[n].profile.id},function(b){this.notify("change routing profile",{currentProfileId:b.data.profileId,selectedPid:b.data.pid});b.preventDefault();b.stopPropagation()}.bind(this)),u.on("click",".assigned-providers .link",{name:b[n].profile.profileName,profileId:b[n].profile.id},function(b){this.notify("change assigned providers",
{currentProfileId:b.data.profileId,name:b.data.name});b.preventDefault();b.stopPropagation()}.bind(this)),v=[],v.push({xtype:"Button",addClass:"toa-dropdown-item routing-menu-item",name:"actionRename",attr:{"aria-label":e({id:15375}),"aria-labelledby":e({id:15375}),tabindex:0},label:e({id:15375})}),v.push({xtype:"Button",addClass:"toa-dropdown-item routing-menu-item",name:"actionClone",attr:{"aria-label":e({id:15408}),"aria-labelledby":e({id:15408}),tabindex:0},label:e({id:15408})}),this.getResourceId()!=
b[n].pid&&v.push({xtype:"Button",addClass:"toa-dropdown-item routing-menu-item",name:"actionDelete",attr:{"aria-label":e({id:15420}),"aria-labelledby":e({id:15420}),tabindex:0},label:e({id:15420})}),b[n].profile.active?v.push({xtype:"Button",addClass:"toa-dropdown-item routing-menu-item",name:"actionDeactivate",attr:{"aria-label":e({id:15464}),"aria-labelledby":e({id:15464}),tabindex:0},label:e({id:15464})}):v.push({xtype:"Button",addClass:"toa-dropdown-item routing-menu-item",name:"actionActivate",
attr:{"aria-label":e({id:15474}),"aria-labelledby":e({id:15474}),tabindex:0},label:e({id:15474})}),v.push({xtype:"Button",addClass:"toa-dropdown-item routing-menu-item",name:"actionAddRoutingPlan",attr:{"aria-label":e({id:15500}),"aria-labelledby":e({id:15500}),tabindex:0},label:e({id:15500})}),toa.view.control.create({xtype:"button.Menu",name:"actionProfileMenuButton",text:"",addClass:"toa-item-menu-button",icon:"toa-item-menu-icon",attr:{"aria-label":e({id:8074}),"aria-haspopup":"true"},menuItems:v,
popupOptions:{appear:"bottom",align:"right",constraitPosition:!1},profile:b[n].profile,listeners:{menuItemClick:function(c,e){var g=e.source.options.profile;"actionRename"==e.name?this.notify("rename routing profile",g,"rename"):"actionClone"==e.name?this.notify("clone routing profile",g,"clone"):"actionDeactivate"==e.name?this.notify("deactivate routing profile",g,"deactivate"):"actionActivate"==e.name?this.notify("activate routing profile",g,"activate"):"actionDelete"==e.name&&this.getResourceId()!=
b[n].pid?this.notify("delete routing profile",g,"delete"):"actionAddRoutingPlan"==e.name&&(this._statuses.returnToPage=!0,console.debug("Routing actionAddRoutingPlan triggered"),d._loadJetContent(d,e),require(["SignalEmitter"],function(b){b.dispatch("routing.plan.view.add",g.id,!0);console.debug("Routing actionAddRoutingPlan - Dispatch signal")}))}.bind(this),click:function(b,c){c.event.stopPropagation()}.bind(this)}}).render(u.find(".menu-actions"))):u.find(".profile-name .link").addClass("read-only-profile");
if(!this._noProvider){var G=this.renderPlansList({pid:b[n].pid,timeZone:b[n].providerTZ},b[n].profile.plans,!1),v=u.find(".profile-content"),K=0;for(t in G)G.hasOwnProperty(t)&&(K++,v.append(G[t]));G=0;for(t in this.routingProfiles)if(b[n].profile.id==this.routingProfiles[t].id){G=this.routingProfiles[t].totalPlansCount;break}this._checkShowMoreButton(v,K,G,b[n].pid,this.pager,!1)}if(s)u.on("click",!0!==c?".profile-head":".no-provider",{pid:b[n].pid,noProvider:this._noProvider,pager:this.pager},function(b){this._noProvider=
b.data.noProvider;this.pager=b.data.pager;this.notify("show provider plans",{pid:b.data.pid,event:b,noProvider:this._noProvider})}.bind(this));l.push(u)}this._noProvider&&0===l.length&&(l='<p class="not-found">'+e({id:15317})+"</p>");return l},_loadJetContent:function(b,c){if("actionModify"===c.name||"actionClone"===c.name||"actionAddRoutingPlan"===c.name)c.label="routing_plan",c.name=_DATA.glossary.action_links.routing_run_list,toa.app.trigger("app.controller.suspend",{instance:"routing_run_list",
params:{}}),require(["loader"],function(b){b.run(c)})},renderRoutingProfilePanel:function(){var b=e({id:15539,translations:{"{COUNT}":Object.keys(this.routingProfiles).length}}),b=$(u.apply({label:b}));b.on("click",".list-display-switcher-show",{},function(b){this._statuses.show_all_routing_profiles=!0;this.notify("show all routing profiles")}.bind(this));b.on("click",".list-display-switcher-hide",{},function(b){this._statuses.show_all_routing_profiles=!1;$("#all-routing-profiles div").remove();$(b.currentTarget).hide();
$(".list-display-switcher-show").show()}.bind(this));this._content.append(b);1<this.getAccess("routing_plans_widget")&&this._initAddRoutingProfileButton();this.filterButton.render("#routing-profile-filters");this.filterButton.setPopupDesc(this.getFilterDesc());this._statuses.show_all_routing_profiles&&this.notify("show all routing profiles",{currentPid:this.currentPid});this._statuses.scrollEvent||($(".routing-plans-list").on("scroll",function(){this._statuses.scrollTop=$(".routing-plans-list").scrollTop()}.bind(this)),
this._statuses.scrollEvent=!0)},_initAddRoutingProfileButton:function(){var b={xtype:"button.Icon",name:"addRoutingProfileButton",label:e({id:5402}),layoutCellWidth:1};toa.view.control.create(b).render("#add-new-routing-profile");$('#add-new-routing-profile button[name="addRoutingProfileButton"]').off().on("click",function(){this.notify("create routing profile")}.bind(this))},_getFiltersData:function(){var b=this.allPlansFilter,b=b?b||{}:jQuery.extend({},k),c;for(c in k)b.hasOwnProperty(c)||(b[c]=
k[c]);return b},getFilterDesc:function(){var b=this._getFiltersData();return[{xtype:"Input",formLabel:e({id:1747}),name:"find",value:b.find},{xtype:"Select",formLabel:e({id:1204}),name:"status",value:b.status,optionItems:[{label:e({id:8685}),value:"all"},{label:e({id:30}),value:"active"},{label:e({id:31}),value:"inactive"}]},{xtype:"Input",name:"limit",value:b.limit,attr:{maxlength:3,oninput:"this.value = this.value.replace(/^[^1-9]|[^0-9]/g, '');"},formLabel:e({id:1746})}]},renderPlansList:function(b,
d,k){var l=this;k="undefined"!==typeof k?k:this._noProvider;var n=[],p=this.getAccess("routing_execution_summary_widget"),u;for(u in d)if(d.hasOwnProperty(u)){var v=d[u],F=g.determineTypeOfPlan(v),J=t.apply({gbo:this.lookup.goal_based_optimization[v.plan_full_info.goal_based_optimization],planType:F,description:v.description,scheduledInfo:this._scheduledInfo(F,d,v),timeLimit:this._timeLimit(v.plan_full_info),assignmentParametersInfo:this._assignmentParameters(v.plan_full_info),isCenterPointEnable:v.plan_full_info.center_point_enable,
subTypeText:this._subTypeText(v.subType),centerPointHomeZoneInfo:this._centerPointRadius(v.plan_full_info),homeZoneRadiusInfo:this._radiusOverstep(v.plan_full_info),dynamicRoutingInfo:this._dynamicInfo(v.plan_full_info),providerOvertimeInfo:this._providerOvertimeInfo(v.plan_full_info),travelTimeInfo:this._travelTimeInfo(v.plan_full_info),optimization:this._optimization(v.plan_full_info),isSLR:toa.app.model("featureList").isSLRServiceEnabled()?v.plan_full_info.is_use_slr:!1,filtersInfo:this._filtersInfo(v.plan_full_info),
reoptimizationInfo:this._reoptimizationInfo(v.plan_full_info),shortInfo:this._shortInfo(v.plan_full_info),noProvider:k}),F=$(s.apply({planId:v.routing_plan_id,planName:v.routing_plan_name,planInfo:J,planActivities:v.activities,planResources:v.providers,planType:F,hasWarning:this._isPlanHasAlert(v.routing_plan_id),noProvider:k,dynamicRoutingInfo:this._dynamicInfo(v.plan_full_info),autoOrderingInfo:this._enabledOrDisabled(parseInt(v.plan_full_info.auto_ordering,10)),isActive:v.plan_full_info.active})),
J=[];if(0!=this.getAccess("routing_plans_widget")){var H=2<=this.getAccess("routing_plans_widget")?e({id:462}):e({id:8047});J.push({xtype:"Button",name:"actionModify",addClass:"toa-dropdown-item routing-menu-item",attr:{"aria-label":H,"aria-labelledby":H,tabindex:0},label:H})}2<=this.getAccess("routing_plans_widget")&&("urgent"!==v.immediate_algorithm&&J.push({xtype:"Button",name:"actionClone",addClass:"toa-dropdown-item routing-menu-item",attr:{"aria-label":e({id:15408}),"aria-labelledby":e({id:15408}),
tabindex:0},label:e({id:15408})}),J.push({xtype:"Button",name:"actionDelete",addClass:"toa-dropdown-item routing-menu-item",attr:{"aria-label":e({id:15420}),"aria-labelledby":e({id:15420}),tabindex:0},label:e({id:15420})}),v.plan_full_info.active?J.push({xtype:"Button",name:"actionDeactivate",addClass:"toa-dropdown-item routing-menu-item",attr:{"aria-label":e({id:15464}),"aria-labelledby":e({id:15464}),tabindex:0},label:e({id:15464})}):J.push({xtype:"Button",name:"actionActivate",addClass:"toa-dropdown-item routing-menu-item",
attr:{"aria-label":e({id:15474}),"aria-labelledby":e({id:15474}),tabindex:0},label:e({id:15474})}));v.plan_full_info.active&&toa.date.isDateNotArchived(this.getDate(),b.timeZone)&&""===v.immediate_algorithm&&2<=p&&!k&&J.push({xtype:"Button",name:"actionRun",addClass:"toa-dropdown-item routing-menu-item",attr:{"aria-label":e({id:5430}),"aria-labelledby":e({id:5430}),tabindex:0},label:e({id:5430})});toa.view.control.create({xtype:"button.Menu",name:"actionRoutingPlanMenuButton",text:"",addClass:"toa-item-menu-button",
icon:"toa-item-menu-icon",menuItems:J,popupOptions:{appear:"bottom",align:"right",constraitPosition:!1},attr:{"aria-label":e({id:8074}),"aria-haspopup":"true"},pid:b.pid,plan:v,listeners:{menuItemClick:function(b,d){var g=d.source.options.plan;if("actionModify"==d.name)this._statuses.returnToPage=!0,console.debug("Routing actionModify triggered"),l._loadJetContent(l,d),require(["SignalEmitter"],function(b){b.dispatch("routing.plan.view.modify",g,!0);console.debug("Routing actionModify - Dispatch signal")});
else if("actionDelete"==d.name)this.notify("delete routing plan",g,"delete");else if("actionDeactivate"==d.name)this.notify("deactivate routing plan",g,"deactivate");else if("actionActivate"==d.name)this.notify("activate routing plan",g,"activate");else if("actionClone"==d.name)this._statuses.returnToPage=!0,l._loadJetContent(l,d),require(["SignalEmitter"],function(b){b.dispatch("routing.plan.view.clone",g,!0);console.debug("Routing actionAddRoutingPlan - Dispatch signal")});else if("actionDelete"==
d.name)this.notify("delete routing plan",g,"delete");else if("actionDeactivate"==d.name)this.notify("deactivate routing plan",g,"deactivate");else if("actionActivate"==d.name)this.notify("activate routing plan",g,"activate");else if("actionRun"==d.name){var k=new c(this._sandbox,this._layout),n={planId:g.routing_plan_id,planName:g.routing_plan_name,planType:0!==g.successor_id?"sequentially":"manual",currentPid:this.getResourceId(),rpAssignmentTo:g.assignmentTo,popup_extra_css_class:"redwood-styles-popup",
popupTitle:e({id:226432,type:"raw"}),actionButtonText:e({id:13038,type:"raw"}),cancelButtonText:e({id:16226,type:"raw"})};k.getTip().notify("manual.routing.plan.start",n)}}.bind(this)}}).render(F.find(".plan-actions"));F.on("click",".show-more-less",function(b){$(b.target).closest(".plan-data-wrapper").toggleClass("short")}.bind(this));v.plan_full_info.active||F.addClass("not-active");n.push(F)}return n},_isPlanHasAlert:function(b){for(var c in this.routingPlansAlerts)if(parseInt(this.routingPlansAlerts[c].plan_id)===
parseInt(b))return!0;return!1},_scheduledInfo:function(b,c,d){var g=d.plan_full_info,k=d.sequence_plan_info,l="",n="",p="";this._setWeekdays(g.weekdays);this._setAlgorithm(g.immediate_algorithm);var s=0<d.plan_full_info.weekdays?this._getFormattedWeekdays():"";null!=g.from_time&&(g.from_time=g.from_time?g.from_time:"00:00",n=this._timeToUserFormat(g.from_time));null!=g.to_time&&(g.to_time=g.to_time?g.to_time:"00:00",p=this._timeToUserFormat(g.to_time));switch(b){case "manual":l=e({id:7080});break;
case "onceaday":l=!1===p?e({id:3287}):e({id:7081,translations:{"{TIME}":n,"{WEEKDAYS}":s}});break;case "recurrent":l=!1===n||!1===p?e({id:3287}):toa.glossary({id:7082,translations:{"{START_TIME}":n,"{END_TIME}":p,"{MINUTES}":g.interval,"{WEEKDAYS}":s}});break;case "immediately":l="";switch(this._getAlgorithm(c,g)){case "urgent":l=e({id:15324});break;case "scheduled":b=g.trigger_filter_id,l=e({id:15478,translations:{"{DATA}":0<b?this.lookup.custom_filter[b]:e({id:13739})}})}break;case "sequentially":k&&
(l=e({id:13721,translations:{"{PLAN_NAME}":k.name},type:"raw"}))}return d.plan_full_info.active?l:toa.glossary({id:21705,translations:{"{INFO}":l}})},_timeLimit:function(b){return 60>b.time_limit?b.time_limit+" "+e({id:24024}):b.time_limit/60+" "+e({id:24025})},_assignmentParameters:function(b){var c=[],d=parseInt(b.use_required_inventory,10),g=parseInt(b.load_technicians_by_points,10),k=parseInt(b.fitness_coeff_uniformity,10);b=parseInt(b.auto_ordering,10);d&&2<=this.getAccess("routing_plans_widget")&&
c.push(e({id:13834}));g&&c.push(e({id:13835}));k&&c.push(e({id:5347}));b&&c.push(e({id:5210}));0==c.length&&c.push(e({id:13853}));return c.join(", ")},_subTypeText:function(b){return"broadcast"===b?e({id:20160}):e({id:20161})},_centerPointRadius:function(b){if(!b.center_point_enable)return 0;b=b.center_point_radius;"km"==this.lookup.geocoding_units.distance_units&&(b=Math.round(100*parseFloat(b/1E3))/100);"miles"==this.lookup.geocoding_units.distance_units&&(b=Math.round(100*parseFloat(b/1609))/100);
return b},_radiusOverstep:function(b){return parseInt(b.home_zone_radius_overstep_weight)},_dynamicInfo:function(b){var c="",d=b.dynamic_cut_time,g=b.dynamic_cut_nappt;b=b.invert_cut;0==d&&0==g||!d&&!g?c=e({id:5580}):0!=d&&0==g?c=e({id:7085,translations:{"{MINUTES}":d}}):0==d&&0!=g?c=e({id:7084,translations:{"{ACTIVITIES}":g}}):0!=d&&0!=g&&0==b?c=e({id:7086,translations:{"{MINUTES}":d,"{ACTIVITIES}":g}}):0!=d&&0!=g&&1==b&&(c=e({id:7087,translations:{"{MINUTES}":d,"{ACTIVITIES}":g}}));return c},_providerOvertimeInfo:function(b){var c=
"",d=null;b=parseInt(b.machine_operation_deadline_shift);0>b?(d=!1,b*=-1):0<b&&65535>b&&(d=!0);0==b?c=e({id:6874}):0<b&&d?c=e({id:6876,translations:{"[MINUTES]":b}}):0<b&&65535>b&&!d?c=e({id:6877,translations:{"[MINUTES]":b}}):d||(c=e({id:6875}));return c},_travelTimeInfo:function(b){var c=parseInt(b.unacceptable_travel_distance);"miles"===toa.app.model("companySettings").settings.distance_units&&(c=parseInt(toa.views.routingRuns.utils.convertKmToMiles(b.unacceptable_travel_distance)));toa.app.model("featureList").isSLRServiceEnabled()&&
b.is_use_slr||(c=0);return toa.views.routingRuns.utils.getTravelTimeInfoText(parseInt(b.unacceptable_travel_time),c)},_optimization:function(b){return"shortest"===b.optimization?e({id:21716}):e({id:21715})},_filtersInfo:function(b){return b.plan_filters_count||0},_reoptimizationInfo:function(b){var c=b.reoptimization_enable?e({id:14245}):e({id:14246}),d=1==b.reoptimization_filters_count?e({id:13745}):e({id:3633});return c+", "+(b.reoptimization_filters_count?d.toLowerCase()+" "+b.reoptimization_filters_count:
e({id:11103}).toLowerCase())},_shortInfo:function(b){var c=[];b.goal_based_optimization&&"balanced"!=b.goal_based_optimization&&c.push(this.lookup.goal_based_optimization[b.goal_based_optimization]);b.reoptimization_enable&&c.push(e({id:13806}));(b.dynamic_cut_time||b.dynamic_cut_nappt)&&c.push(e({id:5207}));return c.join(", ")},_setAlgorithm:function(b){this.algorithm=b},_getAlgorithm:function(b,c){if("undefined"==typeof this.algorithm||"false"==this.algorithm)this.algorithm=this._isSetUrgent(b,
c)?"scheduled":"urgent";return this.algorithm},_isSetUrgent:function(b,c){if("undefined"==typeof this.issetUrgent){this.issetUrgent=!1;for(var d in b)if(b.hasOwnProperty(d)&&"urgent"==b[d].rpimmediate_algorithm&&b[d].rpid!=c.id){this.issetUrgent=!0;break}}return this.issetUrgent},_timeToUserFormat:function(b){var c=g.getUserDateTimeFormat();if(""==b)return"";var d=b.split(/:/);b=parseInt(d[0],10);d=parseInt(d[1],10);if(isNaN(b)||isNaN(d))return!1;var e=toa.datetime.currentDate();e.setHours(b);e.setMinutes(d);
return toa.datetime.formatDate(c.time,e)},_getFormattedWeekdays:function(){return this.formattedWeekdays?this.formattedWeekdays:!1},_formatWeekdays:function(b){var c=0,d=[],e=!1,g=!0,k;for(k in this.lookup.daysList)if(this.lookup.daysList.hasOwnProperty(k)){var l=this.lookup.daysList[k];b==this.lookup.weekdays[l].mask?d.push(this.lookup.weekdays[l].day):(c++,b&this.lookup.weekdays[l].mask?(e&&(g=!1),d.push(this.lookup.weekdays[l].day)):0!=d.length&&(e=!0))}1==d.length&&(g=!1);this._setIsWeekdaysDivided(g);
return d},_isWeekdays:function(b){var c=$.merge([],this.lookup.daysList),d=0;c.splice(0,1);c.pop();for(var e in c)c.hasOwnProperty(e)&&(d+=this.lookup.weekdays[c[e]].mask);return d==b},_isWeekdaysDaily:function(b){var c=0,d;for(d in this.lookup.daysList)this.lookup.daysList.hasOwnProperty(d)&&(c+=this.lookup.weekdays[this.lookup.daysList[d]].mask);return c==b},_setWeekdays:function(b){this.weekdays=b;b=this._formatWeekdays(this.weekdays);this._setFormattedWeekdays(b)},_getWeekdays:function(){return this.weekdays?
this.weekdays:0},_setFormattedWeekdays:function(b){if(this._isWeekdaysDaily(this._getWeekdays()))this.formattedWeekdays=e({id:6930});else if(this._isWeekdays(this._getWeekdays()))this.formattedWeekdays=e({id:7120});else if(this.isDividedWeekdays){var c=b.pop();this.formattedWeekdays=b[0]+"-"+c}else this.formattedWeekdays=b.join(" ")},_setIsWeekdaysDivided:function(b){this.isDividedWeekdays=b},_enabledOrDisabled:function(b){return b?e({id:21704}):e({id:5580})},_loadCounts:function(b){b&&this._sandbox.trigger("global.data.get",
{controller:"Routingvisualization",method:"loadRoutingRunActivities",params:{plans_info:b,date:this.getDate()},responseHandler:function(b,c){for(var d=0;d<c.routing_runs_activity_info.length;d++){var g=c.routing_runs_activity_info[d],k=$('div[data-plan-id="'+g.plan_id+'"]',this._container),l=[g.activities,"<br /><span>",1===g.activities||0===g.activities?e({id:108}):e({id:1}),"</span>"];$("div.plan-activities",k).html(l.join(""));g=[g.resources,"<br /><span>",1===g.resources||0===g.resources?e({id:1510}):
e({id:3681}),"</span>"];$("div.plan-resources",k).html(g.join(""))}}.bind(this),errorHandler:function(b){Object.assign(b,{popup_extra_css_class:"redwood-styles-popup"});this.showAlert(b);return!1}.bind(this)})},filterApply:function(b,c){this.allPlansFilter=c.values;c.source.setState("filtered");this._statuses.show_all_routing_profiles=!0;this.notify("show all routing profiles");this.filterButton.close()},toString:function(){return"routing_plans_list_infoarea"}}));toa.mixin(toa.views.routingRuns.infoArea.RoutingPlansList.prototype,
toa.mixins.EventEmitter)})();(function(){var d=toa.views.routingRuns.Widget,c=toa.views.routingRuns.infoArea.RoutingPlansList,b=toa.glossary,e=function(){var b=$("#parent-routing-plans-count"),c=this._sandbox.model("treeModel").getResource(this.getResourceId());c&&c.getParent()?b.show():b.hide()};toa.ns("toa.views.routingRuns.widgets.RoutingPlansDashboard",toa.define(d,function(b,k){d.apply(this,arguments);this.infoArea=null;this.setCurrent(!1);this.setInfoArea(new c(b,k));b.bind("routing.runs.set.routing.plans.widget.in.denied.mode",
function(b,c){this.getContent().hide();clearInterval(this._updateInterval);this.isCurrent()&&k.getInfoAreaContainer().children().remove()}.bind(this));b.bind("routing.runs.set.routing.plans.widget.in.read.only.mode",function(b,c){this.getContent().show()}.bind(this));b.bind("routing.runs.set.routing.plans.widget.in.read.write.mode",function(b,c){this.getContent().show()}.bind(this));b.bind("system.title.setResource",e.bind(this))},{_updateIntervalTime:6E5,requestData:function(){this._isLoading=!0;
this._sandbox.trigger("global.data.get",{controller:"Routingvisualization",method:"routingPlansDashboardWidget",params:{pid:this.getResourceId(),date:this.getDate()},responseHandler:function(b,c){this.update(c.widget||{},!0);this._layout.setAccess(c.access);this._isLoading=!1}.bind(this),errorHandler:function(b){Object.assign(b,{popup_extra_css_class:"redwood-styles-popup"});this.showAlert(b);return!1}.bind(this)})},setInfoArea:function(b){this.infoArea=b},getInfoArea:function(){return this.infoArea},
getWidgetClassName:function(){return"routing-plans-dashboard"},getWidgetTemplate:function(){return['<div class="widget-title"><div>',b({id:13137}),'<span id="routing-plan-dashboard-warning" class="oj-component-icon oj-message-status-icon oj-message-warning-icon routing-widget-alert" title="',b({id:24026}),'" role="img"></span></div></div><div class="widget-numbers"><div class="counter-wrapper">   <div class="plans-count-icon current-plans-count-icon" data-marker="routing_plans_count">0</div>   <div id="parent-routing-plans-count" class="parent-routing-plans-count">         /<span data-marker="parent_routing_plans_count">0</span></div></div></div>'].join("")},
update:function(b){d.prototype.update.apply(this,arguments);e.bind(this)();b.routing_profile_has_alert?$("#routing-plan-dashboard-warning").show():$("#routing-plan-dashboard-warning").hide()},toString:function(){return"routing_plans_dashboard_widget"}}))})();(function(){var d=toa.views.routingRuns.Widget,c=toa.views.routingRuns.infoArea.RoutingRunsList,b=toa.glossary;toa.ns("toa.views.routingRuns.widgets.PlansExecutionSummaryDashboard",toa.define(d,function(b,g){d.apply(this,arguments);this.infoArea=null;this.setInfoArea(new c(b,g));b.bind("routing.no.runs",function(b,c){var d=1===c?"none":"block";$(".plans-execution-summary .negative").css("display",d)},this);b.bind("routing.runs.set.plans.execution.summary.widget.in.denied.mode",function(b,c){this.getContent().hide();
clearInterval(this._updateInterval);this.isCurrent()&&g.getInfoAreaContainer().children().remove()}.bind(this));b.bind("routing.runs.set.plans.execution.summary.widget.in.read.only.mode",function(b,c){this.getContent().show()}.bind(this));b.bind("routing.runs.set.plans.execution.summary.widget.in.read.write.mode",function(b,c){this.getContent().show()}.bind(this));b.bind("routing.runs.set.priority.time",function(b,c){this.setPriorityTimeLeft(c)}.bind(this))},{_updateIntervalTime:6E5,priorityData:{priority_time_left:null,
priority_time_spent:null,execution_priority_time_left:null,execution_priority_time_spent:null},requestData:function(){this._isLoading=!0;this._sandbox.trigger("global.data.get",{controller:"Routingvisualization",method:"plansExecutionSummaryDashboardWidget",params:{pid:this.getResourceId(),date:this.getDate()},responseHandler:function(b,c){this.update(c.widget||{});this._layout.setAccess(c.access);this._isLoading=!1}.bind(this),errorHandler:function(b){Object.assign(b,{popup_extra_css_class:"redwood-styles-popup"});
this.showAlert(b);return!1}.bind(this)})},update:function(b){d.prototype.update.apply(this,arguments);b.plans_execution_summary_count_negative?this._sandbox.trigger("routing.no.runs"):this._sandbox.trigger("routing.no.runs",1);this.convertTimeLeftData(b)},convertTimeLeftData:function(b){if("undefined"===typeof b.priority_time_left&&"undefined"===typeof b.priority_time_spent)this.priorityData.priority_time_left="N/A",this.priorityData.execution_priority_time_spent="N/A",this.priorityData.execution_priority_time_left=
"N/A";else{var c=$(".plans-execution-summary .priority-time-count-icon");c.removeClass("no-time-left half-hour-time-left");0===b.priority_time_left?c.addClass("no-time-left"):0<b.priority_time_left&&1800>=b.priority_time_left&&c.addClass("half-hour-time-left");this.priorityData.priority_time_left=this.convertTimeLeftDataValue(b.priority_time_left,224659,224658);this.priorityData.execution_priority_time_left=this.convertTimeLeftDataValue(b.priority_time_left,224661,224660);this.priorityData.execution_priority_time_spent=
this.convertTimeLeftDataValue(b.priority_time_spent,224657,224656)}this._sandbox.trigger("routing.runs.set.priority.time")},convertTimeLeftDataValue:function(c,d,k){0>c&&(c=0);3600<=c?(d=(c/3600).toFixed(2).split("."),c=d[0],d=Math.round(0.6*d[1]),c=b({id:k,translations:{"{HOURS}":c,"{MINUTES}":d},type:"raw"})):(c=Math.round(c/60),c=b({id:d,translations:{"{VALUE}":c},type:"raw"}));return c},setPriorityTimeLeft:function(){$('[data-marker="priority_time_left"]').html(this.priorityData.priority_time_left);
$('.execution-head [data-marker="priority_time_left"]').html(this.priorityData.execution_priority_time_left);$('.execution-head [data-marker="priority_time_spent"]').html(this.priorityData.execution_priority_time_spent)},setInfoArea:function(b){this.infoArea=b},getInfoArea:function(){return this.infoArea},getWidgetClassName:function(){return"plans-execution-summary"},getWidgetTemplate:function(){return['<div class="widget-title"><div>',b({id:15438}),'</div></div><div class="widget-numbers plans-execution-summary"><div class="counter-wrapper">   <div class="plans-count-icon execution-summary-count-icon-positive positive" data-marker="plans_execution_summary_count_positive">0</div>   <div class="plans-count-icon execution-summary-count-icon-negative negative" style="display: none" data-marker="plans_execution_summary_count_negative">0</div>   <div class="plans-count-icon priority-time-count-icon" data-marker="priority_time_left"></div></div></div>'].join("")},
toString:function(){return"plans_execution_summary_dashboard_widget"}}))})();(function(){var d=toa.views.routingRuns.Widget,c=toa.views.routingRuns.infoArea.AutoroutingList,b=toa.glossary;toa.ns("toa.views.routingRuns.widgets.AutoroutingDashboard",toa.define(d,function(b,g){d.apply(this,arguments);this.infoarea=null;this.setCurrent(!1);this.setInfoArea(new c(b,g));b.bind("autorouting_dashboard_widget_request_data",function(b,c){this.requestData()}.bind(this));b.bind("routing.runs.set.autorouting.widget.in.denied.mode",function(b,c){this.getContent().hide();clearInterval(this._updateInterval);
this.isCurrent()&&g.getInfoAreaContainer().children().remove()}.bind(this));b.bind("routing.runs.set.autorouting.widget.in.read.only.mode",function(b,c){this.getContent().show()}.bind(this));b.bind("routing.runs.set.autorouting.widget.in.read.write.mode",function(b,c){this.getContent().show()}.bind(this))},{_updateIntervalTime:6E5,_setters:{autorouting_percent:function(c,d){if(null===c||0==c)d.html('<span class="not-available">N/A</span>');else{var k=b({id:15321,translations:{"{VALUE}":"<span>"+c+
"</span>"},type:"raw"});d.html(k.replace("%",'<span class="widget-percents-sign">%</span>'))}}},requestData:function(){this._isLoading=!0;this._sandbox.trigger("global.data.get",{controller:"Routingvisualization",method:"autoroutingDashboardWidget",params:{pid:this.getResourceId(),date:this.getDate()},responseHandler:function(b,c){this.handleReceivedData(c.widget||{});this._layout.setAccess(c.access);this._isLoading=!1}.bind(this),errorHandler:function(b){Object.assign(b,{popup_extra_css_class:"redwood-styles-popup"});
this.showAlert(b);return!1}.bind(this)})},setInfoArea:function(b){this.infoArea=b},getInfoArea:function(){return this.infoArea},getWidgetClassName:function(){return"autorouting"},getWidgetTemplate:function(){return['<div class="widget-title"><div>',b({id:13144}),'</div></div><div class="widget-numbers">   <div class="counter-wrapper">      <div class="plans-count-icon autorouting-count-icon" data-marker="autorouting_percent"></div>   </div></div>'].join("")},toString:function(){return"autorouting_dashboard_widget"}}))})();(function(){var d=toa.views.routingRuns.Widget,c=toa.views.routingRuns.infoArea.ResourceUtilizationList,b=toa.glossary;toa.ns("toa.views.routingRuns.widgets.ResourceUtilizationDashboard",toa.define(d,function(b,g){d.apply(this,arguments);this.infoArea=null;this.setCurrent(!1);this.setInfoArea(new c(b,g));b.bind("resource_utilization_dashboard_widget_request_data",function(b,c){this.requestData()}.bind(this));b.bind("routing.runs.set.routing.utilization.widget.in.denied.mode",function(b,c){this.getContent().hide();
clearInterval(this._updateInterval);this.isCurrent()&&g.getInfoAreaContainer().children().remove()}.bind(this));b.bind("routing.runs.set.routing.utilization.widget.in.read.only.mode",function(b,c){this.getContent().show()}.bind(this));b.bind("routing.runs.set.routing.utilization.widget.in.read.write.mode",function(b,c){this.getContent().show()}.bind(this))},{_updateIntervalTime:6E5,_setters:{resource_utilization:function(c,d){if(c){var k=b({id:15321,translations:{"{VALUE}":"<span>"+c+"</span>"},type:"raw"});
d.html(k.replace("%",'<span class="widget-percents-sign">%</span>'))}else d.html('<span class="not-available">N/A</span>')}},requestData:function(){this._isLoading=!0;this._sandbox.trigger("global.data.get",{controller:"Routingvisualization",method:"resourceUtilizationDashboardWidget",params:{pid:this.getResourceId(),date:this.getDate()},responseHandler:function(b,c){this.handleReceivedData(c.widget||{});this._layout.setAccess(c.access);this._isLoading=!1}.bind(this),errorHandler:function(b){Object.assign(b,
{popup_extra_css_class:"redwood-styles-popup"});this.showAlert(b);return!1}.bind(this)})},setInfoArea:function(b){this.infoArea=b},getInfoArea:function(){return this.infoArea},getWidgetClassName:function(){return"resource-utilization"},getWidgetTemplate:function(){return['<div class="widget-title"><div>',b({id:13153}),'</div></div><div class="widget-numbers">   <div class="counter-wrapper">      <div class="plans-count-icon resource-utilization-count-icon" data-marker="resource_utilization"></div>  </div></div>'].join("")},
toString:function(){return"resource_utilization_dashboard_widget"}}))})();(function(){var d=toa.views.routingRuns.Widget,c=toa.views.routingRuns.infoArea.SavingsList,b=toa.views.routingRuns.utils,e=toa.glossary;toa.ns("toa.views.routingRuns.widgets.SavingsDashboard",toa.define(d,function(b,e){d.apply(this,arguments);this.infoArea=null;this.setCurrent(!1);this.setInfoArea(new c(b,e));b.bind("saving_dashboard_widget_request_data",function(b,c){this.requestData()}.bind(this));b.bind("routing.runs.set.savings.widget.in.denied.mode",function(b,c){this.getContent().hide();clearInterval(this._updateInterval);
this.isCurrent()&&e.getInfoAreaContainer().children().remove()}.bind(this));b.bind("routing.runs.set.savings.widget.in.read.only.mode",function(b,c){this.getContent().show()}.bind(this));b.bind("routing.runs.set.savings.widget.in.read.write.mode",function(b,c){this.getContent().show()}.bind(this))},{_updateIntervalTime:6E5,_setters:{savings_total_cost:function(c,d){null===c||0==c?(c="N/A",d.addClass("not-available")):(c=b.moneyToString(c),d.removeClass("not-available"));d.text(c);var e=$('[data-marker="savings_total_cost"]'),
n=e.closest(".widget-numbers").width();b.fitTextSize(n,e,45)},savings_total_time:function(c,d){null===c||0==c?(c="N/A",d.addClass("not-available")):(c=b.secondsToString(60*c),d.removeClass("not-available"));d.text(c);var e=$('[data-marker="savings_total_time"]'),n=e.closest(".widget-numbers").width();b.fitTextSize(n,e,45)},savings_view:function(b){"undefined"===typeof b||null===b||"t"===b?($(".savings-cost-value").hide(),$(".savings-time-value").show()):"c"===b&&($(".savings-cost-value").show(),$(".savings-time-value").hide())}},
requestData:function(){this._isLoading=!0;this._sandbox.trigger("global.data.get",{controller:"Routingvisualization",method:"savingsDashboardWidget",params:{pid:this.getResourceId(),date:this.getDate()},responseHandler:function(b,c){this.handleReceivedData(c.widget||{});this._layout.setAccess(c.access);this._isLoading=!1}.bind(this),errorHandler:function(b){Object.assign(b,{popup_extra_css_class:"redwood-styles-popup"});this.showAlert(b);return!1}.bind(this)})},setInfoArea:function(b){this.infoArea=
b},getInfoArea:function(){return this.infoArea},getWidgetClassName:function(){return"savings"},getWidgetTemplate:function(){return['<div class="widget-title"><div>',e({id:13104}),'</div></div><div class="widget-numbers"><div class="counter-wrapper">   <div class="plans-count-icon savings-count-icon savings-cost-value"><span data-marker="savings_total_cost">',e({id:13132}),' --</span></div>   <div class="plans-count-icon savings-count-time-icon savings-time-value"><span data-marker="savings_total_time">-- ',
e({id:13111})," -- ",e({id:13112}),"</span></div></div></div>"].join("")},toString:function(){return"saving_dashboard_widget"}}))})();(function(){var d=toa.views.routingRuns.Widget,c=toa.glossary;toa.ns("toa.views.routingRuns.widgets.PriorityTime",toa.define(d,function(b,c){d.apply(this,arguments);this.infoArea=null;this.setCurrent(!1);b.bind("routing.runs.set.priority.time.widget.in.denied.mode",function(b,c){this.getContent().hide()}.bind(this));b.bind("routing.runs.set.priority.time.widget.in.read.only.mode",function(b,c){this.getContent().show()}.bind(this));b.bind("routing.runs.set.priority.time.widget.in.read.write.mode",
function(b,c){this.getContent().show()}.bind(this))},{_updateIntervalTime:6E5,_setters:{priority_time_left:function(b,d){b?(0>b&&(b=0),3600<=b?(b=Math.round(b/36)/100,b=c({id:13378,translations:{"{VALUE}":b},type:"raw"})):(b=Math.round(b/0.6)/100,b=c({id:24050,translations:{"{VALUE}":b},type:"raw"})),d.html(b)):d.html('<span class="not-available">N/A</span>')}},setInfoArea:function(b){},getInfoArea:function(){return!1},getWidgetClassName:function(){return"priority-time"},getWidgetTemplate:function(){return['<div class="widget-title"><div>',
c({id:13379}),'</div></div><div class="widget-numbers">   <div class="counter-wrapper">      <div class="plans-count-icon priority-time-count-icon" data-marker="priority_time_left"></div>  </div></div>'].join("")},toString:function(){return"priority_time_widget"}}))})();(function(){var d=toa.views.routingRuns.Widget,c=toa.views.routingRuns.infoArea.BaselineSettings;toa.ns("toa.views.routingRuns.widgets.BaselineSettingsDashboard",toa.define(d,function(b,e,g){d.apply(this,arguments);this.infoArea=null;this.setCurrent(!1);this.setInfoArea(new c(b,e));b.bind("baseline_dashboard_widget_request_data",function(c,d){this.requestData();b.trigger("set.current.routing.widget",{widgetName:this.toString()});$(".routing-visualisation .routing-vsl-widget.savings").addClass("current-widget-corner")}.bind(this));
b.bind("routing.runs.set.baseline.settings.widget.in.denied.mode",function(b,c){this.getContent().hide();clearInterval(this._updateInterval);g.setOption("backButton",!1);this.isCurrent()&&e.getInfoAreaContainer().children().remove()}.bind(this));b.bind("routing.runs.set.baseline.settings.widget.in.read.only.mode",function(b,c){g.setOption("backButton",!0)}.bind(this));b.bind("routing.runs.set.baseline.settings.widget.in.read.write.mode",function(b,c){g.setOption("backButton",!0)}.bind(this))},{_updateIntervalTime:6E5,
requestData:function(){this._isLoading=!0;this._sandbox.trigger("global.data.get",{controller:"Routingvisualization",method:"baselineDashboardWidget",params:{pid:this.getResourceId(),date:this.getDate()},responseHandler:function(b,c){this.handleReceivedData(c.widget||{});this._layout.setAccess(c.access);this._isLoading=!1}.bind(this),errorHandler:function(b){Object.assign(b,{popup_extra_css_class:"redwood-styles-popup"});this.showAlert(b);return!1}.bind(this)})},setInfoArea:function(b){this.infoArea=
b},getInfoArea:function(){return this.infoArea},getWidgetClassName:function(){return"baseline"},getWidgetTemplate:function(){return""},toString:function(){return"baseline_dashboard_widget"}}))})();(function(){toa.ns("toa.views.routingRuns.widgets.puzzle",toa.define(null,function(d,c){this.puzzle=$(d);this.classPrefix="";c&&(this.classPrefix=c)},{hide:function(){this.puzzle.addClass(this.buildClass("hide"))},show:function(){this.puzzle.removeClass(this.buildClass("hide"))},setText:function(d){this.puzzle.find("."+this.buildClass("text")).html(d)},setCSSClass:function(d){this.puzzle.addClass(this.buildClass(d))},buildClass:function(d){return this.classPrefix+d},removeCSSclass:function(d){if("[object Array]"===
Object.prototype.toString.call(d)){d=d.slice(0);for(var c=0,b=d.length-1;c<=b;c++)d[c]=this.buildClass(d[c]);this.puzzle.removeClass(d.join(" "))}else this.puzzle.removeClass(this.buildClass(d))},clearTextElement:function(){this.puzzle.find("."+this.buildClass("text")).html("")},showAllConnections:function(){for(var d=["hide-left","hide-right","hide-bottom","hide-top"],c=0,b=d.length;c<b;c++)this.puzzle.removeClass(this.buildClass(d[c]))},isHidden:function(){return this.puzzle.hasClass(this.buildClass("hide"))?
!0:!1},hasImage:function(){return!!this.puzzle.closest('[class*="'+this.buildClass("img-")+'"]').length},hasText:function(){return""!==this.puzzle.find("."+this.buildClass("text")).html()?!0:!1},moveLinks:function(){for(var d=this.puzzle.find('span[class!="vsl-text"]'),c=0,b=d.length;c<b;c++)switch($(d[c]).removeClass("vsl-plus-delta vsl-minus-delta"),!1){case 1:$(d[c]).addClass("vsl-plus-delta");break;case 2:$(d[c]).addClass("vsl-minus-delta")}},hideLeftConnection:function(){this.puzzle.addClass(this.buildClass("hide-left"))},
hideRightConnection:function(){this.puzzle.addClass(this.buildClass("hide-right"))},hideBottomConnection:function(){this.puzzle.addClass(this.buildClass("hide-bottom"))},hideTopConnection:function(){this.puzzle.addClass(this.buildClass("hide-top"))},showLeftConnection:function(){this.puzzle.removeClass(this.buildClass("hide-left"))},showRightConnection:function(){this.puzzle.removeClass(this.buildClass("hide-right"))},showBottomConnection:function(){this.puzzle.removeClass(this.buildClass("hide-bottom"))},
showTopConnection:function(){this.puzzle.removeClass(this.buildClass("hide-top"))}}))})();(function(){var d=toa.views.routingRuns.utils;toa.ns("toa.views.routingRuns.widgets.scenarios",toa.define(null,function(c){this.puzzles=c.puzzles;this.technitians=c.technitians;this.images=c.images;this.colors=c.colors;this.runDetailsObject=c.runDetailsObject},{hideCount:4,imgCount:6,namesCount:6,stepInterval:1500,finishStep:0,finished:!1,colors:null,images:null,technitians:null,puzzles:null,run:function(){return this.intervalId=setInterval(this.randomScenariousStep.bind(this),this.stepInterval)},
getRandomPuzzle:function(c){if(c){c=this.filterPuzzles(c);if(0===c.length)return!1;var b=d.getRandomInt(0,c.length-1);return c[b]}c=d.getRandomInt(0,this.puzzles.length-1);b=d.getRandomInt(0,this.puzzles[0].length-1);return this.puzzles[c][b]},getRandomNumPuzzles:function(c,b){var e=[],g;g=b?this.filterPuzzles(b):this.filterPuzzles();if(0===g.length)return!1;for(;c&&g.length;)e.push(g.splice(d.getRandomInt(0,g.length-1),1)[0]),--c;return e},checkPuzzle:function(c,b){return b.hidden&&!c.isHidden()||
b.hasImage&&!c.hasImage()||b.hasText&&!c.hasText()||b.shown&&c.isHidden()||b.withoutText&&c.hasText()||b.withoutImage&&c.hasImage()?!1:!0},filterPuzzles:function(c){for(var b=[],d={hidden:!1,hasImage:!1,hasText:!1,shown:!1,withoutText:!1,withoutImage:!1},d=$.extend(d,c),g=0;g<this.puzzles.length;g++)for(var k=0;k<this.puzzles[0].length;k++)c=this.puzzles[g][k],this.checkPuzzle(c,d)&&b.push(c);return b},hideRandPzl:function(){var c=this.getRandomPuzzle({shown:!0});!1!==c&&(this.clearPuzzle(c),c.hide())},
showRandPzl:function(){var c=this.getRandomPuzzle({hidden:!0});c&&this.showPuzzleOfRandomType(c)},showPuzzleOfRandomType:function(c){var b=this.filterPuzzles({shown:!0,hasImage:!0}).length,d=this.filterPuzzles({shown:!0,hasText:!0}).length;this.clearPuzzle(c);c.setCSSClass(this.randColor());b>=d?(b=this.randTech(),c.setText(b)):(b=this.randImg(),c.setCSSClass(b))},partitionScenariousStep:function(c){this.technitians.slice();this.images.slice(0);var b=this.filterPuzzles({hidden:!0}),e=this.getRandomNumPuzzles(b.length,
{shown:!0});c=1;if(this.finishPuzzle){clearInterval(this.intervalId);for(var b=this.filterPuzzles({hidden:!0}),g=b.length,e=1E3/g,k=0;k<g;k+=1)setTimeout(function(b){this.showPuzzleOfRandomType(b)}.bind(this,b[k]),c),c+=e;setTimeout(function(){this.runDetailsObject.onGetRoutingReport(null,{routing_details:this.runDetailsObject.data},!0)}.bind(this),1100)}else{for(var l=d.getRandomInt(3,5),n=b.length-l,k=0,g=e.length;k<g;k++)window.setTimeout(function(b,c){this.clearPuzzle(b);c.hasImage()?b.setCSSClass(this.randImg()):
(c.hasText(),b.setText(this.randTech()));b.setCSSClass(this.randColor());this.clearPuzzle(c);c.hide()}.bind(this,b[k],e[k]),c),c+=Math.floor(this.stepInterval/(l+Math.abs(n))-5);switch(n){case -1:case -2:for(k=0;k<Math.abs(n);k++)c+=Math.floor(this.stepInterval/(l+Math.abs(n))-5),window.setTimeout(this.hideRandPzl.bind(this),c);break;case 1:case 2:case 3:case 4:for(k=0;k<n;k++)c+=Math.floor(this.stepInterval/(l+Math.abs(n))-5),window.setTimeout(this.showRandPzl.bind(this),c)}}},randColor:function(){return this.colors[d.getRandomInt(0,
this.colors.length-1)]},randImg:function(){this.imgStack&&0!=this.imgStack.length||(this.imgStack=this.images.slice(0));return this.imgStack.splice(d.getRandomInt(0,this.imgStack.length-1),1)[0]},randTech:function(){this.techNamesStack&&0!=this.techNamesStack.length||(this.techNamesStack=this.technitians.slice(0));return this.techNamesStack.splice(d.getRandomInt(0,this.techNamesStack.length-1),1)[0]},clearPuzzle:function(c){c.removeCSSclass(this.colors);c.removeCSSclass(this.images);c.clearTextElement();
c.removeCSSclass("hide")},randomScenariousStep:function(){if(!0==this.isNotfirstRun)this.partitionScenariousStep();else{this.isNotfirstRun=!0;for(var c,b=0;b<this.puzzles.length;b++)for(var e=0;e<this.puzzles[0].length;e++)this.clearPuzzle(this.puzzles[b][e]),this.puzzles[b][e].setCSSClass(this.randColor()),this.puzzles[b][e].moveLinks(),0<=e-1&&(c=this.puzzles[b][e-1],d.getRandomInt(0,1)?(this.puzzles[b][e].hideLeftConnection(),c.showRightConnection()):(c.hideRightConnection(),this.puzzles[b][e].showLeftConnection())),
0<=b-1&&(c=this.puzzles[b-1][e],d.getRandomInt(0,1)?(c.hideBottomConnection(),this.puzzles[b][e].showTopConnection()):(this.puzzles[b][e].hideTopConnection(),c.showBottomConnection()));for(b=this.hideCount;b;)this.getRandomPuzzle().hide(),--b;b=this.filterPuzzles({shown:!0,withoutImage:!0});for(e=this.imgCount;b.length&&e;)b.splice(d.getRandomInt(0,b.length-1),1)[0].setCSSClass(this.randImg()),--e;b=this.filterPuzzles({withoutText:!0,withoutImage:!0,shown:!0});for(e=0;e<b.length;e++)b[e].setText(this.randTech())}}}))})();(function(){var d=toa.views.routingRuns.widgets.RoutingPlansDashboard,c=toa.views.routingRuns.widgets.PlansExecutionSummaryDashboard,b=toa.views.routingRuns.widgets.AutoroutingDashboard,e=toa.views.routingRuns.widgets.ResourceUtilizationDashboard,g=toa.views.routingRuns.widgets.SavingsDashboard,k=toa.views.routingRuns.widgets.BaselineSettingsDashboard;toa.ns("toa.views.routingRuns.WidgetsSet",toa.define(null,function(l,n,p){this._sandbox=l;this.selectedWidgetName="";l.bind("show.nodata.message",function(b){this.showNoDataMessage(n)}.bind(this));
l.bind("set.current.routing.widget",function(b,c){this.setCurrentWidget(c)}.bind(this));this._widgets=[new d(l,n),new c(l,n),new b(l,n),new e(l,n),new g(l,n),new k(l,n,p)]},{render:function(){for(var b in this._widgets)this._widgets.hasOwnProperty(b)&&this._widgets[b].render();return this},enableAutoUpdate:function(){for(var b in this._widgets)this._widgets.hasOwnProperty(b)&&this._widgets[b].enableAutoUpdate()},disableAutoUpdate:function(){for(var b in this._widgets)this._widgets.hasOwnProperty(b)&&
this._widgets[b].disableAutoUpdate()},isLoading:function(){var b=!1,c;for(c in this._widgets)if(this._widgets.hasOwnProperty(c)){if(!0==this._widgets[c].isLoading()){b=!0;break}if(this._widgets[c].getInfoArea()&&!0==this._widgets[c].getInfoArea().isLoading()){b=!0;break}}return b},setCurrentWidget:function(b){for(var c in this._widgets)this._widgets.hasOwnProperty(c)&&this._widgets[c].getContent()&&(this._widgets[c].toString()==b.widgetName?(this._widgets[c].setCurrent(!0),this._widgets[c].getContent().addClass("active-routing-tab"),
this.selectedWidgetName=b.widgetName):(this._widgets[c].resetCurrent(),this._widgets[c].getContent().removeClass("active-routing-tab")))},setResourceId:function(b){for(var c in this._widgets)this._widgets.hasOwnProperty(c)&&this._widgets[c].setResourceId(b)},setDate:function(b){for(var c in this._widgets)this._widgets.hasOwnProperty(c)&&this._widgets[c].setDate(b)},showNoDataMessage:function(b){var c='<div class="error_msg">'+h(8707)+"</div>";b.getInfoAreaContainer().empty().append(c)},update:function(b){var c=
"",d={plans_execution_summary_dashboard_widget:"routing_execution_summary_widget",routing_plans_dashboard_widget:"routing_plans_widget",resource_utilization_dashboard_widget:"routing_resource_utilization_widget",autorouting_dashboard_widget:"routing_autorouting_widget",saving_dashboard_widget:"routing_savings_widget",priority_time_widget:"routing_priority_time_widget"};if(""!==this.selectedWidgetName&&b.access[d[this.selectedWidgetName]])c=this.selectedWidgetName;else for(var e in d)!b.access[d[e]]||
""!==c&&"plans_execution_summary_dashboard_widget"!==e||(c=e);""===c&&this._sandbox.trigger("show.nodata.message");for(e in this._widgets)if(this._widgets.hasOwnProperty(e)){var g=this._widgets[e],k=d[g.toString()]||"";g.getContent()&&b&&g.toString()in b&&b.access[k]&&(g.toString()===c&&this._sandbox.trigger("set.current.routing.widget",{widgetName:g.toString()}),g.update(b[g.toString()]))}}}))})();toa.ns("toa.controllers.RoutingRuns",function(){var d=toa.Controller,c=toa.views.routingRuns.Layout,b=toa.views.routingRuns.WidgetsSet;return toa.define(d,function(e){d.prototype._create.call(this,e);e.registerModel("treeModel",toa.models.BucketTree);this.treeModel=e.model("treeModel");this.showBucketsTree();this.sandbox.trigger("layout.tabs.set",{tabs:32,show:32});this.onDateChanged=this.onDateChanged.bind(this);this._todayDate=this.sandbox.get("today");this._selectedPid=this.sandbox.get("pid");
this._selectedDate=this.sandbox.get("date");this._layout=(new c(this.sandbox)).render($(e.options.content));this._panelTitleTarget=this.getPanelTitleTarget();this._renderPanelTitle();this.setRoutingRunContentHeight();this.sandbox.bind("routing.runs.update.all.widgets",function(){this.getAllWidgetData()}.bind(this));this._widgets=(new b(this.sandbox,this._layout,this._panelTitle)).render();this.setRoutingRunContentHeight();this.sandbox.trigger("routing_run.provider.changed",{pid:this._selectedPid});
this.enableAutoUpdate();this.getAllWidgetData();toa.currentInterface===INTERFACE.MOBILITY&&toa.widgets.HangTree.getHangTree().refresh(SCREEN_MAPPINGS.routing)},{_REFRESH_TIMEOUT_IN_SECONDS:150,_selectedPid:0,_selectedDate:null,_renderPanelTitle:function(){this._panelTitle=toa.view.control.create({xtype:"PanelTitle",resourceTreeButton:!1,viewSelector:!1,backButton:!1,screenName:SCREEN_MAPPINGS.routing,headerResponsive:_DATA.is_mobility_app?_DATA.page_label:"",backButtonIcon:"",backButtonHint:toa.glossary({id:13114}),
backButtonLabel:toa.glossary({id:13114}),backButtonIconClass:"routing-baseline-icon",calendar:!0,filter:!1,filterDesc:!1,titleText:"",listeners:{changeDate:this.onDateChanged,openTree:function(){this.showTab()}.bind(this),backButtonClick:function(){this.sandbox.trigger("baseline_dashboard_widget_request_data")}.bind(this)}});this._panelTitle.setOption("selectedDate",this._selectedDate);this._panelTitle.render(this._panelTitleTarget)},getPanelTitleTarget:function(){var b=this._layout.getPanelTitleContainer();
toa.currentInterface===INTERFACE.MOBILITY&&($("#content-manage-container").prepend('<div class="routing-visualization-title-panel"></div>'),b=$(".routing-visualization-title-panel"));return b},setRoutingRunContentHeight:function(){if(toa.currentInterface===INTERFACE.MOBILITY){var b=($("#content-manage-container div.routing-visualization-title-panel div.toa-view-control-paneltitle.toa-panel-title").outerHeight()||0)+($("#content-manage-container div.routing-visualization-title-panel div.header-stripe.panel-title-stripe").outerHeight()||
0),b=b||0;$("#tab32.toa-panel").css("top",b+"px");$(this.sandbox.options.content).css("top",b+"px")}},disableAutoUpdate:function(){this._autoUpdateInterval&&(clearInterval(this._autoUpdateInterval),delete this._autoUpdateInterval)},enableAutoUpdate:function(){this._autoUpdateInterval||(this._autoUpdateInterval=setInterval(function(){this._widgets.isLoading()||this._selectedDate==this._todayDate&&this.getAllWidgetData()}.bind(this),1E3*this._REFRESH_TIMEOUT_IN_SECONDS))},getAllWidgetData:function(b){this.sandbox.trigger("global.data.get",
{controller:"Routingvisualization",method:"getAllData",params:{pid:this._selectedPid,date:this._selectedDate},responseHandler:function(c,d){this._widgets.update(d,b);this.updateBucketsTree(c,d);this._layout.setAccess(d.access)}.bind(this),errorHandler:function(b){this._layout.showAlert(b);return!1}.bind(this)})},onProviderChange:function(b){this.isSuspended||this._selectedPid===b||(this._selectedPid=b,this.disableAutoUpdate(),b=this.treeModel.getResource(this._selectedPid),this._panelTitle.setOption("titleText",
hs(b.getName())),this._widgets.setResourceId(this._selectedPid),this.getAllWidgetData(),this.enableAutoUpdate())},onDateChanged:function(b,c){if(!this.isSuspended){this.disableAutoUpdate();var d=c.date;this.sandbox.trigger("global.date.set",{date:toa.isObject(d)?d[d.length-1]:d,dates:toa.isObject(d)?d:[d]});this._selectedDate=d;this._panelTitle.setOption("selectedDate",d);this._widgets.setDate(d);this.getAllWidgetData();this.enableAutoUpdate()}},resume:function(b){d.prototype.resume.call(this,b);
$(".toa-tree-panel .toa-panel-content-alta").removeClass("toa-panel-content-alta");this.sandbox.trigger("layout.tabs.set",{tabs:32,show:32});this.showBucketsTree();this.refreshResourceTreeButton(32);this._selectedDate=this.sandbox.get("date");this._selectedPid=this.sandbox.get("pid");this.attachTitle();this.setRoutingRunContentHeight();this._panelTitle.setOption("selectedDate",this._selectedDate);this._layout.attach();this.enableAutoUpdate();this._widgets.enableAutoUpdate();this._widgets.setResourceId(this._selectedPid);
this._widgets.setDate(this._selectedDate);this.sandbox.trigger("routing_run.provider.changed",{pid:this._selectedPid,_normalPager:b.params._normalPager});this.getAllWidgetData(!0)},suspend:function(b){d.prototype.suspend.call(this,b);$(".tip_container_"+SCREEN_MAPPINGS.routing+" > .toa-tree-panel").remove();this.tree.hide();this._widgets.disableAutoUpdate();this.disableAutoUpdate();this._layout.detach();this.detachTitle();this.setRoutingRunContentHeight()},refreshResourceTreeButton:function(b){b=
_DATA&&_DATA.tabs.isVisible(b)&&!_DATA.tabs.isOpened(b);this._panelTitle.setOption("resourceTreeButton",b)},attachTitle:function(){if(toa.currentInterface===INTERFACE.MOBILITY){var b=$("#content-manage-container");this._panelTitleTarget.appendTo(b)}},detachTitle:function(){toa.currentInterface===INTERFACE.MOBILITY&&this._panelTitleTarget.detach()},updateBucketsTree:function(b,c){"undefined"!==typeof c.tree&&this.updateTree(c.tree||null,c.topBucketId||null)},showBucketsTree:function(){var b=this,c;
this.treeModel.treeType="type";var d=$("#tab32 .toa-panel-title").empty();0===d.length&&($("#tab32").append('<div class="toa-tree-panel"><div class="toa-panel-title"></div><div id="tab32_content" class="toa-panel-content"></div></div>'),d=$("#tab32 .toa-panel-title"));var l=toa.view.control.create({xtype:"ResourceTreeCaption",widthFilter:!1,screenName:SCREEN_MAPPINGS.routing,withCloseButton:!0,listeners:{search:function(d,k){b.treeModel.search(k.key);c.ResourceTree("option","searchKey",k.key);var l=
c.scrollTop(),n=c.scrollLeft();c.ResourceTree("clear");c.ResourceTree("update");c.ResourceTree("select",b._selectedPid);c.scrollTop(l);c.scrollLeft(n)},close:function(){b.hideTab()}}});l.render(d);$("#tab32_content").remove();b.tree=$('<div id="tab32_content" class="toa-panel-content routing-visualization-panel" style="overflow: auto; "></div>').ResourceTree({state:this.treeModel,select:function(c,d){b.onProviderChange(d);b.sandbox.trigger("routing_run.provider.changed",{pid:d});b.sandbox.trigger("global.provider.select",
{pid:d});l.notify("provider.selected")}}).ResourceTree("select",b._selectedPid).appendTo("#tab32");c=$("#tab32_content");if(toa.currentInterface===INTERFACE.MOBILITY){d=toa.widgets.HangTree.getHangTree();l.addListener("panel.hide",this.hideTab.bind(this));l.addListener("panel.show",this.showTab.bind(this));b.tree.appendTo("#tab32 .toa-tree-panel");d.registerTree({screen:SCREEN_MAPPINGS.routing,content:$("#tab32 .toa-tree-panel"),container:$("#tab32"),tree:l});var n=d.getTreeState(SCREEN_MAPPINGS.routing);
"undefined"!==typeof n&&d.setTreeState(SCREEN_MAPPINGS.routing,n)}},hideTab:function(){_DATA&&_DATA.tabs.hide(32);this._panelTitle.setOption("resourceTreeButton",!0)},showTab:function(){_DATA&&_DATA.tabs.show(32);this._panelTitle.setOption("resourceTreeButton",!1)},updateTree:function(b,c){if(null===b||"no tree"===b)toa.ui.Alert({text:toa.glossary({id:6308,type:"raw"})}),this.suspend({}),toa.app.trigger("layout.tabs.set",{tabs:0,tabs_show:0}),set_indicator(0);else{this.sandbox.trigger("layout.tabs.set",
{tabs:32,show:32});this.treeModel.clear();this.treeModel.update({tree_updates:b});c=b.hasOwnProperty(this._selectedPid)?this._selectedPid:c;var d="";if(null!==c){this._selectedPid=c;var l=this.treeModel.getResource(this._selectedPid),d=l?l.getName():d}this.sandbox.trigger("system.title.setResource",{resourceName:d});this._panelTitle.setOption("titleText",hs(d));this.tree.ResourceTree("clear");this.tree.ResourceTree("update");this.tree.ResourceTree("unselect");null!==c&&this.tree.ResourceTree("select",
this._selectedPid)}},toString:function(){return"RoutingRuns"}},{})}());toa.ns("toa.controllers.RoutingPlan",function(){var d=toa.Controller;return toa.define(d,function(c){d.prototype._create.call(this,c);this.sandbox.options.content||(this.sandbox.options.content=$(_DATA.dispatcher_content));this.options=this.sandbox.options},{currentContent:null,hideTabs:function(){this.tabsConfig={};for(var c in _DATA.tabs.tabs){var b=_DATA.tabs.tabs[c].opened;(this.tabsConfig[c]=b)&&_DATA.tabs.hide(c)}},showTabs:function(){for(var c in this.tabsConfig)this.tabsConfig[c]?_DATA.tabs.show(c):
_DATA.tabs.hide(c)},processData:function(c){this._profiles=c.data.profiles;this.lookups=c.data.metadata.lookups;this.access=c.data.metadata.access;this.scenarios=c.data.messagescenarios;toa.app.model("featureList").load(c.data.metadata.feature_list);for(var b in c.data.metadata.placeholders)_DATA.glossary[b]=c.data.metadata.placeholders[b]},setPlansHandlers:function(){this.planForm=new toa.routingProfile.planForm;this.planForm.setLookups(this.lookups);this.planForm.setScenarios(this.scenarios);this.planForm.setAccess(this.access);
this.planForm.preparePlanData=this.submitPlanForm.bind(this);this.settingsForm=new toa.routingProfile.settingsFilterForm;this.settingsForm.setLookups(this.lookups)},submitPlanForm:function(){this.sandbox.trigger("global.data.get",{controller:"routingprofiles",method:"setPlan",params:{routingPlan:JSON.stringify(this.planForm.sendData),mode:this.planForm.getMode()},responseHandler:this.returnToSmartRouting.bind(this)})},_createCaption:function(){if(!$("#content_caption_alta").children().length){var c=
{xtype:"PanelTitleAlta",name:"title",titleText:h(13809),resourceTreeButton:!1,backButton:!0,backButtonIcon:"",backButtonLabel:_DATA.glossary.action_links.routing_run_list,backButtonHint:h(16257),filter:!1,calendar:!1,filterDesc:[],listeners:{backButtonClick:this.returnToSmartRouting.bind(this)}};this.panel=toa.view.control.create(c);this.panel.render("#content_caption_alta")}},returnToSmartRouting:function(){this.showTabs();toa.app.trigger("layout.menu.click",{label:"routing_run_list",url:"",name:"",
params:{}})},findPlanById:function(c,b){for(var d in c)if(c[d].rpid==b)return c[d];return null},renderPlan:function(c){this.planForm.setPlanData(c);this.planForm.close=function(){this.returnToSmartRouting()}.bind(this);this.options.content.html("");this.planContent=this.planForm.render();this.setContent(this.planContent);this.panel&&this.panel.applyOptionTitleText("",c.rpname)},setContent:function(c){this.currentContent&&this.currentContent.detach();this.options.content.append(c);this.currentContent=
c;this._createCaption()},getPlan:function(c){this.sandbox.trigger("global.data.get",{controller:"routingprofiles",method:"getPlan",params:{id:c},responseHandler:this.processPlanResponse.bind(this)})},clonePlan:function(c,b){this.sandbox.trigger("global.data.get",{controller:"routingprofiles",method:"clonePlanFromNewRouting",params:{profile_id:c,plan_id:b},responseHandler:function(d,g){this.processData(g);this.setPlansHandlers();this.planForm.setAccess(g.access);var k=g.data.profiles,l=this.findPlanById(g.data.plans,
b),n=[],p;for(p in g.data.profiles)n.push(g.data.profiles[p]);n.sort(function(b,c){return b.rprname.localeCompare(c.rprname)});l.rprname=k[c].rprname;l.mode="clone";l.profilesList=n;l.profilePlansList=g.data.plans;this.renderPlan(l)}.bind(this)})},addPlan:function(c){this.sandbox.trigger("global.data.get",{controller:"routingprofiles",method:"addPlanFromNewRouting",params:{profile_id:c},responseHandler:function(b,d){this.processData(d);this.setPlansHandlers();var g=d.data.profiles;this.planForm.setAccess(d.access);
var k=g[c];k.profilesList=g;k.rp_rprid=c;k.work_zone_support=parseInt(d.data.work_zone_support);k.profilePlansList=k.plans;k.action="add_plan";k.active=1;this.planForm.setPlanData(k);this.planContent=this.planForm.render();this.setContent(this.planContent)}.bind(this)})},processPlanResponse:function(c,b){if(1>b.access)return toa.alert(h(5516)),!1;this.processData(b);this.setPlansHandlers();var d=this.isAccessModify()?"modify":"view",g=b.data.profileId,k=b.data.planId;this.sandbox.trigger("global.data.get",
{controller:"routingprofiles",method:"getProfiles",params:{profileId:g},responseHandler:function(b,c){this.planForm.setAccess(this.access);var p=this._profiles||{},s=this.findPlanById(this._profiles[g].plans,k),t=[],u;for(u in c.data.profiles)t.push(c.data.profiles[u]);t.sort(function(b,c){return b.rprname.localeCompare(c.rprname)});s.rprname=p[g].rprname;s.mode=d;s.profilesList=t;s.profilePlansList=c.data.plans;s.work_zone_support=parseInt(c.data.work_zone_support);s.activityFilters=this.lookups.activityFilters;
s.providerFilters=this.lookups.providerFilters;c.data.work_zone_support&&(s.rpassign_bucket_resource=p[g].plans[k].rpassign_bucket_resource);this.renderPlan(s)}.bind(this)})},suspend:function(c){this.panel.getElement().detach();this.currentContent.detach();this.showTabs()},resume:function(c){this.hideTabs();switch(c.options.action){case "add_plan":this.addPlan(c.options.profileId);break;case "edit_plan":this.getPlan(c.options.planId);break;case "clone_plan":this.clonePlan(c.options.profileId,c.options.planId)}},
toString:function(){return"RoutingPlans"},isAccessModify:function(){return this.access&&this.access.routing_plans_widget&&2===this.access.routing_plans_widget}},{})}());toa.ns("toa.partsCatalog.classes.ManageSearchStorageAdapter",function(){var d=toa.partsCatalog.Storage,c=toa.partsCatalog.models.Item,b=new toa.partsCatalog.classes.ErrorMessages("PartsCatalog ManageManageSearchStorageAdapter");return toa.define(null,function(){this._storage=new d},{itemDataToModel:function(d){if(!c.isValidData(d))throw Error(b.get("itemDataToModel","Passed parameter isnit valid Item data",d));var g=c.getCatalogId(d),k=c.getId(d),l=this._storage.isItemExists(g,k);this._storage.mergeItem(g,
d);d=this._storage.getItem(g,k);l||this._storage.removeItem(g,k);return d}},{})}());
